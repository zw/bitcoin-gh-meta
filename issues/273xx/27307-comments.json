[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27307).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/27307#pullrequestreview-1883484751) |\n| Approach ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/27307#pullrequestreview-1643959917) |\n| Stale ACK | [murchandamus](https://github.com/bitcoin/bitcoin/pull/27307#pullrequestreview-1849792773), [achow101](https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1930854540) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-03-22T21:30:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1480287022",
      "id" : 1480287022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585YO2Mu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480287022/reactions"
      },
      "updated_at" : "2024-02-21T12:42:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480287022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-27T19:04:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1565654555",
      "id" : 1565654555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585dUf4b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565654555/reactions"
      },
      "updated_at" : "2023-05-27T19:04:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565654555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1244653007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1244653007"
         }
      },
      "author_association" : "NONE",
      "body" : "What do you think of renaming the `TxStateConflicted` struct to `TxStateBlockConflicted`, since that one is used for block conflicts and there is now a difference here between block and mempool conflicts?",
      "commit_id" : "0538ad7d4cfddb5a377f879cbf221b2b028c264a",
      "created_at" : "2023-06-28T04:26:28Z",
      "diff_hunk" : "@@ -315,7 +321,9 @@ class CWalletTx\n     template<typename T> T* state() { return std::get_if<T>(&m_state); }\n \n     bool isAbandoned() const { return state<TxStateInactive>() && state<TxStateInactive>()->abandoned; }\n-    bool isConflicted() const { return state<TxStateConflicted>(); }\n+    bool isConflicted() const { return state<TxStateConflicted>() || state<TxStateMempoolConflicted>(); }\n+    bool isMempoolConflicted() const { return state<TxStateMempoolConflicted>(); }\n+    bool isBlockConflicted() const { return state<TxStateConflicted>(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1244653007",
      "id" : 1244653007,
      "line" : 326,
      "node_id" : "PRRC_kwDOABII585KL-XP",
      "original_commit_id" : "0538ad7d4cfddb5a377f879cbf221b2b028c264a",
      "original_line" : 326,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 43,
      "pull_request_review_id" : 1502236845,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1244653007/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-28T04:27:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1244653007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11140095?v=4",
         "events_url" : "https://api.github.com/users/evansmj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/evansmj/followers",
         "following_url" : "https://api.github.com/users/evansmj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/evansmj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/evansmj",
         "id" : 11140095,
         "login" : "evansmj",
         "node_id" : "MDQ6VXNlcjExMTQwMDk1",
         "organizations_url" : "https://api.github.com/users/evansmj/orgs",
         "received_events_url" : "https://api.github.com/users/evansmj/received_events",
         "repos_url" : "https://api.github.com/users/evansmj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/evansmj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/evansmj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/evansmj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1245286239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245286239"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That makes sense, I'll do that using a [scripted diff.](https://github.com/bitcoin/bitcoin/blob/d6ee03507f39223889a5f039c4db7204ddfb91d5/doc/developer-notes.md#scripted-diffs)",
      "commit_id" : "0538ad7d4cfddb5a377f879cbf221b2b028c264a",
      "created_at" : "2023-06-28T14:15:18Z",
      "diff_hunk" : "@@ -315,7 +321,9 @@ class CWalletTx\n     template<typename T> T* state() { return std::get_if<T>(&m_state); }\n \n     bool isAbandoned() const { return state<TxStateInactive>() && state<TxStateInactive>()->abandoned; }\n-    bool isConflicted() const { return state<TxStateConflicted>(); }\n+    bool isConflicted() const { return state<TxStateConflicted>() || state<TxStateMempoolConflicted>(); }\n+    bool isMempoolConflicted() const { return state<TxStateMempoolConflicted>(); }\n+    bool isBlockConflicted() const { return state<TxStateConflicted>(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1245286239",
      "id" : 1245286239,
      "in_reply_to_id" : 1244653007,
      "line" : 326,
      "node_id" : "PRRC_kwDOABII585KOY9f",
      "original_commit_id" : "0538ad7d4cfddb5a377f879cbf221b2b028c264a",
      "original_line" : 326,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 43,
      "pull_request_review_id" : 1503214745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245286239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-28T14:15:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245286239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1270411973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270411973"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/6496120092753920?logs=ci#L3132\r\n\r\n```\r\n test  2023-07-17T05:13:02.641000Z TestFramework (ERROR): Assertion failed \r\n                                   Traceback (most recent call last):\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 131, in main\r\n                                       self.run_test()\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/wallet_conflicts.py\", line 34, in run_test\r\n                                       self.test_mempool_and_block_conflicts()\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/wallet_conflicts.py\", line 219, in test_mempool_and_block_conflicts\r\n                                       assert_equal(len(alice.getrawmempool()), 0)\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/util.py\", line 57, in assert_equal\r\n                                       raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\n                                   AssertionError: not(1 == 0)",
      "commit_id" : "20d58f2554ba5cad1e6385a0f2d87b3750581442",
      "created_at" : "2023-07-21T08:46:08Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        # alice has all 0 txs, bob has 3\n+        assert_equal(len(alice.getrawmempool()), 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1270411973",
      "id" : 1270411973,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII585LuPLF",
      "original_commit_id" : "42412c592e01960e77972321f1f6999342cb0c6c",
      "original_line" : 219,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 111,
      "pull_request_review_id" : 1540742589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270411973/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T08:46:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270411973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1271448113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271448113"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "20d58f2554ba5cad1e6385a0f2d87b3750581442",
      "created_at" : "2023-07-23T13:24:51Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        # alice has all 0 txs, bob has 3\n+        assert_equal(len(alice.getrawmempool()), 0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1271448113",
      "id" : 1271448113,
      "in_reply_to_id" : 1270411973,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII585LyMIx",
      "original_commit_id" : "42412c592e01960e77972321f1f6999342cb0c6c",
      "original_line" : 219,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 111,
      "pull_request_review_id" : 1542251974,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271448113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-23T13:24:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271448113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1337024969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337024969"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Question: What's the expected state of a transaction if its parent is replaced? My (shallow) understanding suggests it becomes inactive? And if the parent is re-added to mempool, it stays inactive?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2023-09-26T10:57:19Z",
      "diff_hunk" : "@@ -1386,6 +1385,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1337024969",
      "id" : 1337024969,
      "line" : 1425,
      "node_id" : "PRRC_kwDOABII585PsWHJ",
      "original_commit_id" : "20d58f2554ba5cad1e6385a0f2d87b3750581442",
      "original_line" : 1425,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 46,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337024969/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337024969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-17T19:42:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1767055383",
      "id" : 1767055383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585pUyAX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1767055383/reactions"
      },
      "updated_at" : "2023-10-17T19:42:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1767055383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1382141691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382141691"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 770a73c66a48434fa48f594709dbbf5831dc1d5d \"wallet: track mempool conflicts\"\r\n\r\nnit: `snake_case` for member variables.\r\n\r\nAdditionally, this is tracking these conflicts at the `CWallet` level. However I wonder if it might be better to track it on a transaction level, i.e. have `CWalletTx` have the set of txids.",
      "commit_id" : "a29849740becd62175a450b9c227bd7bfafe8a86",
      "created_at" : "2023-11-03T19:52:41Z",
      "diff_hunk" : "@@ -337,6 +337,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     void AddToSpends(const COutPoint& outpoint, const uint256& wtxid, WalletBatch* batch = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void AddToSpends(const CWalletTx& wtx, WalletBatch* batch = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    // Map of wtx hash to a set of mempool conflict hashes\n+    std::map<uint256, std::set<uint256>> MempoolConflicts GUARDED_BY(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1382141691",
      "id" : 1382141691,
      "line" : 341,
      "node_id" : "PRRC_kwDOABII585SYc77",
      "original_commit_id" : "770a73c66a48434fa48f594709dbbf5831dc1d5d",
      "original_line" : 341,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 1713437792,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382141691/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-03T20:11:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382141691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1382482637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382482637"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree it is better to track conflicts on a transaction level. I've implemented it this way now and it looks much better. ",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-04T23:48:44Z",
      "diff_hunk" : "@@ -337,6 +337,9 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     void AddToSpends(const COutPoint& outpoint, const uint256& wtxid, WalletBatch* batch = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void AddToSpends(const CWalletTx& wtx, WalletBatch* batch = nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    // Map of wtx hash to a set of mempool conflict hashes\n+    std::map<uint256, std::set<uint256>> MempoolConflicts GUARDED_BY(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1382482637",
      "id" : 1382482637,
      "in_reply_to_id" : 1382141691,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SZwLN",
      "original_commit_id" : "770a73c66a48434fa48f594709dbbf5831dc1d5d",
      "original_line" : 341,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1713887444,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382482637/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-04T23:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382482637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1383974021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383974021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\"\r\n\r\nnit: When doing separate test cases like this, we should also use different wallets to prevent state from one test cases from effecting another. So this should be making its own wallets once again.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-06T20:53:41Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1383974021",
      "id" : 1383974021,
      "line" : 184,
      "node_id" : "PRRC_kwDOABII585SfcSF",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 184,
      "original_position" : 76,
      "original_start_line" : 182,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 76,
      "pull_request_review_id" : 1716221992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383974021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 182,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383974021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1383975379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383975379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\"\r\n\r\nnit: No need to make another wallet for the receiver, just use the default wallet.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-06T20:54:52Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1383975379",
      "id" : 1383975379,
      "line" : 137,
      "node_id" : "PRRC_kwDOABII585SfcnT",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 137,
      "original_position" : 29,
      "original_start_line" : 136,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 29,
      "pull_request_review_id" : 1716221992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383975379/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 136,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1383975379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384017154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384017154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 28a7e883c2f9249213fddbe24948ec5bb90b0fad \"wallet: track mempool conflicts\"\r\n\r\nIt's not clear to me that this change has any effect.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-06T21:30:10Z",
      "diff_hunk" : "@@ -1482,8 +1545,8 @@ void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& b\n \n     // Scan block\n     for (size_t index = 0; index < block.data->vtx.size(); index++) {\n-        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n         transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK);\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384017154",
      "id" : 1384017154,
      "line" : 1549,
      "node_id" : "PRRC_kwDOABII585Sfm0C",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1549,
      "original_position" : 92,
      "original_start_line" : 1485,
      "path" : "src/wallet/wallet.cpp",
      "position" : 129,
      "pull_request_review_id" : 1716221992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384017154/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1486,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384017154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384024252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384024252"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\"\r\n\r\nThis can be compressed into one line using the `send` RPC.\r\n\r\n```suggestion\r\n        raw_tx1 = alice.send(outputs=[{bob.getnewaddress(): 24.9999}], inputs=[unspents[0]], add_to_wallet=False)[\"hex\"]\r\n```",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-06T21:36:36Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384024252",
      "id" : 1384024252,
      "line" : 194,
      "node_id" : "PRRC_kwDOABII585Sfoi8",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 194,
      "original_position" : 86,
      "original_start_line" : 193,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 86,
      "pull_request_review_id" : 1716221992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384024252/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 193,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384024252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384032166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384032166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\"\r\n\r\nIt would be useful to have a comment that explains that 11 blocks are mined so that when they are invalidated, `tx2_conflict` does not get put back into the mempool.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-06T21:39:23Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        # alice has 0 txs, bob has 3\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 3)\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99900000\"))\n+\n+        # bob broadcasts tx_1 conflict\n+        tx1_conflict = bob.sendrawtransaction(tx1_conflict)\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 2)\n+\n+        assert tx2 in bob.getrawmempool()\n+        assert tx1_conflict in bob.getrawmempool()\n+\n+        assert_equal(bob.gettransaction(tx1)[\"mempoolconflicts\"], [tx1_conflict])\n+        assert_equal(bob.gettransaction(tx2)[\"mempoolconflicts\"], [])\n+        assert_equal(bob.gettransaction(tx3)[\"mempoolconflicts\"], [tx1_conflict])\n+\n+        # check that tx3 is now conflicted, so the output from tx2 can now be spent\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"24.99990000\"))\n+\n+        # we will be disconnecting this block in the future\n+        tx2_conflict = alice.sendrawtransaction(tx2_conflict)\n+        assert_equal(len(alice.getrawmempool()), 1)\n+        blk = self.generate(self.nodes[0], 11, sync_fun=self.no_op)[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384032166",
      "id" : 1384032166,
      "line" : 242,
      "node_id" : "PRRC_kwDOABII585Sfqem",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 242,
      "original_position" : 134,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 134,
      "pull_request_review_id" : 1716221992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384032166/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384032166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384035046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384035046"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\"\r\n\r\nThis isn't actually necessary since `listunspent` has these fields already and the extra ones are just ignored.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-06T21:39:51Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1384035046",
      "id" : 1384035046,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585SfrLm",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 143,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 35,
      "pull_request_review_id" : 1716221992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384035046/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-06T21:39:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1384035046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1385015371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1385015371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think before this was to fix a bug, but I fixed that bug in a different way. Regardless, doesn't it make more sense to run `transactionRemovedFromMempool` before syncing the transaction as confirmed? ",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-07T14:33:44Z",
      "diff_hunk" : "@@ -1482,8 +1545,8 @@ void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& b\n \n     // Scan block\n     for (size_t index = 0; index < block.data->vtx.size(); index++) {\n-        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n         transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK);\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1385015371",
      "id" : 1385015371,
      "in_reply_to_id" : 1384017154,
      "line" : 1549,
      "node_id" : "PRRC_kwDOABII585SjahL",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1549,
      "original_position" : 92,
      "original_start_line" : 1485,
      "path" : "src/wallet/wallet.cpp",
      "position" : 129,
      "pull_request_review_id" : 1717849509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1385015371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1486,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-11-07T14:33:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1385015371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-07T18:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1799468182",
      "id" : 1799468182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585rQbSW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1799468182/reactions"
      },
      "updated_at" : "2023-11-07T18:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1799468182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1387276842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387276842"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 5107e4e730a150068c5a214020a6393d2ba33aa8 \"wallet: use CWalletTx member functions to determine tx state\":\r\n\r\nWhile I see why `TxStateConflicted` would be excluded here, it is not quite obvious to me why your replacement is equivalent. Could you perhaps expand a bit on this in a comment or the commit message?",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-08T22:40:26Z",
      "diff_hunk" : "@@ -752,8 +752,7 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            if (mit->second.isConfirmed() || mit->second.InMempool() || (mit->second.isInactive() && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1387276842",
      "id" : 1387276842,
      "line" : 755,
      "node_id" : "PRRC_kwDOABII585SsCoq",
      "original_commit_id" : "5107e4e730a150068c5a214020a6393d2ba33aa8",
      "original_line" : 755,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387276842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387276842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1387279137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387279137"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 920f16c9a11d167444f509a9fd2f0244f1f635eb \"scripted-diff: wallet: s/TxStateConflicted/TxStateBlockConflicted\":\r\n\r\nI was considering whether there might be a way to better express that the transaction is in conflict with a confirmed transaction. How about:\r\n\r\n```suggestion\r\n        wtx.state<TxStateConfirmedConflict>() ? wtx.state<TxStateConfirmedConflict>()->conflicting_block_height :\r\n```",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-08T22:43:49Z",
      "diff_hunk" : "@@ -91,7 +91,7 @@ WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n     WalletTxStatus result;\n     result.block_height =\n         wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :\n-        wtx.state<TxStateConflicted>() ? wtx.state<TxStateConflicted>()->conflicting_block_height :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1387279137",
      "id" : 1387279137,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585SsDMh",
      "original_commit_id" : "920f16c9a11d167444f509a9fd2f0244f1f635eb",
      "original_line" : 94,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 4,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387279137/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387279137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388493685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388493685"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 28a7e883c2f9249213fddbe24948ec5bb90b0fad \"wallet: track mempool conflicts\":\r\n\r\nNote to self and other reviewers: `TxSpends` is an `unordered_multimap` which permits multiple entries to have the same key, and `equal_range(â¦)` returns the range of iterators that match the given key denominated in first iterator to first iterator after the range.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T19:30:10Z",
      "diff_hunk" : "@@ -1426,6 +1426,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388493685",
      "id" : 1388493685,
      "line" : 1437,
      "node_id" : "PRRC_kwDOABII585Swrt1",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1437,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388493685/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388493685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388510399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388510399"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 28a7e883c2f9249213fddbe24948ec5bb90b0fad \"wallet: track mempool conflicts\":\r\nCould you perhaps explain what the purpose of mining ten blocks here is?",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T19:47:32Z",
      "diff_hunk" : "@@ -232,7 +232,9 @@ def run_test(self):\n         balance = newbalance\n \n         # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available\n-        self.nodes[0].invalidateblock(self.nodes[0].getbestblockhash())\n+        blk = self.nodes[0].getbestblockhash()\n+        self.generate(self.nodes[1], 10)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388510399",
      "id" : 1388510399,
      "line" : 236,
      "node_id" : "PRRC_kwDOABII585Swvy_",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 236,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_abandonconflict.py",
      "position" : 6,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388510399/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388510399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388531074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388531074"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\":\r\nItâs a bit confusing that you take an input `tx1` here which is the 'hex' string of the raw transaction, but then assign the resulting 'txid' back to `tx1`.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T20:08:36Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388531074",
      "id" : 1388531074,
      "line" : 155,
      "node_id" : "PRRC_kwDOABII585Sw02C",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 155,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 47,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388531074/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388531074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388532260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388532260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\":\r\nSince `tx2` replaced `tx1`, why would `unspents[0]` be considered spent here?",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T20:09:50Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388532260",
      "id" : 1388532260,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII585Sw1Ik",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 174,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 66,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388532260/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388532260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388533849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388533849"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, this could be a problem if you only run one of the tests separately instead of the whole suite. Then that test would fail, since itâs setup depends on the prior test having been run before.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T20:11:36Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388533849",
      "id" : 1388533849,
      "in_reply_to_id" : 1383974021,
      "line" : 184,
      "node_id" : "PRRC_kwDOABII585Sw1hZ",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 184,
      "original_position" : 76,
      "original_start_line" : 182,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 76,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388533849/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 182,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388533849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388545575"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388545575"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\":\r\nIâm having trouble keeping track of all the things going on here. Perhaps you could add in these comments which transactions each node now knows about",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T20:24:58Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        # alice has 0 txs, bob has 3",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388545575",
      "id" : 1388545575,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII585Sw4Yn",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 218,
      "original_position" : 110,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 110,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388545575/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388545575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388547724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388547724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 003efbbe45079c4416810a025b2bc372559dff15 \"test: Add tests for wallet mempool conflicts\":\r\n`tx1_conflict` should displace `tx1`, but why does Bob not have 3 again now? Shouldnât Bob know about `tx1`, `tx2`, and `tx3` before, and then `tx1_conflict`, `tx2`, and `tx3` after?",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-09T20:27:27Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        # alice has 0 txs, bob has 3\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 3)\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99900000\"))\n+\n+        # bob broadcasts tx_1 conflict\n+        tx1_conflict = bob.sendrawtransaction(tx1_conflict)\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1388547724",
      "id" : 1388547724,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585Sw46M",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 227,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 119,
      "pull_request_review_id" : 1721396961,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388547724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T20:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388547724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1389968548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389968548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`depth > 0  || (depth == 0 && !mit->second.isAbandoned())` is saying that the spending transaction should be confirmed, or: must not be (block) conflicted, and it must not be abandoned, for the corresponding output to be considered spent. \r\n\r\n`mit->second.isConfirmed() || mit->second.InMempool() || (mit->second.isInactive() && !mit->second.isAbandoned())`  is saying that the spending transaction should be confirmed, or in the mempool, or: must be inactive and not abandoned for the corresponding output to be considered spent. \r\n\r\nIn this context, saying that a transaction must not be conflicted is logically equivalent to saying that the transaction must be inactive and not abandoned. I will add a comment to clarify this.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-10T22:05:56Z",
      "diff_hunk" : "@@ -752,8 +752,7 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            if (mit->second.isConfirmed() || mit->second.InMempool() || (mit->second.isInactive() && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1389968548",
      "id" : 1389968548,
      "in_reply_to_id" : 1387276842,
      "line" : 755,
      "node_id" : "PRRC_kwDOABII585S2Tyk",
      "original_commit_id" : "5107e4e730a150068c5a214020a6393d2ba33aa8",
      "original_line" : 755,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 1725717976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389968548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-10T22:05:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389968548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1389995261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389995261"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because `tx3` replaced `tx2`, so `tx1` is now `TxStateInactive` instead of `TxStateMempoolConflicted`, making `unspents[0]` spent.",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-10T22:49:45Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1389995261",
      "id" : 1389995261,
      "in_reply_to_id" : 1388532260,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII585S2aT9",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 174,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 66,
      "pull_request_review_id" : 1725756150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389995261/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-10T22:49:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389995261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390055024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390055024"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These two things are not technically equivalent, because `send` creates a change output here, which results in intermittent failures for the rest of the test. Is there any way to tell `send` not to create a change output? ",
      "commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "created_at" : "2023-11-11T00:20:26Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390055024",
      "id" : 1390055024,
      "in_reply_to_id" : 1384024252,
      "line" : 194,
      "node_id" : "PRRC_kwDOABII585S2o5w",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 194,
      "original_position" : 86,
      "original_start_line" : 193,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 86,
      "pull_request_review_id" : 1725836363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390055024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 193,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-11T00:20:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390055024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390071466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390071466"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that `TxStateBlockConflicted` and `TxStateMempoolConflicted` are a bit more clear, because with something like `TxStateUnconfirmedConflict` instead of `TxStateMempoolConflicted`, it is unclear whether the conflict is in the mempool, or just hasn't been broadcasted yet. Additionally, I felt that it was more uniform with the other transaction states to be describing the state of the transaction instead of the state of a conflict. Eg. `TxStateBlockConflicted` indicates that the transaction is block-conflicted, and similarly `TxStateConfirmed` indicates that the transaction is confirmed. On the other hand, `TxStateConfirmedConflict` indicates the state of the conflict. \r\n\r\nThat being said, if you or others think that `TxStateConfirmedConflict` or something similar is better, I would be open to changing it. ",
      "commit_id" : "4d7524a563aa8ef8c075ce337e985a2d1aaeddd6",
      "created_at" : "2023-11-11T01:00:10Z",
      "diff_hunk" : "@@ -91,7 +91,7 @@ WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n     WalletTxStatus result;\n     result.block_height =\n         wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :\n-        wtx.state<TxStateConflicted>() ? wtx.state<TxStateConflicted>()->conflicting_block_height :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390071466",
      "id" : 1390071466,
      "in_reply_to_id" : 1387279137,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585S2s6q",
      "original_commit_id" : "920f16c9a11d167444f509a9fd2f0244f1f635eb",
      "original_line" : 94,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 4,
      "pull_request_review_id" : 1725860719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390071466/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T01:00:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390071466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "19bb5842562582d831bc4af4d03e3671455bbcdd",
      "created_at" : "2023-11-11T04:47:28Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128297",
      "id" : 1390128297,
      "in_reply_to_id" : 1383974021,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585S26yp",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 184,
      "original_position" : 76,
      "original_start_line" : 182,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1725941221,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-11T04:47:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128370"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "19bb5842562582d831bc4af4d03e3671455bbcdd",
      "created_at" : "2023-11-11T04:47:54Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128370",
      "id" : 1390128370,
      "in_reply_to_id" : 1383975379,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585S26zy",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 137,
      "original_position" : 29,
      "original_start_line" : 136,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1725941259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128370/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-11T04:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added a comment.",
      "commit_id" : "19bb5842562582d831bc4af4d03e3671455bbcdd",
      "created_at" : "2023-11-11T04:48:17Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        # alice has 0 txs, bob has 3\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 3)\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99900000\"))\n+\n+        # bob broadcasts tx_1 conflict\n+        tx1_conflict = bob.sendrawtransaction(tx1_conflict)\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 2)\n+\n+        assert tx2 in bob.getrawmempool()\n+        assert tx1_conflict in bob.getrawmempool()\n+\n+        assert_equal(bob.gettransaction(tx1)[\"mempoolconflicts\"], [tx1_conflict])\n+        assert_equal(bob.gettransaction(tx2)[\"mempoolconflicts\"], [])\n+        assert_equal(bob.gettransaction(tx3)[\"mempoolconflicts\"], [tx1_conflict])\n+\n+        # check that tx3 is now conflicted, so the output from tx2 can now be spent\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"24.99990000\"))\n+\n+        # we will be disconnecting this block in the future\n+        tx2_conflict = alice.sendrawtransaction(tx2_conflict)\n+        assert_equal(len(alice.getrawmempool()), 1)\n+        blk = self.generate(self.nodes[0], 11, sync_fun=self.no_op)[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128432",
      "id" : 1390128432,
      "in_reply_to_id" : 1384032166,
      "line" : 248,
      "node_id" : "PRRC_kwDOABII585S260w",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 248,
      "original_position" : 134,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 140,
      "pull_request_review_id" : 1725941363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T04:48:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128566"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "19bb5842562582d831bc4af4d03e3671455bbcdd",
      "created_at" : "2023-11-11T04:48:34Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390128566",
      "id" : 1390128566,
      "in_reply_to_id" : 1384035046,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585S2622",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 143,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1725941466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128566/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T04:48:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390128566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390129010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390129010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added this comment explaining why 10 blocks need to be mined:\r\n```\r\n# mine 10 blocks so that when the blk is invalidated, the transactions are not\r\n# returned to the mempool\r\n```",
      "commit_id" : "19bb5842562582d831bc4af4d03e3671455bbcdd",
      "created_at" : "2023-11-11T04:51:25Z",
      "diff_hunk" : "@@ -232,7 +232,9 @@ def run_test(self):\n         balance = newbalance\n \n         # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available\n-        self.nodes[0].invalidateblock(self.nodes[0].getbestblockhash())\n+        blk = self.nodes[0].getbestblockhash()\n+        self.generate(self.nodes[1], 10)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390129010",
      "id" : 1390129010,
      "in_reply_to_id" : 1388510399,
      "line" : 238,
      "node_id" : "PRRC_kwDOABII585S269y",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 238,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/wallet_abandonconflict.py",
      "position" : 8,
      "pull_request_review_id" : 1725942031,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390129010/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T04:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390129010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390129173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390129173"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've replaced `tx1` with `tx1_txid` here and for all other instances of this.",
      "commit_id" : "19bb5842562582d831bc4af4d03e3671455bbcdd",
      "created_at" : "2023-11-11T04:53:01Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1390129173",
      "id" : 1390129173,
      "in_reply_to_id" : 1388531074,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585S27AV",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 155,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1725942421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390129173/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-11T04:53:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390129173",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and addressed most of the review comments (thanks @achow101 and @murchandamus). I will address the remaining comments soon. ",
      "created_at" : "2023-11-11T04:58:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1806687648",
      "id" : 1806687648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585rr92g",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1806687648/reactions"
      },
      "updated_at" : "2023-11-11T04:58:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1806687648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1393623761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1393623761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`tx1_conflict` also displaces `tx3` because `tx3` spends `tx1`, so it is also considered mempool-conflicted. So instead `tx1_conflict` and `tx2` are the only transactions left in the mempool. I've added a comment indicating this. ",
      "commit_id" : "22778ac98f1bcb695de8ccf0b02fe9ebe39b01aa",
      "created_at" : "2023-11-15T04:35:51Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        # alice has 0 txs, bob has 3\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 3)\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99900000\"))\n+\n+        # bob broadcasts tx_1 conflict\n+        tx1_conflict = bob.sendrawtransaction(tx1_conflict)\n+        assert_equal(len(alice.getrawmempool()), 0)\n+        assert_equal(len(bob.getrawmempool()), 2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1393623761",
      "id" : 1393623761,
      "in_reply_to_id" : 1388547724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585TEQLR",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 231,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1731223899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1393623761/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-15T04:35:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1393623761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1393624485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1393624485"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that it gets a bit confusing, so I've added a lot more comments. ",
      "commit_id" : "22778ac98f1bcb695de8ccf0b02fe9ebe39b01aa",
      "created_at" : "2023-11-15T04:37:43Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        alice.sendrawtransaction(alice.gettransaction(tx1)['hex'])\n+        self.generate(self.nodes[0], 3)\n+        assert_equal(alice.getbalance(), 75)\n+\n+    def test_mempool_and_block_conflicts(self):\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.log.info(\"Test a scenario where a transaction has both a block conflict and a mempool conflict\")\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], 0)\n+\n+        self.disconnect_nodes(0, 1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0]], outputs=[{bob.getnewaddress() : 24.99999}])\n+        raw_tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx1 = bob.sendrawtransaction(raw_tx1)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[2]], outputs=[{alice.getnewaddress() : 49.999}])\n+        tx1_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{alice.getnewaddress() : 24.99}])\n+        tx1_conflict_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{bob.getnewaddress() : 24.9999}])\n+        raw_tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx2 = bob.sendrawtransaction(raw_tx2)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1]], outputs=[{alice.getnewaddress() : 24.9999}])\n+        tx2_conflict = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        bob_unspents = [{\"txid\" : element, \"vout\" : 0} for element in [tx1, tx2]]\n+\n+        assert_equal(bob.getbalances()[\"mine\"][\"untrusted_pending\"], Decimal(\"49.99989000\"))\n+\n+        raw_tx = bob.createrawtransaction(inputs=[bob_unspents[0], bob_unspents[1]], outputs=[{bob.getnewaddress() : 49.999}])\n+        raw_tx3 = bob.signrawtransactionwithwallet(raw_tx)['hex']\n+        tx3 = bob.sendrawtransaction(raw_tx3)\n+\n+        # alice has 0 txs, bob has 3",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1393624485",
      "id" : 1393624485,
      "in_reply_to_id" : 1388545575,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585TEQWl",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 218,
      "original_position" : 110,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1731225048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1393624485/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-15T04:37:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1393624485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have addressed the remaining questions, the only changes are the addition of comments to the functional test. ",
      "created_at" : "2023-11-15T04:40:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1811798648",
      "id" : 1811798648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585r_dp4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1811798648/reactions"
      },
      "updated_at" : "2023-11-15T04:40:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1811798648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1437201563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437201563"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In \"wallet: use CWalletTx member functions to determine tx state\" (80ba1d97f179121736d702b2d54bd3938cb57d96):\r\n\r\nDid you mean \"An output is considered spentâ¦\"?",
      "commit_id" : "d4259cdaff2128c25e877d6a64e6ce15ecb9beca",
      "created_at" : "2023-12-27T18:48:13Z",
      "diff_hunk" : "@@ -752,8 +752,9 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // A transaction is considered spent if a spending transaction",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1437201563",
      "id" : 1437201563,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585VqfSb",
      "original_commit_id" : "80ba1d97f179121736d702b2d54bd3938cb57d96",
      "original_line" : 755,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1797438722,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437201563/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-27T19:18:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437201563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1437240468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437240468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "d4259cdaff2128c25e877d6a64e6ce15ecb9beca",
      "created_at" : "2023-12-27T20:28:25Z",
      "diff_hunk" : "@@ -752,8 +752,9 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // A transaction is considered spent if a spending transaction",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1437240468",
      "id" : 1437240468,
      "in_reply_to_id" : 1437201563,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585VqoyU",
      "original_commit_id" : "80ba1d97f179121736d702b2d54bd3938cb57d96",
      "original_line" : 755,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1797494889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437240468/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-27T20:28:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437240468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/27307/commits/d4259cdaff2128c25e877d6a64e6ce15ecb9beca, only documentation change",
      "created_at" : "2023-12-27T21:19:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1870633370",
      "id" : 1870633370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585vf5ma",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1870633370/reactions"
      },
      "updated_at" : "2023-12-27T21:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1870633370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-24T18:47:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1908723225",
      "id" : 1908723225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585xxM4Z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1908723225/reactions"
      },
      "updated_at" : "2024-01-24T18:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1908723225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1470229826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1470229826"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I donât feel strongly about it, please feel free to mark this comment as resolved.",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-29T21:19:31Z",
      "diff_hunk" : "@@ -91,7 +91,7 @@ WalletTxStatus MakeWalletTxStatus(const CWallet& wallet, const CWalletTx& wtx)\n     WalletTxStatus result;\n     result.block_height =\n         wtx.state<TxStateConfirmed>() ? wtx.state<TxStateConfirmed>()->confirmed_block_height :\n-        wtx.state<TxStateConflicted>() ? wtx.state<TxStateConflicted>()->conflicting_block_height :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1470229826",
      "id" : 1470229826,
      "in_reply_to_id" : 1387279137,
      "line" : 95,
      "node_id" : "PRRC_kwDOABII585Xoe1C",
      "original_commit_id" : "920f16c9a11d167444f509a9fd2f0244f1f635eb",
      "original_line" : 95,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/interfaces.cpp",
      "position" : 4,
      "pull_request_review_id" : 1849792773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1470229826/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-29T21:45:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1470229826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1470235298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1470235298"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In  a6ae5b23b1497ab6f4899db49348db623700a2d8 \"wallet: track mempool conflicts\":\r\n\r\nNit: Should this perhaps also inform about the conflicting transactions like the _BlockConflicted_ state informs about the block?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-29T21:24:25Z",
      "diff_hunk" : "@@ -48,7 +48,12 @@ struct TxStateBlockConflicted {\n     int conflicting_block_height;\n \n     explicit TxStateBlockConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n-    std::string toString() const { return strprintf(\"Conflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+    std::string toString() const { return strprintf(\"BlockConflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+};\n+\n+//! State of transaction with one or more mempool conflicts.\n+struct TxStateMempoolConflicted {\n+    std::string toString() const { return strprintf(\"MempoolConflicted\"); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1470235298",
      "id" : 1470235298,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII585XogKi",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 56,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 17,
      "pull_request_review_id" : 1849792773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1470235298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-29T21:45:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1470235298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471391179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471391179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in a6ae5b23b1497ab6f4899db49348db623700a2d8:\r\n\r\nIt's best to use `Txid` or `Wtxid` for this. And maybe add a doc stating whether these are direct conflicts only, or if they might be descendants of a conflicting transaction?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T15:03:31Z",
      "diff_hunk" : "@@ -258,6 +265,8 @@ class CWalletTx\n     CTransactionRef tx;\n     TxState m_state;\n \n+    std::set<uint256> mempool_conflicts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471391179",
      "id" : 1471391179,
      "line" : 268,
      "node_id" : "PRRC_kwDOABII585Xs6XL",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 268,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 65,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471391179/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471391179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471392482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471392482"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in a6ae5b23b1497ab6f4899db49348db623700a2d8\r\n\r\nsame, `auto` or `Txid` would be better",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T15:04:20Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471392482",
      "id" : 1471392482,
      "line" : 1423,
      "node_id" : "PRRC_kwDOABII585Xs6ri",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1423,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 44,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471392482/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471392482",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471530256"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471530256"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fwiw, it seems better to keep it the way it was if it's not doing anything. What was the bug?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:14:29Z",
      "diff_hunk" : "@@ -1482,8 +1545,8 @@ void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& b\n \n     // Scan block\n     for (size_t index = 0; index < block.data->vtx.size(); index++) {\n-        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n         transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK);\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471530256",
      "id" : 1471530256,
      "in_reply_to_id" : 1384017154,
      "line" : 1542,
      "node_id" : "PRRC_kwDOABII585XtcUQ",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1542,
      "original_position" : 92,
      "original_start_line" : 1485,
      "path" : "src/wallet/wallet.cpp",
      "position" : 122,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471530256/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1477,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471530256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471531989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471531989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in 067189eddee1a2209c6c42741a91601c5514e170\r\n\r\nGot a little nervous seeing the txid comparison and \"same tx.\" Is it possible to run into a same-txid-different-witness situation here?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:15:33Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            if (_it->second == conflict_hash) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471531989",
      "id" : 1471531989,
      "line" : 1435,
      "node_id" : "PRRC_kwDOABII585XtcvV",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1435,
      "original_position" : 26,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : 56,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471531989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1434,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471531989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471533005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471533005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c71736d372c65b0978671501029e202574c6bbef\r\n\r\nAlso good to document - is it just directly conflicting, or descendants as well?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:16:14Z",
      "diff_hunk" : "@@ -417,6 +421,10 @@ static std::vector<RPCResult> TransactionDescriptionString()\n            }},\n            {RPCResult::Type::STR_HEX, \"replaced_by_txid\", /*optional=*/true, \"Only if 'category' is 'send'. The txid if this tx was replaced.\"},\n            {RPCResult::Type::STR_HEX, \"replaces_txid\", /*optional=*/true, \"Only if 'category' is 'send'. The txid if this tx replaces another.\"},\n+           {RPCResult::Type::ARR, \"mempoolconflicts\", \"Conflicting transaction currently in the mempool.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471533005",
      "id" : 1471533005,
      "line" : 424,
      "node_id" : "PRRC_kwDOABII585Xtc_N",
      "original_commit_id" : "c71736d372c65b0978671501029e202574c6bbef",
      "original_line" : 424,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : 15,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471533005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471533005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471567921"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471567921"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71059cf4267d80d2934b85a7046fc7b64900378b\r\n\r\nThere's not anything preventing us from checking the exact contents of `listunspent` right? Here and in the rest of the test.",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:34:03Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471567921",
      "id" : 1471567921,
      "line" : 145,
      "node_id" : "PRRC_kwDOABII585Xtlgx",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 145,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 37,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471567921/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471567921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471575174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471575174"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71059cf4267d80d2934b85a7046fc7b64900378b\r\n\r\nWe don't expect to see tx1 in mempool, right? It's not being rebroadcast, as it's inactive?\r\n\r\n```suggestion\r\n        assert tx1_txid not in self.nodes[0].getrawmempool()\r\n```\r\nMight be good to have a check for this behavior.",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:38:45Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1_txid = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2_txid = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [tx2_txid])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471575174",
      "id" : 1471575174,
      "line" : 173,
      "node_id" : "PRRC_kwDOABII585XtnSG",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 173,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 65,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471575174/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471575174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471581755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471581755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if in scope for this PR, but it would be nice to have a test for how the wallet sees descendants of conflicting transactions (e.g. if Bob creates a child off of tx1 or tx2).",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:40:30Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471581755",
      "id" : 1471581755,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII585Xto47",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 133,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 25,
      "pull_request_review_id" : 1643959917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471581755/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471581755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471596662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471596662"
         }
      },
      "author_association" : "NONE",
      "body" : "> Fixed\n\nNeed enter wallet ",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T16:47:46Z",
      "diff_hunk" : "@@ -752,8 +752,9 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // A transaction is considered spent if a spending transaction",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471596662",
      "id" : 1471596662,
      "in_reply_to_id" : 1437201563,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Xtsh2",
      "original_commit_id" : "80ba1d97f179121736d702b2d54bd3938cb57d96",
      "original_line" : 755,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1851841314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471596662/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T16:47:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471596662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126547106?v=4",
         "events_url" : "https://api.github.com/users/usuarrio-id81214293/events{/privacy}",
         "followers_url" : "https://api.github.com/users/usuarrio-id81214293/followers",
         "following_url" : "https://api.github.com/users/usuarrio-id81214293/following{/other_user}",
         "gists_url" : "https://api.github.com/users/usuarrio-id81214293/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/usuarrio-id81214293",
         "id" : 126547106,
         "login" : "usuarrio-id81214293",
         "node_id" : "U_kgDOB4r0og",
         "organizations_url" : "https://api.github.com/users/usuarrio-id81214293/orgs",
         "received_events_url" : "https://api.github.com/users/usuarrio-id81214293/received_events",
         "repos_url" : "https://api.github.com/users/usuarrio-id81214293/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/usuarrio-id81214293/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/usuarrio-id81214293/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/usuarrio-id81214293"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471649978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471649978"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "With this PR, if a transaction's parent is replaced, then it should become `TxStateMempoolConflicted`. If the conflict is removed, then it becomes inactive. ",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T17:19:02Z",
      "diff_hunk" : "@@ -1386,6 +1385,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471649978",
      "id" : 1471649978,
      "in_reply_to_id" : 1337024969,
      "line" : 1425,
      "node_id" : "PRRC_kwDOABII585Xt5i6",
      "original_commit_id" : "20d58f2554ba5cad1e6385a0f2d87b3750581442",
      "original_line" : 1425,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 46,
      "pull_request_review_id" : 1851917202,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471649978/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-30T17:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471649978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471690474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471690474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, I think that is possible. Would just using wtxids everywhere here fix this?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-30T17:45:24Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            if (_it->second == conflict_hash) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1471690474",
      "id" : 1471690474,
      "in_reply_to_id" : 1471531989,
      "line" : 1435,
      "node_id" : "PRRC_kwDOABII585XuDbq",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1435,
      "original_position" : 26,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : 56,
      "pull_request_review_id" : 1851971752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471690474/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1434,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-30T17:45:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1471690474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472578055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472578055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes I'd expect so",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-31T09:57:34Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            if (_it->second == conflict_hash) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472578055",
      "id" : 1472578055,
      "in_reply_to_id" : 1471531989,
      "line" : 1435,
      "node_id" : "PRRC_kwDOABII585XxcIH",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1435,
      "original_position" : 26,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : 56,
      "pull_request_review_id" : 1853327530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472578055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1434,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-01-31T09:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472578055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472586945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472586945"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah makes sense! I think it would be good to add a test for this case?",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-31T10:04:24Z",
      "diff_hunk" : "@@ -1386,6 +1385,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472586945",
      "id" : 1472586945,
      "in_reply_to_id" : 1337024969,
      "line" : 1425,
      "node_id" : "PRRC_kwDOABII585XxeTB",
      "original_commit_id" : "20d58f2554ba5cad1e6385a0f2d87b3750581442",
      "original_line" : 1425,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 46,
      "pull_request_review_id" : 1853342081,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472586945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-31T10:04:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472586945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472930692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472930692"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: use CWalletTx member functions to determine tx state\" (86aaf81f81b48e82358db6700a6c9d46c5b5b0df)\r\n\r\nCode comment here is just repeating the boolean expression and not explaining anything. I think the simplest explanation of this is \"An output is considered spent by a spending transaction, unless the spending transaction is conflicted or abandoned.\" Could also add \"But the check below is written to check for valid spending transactions instead of invalid ones so it isn't tied to wallet conflict tracking code which is imperfect and could change.\"",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-31T14:44:48Z",
      "diff_hunk" : "@@ -752,8 +752,7 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            if (mit->second.isConfirmed() || mit->second.InMempool() || (mit->second.isInactive() && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472930692",
      "id" : 1472930692,
      "in_reply_to_id" : 1387276842,
      "line" : 757,
      "node_id" : "PRRC_kwDOABII585XyyOE",
      "original_commit_id" : "5107e4e730a150068c5a214020a6393d2ba33aa8",
      "original_line" : 757,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 8,
      "pull_request_review_id" : 1853918541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472930692/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-31T15:34:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472930692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472955815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472955815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a6ae5b23b1497ab6f4899db49348db623700a2d8)\r\n\r\nI think it would be useful to add that mempool conflicted transactions are serialized as inactive transactions, so the distinction between TxStateMempoolConflicted and TxStateInactive only exists at runtime. ",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-01-31T15:01:23Z",
      "diff_hunk" : "@@ -48,7 +48,12 @@ struct TxStateBlockConflicted {\n     int conflicting_block_height;\n \n     explicit TxStateBlockConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n-    std::string toString() const { return strprintf(\"Conflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+    std::string toString() const { return strprintf(\"BlockConflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+};\n+\n+//! State of transaction with one or more mempool conflicts.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472955815",
      "id" : 1472955815,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585Xy4Wn",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 54,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 15,
      "pull_request_review_id" : 1853918541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472955815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-31T15:34:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1472955815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475234088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475234088"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't remember exactly what the bug was, but I know that it had something to do with assuming that all transactions that we call `transactionRemovedFromMempool` on are `TxStateInMempool`. That being said, I will change it back to the way it was before because it is not causing any problems right now. ",
      "commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "created_at" : "2024-02-01T22:26:54Z",
      "diff_hunk" : "@@ -1482,8 +1545,8 @@ void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& b\n \n     // Scan block\n     for (size_t index = 0; index < block.data->vtx.size(); index++) {\n-        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n         transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK);\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475234088",
      "id" : 1475234088,
      "in_reply_to_id" : 1384017154,
      "line" : 1542,
      "node_id" : "PRRC_kwDOABII585X7kko",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1542,
      "original_position" : 92,
      "original_start_line" : 1485,
      "path" : "src/wallet/wallet.cpp",
      "position" : 122,
      "pull_request_review_id" : 1857789328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475234088/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1477,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-02-01T22:26:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475234088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475452360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475452360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could be done in a follow-up if people want it, because currently the conflicting transactions are stored in the `CWalletTx`, and not the transaction state, so this function is not aware of the txids of the mempool conflicts. ",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:48:15Z",
      "diff_hunk" : "@@ -48,7 +48,12 @@ struct TxStateBlockConflicted {\n     int conflicting_block_height;\n \n     explicit TxStateBlockConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n-    std::string toString() const { return strprintf(\"Conflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+    std::string toString() const { return strprintf(\"BlockConflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+};\n+\n+//! State of transaction with one or more mempool conflicts.\n+struct TxStateMempoolConflicted {\n+    std::string toString() const { return strprintf(\"MempoolConflicted\"); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475452360",
      "id" : 1475452360,
      "in_reply_to_id" : 1470235298,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII585X8Z3I",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 56,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 17,
      "pull_request_review_id" : 1858148714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475452360/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475452360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475453805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475453805"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:50:42Z",
      "diff_hunk" : "@@ -258,6 +265,8 @@ class CWalletTx\n     CTransactionRef tx;\n     TxState m_state;\n \n+    std::set<uint256> mempool_conflicts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475453805",
      "id" : 1475453805,
      "in_reply_to_id" : 1471391179,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585X8aNt",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 268,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1858150924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475453805/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475453805",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475453968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475453968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:50:52Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475453968",
      "id" : 1475453968,
      "in_reply_to_id" : 1471392482,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585X8aQQ",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1423,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1858151189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475453968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:50:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475453968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475454363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, that should be fixed now",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:51:18Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            if (_it->second == conflict_hash) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475454363",
      "id" : 1475454363,
      "in_reply_to_id" : 1471531989,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585X8aWb",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1435,
      "original_position" : 26,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1858151911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454363/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:51:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475454524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454524"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:51:29Z",
      "diff_hunk" : "@@ -417,6 +421,10 @@ static std::vector<RPCResult> TransactionDescriptionString()\n            }},\n            {RPCResult::Type::STR_HEX, \"replaced_by_txid\", /*optional=*/true, \"Only if 'category' is 'send'. The txid if this tx was replaced.\"},\n            {RPCResult::Type::STR_HEX, \"replaces_txid\", /*optional=*/true, \"Only if 'category' is 'send'. The txid if this tx replaces another.\"},\n+           {RPCResult::Type::ARR, \"mempoolconflicts\", \"Conflicting transaction currently in the mempool.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475454524",
      "id" : 1475454524,
      "in_reply_to_id" : 1471533005,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585X8aY8",
      "original_commit_id" : "c71736d372c65b0978671501029e202574c6bbef",
      "original_line" : 424,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/transactions.cpp",
      "position" : null,
      "pull_request_review_id" : 1858152191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454524/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:51:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475454837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454837"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point, the tests now check the exact contents. ",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:51:57Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475454837",
      "id" : 1475454837,
      "in_reply_to_id" : 1471567921,
      "line" : 145,
      "node_id" : "PRRC_kwDOABII585X8ad1",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 145,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 37,
      "pull_request_review_id" : 1858152822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454837/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:51:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475454837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475455088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475455088"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added an assertion that the tx isn't in the mempool. ",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:52:22Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1_txid = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2_txid = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [tx2_txid])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475455088",
      "id" : 1475455088,
      "in_reply_to_id" : 1471575174,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII585X8ahw",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 174,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 66,
      "pull_request_review_id" : 1858153417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475455088/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475455088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475457535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475457535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I will add these in a follow-up PR. ",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T02:55:28Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1475457535",
      "id" : 1475457535,
      "in_reply_to_id" : 1471581755,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII585X8bH_",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 133,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 25,
      "pull_request_review_id" : 1858159997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475457535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T02:55:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1475457535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1476795724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476795724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If we get the same txid but different wtxid, I'm not sure that the result is necessarily one that makes sense. Most things in the wallet are keyed and listed by txid, so with this change, we'd end up with a transaction that's listed as conflicted by it's own txid. Also, we won't ever update the wallet to store a transaction with a different wtxid.",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T22:14:05Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            if (_it->second == conflict_hash) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1476795724",
      "id" : 1476795724,
      "in_reply_to_id" : 1471531989,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YBh1M",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1435,
      "original_position" : 26,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1860487135,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476795724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-02T22:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476795724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1476797365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476797365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 5fbf18b89d6768bed1be95dcbc98797df5788dfc \"wallet: track mempool conflicts\"\r\n\r\nI'm a little bit confused by the \"erase this wtx entry\" part of the comment. AFAICT, no entries are being erased, Perhaps this should say:\r\n\r\n```suggestion\r\n                        // If this wtx has no other mempool conflicts, mark it as inactive\r\n```",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T22:16:48Z",
      "diff_hunk" : "@@ -1456,6 +1488,39 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                if (!wtx.mempool_conflicts.empty()) {\n+\n+                    // Remove the previously conflicting transaction from this wtx's entry\n+                    wtx.mempool_conflicts.erase(conflict_txid);\n+\n+                    if (wtx.mempool_conflicts.empty()) {\n+                        // If this wtx has no other mempool conflicts, erase this wtx entry",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1476797365",
      "id" : 1476797365,
      "line" : 1511,
      "node_id" : "PRRC_kwDOABII585YBiO1",
      "original_commit_id" : "5fbf18b89d6768bed1be95dcbc98797df5788dfc",
      "original_line" : 1511,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 102,
      "pull_request_review_id" : 1860489670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476797365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-02T22:31:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476797365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1476798246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476798246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this hasn't been reverted yet?",
      "commit_id" : "2600a28a776b2cd4c182b87e0fbae15ef3b8b40a",
      "created_at" : "2024-02-02T22:18:12Z",
      "diff_hunk" : "@@ -1482,8 +1545,8 @@ void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& b\n \n     // Scan block\n     for (size_t index = 0; index < block.data->vtx.size(); index++) {\n-        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n         transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK);\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1476798246",
      "id" : 1476798246,
      "in_reply_to_id" : 1384017154,
      "line" : 1544,
      "node_id" : "PRRC_kwDOABII585YBicm",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1544,
      "original_position" : 92,
      "original_start_line" : 1485,
      "path" : "src/wallet/wallet.cpp",
      "position" : 124,
      "pull_request_review_id" : 1860489670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476798246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1477,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-02-02T22:31:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1476798246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It seems to me like a more straightforward way to implement this feature would be to add a `bool mempool_conflicts` field to `TxStateInactive` rather than adding a new `TxStateMempoolConflicted` state. The description of `TxStateInactive` says \"May conflict with the mempool, or with an unknown block, or be abandoned, never broadcast, or rejected from the mempool for another reason.\" So the inactive state was meant to handle transactions that could have conflicts or be inactive for a variety of reasons.\r\n\r\nPersonally, I don't like how `TxStateInactive` is so broad. It's kind of a catch-all \"transaction is neither in a block nor in the mempool, and we don't know why\" (except for abandoned, and even then, I don't like how abandoned is a part of it and not a separate state). This PR introduces a distinct state of \"transaction currently has things in the mempool that conflict with it\" which is specific and we know the reason that something is not in the mempool, so I think it makes sense to be a separate state. I think it's more useful to carve out from `TxStateInactive` more specific states with reasons that we know for sure why something is in that state.",
      "created_at" : "2024-02-02T22:37:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1924814451",
      "id" : 1924814451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585yulZz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924814451/reactions"
      },
      "updated_at" : "2024-02-02T22:37:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924814451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Personally, I don't like how `TxStateInactive` is so broad. [...]\r\n\r\nSure, but then I'm pretty sure we need to add a `bool abandoned;` field to the `TxStateMempoolConflicted` struct so we don't lose track of whether the user has abandoned the transaction.\r\n\r\nAlternately, we could go more in the other direction, getting rid of the inactive catch-all and dividing TxStateInactive into 4 states:\r\n\r\n- TxStateAbandonedAndConflictsWithMempool\r\n- TxStateAbandonedAndProbablyDoesntConflictWithMempool\r\n- TxStateNotAbandonedAndConflictsWithMempool\r\n- TxStateNotAbandonedAndProbablyDoesntConflictWithMempool\r\n\r\nPersonally I think just keeping the `TxStateInactive` state with `bool abandoned; bool mempool_conflicts;` is better than subdividing it, because most wallet code should just need to consider whether transactions are active or not, without reverse-engineering the causes of transaction becoming inactive and making special cases out of them. But any of these approaches would be fine as long as we aren't losing track of whether a transaction is abandoned after a conflict is detected.",
      "created_at" : "2024-02-03T00:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1924946068",
      "id" : 1924946068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585yvFiU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924946068/reactions"
      },
      "updated_at" : "2024-02-03T01:00:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924946068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Personally, I don't like how `TxStateInactive` is so broad. [...]\r\n\r\nI will also add that I think adding a new top-level state instead of just adding a new field to TxStateInactive makes this PR considerably harder to review because you have to manually search for every line of code that is accessing the `m_state` field directly or indirectly and verify that it is either:\r\n\r\n1. Treating the TxStateInactive and TxStateMempoolConflicted states equivalently and not changing behavior\r\n2. Treating the TxStateInactive and TxStateMempoolConflicted states differently and changing behavior in a useful way.\r\n\r\nIf can avoid adding a new top-level state it would make this PR easier to review, because you could focus on the second case, and easily see where behavior is changing and not changing, which I don't think is possible with the current approach.\r\n\r\nThis is not a fundamental objection, but might be something to consider.",
      "created_at" : "2024-02-03T00:56:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1924962910",
      "id" : 1924962910,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585yvJpe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924962910/reactions"
      },
      "updated_at" : "2024-02-03T01:04:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924962910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Sure, but then I'm pretty sure we need to add a `bool abandoned;` field to the `TxStateMempoolConflicted` struct so we don't lose track of whether the user has abandoned the transaction.\r\n\r\nWe already lose track of that if a conflict is created and that conflict confirms. Abandoned is not a permanent state - as soon as it shows back up in the mempool, it'll no longer be abandoned. As soon as a conflict appears in a block, it'll no longer be abandoned. Likewise, if a transaction shows up in the mempool that conflicts with it, it should reflect that it is now conflicted and no longer needs to be marked as abandoned. Abandoned has always been a transient state since someone else could rebroadcast the transaction to the network. Once there's something else that makes the transaction invalid, I don't think it's useful to keep track of whether it is abandoned, so we wouldn't need to have more states to track that.",
      "created_at" : "2024-02-03T01:25:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1924998475",
      "id" : 1924998475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585yvSVL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924998475/reactions"
      },
      "updated_at" : "2024-02-03T01:25:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924998475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Abandoned is not a permanent state - as soon as it shows back up in the mempool, it'll no longer be abandoned.\r\n\r\nIt makes sense that a transaction in the mempool can't be treated as abandoned. But I don't see why the abandoned state be should be cleared just because a mempool heuristic happened to detect a conflict. That just seems like a bad UX and a confusion of two orthogonal concepts. The abandoned state is transient in the sense that it can be overriden by mempool events and block confirmations, but it should be less transient than the mempool conflicted state because it (1) reflects user intent and (2) is actually serialized to disk, so it doesn't seem to me something that should be thrown away unnecessarily.\r\n\r\nAlso, the PR description doesn't mention anything about discarding the abandoned state so this seems to me like an unintentional bug than a sensible design choice.\r\n\r\nI would just recommend adding the conflict tracking feature without adding a new top level state and without changing the behavior of abandoned transactions (especially unintentionally). It would shrink this PR, make it safer and easier to review, and provide all the benefits of the current implementation. IMO, if we really do want to change the transaction state diagram and add new top level states, I think it would be better to do in a separate PR not tied to adding a new tracking feature.",
      "created_at" : "2024-02-03T02:11:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1925021602",
      "id" : 1925021602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585yvX-i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1925021602/reactions"
      },
      "updated_at" : "2024-02-03T02:11:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1925021602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477695130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477695130"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have now added a test for descendants of conflicted transactions. ",
      "commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "created_at" : "2024-02-05T05:45:48Z",
      "diff_hunk" : "@@ -1386,6 +1385,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477695130",
      "id" : 1477695130,
      "in_reply_to_id" : 1337024969,
      "line" : 1426,
      "node_id" : "PRRC_kwDOABII585YE9aa",
      "original_commit_id" : "20d58f2554ba5cad1e6385a0f2d87b3750581442",
      "original_line" : 1426,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 1861928376,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477695130/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-05T05:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477695130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477697474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477697474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually, I have just added a test in this PR. ",
      "commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "created_at" : "2024-02-05T05:50:12Z",
      "diff_hunk" : "@@ -123,5 +130,165 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477697474",
      "id" : 1477697474,
      "in_reply_to_id" : 1471581755,
      "line" : 134,
      "node_id" : "PRRC_kwDOABII585YE9_C",
      "original_commit_id" : "71059cf4267d80d2934b85a7046fc7b64900378b",
      "original_line" : 134,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 26,
      "pull_request_review_id" : 1861931951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477697474/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-05T05:50:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477697474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477697683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477697683"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have added a comment indicating this.",
      "commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "created_at" : "2024-02-05T05:50:35Z",
      "diff_hunk" : "@@ -48,7 +48,12 @@ struct TxStateBlockConflicted {\n     int conflicting_block_height;\n \n     explicit TxStateBlockConflicted(const uint256& block_hash, int height) : conflicting_block_hash(block_hash), conflicting_block_height(height) {}\n-    std::string toString() const { return strprintf(\"Conflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+    std::string toString() const { return strprintf(\"BlockConflicted (block=%s, height=%i)\", conflicting_block_hash.ToString(), conflicting_block_height); }\n+};\n+\n+//! State of transaction with one or more mempool conflicts.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477697683",
      "id" : 1477697683,
      "in_reply_to_id" : 1472955815,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YE-CT",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 54,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1861932274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477697683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-05T05:50:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477697683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477699351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477699351"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point, this comment is from a previous version of the PR. I have fixed it. ",
      "commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "created_at" : "2024-02-05T05:53:59Z",
      "diff_hunk" : "@@ -1456,6 +1488,39 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                if (!wtx.mempool_conflicts.empty()) {\n+\n+                    // Remove the previously conflicting transaction from this wtx's entry\n+                    wtx.mempool_conflicts.erase(conflict_txid);\n+\n+                    if (wtx.mempool_conflicts.empty()) {\n+                        // If this wtx has no other mempool conflicts, erase this wtx entry",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477699351",
      "id" : 1477699351,
      "in_reply_to_id" : 1476797365,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YE-cX",
      "original_commit_id" : "5fbf18b89d6768bed1be95dcbc98797df5788dfc",
      "original_line" : 1511,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1861934996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477699351/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-05T05:53:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477699351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477700028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477700028"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should be fixed now. ",
      "commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "created_at" : "2024-02-05T05:55:07Z",
      "diff_hunk" : "@@ -1482,8 +1545,8 @@ void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& b\n \n     // Scan block\n     for (size_t index = 0; index < block.data->vtx.size(); index++) {\n-        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n         transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK);\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1477700028",
      "id" : 1477700028,
      "in_reply_to_id" : 1384017154,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YE-m8",
      "original_commit_id" : "28a7e883c2f9249213fddbe24948ec5bb90b0fad",
      "original_line" : 1543,
      "original_position" : 92,
      "original_start_line" : 1485,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1861935960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477700028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-02-05T05:55:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477700028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">  Is it still possible to abandon a transaction with conflicts with the mempool?\r\n\r\nYes, because of [this](https://github.com/bitcoin/bitcoin/pull/27307/commits/3de89342dcd44bdde4027a91cb27793dc0231847#diff-1f2db0e4d5c12d109c7f0962333c245b49b696cb39ff432da048e9d6c08944d8L1313-R1313) change. \r\n\r\n> If a transaction is already abandoned and we know it conflicts with the mempool does isMempoolConflicted still return false?\r\n\r\nYes\r\n\r\n> Sure, but then I'm pretty sure we need to add a bool abandoned; field to the TxStateMempoolConflicted struct so we don't lose track of whether the user has abandoned the transaction.\r\n\r\nIf the transaction has been abandoned, then it won't be marked as `TxStateMempoolConflicted` because of [these](https://github.com/bitcoin/bitcoin/pull/27307/commits/3de89342dcd44bdde4027a91cb27793dc0231847#diff-1f2db0e4d5c12d109c7f0962333c245b49b696cb39ff432da048e9d6c08944d8R1443-R1444) lines of code. Although the conflicting transactions are kept track of regardless, the actual transaction state only changes if the transaction is inactive (not abandoned).\r\n\r\n> I would just recommend adding the conflict tracking feature without adding a new top level state and without changing the behavior of abandoned transactions (especially unintentionally). It would shrink this PR, make it safer and easier to review, and provide all the benefits of the current implementation. IMO, if we really do want to change the transaction state diagram and add new top level states, I think it would be better to do in a separate PR not tied to adding a new tracking feature.\r\n\r\nFrom what I can tell, this PR is not changing the behavior of abandoned transactions. That being said, if anybody still thinks that `TxStateMempoolConflicted` should be removed in favor of just adding a boolean to `TxStateInactive`, I would be willing to implement that. I just think that `TxStateMempoolConflicted` makes more of a transition towards having more specific transaction states, which seems to be something we want. ",
      "created_at" : "2024-02-05T07:08:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1926350798",
      "id" : 1926350798,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585y0cfO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1926350798/reactions"
      },
      "updated_at" : "2024-02-05T07:08:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1926350798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "created_at" : "2024-02-06T22:18:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1930854540",
      "id" : 1930854540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585zFoCM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1930854540/reactions"
      },
      "updated_at" : "2024-02-06T22:18:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1930854540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481573074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481573074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 86aaf81f8:\r\n\r\nIf you touch this again; could pull `mit->second` into its own variable to improve readability.\r\n\r\n```c++\r\nconst auto& wtx = mit->second;\r\n// An output is considered spent by a spending transaction,\r\n// unless the spending transaction is conflicted or abandoned.\r\nif (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned()))\r\n    return true;\r\n```",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-07T14:36:43Z",
      "diff_hunk" : "@@ -752,8 +752,9 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // An output is considered spent if a spending transaction\n+            // is either confirmed, or in the mempool, or inactive (but not abandoned)\n+            if (mit->second.isConfirmed() || mit->second.InMempool() || (mit->second.isInactive() && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481573074",
      "id" : 1481573074,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YTwLS",
      "original_commit_id" : "86aaf81f81b48e82358db6700a6c9d46c5b5b0df",
      "original_line" : 757,
      "original_position" : 8,
      "original_start_line" : 754,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1867972899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481573074/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-07T15:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481573074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481600177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481600177"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be good to explain that you are doing the `mapWallet` lookup because the wtx could have been updated. Because otherwise, this could just be a `if (_it->second == conflict_txid) continue;` right?.\r\n\r\nAlso, as you already know that the output belongs to one of the wallet's txs, could:\r\n```c++\r\nCWalletTx& wtx = mapWallet.at(_it->second);\r\nif (wtx.tx->GetWitnessHash() == conflict_wtxid) continue;\r\n```",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-07T14:54:21Z",
      "diff_hunk" : "@@ -1419,6 +1419,38 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+    const Wtxid& conflict_wtxid = tx->GetWitnessHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            auto it = mapWallet.find(_it->second);\n+            if (it->second.tx->GetWitnessHash() == conflict_wtxid) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481600177",
      "id" : 1481600177,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YT2yx",
      "original_commit_id" : "3de89342dcd44bdde4027a91cb27793dc0231847",
      "original_line" : 1437,
      "original_position" : 28,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1867972899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481600177/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-07T15:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481600177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481609541"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481609541"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can remove the initial `wtx.mempool_conflicts.empty()` call and directly call `erase`.\r\n\r\n```c++\r\nauto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\r\n    // Remove the previously conflicting transaction from this wtx's entry\r\n    wtx.mempool_conflicts.erase(conflict_txid);\r\n    if (wtx.mempool_conflicts.empty()) {\r\n        // If this wtx has no other mempool conflicts, it is now considered inactive\r\n        if (wtx.isMempoolConflicted()) {\r\n            wtx.m_state = TxStateInactive{};\r\n            return TxUpdate::CHANGED;\r\n        }\r\n    }\r\n    return TxUpdate::UNCHANGED;\r\n};\r\n```",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-07T15:00:10Z",
      "diff_hunk" : "@@ -1456,6 +1488,39 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                if (!wtx.mempool_conflicts.empty()) {\n+\n+                    // Remove the previously conflicting transaction from this wtx's entry\n+                    wtx.mempool_conflicts.erase(conflict_txid);\n+\n+                    if (wtx.mempool_conflicts.empty()) {\n+                        // If this wtx has no other mempool conflicts, it is now considered inactive\n+                        if (wtx.isMempoolConflicted()) {\n+                            wtx.m_state = TxStateInactive{};\n+                            return TxUpdate::CHANGED;\n+                        }\n+                    }\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481609541",
      "id" : 1481609541,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YT5FF",
      "original_commit_id" : "3de89342dcd44bdde4027a91cb27793dc0231847",
      "original_line" : 1514,
      "original_position" : 78,
      "original_start_line" : 1504,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1867972899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481609541/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-07T15:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481609541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481616345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481616345"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could document why it has been replaced here. It is not immediately evident only by reading the code.",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-07T15:04:31Z",
      "diff_hunk" : "@@ -123,5 +131,253 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)\n+        assert all([tx[\"amount\"] == 25 for tx in unspents])\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1_txid = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent(), [unspents[2]])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2_txid = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent(), [unspents[0]])\n+        assert_equal(alice.getbalance(), 25)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481616345",
      "id" : 1481616345,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YT6vZ",
      "original_commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "original_line" : 179,
      "original_position" : 59,
      "original_start_line" : 165,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1867972899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481616345/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-07T15:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481616345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481621542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481621542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be good to document the behavior inside the code. It is not immediately evident only by reading the code.",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-07T15:08:04Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481621542",
      "id" : 1481621542,
      "in_reply_to_id" : 1388532260,
      "line" : 195,
      "node_id" : "PRRC_kwDOABII585YT8Am",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 195,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 87,
      "pull_request_review_id" : 1867972899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481621542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T15:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481621542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481627720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481627720"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be good to document why you are doing this. I guess that you are cleaning up the mempool and wallet for the next test?",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-07T15:12:10Z",
      "diff_hunk" : "@@ -123,5 +131,253 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)\n+        assert all([tx[\"amount\"] == 25 for tx in unspents])\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1_txid = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent(), [unspents[2]])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2_txid = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent(), [unspents[0]])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [tx2_txid])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [])\n+        assert tx1_txid not in self.nodes[0].getrawmempool()\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        bob.sendall([self.nodes[2].getnewaddress()])\n+        self.generate(self.nodes[2], 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1481627720",
      "id" : 1481627720,
      "line" : 204,
      "node_id" : "PRRC_kwDOABII585YT9hI",
      "original_commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "original_line" : 204,
      "original_position" : 75,
      "original_start_line" : 182,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 96,
      "pull_request_review_id" : 1867972899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481627720/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 203,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-07T15:14:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481627720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21385308940</sub>",
      "created_at" : "2024-02-09T03:30:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1935283402",
      "id" : 1935283402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585zWhTK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935283402/reactions"
      },
      "updated_at" : "2024-02-09T03:30:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935283402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1926350798\r\n\r\nThanks ishaanam for pointing out the lines of code that answer my questions. Since original links got broken in rebase, here are stable links that point to the two lines of code which prioritize the abandoned state over the conflicted state:\r\n\r\n- https://github.com/bitcoin/bitcoin/commit/3de89342dcd44bdde4027a91cb27793dc0231847#diff-1f2db0e4d5c12d109c7f0962333c245b49b696cb39ff432da048e9d6c08944d8L1313-R1313\r\n- https://github.com/bitcoin/bitcoin/commit/3de89342dcd44bdde4027a91cb27793dc0231847#diff-1f2db0e4d5c12d109c7f0962333c245b49b696cb39ff432da048e9d6c08944d8R1443-R1444\r\n\r\nThis is better than what I was afraid of, since the abandoned state consistently takes priority over the mempoolconflicted state. But this behavior is fragile and unnecessarily complicates our internal model and potential RPC and GUI interfaces, because there's no logical reason for the abandoned and mempool conflicted states to contradict each other, when both can be true at the same time.\r\n\r\nIf we take the current approach in 3471ebc8c6ee268ad501525121ea3f3a221fb5ad, we will have to be careful going forward, whenever we do any state change, to remember that the abandoned state is supposed to take priority over the mempool conflicted state (this is not even documented anywhere), and decide how we want to deal with potentially odd states like `mempool_conflicts` set being nonempty when the transaction is not in the `MempoolConflicted` state.\r\n\r\nFor background, I already think it's bad that abandoned and block-conflicted states exclude each other, and that the block conflicted state takes priority over the abandoned state and resets it. But the block conflicted state is pretty permanent, so it's basically just a UI quirk if a block conflict causes the abandoned state to be forgotten about. There are also backwards compatibility benefits to storing the block conflict and abandoned bit exclusively in the same field.\r\n\r\nIn the current case, though, there are no backwards compatibility concerns, so it seems wrong and unnecessary to go out our way to create an unenforced, undocumented, and confusing hierarchy of states: _MempoolConflicted < Abandoned < BlockConflicted_, when there is a simpler alternative of just straightforwardly representing the information we have about transactions directly.\r\n\r\nIt seems pretty clear to me that it would make this change simpler, safer and easier to review, make the code more straightforward and maintainable long term, and avoid potential bugs and confusion in the UI if it just represented abandoned and mempool conflicted states independently and didn't try to establish a hierarchy between them.\r\n\r\nI think a good approach would avoid adding a `TxStateMempoolConflicted` top-level state, and just add a `bool mempool_conflicts` or `std::set<Txid> mempool_conflicts` member to the `TxStateInactive` struct. And it is good to rename `TxStateConflicted` to `TxStateBlockConflicted` too for clarity. If you're skeptical of this approach, I'd be curious to know why, but we can also experiment in a separate PR if you are concerned there are benefits in this PR which would be lost.\r\n\r\nIf it would be helpful, I could make another PR next week to compare the two approaches. But I'd be curious to know what you think. There is a lot of a complexity and a long history of bugs in wallet transaction state tracking (https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking) so I think think it is worth taking a little more time to get this right.",
      "created_at" : "2024-02-09T17:21:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1936304636",
      "id" : 1936304636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585zaan8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936304636/reactions"
      },
      "updated_at" : "2024-02-09T17:21:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936304636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484624000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484624000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T17:39:57Z",
      "diff_hunk" : "@@ -752,8 +752,9 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // An output is considered spent if a spending transaction\n+            // is either confirmed, or in the mempool, or inactive (but not abandoned)\n+            if (mit->second.isConfirmed() || mit->second.InMempool() || (mit->second.isInactive() && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484624000",
      "id" : 1484624000,
      "in_reply_to_id" : 1481573074,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfZCA",
      "original_commit_id" : "86aaf81f81b48e82358db6700a6c9d46c5b5b0df",
      "original_line" : 757,
      "original_position" : 8,
      "original_start_line" : 754,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1872905623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484624000/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484624000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484625047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484625047"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I've added a comment for that.",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T17:40:54Z",
      "diff_hunk" : "@@ -123,5 +131,253 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)\n+        assert all([tx[\"amount\"] == 25 for tx in unspents])\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1_txid = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent(), [unspents[2]])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2_txid = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent(), [unspents[0]])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [tx2_txid])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1_txid)[\"mempoolconflicts\"], [])\n+        assert tx1_txid not in self.nodes[0].getrawmempool()\n+\n+        # now all of alice's outputs should be considered spent\n+        assert_equal(alice.listunspent(), [])\n+        assert_equal(alice.getbalance(), 0)\n+\n+        bob.sendall([self.nodes[2].getnewaddress()])\n+        self.generate(self.nodes[2], 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484625047",
      "id" : 1484625047,
      "in_reply_to_id" : 1481627720,
      "line" : 204,
      "node_id" : "PRRC_kwDOABII585YfZSX",
      "original_commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "original_line" : 204,
      "original_position" : 75,
      "original_start_line" : 182,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 96,
      "pull_request_review_id" : 1872907037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484625047/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 203,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484625047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484626857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484626857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have added a lot more comments to the test which should clarify this. ",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T17:42:50Z",
      "diff_hunk" : "@@ -123,5 +131,253 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        bob = self.nodes[1]\n+\n+        self.nodes[2].send(outputs=[{alice.getnewaddress() : 25} for _ in range(3)])\n+        self.generate(self.nodes[2], 1)\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = alice.listunspent()\n+        assert_equal(len(unspents), 3)\n+        assert all([tx[\"amount\"] == 25 for tx in unspents])\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1_txid = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent(), [unspents[2]])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2_txid = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent(), [unspents[0]])\n+        assert_equal(alice.getbalance(), 25)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484626857",
      "id" : 1484626857,
      "in_reply_to_id" : 1481616345,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfZup",
      "original_commit_id" : "600fc562f815941b4a95c9f4f357dc6eed04be6c",
      "original_line" : 179,
      "original_position" : 59,
      "original_start_line" : 165,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1872909954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484626857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:42:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484626857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484632206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484632206"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have added a comment before all of the tests in this file explaining how these tests create conflicts. ",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T17:48:12Z",
      "diff_hunk" : "@@ -123,5 +129,148 @@ def run_test(self):\n         assert_equal(former_conflicted[\"confirmations\"], 1)\n         assert_equal(former_conflicted[\"blockheight\"], 217)\n \n+    def test_mempool_conflict(self):\n+        self.nodes[0].createwallet(\"alice\")\n+        alice = self.nodes[0].get_wallet_rpc(\"alice\")\n+\n+        self.nodes[1].createwallet(\"bob\")\n+        bob = self.nodes[1].get_wallet_rpc(\"bob\")\n+\n+        self.generatetoaddress(self.nodes[0], COINBASE_MATURITY + 3, alice.getnewaddress())\n+\n+        self.log.info(\"Test a scenario where a transaction has a mempool conflict\")\n+\n+        unspents = [{\"txid\" : element[\"txid\"], \"vout\" : element[\"vout\"]} for element in alice.listunspent()]\n+        assert_equal(len(unspents), 3)\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[0], unspents[1]], outputs=[{bob.getnewaddress() : 49.9999}])\n+        tx1 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[1], unspents[2]], outputs=[{bob.getnewaddress() : 49.99}])\n+        tx2 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        raw_tx = alice.createrawtransaction(inputs=[unspents[2]], outputs=[{bob.getnewaddress() : 24.9899}])\n+        tx3 = alice.signrawtransactionwithwallet(raw_tx)['hex']\n+\n+        tx1 = alice.sendrawtransaction(tx1)\n+\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[2][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        tx2 = alice.sendrawtransaction(tx2)\n+\n+        # Check that the 0th unspent is now available because the transaction spending it has been replaced in the mempool\n+        assert_equal(alice.listunspent()[0][\"txid\"], unspents[0][\"txid\"])\n+        assert_equal(alice.getbalance(), 25)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [tx2])\n+\n+        self.log.info(\"Test scenario where a mempool conflict is removed\")\n+\n+        tx3 = alice.sendrawtransaction(tx3)\n+\n+        assert_equal(alice.gettransaction(tx1)[\"mempoolconflicts\"], [])\n+\n+        # now all of alice's outputs should be considered spent",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484632206",
      "id" : 1484632206,
      "in_reply_to_id" : 1388532260,
      "line" : 195,
      "node_id" : "PRRC_kwDOABII585YfbCO",
      "original_commit_id" : "003efbbe45079c4416810a025b2bc372559dff15",
      "original_line" : 195,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 87,
      "pull_request_review_id" : 1872917636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484632206/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:48:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484632206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484632803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484632803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T17:48:49Z",
      "diff_hunk" : "@@ -1456,6 +1488,39 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                if (!wtx.mempool_conflicts.empty()) {\n+\n+                    // Remove the previously conflicting transaction from this wtx's entry\n+                    wtx.mempool_conflicts.erase(conflict_txid);\n+\n+                    if (wtx.mempool_conflicts.empty()) {\n+                        // If this wtx has no other mempool conflicts, it is now considered inactive\n+                        if (wtx.isMempoolConflicted()) {\n+                            wtx.m_state = TxStateInactive{};\n+                            return TxUpdate::CHANGED;\n+                        }\n+                    }\n+                }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484632803",
      "id" : 1484632803,
      "in_reply_to_id" : 1481609541,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfbLj",
      "original_commit_id" : "3de89342dcd44bdde4027a91cb27793dc0231847",
      "original_line" : 1514,
      "original_position" : 78,
      "original_start_line" : 1504,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1872918612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484632803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T17:48:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484632803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484797295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484797295"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Would be good to explain that you are doing the mapWallet lookup because the wtx could have been updated.\r\n\r\nI just realized that the wtx could not have been updated, because for it to be updated, `transactionAddedToMempool` would need to be called, which would be after this call, right? So I have reverted the change which compares witness hashes. \r\n\r\n> Also, as you already know that the output belongs to one of the wallet's txs, could:\r\n\r\nYes, I have implemented this. ",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T20:59:35Z",
      "diff_hunk" : "@@ -1419,6 +1419,38 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+    const Wtxid& conflict_wtxid = tx->GetWitnessHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            auto it = mapWallet.find(_it->second);\n+            if (it->second.tx->GetWitnessHash() == conflict_wtxid) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484797295",
      "id" : 1484797295,
      "in_reply_to_id" : 1481600177,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YgDVv",
      "original_commit_id" : "3de89342dcd44bdde4027a91cb27793dc0231847",
      "original_line" : 1437,
      "original_position" : 28,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1873186730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484797295/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T20:59:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484797295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484800862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484800862"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> If we get the same txid but different wtxid, I'm not sure that the result is necessarily one that makes sense. Most things in the wallet are keyed and listed by txid, so with this change, we'd end up with a transaction that's listed as conflicted by it's own txid. Also, we won't ever update the wallet to store a transaction with a different wtxid.\r\n\r\nSorry I didn't see this earlier. After looking at this again I don't think that same-txid-different-witness will be a problem here. Please see: https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484797295",
      "commit_id" : "09bc2699dfa3170317d09478ce6a3e717cd06028",
      "created_at" : "2024-02-09T21:04:36Z",
      "diff_hunk" : "@@ -1419,6 +1419,36 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const uint256& conflict_hash = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            if (_it->second == conflict_hash) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1484800862",
      "id" : 1484800862,
      "in_reply_to_id" : 1471531989,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YgENe",
      "original_commit_id" : "a6ae5b23b1497ab6f4899db49348db623700a2d8",
      "original_line" : 1435,
      "original_position" : 26,
      "original_start_line" : 1434,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1873192440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484800862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T21:04:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484800862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think a good approach would avoid adding a TxStateMempoolConflicted top-level state, and just add a bool mempool_conflicts or std::set<Txid> mempool_conflicts member to the TxStateInactive struct.\r\n\r\nThanks for your feedback, I have implemented this. ",
      "created_at" : "2024-02-11T05:19:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1937431126",
      "id" : 1937431126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585zetpW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1937431126/reactions"
      },
      "updated_at" : "2024-02-11T05:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1937431126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491412469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491412469"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"scripted-diff: wallet: s/TxStateConflicted/TxStateBlockConflicted\" (df0130d73341bb2784b23cd2e8307f30da09ca37)\r\n\r\nNot very important, but I think it would be good if this scripted-diff commit renamed `CWalletTx::isConflicted` to `isBlockConflicted` up front, so `isConflicted` could be added as a new method later without affecting existing callers. Otherwise it takes extra effort for reviewers to look up all the existing callers of isConflicted recursively and making sure their behavior is not changing unintentionally.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T18:01:25Z",
      "diff_hunk" : "@@ -335,7 +335,7 @@ class CWalletTx\n     void updateState(interfaces::Chain& chain);\n \n     bool isAbandoned() const { return state<TxStateInactive>() && state<TxStateInactive>()->abandoned; }\n-    bool isConflicted() const { return state<TxStateConflicted>(); }\n+    bool isConflicted() const { return state<TxStateBlockConflicted>(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491412469",
      "id" : 1491412469,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5SX1",
      "original_commit_id" : "df0130d73341bb2784b23cd2e8307f30da09ca37",
      "original_line" : 338,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491412469/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491412469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491434583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491434583"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: use CWalletTx member functions to determine tx state\" (523a48b7180409970cec286f0aef6afbbacd2ffa)\r\n\r\nThis code comment is just repeating the boolean expression below without explaining it. Would suggest a comment explaining what it is trying to do like \"An output is considered spent by a spending transaction unless the spending transaction is conflicted or abandoned. The check below is written conservatively to check for the inverse condition and only consider spending transactions in known, potentially active states.\"\r\n\r\n(Made a similar suggestion earlier https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1472930692)",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T18:22:04Z",
      "diff_hunk" : "@@ -752,8 +752,10 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // An output is considered spent if a spending transaction\n+            // is either confirmed, or in the mempool, or inactive (but not abandoned)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491434583",
      "id" : 1491434583,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5XxX",
      "original_commit_id" : "523a48b7180409970cec286f0aef6afbbacd2ffa",
      "original_line" : 756,
      "original_position" : 7,
      "original_start_line" : 755,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491434583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-16T01:49:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491434583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491442105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491442105"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nWould suggest expanding comment to something like: \"Set of mempool transactions that conflict directly with the tx or an ancestor transaction. This set will be empty if the transaction is confirmed, but can be nonempty in other states.\"\r\n\r\nI was initially surprised to see that this set was populated not just for inactive transactions, but also for block-conflicted transactions, so think it is worth mentioning the relationship to the transaction state.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T18:28:50Z",
      "diff_hunk" : "@@ -258,6 +262,10 @@ class CWalletTx\n     CTransactionRef tx;\n     TxState m_state;\n \n+    // Transactions that conflict directly with the tx, or\n+    // that conflict with an ancestor transaction\n+    std::set<Txid> mempool_conflicts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491442105",
      "id" : 1491442105,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII585Y5Zm5",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 266,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 61,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491442105/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491442105",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491449136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491449136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nI was surprised to see this change, since I thought intent of the preceding commit was to preserve current behavior and consider spending transactions active even they conflicted with mempool transactions. Both approaches seem ok, but if this behavior is intended, it seems like it would be simpler to write this condition as:\r\n\r\n```c++\r\nif (!wtx.IsAbandoned() && !wtx.isConflicted()) {\r\n    return true; // spent\r\n}\r\n```",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T18:35:31Z",
      "diff_hunk" : "@@ -755,7 +755,7 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n             // An output is considered spent if a spending transaction\n             // is either confirmed, or in the mempool, or inactive (but not abandoned)\n             const auto& wtx = mit->second;\n-            if (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned()))\n+            if (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned() && !wtx.isMempoolConflicted()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491449136",
      "id" : 1491449136,
      "line" : 761,
      "node_id" : "PRRC_kwDOABII585Y5bUw",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 761,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 12,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491449136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491449136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491468929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491468929"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nNote: effects of changing this definition seem to be:\r\n\r\n- `CachedTxIsTrusted` is changed, so if a mempool conflict with a transaction is detected, the transaction will no longer be trusted, and its outputs will show up in the unconfirmed balance and no longer be spent from.\r\n- `isUnconfirmed` is changed, so `ResubmitWalletTransactions` is changed, so if a mempool conflict with a transaction is detected, the wallet will not attempt to rebroadcast it.\r\n\r\nWould be good to mention these behavior changes and any others in the commit message. Also, if isConflicted were renamed to isBlockConflicted in the first commit, and then introduced as a new function here, these changes would be a lot more obvious because the relevant code would have visible diffs here.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T18:51:50Z",
      "diff_hunk" : "@@ -335,7 +343,9 @@ class CWalletTx\n     void updateState(interfaces::Chain& chain);\n \n     bool isAbandoned() const { return state<TxStateInactive>() && state<TxStateInactive>()->abandoned; }\n-    bool isConflicted() const { return state<TxStateBlockConflicted>(); }\n+    bool isConflicted() const { return isBlockConflicted() || isMempoolConflicted(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491468929",
      "id" : 1491468929,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5gKB",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 345,
      "original_position" : 41,
      "original_start_line" : 338,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491468929/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491468929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491512496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491512496"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nIt doesn't seem actually seem useful to add this `TxStateInactive::mempool_conflicted` member, so would suggest dropping it and changing definition of `isMempoolConflicted()` to just return `!mempool_conflicts.empty()`.\r\n\r\nWhen I made earlier suggestion to add this member in https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1936304636 I didn't dig into the relationship between the mempool conflicted state and `mempool_conflicts` variable, so I thought it might be needed to keep both, but it looks like `mempool_conflicted` is entirely redundant, so it would be confusing to have separate `mempool_conflicts` and `mempool_conflicted` variables for no reason.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T19:22:30Z",
      "diff_hunk" : "@@ -57,9 +57,13 @@ struct TxStateBlockConflicted {\n //! reason.\n struct TxStateInactive {\n     bool abandoned;\n+    bool mempool_conflicted;\n \n-    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n-    std::string toString() const { return strprintf(\"Inactive (abandoned=%i)\", abandoned); }\n+    explicit TxStateInactive(bool abandoned = false, bool mempool_conflicted = false)\n+      : abandoned(abandoned),\n+        mempool_conflicted(mempool_conflicted)\n+        {}\n+    std::string toString() const { return strprintf(\"Inactive (abandoned=%i, mempool_conflicted=%i)\", abandoned, mempool_conflicted); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491512496",
      "id" : 1491512496,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5qyw",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 66,
      "original_position" : 21,
      "original_start_line" : 64,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491512496/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491512496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491562385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491562385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nSeems like a minor bug here. If this returns `TxUpdate::UNCHANGED` it means RecursiveUpdateTxState will stop recursing, so the parent transaction will have its `mempool_conflicts` list updated, but its descendants will not.\r\n\r\nIn practice, this should be a minor bug because the only time `TxUpdate::UNCHANGED` is actually returned here is when the transaction is in `BlockConflicted` state, and it shouldn't be a big deal if mempool conflicts for child transactions aren't added when we already know there is a block conflict. But it would be better to track mempool conflicts consistently, not just at the top level in this case.\r\n\r\nTaken with above suggestion do drop the `mempool_conflicted` variable, it seems like it would make sense to replace this logic with just:\r\n\r\n```c++\r\nauto inserted = wtx.mempool_conflicts.insert(conflict_txid);\r\nif (inserted == wtx.mempool_conflicts.end()) TxUpdate::UNCHANGED;\r\nreturn TxUpdate::CHANGED;\r\n```",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T19:49:55Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Add this conflict to the wtx's entry (create one if one does not already exist)\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                if (wtx.isInactive()) {\n+                    wtx.m_state = TxStateInactive{wtx.isAbandoned(), /*mempool_conflicted=*/ true};\n+                    return TxUpdate::CHANGED;\n+                } else {\n+                    return TxUpdate::UNCHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491562385",
      "id" : 1491562385,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y52-R",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1447,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491562385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491562385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491576720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491576720"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nIt seems wasteful and potentially slow to use RecursiveUpdateTxState in its current form because it will be calling WalletBatch::WriteTx for these transactions and updating the database even though the transaction data will not be changing.\r\n\r\nWould suggest fixing this by adding a `CWallet::RecursiveUpdateTxState` overload that takes a `WalletBatch*` parameter and does not call `WriteTx` when it is null. E.g.:\r\n\r\n```c++\r\nvoid CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const TryUpdatingStateFn& try_updating_state)\r\n{\r\n    WalletBatch batch(GetDatabase(), false);\r\n    RecursiveUpdateTxState(&batch, tx_hash, try_updating_state);\r\n}\r\n\r\nvoid CWallet::RecursiveUpdateTxState(WalletBatch* batch, const uint256& tx_hash, const TryUpdatingStateFn& try_updating_state)\r\n{\r\n    // ...\r\n    if (batch) batch->WriteTx(wtx);\r\n    // ...\r\n}\r\n```\r\n",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T19:56:29Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Add this conflict to the wtx's entry (create one if one does not already exist)\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                if (wtx.isInactive()) {\n+                    wtx.m_state = TxStateInactive{wtx.isAbandoned(), /*mempool_conflicted=*/ true};\n+                    return TxUpdate::CHANGED;\n+                } else {\n+                    return TxUpdate::UNCHANGED;\n+                }\n+            };\n+\n+            RecursiveUpdateTxState(_it->second, try_updating_state);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491576720",
      "id" : 1491576720,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y56eQ",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1451,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491576720/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491576720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491586915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491586915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nCan drop this code if `TxStateInactive::mempool_conflicted` member is dropped as suggested above.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T20:03:43Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Add this conflict to the wtx's entry (create one if one does not already exist)\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                if (wtx.isInactive()) {\n+                    wtx.m_state = TxStateInactive{wtx.isAbandoned(), /*mempool_conflicted=*/ true};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491586915",
      "id" : 1491586915,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y589j",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1444,
      "original_position" : 43,
      "original_start_line" : 1443,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491586915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491586915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491593170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491593170"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nThis has the same problems as the new transactionAddedToMempool code above. Would suggest avoiding the need for state transitions, and always updating the mempool_conflicts set recursively for BlockConflicted as well as Inactive transactions:\r\n\r\n```c++\r\nif (!wtx.mempool_conflicts.erase(conflict_txid)) return TxUpdate::UNCHANGED;\r\nreturn TxUpdate::CHANGED;\r\n```\r\n\r\n",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T20:07:39Z",
      "diff_hunk" : "@@ -1457,6 +1488,36 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Remove the previously conflicting transaction from this wtx's entry\n+                wtx.mempool_conflicts.erase(conflict_txid);\n+\n+                if (wtx.mempool_conflicts.empty()) {\n+                    // If this wtx has no other mempool conflicts, it is now considered inactive\n+                    if (wtx.isMempoolConflicted()) {\n+                        wtx.m_state = TxStateInactive{};\n+                        return TxUpdate::CHANGED;\n+                    }\n+                }\n+                return TxUpdate::UNCHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491593170",
      "id" : 1491593170,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5-fS",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1501,
      "original_position" : 84,
      "original_start_line" : 1506,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491593170/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491593170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491596687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491596687"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nJust IMO, but\r\n\r\n```c++\r\nauto range =  mapTxSpends.equal_range(tx_in.prevout);\r\nfor (auto it = range.first; it != range.second; ++it)\r\n```\r\n\r\nwould make core more readable, dropping the long type declarations and extra underscore. But feel free to keep current style if that is your preference.\r\n",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T20:10:13Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491596687",
      "id" : 1491596687,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5_WP",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1434,
      "original_position" : 33,
      "original_start_line" : 1427,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491596687/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491596687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491599010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491599010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (2c867784b2a719c9e701e19e389c3adfa7d7faae)\r\n\r\nThere's no reason for this line. If the count is 0, equal_range will return an empty range and the result will be the same.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T20:12:47Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491599010",
      "id" : 1491599010,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y5_6i",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1428,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491599010/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491599010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491620312"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491620312"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"test: Add tests for wallet mempool conflicts\" (c891a65067f57ba87e443d0cdc4f7e6b434c436f)\r\n\r\nIgnore this suggestion if it requires too much work, but IMO it would be really helpful for review if as much of the new test code as possible was added in the first commit before the C++ code changes, and the tests were updated alongside the code changes in subsequent commits.\r\n\r\nIndependently of this PR, the fact that a commit like 2c867784b2a719c9e701e19e389c3adfa7d7faae can make a number of behavior changes and not need any significant test updates shows that we are lacking a lot of test coverage for these code paths presently. So it would be very reassuring to add the test coverage before making the changes and see the changes having the expected effects on tests, instead of making the changes blindly and adding the test coverage later.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-15T20:22:46Z",
      "diff_hunk" : "@@ -28,6 +29,20 @@ def get_utxo_of_value(self, from_tx_id, search_value):\n         return next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(from_tx_id)[\"details\"] if tx_out[\"amount\"] == Decimal(f\"{search_value}\"))\n \n     def run_test(self):\n+        \"\"\"\n+        The following tests check the behavior of the wallet when",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1491620312",
      "id" : 1491620312,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII585Y6FHY",
      "original_commit_id" : "c891a65067f57ba87e443d0cdc4f7e6b434c436f",
      "original_line" : 33,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 13,
      "pull_request_review_id" : 1883484751,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491620312/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491620312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500031766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500031766"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:48:21Z",
      "diff_hunk" : "@@ -335,7 +335,7 @@ class CWalletTx\n     void updateState(interfaces::Chain& chain);\n \n     bool isAbandoned() const { return state<TxStateInactive>() && state<TxStateInactive>()->abandoned; }\n-    bool isConflicted() const { return state<TxStateConflicted>(); }\n+    bool isConflicted() const { return state<TxStateBlockConflicted>(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500031766",
      "id" : 1500031766,
      "in_reply_to_id" : 1491412469,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaKsW",
      "original_commit_id" : "df0130d73341bb2784b23cd2e8307f30da09ca37",
      "original_line" : 338,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1897110668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500031766/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:48:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500031766",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500031926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500031926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:48:37Z",
      "diff_hunk" : "@@ -752,8 +752,10 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n         const uint256& wtxid = it->second;\n         const auto mit = mapWallet.find(wtxid);\n         if (mit != mapWallet.end()) {\n-            int depth = GetTxDepthInMainChain(mit->second);\n-            if (depth > 0  || (depth == 0 && !mit->second.isAbandoned()))\n+            // An output is considered spent if a spending transaction\n+            // is either confirmed, or in the mempool, or inactive (but not abandoned)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500031926",
      "id" : 1500031926,
      "in_reply_to_id" : 1491434583,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaKu2",
      "original_commit_id" : "523a48b7180409970cec286f0aef6afbbacd2ffa",
      "original_line" : 756,
      "original_position" : 7,
      "original_start_line" : 755,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897110912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500031926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:48:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500031926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500032073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500032073"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:48:48Z",
      "diff_hunk" : "@@ -258,6 +262,10 @@ class CWalletTx\n     CTransactionRef tx;\n     TxState m_state;\n \n+    // Transactions that conflict directly with the tx, or\n+    // that conflict with an ancestor transaction\n+    std::set<Txid> mempool_conflicts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500032073",
      "id" : 1500032073,
      "in_reply_to_id" : 1491442105,
      "line" : 266,
      "node_id" : "PRRC_kwDOABII585ZaKxJ",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 266,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/transaction.h",
      "position" : 61,
      "pull_request_review_id" : 1897111147,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500032073/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:48:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500032073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500032885"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500032885"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The preceding was more of a refactor, while this commit aims to have `IsSpent` return false for txos spent by mempool-conflicted transactions. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:49:57Z",
      "diff_hunk" : "@@ -755,7 +755,7 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n             // An output is considered spent if a spending transaction\n             // is either confirmed, or in the mempool, or inactive (but not abandoned)\n             const auto& wtx = mit->second;\n-            if (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned()))\n+            if (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned() && !wtx.isMempoolConflicted()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500032885",
      "id" : 1500032885,
      "in_reply_to_id" : 1491449136,
      "line" : 761,
      "node_id" : "PRRC_kwDOABII585ZaK91",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 761,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 12,
      "pull_request_review_id" : 1897112449,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500032885/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:49:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500032885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500033137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033137"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have updated the commit message. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:50:18Z",
      "diff_hunk" : "@@ -335,7 +343,9 @@ class CWalletTx\n     void updateState(interfaces::Chain& chain);\n \n     bool isAbandoned() const { return state<TxStateInactive>() && state<TxStateInactive>()->abandoned; }\n-    bool isConflicted() const { return state<TxStateBlockConflicted>(); }\n+    bool isConflicted() const { return isBlockConflicted() || isMempoolConflicted(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500033137",
      "id" : 1500033137,
      "in_reply_to_id" : 1491468929,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLBx",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 345,
      "original_position" : 41,
      "original_start_line" : 338,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1897112814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033137/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:50:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033137",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500033473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033473"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have removed the `mempool_conflicted` variable. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:50:50Z",
      "diff_hunk" : "@@ -57,9 +57,13 @@ struct TxStateBlockConflicted {\n //! reason.\n struct TxStateInactive {\n     bool abandoned;\n+    bool mempool_conflicted;\n \n-    explicit TxStateInactive(bool abandoned = false) : abandoned(abandoned) {}\n-    std::string toString() const { return strprintf(\"Inactive (abandoned=%i)\", abandoned); }\n+    explicit TxStateInactive(bool abandoned = false, bool mempool_conflicted = false)\n+      : abandoned(abandoned),\n+        mempool_conflicted(mempool_conflicted)\n+        {}\n+    std::string toString() const { return strprintf(\"Inactive (abandoned=%i, mempool_conflicted=%i)\", abandoned, mempool_conflicted); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500033473",
      "id" : 1500033473,
      "in_reply_to_id" : 1491512496,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLHB",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 66,
      "original_position" : 21,
      "original_start_line" : 64,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1897113356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033473/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:50:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500033983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033983"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point, this bug should be fixed now. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:51:24Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Add this conflict to the wtx's entry (create one if one does not already exist)\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                if (wtx.isInactive()) {\n+                    wtx.m_state = TxStateInactive{wtx.isAbandoned(), /*mempool_conflicted=*/ true};\n+                    return TxUpdate::CHANGED;\n+                } else {\n+                    return TxUpdate::UNCHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500033983",
      "id" : 1500033983,
      "in_reply_to_id" : 1491562385,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLO_",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1447,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897114188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033983/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:51:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500033983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500034212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034212"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:51:44Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Add this conflict to the wtx's entry (create one if one does not already exist)\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                if (wtx.isInactive()) {\n+                    wtx.m_state = TxStateInactive{wtx.isAbandoned(), /*mempool_conflicted=*/ true};\n+                    return TxUpdate::CHANGED;\n+                } else {\n+                    return TxUpdate::UNCHANGED;\n+                }\n+            };\n+\n+            RecursiveUpdateTxState(_it->second, try_updating_state);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500034212",
      "id" : 1500034212,
      "in_reply_to_id" : 1491576720,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLSk",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1451,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897114547,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500034300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034300"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:51:54Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Add this conflict to the wtx's entry (create one if one does not already exist)\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                if (wtx.isInactive()) {\n+                    wtx.m_state = TxStateInactive{wtx.isAbandoned(), /*mempool_conflicted=*/ true};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500034300",
      "id" : 1500034300,
      "in_reply_to_id" : 1491586915,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLT8",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1444,
      "original_position" : 43,
      "original_start_line" : 1443,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897114701,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034300/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:51:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500034499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034499"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:52:14Z",
      "diff_hunk" : "@@ -1457,6 +1488,36 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Remove the previously conflicting transaction from this wtx's entry\n+                wtx.mempool_conflicts.erase(conflict_txid);\n+\n+                if (wtx.mempool_conflicts.empty()) {\n+                    // If this wtx has no other mempool conflicts, it is now considered inactive\n+                    if (wtx.isMempoolConflicted()) {\n+                        wtx.m_state = TxStateInactive{};\n+                        return TxUpdate::CHANGED;\n+                    }\n+                }\n+                return TxUpdate::UNCHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500034499",
      "id" : 1500034499,
      "in_reply_to_id" : 1491593170,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLXD",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1501,
      "original_position" : 84,
      "original_start_line" : 1506,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897115039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:52:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500034499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500035581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500035581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have implemented most of this, except for removing the extra underscore, because `it` was already defined above. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:53:50Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;\n+\n+        std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range;\n+        range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500035581",
      "id" : 1500035581,
      "in_reply_to_id" : 1491596687,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLn9",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1434,
      "original_position" : 33,
      "original_start_line" : 1427,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897116712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500035581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500035581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500035847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500035847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed here and for `transactionRemovedFromMempool`.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:54:10Z",
      "diff_hunk" : "@@ -1420,6 +1420,37 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        // If the wallet contains no transactions that spend the same prevout, continue\n+        if (mapTxSpends.count(tx_in.prevout) == 0) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500035847",
      "id" : 1500035847,
      "in_reply_to_id" : 1491599010,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZaLsH",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 1428,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1897117042,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500035847/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:54:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500035847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500036664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500036664"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have made the first commit the commit with tests, and they are updated to reflect the changes in the following commits. ",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-22T22:55:18Z",
      "diff_hunk" : "@@ -28,6 +29,20 @@ def get_utxo_of_value(self, from_tx_id, search_value):\n         return next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(from_tx_id)[\"details\"] if tx_out[\"amount\"] == Decimal(f\"{search_value}\"))\n \n     def run_test(self):\n+        \"\"\"\n+        The following tests check the behavior of the wallet when",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500036664",
      "id" : 1500036664,
      "in_reply_to_id" : 1491620312,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII585ZaL44",
      "original_commit_id" : "c891a65067f57ba87e443d0cdc4f7e6b434c436f",
      "original_line" : 33,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : 13,
      "pull_request_review_id" : 1897118170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500036664/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T22:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500036664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21886408495</sub>",
      "created_at" : "2024-02-22T23:52:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#issuecomment-1960529036",
      "id" : 1960529036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
      "node_id" : "IC_kwDOABII585020yM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1960529036/reactions"
      },
      "updated_at" : "2024-02-22T23:52:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1960529036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500828408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500828408"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a650caab9f11be7f5927f9aa556bb7d2a8ebed33)\r\n\r\nWould maybe tweak comment to be more specific. \"This set will be empty if state is InMempool or Confirmed, but can be nonempty if state is Inactive or BlockConflicted.\"",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T15:28:55Z",
      "diff_hunk" : "@@ -258,6 +258,13 @@ class CWalletTx\n     CTransactionRef tx;\n     TxState m_state;\n \n+    // Set of mempool transactions that conflict\n+    // directly with the transaction, or that conflict\n+    // with an ancestor transaction. This set is empty\n+    // if the transaction is confirmed, but can be\n+    // non-empty in other states.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500828408",
      "id" : 1500828408,
      "line" : 265,
      "node_id" : "PRRC_kwDOABII585ZdNL4",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 265,
      "original_position" : 17,
      "original_start_line" : 263,
      "path" : "src/wallet/transaction.h",
      "position" : 60,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500828408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 263,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500828408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500837836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500837836"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a650caab9f11be7f5927f9aa556bb7d2a8ebed33)\r\n\r\nCan this change be reverted? This change seems like it will have no effect, because of the `if (!wtx.InMempool()) return false;` line below. If the transaction conflicts with the mempool, it should already not be in in the mempool and already not be trusted. \r\n\r\nWould suggest reverting this change and dropping \"if a tx has a mempool conflict, the tx will no longer be trusted\" from the commit description. Also might suggest dropping the `CWalletTx::isConflicted` method since it is only used one other place.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T15:36:40Z",
      "diff_hunk" : "@@ -257,7 +257,7 @@ bool CachedTxIsTrusted(const CWallet& wallet, const CWalletTx& wtx, std::set<uin\n {\n     AssertLockHeld(wallet.cs_wallet);\n     if (wtx.isConfirmed()) return true;\n-    if (wtx.isBlockConflicted()) return false;\n+    if (wtx.isConflicted()) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500837836",
      "id" : 1500837836,
      "line" : 260,
      "node_id" : "PRRC_kwDOABII585ZdPfM",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 260,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/receive.cpp",
      "position" : 8,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500837836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500837836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500848677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500848677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a650caab9f11be7f5927f9aa556bb7d2a8ebed33)\r\n\r\n> The preceding was more of a refactor, while this commit aims to have `IsSpent` return false for txos spent by mempool-conflicted transactions.\r\n\r\nSounds good. I guess I'm still curious why you prefer over:\r\n\r\n```c++\r\nif (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned() && !wtx.isMempoolConflicted())\r\n```\r\n\r\nover \r\n\r\n```c++\r\nif (!wtx.IsAbandoned() && !wtx.isConflicted())\r\n```\r\n\r\nsince both checks should equivalent. Either approach seems fine to me, though.",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T15:45:16Z",
      "diff_hunk" : "@@ -755,7 +755,7 @@ bool CWallet::IsSpent(const COutPoint& outpoint) const\n             // An output is considered spent if a spending transaction\n             // is either confirmed, or in the mempool, or inactive (but not abandoned)\n             const auto& wtx = mit->second;\n-            if (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned()))\n+            if (wtx.isConfirmed() || wtx.InMempool() || (wtx.isInactive() && !wtx.isAbandoned() && !wtx.isMempoolConflicted()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500848677",
      "id" : 1500848677,
      "in_reply_to_id" : 1491449136,
      "line" : 761,
      "node_id" : "PRRC_kwDOABII585ZdSIl",
      "original_commit_id" : "2c867784b2a719c9e701e19e389c3adfa7d7faae",
      "original_line" : 761,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 12,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500848677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500848677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500861821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500861821"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: use CWalletTx member functions to determine tx state\" (feb702a615cf4d9d2d4aa825b46951ae0f389183)\r\n\r\nThe mapWallet lookup appears to not do anything and it seems like could be simplified\r\n\r\n```diff\r\n-            CWalletTx& wallet_tx = mapWallet.at(_it->second);\r\n-            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\r\n+            if (_it->second == conflict_txid) continue;\r\n```",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T15:55:22Z",
      "diff_hunk" : "@@ -1423,6 +1427,27 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        auto range =  mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (auto _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500861821",
      "id" : 1500861821,
      "line" : 1440,
      "node_id" : "PRRC_kwDOABII585ZdVV9",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 1440,
      "original_position" : 46,
      "original_start_line" : 1439,
      "path" : "src/wallet/wallet.cpp",
      "position" : 80,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500861821/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1439,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500861821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500878535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500878535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a650caab9f11be7f5927f9aa556bb7d2a8ebed33)\r\n\r\nWould be nice to add a check that conflict txid is actually inserted as assumed:\r\n\r\n```diff\r\n-                wtx.mempool_conflicts.insert(conflict_txid);\r\n-\r\n+                Assume(wtx.mempool_conflicts.insert(conflict_txid).second);\r\n```",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T16:08:54Z",
      "diff_hunk" : "@@ -1423,6 +1427,27 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        auto range =  mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (auto _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                return TxUpdate::CHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500878535",
      "id" : 1500878535,
      "line" : 1445,
      "node_id" : "PRRC_kwDOABII585ZdZbH",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 1445,
      "original_position" : 51,
      "original_start_line" : 1443,
      "path" : "src/wallet/wallet.cpp",
      "position" : 85,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500878535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1443,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:38:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500878535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500887407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500887407"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a650caab9f11be7f5927f9aa556bb7d2a8ebed33)\r\n\r\nUnimportant style point, but usually it makes more sense to return early when state is *not* changing than when it is changing:\r\n\r\n```diff\r\n-                if (wtx.mempool_conflicts.erase(conflict_txid)) return TxUpdate::CHANGED;\r\n-\r\n-                return TxUpdate::UNCHANGED;\r\n+                if (!wtx.mempool_conflicts.erase(conflict_txid)) return TxUpdate::UNCHANGED;\r\n+                return TxUpdate::CHANGED;\r\n```\r\n\r\nSo if someone wants to add extra code logging or dealing with the state change, there is a place to insert it after the early return.\r\n\r\nAlternately this could be simplified to\r\n\r\n```c++\r\nreturn wtx.mempool_conflicts.erase(conflict_txid)) ? TxUpdate::CHANGED : TxUpdate::UNCHANGED;\r\n```",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T16:15:28Z",
      "diff_hunk" : "@@ -1460,6 +1485,25 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        auto range =  mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (auto _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Remove the previously conflicting transaction from this wtx's entry\n+                if (wtx.mempool_conflicts.erase(conflict_txid)) return TxUpdate::CHANGED;\n+\n+                return TxUpdate::UNCHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500887407",
      "id" : 1500887407,
      "line" : 1501,
      "node_id" : "PRRC_kwDOABII585Zdblv",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 1501,
      "original_position" : 77,
      "original_start_line" : 1498,
      "path" : "src/wallet/wallet.cpp",
      "position" : 111,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500887407/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1498,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500887407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500890611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500890611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: track mempool conflicts\" (a650caab9f11be7f5927f9aa556bb7d2a8ebed33)\r\n\r\nShould this comment be restored? Unclear why it is being removed here",
      "commit_id" : "923734ef6528e5d4e13748db7387f44d02237d4d",
      "created_at" : "2024-02-23T16:18:14Z",
      "diff_hunk" : "@@ -346,7 +346,6 @@ def test_descendants_with_mempool_conflicts(self):\n         tx1_child = bob.signrawtransactionwithwallet(raw_tx)['hex']\n         tx1_child_txid = bob.sendrawtransaction(tx1_child)\n \n-        # Currently neither tx1 nor tx1_child should have any conflicts",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1500890611",
      "id" : 1500890611,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZdcXz",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 349,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1898382151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500890611/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-23T16:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500890611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505406725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505406725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "b853688c92d3745d5ec2ec5119584148084e7c1c",
      "created_at" : "2024-02-28T06:05:22Z",
      "diff_hunk" : "@@ -258,6 +258,13 @@ class CWalletTx\n     CTransactionRef tx;\n     TxState m_state;\n \n+    // Set of mempool transactions that conflict\n+    // directly with the transaction, or that conflict\n+    // with an ancestor transaction. This set is empty\n+    // if the transaction is confirmed, but can be\n+    // non-empty in other states.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505406725",
      "id" : 1505406725,
      "in_reply_to_id" : 1500828408,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Zuq8F",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 265,
      "original_position" : 17,
      "original_start_line" : 263,
      "path" : "src/wallet/transaction.h",
      "position" : null,
      "pull_request_review_id" : 1905388009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505406725/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T06:05:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505406725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505406884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505406884"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "b853688c92d3745d5ec2ec5119584148084e7c1c",
      "created_at" : "2024-02-28T06:05:35Z",
      "diff_hunk" : "@@ -257,7 +257,7 @@ bool CachedTxIsTrusted(const CWallet& wallet, const CWalletTx& wtx, std::set<uin\n {\n     AssertLockHeld(wallet.cs_wallet);\n     if (wtx.isConfirmed()) return true;\n-    if (wtx.isBlockConflicted()) return false;\n+    if (wtx.isConflicted()) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505406884",
      "id" : 1505406884,
      "in_reply_to_id" : 1500837836,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Zuq-k",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 260,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/receive.cpp",
      "position" : null,
      "pull_request_review_id" : 1905388251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505406884/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T06:05:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505406884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505407087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407087"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "b853688c92d3745d5ec2ec5119584148084e7c1c",
      "created_at" : "2024-02-28T06:05:53Z",
      "diff_hunk" : "@@ -1423,6 +1427,27 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        auto range =  mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (auto _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505407087",
      "id" : 1505407087,
      "in_reply_to_id" : 1500861821,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZurBv",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 1440,
      "original_position" : 46,
      "original_start_line" : 1439,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1905388564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T06:05:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505407288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "b853688c92d3745d5ec2ec5119584148084e7c1c",
      "created_at" : "2024-02-28T06:06:12Z",
      "diff_hunk" : "@@ -1460,6 +1485,25 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n         // https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking\n         SyncTransaction(tx, TxStateInactive{});\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        auto range =  mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (auto _it = range.first; _it != range.second; ++_it) {\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                // Remove the previously conflicting transaction from this wtx's entry\n+                if (wtx.mempool_conflicts.erase(conflict_txid)) return TxUpdate::CHANGED;\n+\n+                return TxUpdate::UNCHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505407288",
      "id" : 1505407288,
      "in_reply_to_id" : 1500887407,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZurE4",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 1501,
      "original_position" : 77,
      "original_start_line" : 1498,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1905388908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407288/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T06:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505407590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407590"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That was a mistake, should be fixed now. ",
      "commit_id" : "b853688c92d3745d5ec2ec5119584148084e7c1c",
      "created_at" : "2024-02-28T06:06:39Z",
      "diff_hunk" : "@@ -346,7 +346,6 @@ def test_descendants_with_mempool_conflicts(self):\n         tx1_child = bob.signrawtransactionwithwallet(raw_tx)['hex']\n         tx1_child_txid = bob.sendrawtransaction(tx1_child)\n \n-        # Currently neither tx1 nor tx1_child should have any conflicts",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505407590",
      "id" : 1505407590,
      "in_reply_to_id" : 1500890611,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZurJm",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 349,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/wallet_conflicts.py",
      "position" : null,
      "pull_request_review_id" : 1905389385,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407590/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T06:06:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505407590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505409219"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505409219"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems like that is not always true, so I have changed this code to do something similar to `transactionRemovedFromMempool` where it only returns `TxUpdate::CHANGED` if the txid is actually inserted. ",
      "commit_id" : "b853688c92d3745d5ec2ec5119584148084e7c1c",
      "created_at" : "2024-02-28T06:09:01Z",
      "diff_hunk" : "@@ -1423,6 +1427,27 @@ void CWallet::transactionAddedToMempool(const CTransactionRef& tx) {\n     if (it != mapWallet.end()) {\n         RefreshMempoolStatus(it->second, chain());\n     }\n+\n+    const Txid& conflict_txid = tx->GetHash();\n+\n+    for (const CTxIn& tx_in : tx->vin) {\n+        auto range =  mapTxSpends.equal_range(tx_in.prevout);\n+\n+        // For each wallet transaction spending this prevout...\n+        for (auto _it = range.first; _it != range.second; ++_it) {\n+            // if this tx is the same as the tx which was just added to the mempool, continue\n+            CWalletTx& wallet_tx = mapWallet.at(_it->second);\n+            if (wallet_tx.tx->GetHash() == conflict_txid) continue;\n+\n+            auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+                wtx.mempool_conflicts.insert(conflict_txid);\n+\n+                return TxUpdate::CHANGED;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27307#discussion_r1505409219",
      "id" : 1505409219,
      "in_reply_to_id" : 1500878535,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZurjD",
      "original_commit_id" : "a650caab9f11be7f5927f9aa556bb7d2a8ebed33",
      "original_line" : 1444,
      "original_position" : 51,
      "original_start_line" : 1443,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1905391820,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505409219/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T06:09:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505409219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   }
]
