[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615703491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615703491"
         }
      },
      "author_association" : "NONE",
      "body" : "In the previous implementation, it seemed a little unusual that `b'a'` was added first, and then more padding was added later. The newer approach seems cleaner where padding is added only once.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:34:55Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615703491",
      "id" : 1615703491,
      "line" : 124,
      "node_id" : "PRRC_kwDOABII585gTa3D",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 124,
      "original_position" : 20,
      "original_start_line" : 122,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 28,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615703491/reactions"
      },
      "side" : "LEFT",
      "start_line" : 122,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615703491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615705400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615705400"
         }
      },
      "author_association" : "NONE",
      "body" : "Though it's older implementation, for my understanding, why is the actual weight more than the `target_weight`. Doesn't `target_weight` become a misnomer with this?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:36:27Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615705400",
      "id" : 1615705400,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585gTbU4",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 27,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615705400/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615705400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615708591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615708591"
         }
      },
      "author_association" : "NONE",
      "body" : "Non blocking nit: This seems to be testing for a specific piece and if you don't anticipate it to be updated later, WDYT about either adding this test in an existing functional test, or adding this in the unit tests of the functional test framework?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:38:59Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2024 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test MiniWallet.\"\"\"\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+    MiniWalletMode,\n+)\n+\n+\n+class FeatureFrameworkMiniWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def test_tx_padding(self):\n+        \"\"\"Verify that MiniWallet's transaction padding (`target_weight` parameter)\n+           works accurately enough (i.e. at most 3 WUs higher) with all modes.\"\"\"\n+        for mode_name, wallet in self.wallets:\n+            self.log.info(f\"Test tx padding with MiniWallet mode {mode_name}...\")\n+            utxo = wallet.get_utxo(mark_as_spent=False)\n+            for target_weight in [1000, 2000, 5000, 10000, 20000, 50000, 100000, 200000, 4000000,\n+                                  989,  2001, 4337, 13371, 23219, 49153, 102035, 223419, 3999989]:\n+                tx = wallet.create_self_transfer(utxo_to_spend=utxo, target_weight=target_weight)[\"tx\"]\n+                self.log.debug(f\"-> target weight: {target_weight}, actual weight: {tx.get_weight()}\")\n+                assert_greater_than_or_equal(tx.get_weight(), target_weight)\n+                assert_greater_than_or_equal(target_weight + 3, tx.get_weight())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615708591",
      "id" : 1615708591,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585gTcGv",
      "original_commit_id" : "372e5a7492b0beb60e096efc96c11391a88cb321",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : 31,
      "path" : "test/functional/feature_framework_miniwallet.py",
      "position" : 32,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615708591/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 31,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615708591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615710140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615710140"
         }
      },
      "author_association" : "NONE",
      "body" : "Should there also be an assertion disallowing passing both `target_weight` and `fee`?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:40:17Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615710140",
      "id" : 1615710140,
      "line" : 374,
      "node_id" : "PRRC_kwDOABII585gTce8",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 374,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615710140/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615710140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615711645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615711645"
         }
      },
      "author_association" : "NONE",
      "body" : "As per the code in `_bulk_tx`, the actual weight is indeed off by 3 WUs, consider getting rid of `might be` here, it adds a bit of uncertainty imo.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:41:21Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615711645",
      "id" : 1615711645,
      "line" : 375,
      "node_id" : "PRRC_kwDOABII585gTc2d",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 375,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 13,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615711645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615711645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615712714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615712714"
         }
      },
      "author_association" : "NONE",
      "body" : "Nice to see the removal of many of these repetitive fee calculation code!",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:42:16Z",
      "diff_hunk" : "@@ -59,7 +59,7 @@ def test_rbf_carveout_disallowed(self):\n         mempoolmin_feerate = node.getmempoolinfo()[\"mempoolminfee\"]\n         tx_A = self.wallet.send_self_transfer(\n             from_node=node,\n-            fee=(mempoolmin_feerate / 1000) * (A_weight // 4) + Decimal('0.000001'),\n+            fee_rate=mempoolmin_feerate,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615712714",
      "id" : 1615712714,
      "line" : 62,
      "node_id" : "PRRC_kwDOABII585gTdHK",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 62,
      "original_position" : 5,
      "original_start_line" : 62,
      "path" : "test/functional/mempool_limit.py",
      "position" : 5,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615712714/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 62,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615712714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615734654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615734654"
         }
      },
      "author_association" : "NONE",
      "body" : "The previous implementation is 10^-5, and the newer one is 10^-6.\r\nIMO, it's worth creating it a constant with an expressive name to make reading this piece easier.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:58:59Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615734654",
      "id" : 1615734654,
      "line" : 317,
      "node_id" : "PRRC_kwDOABII585gTid-",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 317,
      "original_position" : 46,
      "original_start_line" : 317,
      "path" : "test/functional/mempool_limit.py",
      "position" : 46,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615734654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 317,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615734654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615736403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615736403"
         }
      },
      "author_association" : "NONE",
      "body" : "Preference style: Although this is not a fresh test, but IMHO it makes it far easier for the reviewer to read when the variable name contains the unit as well such as `child_feerate_satvb` or `child_fee_sat`.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T09:00:16Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate\n         # Parent + child is above mempool minimum feerate\n-        child_fee = (worst_feerate_btcvb) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        child_feerate = (worst_feerate_btcvb * 1000) - Decimal(\"0.000001\")  # 0.1 sats/vbyte below worst feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615736403",
      "id" : 1615736403,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII585gTi5T",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 319,
      "original_position" : 49,
      "original_start_line" : 319,
      "path" : "test/functional/mempool_limit.py",
      "position" : 49,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615736403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 319,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615736403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615739344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615739344"
         }
      },
      "author_association" : "NONE",
      "body" : "Nice catch here that fixes the calculation!",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T09:02:32Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])\n-        # Lower bound should always be off by at most 3\n+        # compensate for the compact-size encoded script length\n+        dummy_vbytes -= len(ser_compact_size(dummy_vbytes)) - 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615739344",
      "id" : 1615739344,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585gTjnQ",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 127,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 31,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615739344/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615739344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064751"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Each byte in the output script counts as four weight units, so with the padding method used here, we can only ever increase the weight by multiples of four. If the weight of the unpadded tx is not a multiple of four already (i.e. tx.get_weight() % 4 != 0), it will also not be after the padding and the best we can do is to be not more off than 3 WUs in the worst case.\r\n\r\nIt would be nice if we could somehow do exact padding with weight unit precision, but to my knowledge there is no general way to add extra witness data to transactions without making them non-standard. (For example, the test feature_fastprune.py [uses an annex in the witness for padding](https://github.com/bitcoin/bitcoin/blob/327f08bb0cd91a22249395adeb34549e3c86ca76/test/functional/feature_fastprune.py#L22), but that is only consensus-valid, [not policy-valid](https://github.com/bitcoin/bitcoin/blob/327f08bb0cd91a22249395adeb34549e3c86ca76/src/policy/policy.cpp#L268-L271)).",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:35:47Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064751",
      "id" : 1616064751,
      "in_reply_to_id" : 1615705400,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585gUzDv",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 27,
      "pull_request_review_id" : 2080944224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We need a running node to create a MiniWallet instance, so unfortunately doing these checks in an unit test wouldn't work. I considered putting it into an existing functional test but wouldn't know which one to pick, so creating a new MiniWallet-specific test where features can tested independently seemed to make the most sense.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:36:00Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2024 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test MiniWallet.\"\"\"\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+    MiniWalletMode,\n+)\n+\n+\n+class FeatureFrameworkMiniWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def test_tx_padding(self):\n+        \"\"\"Verify that MiniWallet's transaction padding (`target_weight` parameter)\n+           works accurately enough (i.e. at most 3 WUs higher) with all modes.\"\"\"\n+        for mode_name, wallet in self.wallets:\n+            self.log.info(f\"Test tx padding with MiniWallet mode {mode_name}...\")\n+            utxo = wallet.get_utxo(mark_as_spent=False)\n+            for target_weight in [1000, 2000, 5000, 10000, 20000, 50000, 100000, 200000, 4000000,\n+                                  989,  2001, 4337, 13371, 23219, 49153, 102035, 223419, 3999989]:\n+                tx = wallet.create_self_transfer(utxo_to_spend=utxo, target_weight=target_weight)[\"tx\"]\n+                self.log.debug(f\"-> target weight: {target_weight}, actual weight: {tx.get_weight()}\")\n+                assert_greater_than_or_equal(tx.get_weight(), target_weight)\n+                assert_greater_than_or_equal(target_weight + 3, tx.get_weight())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064960",
      "id" : 1616064960,
      "in_reply_to_id" : 1615708591,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585gUzHA",
      "original_commit_id" : "372e5a7492b0beb60e096efc96c11391a88cb321",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : 31,
      "path" : "test/functional/feature_framework_miniwallet.py",
      "position" : 32,
      "pull_request_review_id" : 2080944602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 31,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:36:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Passing `target_weight` with an absolute `fee` should still work fine. There is arguably less reason now to do so as passing a `fee_rate` is likely more convenient for most use-cases, but I don't think we have to disallow padding txs with an absolute fee.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:36:10Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065138",
      "id" : 1616065138,
      "in_reply_to_id" : 1615710140,
      "line" : 374,
      "node_id" : "PRRC_kwDOABII585gUzJy",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 374,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 2080944925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065138/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065536"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The actual weight can be larger by at most 3 WUs, [see comment above](https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064751).",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:36:34Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065536",
      "id" : 1616065536,
      "in_reply_to_id" : 1615711645,
      "line" : 375,
      "node_id" : "PRRC_kwDOABII585gUzQA",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 375,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 13,
      "pull_request_review_id" : 2080945639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065536/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620213384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620213384"
         }
      },
      "author_association" : "NONE",
      "body" : "Hmm from the way I understand this, addition of 3 is helpful in the case when `(target_weight - tx.get_weight() < 4` because otherwise the floor division by 4 will cause no padding to be added and the transaction will end up being same in vbytes. Is this the right way to understand this?\r\n\r\nTying this to an earlier comment of mine - if `target_weight` had been called `target_weight_wu`, the code would become more self explanatory.\r\n\r\nI feel this is worth adding as a comment for reference in the code, and thanks for the explanation!",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-30T08:10:36Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620213384",
      "id" : 1620213384,
      "in_reply_to_id" : 1615705400,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585gkn6I",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 27,
      "pull_request_review_id" : 2087557101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620213384/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T08:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620213384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620225868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620225868"
         }
      },
      "author_association" : "NONE",
      "body" : "I've been trying to understand why 1 is subtracted here, but could not come up with a proper reason. Is it somehow related to excluding the already serialised length of the output script before padding?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-30T08:16:00Z",
      "diff_hunk" : "@@ -119,13 +122,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])\n-        # Lower bound should always be off by at most 3\n+        # compensate for the compact-size encoded script length\n+        dummy_vbytes -= len(ser_compact_size(dummy_vbytes)) - 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620225868",
      "id" : 1620225868,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585gkq9M",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 128,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 31,
      "pull_request_review_id" : 2087576041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620225868/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T10:14:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620225868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620853166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620853166"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are you incrementing by 3 twice\r\nPlease use `WITNESS_SCALE_FACTOR` const instead of just 4.\r\n\r\n Magic numbers makes my head hurts  \r\n \r\n Should be worth it to define 3 in wallet as `PADDING_OFFSET` ?\r\n\r\n",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-30T14:39:55Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)\n+            max_actual_weight = target_weight + 3\n+            fee = get_fee((max_actual_weight + 3) // 4, fee_rate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620853166",
      "id" : 1620853166,
      "line" : 377,
      "node_id" : "PRRC_kwDOABII585gnEGu",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 377,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 15,
      "pull_request_review_id" : 2088475662,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620853166/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T14:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620853166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620854919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620854919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        send_value = utxo_to_spend[\"value\"] - (fee or (fee_rate * vsize / 1000))\r\n        # Ensure UTXO is enough to account for the required fee\r\n        assert_greater_than_or_equal(send_value, 0)\r\n```",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-30T14:41:00Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)\n+            max_actual_weight = target_weight + 3\n+            fee = get_fee((max_actual_weight + 3) // 4, fee_rate)\n         send_value = utxo_to_spend[\"value\"] - (fee or (fee_rate * vsize / 1000))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620854919",
      "id" : 1620854919,
      "line" : 378,
      "node_id" : "PRRC_kwDOABII585gnEiH",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 378,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 16,
      "pull_request_review_id" : 2088475662,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620854919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T14:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620854919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621482991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621482991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What is done here is a weight-to-vsize conversion, like also done in e.g. `CTransaction.get_vsize()`, so it's essentially dividing by 4 and rounding up. Added a comment to clarify.\r\n\r\n> Tying this to an earlier comment of mine - if target_weight had been called target_weight_wu, the code would become more self explanatory.\r\n\r\nTo my knowledge, weight is always measured in weight units, so I don't think adding the `_wu` suffix here would add any new information.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:23:23Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621482991",
      "id" : 1621482991,
      "in_reply_to_id" : 1615705400,
      "line" : 129,
      "node_id" : "PRRC_kwDOABII585gpd3v",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 129,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 37,
      "pull_request_review_id" : 2089457822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621482991/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:23:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621482991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483053"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good idea. Leaving that as a follow-up, as the introduction of that constant could likely be used in much more places than only the ones I touch (maybe even other functional tests).",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:23:30Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483053",
      "id" : 1621483053,
      "in_reply_to_id" : 1615734654,
      "line" : 317,
      "node_id" : "PRRC_kwDOABII585gpd4t",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 317,
      "original_position" : 46,
      "original_start_line" : 317,
      "path" : "test/functional/mempool_limit.py",
      "position" : 46,
      "pull_request_review_id" : 2089457916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 317,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree, leaving that as a follow-up as it likely needs more instances to adapt that are not touched here.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:23:34Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate\n         # Parent + child is above mempool minimum feerate\n-        child_fee = (worst_feerate_btcvb) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        child_feerate = (worst_feerate_btcvb * 1000) - Decimal(\"0.000001\")  # 0.1 sats/vbyte below worst feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483090",
      "id" : 1621483090,
      "in_reply_to_id" : 1615736403,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII585gpd5S",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 319,
      "original_position" : 49,
      "original_start_line" : 319,
      "path" : "test/functional/mempool_limit.py",
      "position" : 49,
      "pull_request_review_id" : 2089457985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483090/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 319,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:23:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483152"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I've been trying to understand why 1 is subtracted here, but could not come up with a proper reason. Is it somehow related to excluding the already serialised length of the output script before padding?\r\n\r\nYes, exactly. The encoded length of the unpadded output script fits into one byte, and we want to find how much the length encoding increases with the padding, so we subtract by one. I added a comment to (hopefully) reduce the confusion for code readers.\r\n",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:23:41Z",
      "diff_hunk" : "@@ -119,13 +122,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])\n-        # Lower bound should always be off by at most 3\n+        # compensate for the compact-size encoded script length\n+        dummy_vbytes -= len(ser_compact_size(dummy_vbytes)) - 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483152",
      "id" : 1621483152,
      "in_reply_to_id" : 1620225868,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII585gpd6Q",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 132,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 42,
      "pull_request_review_id" : 2089458080,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483152/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Why are you incrementing by 3 twice\r\n\r\nThe first increment by 3 is done to find the worst-case weight (that could result from ._bulk_tx), the second is part of a weight-to-vsize conversion. I've changed the latter to use float division and rounding up, as that should reflect better what this calculation actually achieves (the same way it's done e.g. in `CTransaction.get_vsize()`). It might be worth to introduce a `weight_to_vsize` helper in the util module in a follow-up, which could probably be used in a lots of functional tests and framework modules.\r\n\r\n> Please use WITNESS_SCALE_FACTOR const instead of just 4.\r\n\r\nSure, done :)\r\n\r\n> Should be worth it to define 3 in wallet as PADDING_OFFSET ?\r\n\r\nLeaving that as a follow-up.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:23:59Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)\n+            max_actual_weight = target_weight + 3\n+            fee = get_fee((max_actual_weight + 3) // 4, fee_rate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483290",
      "id" : 1621483290,
      "in_reply_to_id" : 1620853166,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585gpd8a",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 377,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 2089458305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483290/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:23:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483453"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This sounds like a very good idea for a follow-up, as it's not directly related to this PR (though one could argue that it's more likely to happen with large `target_weight` values). I think it's even worth it to throw an exception with an explicit message here like \"UTXO is too small to cover for fees\" (maybe even including details like utxo value, absolute fee, fee-rate, vsize) rather than only an assertion on the send value, which could still be confusing for users.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:24:12Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)\n+            max_actual_weight = target_weight + 3\n+            fee = get_fee((max_actual_weight + 3) // 4, fee_rate)\n         send_value = utxo_to_spend[\"value\"] - (fee or (fee_rate * vsize / 1000))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621483453",
      "id" : 1621483453,
      "in_reply_to_id" : 1620854919,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII585gpd-9",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 382,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 60,
      "pull_request_review_id" : 2089458470,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621483453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621491730"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621491730"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "One thing that's maybe worth mentioning here is that the method of padding is changed from \"one push of N bytes\" to \"N single pushes\" (using repeated OP_1 instructions). The former method could introduce additional bytes due to the length encoding of the pushed data (using either single-byte length bytes for sizes <= 75, and  OP_PUSHDATA{1,2,4} for larger ones, see https://en.bitcoin.it/wiki/Script#Constants), making exact padding even harder, which is avoided with the new way.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-30T22:39:19Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621491730",
      "id" : 1621491730,
      "in_reply_to_id" : 1615703491,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585gpgAS",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 124,
      "original_position" : 20,
      "original_start_line" : 122,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 2089470275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621491730/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-30T22:39:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621491730",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621795298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621795298"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks for the confirmation, appreciate it!",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-31T06:21:12Z",
      "diff_hunk" : "@@ -119,13 +122,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])\n-        # Lower bound should always be off by at most 3\n+        # compensate for the compact-size encoded script length\n+        dummy_vbytes -= len(ser_compact_size(dummy_vbytes)) - 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621795298",
      "id" : 1621795298,
      "in_reply_to_id" : 1620225868,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII585gqqHi",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 132,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 42,
      "pull_request_review_id" : 2089975958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621795298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-31T06:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621795298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621797908"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621797908"
         }
      },
      "author_association" : "NONE",
      "body" : "> To my knowledge, weight is always measured in weight units, so I don't think adding the _wu suffix here would add any new information.\r\n\r\nMakes sense if that's the case. I'm new to this piece and will keep this in mind from now on.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-31T06:23:41Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621797908",
      "id" : 1621797908,
      "in_reply_to_id" : 1615705400,
      "line" : 129,
      "node_id" : "PRRC_kwDOABII585gqqwU",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 129,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 37,
      "pull_request_review_id" : 2089978943,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621797908/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-31T06:30:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621797908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621812773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621812773"
         }
      },
      "author_association" : "NONE",
      "body" : "Agreed. However if it had not been for the absolute fee, we could come up with a more generic function `get_effective_unspent_value` that calculates based on the `fee_rate` and the `vsize` of the unspent.\r\n\r\nCan't include the absolute fee in this because it is paid for the whole transaction and not just one unspent - still valid for transactions spending only one unspent.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-31T06:37:11Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)\n+            max_actual_weight = target_weight + 3\n+            fee = get_fee((max_actual_weight + 3) // 4, fee_rate)\n         send_value = utxo_to_spend[\"value\"] - (fee or (fee_rate * vsize / 1000))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621812773",
      "id" : 1621812773,
      "in_reply_to_id" : 1620854919,
      "line" : 382,
      "node_id" : "PRRC_kwDOABII585gquYl",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 382,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 60,
      "pull_request_review_id" : 2089995912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621812773/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-31T06:37:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621812773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621826033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621826033"
         }
      },
      "author_association" : "NONE",
      "body" : "I see, nice!",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-31T06:48:23Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621826033",
      "id" : 1621826033,
      "in_reply_to_id" : 1615703491,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585gqxnx",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 124,
      "original_position" : 20,
      "original_start_line" : 122,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : null,
      "pull_request_review_id" : 2090011020,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621826033/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-31T06:48:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621826033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621826528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621826528"
         }
      },
      "author_association" : "NONE",
      "body" : "I can pick it up in a follow-up.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-31T06:48:53Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate\n         # Parent + child is above mempool minimum feerate\n-        child_fee = (worst_feerate_btcvb) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        child_feerate = (worst_feerate_btcvb * 1000) - Decimal(\"0.000001\")  # 0.1 sats/vbyte below worst feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621826528",
      "id" : 1621826528,
      "in_reply_to_id" : 1615736403,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII585gqxvg",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 319,
      "original_position" : 49,
      "original_start_line" : 319,
      "path" : "test/functional/mempool_limit.py",
      "position" : 49,
      "pull_request_review_id" : 2090011711,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621826528/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 319,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-31T06:48:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621826528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621836458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621836458"
         }
      },
      "author_association" : "NONE",
      "body" : "IMO, this 3 deserves a constant soon because it has started showing up in a comment in the functional test as well now besides being in few other places too in this diff. Otherwise, the mind of the code reader wanders off to figuring out where this 3 comes from.",
      "commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "created_at" : "2024-05-31T06:56:57Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2024 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test MiniWallet.\"\"\"\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+    MiniWalletMode,\n+)\n+\n+\n+class FeatureFrameworkMiniWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def test_tx_padding(self):\n+        \"\"\"Verify that MiniWallet's transaction padding (`target_weight` parameter)\n+           works accurately enough (i.e. at most 3 WUs higher) with all modes.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1621836458",
      "id" : 1621836458,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585gq0Kq",
      "original_commit_id" : "39d135e79f3f0c40dfd8fad2c53723d533cd19b4",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/feature_framework_miniwallet.py",
      "position" : 23,
      "pull_request_review_id" : 2090023300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621836458/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-31T06:58:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621836458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   }
]
