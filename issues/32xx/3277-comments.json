[
   {
      "body" : "I see no problems with the implementation, but I would suggest changing\r\n\r\n    class CAutoFile\r\n\r\nto \r\n\r\n    class CAutoFile : protected std::fstream\r\n\r\nMaking this change will require the removal of the fstream file member variable, likewise that will cause you to have to replace all instances of \"file.\" with \"fstream::\" .\r\n\r\nThis allows the underlying fstream to be used in spite of being wrapped by a CAutoFile, if an only if it is referenced as a fstream and not a CAutoFile.  In the end you could add it to an array of fstreams, while ensuring explicit CAutoFile references are forced to use the RAII function versions.",
      "created_at" : "2013-11-30T06:43:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-29547002",
      "id" : 29547002,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-11-30T06:43:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/29547002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1155895?v=3",
         "events_url" : "https://api.github.com/users/brandondahler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brandondahler/followers",
         "following_url" : "https://api.github.com/users/brandondahler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brandondahler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brandondahler",
         "id" : 1155895,
         "login" : "brandondahler",
         "organizations_url" : "https://api.github.com/users/brandondahler/orgs",
         "received_events_url" : "https://api.github.com/users/brandondahler/received_events",
         "repos_url" : "https://api.github.com/users/brandondahler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brandondahler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brandondahler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brandondahler"
      }
   },
   {
      "body" : "@brandondahler Thanks for that suggestion, I'm going to update this pull. Have you got a nice idea, how I could add back the FileCommit() whilst beeing compatible to sdt::fstream? I guess a ::flush() is not enough...",
      "created_at" : "2013-12-01T13:36:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-29573817",
      "id" : 29573817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-01T13:36:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/29573817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/5ee9baec85bcc972853af954967ee6b24bdeff2c for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2013-12-01T14:36:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-29574729",
      "id" : 29574729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-01T14:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/29574729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "@Diapolo I've researched this for some other changes to move everything to fstream.  It appears that there is no easy way to get the fileno from a c++ fstream, and likewise there's no way to directly request the OS flush the data to the disk.\r\n\r\nThe best bet that I've found is doing:\r\n\r\n    ::rdbuf().pubsync()\r\n____\r\nThat being said, I question the need to request/force the OS to flush the cache buffers to disk.  It seems like we are trying to creep into the operating system's responsibilities instead of accepting that the OS may or may not follow our requests at the time that we make them.",
      "created_at" : "2013-12-01T16:53:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-29577374",
      "id" : 29577374,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-01T16:53:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/29577374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1155895?v=3",
         "events_url" : "https://api.github.com/users/brandondahler/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brandondahler/followers",
         "following_url" : "https://api.github.com/users/brandondahler/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brandondahler/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brandondahler",
         "id" : 1155895,
         "login" : "brandondahler",
         "organizations_url" : "https://api.github.com/users/brandondahler/orgs",
         "received_events_url" : "https://api.github.com/users/brandondahler/received_events",
         "repos_url" : "https://api.github.com/users/brandondahler/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brandondahler/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brandondahler/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brandondahler"
      }
   },
   {
      "body" : "Being able to flush block files to disk is essential for consistency of on-disk structures (you don't want to make a database update that refers to a block being on disk before knowing that block is actually on disk).",
      "created_at" : "2013-12-01T20:22:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-29582135",
      "id" : 29582135,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-01T20:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/29582135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "This does not look like an improvement.\r\n",
      "created_at" : "2013-12-13T00:08:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-30475296",
      "id" : 30475296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-13T00:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30475296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I have a slight preference of the low-level file functions to fstream implementations here, because the warts of those are a little bit more apparent to me than those of particular C++ libraries.\r\n\r\nAnd this change did not help with fixing the MacOSX corruption either.\r\n",
      "created_at" : "2013-12-13T04:22:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-30485511",
      "id" : 30485511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-13T04:22:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30485511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "AFAIK no one ever tried this anyway...\r\n\r\n@brandondahler Isn't ``::rdbuf().pubsync()`` for reading from files?",
      "created_at" : "2013-12-13T07:42:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3277#issuecomment-30491875",
      "id" : 30491875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3277",
      "updated_at" : "2013-12-13T07:42:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/30491875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   }
]
