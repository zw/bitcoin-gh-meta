{
   "assignee" : null,
   "body" : "Currently, the protocol processing happens mostly in main, while most of its data structures are defined in net. This leads to weird situations where they need to access eachother's locks, and it is unclear what functionality belongs where.\r\n\r\nThis pull request introduces a main-specific CNodeState, which is managed entirely by main, so doesn't require CNode's locks. The intention is to move all processing-related fields in CNode to CNodeState, so ultimately main doesn't need access to CNode anymore, decoupling the two. This is a long way out, and we'll probably want to separate protocol processing to a different module than block validation, but it's what we have now.\r\n\r\nFor now, only node banning is moved to CNodeState. The reason for this is asynchronous processing. When blocks or transactions are processed by background threads, or in any way not directly the result of a single message being processed, we may want to attribute errors still to the original sender's DoS score. Going back and forth between main and net for this becomes increasingly ugly, as this can be done perfectly well inside main.\r\n\r\nThe direct motivation for this is an attempt at implementing BIP37-filtered-block-based fetching, and headers-first.",
   "closed_at" : "2013-12-09T07:33:24Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
      "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
      "followers_url" : "https://api.github.com/users/gavinandresen/followers",
      "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/gavinandresen",
      "id" : 331997,
      "login" : "gavinandresen",
      "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
      "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
      "repos_url" : "https://api.github.com/users/gavinandresen/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/gavinandresen"
   },
   "comments" : 10,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3276/comments",
   "created_at" : "2013-11-18T00:35:55Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3276/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/3276",
   "id" : 22809383,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3276/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 3276,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/3276.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3276",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/3276.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3276"
   },
   "state" : "closed",
   "title" : "Add main-specific node state & move ban score",
   "updated_at" : "2014-03-18T18:36:05Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3276",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   }
}
