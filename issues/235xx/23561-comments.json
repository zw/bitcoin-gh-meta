[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-975194275), [PastaPastaPasta](https://github.com/bitcoin/bitcoin/pull/23561#pullrequestreview-874403910), [theStack](https://github.com/bitcoin/bitcoin/pull/23561#pullrequestreview-993386102) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26691](https://github.com/bitcoin/bitcoin/pull/26691) (Update secp256k1 subtree to libsecp256k1 version 0.2.0 by sipa)\n* [#26684](https://github.com/bitcoin/bitcoin/pull/26684) (bench: add readblock benchmark by andrewtoth)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25465](https://github.com/bitcoin/bitcoin/pull/25465) (build: remove boost library detection by fanquake)\n* [#25390](https://github.com/bitcoin/bitcoin/pull/25390) (sync: introduce a thread-safe generic container and use it to remove a bunch of \"GlobalMutex\"es by vasild)\n* [#25386](https://github.com/bitcoin/bitcoin/pull/25386) (refactor: Extract MIB_BYTES constant for init.cpp by Empact)\n* [#25325](https://github.com/bitcoin/bitcoin/pull/25325) (Add pool based memory resource by martinus)\n* [#24742](https://github.com/bitcoin/bitcoin/pull/24742) (build: prune Boost headers in depends by fanquake)\n* [#23432](https://github.com/bitcoin/bitcoin/pull/23432) (BIP324: CPubKey encode/decode to elligator-swift by dhruv)\n* [#23233](https://github.com/bitcoin/bitcoin/pull/23233) (BIP324: Add encrypted p2p transport {de}serializer by dhruv)\n* [#23169](https://github.com/bitcoin/bitcoin/pull/23169) (fix initialization in FastRandomContext: removes undefined behavior & uninitialized read by martinus)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2021-11-21T10:27:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-974790491",
      "id" : 974790491,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII5846Gh9b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/974790491/reactions"
      },
      "updated_at" : "2022-12-21T07:26:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/974790491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\nMoving forward with BIP324 is a good idea, and this code seems to not have any negative/unexpected side-effects.",
      "created_at" : "2021-11-22T07:14:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-975194275",
      "id" : 975194275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII5846IEij",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975194275/reactions"
      },
      "updated_at" : "2021-11-22T07:14:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/975194275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755498657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755498657"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The case of secp256k1_ecdh returning 0 corresponds to invalid input. That won't happen here; I think you can assert instead and avoid the `std::optional` in the return type.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-23T20:58:40Z",
      "diff_hunk" : "@@ -332,6 +333,23 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+std::optional<ECDHSecret> CKey::ComputeECDHSecret(const CPubKey& pubkey) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return {};\n+    }\n+\n+    ECDHSecret secret;\n+    secret.resize(ECDH_SECRET_SIZE);\n+\n+    if (secp256k1_ecdh(secp256k1_context_sign, secret.data(), &pubkey_internal,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755498657",
      "id" : 755498657,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tB_6h",
      "original_commit_id" : "2d58b293461c0b8890ce82eb5683c06ff805b85e",
      "original_line" : 346,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 814167558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755498657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T21:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755498657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755500261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755500261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You could do a much stronger test: take two private keys as input fuzz data, compute the corresponding public keys, and compute the ecdh secrets from (sec1,pub2) and (sec2,pub1), and check that they match.\r\n\r\nIt's cryptographic data (hashes and EC operations), so this is very unlikely to actually uncover any bugs unless they're very apparent, but this way the fuzz test actually verifies the full behavior we desire from these functions.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-23T21:01:18Z",
      "diff_hunk" : "@@ -305,4 +305,20 @@ FUZZ_TARGET_INIT(key, initialize_key)\n             assert(key == loaded_key);\n         }\n     }\n+\n+    {\n+        // Test ECDH computation with another key",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755500261",
      "id" : 755500261,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCATl",
      "original_commit_id" : "042f771e16f887b1364291bb05b9da9d74c9f45c",
      "original_line" : 310,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/fuzz/key.cpp",
      "position" : null,
      "pull_request_review_id" : 814167558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755500261/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T21:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755500261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755501124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755501124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: pass Spans by value.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-23T21:02:47Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_BIP324_H\n+#define BITCOIN_UTIL_BIP324_H\n+\n+#include <key.h>\n+#include <span.h>\n+\n+#include <array>\n+\n+constexpr size_t BIP324_KEY_LEN = 32;\n+\n+class BIP324Keys\n+{\n+public:\n+    std::array<uint8_t, BIP324_KEY_LEN> initiator_F; // k1a\n+    std::array<uint8_t, BIP324_KEY_LEN> initiator_V; // k2a\n+    std::array<uint8_t, BIP324_KEY_LEN> responder_F; // k1b\n+    std::array<uint8_t, BIP324_KEY_LEN> responder_V; // k2b\n+    std::array<uint8_t, BIP324_KEY_LEN> session_id;\n+\n+    // Takes ownership of the ECDH secret and wipes the ephemeral secret once\n+    // the derivation is complete.\n+    explicit BIP324Keys(ECDHSecret&& ecdh_secret, const Span<uint8_t>& initiator_hdata, const Span<uint8_t>& responder_hdata);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755501124",
      "id" : 755501124,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCAhE",
      "original_commit_id" : "8d09fb5cc213011f59b7abadb0db7cc7a2abb046",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/util/bip324.h",
      "position" : null,
      "pull_request_review_id" : 814167558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755501124/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T21:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755501124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755505318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755505318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm not sure this belongs in util, it seems pretty specific to Bitcoin.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-23T21:10:08Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+// Copyright (c) 2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755505318",
      "id" : 755505318,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCBim",
      "original_commit_id" : "8d09fb5cc213011f59b7abadb0db7cc7a2abb046",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/util/bip324.cpp",
      "position" : null,
      "pull_request_review_id" : 814167558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755505318/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T21:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755505318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755510650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755510650"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if a class for this is desirable in the first place. These keys shouldn't be long-lived in any case (they're only used to initialize the stream ciphers, and then destroyed). That can just as well be done with a simple function call?",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-23T21:19:41Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_BIP324_H\n+#define BITCOIN_UTIL_BIP324_H\n+\n+#include <key.h>\n+#include <span.h>\n+\n+#include <array>\n+\n+constexpr size_t BIP324_KEY_LEN = 32;\n+\n+class BIP324Keys",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r755510650",
      "id" : 755510650,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tCC16",
      "original_commit_id" : "8d09fb5cc213011f59b7abadb0db7cc7a2abb046",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/util/bip324.h",
      "position" : null,
      "pull_request_review_id" : 814167558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755510650/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T21:19:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755510650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757114972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757114972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done - still needed a boolean return value due to the other failure case above.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-25T20:24:19Z",
      "diff_hunk" : "@@ -332,6 +333,23 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+std::optional<ECDHSecret> CKey::ComputeECDHSecret(const CPubKey& pubkey) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return {};\n+    }\n+\n+    ECDHSecret secret;\n+    secret.resize(ECDH_SECRET_SIZE);\n+\n+    if (secp256k1_ecdh(secp256k1_context_sign, secret.data(), &pubkey_internal,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757114972",
      "id" : 757114972,
      "in_reply_to_id" : 755498657,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tIKhc",
      "original_commit_id" : "2d58b293461c0b8890ce82eb5683c06ff805b85e",
      "original_line" : 346,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 816282146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757114972/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T20:24:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757114972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757114984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757114984"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done!",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-25T20:24:23Z",
      "diff_hunk" : "@@ -305,4 +305,20 @@ FUZZ_TARGET_INIT(key, initialize_key)\n             assert(key == loaded_key);\n         }\n     }\n+\n+    {\n+        // Test ECDH computation with another key",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757114984",
      "id" : 757114984,
      "in_reply_to_id" : 755500261,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tIKho",
      "original_commit_id" : "042f771e16f887b1364291bb05b9da9d74c9f45c",
      "original_line" : 310,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/fuzz/key.cpp",
      "position" : null,
      "pull_request_review_id" : 816282165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757114984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T20:24:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757114984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757115000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-25T20:24:26Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_BIP324_H\n+#define BITCOIN_UTIL_BIP324_H\n+\n+#include <key.h>\n+#include <span.h>\n+\n+#include <array>\n+\n+constexpr size_t BIP324_KEY_LEN = 32;\n+\n+class BIP324Keys\n+{\n+public:\n+    std::array<uint8_t, BIP324_KEY_LEN> initiator_F; // k1a\n+    std::array<uint8_t, BIP324_KEY_LEN> initiator_V; // k2a\n+    std::array<uint8_t, BIP324_KEY_LEN> responder_F; // k1b\n+    std::array<uint8_t, BIP324_KEY_LEN> responder_V; // k2b\n+    std::array<uint8_t, BIP324_KEY_LEN> session_id;\n+\n+    // Takes ownership of the ECDH secret and wipes the ephemeral secret once\n+    // the derivation is complete.\n+    explicit BIP324Keys(ECDHSecret&& ecdh_secret, const Span<uint8_t>& initiator_hdata, const Span<uint8_t>& responder_hdata);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757115000",
      "id" : 757115000,
      "in_reply_to_id" : 755501124,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tIKh4",
      "original_commit_id" : "8d09fb5cc213011f59b7abadb0db7cc7a2abb046",
      "original_line" : 26,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/util/bip324.h",
      "position" : null,
      "pull_request_review_id" : 816282189,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115000/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T20:24:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757115010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115010"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I moved this into `net.{h|cpp}` as that's where it will be used. I didn't particularly want to increase the length of those files, so please let me know if the right thing to do is to have it in `src/bip324.{h|cpp}`",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-25T20:24:30Z",
      "diff_hunk" : "@@ -0,0 +1,36 @@\n+// Copyright (c) 2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757115010",
      "id" : 757115010,
      "in_reply_to_id" : 755505318,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tIKiC",
      "original_commit_id" : "8d09fb5cc213011f59b7abadb0db7cc7a2abb046",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/util/bip324.cpp",
      "position" : null,
      "pull_request_review_id" : 816282205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115010/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T20:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757115092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-11-25T20:24:44Z",
      "diff_hunk" : "@@ -0,0 +1,32 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_BIP324_H\n+#define BITCOIN_UTIL_BIP324_H\n+\n+#include <key.h>\n+#include <span.h>\n+\n+#include <array>\n+\n+constexpr size_t BIP324_KEY_LEN = 32;\n+\n+class BIP324Keys",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r757115092",
      "id" : 757115092,
      "in_reply_to_id" : 755510650,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tIKjU",
      "original_commit_id" : "8d09fb5cc213011f59b7abadb0db7cc7a2abb046",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/util/bip324.h",
      "position" : null,
      "pull_request_review_id" : 816282312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-25T20:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757115092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review comments from @sipa. Ready for further review.",
      "created_at" : "2021-11-25T20:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-979455585",
      "id" : 979455585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII5846YU5h",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979455585/reactions"
      },
      "updated_at" : "2021-11-25T20:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/979455585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r762791112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762791112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why snake case for function name `derive_bip324_keys` here?",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-12-06T08:31:47Z",
      "diff_hunk" : "@@ -399,6 +401,38 @@ static CAddress GetBindAddress(SOCKET sock)\n     return addr_bind;\n }\n \n+bool derive_bip324_keys(ECDHSecret&& ecdh_secret, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata, BIP324Keys& derived_keys)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r762791112",
      "id" : 762791112,
      "line" : 404,
      "node_id" : "PRRC_kwDOABII584td0TI",
      "original_commit_id" : "88185dc13bcb992b2bfef95c7bf12f2efca2d07b",
      "original_line" : 404,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 20,
      "pull_request_review_id" : 823656777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762791112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T08:31:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762791112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r762793756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762793756"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The BIP currently refers to `BitcoinSharedSecret`. I guess to ack this, i'd have to see a new bip :)",
      "commit_id" : "00142e1cf85995c15e1990005240ebc9725773e4",
      "created_at" : "2021-12-06T08:35:55Z",
      "diff_hunk" : "@@ -399,6 +401,38 @@ static CAddress GetBindAddress(SOCKET sock)\n     return addr_bind;\n }\n \n+bool derive_bip324_keys(ECDHSecret&& ecdh_secret, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata, BIP324Keys& derived_keys)\n+{\n+    if (ecdh_secret.size() != ECDH_SECRET_SIZE) {\n+        return false;\n+    }\n+\n+    std::string salt{\"bitcoin_v2_shared_secret\"};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r762793756",
      "id" : 762793756,
      "line" : 410,
      "node_id" : "PRRC_kwDOABII584td08c",
      "original_commit_id" : "88185dc13bcb992b2bfef95c7bf12f2efca2d07b",
      "original_line" : 410,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 823660440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762793756/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T08:35:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762793756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r765397863"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765397863"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ":) I am working on re-structuring it. It's close. Will keep you updated here.",
      "commit_id" : "e3143a97aacf7ec43b2d4897f43da305491e35c2",
      "created_at" : "2021-12-09T02:58:59Z",
      "diff_hunk" : "@@ -399,6 +401,38 @@ static CAddress GetBindAddress(SOCKET sock)\n     return addr_bind;\n }\n \n+bool derive_bip324_keys(ECDHSecret&& ecdh_secret, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata, BIP324Keys& derived_keys)\n+{\n+    if (ecdh_secret.size() != ECDH_SECRET_SIZE) {\n+        return false;\n+    }\n+\n+    std::string salt{\"bitcoin_v2_shared_secret\"};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r765397863",
      "id" : 765397863,
      "in_reply_to_id" : 762793756,
      "line" : 411,
      "node_id" : "PRRC_kwDOABII584tnwtn",
      "original_commit_id" : "88185dc13bcb992b2bfef95c7bf12f2efca2d07b",
      "original_line" : 411,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 827156754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765397863/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T02:58:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765397863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed comments; Rebased with master to incorporate #23413. I am still investigating CI failures which seem like a timeout on Cirrus CI but re-running hasn't helped (other recent open PRs seem to be seeing this error as well). Meanwhile, ready for further review.",
      "created_at" : "2021-12-09T03:02:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-989463355",
      "id" : 989463355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII5846-gM7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989463355/reactions"
      },
      "updated_at" : "2021-12-09T03:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989463355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r765399130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765399130"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh oops. I don't know why I did that. Updated.",
      "commit_id" : "e3143a97aacf7ec43b2d4897f43da305491e35c2",
      "created_at" : "2021-12-09T03:02:56Z",
      "diff_hunk" : "@@ -399,6 +401,38 @@ static CAddress GetBindAddress(SOCKET sock)\n     return addr_bind;\n }\n \n+bool derive_bip324_keys(ECDHSecret&& ecdh_secret, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata, BIP324Keys& derived_keys)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r765399130",
      "id" : 765399130,
      "in_reply_to_id" : 762791112,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584tnxBa",
      "original_commit_id" : "88185dc13bcb992b2bfef95c7bf12f2efca2d07b",
      "original_line" : 404,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 827158496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765399130/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-09T03:02:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765399130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-18T07:51:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-997165305",
      "id" : 997165305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII5847b4j5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997165305/reactions"
      },
      "updated_at" : "2021-12-18T07:51:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/997165305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased against master. Ready for further review.",
      "created_at" : "2022-01-22T02:27:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1019020541",
      "id" : 1019020541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII5848vQT9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1019020541/reactions"
      },
      "updated_at" : "2022-01-22T02:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1019020541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r800467052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800467052"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: if you rebase this at some point, might as well update this",
      "commit_id" : "773cbc93b102a87a3ec8f852e7aca595489222a7",
      "created_at" : "2022-02-07T09:34:54Z",
      "diff_hunk" : "@@ -0,0 +1,30 @@\n+// Copyright (c) 2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r800467052",
      "id" : 800467052,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII584vtihs",
      "original_commit_id" : "773cbc93b102a87a3ec8f852e7aca595489222a7",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/bench/ecdh.cpp",
      "position" : 1,
      "pull_request_review_id" : 874403910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800467052/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T09:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/800467052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6443210?v=4",
         "events_url" : "https://api.github.com/users/PastaPastaPasta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PastaPastaPasta/followers",
         "following_url" : "https://api.github.com/users/PastaPastaPasta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PastaPastaPasta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PastaPastaPasta",
         "id" : 6443210,
         "login" : "PastaPastaPasta",
         "node_id" : "MDQ6VXNlcjY0NDMyMTA=",
         "organizations_url" : "https://api.github.com/users/PastaPastaPasta/orgs",
         "received_events_url" : "https://api.github.com/users/PastaPastaPasta/received_events",
         "repos_url" : "https://api.github.com/users/PastaPastaPasta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PastaPastaPasta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PastaPastaPasta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PastaPastaPasta"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-03T14:28:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1058096793",
      "id" : 1058096793,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII584_EUaZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1058096793/reactions"
      },
      "updated_at" : "2022-03-03T14:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1058096793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. Ready for further review.",
      "created_at" : "2022-03-11T01:30:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1064681972",
      "id" : 1064681972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII584_dcH0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064681972/reactions"
      },
      "updated_at" : "2022-03-11T01:30:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064681972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-08T14:34:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1092928328",
      "id" : 1092928328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585BJMNI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1092928328/reactions"
      },
      "updated_at" : "2022-04-08T14:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1092928328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. `git range-diff e0680bbce ea94adb 2a2cbfc1e`\r\n\r\nReady for further review.",
      "created_at" : "2022-04-09T15:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1094072090",
      "id" : 1094072090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585BNjca",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094072090/reactions"
      },
      "updated_at" : "2022-04-09T15:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094072090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-09T19:47:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1094114370",
      "id" : 1094114370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585BNtxC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094114370/reactions"
      },
      "updated_at" : "2022-04-09T19:47:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1094114370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. Ready for further review.",
      "created_at" : "2022-04-13T20:11:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1098440610",
      "id" : 1098440610,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585BeN-i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1098440610/reactions"
      },
      "updated_at" : "2022-04-13T20:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1098440610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated to use xonly ECDH as per changes being made to BIP324 before publication. Ready for further review.",
      "created_at" : "2022-04-14T16:10:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1099350904",
      "id" : 1099350904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585BhsN4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099350904/reactions"
      },
      "updated_at" : "2022-04-14T16:11:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099350904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850603486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850603486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can drop `-enable-experimental`. It should no-longer be required for `--enable-module-ecdh`, and note the missing `-` in any case.",
      "commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "created_at" : "2022-04-14T16:17:41Z",
      "diff_hunk" : "@@ -1957,7 +1957,7 @@ LIBS_TEMP=\"$LIBS\"\n unset LIBS\n LIBS=\"$LIBS_TEMP\"\n \n-ac_configure_args=\"${ac_configure_args} --disable-shared --with-pic --enable-benchmark=no --enable-module-recovery --enable-module-schnorrsig\"\n+ac_configure_args=\"${ac_configure_args} --disable-shared --with-pic --enable-benchmark=no --enable-module-recovery --enable-module-schnorrsig --enable-module-ecdh -enable-experimental\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850603486",
      "id" : 850603486,
      "line" : 1960,
      "node_id" : "PRRC_kwDOABII584ysy3e",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 1960,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "configure.ac",
      "position" : 5,
      "pull_request_review_id" : 942511239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850603486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T16:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850603486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850641745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850641745"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is unnecessary, as it's already using secure_allocator, which wipes memory on deallocation.\r\n\r\nThat said, using a vector with secure_allocator is overkill here; you can just use an array (which doesn't need allocation) - and then you do need the cleanse call.",
      "commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "created_at" : "2022-04-14T17:07:13Z",
      "diff_hunk" : "@@ -332,6 +334,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* y32, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+bool CKey::ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata,\n+                                   ECDHSecret& secret) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return false;\n+    }\n+\n+    std::vector<uint8_t, secure_allocator<uint8_t>> xonly_ecdh;\n+    xonly_ecdh.resize(ECDH_SECRET_SIZE);\n+    assert(secp256k1_ecdh(secp256k1_context_sign, xonly_ecdh.data(), &pubkey_internal,\n+                          keydata.data(), bip324_ecdh_hash, NULL));\n+\n+    CSHA256 hasher;\n+    hasher.Write(BIP324_ECDH_TAG.data(), BIP324_ECDH_TAG.size());\n+    hasher.Write(BIP324_ECDH_TAG.data(), BIP324_ECDH_TAG.size());\n+    hasher.Write(initiator_hdata.data(), initiator_hdata.size());\n+    hasher.Write(responder_hdata.data(), responder_hdata.size());\n+\n+    hasher.Write(xonly_ecdh.data(), xonly_ecdh.size());\n+\n+    secret.resize(ECDH_SECRET_SIZE);\n+    hasher.Finalize(secret.data());\n+    memory_cleanse(xonly_ecdh.data(), ECDH_SECRET_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850641745",
      "id" : 850641745,
      "line" : 367,
      "node_id" : "PRRC_kwDOABII584ys8NR",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 367,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 45,
      "pull_request_review_id" : 942563365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850641745/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T17:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850641745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850728806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850728806"
         }
      },
      "author_association" : "MEMBER",
      "body" : "These spans are unnecessary. You can just pass `initiator_hdata_vec` etc. whereever `initiator_hdata_span` is used (they get converted automatically).",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-14T19:06:25Z",
      "diff_hunk" : "@@ -914,4 +916,70 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_hdata = \"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\";\n+    static const std::string responder_hdata = \"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\";\n+\n+    auto initiator_hdata_vec = ParseHex(initiator_hdata);\n+    Span<uint8_t> initiator_hdata_span{initiator_hdata_vec.data(), initiator_hdata_vec.size()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850728806",
      "id" : 850728806,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ytRdm",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 930,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 942692576,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850728806/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T19:06:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850728806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850729539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850729539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can use `BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id)` instead here.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-14T19:07:36Z",
      "diff_hunk" : "@@ -914,4 +916,70 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_hdata = \"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\";\n+    static const std::string responder_hdata = \"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\";\n+\n+    auto initiator_hdata_vec = ParseHex(initiator_hdata);\n+    Span<uint8_t> initiator_hdata_span{initiator_hdata_vec.data(), initiator_hdata_vec.size()};\n+\n+    auto responder_hdata_vec = ParseHex(responder_hdata);\n+    Span<uint8_t> responder_hdata_span{responder_hdata_vec.data(), responder_hdata_vec.size()};\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_pubkey = initiator_key.GetPubKey();\n+    auto responder_pubkey = responder_key.GetPubKey();\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_pubkey, initiator_hdata_span, responder_hdata_span, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_pubkey, initiator_hdata_span, responder_hdata_span, responder_secret));\n+\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, initiator_secret.size());\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, responder_secret.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_secret.data(), responder_secret.data(), ECDH_SECRET_SIZE));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    BOOST_CHECK(DeriveBIP324Keys(std::move(initiator_secret), initiator_hdata_span, responder_hdata_span, initiator_keys));\n+    BOOST_CHECK(DeriveBIP324Keys(std::move(responder_secret), initiator_hdata_span, responder_hdata_span, responder_keys));\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_F.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.initiator_F.size(), responder_keys.initiator_F.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.initiator_F.data(), responder_keys.initiator_F.data(), initiator_keys.initiator_F.size()));\n+    BOOST_CHECK_EQUAL(\"fb9b2551d1ac88a7def2c2e4cfa25592ffbea4c42adf26d83fae50d5f5036415\", HexStr(Span{initiator_keys.initiator_F}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_V.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.initiator_V.size(), responder_keys.initiator_V.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.initiator_V.data(), responder_keys.initiator_V.data(), initiator_keys.initiator_V.size()));\n+    BOOST_CHECK_EQUAL(\"c141b106c8a5ae14e355ab89ca6d8e418945b7313e0d65a8d5742f1f11de5050\", HexStr(Span{initiator_keys.initiator_V}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_F.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.responder_F.size(), responder_keys.responder_F.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.responder_F.data(), responder_keys.responder_F.data(), initiator_keys.responder_F.size()));\n+    BOOST_CHECK_EQUAL(\"4a5c97a4317a0e1d65fa69d3d35a74b32ef3bdd2de9910a06709357d5584fee2\", HexStr(Span{initiator_keys.responder_F}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_V.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.responder_V.size(), responder_keys.responder_V.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.responder_V.data(), responder_keys.responder_V.data(), initiator_keys.responder_V.size()));\n+    BOOST_CHECK_EQUAL(\"94e374b822bc293b4eb3475aed2457e1b2fc9691df9ffb02afc462c36d513783\", HexStr(Span{initiator_keys.responder_V}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.session_id.size(), responder_keys.session_id.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.session_id.data(), responder_keys.session_id.data(), initiator_keys.session_id.size()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850729539",
      "id" : 850729539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ytRpD",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 980,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 942693537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850729539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T19:07:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850729539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850737479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850737479"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can also use `const CHashWriter HASHER_BIP324_ECDH = TaggedHash(\"secp256k1_ellsq_xonly_ecdh\");`, and then do the rest of the hashing using `(HashWriter(HASHER_BIP324_ECDH) << [rest of stuff] << [to hash]).GetSHA256()`. That precomputes the entire midstate after the tag.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-14T19:19:13Z",
      "diff_hunk" : "@@ -22,6 +25,14 @@\n  */\n typedef std::vector<unsigned char, secure_allocator<unsigned char> > CPrivKey;\n \n+constexpr static size_t ECDH_SECRET_SIZE = CSHA256::OUTPUT_SIZE;\n+\n+// SHA256(\"secp256k1_ellsq_xonly_ecdh\") proven with a unit test (xonly_ecdh_tag)\n+const static auto BIP324_ECDH_TAG = ParseHex(\"4dbebba5394890bf7370e9ca2ca6112941b974c56950e5c4fef7f00a2bbf3e55\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850737479",
      "id" : 850737479,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ytTlH",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 31,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 942704299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850737479/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T19:19:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850737479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850740291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850740291"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can make the arguments here take `Span<const uint8_t>` - or even `Span<const std::byte>`. I don't think this function needs to be able to mutate the passed in hdata.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-14T19:23:35Z",
      "diff_hunk" : "@@ -332,6 +334,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* y32, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+bool CKey::ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850740291",
      "id" : 850740291,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ytURD",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 344,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 942708102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850740291/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-14T19:23:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850740291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955289"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:09:49Z",
      "diff_hunk" : "@@ -0,0 +1,30 @@\n+// Copyright (c) 2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955289",
      "id" : 850955289,
      "in_reply_to_id" : 800467052,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuIwZ",
      "original_commit_id" : "773cbc93b102a87a3ec8f852e7aca595489222a7",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/bench/ecdh.cpp",
      "position" : null,
      "pull_request_review_id" : 943076848,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955289/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:09:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955445"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955445"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks. Done.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:10:00Z",
      "diff_hunk" : "@@ -1957,7 +1957,7 @@ LIBS_TEMP=\"$LIBS\"\n unset LIBS\n LIBS=\"$LIBS_TEMP\"\n \n-ac_configure_args=\"${ac_configure_args} --disable-shared --with-pic --enable-benchmark=no --enable-module-recovery --enable-module-schnorrsig\"\n+ac_configure_args=\"${ac_configure_args} --disable-shared --with-pic --enable-benchmark=no --enable-module-recovery --enable-module-schnorrsig --enable-module-ecdh -enable-experimental\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955445",
      "id" : 850955445,
      "in_reply_to_id" : 850603486,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuIy1",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 1960,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "configure.ac",
      "position" : null,
      "pull_request_review_id" : 943076911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955445/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955445",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955813"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done - simpler with array + cleanse.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:10:28Z",
      "diff_hunk" : "@@ -332,6 +334,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* y32, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+bool CKey::ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata,\n+                                   ECDHSecret& secret) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return false;\n+    }\n+\n+    std::vector<uint8_t, secure_allocator<uint8_t>> xonly_ecdh;\n+    xonly_ecdh.resize(ECDH_SECRET_SIZE);\n+    assert(secp256k1_ecdh(secp256k1_context_sign, xonly_ecdh.data(), &pubkey_internal,\n+                          keydata.data(), bip324_ecdh_hash, NULL));\n+\n+    CSHA256 hasher;\n+    hasher.Write(BIP324_ECDH_TAG.data(), BIP324_ECDH_TAG.size());\n+    hasher.Write(BIP324_ECDH_TAG.data(), BIP324_ECDH_TAG.size());\n+    hasher.Write(initiator_hdata.data(), initiator_hdata.size());\n+    hasher.Write(responder_hdata.data(), responder_hdata.size());\n+\n+    hasher.Write(xonly_ecdh.data(), xonly_ecdh.size());\n+\n+    secret.resize(ECDH_SECRET_SIZE);\n+    hasher.Finalize(secret.data());\n+    memory_cleanse(xonly_ecdh.data(), ECDH_SECRET_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955813",
      "id" : 850955813,
      "in_reply_to_id" : 850641745,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuI4l",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 367,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 943077043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955813/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:10:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:10:40Z",
      "diff_hunk" : "@@ -914,4 +916,70 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_hdata = \"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\";\n+    static const std::string responder_hdata = \"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\";\n+\n+    auto initiator_hdata_vec = ParseHex(initiator_hdata);\n+    Span<uint8_t> initiator_hdata_span{initiator_hdata_vec.data(), initiator_hdata_vec.size()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850955968",
      "id" : 850955968,
      "in_reply_to_id" : 850728806,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuI7A",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 930,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 943077104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850955968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850956064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956064"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:10:47Z",
      "diff_hunk" : "@@ -914,4 +916,70 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_hdata = \"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\";\n+    static const std::string responder_hdata = \"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\";\n+\n+    auto initiator_hdata_vec = ParseHex(initiator_hdata);\n+    Span<uint8_t> initiator_hdata_span{initiator_hdata_vec.data(), initiator_hdata_vec.size()};\n+\n+    auto responder_hdata_vec = ParseHex(responder_hdata);\n+    Span<uint8_t> responder_hdata_span{responder_hdata_vec.data(), responder_hdata_vec.size()};\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_pubkey = initiator_key.GetPubKey();\n+    auto responder_pubkey = responder_key.GetPubKey();\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_pubkey, initiator_hdata_span, responder_hdata_span, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_pubkey, initiator_hdata_span, responder_hdata_span, responder_secret));\n+\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, initiator_secret.size());\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, responder_secret.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_secret.data(), responder_secret.data(), ECDH_SECRET_SIZE));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    BOOST_CHECK(DeriveBIP324Keys(std::move(initiator_secret), initiator_hdata_span, responder_hdata_span, initiator_keys));\n+    BOOST_CHECK(DeriveBIP324Keys(std::move(responder_secret), initiator_hdata_span, responder_hdata_span, responder_keys));\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_F.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.initiator_F.size(), responder_keys.initiator_F.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.initiator_F.data(), responder_keys.initiator_F.data(), initiator_keys.initiator_F.size()));\n+    BOOST_CHECK_EQUAL(\"fb9b2551d1ac88a7def2c2e4cfa25592ffbea4c42adf26d83fae50d5f5036415\", HexStr(Span{initiator_keys.initiator_F}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_V.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.initiator_V.size(), responder_keys.initiator_V.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.initiator_V.data(), responder_keys.initiator_V.data(), initiator_keys.initiator_V.size()));\n+    BOOST_CHECK_EQUAL(\"c141b106c8a5ae14e355ab89ca6d8e418945b7313e0d65a8d5742f1f11de5050\", HexStr(Span{initiator_keys.initiator_V}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_F.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.responder_F.size(), responder_keys.responder_F.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.responder_F.data(), responder_keys.responder_F.data(), initiator_keys.responder_F.size()));\n+    BOOST_CHECK_EQUAL(\"4a5c97a4317a0e1d65fa69d3d35a74b32ef3bdd2de9910a06709357d5584fee2\", HexStr(Span{initiator_keys.responder_F}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_V.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.responder_V.size(), responder_keys.responder_V.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.responder_V.data(), responder_keys.responder_V.data(), initiator_keys.responder_V.size()));\n+    BOOST_CHECK_EQUAL(\"94e374b822bc293b4eb3475aed2457e1b2fc9691df9ffb02afc462c36d513783\", HexStr(Span{initiator_keys.responder_V}));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK_EQUAL(initiator_keys.session_id.size(), responder_keys.session_id.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_keys.session_id.data(), responder_keys.session_id.data(), initiator_keys.session_id.size()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850956064",
      "id" : 850956064,
      "in_reply_to_id" : 850729539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuI8g",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 980,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 943077141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956064/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:10:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850956520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956520"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Super nice change - much cleaner. Thanks for showing me that. Done.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:11:17Z",
      "diff_hunk" : "@@ -22,6 +25,14 @@\n  */\n typedef std::vector<unsigned char, secure_allocator<unsigned char> > CPrivKey;\n \n+constexpr static size_t ECDH_SECRET_SIZE = CSHA256::OUTPUT_SIZE;\n+\n+// SHA256(\"secp256k1_ellsq_xonly_ecdh\") proven with a unit test (xonly_ecdh_tag)\n+const static auto BIP324_ECDH_TAG = ParseHex(\"4dbebba5394890bf7370e9ca2ca6112941b974c56950e5c4fef7f00a2bbf3e55\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850956520",
      "id" : 850956520,
      "in_reply_to_id" : 850737479,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuJDo",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 31,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 943077292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:11:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850956627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956627"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-04-15T01:11:24Z",
      "diff_hunk" : "@@ -332,6 +334,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* y32, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+bool CKey::ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r850956627",
      "id" : 850956627,
      "in_reply_to_id" : 850740291,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584yuJFT",
      "original_commit_id" : "f0b520b17c3ecf4176c53b3752d1cb761d67ffe3",
      "original_line" : 344,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 943077332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956627/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-15T01:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/850956627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed review comments from @fanquake and @sipa. Ready for further review.",
      "created_at" : "2022-04-15T01:11:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1099765312",
      "id" : 1099765312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585BjRZA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099765312/reactions"
      },
      "updated_at" : "2022-04-15T01:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099765312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r867312810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867312810"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "to match the [64 bytes encoding](https://github.com/bitcoin/bitcoin/blob/c9db50bc2f8674913e785384c0e323c2df71754d/src/test/net_tests.cpp#L926) in commit c9db50b.\r\n```suggestion\r\n    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\");\r\n```",
      "commit_id" : "69dc0985490da8513206718a97fb4400847b6481",
      "created_at" : "2022-05-07T06:36:52Z",
      "diff_hunk" : "@@ -344,4 +345,33 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e96c66365b4d38eefd0a883be64112f4495\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r867312810",
      "id" : 867312810,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII584zsiSq",
      "original_commit_id" : "2ec727ee616a9ed699c4d2fb00005bec81dc9954",
      "original_line" : 354,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/test/key_tests.cpp",
      "position" : 18,
      "pull_request_review_id" : 965298394,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867312810/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-07T06:39:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867312810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-13T07:39:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1125750670",
      "id" : 1125750670,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585DGZeO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125750670/reactions"
      },
      "updated_at" : "2022-05-13T07:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125750670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r919522522"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919522522"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! Done.",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-12T23:58:49Z",
      "diff_hunk" : "@@ -344,4 +345,33 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e96c66365b4d38eefd0a883be64112f4495\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r919522522",
      "id" : 919522522,
      "in_reply_to_id" : 867312810,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842zsza",
      "original_commit_id" : "2ec727ee616a9ed699c4d2fb00005bec81dc9954",
      "original_line" : 354,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/test/key_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1036602360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919522522/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-12T23:58:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919522522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This push:\r\n- Rebased\r\n- Addressed comment from @theStack - there's cleansing in the right place and tests for it so we can indeed use `std::array` instead of a secure vector.\r\n- Addressed comment from @stratospher \r\n- Added a couple more derived secrets per new spec in the working group\r\n\r\nReady for further review.",
      "created_at" : "2022-07-13T00:01:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1182609473",
      "id" : 1182609473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585GfTBB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1182609473/reactions"
      },
      "updated_at" : "2022-07-13T00:01:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1182609473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921012980"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921012980"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "According to our guidelines, assertions shouldn't have side-effects (see https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#general-c).\r\n```suggestion\r\n    if (!secp256k1_ecdh(secp256k1_context_sign, xonly_ecdh, &pubkey_internal,\r\n                        keydata.data(), bip324_ecdh_hash, nullptr)) {\r\n        assert(false);\r\n    }\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T10:40:21Z",
      "diff_hunk" : "@@ -332,6 +334,34 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* y32, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+bool CKey::ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<const uint8_t> initiator_hdata, const Span<const uint8_t> responder_hdata,\n+                                   ECDHSecret& secret) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return false;\n+    }\n+\n+    uint8_t xonly_ecdh[ECDH_SECRET_SIZE];\n+    assert(secp256k1_ecdh(secp256k1_context_sign, xonly_ecdh, &pubkey_internal,\n+                          keydata.data(), bip324_ecdh_hash, nullptr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921012980",
      "id" : 921012980,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII58425Yr0",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 354,
      "original_position" : 32,
      "original_start_line" : 353,
      "path" : "src/key.cpp",
      "position" : 32,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921012980/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 353,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-14T11:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921012980",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921018820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921018820"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: An alternative, probably more modern interface would be to return `std::optional<ECDHSecret>` instead of storing the result in an out-parameter.\r\n```suggestion\r\n    // Returns std::nullopt if an invalid public key is provided\r\n    std::optional<ECDHSecret> ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<const uint8_t> initiator_hdata, const Span<const uint8_t> responder_hdata) const;\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T10:47:11Z",
      "diff_hunk" : "@@ -156,6 +166,10 @@ class CKey\n \n     //! Load private key and check that public key matches.\n     bool Load(const CPrivKey& privkey, const CPubKey& vchPubKey, bool fSkipCheck);\n+\n+    // Returns false if an invalid public key is provided\n+    bool ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<const uint8_t> initiator_hdata, const Span<const uint8_t> responder_hdata,\n+                                 ECDHSecret& secret) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921018820",
      "id" : 921018820,
      "line" : 172,
      "node_id" : "PRRC_kwDOABII58425aHE",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 172,
      "original_position" : 36,
      "original_start_line" : 170,
      "path" : "src/key.h",
      "position" : 36,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921018820/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 170,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-14T11:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921018820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921019942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921019942"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: These checks obviously don't hurt, but now that ECDHSecret uses `std::array` and has it's size fixed at compile-time, they are not that useful anymore.\r\n```suggestion\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T10:48:41Z",
      "diff_hunk" : "@@ -344,4 +345,33 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\");\n+    auto responder_hdata_vec = ParseHex(\"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\");\n+\n+    Span<uint8_t> initiator_hdata{initiator_hdata_vec.data(), initiator_hdata_vec.size()};\n+    Span<uint8_t> responder_hdata{responder_hdata_vec.data(), responder_hdata_vec.size()};\n+\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_key.GetPubKey(), initiator_hdata, responder_hdata, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_key.GetPubKey(), initiator_hdata, responder_hdata, responder_secret));\n+    BOOST_CHECK_EQUAL(initiator_secret.size(), ECDH_SECRET_SIZE);\n+    BOOST_CHECK_EQUAL(responder_secret.size(), ECDH_SECRET_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921019942",
      "id" : 921019942,
      "line" : 363,
      "node_id" : "PRRC_kwDOABII58425aYm",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 363,
      "original_position" : 27,
      "original_start_line" : 362,
      "path" : "src/test/key_tests.cpp",
      "position" : 27,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921019942/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 362,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-14T11:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921019942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921022051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921022051"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could simply use `operator==` of `std::array` here:\r\n```suggestion\r\n    BOOST_CHECK(initiator_secret == responder_secret);\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T10:51:29Z",
      "diff_hunk" : "@@ -344,4 +345,33 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\");\n+    auto responder_hdata_vec = ParseHex(\"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\");\n+\n+    Span<uint8_t> initiator_hdata{initiator_hdata_vec.data(), initiator_hdata_vec.size()};\n+    Span<uint8_t> responder_hdata{responder_hdata_vec.data(), responder_hdata_vec.size()};\n+\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_key.GetPubKey(), initiator_hdata, responder_hdata, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_key.GetPubKey(), initiator_hdata, responder_hdata, responder_secret));\n+    BOOST_CHECK_EQUAL(initiator_secret.size(), ECDH_SECRET_SIZE);\n+    BOOST_CHECK_EQUAL(responder_secret.size(), ECDH_SECRET_SIZE);\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_secret.data(), responder_secret.data(), ECDH_SECRET_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921022051",
      "id" : 921022051,
      "line" : 364,
      "node_id" : "PRRC_kwDOABII58425a5j",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 364,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/key_tests.cpp",
      "position" : 28,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921022051/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T11:03:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921022051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921024909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921024909"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    assert(ecdh_secret_1 == ecdh_secret_2);\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T10:55:10Z",
      "diff_hunk" : "@@ -306,3 +307,40 @@ FUZZ_TARGET_INIT(key, initialize_key)\n         }\n     }\n }\n+\n+FUZZ_TARGET_INIT(ecdh, initialize_key)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    auto rnd32 = fuzzed_data_provider.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k1;\n+    k1.Set(rnd32.begin(), rnd32.end(), true);\n+\n+    if (!k1.IsValid()) {\n+        return;\n+    }\n+\n+    rnd32 = fuzzed_data_provider.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k2;\n+    k2.Set(rnd32.begin(), rnd32.end(), true);\n+\n+    if (!k2.IsValid()) {\n+        return;\n+    }\n+\n+    auto k1_ellsq = fuzzed_data_provider.ConsumeBytes<uint8_t>(64);\n+    k1_ellsq.resize(64);\n+\n+    auto k2_ellsq = fuzzed_data_provider.ConsumeBytes<uint8_t>(64);\n+    k2_ellsq.resize(64);\n+\n+    CPubKey k1_pubkey = k1.GetPubKey();\n+    CPubKey k2_pubkey = k2.GetPubKey();\n+    ECDHSecret ecdh_secret_1, ecdh_secret_2;\n+    assert(k1.ComputeBIP324ECDHSecret(k2_pubkey, k1_ellsq, k2_ellsq, ecdh_secret_1));\n+    assert(k2.ComputeBIP324ECDHSecret(k1_pubkey, k1_ellsq, k2_ellsq, ecdh_secret_2));\n+    assert(ecdh_secret_1.size() == ECDH_SECRET_SIZE);\n+    assert(ecdh_secret_2.size() == ECDH_SECRET_SIZE);\n+    assert(memcmp(ecdh_secret_1.data(), ecdh_secret_2.data(), ECDH_SECRET_SIZE) == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921024909",
      "id" : 921024909,
      "line" : 345,
      "node_id" : "PRRC_kwDOABII58425bmN",
      "original_commit_id" : "b02d45c004613dd6f5591bc274210495584d9447",
      "original_line" : 345,
      "original_position" : 47,
      "original_start_line" : 343,
      "path" : "src/test/fuzz/key.cpp",
      "position" : 47,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921024909/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 343,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-14T11:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921024909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921027001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921027001"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since `ECDHSecret` has a fixed size (`std::array<uint8_t, ECDH_SECRET_SIZE>`), this is dead code now and can be removed.\r\n```suggestion\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T10:57:45Z",
      "diff_hunk" : "@@ -438,6 +440,42 @@ static CAddress GetBindAddress(const Sock& sock)\n     return addr_bind;\n }\n \n+bool DeriveBIP324Keys(ECDHSecret&& ecdh_secret, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata, BIP324Keys& derived_keys)\n+{\n+    if (ecdh_secret.size() != ECDH_SECRET_SIZE) {\n+        return false;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921027001",
      "id" : 921027001,
      "line" : 448,
      "node_id" : "PRRC_kwDOABII58425cG5",
      "original_commit_id" : "200c3b4787f1b455d59a88ecefbdd94c13ce1e62",
      "original_line" : 448,
      "original_position" : 25,
      "original_start_line" : 445,
      "path" : "src/net.cpp",
      "position" : 25,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921027001/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 445,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-14T11:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921027001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921029203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921029203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    BOOST_CHECK(initiator_secret == responder_secret);\r\n```",
      "commit_id" : "5f6ca968fbeba9ecc6a56159532c4834920d9d8c",
      "created_at" : "2022-07-14T11:00:39Z",
      "diff_hunk" : "@@ -917,4 +919,73 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_hdata = \"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\";\n+    static const std::string responder_hdata = \"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\";\n+\n+    auto initiator_hdata_vec = ParseHex(initiator_hdata);\n+    auto responder_hdata_vec = ParseHex(responder_hdata);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_pubkey = initiator_key.GetPubKey();\n+    auto responder_pubkey = responder_key.GetPubKey();\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_pubkey, initiator_hdata_vec, responder_hdata_vec, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_pubkey, initiator_hdata_vec, responder_hdata_vec, responder_secret));\n+\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, initiator_secret.size());\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, responder_secret.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_secret.data(), responder_secret.data(), ECDH_SECRET_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r921029203",
      "id" : 921029203,
      "line" : 947,
      "node_id" : "PRRC_kwDOABII58425cpT",
      "original_commit_id" : "200c3b4787f1b455d59a88ecefbdd94c13ce1e62",
      "original_line" : 947,
      "original_position" : 38,
      "original_start_line" : 944,
      "path" : "src/test/net_tests.cpp",
      "position" : 38,
      "pull_request_review_id" : 1038661558,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921029203/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 944,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-14T11:02:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921029203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549421"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for teaching me this. Done.",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:05:41Z",
      "diff_hunk" : "@@ -332,6 +334,34 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* y32, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+bool CKey::ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<const uint8_t> initiator_hdata, const Span<const uint8_t> responder_hdata,\n+                                   ECDHSecret& secret) const\n+{\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return false;\n+    }\n+\n+    uint8_t xonly_ecdh[ECDH_SECRET_SIZE];\n+    assert(secp256k1_ecdh(secp256k1_context_sign, xonly_ecdh, &pubkey_internal,\n+                          keydata.data(), bip324_ecdh_hash, nullptr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549421",
      "id" : 923549421,
      "in_reply_to_id" : 921012980,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DD7t",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 354,
      "original_position" : 32,
      "original_start_line" : 353,
      "path" : "src/key.cpp",
      "position" : null,
      "pull_request_review_id" : 1042105709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549421/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-18T16:05:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. ",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:05:49Z",
      "diff_hunk" : "@@ -156,6 +166,10 @@ class CKey\n \n     //! Load private key and check that public key matches.\n     bool Load(const CPrivKey& privkey, const CPubKey& vchPubKey, bool fSkipCheck);\n+\n+    // Returns false if an invalid public key is provided\n+    bool ComputeBIP324ECDHSecret(const CPubKey& pubkey, const Span<const uint8_t> initiator_hdata, const Span<const uint8_t> responder_hdata,\n+                                 ECDHSecret& secret) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549534",
      "id" : 923549534,
      "in_reply_to_id" : 921018820,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DD9e",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 172,
      "original_position" : 36,
      "original_start_line" : 170,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 1042105883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-18T16:05:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549638"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:05:55Z",
      "diff_hunk" : "@@ -344,4 +345,33 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\");\n+    auto responder_hdata_vec = ParseHex(\"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\");\n+\n+    Span<uint8_t> initiator_hdata{initiator_hdata_vec.data(), initiator_hdata_vec.size()};\n+    Span<uint8_t> responder_hdata{responder_hdata_vec.data(), responder_hdata_vec.size()};\n+\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_key.GetPubKey(), initiator_hdata, responder_hdata, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_key.GetPubKey(), initiator_hdata, responder_hdata, responder_secret));\n+    BOOST_CHECK_EQUAL(initiator_secret.size(), ECDH_SECRET_SIZE);\n+    BOOST_CHECK_EQUAL(responder_secret.size(), ECDH_SECRET_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549638",
      "id" : 923549638,
      "in_reply_to_id" : 921019942,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DD_G",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 363,
      "original_position" : 27,
      "original_start_line" : 362,
      "path" : "src/test/key_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1042106012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549638/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-18T16:05:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549638",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:06:00Z",
      "diff_hunk" : "@@ -344,4 +345,33 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    auto initiator_hdata_vec = ParseHex(\"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\");\n+    auto responder_hdata_vec = ParseHex(\"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\");\n+\n+    Span<uint8_t> initiator_hdata{initiator_hdata_vec.data(), initiator_hdata_vec.size()};\n+    Span<uint8_t> responder_hdata{responder_hdata_vec.data(), responder_hdata_vec.size()};\n+\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_key.GetPubKey(), initiator_hdata, responder_hdata, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_key.GetPubKey(), initiator_hdata, responder_hdata, responder_secret));\n+    BOOST_CHECK_EQUAL(initiator_secret.size(), ECDH_SECRET_SIZE);\n+    BOOST_CHECK_EQUAL(responder_secret.size(), ECDH_SECRET_SIZE);\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_secret.data(), responder_secret.data(), ECDH_SECRET_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549735",
      "id" : 923549735,
      "in_reply_to_id" : 921022051,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DEAn",
      "original_commit_id" : "71e53c0682d14c011e1aea9aec81586742d80d39",
      "original_line" : 364,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/key_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1042106134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-18T16:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549834"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:06:06Z",
      "diff_hunk" : "@@ -306,3 +307,40 @@ FUZZ_TARGET_INIT(key, initialize_key)\n         }\n     }\n }\n+\n+FUZZ_TARGET_INIT(ecdh, initialize_key)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    auto rnd32 = fuzzed_data_provider.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k1;\n+    k1.Set(rnd32.begin(), rnd32.end(), true);\n+\n+    if (!k1.IsValid()) {\n+        return;\n+    }\n+\n+    rnd32 = fuzzed_data_provider.ConsumeBytes<uint8_t>(32);\n+    rnd32.resize(32);\n+    CKey k2;\n+    k2.Set(rnd32.begin(), rnd32.end(), true);\n+\n+    if (!k2.IsValid()) {\n+        return;\n+    }\n+\n+    auto k1_ellsq = fuzzed_data_provider.ConsumeBytes<uint8_t>(64);\n+    k1_ellsq.resize(64);\n+\n+    auto k2_ellsq = fuzzed_data_provider.ConsumeBytes<uint8_t>(64);\n+    k2_ellsq.resize(64);\n+\n+    CPubKey k1_pubkey = k1.GetPubKey();\n+    CPubKey k2_pubkey = k2.GetPubKey();\n+    ECDHSecret ecdh_secret_1, ecdh_secret_2;\n+    assert(k1.ComputeBIP324ECDHSecret(k2_pubkey, k1_ellsq, k2_ellsq, ecdh_secret_1));\n+    assert(k2.ComputeBIP324ECDHSecret(k1_pubkey, k1_ellsq, k2_ellsq, ecdh_secret_2));\n+    assert(ecdh_secret_1.size() == ECDH_SECRET_SIZE);\n+    assert(ecdh_secret_2.size() == ECDH_SECRET_SIZE);\n+    assert(memcmp(ecdh_secret_1.data(), ecdh_secret_2.data(), ECDH_SECRET_SIZE) == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923549834",
      "id" : 923549834,
      "in_reply_to_id" : 921024909,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DECK",
      "original_commit_id" : "b02d45c004613dd6f5591bc274210495584d9447",
      "original_line" : 345,
      "original_position" : 47,
      "original_start_line" : 343,
      "path" : "src/test/fuzz/key.cpp",
      "position" : null,
      "pull_request_review_id" : 1042106262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549834/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-18T16:06:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923549834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923550203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923550203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. This also let me optimize the interface to the function as it always succeeds now.",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:06:28Z",
      "diff_hunk" : "@@ -438,6 +440,42 @@ static CAddress GetBindAddress(const Sock& sock)\n     return addr_bind;\n }\n \n+bool DeriveBIP324Keys(ECDHSecret&& ecdh_secret, const Span<uint8_t> initiator_hdata, const Span<uint8_t> responder_hdata, BIP324Keys& derived_keys)\n+{\n+    if (ecdh_secret.size() != ECDH_SECRET_SIZE) {\n+        return false;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923550203",
      "id" : 923550203,
      "in_reply_to_id" : 921027001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DEH7",
      "original_commit_id" : "200c3b4787f1b455d59a88ecefbdd94c13ce1e62",
      "original_line" : 448,
      "original_position" : 25,
      "original_start_line" : 445,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1042106764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923550203/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-18T16:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923550203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923550345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923550345"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "2d0b526b54fb9c718ff121caca6f9aaf6df6eb51",
      "created_at" : "2022-07-18T16:06:37Z",
      "diff_hunk" : "@@ -917,4 +919,73 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_hdata = \"2deb41da6887640dda029ae41c9c9958881d0bb8e28f6bb9039ee9b7bb11091d62f4cbe65cc418df7aefd738f4d3e926c66365b4d38eefd0a883be64112f4495\";\n+    static const std::string responder_hdata = \"4c469c70ba242ae0fc98d4eff6258cf19ecab96611c9c736356a4cf11d66edfa4d2970e56744a6d071861a4cbe2730eb7733a38b166e3df73450ef37112dd32f\";\n+\n+    auto initiator_hdata_vec = ParseHex(initiator_hdata);\n+    auto responder_hdata_vec = ParseHex(responder_hdata);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_pubkey = initiator_key.GetPubKey();\n+    auto responder_pubkey = responder_key.GetPubKey();\n+\n+    ECDHSecret initiator_secret, responder_secret;\n+    BOOST_CHECK(initiator_key.ComputeBIP324ECDHSecret(responder_pubkey, initiator_hdata_vec, responder_hdata_vec, initiator_secret));\n+    BOOST_CHECK(responder_key.ComputeBIP324ECDHSecret(initiator_pubkey, initiator_hdata_vec, responder_hdata_vec, responder_secret));\n+\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, initiator_secret.size());\n+    BOOST_CHECK_EQUAL(ECDH_SECRET_SIZE, responder_secret.size());\n+    BOOST_CHECK_EQUAL(0, memcmp(initiator_secret.data(), responder_secret.data(), ECDH_SECRET_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r923550345",
      "id" : 923550345,
      "in_reply_to_id" : 921029203,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843DEKJ",
      "original_commit_id" : "200c3b4787f1b455d59a88ecefbdd94c13ce1e62",
      "original_line" : 947,
      "original_position" : 38,
      "original_start_line" : 944,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1042106960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923550345/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-07-18T16:06:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/923550345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest push:\r\n- Rebased\r\n- Addressed comments form @theStack\r\n- The new HKDF derivation no longer needs the elligator swift bytes from the handshake as those are committed to in the initial ECDH.\r\n- This PR now depends on it's anagram #25361 for some constants which simplify the downstream PR #24545. Only last 5 commits belong to this PR.\r\n\r\nReady for further review.",
      "created_at" : "2022-07-18T16:07:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1187687305",
      "id" : 1187687305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585GyquJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1187687305/reactions"
      },
      "updated_at" : "2022-07-18T16:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1187687305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest push:\r\n- This PR now depends on [integrated XDH](https://github.com/bitcoin-core/secp256k1/pull/1129) rather than the ECDH module in libsecp256k1\r\n\r\nReady for further review. I don't yet know what's happening with the vs2022 tests on CI, but I will address that once https://github.com/bitcoin-core/secp256k1/pull/1129 is merged.",
      "created_at" : "2022-07-22T19:53:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1192890201",
      "id" : 1192890201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585HGg9Z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192890201/reactions"
      },
      "updated_at" : "2022-07-22T20:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1192890201",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r928122428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/928122428"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The new ellswift API has a function `secp256k1_ellswift_create` which goes directly from private key + randomness to ellswift encoding, bypassing the need for encoding the public key in the traditional form.",
      "commit_id" : "9f1b84c2830d64bedc3e0c8b1014d581048274cd",
      "created_at" : "2022-07-23T13:14:32Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <pubkey.h>\n+#include <random.h>\n+#include <secp256k1.h>\n+#include <secp256k1_ellswift.h>\n+\n+#include <cstddef>\n+\n+CKey GetRandomKey()\n+{\n+    CKey key;\n+    key.MakeNewKey(true);\n+    return key;\n+}\n+\n+void GetEll64(const CPubKey& pubkey, unsigned char* ell64) {\n+    auto ctx = GetVerifyContext();\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(ctx, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return;\n+    }\n+\n+    std::array<unsigned char, 32> rnd32;\n+    GetRandBytes(rnd32);\n+    secp256k1_ellswift_encode(ctx, ell64, &pubkey_internal, rnd32.data());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r928122428",
      "id" : 928122428,
      "line" : 31,
      "node_id" : "PRRC_kwDOABII5843UgY8",
      "original_commit_id" : "9f1b84c2830d64bedc3e0c8b1014d581048274cd",
      "original_line" : 31,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/bench/bip324_ecdh.cpp",
      "position" : 31,
      "pull_request_review_id" : 1048536180,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/928122428/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-23T13:14:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/928122428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r930357420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930357420"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Much nicer. Thank you for the reminder. Done.",
      "commit_id" : "97c6ea6d22bd61ff8b1f1ac863005851c568fb5b",
      "created_at" : "2022-07-26T19:54:23Z",
      "diff_hunk" : "@@ -0,0 +1,54 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+\n+#include <key.h>\n+#include <pubkey.h>\n+#include <random.h>\n+#include <secp256k1.h>\n+#include <secp256k1_ellswift.h>\n+\n+#include <cstddef>\n+\n+CKey GetRandomKey()\n+{\n+    CKey key;\n+    key.MakeNewKey(true);\n+    return key;\n+}\n+\n+void GetEll64(const CPubKey& pubkey, unsigned char* ell64) {\n+    auto ctx = GetVerifyContext();\n+    secp256k1_pubkey pubkey_internal;\n+    if (!secp256k1_ec_pubkey_parse(ctx, &pubkey_internal, pubkey.data(), pubkey.size())) {\n+        return;\n+    }\n+\n+    std::array<unsigned char, 32> rnd32;\n+    GetRandBytes(rnd32);\n+    secp256k1_ellswift_encode(ctx, ell64, &pubkey_internal, rnd32.data());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r930357420",
      "id" : 930357420,
      "in_reply_to_id" : 928122428,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5843dCCs",
      "original_commit_id" : "9f1b84c2830d64bedc3e0c8b1014d581048274cd",
      "original_line" : 31,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/bench/bip324_ecdh.cpp",
      "position" : null,
      "pull_request_review_id" : 1051537568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930357420/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-26T19:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/930357420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed comments. Ready for further review.",
      "created_at" : "2022-07-26T19:54:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1195915880",
      "id" : 1195915880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585HSDpo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1195915880/reactions"
      },
      "updated_at" : "2022-07-26T19:54:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1195915880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added rekeying salt to key derivation. Ready for further review.",
      "created_at" : "2022-08-01T17:22:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1201494401",
      "id" : 1201494401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585HnVmB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201494401/reactions"
      },
      "updated_at" : "2022-08-01T17:22:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201494401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958524234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958524234"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 789d8bb: this would be the ECDH secret - `ae1b0c44c3c38aa5206899c0928ca51f637e3ec05771b4a6c0662b46b76049d8`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T14:01:48Z",
      "diff_hunk" : "@@ -344,4 +346,29 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_ellswift = ParseHex(\"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\");\n+    auto responder_ellswift = ParseHex(\"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\");\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958524234",
      "id" : 958524234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845IetK",
      "original_commit_id" : "789d8bb80ab71a32ddf64b1242d11fa9e333d762",
      "original_line" : 363,
      "original_position" : 34,
      "original_start_line" : 362,
      "path" : "src/test/key_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958524234/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958524234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958526002"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958526002"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 789d8bb8: s/secp256k1_ellsq_xonly_ecdh/secp256k1_ellswift_xonly_ecdh",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T14:03:13Z",
      "diff_hunk" : "@@ -22,6 +28,12 @@\n  */\n typedef std::vector<unsigned char, secure_allocator<unsigned char> > CPrivKey;\n \n+constexpr static size_t ECDH_SECRET_SIZE = CSHA256::OUTPUT_SIZE;\n+const auto HASHER_BIP324_ECDH = TaggedHash(\"secp256k1_ellsq_xonly_ecdh\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958526002",
      "id" : 958526002,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845IfIy",
      "original_commit_id" : "789d8bb80ab71a32ddf64b1242d11fa9e333d762",
      "original_line" : 32,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958526002/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958526002",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958538781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958538781"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 789d8bb: would it be useful to keep the `TaggedHash()` function call similar to other calls in [the codebase](https://github.com/bitcoin/bitcoin/blob/cfda740b332c77800f9bb2506d840dad3f4938c0/src/pubkey.cpp#L214)?\r\n```suggestion\r\nconst HashWriter HASHER_BIP324_ECDH{TaggedHash(\"secp256k1_ellswift_xonly_ecdh\")};\r\n```",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T14:13:41Z",
      "diff_hunk" : "@@ -22,6 +28,12 @@\n  */\n typedef std::vector<unsigned char, secure_allocator<unsigned char> > CPrivKey;\n \n+constexpr static size_t ECDH_SECRET_SIZE = CSHA256::OUTPUT_SIZE;\n+const auto HASHER_BIP324_ECDH = TaggedHash(\"secp256k1_ellsq_xonly_ecdh\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958538781",
      "id" : 958538781,
      "in_reply_to_id" : 958526002,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845IiQd",
      "original_commit_id" : "789d8bb80ab71a32ddf64b1242d11fa9e333d762",
      "original_line" : 32,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958538781/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958538781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958660692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958660692"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009b: ECDH secret is `ae1b0c44c3c38aa5206899c0928ca51f637e3ec05771b4a6c0662b46b76049d8`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T15:53:41Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958660692",
      "id" : 958660692,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JABU",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 933,
      "original_position" : 35,
      "original_start_line" : 932,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958660692/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958660692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958762184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958762184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `98b1a948d70374db8078475fd2b573789989a57d5394ecc229a3f2ec336c4d18`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:40:24Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958762184",
      "id" : 958762184,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JYzI",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 946,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958762184/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958762184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958764152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958764152"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `95bdf50958c46ad24c7646cd7bf7579ffafb2f032d2c5356fc8341e198d0bb51`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:42:42Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958764152",
      "id" : 958764152,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JZR4",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 950,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958764152/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958764152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958766225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958766225"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `0dec3e671918898ce5472b161ddfcc6f765bf459e8cdeb86825fa704a58546e5`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:44:47Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958766225",
      "id" : 958766225,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JZyR",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 954,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958766225/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958766225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958766665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958766665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `af8b74244dd43c5921e2449a125d669f6d82a23250fa040eafc3ba2373067de5`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:45:19Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958766665",
      "id" : 958766665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JZ5J",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 958,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958766665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958766665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958767066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958767066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `ae605e623a8f710f4f0c99454d74cdfb8861cad1f8f6dd2eb86390d615efab01`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:45:47Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"e6b4d42bc1fbce790cf7b419d0128c7caf319b491acfd9fd874f29ca3843fe40\", HexStr(initiator_keys.session_id));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958767066",
      "id" : 958767066,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JZ_a",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 962,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958767066/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958767066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958767405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958767405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `e46620b5e10052931401606ccbb4c810c4f9afa9db948e3acfbeaa65b0cc8199`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:46:10Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"e6b4d42bc1fbce790cf7b419d0128c7caf319b491acfd9fd874f29ca3843fe40\", HexStr(initiator_keys.session_id));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.rekey_salt.size());\n+    BOOST_CHECK(initiator_keys.rekey_salt == responder_keys.rekey_salt);\n+    BOOST_CHECK_EQUAL(\"060d26411cdedabda638b1a807d0b68cbbb326385881409fcd2f5705091c5842\", HexStr(initiator_keys.rekey_salt));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958767405",
      "id" : 958767405,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JaEt",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 966,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958767405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958767405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958768072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958768072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in 4220009: `73d7412ff3b42a01`",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-08-30T17:46:58Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"e6b4d42bc1fbce790cf7b419d0128c7caf319b491acfd9fd874f29ca3843fe40\", HexStr(initiator_keys.session_id));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.rekey_salt.size());\n+    BOOST_CHECK(initiator_keys.rekey_salt == responder_keys.rekey_salt);\n+    BOOST_CHECK_EQUAL(\"060d26411cdedabda638b1a807d0b68cbbb326385881409fcd2f5705091c5842\", HexStr(initiator_keys.rekey_salt));\n+\n+    BOOST_CHECK_EQUAL(BIP324_GARBAGE_TERMINATOR_LEN, initiator_keys.garbage_terminator.size());\n+    BOOST_CHECK(initiator_keys.garbage_terminator == responder_keys.garbage_terminator);\n+    BOOST_CHECK_EQUAL(\"118878010356d064\", HexStr(Span{initiator_keys.garbage_terminator}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r958768072",
      "id" : 958768072,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845JaPI",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 970,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1090383174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958768072/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-08-30T18:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/958768072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed comments from @stratospher and a clang-tidy issue. Ready for further review.",
      "created_at" : "2022-09-11T20:30:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1243037383",
      "id" : 1243037383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585KFz7H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1243037383/reactions"
      },
      "updated_at" : "2022-09-11T20:30:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1243037383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:30Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"e6b4d42bc1fbce790cf7b419d0128c7caf319b491acfd9fd874f29ca3843fe40\", HexStr(initiator_keys.session_id));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.rekey_salt.size());\n+    BOOST_CHECK(initiator_keys.rekey_salt == responder_keys.rekey_salt);\n+    BOOST_CHECK_EQUAL(\"060d26411cdedabda638b1a807d0b68cbbb326385881409fcd2f5705091c5842\", HexStr(initiator_keys.rekey_salt));\n+\n+    BOOST_CHECK_EQUAL(BIP324_GARBAGE_TERMINATOR_LEN, initiator_keys.garbage_terminator.size());\n+    BOOST_CHECK(initiator_keys.garbage_terminator == responder_keys.garbage_terminator);\n+    BOOST_CHECK_EQUAL(\"118878010356d064\", HexStr(Span{initiator_keys.garbage_terminator}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884548",
      "id" : 967884548,
      "in_reply_to_id" : 958768072,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL8E",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 970,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:30:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884561"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:36Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"e6b4d42bc1fbce790cf7b419d0128c7caf319b491acfd9fd874f29ca3843fe40\", HexStr(initiator_keys.session_id));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.rekey_salt.size());\n+    BOOST_CHECK(initiator_keys.rekey_salt == responder_keys.rekey_salt);\n+    BOOST_CHECK_EQUAL(\"060d26411cdedabda638b1a807d0b68cbbb326385881409fcd2f5705091c5842\", HexStr(initiator_keys.rekey_salt));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884561",
      "id" : 967884561,
      "in_reply_to_id" : 958767405,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL8R",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 966,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351086,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:30:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884567"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:40Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"e6b4d42bc1fbce790cf7b419d0128c7caf319b491acfd9fd874f29ca3843fe40\", HexStr(initiator_keys.session_id));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884567",
      "id" : 967884567,
      "in_reply_to_id" : 958767066,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL8X",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 962,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884567/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:30:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884573"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:47Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"82c8d144f1dc7b86993c248db020aecfaed37a5c215bea5a7f1bf4399a85ecca\", HexStr(initiator_keys.responder_P));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884573",
      "id" : 967884573,
      "in_reply_to_id" : 958766665,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL8d",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 958,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:30:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884576"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:52Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"f31764965c22b792a5ac3f35573b01db27a8d479677c53c43d71bbc2141e8886\", HexStr(initiator_keys.responder_L));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884576",
      "id" : 967884576,
      "in_reply_to_id" : 958766225,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL8g",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 954,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:30:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884584"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:55Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"bc6617bd1473017b1b40e927c0330b74d1bdd30594a1daa49d89c831f03775cd\", HexStr(initiator_keys.initiator_P));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884584",
      "id" : 967884584,
      "in_reply_to_id" : 958764152,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL8o",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 950,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884584/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:30:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:30:59Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    // Make sure that the ephemeral ECDH secret is cleansed from memory once the keys are derived.\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"0000000000000000000000000000000000000000000000000000000000000000\", HexStr(responder_secret.value()));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"75fa71b052982a72ecb4a0e2a73697857121e4fca2f06e791a5d3c3383d4bb16\", HexStr(initiator_keys.initiator_L));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884601",
      "id" : 967884601,
      "in_reply_to_id" : 958762184,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL85",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 946,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:31:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884605"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:31:04Z",
      "diff_hunk" : "@@ -906,4 +908,68 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884605",
      "id" : 967884605,
      "in_reply_to_id" : 958660692,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL89",
      "original_commit_id" : "4220009bc799722b0160284492b49ad371690d07",
      "original_line" : 933,
      "original_position" : 35,
      "original_start_line" : 932,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-11T20:31:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884612"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884612"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:31:08Z",
      "diff_hunk" : "@@ -22,6 +28,12 @@\n  */\n typedef std::vector<unsigned char, secure_allocator<unsigned char> > CPrivKey;\n \n+constexpr static size_t ECDH_SECRET_SIZE = CSHA256::OUTPUT_SIZE;\n+const auto HASHER_BIP324_ECDH = TaggedHash(\"secp256k1_ellsq_xonly_ecdh\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884612",
      "id" : 967884612,
      "in_reply_to_id" : 958526002,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL9E",
      "original_commit_id" : "789d8bb80ab71a32ddf64b1242d11fa9e333d762",
      "original_line" : 32,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/key.h",
      "position" : null,
      "pull_request_review_id" : 1103351137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884612/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-11T20:31:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-11T20:31:14Z",
      "diff_hunk" : "@@ -344,4 +346,29 @@ BOOST_AUTO_TEST_CASE(bip340_test_vectors)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_ecdh)\n+{\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_ellswift = ParseHex(\"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\");\n+    auto responder_ellswift = ParseHex(\"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\");\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"6cbb9cd446f28623979b16affc4b57c4af95db832cb1a4ff8bc41e3192a33bd8\", HexStr(responder_secret.value()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r967884629",
      "id" : 967884629,
      "in_reply_to_id" : 958524234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5845sL9V",
      "original_commit_id" : "789d8bb80ab71a32ddf64b1242d11fa9e333d762",
      "original_line" : 363,
      "original_position" : 34,
      "original_start_line" : 362,
      "path" : "src/test/key_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1103351146,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884629/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-11T20:31:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/967884629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r976885899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976885899"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "f5d4f36: Span can be removed.",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-21T18:56:20Z",
      "diff_hunk" : "@@ -906,4 +908,64 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"ae1b0c44c3c38aa5206899c0928ca51f637e3ec05771b4a6c0662b46b76049d8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"ae1b0c44c3c38aa5206899c0928ca51f637e3ec05771b4a6c0662b46b76049d8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"98b1a948d70374db8078475fd2b573789989a57d5394ecc229a3f2ec336c4d18\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"95bdf50958c46ad24c7646cd7bf7579ffafb2f032d2c5356fc8341e198d0bb51\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"0dec3e671918898ce5472b161ddfcc6f765bf459e8cdeb86825fa704a58546e5\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"af8b74244dd43c5921e2449a125d669f6d82a23250fa040eafc3ba2373067de5\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"ae605e623a8f710f4f0c99454d74cdfb8861cad1f8f6dd2eb86390d615efab01\", HexStr(initiator_keys.session_id));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.rekey_salt.size());\n+    BOOST_CHECK(initiator_keys.rekey_salt == responder_keys.rekey_salt);\n+    BOOST_CHECK_EQUAL(\"e46620b5e10052931401606ccbb4c810c4f9afa9db948e3acfbeaa65b0cc8199\", HexStr(initiator_keys.rekey_salt));\n+\n+    BOOST_CHECK_EQUAL(BIP324_GARBAGE_TERMINATOR_LEN, initiator_keys.garbage_terminator.size());\n+    BOOST_CHECK(initiator_keys.garbage_terminator == responder_keys.garbage_terminator);\n+    BOOST_CHECK_EQUAL(\"73d7412ff3b42a01\", HexStr(Span{initiator_keys.garbage_terminator}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r976885899",
      "id" : 976885899,
      "line" : 966,
      "node_id" : "PRRC_kwDOABII5846OhiL",
      "original_commit_id" : "f5d4f368f07b449155cd5031697b2eb1fce2f9cc",
      "original_line" : 966,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 68,
      "pull_request_review_id" : 1115947374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976885899/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-21T19:06:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976885899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r976899290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976899290"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ab46788: uint8_t can be made std::byte. ",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-09-21T19:12:14Z",
      "diff_hunk" : "@@ -332,6 +334,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* ours, const unsigned char* theirs, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+std::optional<ECDHSecret> CKey::ComputeBIP324ECDHSecret(const Span<const std::byte> their_ellswift,\n+                                                        const Span<const std::byte> our_ellswift,\n+                                                        bool initiating) const\n+{\n+    uint8_t xonly_ecdh[ECDH_SECRET_SIZE];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r976899290",
      "id" : 976899290,
      "line" : 348,
      "node_id" : "PRRC_kwDOABII5846Okza",
      "original_commit_id" : "ab46788fc024eea10e1b5d952867bad8576c08db",
      "original_line" : 348,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 26,
      "pull_request_review_id" : 1115967334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976899290/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-21T19:12:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/976899290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/44024636?v=4",
         "events_url" : "https://api.github.com/users/stratospher/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stratospher/followers",
         "following_url" : "https://api.github.com/users/stratospher/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stratospher/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stratospher",
         "id" : 44024636,
         "login" : "stratospher",
         "node_id" : "MDQ6VXNlcjQ0MDI0NjM2",
         "organizations_url" : "https://api.github.com/users/stratospher/orgs",
         "received_events_url" : "https://api.github.com/users/stratospher/received_events",
         "repos_url" : "https://api.github.com/users/stratospher/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stratospher/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stratospher/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stratospher"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-09-25T15:57:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1257223142",
      "id" : 1257223142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585K77Pm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1257223142/reactions"
      },
      "updated_at" : "2022-09-25T15:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1257223142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r985049926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985049926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@stratospher Upon further thought after our conversation, I think unsigned char makes sense here as that's exactly what all the functions it is used with require. So I'm going with that when I update.",
      "commit_id" : "4805bcb2015c236de299ab97adc798f524e4d162",
      "created_at" : "2022-10-01T04:58:45Z",
      "diff_hunk" : "@@ -332,6 +334,40 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+// Returns just the x-coordinate in big endian\n+static int bip324_ecdh_hash(unsigned char* output, const unsigned char* x32, const unsigned char* ours, const unsigned char* theirs, void* data)\n+{\n+    memcpy(output, x32, 32);\n+    return 1;\n+}\n+\n+std::optional<ECDHSecret> CKey::ComputeBIP324ECDHSecret(const Span<const std::byte> their_ellswift,\n+                                                        const Span<const std::byte> our_ellswift,\n+                                                        bool initiating) const\n+{\n+    uint8_t xonly_ecdh[ECDH_SECRET_SIZE];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r985049926",
      "id" : 985049926,
      "in_reply_to_id" : 976899290,
      "line" : 348,
      "node_id" : "PRRC_kwDOABII5846tqtG",
      "original_commit_id" : "ab46788fc024eea10e1b5d952867bad8576c08db",
      "original_line" : 348,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 26,
      "pull_request_review_id" : 1127484572,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985049926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-01T04:58:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985049926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest push:\r\n- Rebased\r\n- Brought in upstream updates\r\n- Addressed comments from @stratospher \r\n- Changed ECDH tag for better domain separation\r\n- Rekey salt is now 23 bytes instead of 32 bytes to allow rekeying in a single SHA256 compression\r\n\r\nWindows tests failing - but should get resolved once secp/PR 1129 is merged.",
      "created_at" : "2022-10-01T21:17:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1264483781",
      "id" : 1264483781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585LXn3F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1264483781/reactions"
      },
      "updated_at" : "2022-10-01T21:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1264483781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r985145859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985145859"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed.",
      "commit_id" : "7cfd5832f643a9c0076957cc4ae95deaa4649e4a",
      "created_at" : "2022-10-01T21:18:11Z",
      "diff_hunk" : "@@ -906,4 +908,64 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\n     TestOnlyResetTimeData();\n }\n \n+BOOST_AUTO_TEST_CASE(bip324_derivation_test)\n+{\n+    // BIP324 key derivation uses network magic in the HKDF process. We use mainnet\n+    // params here to make it easier for other implementors to use this test as a test vector.\n+    SelectParams(CBaseChainParams::MAIN);\n+    static const std::string strSecret1 = \"5HxWvvfubhXpYYpS3tJkw6fq9jE9j18THftkZjHHfmFiWtmAbrj\";\n+    static const std::string strSecret2C = \"L3Hq7a8FEQwJkW1M2GNKDW28546Vp5miewcCzSqUD9kCAXrJdS3g\";\n+    static const std::string initiator_ellswift_str = \"b654960dff0ba8808a34337f46cc68ba7619c9df76d0550639dea62de07d17f9cb61b85f2897834ce12c50b1aefa281944abf2223a5fcf0a2a7d8c022498db35\";\n+    static const std::string responder_ellswift_str = \"ea57aae33e8dd38380c303fb561b741293ef97c780445184cabdb5ef207053db628f2765e5d770f666738112c94714991362f6643d9837e1c89cbd9710b80929\";\n+\n+    auto initiator_ellswift = ParseHex(initiator_ellswift_str);\n+    auto responder_ellswift = ParseHex(responder_ellswift_str);\n+\n+    CKey initiator_key = DecodeSecret(strSecret1);\n+    CKey responder_key = DecodeSecret(strSecret2C);\n+\n+    auto initiator_secret = initiator_key.ComputeBIP324ECDHSecret(MakeByteSpan(responder_ellswift), MakeByteSpan(initiator_ellswift), true);\n+    BOOST_CHECK(initiator_secret.has_value());\n+    auto responder_secret = responder_key.ComputeBIP324ECDHSecret(MakeByteSpan(initiator_ellswift), MakeByteSpan(responder_ellswift), false);\n+    BOOST_CHECK(responder_secret.has_value());\n+    BOOST_CHECK(initiator_secret.value() == responder_secret.value());\n+    BOOST_CHECK_EQUAL(\"ae1b0c44c3c38aa5206899c0928ca51f637e3ec05771b4a6c0662b46b76049d8\", HexStr(initiator_secret.value()));\n+    BOOST_CHECK_EQUAL(\"ae1b0c44c3c38aa5206899c0928ca51f637e3ec05771b4a6c0662b46b76049d8\", HexStr(responder_secret.value()));\n+\n+    BIP324Keys initiator_keys, responder_keys;\n+\n+    DeriveBIP324Keys(std::move(initiator_secret.value()), initiator_keys);\n+    DeriveBIP324Keys(std::move(responder_secret.value()), responder_keys);\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_L.size());\n+    BOOST_CHECK(initiator_keys.initiator_L == responder_keys.initiator_L);\n+    BOOST_CHECK_EQUAL(\"98b1a948d70374db8078475fd2b573789989a57d5394ecc229a3f2ec336c4d18\", HexStr(initiator_keys.initiator_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.initiator_P.size());\n+    BOOST_CHECK(initiator_keys.initiator_P == responder_keys.initiator_P);\n+    BOOST_CHECK_EQUAL(\"95bdf50958c46ad24c7646cd7bf7579ffafb2f032d2c5356fc8341e198d0bb51\", HexStr(initiator_keys.initiator_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_L.size());\n+    BOOST_CHECK(initiator_keys.responder_L == responder_keys.responder_L);\n+    BOOST_CHECK_EQUAL(\"0dec3e671918898ce5472b161ddfcc6f765bf459e8cdeb86825fa704a58546e5\", HexStr(initiator_keys.responder_L));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.responder_P.size());\n+    BOOST_CHECK(initiator_keys.responder_P == responder_keys.responder_P);\n+    BOOST_CHECK_EQUAL(\"af8b74244dd43c5921e2449a125d669f6d82a23250fa040eafc3ba2373067de5\", HexStr(initiator_keys.responder_P));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.session_id.size());\n+    BOOST_CHECK(initiator_keys.session_id == responder_keys.session_id);\n+    BOOST_CHECK_EQUAL(\"ae605e623a8f710f4f0c99454d74cdfb8861cad1f8f6dd2eb86390d615efab01\", HexStr(initiator_keys.session_id));\n+\n+    BOOST_CHECK_EQUAL(BIP324_KEY_LEN, initiator_keys.rekey_salt.size());\n+    BOOST_CHECK(initiator_keys.rekey_salt == responder_keys.rekey_salt);\n+    BOOST_CHECK_EQUAL(\"e46620b5e10052931401606ccbb4c810c4f9afa9db948e3acfbeaa65b0cc8199\", HexStr(initiator_keys.rekey_salt));\n+\n+    BOOST_CHECK_EQUAL(BIP324_GARBAGE_TERMINATOR_LEN, initiator_keys.garbage_terminator.size());\n+    BOOST_CHECK(initiator_keys.garbage_terminator == responder_keys.garbage_terminator);\n+    BOOST_CHECK_EQUAL(\"73d7412ff3b42a01\", HexStr(Span{initiator_keys.garbage_terminator}));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#discussion_r985145859",
      "id" : 985145859,
      "in_reply_to_id" : 976885899,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5846uCID",
      "original_commit_id" : "f5d4f368f07b449155cd5031697b2eb1fce2f9cc",
      "original_line" : 966,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1127568188,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23561",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985145859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-01T21:18:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985145859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest push:\r\n- garbage terminator length is now 16 bytes instead of 8 bytes\r\n- bidirectional garbage  terminators in derivation in accordance with the recently released BIP draft",
      "created_at" : "2022-10-15T04:17:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1279653297",
      "id" : 1279653297,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585MRfWx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279653297/reactions"
      },
      "updated_at" : "2022-10-15T04:31:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279653297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-19T09:32:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1283708754",
      "id" : 1283708754,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585Mg9dS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283708754/reactions"
      },
      "updated_at" : "2022-10-19T09:32:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283708754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased.",
      "created_at" : "2022-10-21T05:49:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1286490727",
      "id" : 1286490727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585Mrkpn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286490727/reactions"
      },
      "updated_at" : "2022-10-21T05:49:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286490727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest push:\r\n- Bringing in upstream optimizations to https://github.com/bitcoin-core/secp256k1/pull/1129",
      "created_at" : "2022-11-18T05:18:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1319559690",
      "id" : 1319559690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585OpuIK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1319559690/reactions"
      },
      "updated_at" : "2022-11-18T05:18:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1319559690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-19T01:49:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1320736880",
      "id" : 1320736880,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585OuNhw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320736880/reactions"
      },
      "updated_at" : "2022-11-19T01:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320736880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Bringing in upstream rebase (#26153)",
      "created_at" : "2022-11-23T05:12:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1324562262",
      "id" : 1324562262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585O8zdW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324562262/reactions"
      },
      "updated_at" : "2022-11-23T05:12:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1324562262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-30T01:22:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1331525718",
      "id" : 1331525718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585PXXhW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331525718/reactions"
      },
      "updated_at" : "2022-11-30T01:22:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331525718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Latest push:\r\n- Rebased upstream changes\r\n- Upstream changes include a new rekey ratchet mechanism (forward security) based on ChaCha20 instead of SHA256. This also means we no longer need the rekey salt in the session derivation process. BIP changes are WIP and coming soon.",
      "created_at" : "2022-12-15T16:53:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1353395420",
      "id" : 1353395420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585Qqyzc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1353395420/reactions"
      },
      "updated_at" : "2022-12-15T16:53:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1353395420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-12-25T11:35:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1364667075",
      "id" : 1364667075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585RVyrD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1364667075/reactions"
      },
      "updated_at" : "2022-12-25T11:35:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1364667075",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased",
      "created_at" : "2023-01-12T19:10:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23561#issuecomment-1380882259",
      "id" : 1380882259,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23561",
      "node_id" : "IC_kwDOABII585STpdT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380882259/reactions"
      },
      "updated_at" : "2023-01-12T19:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1380882259",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   }
]
