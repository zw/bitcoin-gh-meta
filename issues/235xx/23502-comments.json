[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [aureleoules](https://github.com/bitcoin/bitcoin/pull/23502#pullrequestreview-1184666322) |\n| Concept ACK | [darosior](https://github.com/bitcoin/bitcoin/pull/23502#pullrequestreview-1194389334), [Xekyo](https://github.com/bitcoin/bitcoin/pull/23502#pullrequestreview-1376476830) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2021-11-14T03:19:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-968198052",
      "id" : 968198052,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII5845tYek",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/968198052/reactions"
      },
      "updated_at" : "2023-04-07T18:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/968198052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r755494141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755494141"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could just do `sig.assign(64 + m_include_sighash, '\\000');` in the previous line.",
      "commit_id" : "f0a9151e0bceba9aab8b634a9a583265902480d8",
      "created_at" : "2021-11-23T20:51:32Z",
      "diff_hunk" : "@@ -570,14 +571,17 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r755494141",
      "id" : 755494141,
      "line" : 597,
      "node_id" : "PRRC_kwDOABII584tB-z9",
      "original_commit_id" : "46dc1e68fef3af54e484f900563e4f35696ef942",
      "original_line" : 575,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 75,
      "pull_request_review_id" : 814161792,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755494141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T20:55:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755494141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r755494932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755494932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's pretty ugly. What about adding a \"bool ForFeeEstimation()\" to all SignatureCreator instances, and calling that instead?",
      "commit_id" : "f0a9151e0bceba9aab8b634a9a583265902480d8",
      "created_at" : "2021-11-23T20:52:51Z",
      "diff_hunk" : "@@ -187,6 +187,11 @@ static bool SignTaproot(const SigningProvider& provider, const BaseSignatureCrea\n         sigdata.tr_spenddata.Merge(spenddata);\n     }\n \n+    // Detect if this is the dummy signer. If so, we want to choose the largest stack size for worst case size estimation",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r755494932",
      "id" : 755494932,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII584tB_AU",
      "original_commit_id" : "899185d5f133f2044506e6c10b23f1831e7fb1a8",
      "original_line" : 190,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 4,
      "pull_request_review_id" : 814161792,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755494932/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-11-23T20:55:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755494932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r762604989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604989"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IMO that's a bit harder to read and I don't like the implicit bool to int conversion.",
      "commit_id" : "f0a9151e0bceba9aab8b634a9a583265902480d8",
      "created_at" : "2021-12-05T19:31:47Z",
      "diff_hunk" : "@@ -570,14 +571,17 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r762604989",
      "id" : 762604989,
      "in_reply_to_id" : 755494141,
      "line" : 597,
      "node_id" : "PRRC_kwDOABII584tdG29",
      "original_commit_id" : "46dc1e68fef3af54e484f900563e4f35696ef942",
      "original_line" : 575,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 75,
      "pull_request_review_id" : 823425096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-05T19:31:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762604989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r763333809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763333809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I added an `IsDummy` and changed to check that instead.",
      "commit_id" : "6c2f69d5951c92de3152c05af0a165270df0ae75",
      "created_at" : "2021-12-06T19:51:52Z",
      "diff_hunk" : "@@ -187,6 +187,11 @@ static bool SignTaproot(const SigningProvider& provider, const BaseSignatureCrea\n         sigdata.tr_spenddata.Merge(spenddata);\n     }\n \n+    // Detect if this is the dummy signer. If so, we want to choose the largest stack size for worst case size estimation",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r763333809",
      "id" : 763333809,
      "in_reply_to_id" : 755494932,
      "line" : 190,
      "node_id" : "PRRC_kwDOABII584tf4yx",
      "original_commit_id" : "899185d5f133f2044506e6c10b23f1831e7fb1a8",
      "original_line" : 190,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 4,
      "pull_request_review_id" : 824401512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763333809/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-06T19:51:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763333809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Adam Ibrahim  . email samy2310@live.com .samy232075@gmail.com. ",
      "created_at" : "2021-12-06T20:42:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-987191665",
      "id" : 987191665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII584611lx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987191665/reactions"
      },
      "updated_at" : "2021-12-06T20:42:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987191665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/90076990?v=4",
         "events_url" : "https://api.github.com/users/2310Mas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/2310Mas/followers",
         "following_url" : "https://api.github.com/users/2310Mas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/2310Mas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/2310Mas",
         "id" : 90076990,
         "login" : "2310Mas",
         "node_id" : "MDQ6VXNlcjkwMDc2OTkw",
         "organizations_url" : "https://api.github.com/users/2310Mas/orgs",
         "received_events_url" : "https://api.github.com/users/2310Mas/received_events",
         "repos_url" : "https://api.github.com/users/2310Mas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/2310Mas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/2310Mas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/2310Mas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r771441363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771441363"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Have to agree with @achow101 here. Even though the alternative formulation is shorter ,and correct, I understand the intent of the code better this way.",
      "commit_id" : "6c2f69d5951c92de3152c05af0a165270df0ae75",
      "created_at" : "2021-12-17T14:35:55Z",
      "diff_hunk" : "@@ -570,14 +571,17 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r771441363",
      "id" : 771441363,
      "in_reply_to_id" : 755494141,
      "line" : 597,
      "node_id" : "PRRC_kwDOABII584t-0LT",
      "original_commit_id" : "46dc1e68fef3af54e484f900563e4f35696ef942",
      "original_line" : 575,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 75,
      "pull_request_review_id" : 835299629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771441363/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T14:35:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771441363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r771452829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771452829"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Adding a method to ask an interface if it's a certain class seems like a design inversion to me. If we can't move the actual responsibility into the class, is there some more semantic name that we could consider? I see it's assigned to `use_largest`, so maybe `UseLargest`? (then further describe in the doc-comment  `Choose the largest stack size for worst case size estimation when using this signer.`).",
      "commit_id" : "6c2f69d5951c92de3152c05af0a165270df0ae75",
      "created_at" : "2021-12-17T14:50:57Z",
      "diff_hunk" : "@@ -570,14 +593,18 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);\n+        }\n         return true;\n     }\n+    bool IsDummy() const override { return true; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r771452829",
      "id" : 771452829,
      "line" : 601,
      "node_id" : "PRRC_kwDOABII584t-2-d",
      "original_commit_id" : "6c2f69d5951c92de3152c05af0a165270df0ae75",
      "original_line" : 601,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 79,
      "pull_request_review_id" : 835316402,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771452829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-12-17T14:50:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/771452829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r781541026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/781541026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed to `UseLargest`",
      "commit_id" : "ca85b71d0938bef7400068983b97ce6bc17c97c4",
      "created_at" : "2022-01-10T20:54:58Z",
      "diff_hunk" : "@@ -570,14 +593,18 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);\n+        }\n         return true;\n     }\n+    bool IsDummy() const override { return true; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r781541026",
      "id" : 781541026,
      "in_reply_to_id" : 771452829,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ulV6i",
      "original_commit_id" : "6c2f69d5951c92de3152c05af0a165270df0ae75",
      "original_line" : 601,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 848329134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/781541026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-01-10T20:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/781541026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure if I understand this correctly, but the underestimation could also lead to a situation where minrelaytxfee is not met, right? If so, maybe a good first step would be to prevent that.",
      "created_at" : "2022-01-29T16:49:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1024945819",
      "id" : 1024945819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII5849F26b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1024945819/reactions"
      },
      "updated_at" : "2022-01-29T16:49:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1024945819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/425166?v=4",
         "events_url" : "https://api.github.com/users/flack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flack/followers",
         "following_url" : "https://api.github.com/users/flack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flack",
         "id" : 425166,
         "login" : "flack",
         "node_id" : "MDQ6VXNlcjQyNTE2Ng==",
         "organizations_url" : "https://api.github.com/users/flack/orgs",
         "received_events_url" : "https://api.github.com/users/flack/received_events",
         "repos_url" : "https://api.github.com/users/flack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-03-04T13:31:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1059164588",
      "id" : 1059164588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII584_IZGs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1059164588/reactions"
      },
      "updated_at" : "2022-03-04T13:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1059164588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-06-28T16:27:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1168942837",
      "id" : 1168942837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII585FrKb1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1168942837/reactions"
      },
      "updated_at" : "2022-06-28T16:27:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1168942837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r990020872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/990020872"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 7f927b757748e03234d451a09309e5d788cb77d2\r\nsame above and below\r\n```suggestion\r\n            if (use_largest && (largest_result_stack.empty() ||\r\n```",
      "commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "created_at" : "2022-10-07T12:13:40Z",
      "diff_hunk" : "@@ -244,25 +249,42 @@ static bool SignTaproot(const SigningProvider& provider, const BaseSignatureCrea\n             }\n         }\n         if (sigdata.taproot_key_path_sig.size()) {\n-            result = Vector(sigdata.taproot_key_path_sig);\n-            return true;\n+            if (use_largest) {\n+                largest_result_stack = Vector(sigdata.taproot_key_path_sig);\n+                largest_result_stack_size = GetSerializeSize(largest_result_stack, PROTOCOL_VERSION);\n+            } else {\n+                result = Vector(sigdata.taproot_key_path_sig);\n+                return true;\n+            }\n         }\n     }\n \n     // Try script path spending.\n     std::vector<std::vector<unsigned char>> smallest_result_stack;\n+    uint64_t smallest_result_stack_size = 0;\n     for (const auto& [key, control_blocks] : sigdata.tr_spenddata.scripts) {\n         const auto& [script, leaf_ver] = key;\n         std::vector<std::vector<unsigned char>> result_stack;\n         if (SignTaprootScript(provider, creator, sigdata, leaf_ver, script, result_stack)) {\n             result_stack.emplace_back(std::begin(script), std::end(script)); // Push the script\n             result_stack.push_back(*control_blocks.begin()); // Push the smallest control block\n+            uint64_t stack_size = GetSerializeSize(result_stack, PROTOCOL_VERSION);\n             if (smallest_result_stack.size() == 0 ||\n-                GetSerializeSize(result_stack, PROTOCOL_VERSION) < GetSerializeSize(smallest_result_stack, PROTOCOL_VERSION)) {\n-                smallest_result_stack = std::move(result_stack);\n+                stack_size < smallest_result_stack_size) {\n+                smallest_result_stack = result_stack;\n+                smallest_result_stack_size = stack_size;\n+            }\n+            if (use_largest && (largest_result_stack.size() == 0 ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r990020872",
      "id" : 990020872,
      "line" : 277,
      "node_id" : "PRRC_kwDOABII5847AoUI",
      "original_commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "original_line" : 277,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 45,
      "pull_request_review_id" : 1134384305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/990020872/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-07T12:17:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/990020872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r990021192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/990021192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "if you retouch\r\n```suggestion\r\n            if (smallest_result_stack.empty() ||\r\n```",
      "commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "created_at" : "2022-10-07T12:14:08Z",
      "diff_hunk" : "@@ -244,25 +249,42 @@ static bool SignTaproot(const SigningProvider& provider, const BaseSignatureCrea\n             }\n         }\n         if (sigdata.taproot_key_path_sig.size()) {\n-            result = Vector(sigdata.taproot_key_path_sig);\n-            return true;\n+            if (use_largest) {\n+                largest_result_stack = Vector(sigdata.taproot_key_path_sig);\n+                largest_result_stack_size = GetSerializeSize(largest_result_stack, PROTOCOL_VERSION);\n+            } else {\n+                result = Vector(sigdata.taproot_key_path_sig);\n+                return true;\n+            }\n         }\n     }\n \n     // Try script path spending.\n     std::vector<std::vector<unsigned char>> smallest_result_stack;\n+    uint64_t smallest_result_stack_size = 0;\n     for (const auto& [key, control_blocks] : sigdata.tr_spenddata.scripts) {\n         const auto& [script, leaf_ver] = key;\n         std::vector<std::vector<unsigned char>> result_stack;\n         if (SignTaprootScript(provider, creator, sigdata, leaf_ver, script, result_stack)) {\n             result_stack.emplace_back(std::begin(script), std::end(script)); // Push the script\n             result_stack.push_back(*control_blocks.begin()); // Push the smallest control block\n+            uint64_t stack_size = GetSerializeSize(result_stack, PROTOCOL_VERSION);\n             if (smallest_result_stack.size() == 0 ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r990021192",
      "id" : 990021192,
      "line" : 272,
      "node_id" : "PRRC_kwDOABII5847AoZI",
      "original_commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "original_line" : 272,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 38,
      "pull_request_review_id" : 1134384305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/990021192/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-07T12:17:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/990021192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r992642809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992642809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "annotate these args?",
      "commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "created_at" : "2022-10-11T18:12:31Z",
      "diff_hunk" : "@@ -618,14 +619,17 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);\n+        }\n         return true;\n     }\n };\n \n }\n \n-const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR = DummySignatureCreator(32, 32);\n-const BaseSignatureCreator& DUMMY_MAXIMUM_SIGNATURE_CREATOR = DummySignatureCreator(33, 32);\n+const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR = DummySignatureCreator(32, 32, false);\n+const BaseSignatureCreator& DUMMY_MAXIMUM_SIGNATURE_CREATOR = DummySignatureCreator(33, 32, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r992642809",
      "id" : 992642809,
      "line" : 655,
      "node_id" : "PRRC_kwDOABII5847Kob5",
      "original_commit_id" : "caf5db2b65f064d3a3fbab1ffc152d46ef8716b4",
      "original_line" : 632,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 27,
      "pull_request_review_id" : 1137959666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992642809/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-11T18:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992642809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r992644236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992644236"
         }
      },
      "author_association" : "MEMBER",
      "body" : "slightly philosophical question: If the wallet knows how to satisfy two script paths, will it use the more expensive one?",
      "commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "created_at" : "2022-10-11T18:14:19Z",
      "diff_hunk" : "@@ -32,6 +32,9 @@ class BaseSignatureCreator {\n     /** Create a singular (non-script) signature. */\n     virtual bool CreateSig(const SigningProvider& provider, std::vector<unsigned char>& vchSig, const CKeyID& keyid, const CScript& scriptCode, SigVersion sigversion) const =0;\n     virtual bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* merkle_root, SigVersion sigversion) const =0;\n+\n+    /** Choose the largest stack size for worst case size estimation when using this signer */\n+    virtual bool UseLargest() const =0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r992644236",
      "id" : 992644236,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII5847KoyM",
      "original_commit_id" : "8d8d092a733b5572ef5c9a811dee1ae3e89e24d5",
      "original_line" : 37,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/script/sign.h",
      "position" : 6,
      "pull_request_review_id" : 1137959666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992644236/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-11T18:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992644236",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r992648312"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992648312"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should be at least*",
      "commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "created_at" : "2022-10-11T18:19:14Z",
      "diff_hunk" : "@@ -46,6 +46,13 @@ def assert_fee_amount(fee, tx_size, feerate_BTC_kvB):\n         raise AssertionError(\"Fee of %s BTC too high! (Should be %s BTC)\" % (str(fee), str(target_fee)))\n \n \n+def assert_fee_enough(fee, tx_size, feerate_BTC_kvB):\n+    \"\"\"Assert the fee meets the feerate\"\"\"\n+    target_fee = get_fee(tx_size, feerate_BTC_kvB)\n+    if fee < target_fee:\n+        raise AssertionError(\"Fee of %s BTC too low! (Should be %s BTC)\" % (str(fee), str(target_fee)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r992648312",
      "id" : 992648312,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII5847Kpx4",
      "original_commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "original_line" : 53,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 8,
      "pull_request_review_id" : 1137959666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992648312/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-11T18:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992648312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r997176504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997176504"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "60b61f8b56582a2c874cf0c6330cbfec72c177e9",
      "created_at" : "2022-10-17T15:02:23Z",
      "diff_hunk" : "@@ -618,14 +619,17 @@ class DummySignatureCreator final : public BaseSignatureCreator {\n     bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* tweak, SigVersion sigversion) const override\n     {\n         sig.assign(64, '\\000');\n+        if (m_include_sighash) {\n+            sig.push_back((unsigned char)SIGHASH_ALL);\n+        }\n         return true;\n     }\n };\n \n }\n \n-const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR = DummySignatureCreator(32, 32);\n-const BaseSignatureCreator& DUMMY_MAXIMUM_SIGNATURE_CREATOR = DummySignatureCreator(33, 32);\n+const BaseSignatureCreator& DUMMY_SIGNATURE_CREATOR = DummySignatureCreator(32, 32, false);\n+const BaseSignatureCreator& DUMMY_MAXIMUM_SIGNATURE_CREATOR = DummySignatureCreator(33, 32, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r997176504",
      "id" : 997176504,
      "in_reply_to_id" : 992642809,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847b7S4",
      "original_commit_id" : "caf5db2b65f064d3a3fbab1ffc152d46ef8716b4",
      "original_line" : 632,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 1144331507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997176504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T15:02:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997176504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r997177161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997177161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No. This change only affects dummy signing, but for actual signing, it will still use smallest solution.",
      "commit_id" : "60b61f8b56582a2c874cf0c6330cbfec72c177e9",
      "created_at" : "2022-10-17T15:02:55Z",
      "diff_hunk" : "@@ -32,6 +32,9 @@ class BaseSignatureCreator {\n     /** Create a singular (non-script) signature. */\n     virtual bool CreateSig(const SigningProvider& provider, std::vector<unsigned char>& vchSig, const CKeyID& keyid, const CScript& scriptCode, SigVersion sigversion) const =0;\n     virtual bool CreateSchnorrSig(const SigningProvider& provider, std::vector<unsigned char>& sig, const XOnlyPubKey& pubkey, const uint256* leaf_hash, const uint256* merkle_root, SigVersion sigversion) const =0;\n+\n+    /** Choose the largest stack size for worst case size estimation when using this signer */\n+    virtual bool UseLargest() const =0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r997177161",
      "id" : 997177161,
      "in_reply_to_id" : 992644236,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII5847b7dJ",
      "original_commit_id" : "8d8d092a733b5572ef5c9a811dee1ae3e89e24d5",
      "original_line" : 37,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/script/sign.h",
      "position" : 6,
      "pull_request_review_id" : 1144332480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997177161/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T15:02:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997177161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r997177249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997177249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "60b61f8b56582a2c874cf0c6330cbfec72c177e9",
      "created_at" : "2022-10-17T15:03:00Z",
      "diff_hunk" : "@@ -46,6 +46,13 @@ def assert_fee_amount(fee, tx_size, feerate_BTC_kvB):\n         raise AssertionError(\"Fee of %s BTC too high! (Should be %s BTC)\" % (str(fee), str(target_fee)))\n \n \n+def assert_fee_enough(fee, tx_size, feerate_BTC_kvB):\n+    \"\"\"Assert the fee meets the feerate\"\"\"\n+    target_fee = get_fee(tx_size, feerate_BTC_kvB)\n+    if fee < target_fee:\n+        raise AssertionError(\"Fee of %s BTC too low! (Should be %s BTC)\" % (str(fee), str(target_fee)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r997177249",
      "id" : 997177249,
      "in_reply_to_id" : 992648312,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847b7eh",
      "original_commit_id" : "7f927b757748e03234d451a09309e5d788cb77d2",
      "original_line" : 53,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : null,
      "pull_request_review_id" : 1144332605,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997177249/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T15:03:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997177249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-04T16:44:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1303861347",
      "id" : 1303861347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII585Nt1hj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303861347/reactions"
      },
      "updated_at" : "2022-11-04T16:44:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303861347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Concept ACK. But for the approach i would prefer something like #26573 instead of making the signing logic still more intricate. But that can also happen afterward.\r\n\r\nThe approach in this PR also has a few useful side effects. Notably, right now a PSBT that has script paths will not fill in pubkey details for the scripts. However the changes in this PR should also fix that.",
      "created_at" : "2022-12-15T20:42:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1353683725",
      "id" : 1353683725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII585Qr5MN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1353683725/reactions"
      },
      "updated_at" : "2022-12-15T20:42:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1353683725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > Concept ACK. But for the approach i would prefer something like #26573 instead of making the signing logic still more intricate. But that can also happen afterward.\r\n> \r\n> The approach in this PR also has a few useful side effects. Notably, right now a PSBT that has script paths will not fill in pubkey details for the scripts. However the changes in this PR should also fix that.\r\n\r\nThis is my first time commenting on a PR, so I apologize if I am breaking any protocol or etiquette here. I compiled and ran this branch and it completely solved this issue described above (PSBT script paths with missing pubkey details);\r\n\r\nFurther details;\r\nI created a multisig address using deriveaddresses and funded it. Then I tried to create a PSBT to spend from the funded address. I was unable to create a PSBT that could be properly processed in 24.0.1. After creating the PSBT and using walletprocesspsbt in my wallet with private keys disabled, it created PSBTs missing the 'taproot_bip32_derivs' on all the multisig inputs, so my signing wallets couldn't sign the transaction. \r\nThis is kinda crazy since I was able to create a multisig address and fund it - but now I can't spend from it. \r\n\r\nThe code in this PR solved my issue completely. I compiled this branch and was able to easily create the PSBT with the proper input data, sign it and broadcast. Here is the signet Txid-> 72632a6c09ece682e2fe07796497ca5235280d908d027ee6900a6273e33dd2ae\r\n\r\nI'm not knowledgeable or skilled enough to know more about this code, but as a user, I know it solved my problem. (And as a user there's no bigger problem then when you can't spend from an address that you control the keys to)",
      "created_at" : "2022-12-16T12:55:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1354727948",
      "id" : 1354727948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII585Qv4IM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1354727948/reactions"
      },
      "updated_at" : "2022-12-16T12:55:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1354727948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/59615752?v=4",
         "events_url" : "https://api.github.com/users/FractalEncrypt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/FractalEncrypt/followers",
         "following_url" : "https://api.github.com/users/FractalEncrypt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/FractalEncrypt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/FractalEncrypt",
         "id" : 59615752,
         "login" : "FractalEncrypt",
         "node_id" : "MDQ6VXNlcjU5NjE1NzUy",
         "organizations_url" : "https://api.github.com/users/FractalEncrypt/orgs",
         "received_events_url" : "https://api.github.com/users/FractalEncrypt/received_events",
         "repos_url" : "https://api.github.com/users/FractalEncrypt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/FractalEncrypt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/FractalEncrypt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/FractalEncrypt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r1160890949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160890949"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These make sense to me, but if we correctly estimated the maximum and minimum, how would they ever get used?",
      "commit_id" : "5345b800053963eab2b4cf61662258e8821456b6",
      "created_at" : "2023-04-07T18:46:00Z",
      "diff_hunk" : "@@ -248,26 +253,43 @@ static bool SignTaproot(const SigningProvider& provider, const BaseSignatureCrea\n             }\n         }\n         if (sigdata.taproot_key_path_sig.size()) {\n-            result = Vector(sigdata.taproot_key_path_sig);\n-            return true;\n+            if (use_largest) {\n+                largest_result_stack = Vector(sigdata.taproot_key_path_sig);\n+                largest_result_stack_size = GetSerializeSize(largest_result_stack, PROTOCOL_VERSION);\n+            } else {\n+                result = Vector(sigdata.taproot_key_path_sig);\n+                return true;\n+            }\n         }\n     }\n \n     // Try script path spending.\n     std::vector<std::vector<unsigned char>> smallest_result_stack;\n+    uint64_t smallest_result_stack_size = 0;\n     for (const auto& [key, control_blocks] : sigdata.tr_spenddata.scripts) {\n         const auto& [script, leaf_ver] = key;\n         std::vector<std::vector<unsigned char>> result_stack;\n         if (SignTaprootScript(provider, creator, sigdata, leaf_ver, script, result_stack)) {\n             result_stack.emplace_back(std::begin(script), std::end(script)); // Push the script\n             result_stack.push_back(*control_blocks.begin()); // Push the smallest control block\n-            if (smallest_result_stack.size() == 0 ||\n-                GetSerializeSize(result_stack, PROTOCOL_VERSION) < GetSerializeSize(smallest_result_stack, PROTOCOL_VERSION)) {\n-                smallest_result_stack = std::move(result_stack);\n+            uint64_t stack_size = GetSerializeSize(result_stack, PROTOCOL_VERSION);\n+            if (smallest_result_stack.empty() ||\n+                stack_size < smallest_result_stack_size) {\n+                smallest_result_stack = result_stack;\n+                smallest_result_stack_size = stack_size;\n+            }\n+            if (use_largest && (largest_result_stack.empty() ||\n+                stack_size > largest_result_stack_size)) {\n+                largest_result_stack = result_stack;\n+                largest_result_stack_size = stack_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r1160890949",
      "id" : 1160890949,
      "line" : 284,
      "node_id" : "PRRC_kwDOABII585FMcpF",
      "original_commit_id" : "5345b800053963eab2b4cf61662258e8821456b6",
      "original_line" : 284,
      "original_position" : 49,
      "original_start_line" : 276,
      "path" : "src/script/sign.cpp",
      "position" : 49,
      "pull_request_review_id" : 1376476830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160890949/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 276,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-07T18:49:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160890949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> How would this behave in the context of changeless transactions? Would we be overestimating the target and dropping an excess to the fees?\r\n\r\nAll overages due to size estimation differences are dropped to fees. The output values are set based upon the estimated size and they cannot be changed after signing. Once signing is completed and the final transaction created, if it ends up being smaller than estimated, whatever could have been saved will not be saved.\r\n\r\n> Does that get recognized when we compare coin selection solutions?\r\n\r\nNo. Prior to actual signing, all sizes use the size estimator, which this PR changes to use the worst case scenario.",
      "created_at" : "2023-04-10T13:48:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#issuecomment-1501832645",
      "id" : 1501832645,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/23502",
      "node_id" : "IC_kwDOABII585ZhCXF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1501832645/reactions"
      },
      "updated_at" : "2023-04-10T13:48:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1501832645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r1161737139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161737139"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't quite follow your question.\r\n\r\nThe estimated stack size is used to choose which result to return as multiple results could be valid. In normal signing, we use the smallest valid stack. In estimating, we use the largest.",
      "commit_id" : "5345b800053963eab2b4cf61662258e8821456b6",
      "created_at" : "2023-04-10T13:50:52Z",
      "diff_hunk" : "@@ -248,26 +253,43 @@ static bool SignTaproot(const SigningProvider& provider, const BaseSignatureCrea\n             }\n         }\n         if (sigdata.taproot_key_path_sig.size()) {\n-            result = Vector(sigdata.taproot_key_path_sig);\n-            return true;\n+            if (use_largest) {\n+                largest_result_stack = Vector(sigdata.taproot_key_path_sig);\n+                largest_result_stack_size = GetSerializeSize(largest_result_stack, PROTOCOL_VERSION);\n+            } else {\n+                result = Vector(sigdata.taproot_key_path_sig);\n+                return true;\n+            }\n         }\n     }\n \n     // Try script path spending.\n     std::vector<std::vector<unsigned char>> smallest_result_stack;\n+    uint64_t smallest_result_stack_size = 0;\n     for (const auto& [key, control_blocks] : sigdata.tr_spenddata.scripts) {\n         const auto& [script, leaf_ver] = key;\n         std::vector<std::vector<unsigned char>> result_stack;\n         if (SignTaprootScript(provider, creator, sigdata, leaf_ver, script, result_stack)) {\n             result_stack.emplace_back(std::begin(script), std::end(script)); // Push the script\n             result_stack.push_back(*control_blocks.begin()); // Push the smallest control block\n-            if (smallest_result_stack.size() == 0 ||\n-                GetSerializeSize(result_stack, PROTOCOL_VERSION) < GetSerializeSize(smallest_result_stack, PROTOCOL_VERSION)) {\n-                smallest_result_stack = std::move(result_stack);\n+            uint64_t stack_size = GetSerializeSize(result_stack, PROTOCOL_VERSION);\n+            if (smallest_result_stack.empty() ||\n+                stack_size < smallest_result_stack_size) {\n+                smallest_result_stack = result_stack;\n+                smallest_result_stack_size = stack_size;\n+            }\n+            if (use_largest && (largest_result_stack.empty() ||\n+                stack_size > largest_result_stack_size)) {\n+                largest_result_stack = result_stack;\n+                largest_result_stack_size = stack_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/23502#discussion_r1161737139",
      "id" : 1161737139,
      "in_reply_to_id" : 1160890949,
      "line" : 284,
      "node_id" : "PRRC_kwDOABII585FPrOz",
      "original_commit_id" : "5345b800053963eab2b4cf61662258e8821456b6",
      "original_line" : 284,
      "original_position" : 49,
      "original_start_line" : 276,
      "path" : "src/script/sign.cpp",
      "position" : 49,
      "pull_request_review_id" : 1377560209,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/23502",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161737139/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 276,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-10T13:50:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161737139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
