[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25577](https://github.com/bitcoin/bitcoin/pull/25577) (mempool, refactor: add `MemPoolBypass` by w0xlt)\n* [#25487](https://github.com/bitcoin/bitcoin/pull/25487) ([kernel 3b/n] Decouple `{Dump,Load}Mempool` from `ArgsManager` by dongcarl)\n* [#24007](https://github.com/bitcoin/bitcoin/pull/24007) ([mempool] allow tx replacement by smaller witness by LarryRuane)\n* [#23897](https://github.com/bitcoin/bitcoin/pull/23897) (refactor: Move calculation logic out from `CheckSequenceLocksAtTip()` by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-06-21T04:46:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1161262465",
      "id" : 1161262465,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585FN3WB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161262465/reactions"
      },
      "updated_at" : "2022-07-17T17:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161262465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for picking this up. I just realized I probably should have left a comment summarizing what work needs to be done. Not sure if you saw https://github.com/bitcoin/bitcoin/pull/21413#issuecomment-827228002? We'll want to add (1) an option to override relative timelocks between transactions passed in, (2) a param for what MTP/height to mock, either for the whole thing or at each transaction. This would also require more tests, i.e. utilizing the new options to ensure it works beyond not breaking things.",
      "created_at" : "2022-06-21T08:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1161426723",
      "id" : 1161426723,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585FOfcj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161426723/reactions"
      },
      "updated_at" : "2022-06-21T08:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161426723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This greatly increases the scope.\r\n\r\nIt might be better to break down each option into a specific PR.\r\n\r\nHow could `testmempoolaccept` simulate a specific block height, for example?",
      "created_at" : "2022-06-21T16:25:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1161980569",
      "id" : 1161980569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585FQmqZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161980569/reactions"
      },
      "updated_at" : "2022-06-21T16:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161980569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r907880645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907880645"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Of course, I think this would benefit from something like `standardness-sanitization` in `doc/policy` explaining how to use the new API to an extended set of L2 developers with few use-cases.",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-06-27T23:27:31Z",
      "diff_hunk" : "@@ -96,8 +96,15 @@ static RPCHelpMan testmempoolaccept()\n                     {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n                 },\n             },\n-            {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n-             \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT + \"/kvB\\n\"},\n+            {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n+                {\n+                    {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n+                    \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT + \"/kvB\\n\"},\n+                    {\"bypass_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Don't enforce BIP68 sequence locks and timelocks. Don't use unless you know what you're doing!\\n\"}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r907880645",
      "id" : 907880645,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842HSjF",
      "original_commit_id" : "27f21bc74fb9d64fab76db026b0fe304914d9548",
      "original_line" : 104,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1020896809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907880645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-28T00:11:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907880645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r907885352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907885352"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it should say BIP68. The consensus-enforcement of relative timelock is described there, BIP112 only describes how to restrain script path execution in function of spent inputs maturity thanks to CSV. Following the same logic it should also say that the nLocktime are not enforced, without ref to BIP65.",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-06-27T23:39:31Z",
      "diff_hunk" : "@@ -242,23 +242,26 @@ struct PackageMempoolAcceptResult\n  *                                It is also used to determine when the entry expires.\n  * @param[in]  bypass_limits      When true, don't enforce mempool fee and capacity limits.\n  * @param[in]  test_accept        When true, run validation checks but don't submit to mempool.\n- *\n+ * @param[in]  bypass_timelocks   When true (test_accept must also be true), don't enforce timelock\n+ *                                rules BIP65 and BIP112.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r907885352",
      "id" : 907885352,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842HTso",
      "original_commit_id" : "27f21bc74fb9d64fab76db026b0fe304914d9548",
      "original_line" : 244,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1020896809,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907885352/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-28T00:11:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907885352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ariard  If I understand correctly, are you suggesting the parameter schemes below?\r\n\r\n```c++\r\n{\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\r\n    {\r\n        {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{...},\"...\"},\r\n        {\"bypass_relative_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_absolute_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_feerate_accuracy\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_csv_execution\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_cltv_execution\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n    },\r\n     \"\\\"options\\\"\"\r\n},\r\n```\r\nor\r\n\r\n```c++\r\n{\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\r\n    {\r\n        {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{...},\"...\"},\r\n        {\"mock_mtp\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"mock_height\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_feerate_accuracy\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_csv_execution\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n        {\"bypass_cltv_execution\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"...\"},\r\n    },\r\n    \"\\\"options\\\"\"\r\n},\r\n```",
      "created_at" : "2022-06-28T14:55:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1168833308",
      "id" : 1168833308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585Fqvsc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1168833308/reactions"
      },
      "updated_at" : "2022-06-28T14:55:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1168833308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@w0xlt \r\n\r\nActually a combination of both. The first one + \"mock_mtp / mock_height\". \r\nIt sounds a lot of flexibility but I think that's what you're aiming for to verify Lightning HTLC-timeout.",
      "created_at" : "2022-06-29T01:08:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1169430111",
      "id" : 1169430111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585FtBZf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169430111/reactions"
      },
      "updated_at" : "2022-06-29T01:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169430111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-06-30T16:47:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1171454030",
      "id" : 1171454030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585F0vhO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171454030/reactions"
      },
      "updated_at" : "2022-06-30T16:47:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171454030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "IMO the idea for `mock_{mtp,height}` is a better approach. \"Valid in 9999 years\" seems closer to \"never valid\" than \"valid eventually\".",
      "created_at" : "2022-07-01T19:19:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1172650243",
      "id" : 1172650243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585F5TkD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1172650243/reactions"
      },
      "updated_at" : "2022-07-01T19:19:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1172650243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I pushed some changes:\r\n\r\n. `struct MempoolTestCriteria` was created to allocate all parameters suggested in https://github.com/bitcoin/bitcoin/pull/25434#pullrequestreview-1020896809. (https://github.com/bitcoin/bitcoin/pull/25434/commits/be52f8ace2e30aa5981852fafc4fe8f10eb8e759)\r\n\r\n. `bypass_timelocks` has been split into `bypass_relative_timelocks` and `bypass_absolute_timelocks`, as suggested in the same comment. (https://github.com/bitcoin/bitcoin/pull/25434/commits/fccce1ef49d14ae54202583f1df39078398857c5)\r\n\r\n. The tests were split in two commit: one tests that `bypass_timelocls` works and the other tests that it doesn't affect `OP_CSV` and `OP_CLTV` checks. (https://github.com/bitcoin/bitcoin/pull/25434/commits/d8e4a0918ed82cb3d7331590e736c01b733137d8 and https://github.com/bitcoin/bitcoin/pull/25434/commits/52a2e282568d404c9b48ab88e6ccd18ad140ad16).",
      "created_at" : "2022-07-02T15:39:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1172917695",
      "id" : 1172917695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585F6U2_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1172917695/reactions"
      },
      "updated_at" : "2022-07-02T16:24:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1172917695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/25532 adds the `bypass_feerate_accuracy` option,\r\n\r\nI prefer to keep the different option (or group of options) in different PRs for ease of review.",
      "created_at" : "2022-07-03T04:19:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1173008773",
      "id" : 1173008773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585F6rGF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173008773/reactions"
      },
      "updated_at" : "2022-07-03T04:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173008773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916367721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916367721"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could you precise \"Do not _consensus_-enforce BIP68\" to make it clear it's a consensus check not policy one?",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-07-08T00:23:31Z",
      "diff_hunk" : "@@ -97,8 +97,16 @@ static RPCHelpMan testmempoolaccept()\n                     {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n                 },\n             },\n-            {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n-             \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT + \"/kvB\\n\"},\n+            {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n+                {\n+                    {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n+                    \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT + \"/kvB\\n\"},\n+                    {\"bypass_absolute_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Don't enforce nLocktime.\\n\"},\n+                    {\"bypass_relative_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Don't enforce BIP68 relative lock-time.\\n\"}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916367721",
      "id" : 916367721,
      "line" : 105,
      "node_id" : "PRRC_kwDOABII5842nqlp",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 105,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 11,
      "pull_request_review_id" : 1032278439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916367721/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T01:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916367721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916371409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916371409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "if you like ternary I think you can do ternary here.",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-07-08T00:34:57Z",
      "diff_hunk" : "@@ -143,9 +151,32 @@ static RPCHelpMan testmempoolaccept()\n                                    \"Array must contain between 1 and \" + ToString(MAX_PACKAGE_COUNT) + \" transactions.\");\n             }\n \n-            const CFeeRate max_raw_tx_fee_rate = request.params[1].isNull() ?\n-                                                     DEFAULT_MAX_RAW_TX_FEE_RATE :\n-                                                     CFeeRate(AmountFromValue(request.params[1]));\n+            CFeeRate max_raw_tx_fee_rate = DEFAULT_MAX_RAW_TX_FEE_RATE;\n+\n+            auto test_criteria = MempoolTestCriteria();\n+\n+            if (!request.params[1].isNull()) {\n+                const UniValue& options = request.params[1];\n+                RPCTypeCheckObj(options,\n+                    {\n+                        {\"maxfeerate\", UniValueType()}, // will be checked by AmountFromValue() below\n+                        {\"bypass_absolute_timelocks\", UniValueType(UniValue::VBOOL)},\n+                        {\"bypass_relative_timelocks\", UniValueType(UniValue::VBOOL)},\n+                    },\n+                    true, true);\n+\n+                if (options.exists(\"maxfeerate\")) {\n+                    max_raw_tx_fee_rate = CFeeRate(AmountFromValue(options[\"maxfeerate\"]));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916371409",
      "id" : 916371409,
      "line" : 169,
      "node_id" : "PRRC_kwDOABII5842nrfR",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 169,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 41,
      "pull_request_review_id" : 1032278439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916371409/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T01:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916371409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916371775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916371775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "i think the set of criterias, you might have multiple ones with the proposed API?",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-07-08T00:36:11Z",
      "diff_hunk" : "@@ -444,6 +445,11 @@ class MemPoolAccept\n          */\n         std::vector<COutPoint>& m_coins_to_uncache;\n         const bool m_test_accept;\n+        /*\n+         * It represents the criteria that will be used to test the transactions\n+         * without submitting them.\n+         */\n+        const MempoolTestCriteria m_test_criteria;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916371775",
      "id" : 916371775,
      "line" : 452,
      "node_id" : "PRRC_kwDOABII5842nrk_",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 452,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 22,
      "pull_request_review_id" : 1032278439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916371775/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T01:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916371775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916374450"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916374450"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As it's a belt-and-suspender to detect we don't have non-fully consensus-enforced transactions slipping in the mempool, i would rather go for something more explicit `EnsureFullyValidatedTransaction()` or `EnsureNoBypassApplied()`.",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-07-08T00:44:57Z",
      "diff_hunk" : "@@ -1041,6 +1054,9 @@ bool MemPoolAccept::Finalize(const ATMPArgs& args, Workspace& ws)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n+\n+    assert(args.m_test_criteria.AllowFinalizeTransaction());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916374450",
      "id" : 916374450,
      "line" : 1058,
      "node_id" : "PRRC_kwDOABII5842nsOy",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 1058,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 114,
      "pull_request_review_id" : 1032278439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916374450/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T01:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916374450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916378609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916378609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I wonder if it's not the good time to factor in a single new structure `MemPoolCriteria` encompassing `bypass_limits`, `test_accept` and `test_criteria`. The ctor could have an `assert` to ensure the client-provided bypass options such as timelocks are coming from `testmempoolaccept`. ",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-07-08T00:58:13Z",
      "diff_hunk" : "@@ -1404,16 +1420,21 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n } // anon namespace\n \n MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, const CTransactionRef& tx,\n-                                       int64_t accept_time, bool bypass_limits, bool test_accept)\n+                                       int64_t accept_time, bool bypass_limits, bool test_accept,\n+                                       const std::optional<MempoolTestCriteria>& test_criteria)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916378609",
      "id" : 916378609,
      "line" : 1424,
      "node_id" : "PRRC_kwDOABII5842ntPx",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 1424,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 125,
      "pull_request_review_id" : 1032278439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916378609/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T01:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916378609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916378909"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916378909"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this structure could be documented. Though see comment above if it makes sense to factor in a single struct `MemPoolBypass`. ",
      "commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "created_at" : "2022-07-08T00:59:10Z",
      "diff_hunk" : "@@ -230,6 +230,15 @@ struct PackageMempoolAcceptResult\n         : m_tx_results{ {wtxid, result} } {}\n };\n \n+struct MempoolTestCriteria {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r916378909",
      "id" : 916378909,
      "line" : 233,
      "node_id" : "PRRC_kwDOABII5842ntUd",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 233,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 4,
      "pull_request_review_id" : 1032278439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916378909/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-08T01:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/916378909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ariard Thanks for the review. I will address your suggestions soon.\r\n\r\n#25570 adds `bypass_{csv,cltv}` options. This way I think all the options in the list in https://github.com/bitcoin/bitcoin/pull/25434#pullrequestreview-1020896809 are implemented.",
      "created_at" : "2022-07-08T12:15:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1178920473",
      "id" : 1178920473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585GROYZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1178920473/reactions"
      },
      "updated_at" : "2022-07-08T12:15:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1178920473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in https://github.com/bitcoin/bitcoin/pull/25434/commits/7ec64163107a7fc301ed3858ef2e9427e4c4aef8",
      "commit_id" : "a006b8fd5a16c5283c25c4b8d93d96d485896816",
      "created_at" : "2022-07-10T04:38:56Z",
      "diff_hunk" : "@@ -97,8 +97,16 @@ static RPCHelpMan testmempoolaccept()\n                     {\"rawtx\", RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, \"\"},\n                 },\n             },\n-            {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n-             \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT + \"/kvB\\n\"},\n+            {\"options\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED_NAMED_ARG, \"\",\n+                {\n+                    {\"maxfeerate\", RPCArg::Type::AMOUNT, RPCArg::Default{FormatMoney(DEFAULT_MAX_RAW_TX_FEE_RATE.GetFeePerK())},\n+                    \"Reject transactions whose fee rate is higher than the specified value, expressed in \" + CURRENCY_UNIT + \"/kvB\\n\"},\n+                    {\"bypass_absolute_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Don't enforce nLocktime.\\n\"},\n+                    {\"bypass_relative_timelocks\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Don't enforce BIP68 relative lock-time.\\n\"}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338277",
      "id" : 917338277,
      "in_reply_to_id" : 916367721,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842rXil",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 105,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1033589472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338277/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T04:38:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in https://github.com/bitcoin/bitcoin/commit/7ec64163107a7fc301ed3858ef2e9427e4c4aef8",
      "commit_id" : "a006b8fd5a16c5283c25c4b8d93d96d485896816",
      "created_at" : "2022-07-10T04:39:21Z",
      "diff_hunk" : "@@ -143,9 +151,32 @@ static RPCHelpMan testmempoolaccept()\n                                    \"Array must contain between 1 and \" + ToString(MAX_PACKAGE_COUNT) + \" transactions.\");\n             }\n \n-            const CFeeRate max_raw_tx_fee_rate = request.params[1].isNull() ?\n-                                                     DEFAULT_MAX_RAW_TX_FEE_RATE :\n-                                                     CFeeRate(AmountFromValue(request.params[1]));\n+            CFeeRate max_raw_tx_fee_rate = DEFAULT_MAX_RAW_TX_FEE_RATE;\n+\n+            auto test_criteria = MempoolTestCriteria();\n+\n+            if (!request.params[1].isNull()) {\n+                const UniValue& options = request.params[1];\n+                RPCTypeCheckObj(options,\n+                    {\n+                        {\"maxfeerate\", UniValueType()}, // will be checked by AmountFromValue() below\n+                        {\"bypass_absolute_timelocks\", UniValueType(UniValue::VBOOL)},\n+                        {\"bypass_relative_timelocks\", UniValueType(UniValue::VBOOL)},\n+                    },\n+                    true, true);\n+\n+                if (options.exists(\"maxfeerate\")) {\n+                    max_raw_tx_fee_rate = CFeeRate(AmountFromValue(options[\"maxfeerate\"]));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338303",
      "id" : 917338303,
      "in_reply_to_id" : 916371409,
      "line" : 169,
      "node_id" : "PRRC_kwDOABII5842rXi_",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 169,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 41,
      "pull_request_review_id" : 1033589495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338303/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T04:39:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed it to `const MemPoolBypass m_mempool_bypass` in https://github.com/bitcoin/bitcoin/pull/25577/commits/26ee1a47e4bafe8faf60e16c987504d7d1b71c29",
      "commit_id" : "a006b8fd5a16c5283c25c4b8d93d96d485896816",
      "created_at" : "2022-07-10T04:40:39Z",
      "diff_hunk" : "@@ -444,6 +445,11 @@ class MemPoolAccept\n          */\n         std::vector<COutPoint>& m_coins_to_uncache;\n         const bool m_test_accept;\n+        /*\n+         * It represents the criteria that will be used to test the transactions\n+         * without submitting them.\n+         */\n+        const MempoolTestCriteria m_test_criteria;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338417",
      "id" : 917338417,
      "in_reply_to_id" : 916371775,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842rXkx",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 452,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1033589563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T04:40:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338551"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in https://github.com/bitcoin/bitcoin/pull/25434/commits/12ac626430beda7bc0c8b79b0af6efe5f0e96119",
      "commit_id" : "a006b8fd5a16c5283c25c4b8d93d96d485896816",
      "created_at" : "2022-07-10T04:42:38Z",
      "diff_hunk" : "@@ -1041,6 +1054,9 @@ bool MemPoolAccept::Finalize(const ATMPArgs& args, Workspace& ws)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n+\n+    assert(args.m_test_criteria.AllowFinalizeTransaction());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338551",
      "id" : 917338551,
      "in_reply_to_id" : 916374450,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842rXm3",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 1058,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1033589628,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T04:42:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338760"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in #25577.\r\n\r\n`test_accept` and `bypass_limits` are used elsewhere, not just `testmempoolaccept`.\r\n#25577 creates `struct MemPoolBypass` that encompasses both variables.",
      "commit_id" : "a006b8fd5a16c5283c25c4b8d93d96d485896816",
      "created_at" : "2022-07-10T04:46:26Z",
      "diff_hunk" : "@@ -1404,16 +1420,21 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n } // anon namespace\n \n MempoolAcceptResult AcceptToMemoryPool(CChainState& active_chainstate, const CTransactionRef& tx,\n-                                       int64_t accept_time, bool bypass_limits, bool test_accept)\n+                                       int64_t accept_time, bool bypass_limits, bool test_accept,\n+                                       const std::optional<MempoolTestCriteria>& test_criteria)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338760",
      "id" : 917338760,
      "in_reply_to_id" : 916378609,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842rXqI",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 1424,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1033589774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T04:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338798"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in https://github.com/bitcoin/bitcoin/pull/25577/commits/9e8703ca5ff0ce7a45f160ca26ac3ba7f1f71116",
      "commit_id" : "a006b8fd5a16c5283c25c4b8d93d96d485896816",
      "created_at" : "2022-07-10T04:46:52Z",
      "diff_hunk" : "@@ -230,6 +230,15 @@ struct PackageMempoolAcceptResult\n         : m_tx_results{ {wtxid, result} } {}\n };\n \n+struct MempoolTestCriteria {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#discussion_r917338798",
      "id" : 917338798,
      "in_reply_to_id" : 916378909,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5842rXqu",
      "original_commit_id" : "52a2e282568d404c9b48ab88e6ccd18ad140ad16",
      "original_line" : 233,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 1033589798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25434",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338798/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T04:46:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917338798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@ariard  I addressed most of your suggestions in a new PR (https://github.com/bitcoin/bitcoin/pull/25577).\r\n\r\nThat PR does not change behavior, it just refactors the use of `test_accept` and `bypass_limits`, allocating them in a new struct `MemPoolBypass`.\r\n\r\nI rebased this PR on top of #25577.",
      "created_at" : "2022-07-10T04:51:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1179656047",
      "id" : 1179656047,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585GUB9v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1179656047/reactions"
      },
      "updated_at" : "2022-07-10T04:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1179656047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I would like to see a stronger rationale for this change, as well as for the end goal of the path to conditionally bypass mempool checks. In short, i'm worried we are going to introduce a lot of complexity to this critical part of the codebase with only marginal -if any- benefits.\r\n\r\nIt seems like [the motivation is helping to test applications which use offchain contracts](https://github.com/bitcoin/bitcoin/pull/21413#issuecomment-796294039). Any reasonable such application has a functional test framework (similar to ours) in which many sequences of events are tested in a blackbox manner. It is necessary to test the different spending paths of a Script, but does a lot more. Adding the option to bypass timelocks would only allow the most basic of those tests to use `testmempoolaccept` instead of generating a couple of blocks before using `sendrawtransaction`. Sure, that would reduce the runtime of those tests (by what, a few hundred milliseconds?). But i don't think it's a good tradeoff for us to make.\r\nFurthermore, functional tests are for simulating real conditions and you necessary want to test *the very same* codepath that your application would use in prod. That is, using `sendrawtransaction`. We could assure them `testmempoolaccept` actually uses almost the very same codepath as `sendrawtransaction` (which is becoming less true as we add more complexity there), but i don't think it would be very convincing: if testing the exact codepath your application will trigger in prod is a `node.generate(6)` away, you'll just do it.\r\nIf the motivation for these PRs, and the direction things are taking, is \"it'll help L2s apps to test better, maybe, eventually\" i would suggest we take a step back and examine: how would such an application testing framework actually use it? For instance, here are two functional tests from two candidate projects i'm familiar with:\r\n- For C-lightning, https://github.com/ElementsProject/lightning/blob/42783aaa928da79e1295dcdc53123a66cb2433cc/tests/test_closing.py#L480-L599\r\n- For Revault, https://github.com/revault/revaultd/blob/7cd856d5a345319cebc815aa61f3b66cebb48b86/tests/test_rpc.py#L996-L1121\r\n\r\nBoth (implicitly or not) test the validity of transactions critical to the security of the protocol. I don't think `testmempoolaccept` with any form of bypass would help here. Neither would it for a lot other test.\r\n\r\nEven assuming this feature might eventually be used. In #20833 we introduced `testmempoolaccept`, which could be used to quickly sanity check [the \"static\" standardness bounds of a transaction](https://github.com/bitcoin/bitcoin/pull/20833#issuecomment-762080588). It was probably a good tradeoff. Now, we want to push this forward with allowing to also be able to test timelocked transactions. And by the same logic it was [suggested](https://github.com/bitcoin/bitcoin/pull/25434#pullrequestreview-1020896809) to then allow for mocking the transaction with dummy values for Script. Where do we stop? We have a clear layer violation here. What is suggested with dummy signatures is precisely what we do internally with the [`DummySignatureChecker`](https://github.com/bitcoin/bitcoin/blob/327b7e9236e3b0cde750df72d5f75821e52e545c/src/script/sign.cpp#L586-L623)! Does it mean we should expose more of our internals via RPC? I don't think so, it would only result in cluttered code and interfaces and would not eliminate the need for any L2 application to have a functional test framework in which they create keys, spin up nodes, sign transactions and broadcast them in different sequences.\r\n\r\nTherefore i think we need some kind of a plan for this bypass-everything direction, as well as some more motivation for going this way.",
      "created_at" : "2022-07-11T09:56:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1180197200",
      "id" : 1180197200,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585GWGFQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1180197200/reactions"
      },
      "updated_at" : "2022-07-11T18:05:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1180197200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Motivation of this work is to provide tools enabling L2 applications to verify that issued transactions (not only pre-signed ones) can broadcast well on the p2p network, at least on the majority of nodes running the default Core policy. As a reminder, for this type of application, confirming transactions in due time is critical for the security of funds, a point I believe none of us deny.\r\n\r\nFor a typical Lightning implementation, this \"standardness defect\" risk can manifest itself at reception of the counterparty signatures for commitment / HTLC transactions. For the latest one, the `nLocktime` is set and the feerate is 0 (post `option_anchors_zero_fee_htlc_tx`). Therefore those transactions, of which the broadcast time is unknown, would be rejected by `testmempoolaccept` due to to non-compliance with contingent policy checks like timelocks or feerates.\r\n\r\nAs of today, if you would like to currently assert the standardness of those transactions (to eliminate vulnerabilities like CVE-2020-26895 to slip in), I think the solution is to rewrite by yourself all the policy checks in your implementation library (e.g in rust-bitcoin, we  have a [dust threshold](https://github.com/rust-bitcoin/rust-bitcon/blob/9cfa9bd9df4402363493e7503b86ff6bfd63a14c/src/blockdata/script.rs#L583)) check. However, there is no guarantee that those checks are re-implemented _correctly_ or even that there are _exhaustive_ compared to Bitcoin Core mempool policy ones.\r\n\r\nThat `testmempoolaccept` code path diverges from `sendrawtransaction` is an unfortunate fact that iirc I raised during the reviews of the mempool package accept PRs. As sketched out above, I think the ideal interface would rather be a`libstandardness` with bypass options allowing direct access to `AcceptToMemoryPool()` not only to make the verification codepath as similar to the broadcast codepath, but also as an architecture convinency for mobile clients and a performance improvement for LN routing hops (relying on RPC call adds latency in HTLC relay due to process context-switch).\r\n\r\nI don't think the advocated layer violation matters. In system engineering, you'll always find layer violation, e.g using ASM snippets in your high-level language source code to access CPU registers and boost your computation performance likewise with mathematic libraries (even if 99,99% of the userspace applications won't do that). So I think the question is more about if the layer violation is justified in the present case. About the scope, I think we should allow to check for as much standardness bounds that it makes sense for the application semantic.\r\n\r\nThat said, I think we should put apart the question of what should be the ideal interface to verify the standardness bounds (i.e RPC call, new shared library, new Capn' Proto interface, etc). In my understanding, I think the question where we diverge is if every L2 implementation should rewrite the Core standardness logic to verify its transaction validity, as much as you can in function of the application semantics, or rather we should expose this standardness logic in a straightforward way.\r\n\r\nI think the first approach is not only duplicating the engineering cost for any L2 implementation, instead to factor in Core but also far more error-prone.",
      "created_at" : "2022-07-14T18:52:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1184787060",
      "id" : 1184787060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585Gnmp0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184787060/reactions"
      },
      "updated_at" : "2022-07-14T18:52:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184787060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-18T15:52:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25434#issuecomment-1187670139",
      "id" : 1187670139,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25434",
      "node_id" : "IC_kwDOABII585Gymh7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1187670139/reactions"
      },
      "updated_at" : "2022-07-18T15:52:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1187670139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
