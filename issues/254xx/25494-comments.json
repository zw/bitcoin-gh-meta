[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25297](https://github.com/bitcoin/bitcoin/pull/25297) (WIP, wallet: speedup transactions sync, rescan and load not flushing to db constantly by furszy)\n* [#25222](https://github.com/bitcoin/bitcoin/pull/25222) (refactor: Pass reference to LookUpStats by MarcoFalke)\n* [#24150](https://github.com/bitcoin/bitcoin/pull/24150) (refactor: move index class members from protected to private by jonatack)\n* [#23997](https://github.com/bitcoin/bitcoin/pull/23997) (wallet: avoid rescans under assumed-valid blocks by jamesob)\n* [#19888](https://github.com/bitcoin/bitcoin/pull/19888) (rpc, test: Improve getblockstats for unspendables by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-06-29T00:33:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#issuecomment-1169413997",
      "id" : 1169413997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25494",
      "node_id" : "IC_kwDOABII585Fs9dt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169413997/reactions"
      },
      "updated_at" : "2022-07-01T10:09:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169413997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r909241872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909241872"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems that this will only copy/alias the internal memory to a different type. I wonder if this is actually useful, because it disables lock annotations for the memory where they may actually still be needed? Also, I wonder how useful an interface is that returns a data structure that points into memory that is owned by a different process (I am assuming each blockindex runs in a different multiprocess)",
      "commit_id" : "3c82fa533a31939b867c774fe2c05f7a2e1d1a0c",
      "created_at" : "2022-06-29T06:25:49Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <chain.h>\n+#include <interfaces/chain.h>\n+#include <uint256.h>\n+\n+namespace node {\n+interfaces::BlockInfo MakeBlockInfo(const CBlockIndex* index, const CBlock* data)\n+{\n+    interfaces::BlockInfo info{index ? *index->phashBlock : uint256::ZERO};\n+    if (index) {\n+        info.prev_hash = index->pprev ? index->pprev->phashBlock : nullptr;\n+        info.height = index->nHeight;\n+        LOCK(::cs_main);\n+        info.file_number = index->nFile;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r909241872",
      "id" : 909241872,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII5842Me4Q",
      "original_commit_id" : "3c82fa533a31939b867c774fe2c05f7a2e1d1a0c",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : 17,
      "pull_request_review_id" : 1022793964,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909241872/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-29T06:25:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909241872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Linter warns of a circular dependency\r\n\r\n```\r\nA new circular dependency in the form of \"index/base -> node/context -> net_processing -> index/blockfilterindex -> index/base\" appears to have been introduced.\r\n```",
      "created_at" : "2022-07-02T23:15:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#issuecomment-1172976870",
      "id" : 1172976870,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25494",
      "node_id" : "IC_kwDOABII585F6jTm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1172976870/reactions"
      },
      "updated_at" : "2022-07-02T23:15:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1172976870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r914005702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/914005702"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r909241872\r\n\r\nIn commit \"interfaces, refactor: Add more block information to block connected notifications\" (0a93a16614659a7c12e7e95478a9bb564c1a13cb)\r\n\r\n> It seems that this will only copy/alias the internal memory to a different type. I wonder if this is actually useful, because it disables lock annotations for the memory where they may actually still be needed?\r\n\r\nI don't think there's actually a concern here, and this is what current code already does. `cs_main` is locked while reading `nFile` and `nDataPos` values, but not when `ReadBlockFromDisk` is called. Values are copied first and then used.\r\n\r\n> Also, I wonder how useful an interface is that returns a data structure that points into memory that is owned by a different process (I am assuming each blockindex runs in a different multiprocess)\r\n\r\nThe change in this commit is to replace individual `block` & `height` parameters with a `BlockInfo` struct parameter that can hold more information about the block:\r\n\r\n```diff\r\n-        virtual void blockConnected(const CBlock& block, int height) {}\r\n-        virtual void blockDisconnected(const CBlock& block, int height) {}\r\n+        virtual void blockConnected(const BlockInfo& block) {}\r\n+        virtual void blockDisconnected(const BlockInfo& block) {}\r\n```\r\n\r\nThe point of using the struct is to make code more readable and avoid the need to update `blockConnected`/`blockDisconnected` declarations when more block information is needed.\r\n\r\nSemantically there's no difference between passing a `const uint256& hash` parameter vs adding a `const uint256& hash;` struct member, or passing an `int file_number` parameter vs. adding an `int file_number;` struct member. All the copy and reference and lifetime concerns are the same.\r\n\r\nIt is true that because referencing memory in other processes is not possible, multiprocess code will create local copies of values when references are passed, and the local copies may have shorter lifetimes than original references. But this is true wherever references and pointers are used in `src/interface/` classes, so not a new thing.",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-05T16:52:54Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <chain.h>\n+#include <interfaces/chain.h>\n+#include <uint256.h>\n+\n+namespace node {\n+interfaces::BlockInfo MakeBlockInfo(const CBlockIndex* index, const CBlock* data)\n+{\n+    interfaces::BlockInfo info{index ? *index->phashBlock : uint256::ZERO};\n+    if (index) {\n+        info.prev_hash = index->pprev ? index->pprev->phashBlock : nullptr;\n+        info.height = index->nHeight;\n+        LOCK(::cs_main);\n+        info.file_number = index->nFile;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r914005702",
      "id" : 914005702,
      "in_reply_to_id" : 909241872,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII5842ep7G",
      "original_commit_id" : "3c82fa533a31939b867c774fe2c05f7a2e1d1a0c",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : 17,
      "pull_request_review_id" : 1028935378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/914005702/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-05T17:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/914005702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r917168552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917168552"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this line could be made a little easier to parse but since it's in fuzzing it's not so important",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-08T22:24:11Z",
      "diff_hunk" : "@@ -155,8 +161,14 @@ FUZZ_TARGET_INIT(wallet_notifications, initialize_setup)\n                 auto& [coins, block]{chain.back()};\n                 if (block.vtx.empty()) return; // Can only disconnect if the block was submitted first\n                 // Disconnect block\n-                a.wallet->blockDisconnected(block, chain.size() - 1);\n-                b.wallet->blockDisconnected(block, chain.size() - 1);\n+                const uint256& hash = block.GetHash();\n+                const uint256& prev_hash = chain.size() >= 2 ? std::get<1>(chain[chain.size() - 2]).GetHash() : uint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r917168552",
      "id" : 917168552,
      "line" : 165,
      "node_id" : "PRRC_kwDOABII5842quGo",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 165,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/notifications.cpp",
      "position" : 24,
      "pull_request_review_id" : 1033423438,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917168552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T12:06:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917168552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r917300216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917300216"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "note for other reviewers: in this PR this is unused but will be used in follow-ups, see #24230",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-09T19:21:50Z",
      "diff_hunk" : "@@ -67,6 +68,19 @@ class FoundBlock\n     mutable bool found = false;\n };\n \n+//! Block data sent with blockConnected, blockDisconnected notifications.\n+struct BlockInfo {\n+    const uint256& hash;\n+    const uint256* prev_hash = nullptr;\n+    int height = -1;\n+    int file_number = -1;\n+    unsigned data_pos = 0;\n+    const CBlock* data = nullptr;\n+    const CBlockUndo* undo_data = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r917300216",
      "id" : 917300216,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII5842rOP4",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 79,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : 20,
      "pull_request_review_id" : 1033423438,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917300216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-10T12:06:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/917300216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920134694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920134694"
         }
      },
      "author_association" : "MEMBER",
      "body" : "first commit: block and chain.back() are both mutable references to the same memory, so I think this is wrong\r\n\r\nCould write `&block.hashPrevBlock` below?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T14:16:00Z",
      "diff_hunk" : "@@ -138,8 +138,14 @@ FUZZ_TARGET_INIT(wallet_notifications, initialize_setup)\n                     block.vtx.emplace_back(MakeTransactionRef(tx));\n                 }\n                 // Mine block\n-                a.wallet->blockConnected(block, chain.size());\n-                b.wallet->blockConnected(block, chain.size());\n+                const uint256& hash = block.GetHash();\n+                const uint256& prev_hash = std::get<1>(chain.back()).GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920134694",
      "id" : 920134694,
      "line" : 142,
      "node_id" : "PRRC_kwDOABII58422CQm",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 142,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/notifications.cpp",
      "position" : 7,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920134694/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920134694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920138374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920138374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same commit: There is an early return above if the size is `1` or less, thus the size must be `2` or more, thus the check here is not needed. Also, could just remove all of this and write `&block.hashPrevBlock` below?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T14:19:07Z",
      "diff_hunk" : "@@ -155,8 +161,14 @@ FUZZ_TARGET_INIT(wallet_notifications, initialize_setup)\n                 auto& [coins, block]{chain.back()};\n                 if (block.vtx.empty()) return; // Can only disconnect if the block was submitted first\n                 // Disconnect block\n-                a.wallet->blockDisconnected(block, chain.size() - 1);\n-                b.wallet->blockDisconnected(block, chain.size() - 1);\n+                const uint256& hash = block.GetHash();\n+                const uint256& prev_hash = chain.size() >= 2 ? std::get<1>(chain[chain.size() - 2]).GetHash() : uint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920138374",
      "id" : 920138374,
      "line" : 165,
      "node_id" : "PRRC_kwDOABII58422DKG",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 165,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/notifications.cpp",
      "position" : 24,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920138374/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920138374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920139725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920139725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "first commit: Missing LIFETIMEBOUND attribute for `hash`?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T14:20:12Z",
      "diff_hunk" : "@@ -67,6 +68,19 @@ class FoundBlock\n     mutable bool found = false;\n };\n \n+//! Block data sent with blockConnected, blockDisconnected notifications.\n+struct BlockInfo {\n+    const uint256& hash;\n+    const uint256* prev_hash = nullptr;\n+    int height = -1;\n+    int file_number = -1;\n+    unsigned data_pos = 0;\n+    const CBlock* data = nullptr;\n+    const CBlockUndo* undo_data = nullptr;\n+\n+    BlockInfo(const uint256& hash) : hash(hash) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920139725",
      "id" : 920139725,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII58422DfN",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 81,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : 22,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920139725/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920139725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920143703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920143703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "First commit: Why are you changing this from `block.data->hashPrevBlock`? If this is intentional, missing an assert to avoid UB?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T14:23:41Z",
      "diff_hunk" : "@@ -1323,30 +1323,31 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n     }\n }\n \n-void CWallet::blockConnected(const CBlock& block, int height)\n+void CWallet::blockConnected(const interfaces::BlockInfo& block)\n {\n-    const uint256& block_hash = block.GetHash();\n+    assert(block.data);\n     LOCK(cs_wallet);\n \n-    m_last_block_processed_height = height;\n-    m_last_block_processed = block_hash;\n-    for (size_t index = 0; index < block.vtx.size(); index++) {\n-        SyncTransaction(block.vtx[index], TxStateConfirmed{block_hash, height, static_cast<int>(index)});\n-        transactionRemovedFromMempool(block.vtx[index], MemPoolRemovalReason::BLOCK, 0 /* mempool_sequence */);\n+    m_last_block_processed_height = block.height;\n+    m_last_block_processed = block.hash;\n+    for (size_t index = 0; index < block.data->vtx.size(); index++) {\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n+        transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK, 0 /* mempool_sequence */);\n     }\n }\n \n-void CWallet::blockDisconnected(const CBlock& block, int height)\n+void CWallet::blockDisconnected(const interfaces::BlockInfo& block)\n {\n+    assert(block.data);\n     LOCK(cs_wallet);\n \n     // At block disconnection, this will change an abandoned transaction to\n     // be unconfirmed, whether or not the transaction is added back to the mempool.\n     // User may have to call abandontransaction again. It may be addressed in the\n     // future with a stickier abandoned state or even removing abandontransaction call.\n-    m_last_block_processed_height = height - 1;\n-    m_last_block_processed = block.hashPrevBlock;\n-    for (const CTransactionRef& ptx : block.vtx) {\n+    m_last_block_processed_height = block.height - 1;\n+    m_last_block_processed = *block.prev_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920143703",
      "id" : 920143703,
      "line" : 1349,
      "node_id" : "PRRC_kwDOABII58422EdX",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 1349,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 38,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920143703/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920143703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920151862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920151862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2f8a5307b7065de08df2edaa369739544248387f: (nit) Start newline before `:` to avoid excessive line length?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T14:30:09Z",
      "diff_hunk" : "@@ -102,7 +102,7 @@ struct DBHashKey {\n \n std::unique_ptr<CoinStatsIndex> g_coin_stats_index;\n \n-CoinStatsIndex::CoinStatsIndex(size_t n_cache_size, bool f_memory, bool f_wipe)\n+CoinStatsIndex::CoinStatsIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe) : BaseIndex(std::move(chain))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920151862",
      "id" : 920151862,
      "line" : 105,
      "node_id" : "PRRC_kwDOABII58422Gc2",
      "original_commit_id" : "2f8a5307b7065de08df2edaa369739544248387f",
      "original_line" : 105,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : 5,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920151862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920151862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920156128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920156128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2f8a5307b7065de08df2edaa369739544248387f: Wrapping this into a function to avoid moving a pointer seems overkill?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T14:33:43Z",
      "diff_hunk" : "@@ -1579,22 +1579,22 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             return InitError(*error);\n         }\n \n-        g_txindex = std::make_unique<TxIndex>(cache_sizes.tx_index, false, fReindex);\n-        if (!g_txindex->Start(chainman.ActiveChainstate())) {\n+        g_txindex = std::make_unique<TxIndex>(interfaces::MakeChain(node), cache_sizes.tx_index, false, fReindex);\n+        if (!g_txindex->Start()) {\n             return false;\n         }\n     }\n \n     for (const auto& filter_type : g_enabled_filter_types) {\n-        InitBlockFilterIndex(filter_type, cache_sizes.filter_index, false, fReindex);\n-        if (!GetBlockFilterIndex(filter_type)->Start(chainman.ActiveChainstate())) {\n+        InitBlockFilterIndex([&]{ return interfaces::MakeChain(node); }, filter_type, cache_sizes.filter_index, false, fReindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920156128",
      "id" : 920156128,
      "line" : 1589,
      "node_id" : "PRRC_kwDOABII58422Hfg",
      "original_commit_id" : "2f8a5307b7065de08df2edaa369739544248387f",
      "original_line" : 1589,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 15,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920156128/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920156128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920222836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "88cad3cb604058d8f26790eeb37abe2dabc0c033: Could explain in the commit message that this is only temporary? If not, move it to the kernel folder?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T15:32:07Z",
      "diff_hunk" : "@@ -878,6 +878,7 @@ libbitcoinkernel_la_SOURCES = \\\n   key.cpp \\\n   logging.cpp \\\n   node/blockstorage.cpp \\\n+  node/chain.cpp \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920222836",
      "id" : 920222836,
      "line" : 881,
      "node_id" : "PRRC_kwDOABII58422Xx0",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 881,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/Makefile.am",
      "position" : 4,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920222836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920223420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "88cad3cb604058d8f26790eeb37abe2dabc0c033: I wonder where UB should be avoided with asserts and where not",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T15:32:37Z",
      "diff_hunk" : "@@ -209,22 +210,25 @@ size_t BlockFilterIndex::WriteFilterToDisk(FlatFilePos& pos, const BlockFilter&\n     return data_size;\n }\n \n-bool BlockFilterIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n+bool BlockFilterIndex::CustomAppend(const interfaces::BlockInfo& block)\n {\n     CBlockUndo block_undo;\n     uint256 prev_header;\n \n-    if (pindex->nHeight > 0) {\n+    if (block.height > 0) {\n+        // pindex variable gives indexing code access to node internals. It\n+        // will be removed in upcoming commit\n+        const CBlockIndex* pindex = WITH_LOCK(cs_main, return m_chainstate->m_blockman.LookupBlockIndex(block.hash));\n         if (!UndoReadFromDisk(block_undo, pindex)) {\n             return false;\n         }\n \n         std::pair<uint256, DBVal> read_out;\n-        if (!m_db->Read(DBHeightKey(pindex->nHeight - 1), read_out)) {\n+        if (!m_db->Read(DBHeightKey(block.height - 1), read_out)) {\n             return false;\n         }\n \n-        uint256 expected_block_hash = pindex->pprev->GetBlockHash();\n+        uint256 expected_block_hash = *block.prev_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920223420",
      "id" : 920223420,
      "line" : 231,
      "node_id" : "PRRC_kwDOABII58422X68",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 231,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/index/blockfilterindex.cpp",
      "position" : 34,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223420/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920223553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T15:32:44Z",
      "diff_hunk" : "@@ -233,18 +237,18 @@ bool BlockFilterIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex\n         prev_header = read_out.second.header;\n     }\n \n-    BlockFilter filter(m_filter_type, block, block_undo);\n+    BlockFilter filter(m_filter_type, *block.data, block_undo);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920223553",
      "id" : 920223553,
      "line" : 240,
      "node_id" : "PRRC_kwDOABII58422X9B",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 240,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/index/blockfilterindex.cpp",
      "position" : 43,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920223553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920224709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920224709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T15:33:49Z",
      "diff_hunk" : "@@ -110,24 +110,27 @@ CoinStatsIndex::CoinStatsIndex(std::unique_ptr<interfaces::Chain> chain, size_t\n     m_db = std::make_unique<CoinStatsIndex::DB>(path / \"db\", n_cache_size, f_memory, f_wipe);\n }\n \n-bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n+bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n {\n     CBlockUndo block_undo;\n-    const CAmount block_subsidy{GetBlockSubsidy(pindex->nHeight, Params().GetConsensus())};\n+    const CAmount block_subsidy{GetBlockSubsidy(block.height, Params().GetConsensus())};\n     m_total_subsidy += block_subsidy;\n \n     // Ignore genesis block\n-    if (pindex->nHeight > 0) {\n+    if (block.height > 0) {\n+        // pindex variable gives indexing code access to node internals. It\n+        // will be removed in upcoming commit\n+        const CBlockIndex* pindex = WITH_LOCK(cs_main, return m_chainstate->m_blockman.LookupBlockIndex(block.hash));\n         if (!UndoReadFromDisk(block_undo, pindex)) {\n             return false;\n         }\n \n         std::pair<uint256, DBVal> read_out;\n-        if (!m_db->Read(DBHeightKey(pindex->nHeight - 1), read_out)) {\n+        if (!m_db->Read(DBHeightKey(block.height - 1), read_out)) {\n             return false;\n         }\n \n-        uint256 expected_block_hash{pindex->pprev->GetBlockHash()};\n+        uint256 expected_block_hash{*block.prev_hash};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920224709",
      "id" : 920224709,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII58422YPF",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 133,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : 29,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920224709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920224709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920243749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920243749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3: This changes behavior: Previously there was a call to `error()`, now there is none?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-13T15:50:52Z",
      "diff_hunk" : "@@ -206,22 +215,19 @@ void BaseIndex::ThreadSync()\n \n bool BaseIndex::Commit()\n {\n-    CDBBatch batch(GetDB());\n-    if (!CommitInternal(batch) || !GetDB().WriteBatch(batch)) {\n-        return error(\"%s: Failed to commit latest %s state\", __func__, GetName());\n-    }\n-    return true;\n-}\n-\n-bool BaseIndex::CommitInternal(CDBBatch& batch)\n-{\n-    LOCK(cs_main);\n     // Don't commit anything if we haven't indexed any block yet\n     // (this could happen if init is interrupted).\n     if (m_best_block_index == nullptr) {\n         return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920243749",
      "id" : 920243749,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII58422c4l",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 221,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 33,
      "pull_request_review_id" : 1037443507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920243749/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-13T15:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920243749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920806328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920806328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe add this new file to iwyu?",
      "commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "created_at" : "2022-07-14T06:41:28Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920806328",
      "id" : 920806328,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII58424mO4",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : 1,
      "pull_request_review_id" : 1038366919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920806328/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T06:41:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920806328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920139725\r\n\r\n> first commit: Missing LIFETIMEBOUND attribute for `hash`?\r\n\r\nAdded. This is great! I did not know about this",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:28:26Z",
      "diff_hunk" : "@@ -67,6 +68,19 @@ class FoundBlock\n     mutable bool found = false;\n };\n \n+//! Block data sent with blockConnected, blockDisconnected notifications.\n+struct BlockInfo {\n+    const uint256& hash;\n+    const uint256* prev_hash = nullptr;\n+    int height = -1;\n+    int file_number = -1;\n+    unsigned data_pos = 0;\n+    const CBlock* data = nullptr;\n+    const CBlockUndo* undo_data = nullptr;\n+\n+    BlockInfo(const uint256& hash) : hash(hash) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500546",
      "id" : 921500546,
      "in_reply_to_id" : 920139725,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427PuC",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 81,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/interfaces/chain.h",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500652"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920806328\r\n\r\n> Maybe add this new file to iwyu?\r\n\r\nThanks, added",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:28:35Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500652",
      "id" : 921500652,
      "in_reply_to_id" : 920806328,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427Pvs",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500652/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500845"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920151862\r\n\r\n> [2f8a530](https://github.com/bitcoin/bitcoin/commit/2f8a5307b7065de08df2edaa369739544248387f): (nit) Start newline before `:` to avoid excessive line length?\r\n\r\nNow moved to new line",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:28:51Z",
      "diff_hunk" : "@@ -102,7 +102,7 @@ struct DBHashKey {\n \n std::unique_ptr<CoinStatsIndex> g_coin_stats_index;\n \n-CoinStatsIndex::CoinStatsIndex(size_t n_cache_size, bool f_memory, bool f_wipe)\n+CoinStatsIndex::CoinStatsIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe) : BaseIndex(std::move(chain))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500845",
      "id" : 921500845,
      "in_reply_to_id" : 920151862,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427Pyt",
      "original_commit_id" : "2f8a5307b7065de08df2edaa369739544248387f",
      "original_line" : 105,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500845/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500928"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920156128\r\n\r\n> [2f8a530](https://github.com/bitcoin/bitcoin/commit/2f8a5307b7065de08df2edaa369739544248387f): Wrapping this into a function to avoid moving a pointer seems overkill?\r\n\r\nReason this is using a `std::function` is I was looking for a simple way to allow the Init*Index functions to stay where they are in `src/index/` without referencing the `NodeContext` struct. Maybe this isn't a critical goal though, or there is a better way of achieving it. Since I want to extend #10102 to run indexes separately I will have to revisit this code anyway later, so happy to go with whatever would be suggested now if this is not good.",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:28:58Z",
      "diff_hunk" : "@@ -1579,22 +1579,22 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             return InitError(*error);\n         }\n \n-        g_txindex = std::make_unique<TxIndex>(cache_sizes.tx_index, false, fReindex);\n-        if (!g_txindex->Start(chainman.ActiveChainstate())) {\n+        g_txindex = std::make_unique<TxIndex>(interfaces::MakeChain(node), cache_sizes.tx_index, false, fReindex);\n+        if (!g_txindex->Start()) {\n             return false;\n         }\n     }\n \n     for (const auto& filter_type : g_enabled_filter_types) {\n-        InitBlockFilterIndex(filter_type, cache_sizes.filter_index, false, fReindex);\n-        if (!GetBlockFilterIndex(filter_type)->Start(chainman.ActiveChainstate())) {\n+        InitBlockFilterIndex([&]{ return interfaces::MakeChain(node); }, filter_type, cache_sizes.filter_index, false, fReindex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921500928",
      "id" : 921500928,
      "in_reply_to_id" : 920156128,
      "line" : 1589,
      "node_id" : "PRRC_kwDOABII58427P0A",
      "original_commit_id" : "2f8a5307b7065de08df2edaa369739544248387f",
      "original_line" : 1589,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 15,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500928/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921500928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501175"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920222836\r\n\r\n> [88cad3c](https://github.com/bitcoin/bitcoin/commit/88cad3cb604058d8f26790eeb37abe2dabc0c033): Could explain in the commit message that this is only temporary? If not, move it to the kernel folder?\r\n\r\nMoved to kernel folder",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:29:18Z",
      "diff_hunk" : "@@ -878,6 +878,7 @@ libbitcoinkernel_la_SOURCES = \\\n   key.cpp \\\n   logging.cpp \\\n   node/blockstorage.cpp \\\n+  node/chain.cpp \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501175",
      "id" : 921501175,
      "in_reply_to_id" : 920222836,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427P33",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 881,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/Makefile.am",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501175/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501175",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920223420\r\n\r\n> [88cad3c](https://github.com/bitcoin/bitcoin/commit/88cad3cb604058d8f26790eeb37abe2dabc0c033): I wonder where UB should be avoided with asserts and where not\r\n\r\nI think it's reasonable to add Asserts all these places or add a `const uint256& PrevHash()` helper method which asserts, if the Assert is too verbose. Just to be clear, there shouldn't be any UB presently here due to the `block.height > 0` check above. The Assert is just an extra check against possible future UB that could occur if a bug is introduced somewhere else in the code.",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:29:30Z",
      "diff_hunk" : "@@ -209,22 +210,25 @@ size_t BlockFilterIndex::WriteFilterToDisk(FlatFilePos& pos, const BlockFilter&\n     return data_size;\n }\n \n-bool BlockFilterIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n+bool BlockFilterIndex::CustomAppend(const interfaces::BlockInfo& block)\n {\n     CBlockUndo block_undo;\n     uint256 prev_header;\n \n-    if (pindex->nHeight > 0) {\n+    if (block.height > 0) {\n+        // pindex variable gives indexing code access to node internals. It\n+        // will be removed in upcoming commit\n+        const CBlockIndex* pindex = WITH_LOCK(cs_main, return m_chainstate->m_blockman.LookupBlockIndex(block.hash));\n         if (!UndoReadFromDisk(block_undo, pindex)) {\n             return false;\n         }\n \n         std::pair<uint256, DBVal> read_out;\n-        if (!m_db->Read(DBHeightKey(pindex->nHeight - 1), read_out)) {\n+        if (!m_db->Read(DBHeightKey(block.height - 1), read_out)) {\n             return false;\n         }\n \n-        uint256 expected_block_hash = pindex->pprev->GetBlockHash();\n+        uint256 expected_block_hash = *block.prev_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501282",
      "id" : 921501282,
      "in_reply_to_id" : 920223420,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427P5i",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 231,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/index/blockfilterindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501376"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920224709\r\n\r\n> Same\r\n\r\nAdded Assert",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:29:38Z",
      "diff_hunk" : "@@ -110,24 +110,27 @@ CoinStatsIndex::CoinStatsIndex(std::unique_ptr<interfaces::Chain> chain, size_t\n     m_db = std::make_unique<CoinStatsIndex::DB>(path / \"db\", n_cache_size, f_memory, f_wipe);\n }\n \n-bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n+bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n {\n     CBlockUndo block_undo;\n-    const CAmount block_subsidy{GetBlockSubsidy(pindex->nHeight, Params().GetConsensus())};\n+    const CAmount block_subsidy{GetBlockSubsidy(block.height, Params().GetConsensus())};\n     m_total_subsidy += block_subsidy;\n \n     // Ignore genesis block\n-    if (pindex->nHeight > 0) {\n+    if (block.height > 0) {\n+        // pindex variable gives indexing code access to node internals. It\n+        // will be removed in upcoming commit\n+        const CBlockIndex* pindex = WITH_LOCK(cs_main, return m_chainstate->m_blockman.LookupBlockIndex(block.hash));\n         if (!UndoReadFromDisk(block_undo, pindex)) {\n             return false;\n         }\n \n         std::pair<uint256, DBVal> read_out;\n-        if (!m_db->Read(DBHeightKey(pindex->nHeight - 1), read_out)) {\n+        if (!m_db->Read(DBHeightKey(block.height - 1), read_out)) {\n             return false;\n         }\n \n-        uint256 expected_block_hash{pindex->pprev->GetBlockHash()};\n+        uint256 expected_block_hash{*block.prev_hash};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501376",
      "id" : 921501376,
      "in_reply_to_id" : 920224709,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427P7A",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 133,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/index/coinstatsindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501660"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920243749\r\n\r\n> [ddbbdcf](https://github.com/bitcoin/bitcoin/commit/ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3): This changes behavior: Previously there was a call to `error()`, now there is none?\r\n\r\nGood catch. The error print was lost because of a bad rebase. The `m_best_block_index == nullptr` check was added in #24117 after this was written. Fixed now",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:30:03Z",
      "diff_hunk" : "@@ -206,22 +215,19 @@ void BaseIndex::ThreadSync()\n \n bool BaseIndex::Commit()\n {\n-    CDBBatch batch(GetDB());\n-    if (!CommitInternal(batch) || !GetDB().WriteBatch(batch)) {\n-        return error(\"%s: Failed to commit latest %s state\", __func__, GetName());\n-    }\n-    return true;\n-}\n-\n-bool BaseIndex::CommitInternal(CDBBatch& batch)\n-{\n-    LOCK(cs_main);\n     // Don't commit anything if we haven't indexed any block yet\n     // (this could happen if init is interrupted).\n     if (m_best_block_index == nullptr) {\n         return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921501660",
      "id" : 921501660,
      "in_reply_to_id" : 920243749,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427P_c",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 221,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501660/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921501660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921502632"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921502632"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920134694\r\n\r\n> first commit: block and chain.back() are both mutable references to the same memory, so I think this is wrong\r\n> \r\n> Could write `&block.hashPrevBlock` below?\r\n\r\nGood catch. `block.hashPrevBlock` seems simpler anyway",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:31:17Z",
      "diff_hunk" : "@@ -138,8 +138,14 @@ FUZZ_TARGET_INIT(wallet_notifications, initialize_setup)\n                     block.vtx.emplace_back(MakeTransactionRef(tx));\n                 }\n                 // Mine block\n-                a.wallet->blockConnected(block, chain.size());\n-                b.wallet->blockConnected(block, chain.size());\n+                const uint256& hash = block.GetHash();\n+                const uint256& prev_hash = std::get<1>(chain.back()).GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921502632",
      "id" : 921502632,
      "in_reply_to_id" : 920134694,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427QOo",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 142,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/notifications.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921502632/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921502632",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921503131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503131"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920138374\r\n\r\n> Same commit: There is an early return above if the size is `1` or less, thus the size must be `2` or more, thus the check here is not needed. Also, could just remove all of this and write `&block.hashPrevBlock` below?\r\n\r\nGood catch, simplified",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:31:43Z",
      "diff_hunk" : "@@ -155,8 +161,14 @@ FUZZ_TARGET_INIT(wallet_notifications, initialize_setup)\n                 auto& [coins, block]{chain.back()};\n                 if (block.vtx.empty()) return; // Can only disconnect if the block was submitted first\n                 // Disconnect block\n-                a.wallet->blockDisconnected(block, chain.size() - 1);\n-                b.wallet->blockDisconnected(block, chain.size() - 1);\n+                const uint256& hash = block.GetHash();\n+                const uint256& prev_hash = chain.size() >= 2 ? std::get<1>(chain[chain.size() - 2]).GetHash() : uint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921503131",
      "id" : 921503131,
      "in_reply_to_id" : 920138374,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427QWb",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 165,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/notifications.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503131/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921503292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503292"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r917168552\r\n\r\n> nit: I think this line could be made a little easier to parse but since it's in fuzzing it's not so important\r\n\r\nSimplified",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:31:50Z",
      "diff_hunk" : "@@ -155,8 +161,14 @@ FUZZ_TARGET_INIT(wallet_notifications, initialize_setup)\n                 auto& [coins, block]{chain.back()};\n                 if (block.vtx.empty()) return; // Can only disconnect if the block was submitted first\n                 // Disconnect block\n-                a.wallet->blockDisconnected(block, chain.size() - 1);\n-                b.wallet->blockDisconnected(block, chain.size() - 1);\n+                const uint256& hash = block.GetHash();\n+                const uint256& prev_hash = chain.size() >= 2 ? std::get<1>(chain[chain.size() - 2]).GetHash() : uint256();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921503292",
      "id" : 921503292,
      "in_reply_to_id" : 917168552,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427QY8",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 165,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/wallet/test/fuzz/notifications.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503292/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921503603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503603"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920143703\r\n\r\n> First commit: Why are you changing this from `block.data->hashPrevBlock`? If this is intentional, missing an assert to avoid UB?\r\n\r\nI just didn't want to depend on block data unnecessarily here, even it it used below. Maybe the code could be split up or reorganized and it would no longer be necessary. Added asserts here and below, though.",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:32:04Z",
      "diff_hunk" : "@@ -1323,30 +1323,31 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n     }\n }\n \n-void CWallet::blockConnected(const CBlock& block, int height)\n+void CWallet::blockConnected(const interfaces::BlockInfo& block)\n {\n-    const uint256& block_hash = block.GetHash();\n+    assert(block.data);\n     LOCK(cs_wallet);\n \n-    m_last_block_processed_height = height;\n-    m_last_block_processed = block_hash;\n-    for (size_t index = 0; index < block.vtx.size(); index++) {\n-        SyncTransaction(block.vtx[index], TxStateConfirmed{block_hash, height, static_cast<int>(index)});\n-        transactionRemovedFromMempool(block.vtx[index], MemPoolRemovalReason::BLOCK, 0 /* mempool_sequence */);\n+    m_last_block_processed_height = block.height;\n+    m_last_block_processed = block.hash;\n+    for (size_t index = 0; index < block.data->vtx.size(); index++) {\n+        SyncTransaction(block.data->vtx[index], TxStateConfirmed{block.hash, block.height, static_cast<int>(index)});\n+        transactionRemovedFromMempool(block.data->vtx[index], MemPoolRemovalReason::BLOCK, 0 /* mempool_sequence */);\n     }\n }\n \n-void CWallet::blockDisconnected(const CBlock& block, int height)\n+void CWallet::blockDisconnected(const interfaces::BlockInfo& block)\n {\n+    assert(block.data);\n     LOCK(cs_wallet);\n \n     // At block disconnection, this will change an abandoned transaction to\n     // be unconfirmed, whether or not the transaction is added back to the mempool.\n     // User may have to call abandontransaction again. It may be addressed in the\n     // future with a stickier abandoned state or even removing abandontransaction call.\n-    m_last_block_processed_height = height - 1;\n-    m_last_block_processed = block.hashPrevBlock;\n-    for (const CTransactionRef& ptx : block.vtx) {\n+    m_last_block_processed_height = block.height - 1;\n+    m_last_block_processed = *block.prev_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921503603",
      "id" : 921503603,
      "in_reply_to_id" : 920143703,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427Qdz",
      "original_commit_id" : "0a93a16614659a7c12e7e95478a9bb564c1a13cb",
      "original_line" : 1349,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921503603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921518110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921518110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r920223553\r\n\r\n> Same\r\n\r\nAdded Assert",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-14T19:51:22Z",
      "diff_hunk" : "@@ -233,18 +237,18 @@ bool BlockFilterIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex\n         prev_header = read_out.second.header;\n     }\n \n-    BlockFilter filter(m_filter_type, block, block_undo);\n+    BlockFilter filter(m_filter_type, *block.data, block_undo);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921518110",
      "id" : 921518110,
      "in_reply_to_id" : 920223553,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58427UAe",
      "original_commit_id" : "88cad3cb604058d8f26790eeb37abe2dabc0c033",
      "original_line" : 240,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/index/blockfilterindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1039377005,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921518110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-14T23:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921518110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921898495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921898495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is still wrong?\r\n\r\nPreviously the call order was CoinStatsIndex::CustomCommit , then BaseIndex::CommitInternal (which may be skipped).\r\n\r\nNow, everything is skipped?",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-15T07:39:14Z",
      "diff_hunk" : "@@ -206,22 +215,20 @@ void BaseIndex::ThreadSync()\n \n bool BaseIndex::Commit()\n {\n-    CDBBatch batch(GetDB());\n-    if (!CommitInternal(batch) || !GetDB().WriteBatch(batch)) {\n-        return error(\"%s: Failed to commit latest %s state\", __func__, GetName());\n-    }\n-    return true;\n-}\n-\n-bool BaseIndex::CommitInternal(CDBBatch& batch)\n-{\n-    LOCK(cs_main);\n     // Don't commit anything if we haven't indexed any block yet\n     // (this could happen if init is interrupted).\n-    if (m_best_block_index == nullptr) {\n-        return false;\n+    bool ok = m_best_block_index != nullptr;\n+    if (ok) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921898495",
      "id" : 921898495,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII58428w3_",
      "original_commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "original_line" : 221,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 35,
      "pull_request_review_id" : 1039916505,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921898495/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-15T07:39:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921898495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921899155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921899155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/4504627910541312?logs=ci#L6998",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-15T07:40:05Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921899155",
      "id" : 921899155,
      "in_reply_to_id" : 920806328,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58428xCT",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 1039917440,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921899155/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-15T07:40:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921899155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921900387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921900387"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like an iwyu bug, so maybe undo for now?",
      "commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "created_at" : "2022-07-15T07:41:40Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921900387",
      "id" : 921900387,
      "in_reply_to_id" : 920806328,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58428xVj",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 1039919099,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921900387/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-15T07:41:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921900387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r922095827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922095827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921898495\r\n\r\nIn commit \"indexes, refactor: Remove CChainState use in index CommitInternal method\" (f678151ff9a0a5934965b1c85ec97a1dfe45a67e)\r\n\r\n> This is still wrong?\r\n> \r\n> Previously the call order was CoinStatsIndex::CustomCommit , then BaseIndex::CommitInternal (which may be skipped).\r\n> \r\n> Now, everything is skipped?\r\n\r\nYou are referring to the `m_best_block_index == nullptr` case? If so then yes the whole commit is skipped now when previously only half of the commit was skipped (custom part was not skipped, base part was skipped).\r\n\r\nI didn't notice yesterday that only the base half of the commit was skipped, but it's definitely better to skip the whole commit. This `m_block_index == nullptr` case was only added very recently in https://github.com/bitcoin/bitcoin/pull/24117/commits/0243907faee0aa6af09974131d9a46a7f9c3ef38 as part of an attempt to avoid index corruption if state was flushed during startup that would happen because `GetLocator` can return null on startup. It was an imperfect attempt and according to comments in https://github.com/bitcoin/bitcoin/pull/24117#issuecomment-1155529925, corruption continued to happen after that PR. It's possible this commit might inadvertently fix this by skipping the whole commit instead of half of it, but it's not clear. In any case, it should be better behavior and it makes more sense to skip the whole commit.",
      "commit_id" : "8bc1602821202d4863fab05ee1aab3ff3b70a7c0",
      "created_at" : "2022-07-15T11:55:34Z",
      "diff_hunk" : "@@ -206,22 +215,20 @@ void BaseIndex::ThreadSync()\n \n bool BaseIndex::Commit()\n {\n-    CDBBatch batch(GetDB());\n-    if (!CommitInternal(batch) || !GetDB().WriteBatch(batch)) {\n-        return error(\"%s: Failed to commit latest %s state\", __func__, GetName());\n-    }\n-    return true;\n-}\n-\n-bool BaseIndex::CommitInternal(CDBBatch& batch)\n-{\n-    LOCK(cs_main);\n     // Don't commit anything if we haven't indexed any block yet\n     // (this could happen if init is interrupted).\n-    if (m_best_block_index == nullptr) {\n-        return false;\n+    bool ok = m_best_block_index != nullptr;\n+    if (ok) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r922095827",
      "id" : 922095827,
      "in_reply_to_id" : 921898495,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII58429hDT",
      "original_commit_id" : "f678151ff9a0a5934965b1c85ec97a1dfe45a67e",
      "original_line" : 221,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 73,
      "pull_request_review_id" : 1040194096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922095827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-15T12:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922095827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r922113738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922113738"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/25494#discussion_r921900387\r\n\r\n> https://cirrus-ci.com/task/4504627910541312?logs=ci#L6998\r\n\r\n> Looks like an iwyu bug, so maybe undo for now?\r\n\r\nI'm not actually sure what the bug is but I added some missing includes and undid change that adds the file to IWYU for now. The larger PR https://github.com/bitcoin/bitcoin/pull/24230 this was part of adds more to this file so there is a chance to enable IWYU again later\r\n\r\n\r\n",
      "commit_id" : "8bc1602821202d4863fab05ee1aab3ff3b70a7c0",
      "created_at" : "2022-07-15T12:22:11Z",
      "diff_hunk" : "@@ -0,0 +1,23 @@\n+// Copyright (c) 2022 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25494#discussion_r922113738",
      "id" : 922113738,
      "in_reply_to_id" : 920806328,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58429lbK",
      "original_commit_id" : "ddbbdcf4112c3a84e3287e6bf701e0eb592b24c3",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/node/chain.cpp",
      "position" : null,
      "pull_request_review_id" : 1040220430,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25494",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922113738/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-15T12:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/922113738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
