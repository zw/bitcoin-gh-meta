[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "forgot to add that this is with the latest master commit 4cfe17c3382ba750131cdc8703b2978132822070",
      "created_at" : "2018-05-17T12:10:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-389844721",
      "id" : 389844721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-17T12:10:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389844721",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6440430?v=4",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Does this happen with `./src/test/test_bitcoin -t validation_block_tests/processnewblock_signals_ordering` as well? In this case you could run through valgrind or gdb",
      "created_at" : "2018-05-18T11:52:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390183451",
      "id" : 390183451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-18T11:53:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390183451",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke yes, it does happen with that command.\r\n\r\n1st run: it hung for a couple of minutes and then i gave it ctrl+c\r\n\r\n```\r\n> ./src/test/test_bitcoin -t validation_block_tests/processnewblock_signals_ordering\r\nRunning 1 test case...\r\ntest_bitcoin: malloc.c:3079: __libc_malloc: Assertion `!victim || chunk_is_mmapped (mem2chunk (victim)) || ar_ptr == arena_for_chunk (mem2chunk (victim))' failed.\r\n*** stack smashing detected ***: <unknown> terminated\r\nunknown location(0): fatal error: in \"validation_block_tests/processnewblock_signals_ordering\": memory access violation at address: 0x0000148a: no mapping at fault address\r\ntest/validation_block_tests.cpp(137): last checkpoint\r\n^C\r\n```\r\n\r\n2nd run: it aborted very quickly\r\n\r\n```\r\n> ./src/test/test_bitcoin -t validation_block_tests/processnewblock_signals_ordering\r\nRunning 1 test case...\r\nunknown location(0): fatal error: in \"validation_block_tests/processnewblock_signals_ordering\": signal: generated by kill() (or family); uid=0; pid=0\r\ntest/validation_block_tests.cpp(137): last checkpoint\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Test Suite\"\r\ntest_bitcoin: /usr/include/boost/thread/pthread/condition_variable_fwd.hpp:116: boost::condition_variable::~condition_variable(): Assertion `!ret' failed.\r\nAborted (core dumped)\r\n```\r\n\r\nthen i ran valgrind and got the attached log file\r\n[valgrind.txt](https://github.com/bitcoin/bitcoin/files/2017073/valgrind.txt)\r\n:\r\n```\r\nvalgrind --suppressions=contrib/valgrind.supp --leak-check=full --show-leak-kinds=all ./src/test/test_bitcoin -t validation_block_tests/processnewblock_signals_ordering > ../valgrind.txt 2>&1\r\nSegmentation fault (core dumped)\r\n```",
      "created_at" : "2018-05-18T13:34:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390208706",
      "id" : 390208706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-18T13:34:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390208706",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6440430?v=4",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Downgrading from `libboost1.65-dev:amd64` to `libboost1.62-dev:amd64` does NOT fix this.\r\nUpgrading to `boost_1_67_0` built from source does NOT fix this either.",
      "created_at" : "2018-05-21T10:12:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390612769",
      "id" : 390612769,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-21T10:12:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390612769",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6440430?v=4",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I couldn't reproduce and I doubt it has something to do with boost. You might want to fiddle around with the code in the lambda or test case: https://github.com/bitcoin/bitcoin/blob/11e7bdfd903ef342c0ff2dcd062d6eab8dd25350/src/test/validation_block_tests.cpp#L160 (E.g. replace `[]` with `.at()`, as a first try) Not sure what to look out for, since I don't see how this test failure could happen.",
      "created_at" : "2018-05-21T13:58:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390661509",
      "id" : 390661509,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-21T13:58:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390661509",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I did some narrowing down by commenting lines out and running: `./src/test/test_bitcoin -t validation_block_tests/processnewblock_signals_ordering`\r\n\r\nWhen I comment only this one line, the errors stop:\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L3508\r\n\r\nSomething about that `AssertLockNotHeld`.",
      "created_at" : "2018-05-21T18:07:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390735246",
      "id" : 390735246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-21T18:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390735246",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6440430?v=4",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke I think the enable-debug configure flag might be involved with the cause. When I configured without it, I did not get the failure. Can you try this and see if you can reproduce?:\r\n```\r\nmake clean\r\n./autogen.sh\r\n./configure --enable-debug\r\nmake check     (or use \"make -j 4 check\", if you want to save time)\r\n```",
      "created_at" : "2018-05-21T18:40:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390744428",
      "id" : 390744428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-21T18:40:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390744428",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6440430?v=4",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Interesting. This does not happen when compiled from `depends`, which also explains that travis didn't hit this issue.",
      "created_at" : "2018-05-21T22:47:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390805645",
      "id" : 390805645,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-21T22:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390805645",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was able to reproduce this issue both under 4cfe17c and current master tip.\r\n\r\nI don't have the time to look further into it right now but, running under gdb, it segfaults when reaching [sync.cpp:165](https://github.com/bitcoin/bitcoin/blob/master/src/sync.cpp#L165) on a new thread (e.g. 5). Setting a break on this line, right before the crash, `lockstack` is:\r\n```\r\n>>> p lockstack\r\n$2 = std::unique_ptr<std::vector<std::pair<void*, CLockLocation>, std::allocator<std::pair<void*, CLockLocation> > >> containing 0x0\r\n```\r\nand then, surely, it crashes on next step.",
      "created_at" : "2018-05-21T22:58:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-390807788",
      "id" : 390807788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-21T23:01:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/390807788",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/5016303?v=4",
         "events_url" : "https://api.github.com/users/marcoagner/events{/privacy}",
         "followers_url" : "https://api.github.com/users/marcoagner/followers",
         "following_url" : "https://api.github.com/users/marcoagner/following{/other_user}",
         "gists_url" : "https://api.github.com/users/marcoagner/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/marcoagner",
         "id" : 5016303,
         "login" : "marcoagner",
         "organizations_url" : "https://api.github.com/users/marcoagner/orgs",
         "received_events_url" : "https://api.github.com/users/marcoagner/received_events",
         "repos_url" : "https://api.github.com/users/marcoagner/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/marcoagner/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/marcoagner/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/marcoagner"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke, are you able to reproduce this issue?\r\n\r\nIt seems like stack-protector kicks in for @mruddy (`*** stack smashing detected ***`) when running the `processnewblock_signals_ordering` test, but shouldn't it kick in for all of us? What special steps needs to be taken to reproduce reliably? :-)",
      "created_at" : "2018-05-22T21:55:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-391153614",
      "id" : 391153614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-22T21:55:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391153614",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@practicalswift The code is only compiled, when running with --enable-debug or the DEBUG_LOCKORDER switch turned on. As mentioned above, I couldn't reproduce when building from `depends`.\r\n\r\nYou can then reproduce by running that test case or a test case which doesn't take any locks, but calls `AssertLock(Not)Held`",
      "created_at" : "2018-05-22T22:03:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/13263#issuecomment-391155418",
      "id" : 391155418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/13263",
      "updated_at" : "2018-05-22T22:03:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/391155418",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
