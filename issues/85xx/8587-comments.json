[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8587#discussion_r76197094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8587"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76197094"
         }
      },
      "body" : "The idea here is that it will be banned if it continues to connect and request bloom services 20 times... I suspect the misbehave count gets reset upon disconnection though..!",
      "commit_id" : "bfc282c295489b7c15f4cf6e2eb18dee05cd00fa",
      "created_at" : "2016-08-25T08:01:45Z",
      "diff_hunk" : "@@ -4885,19 +4885,14 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n     }\n \n \n-    if (!(nLocalServices & NODE_BLOOM) &&\n+    if (!pfrom->fWhiteListed && !(nLocalServices & NODE_BLOOM) &&\n               (strCommand == NetMsgType::FILTERLOAD ||\n                strCommand == NetMsgType::FILTERADD ||\n-               strCommand == NetMsgType::FILTERCLEAR))\n-    {\n-        if (pfrom->nVersion >= NO_BLOOM_VERSION) {\n-            LOCK(cs_main);\n-            Misbehaving(pfrom->GetId(), 100);\n-            return false;\n-        } else {\n-            pfrom->fDisconnect = true;\n-            return false;\n-        }\n+               strCommand == NetMsgType::FILTERCLEAR)) {\n+        LOCK(cs_main);\n+        Misbehaving(pfrom->GetId(), 5);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#discussion_r76197094",
      "id" : 76197094,
      "original_commit_id" : "6ab8fd4facf3be92be960b6de6984daf3e0662c9",
      "original_position" : 20,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8587",
      "updated_at" : "2016-09-13T02:38:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76197094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "NACK on overloading whitelisting even further. It's already not well-defined nor documented.\r\n",
      "created_at" : "2016-08-25T08:13:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-242312308",
      "id" : 242312308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8587",
      "updated_at" : "2016-08-25T08:20:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242312308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Have you tried compiling this locally?",
      "created_at" : "2016-08-25T08:46:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-242319614",
      "id" : 242319614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8587",
      "updated_at" : "2016-08-25T08:46:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242319614",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "NACK\r\n\r\nI doesn't even compile! It is `fWhitelisted` and not `fWhiteListed`.",
      "created_at" : "2016-08-25T12:07:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-242363006",
      "id" : 242363006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8587",
      "updated_at" : "2016-08-25T12:07:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242363006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@laanwj Where would be the best place to document this please? I would certainly be willing to give this a go. My thinking is that whitelisted peers are nodes that we trust to not do anything detrimental or misbehave. They are usually nodes we have control of. Therefore, in this example, we could set up a node that doesn't advertise BLOOM and doesn't provide bloom services to nodes other than our own. This would allow us to configure a SPV node to use our node but not let it be used by other SPV nodes.  Many SPV nodes, allow it to be configured which full-node to use and trust, but currently there isn't a way to set up a full-node that only provides SPV services to specific nodes (as far as I know anyway), hence this pull request.\r\n\r\nI agree that \"Whitelisted\" is somewhat vague and generic though but it seemed the closest to what was already apt for the job - and it might still be so, but yes, the documentation would be useful. \r\n\r\nChecking through previous commits, e.g. beceac9bbf14bf4a81f6f63b9cca2a64157054ae (#8078), it does look like Whitelisting feature is already being used to provide BLOOM services to whitelisted nodes and no other nodes, so I don't think this pull req deviates from the current use so far.\r\n\r\nRegarding who is most qualified to document what Whitelisting is, I would propose that it is the authors who have used it so far, so this would be @petertodd (#8078) @morcos (#7542) @sipa (#7125 #5157 #4378) @gmaxwell (#7166) @pstratem (#7406 #6374) @jonasschnelli (#6984) @laanwj (#6974) @sdaftuar (#5875) @rubensayshi (#5942)  - this is an exhaustive list.",
      "created_at" : "2016-08-26T03:35:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-242620495",
      "id" : 242620495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8587",
      "updated_at" : "2016-09-11T08:11:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242620495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nshee-aht man, Broadley, you should have known the answers to our\nquestions before you asked. Do you think Wladimir has time for this?\nProbably he does, in his helpful way, but you should be more\nconsiderate about ongoing issues. Did you read (and understand) my\nprevious message about verack that bothered you so?\n\nOn 08/26/2016 10:35 AM, R E Broadley wrote:\n> @laanwj <https://github.com/laanwj> Very good point here! Where\n> would be the best place to document this please? I would certainly\n> be willing to give this a go. My thinking is that whitelisted peers\n> are nodes that we trust to not do anything detrimental or\n> misbehave. They are usually nodes we have control of. Therefore, in\n> this example, we could set up a node that doesn't advertise BLOOM\n> and doesn't provide bloom services to nodes other than our own.\n> This would allow us to configure a SPV node to use our node but not\n> let it be used by other SPV nodes. Many SPV nodes, allow it to be\n> configured which full-node to use and trust, but currently there\n> isn't a way to set up a full-node that only provides SPV services\n> to specific nodes (as far as I know anyway), hence this pull \n> request.\n> \n> I agree that \"Whitelisted\" is somewhat vague and generic though but\n> it seemed the closest to what was already apt for the job - and it\n> might still be so, but yes, the documentation would be useful.\n> \n> Checking through previous commits, e.g. beceac9 \n> <https://github.com/bitcoin/bitcoin/commit/beceac9bbf14bf4a81f6f63b9cc\na2a64157054ae>,\n>\n> \nit does look like Whitelisting feature is already being used to provide\n> BLOOM services to nodes and no other nodes, so I don't think this\n> pull req deviates from the current use so far.\n> \n> Ã¢ÂÂ You are receiving this because you are subscribed to this\n> thread. Reply to this email directly, view it on GitHub \n> <https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-242620495>,\n>\n> \nor mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AGmH2AeSm2Smotbel6D\naZyNPjdUV5escks5qjl8TgaJpZM4Jsy0W>.\n>\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2.0.22 (GNU/Linux)\n\niQEcBAEBAgAGBQJXwJj6AAoJEGwAhlQc8H1mRyQH/RouTqbUOGoKEi59UW9CLRNj\nYbALHqP2FsT8TbCataP+9sMpLsvKGFLnCrj7GnIfY3Jcstp/l9fP+veEqCcp1Hp5\nSH7sgbT9Grg5ug7IVUzJZZPjYqrGXSEu2shfRRaDooIzAB3Z62IrM15PREXPVZwu\n0OFnfW+mh8oeXcMfDtI+DraEmWudt60vG8suk65RVdky+YGmv32n5s8w4VGSScIX\non/EZi5+ThKZhXGxvzuWFlvCYbwq99/oT/KHBoF86uDGSXflNiCDPqD4VnOEdEVZ\nvpAWu3YJTmLD4xw01vnW9VadtamzuC+QaUodtHTUtYuSARVgEHpxzb9QYBLIERU=\n=fRHm\n-----END PGP SIGNATURE-----\n",
      "created_at" : "2016-08-26T19:31:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-242829929",
      "id" : 242829929,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8587",
      "updated_at" : "2016-08-26T19:31:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242829929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6916056?v=3",
         "events_url" : "https://api.github.com/users/venzen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/venzen/followers",
         "following_url" : "https://api.github.com/users/venzen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/venzen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/venzen",
         "id" : 6916056,
         "login" : "venzen",
         "organizations_url" : "https://api.github.com/users/venzen/orgs",
         "received_events_url" : "https://api.github.com/users/venzen/received_events",
         "repos_url" : "https://api.github.com/users/venzen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/venzen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/venzen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/venzen"
      }
   },
   {
      "body" : "@venzen your message above seemed to get mangled somehow - not sure if I read your message about VERACK - will check the pull request now.",
      "created_at" : "2016-09-13T02:40:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8587#issuecomment-246556856",
      "id" : 246556856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8587",
      "updated_at" : "2016-09-13T02:40:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246556856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
