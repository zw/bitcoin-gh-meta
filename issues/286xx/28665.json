{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nI got a `std::out_of_range` crash during merging fuzz outputs in the `i2p` target (see log below.) I was not able to reproduce the crash when re-running the seed with the fuzz executable in the regular build, but I figured Iâd share it here if someone else wants to take a look. The binaries used for the merge and the reproduction were both built from the latest master: `738ef44abb6895dad016d8f32f7d7fa1c251b354`.\n\n### Expected behaviour\n\nIf this issue can be reproduced, it may point at a bug in the I2P fuzzer or the I2P code.\n\n### Steps to reproduce\n\nYou can recreate the seed with:\r\n\r\n`echo \"wIA9ID0gUkVTVUxUPU9LClBSSVY9gD0gPSBSRVNVTFQ9T0sKUFJJVj0CAAD//13/GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoAEBoaGhoaGhoaGhoaGhouGhoaGhoaGhoaGhoaGn4aGhoaGhoaGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaABoaGhoaGhpXGhoAGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGurq6mrqUFBQUFBQUFBQUFBQUOrq6gAAAABbAAAAAAAAAAAAAAAAAAAAAgAAeHh4eHh4eHgpeHh4eHh4eHh4eHgaGhoaGhoaGhoaGho=\" | base64 -d crash-946784c8f03d9aeeef70e22b346a069e6940e186`\r\n\n\n### Relevant log output\n\n\r\n```\r\nRun i2p with args /home/murch/Workspace/qa-merge/src/test/fuzz/fuzz -set_cover_merge=1 -shuffle=0 -prefer_small=1 -use_value_profile=0 /tmp/merge-all/i2p ../qa-assets/fuzz_seed_corpus/i2p ../qa-assets-active-fuzzing/fuzz_seed_corpus/i2p\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 2619897554\r\nINFO: Loaded 1 modules   (380311 inline 8-bit counters): 380311 [0x55a029467ca0, 0x55a0294c4a37), \r\nINFO: Loaded 1 PC tables (380311 PCs): 380311 [0x55a0294c4a38,0x55a029a923a8), \r\nMERGE-OUTER: 14141 files, 0 in the initial corpus, 0 processed earlier\r\nMERGE-OUTER: attempt 1\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 3047975919\r\nINFO: Loaded 1 modules   (380311 inline 8-bit counters): 380311 [0x563efb209ca0, 0x563efb266a37), \r\nINFO: Loaded 1 PC tables (380311 PCs): 380311 [0x563efb266a38,0x563efb8343a8), \r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 1048576 bytes\r\nMERGE-INNER: using the control file '/tmp/libFuzzerTemp.Merge17284.txt'\r\nMERGE-INNER: 14141 total files; 0 processed earlier; will process 14141 files now\r\n#1\tpulse  cov: 244 exec/s: 0 rss: 88Mb\r\n#2\tpulse  cov: 245 exec/s: 0 rss: 88Mb\r\n#4\tpulse  cov: 245 exec/s: 0 rss: 88Mb\r\n#8\tpulse  cov: 245 exec/s: 0 rss: 88Mb\r\n#16\tpulse  cov: 263 exec/s: 0 rss: 88Mb\r\n#32\tpulse  cov: 300 exec/s: 0 rss: 88Mb\r\n#64\tpulse  cov: 313 exec/s: 0 rss: 88Mb\r\n#128\tpulse  cov: 336 exec/s: 0 rss: 88Mb\r\n#256\tpulse  cov: 417 exec/s: 0 rss: 88Mb\r\n#512\tpulse  cov: 435 exec/s: 0 rss: 88Mb\r\n#1024\tpulse  cov: 455 exec/s: 1024 rss: 88Mb\r\n#2048\tpulse  cov: 485 exec/s: 1024 rss: 88Mb\r\n#4096\tpulse  cov: 538 exec/s: 682 rss: 88Mb\r\nterminate called after throwing an instance of 'std::out_of_range'\r\n  what():  vector::_M_range_check: __n (which is 385) >= this->size() (which is 0)\r\n==17287== ERROR: libFuzzer: deadly signal\r\n    #0 0x563ef9f7eda4 in __sanitizer_print_stack_trace (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x9bfda4) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #1 0x563ef9f56248 in fuzzer::PrintStackTrace() (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x997248) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #2 0x563ef9f3c2d3 in fuzzer::Fuzzer::CrashCallback() (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x97d2d3) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #3 0x7fa19a83c45f  (/lib/x86_64-linux-gnu/libc.so.6+0x3c45f) (BuildId: ff2d8e707625b73b293961a4bc168e373d14a44a)\r\n    #4 0x7fa19a89152a in __pthread_kill_implementation nptl/pthread_kill.c:43:17\r\n    #5 0x7fa19a89152a in __pthread_kill_internal nptl/pthread_kill.c:78:10\r\n    #6 0x7fa19a89152a in pthread_kill nptl/pthread_kill.c:89:10\r\n    #7 0x7fa19a83c3b5 in raise signal/../sysdeps/posix/raise.c:26:13\r\n    #8 0x7fa19a82287b in abort stdlib/abort.c:79:7\r\n    #9 0x7fa19aca4ee5  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xa4ee5) (BuildId: 1fcdadafe5a79e1031ab0da645aa3798954cf53d)\r\n    #10 0x7fa19acb6e9b  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xb6e9b) (BuildId: 1fcdadafe5a79e1031ab0da645aa3798954cf53d)\r\n    #11 0x7fa19acb6f06 in std::terminate() (/lib/x86_64-linux-gnu/libstdc++.so.6+0xb6f06) (BuildId: 1fcdadafe5a79e1031ab0da645aa3798954cf53d)\r\n    #12 0x7fa19acb7167 in __cxa_throw (/lib/x86_64-linux-gnu/libstdc++.so.6+0xb7167) (BuildId: 1fcdadafe5a79e1031ab0da645aa3798954cf53d)\r\n    #13 0x7fa19aca82ba  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xa82ba) (BuildId: 1fcdadafe5a79e1031ab0da645aa3798954cf53d)\r\n    #14 0x563efa269705 in std::vector<unsigned char, std::allocator<unsigned char>>::_M_range_check(unsigned long) const /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/stl_vector.h:1153:4\r\n    #15 0x563efa269705 in std::vector<unsigned char, std::allocator<unsigned char>>::at(unsigned long) const /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/stl_vector.h:1194:2\r\n    #16 0x563efa269705 in i2p::sam::Session::MyDestination() const src/i2p.cpp:354:38\r\n    #17 0x563efa269705 in i2p::sam::Session::CreateIfNotCreatedAlready() src/i2p.cpp:405:40\r\n    #18 0x563efa268664 in i2p::sam::Session::Listen(i2p::Connection&) src/i2p.cpp:143:9\r\n    #19 0x563efa07c088 in i2p_fuzz_target(Span<unsigned char const>) src/test/fuzz/i2p.cpp:38:14\r\n    #20 0x563ef9f8269e in void std::__invoke_impl<void, void (*&)(Span<unsigned char const>), Span<unsigned char const>>(std::__invoke_other, void (*&)(Span<unsigned char const>), Span<unsigned char const>&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/invoke.h:61:14\r\n    #21 0x563ef9f8269e in std::enable_if<is_invocable_r_v<void, void (*&)(Span<unsigned char const>), Span<unsigned char const>>, void>::type std::__invoke_r<void, void (*&)(Span<unsigned char const>), Span<unsigned char const>>(void (*&)(Span<unsigned char const>), Span<unsigned char const>&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/invoke.h:111:2\r\n    #22 0x563ef9f8269e in std::_Function_handler<void (Span<unsigned char const>), void (*)(Span<unsigned char const>)>::_M_invoke(std::_Any_data const&, Span<unsigned char const>&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_function.h:290:9\r\n    #23 0x563efa1dd075 in std::function<void (Span<unsigned char const>)>::operator()(Span<unsigned char const>) const /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_function.h:591:9\r\n    #24 0x563efa1dd075 in LLVMFuzzerTestOneInput src/test/fuzz/fuzz.cpp:178:5\r\n    #25 0x563ef9f3d742 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x97e742) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #26 0x563ef9f47445 in fuzzer::Fuzzer::CrashResistantMergeInternalStep(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>> const&, bool) (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x988445) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #27 0x563ef9f2d5cd in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x96e5cd) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #28 0x563ef9f56a82 in main (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x997a82) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n    #29 0x7fa19a823a8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16\r\n    #30 0x7fa19a823b48 in __libc_start_main csu/../csu/libc-start.c:360:3\r\n    #31 0x563ef9f22074 in _start (/home/murch/Workspace/qa-merge/src/test/fuzz/fuzz+0x963074) (BuildId: 1f28ec48de7ec8f793559abd4fba645f972afe4f)\r\n\r\nNOTE: libFuzzer has rudimentary signal handlers.\r\n      Combine libFuzzer with AddressSanitizer or similar for better crash reports.\r\nSUMMARY: libFuzzer: deadly signal\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\nartifact_prefix='./'; Test unit written to ./crash-946784c8f03d9aeeef70e22b346a069e6940e186\r\n```\r\n\r\n```\r\nâ  qa-merge git:(merge-fuzz) â FUZZ=i2p src/test/fuzz/fuzz   crash-946784c8f03d9aeeef70e22b346a069e6940e186\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 3335468885\r\nINFO: Loaded 1 modules   (380311 inline 8-bit counters): 380311 [0x5612fee10ca0, 0x5612fee6da37), \r\nINFO: Loaded 1 PC tables (380311 PCs): 380311 [0x5612fee6da38,0x5612ff43b3a8), \r\nsrc/test/fuzz/fuzz: Running 1 inputs 1 time(s) each.\r\nRunning: crash-946784c8f03d9aeeef70e22b346a069e6940e186\r\nExecuted crash-946784c8f03d9aeeef70e22b346a069e6940e186 in 0 ms\r\n***\r\n*** NOTE: fuzzing was not performed, you have only\r\n***       executed the target code on a fixed set of inputs.\r\n***\r\n```\r\n\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\n738ef44abb6895dad016d8f32f7d7fa1c251b354\n\n### Operating system and version\n\nUbuntu 23.04\n\n### Machine specifications\n\n_No response_",
   "closed_at" : "2023-10-20T14:30:24Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
      "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
      "followers_url" : "https://api.github.com/users/fanquake/followers",
      "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/fanquake",
      "id" : 863730,
      "login" : "fanquake",
      "node_id" : "MDQ6VXNlcjg2MzczMA==",
      "organizations_url" : "https://api.github.com/users/fanquake/orgs",
      "received_events_url" : "https://api.github.com/users/fanquake/received_events",
      "repos_url" : "https://api.github.com/users/fanquake/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/fanquake"
   },
   "comments" : 11,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28665/comments",
   "created_at" : "2023-10-17T13:46:16Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28665/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/28665",
   "id" : 1947477870,
   "labels" : [
      {
         "color" : "FBBAAB",
         "default" : false,
         "description" : null,
         "id" : 64585,
         "name" : "Bug",
         "node_id" : "MDU6TGFiZWw2NDU4NQ==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28665/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 94,
      "created_at" : "2023-04-15T11:36:05Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      },
      "description" : "",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/60",
      "id" : 9286970,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/60/labels",
      "node_id" : "MI_kwDOABII584AjbU6",
      "number" : 60,
      "open_issues" : 10,
      "state" : "open",
      "title" : "26.0",
      "updated_at" : "2023-10-20T14:30:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/60"
   },
   "node_id" : "I_kwDOABII5850FCdu",
   "number" : 28665,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28665/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28665/timeline",
   "title" : "'std::out_of_range' crash in I2P fuzz test",
   "updated_at" : "2023-10-20T14:30:24Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28665",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
      "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
      "followers_url" : "https://api.github.com/users/murchandamus/followers",
      "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
      "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/murchandamus",
      "id" : 4060799,
      "login" : "murchandamus",
      "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
      "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
      "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
      "repos_url" : "https://api.github.com/users/murchandamus/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/murchandamus"
   }
}
