[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15614](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15614.html) (gui: Defer removeAndDeleteWallet when no modal widget is active by promag)\n* [#15450](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15450.html) ([GUI] Create wallet menu option by achow101)\n* [#15204](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15204.html) (gui: Add Open External Wallet action by promag)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-02-25T23:00:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15478#issuecomment-467219529",
      "id" : 467219529,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15478",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2NzIxOTUyOQ==",
      "updated_at" : "2019-03-22T00:18:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/467219529",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15478#discussion_r260180224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15478"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260180224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`called` here shadows `called` in outer scope.",
      "commit_id" : "4e706a0b016dbf7739d45f816072633d78591960",
      "created_at" : "2019-02-26T08:50:19Z",
      "diff_hunk" : "@@ -137,22 +135,82 @@ void WalletController::removeAndDeleteWallet(WalletModel* wallet_model)\n }\n \n \n-OpenWalletActivity::OpenWalletActivity(WalletController* wallet_controller, const std::string& name)\n-    : m_wallet_controller(wallet_controller)\n-    , m_name(name)\n-{}\n+OpenWalletActivity::OpenWalletActivity(QWidget* parent)\n+    : QObject(parent)\n+    , m_parent(parent)\n+{\n+}\n+\n+void OpenWalletActivity::setPath(const std::string& path)\n+{\n+    m_path = path;\n+}\n+\n+void OpenWalletActivity::setWalletController(WalletController* wallet_controller)\n+{\n+    m_wallet_controller = wallet_controller;\n+}\n+\n+void OpenWalletActivity::showMessage(const QMessageBox::Icon& icon, const QString& text)\n+{\n+    QMessageBox box(m_parent);\n+    box.setIcon(icon);\n+    box.setText(tr(\"Open Wallet Failed\"));\n+    box.setInformativeText(text);\n+    box.setStandardButtons(QMessageBox::Ok);\n+    box.setDefaultButton(QMessageBox::Ok);\n+    box.exec();\n+}\n+\n+void OpenWalletActivity::showProgress()\n+{\n+    assert(!m_progress_dialog);\n+    QString name = m_path.empty() ? QString(\"[\"+tr(\"default wallet\")+\"]\") : QString::fromStdString(m_path);\n+    m_progress_dialog = new QProgressDialog(m_parent);\n+    GUIUtil::PolishProgressDialog(m_progress_dialog);\n+    m_progress_dialog->setLabelText(tr(\"Opening Wallet <b>%1</b>...\").arg(name.toHtmlEscaped()));\n+    m_progress_dialog->setRange(0, 0);\n+    m_progress_dialog->setCancelButton(nullptr);\n+    m_progress_dialog->setWindowModality(Qt::ApplicationModal);\n+    m_progress_dialog->show();\n+}\n+\n+void OpenWalletActivity::hideProgress()\n+{\n+    assert(m_progress_dialog);\n+    delete m_progress_dialog;\n+    m_progress_dialog = nullptr;\n+}\n \n void OpenWalletActivity::open()\n {\n-    std::string error, warning;\n-    std::unique_ptr<interfaces::Wallet> wallet = m_wallet_controller->m_node.loadWallet(m_name, error, warning);\n-    if (!warning.empty()) {\n-        Q_EMIT message(QMessageBox::Warning, QString::fromStdString(warning));\n-    }\n-    if (wallet) {\n-        Q_EMIT opened(m_wallet_controller->getOrCreateWallet(std::move(wallet)));\n-    } else {\n-        Q_EMIT message(QMessageBox::Critical, QString::fromStdString(error));\n-    }\n-    Q_EMIT finished();\n+    assert(m_wallet_controller);\n+\n+    QTimer::singleShot(0, m_wallet_controller->m_activity_worker, [this]() {\n+        bool called = QMetaObject::invokeMethod(this, \"showProgress\", Qt::BlockingQueuedConnection);\n+        assert(called);\n+\n+        std::string error, warning;\n+        std::unique_ptr<interfaces::Wallet> wallet = m_wallet_controller->m_node.loadWallet(m_path, error, warning);\n+\n+        called = QMetaObject::invokeMethod(this, \"hideProgress\", Qt::BlockingQueuedConnection);\n+        assert(called);\n+\n+        if (!warning.empty()) {\n+            bool called = QMetaObject::invokeMethod(this, \"showMessage\", Qt::BlockingQueuedConnection,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15478#discussion_r260180224",
      "id" : 260180224,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDE4MDIyNA==",
      "original_commit_id" : "509f8fb795055a4c6f33fe28cc82af0ed3f78703",
      "original_position" : 138,
      "path" : "src/qt/walletcontroller.cpp",
      "position" : 137,
      "pull_request_review_id" : 207825545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15478",
      "updated_at" : "2019-03-17T23:39:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260180224",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15478#discussion_r260180768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15478"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260180768"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be `explicit` :-)\r\n\r\nPlease help review #14505 to enable automatic non-human `explicit` checking :-)",
      "commit_id" : "4e706a0b016dbf7739d45f816072633d78591960",
      "created_at" : "2019-02-26T08:51:50Z",
      "diff_hunk" : "@@ -72,19 +73,28 @@ class OpenWalletActivity : public QObject\n     Q_OBJECT\n \n public:\n-    OpenWalletActivity(WalletController* wallet_controller, const std::string& name);\n+    OpenWalletActivity(QWidget* parent = nullptr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15478#discussion_r260180768",
      "id" : 260180768,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MDE4MDc2OA==",
      "original_commit_id" : "509f8fb795055a4c6f33fe28cc82af0ed3f78703",
      "original_position" : 31,
      "path" : "src/qt/walletcontroller.h",
      "position" : 31,
      "pull_request_review_id" : 207826194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15478",
      "updated_at" : "2019-03-17T23:39:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/260180768",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, needs rebase.",
      "created_at" : "2019-03-15T06:23:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15478#issuecomment-473172864",
      "id" : 473172864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15478",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ3MzE3Mjg2NA==",
      "updated_at" : "2019-03-15T06:23:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/473172864",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
