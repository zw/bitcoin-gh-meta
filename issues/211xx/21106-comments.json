[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r571946307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571946307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This assumes that `GetTime()` is monotonic, which I don't think is true. `GetTime()` is mockable so may move backwards in tests.\r\n\r\nIt looks like `GetTime()` is also deprecated.",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-08T10:46:22Z",
      "diff_hunk" : "@@ -1305,6 +1305,14 @@ bool CChainState::IsInitialBlockDownload() const\n         return false;\n     if (fImporting || fReindex)\n         return true;\n+    uint64_t ibdtimeout = gArgs.GetArg(\"-ibdtimeout\", DEFAULT_IBD_TIMEOUT);\n+    int64_t uptime = GetTime() - GetStartupTime();\n+    assert(uptime >= 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r571946307",
      "id" : 571946307,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTk0NjMwNw==",
      "original_commit_id" : "22c27cca430298bfc0b76ab50b18dc639110d75e",
      "original_line" : 1310,
      "original_position" : 6,
      "original_start_line" : 1309,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 585370500,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571946307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> all or most of the listening nodes are restarted into Initial Block Download mode \r\n\r\nWouldn't that mean that there hasn't been a block in 24 hours? Then, waiting another two days for the next block doesn't seem like a fallback that will be needed.",
      "created_at" : "2021-02-08T11:58:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-775094408",
      "id" : 775094408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NTA5NDQwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-08T11:58:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/775094408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r572483459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572483459"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nodes in IBD will not respond to GETHEADERS. Nodes in IBD do not request headers from inbound peers only outbound.\r\n\r\nIf all or most of the listening nodes are in IBD (emergency hot fix or something) then nobody will be able to get headers.\r\n\r\nTo get out of this the listening nodes need to request headers from inbound connections, either by exiting IBD or special casing that limit while in IBD.",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-09T00:43:37Z",
      "diff_hunk" : "@@ -1305,6 +1305,14 @@ bool CChainState::IsInitialBlockDownload() const\n         return false;\n     if (fImporting || fReindex)\n         return true;\n+    uint64_t ibdtimeout = gArgs.GetArg(\"-ibdtimeout\", DEFAULT_IBD_TIMEOUT);\n+    int64_t uptime = GetTime() - GetStartupTime();\n+    assert(uptime >= 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r572483459",
      "id" : 572483459,
      "in_reply_to_id" : 571946307,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQ4MzQ1OQ==",
      "original_commit_id" : "22c27cca430298bfc0b76ab50b18dc639110d75e",
      "original_line" : 1310,
      "original_position" : 6,
      "original_start_line" : 1309,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 586054492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572483459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke no it doesn't, just that the listening nodes haven't seen the block yet.",
      "created_at" : "2021-02-09T00:45:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-775567992",
      "id" : 775567992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NTU2Nzk5Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-09T00:45:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/775567992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If the listening nodes haven't seen a block from 24h ago, something is going wrong and needs human attention to manually fixup. Having an automated fallback that hits after two days doesn't seem needed when having to manually interfere anyway.",
      "created_at" : "2021-02-09T07:08:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-775723337",
      "id" : 775723337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NTcyMzMzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-09T07:08:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/775723337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke  I respectfully disagree.  The network consists of thousands of listening nodes, tens of thousands of total nodes.  Many-- probably most-- are not observed on a daily or weekly basis.  If the network ends up in a bad state it may be difficult to recover nodes even manually if it is full of other nodes which are non-functional.\r\n\r\nWhen users do \"manually\" intervene, the results are not always pretty--  I've consoled more than one user through a thousands of dollars loss because in their efforts to 'fix' a 'stuck' node that wasn't actually stuck (e.g. when they were confused at the 0.99x progress display) and managed to delete or corrupt every copy of their wallet due to trying random things and/or following bad advice online.  Any particular user isn't likely to footgun themselves, but if you make 50,000 users do so, a few probably will.\r\n\r\nI'm not particularly sure about the approach in this PR right now, but the general practice that nodes should fix themselves if reasonable and safely possible is a really good one.  The whole behaviour switching on IBD handling is a pile of gross hacks on top of a pile of gross hacks,  several of which were needed to resolve cases where the network could more or less just spontaneously fail as a result of the IBD behaviour (some of which were witnessed on testnet).\r\n\r\nIt would be good to have a stronger assurance that things will recover if they end up in that state but the tricky part is being equally confident that the various attacks that the IBD specific behaviour is intended to protect against are still protected against-- esp because no one reviewing this work may remember all of them.\r\n\r\n\r\n",
      "created_at" : "2021-02-10T06:42:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776484069",
      "id" : 776484069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjQ4NDA2OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T06:42:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776484069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I fully agree that the node should try to recover (to avoid manual intervention as much as possible) when its both reasonable and safe to do. Though in this particular case, the users that are eager enough to corrupt their datadir, won't be patient enough to wait three full days for this workaround to take effect. And similarly, the patient users won't see the benefits either because some eager users successfully poked their node on the first day of issues.",
      "created_at" : "2021-02-10T07:04:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776494393",
      "id" : 776494393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjQ5NDM5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T07:04:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776494393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r573569162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573569162"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The `ibdtimeout` and `uptime` localvars can be `const`.\r\n\r\nAs @jnewbery mentions, we probably don't want to use `GetTime()` here, see `src/util/time.h`.\r\n\r\nAlso maybe consider how this interacts with `setmocktime`\r\n```\r\n    // For now, don't change mocktime if we're in the middle of validation, as\r\n    // this could have an effect on mempool time-based eviction, as well as\r\n    // IsCurrentForFeeEstimation() and IsInitialBlockDownload().\r\n    // TODO: figure out the right way to synchronize around mocktime, and\r\n    // ensure all call sites of GetTime() are accessing this safely.\r\n```\r\n",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-10T09:25:14Z",
      "diff_hunk" : "@@ -1305,11 +1305,19 @@ bool CChainState::IsInitialBlockDownload() const\n         return false;\n     if (fImporting || fReindex)\n         return true;\n+    uint64_t ibdtimeout = gArgs.GetArg(\"-ibdtimeout\", DEFAULT_IBD_TIMEOUT);\n+    int64_t uptime = GetTime() - GetStartupTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r573569162",
      "id" : 573569162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzU2OTE2Mg==",
      "original_commit_id" : "99283bf75197199191e433ae07456f3cf239308e",
      "original_line" : 1309,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 587402387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573569162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r573569430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573569430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can use `constexpr` and mention that the constant refers to a time duration in seconds.",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-10T09:25:37Z",
      "diff_hunk" : "@@ -53,6 +53,7 @@ struct DisconnectedBlockTransactions;\n struct PrecomputedTransactionData;\n struct LockPoints;\n \n+static const unsigned int DEFAULT_IBD_TIMEOUT = 3600 * 48; // 48 Hours",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r573569430",
      "id" : 573569430,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzU2OTQzMA==",
      "original_commit_id" : "99283bf75197199191e433ae07456f3cf239308e",
      "original_line" : 56,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 587402387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/573569430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke  It's other peoples nodes not being broken (having since recovered instead of staying broken) that prevent the user we want to help from having issues (at all, or which don't recover quickly).   If nodes recover on their own it's much harder for the network to end up in a state where large numbers of nodes are in a broken state.",
      "created_at" : "2021-02-10T09:33:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776574375",
      "id" : 776574375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjU3NDM3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T09:35:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776574375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  the tricky part is being equally confident that the various attacks that the IBD specific behaviour is intended to protect against are still protected against-- esp because no one reviewing this work may remember all of them\r\n\r\nYes.",
      "created_at" : "2021-02-10T10:08:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776597233",
      "id" : 776597233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjU5NzIzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T10:08:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776597233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It might be sufficient to instead latch IBD to false across restarts.\r\n\r\nBecause it might not be clear in the thread, here is a sequence I believe the PR is intended to address:   A DOS attack runs against all reachable nodes for a while preventing them from getting blocks (e.g. with volumetric DOS as without any non-tcp transports nodes are fairly vulnerable to just being flooded out),  then nodes are restarted either by operators trying to fix them or-- worse-- by some separate issue like a crasher bug.\r\n\r\nAfter (almost) all the listening network is in IBD it will stay stuck in IBD even if the DOS attacks stops because a node in IBD will not serve blocks/headers to others, and will only obtain them from peers it connects out to ... and it's extremely likely that the node it connects to will all be in the same state and not serve it anything.  It will only escape if the stale block detection mechanism causes it to eventually find a working node-- but this will take an extremely long time because it's stale block connections are infrequent and intended to heal a partitioned node in a network of mostly okay nodes.  Not to heal a partitioned node in a network of mostly partitioned node.  (And if there are a relatively small number of functional nodes a dos attacker can focus all their resources on those).\r\n\r\n(there is an altcoin that appears to be undergoing something like this recently--  potentially caused without much of an attacker, but mostly just by an enormous number of new nodes coming online effectively dos attacking the network.  It's unclear how it got into this state, but essentially all reachable nodes (including apparently long running ones) are stuck in IBD.)\r\n\r\nI understand pstratem's PR would improve the situation particularly if it took days to get most of the listening network into this state because they'd also be falling out of it on their own before the network became saturated-- in that case disruption would be prevented entirely. But if the issue is triggered all at once, it helps less-- there is still disruption, but the disruption heals completely in two days rather than having partitioned nodes hanging around for however long it takes a significant minority to get fixed via more manual means (such as by spinning up a lot of new working nodes).\r\n\r\nI think this pattern would be more completely and crisply resolved by simply persisting the latching state across restarts.  New nodes would have problems joining in a network under attack, but that is already the case for a bunch of reasons... and a new node you can assume has an operator present to do something (so, for example, a hidden option to force ibd=false might be a useful resource).  I think persisting the latch also actually reflects the *intent* of the latch, it just didn't do that when the latch was introduce because persisting state takes extra work.\r\n",
      "created_at" : "2021-02-10T10:37:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776614912",
      "id" : 776614912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjYxNDkxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T10:38:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776614912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "node_id" : "MDQ6VXNlcjg1ODQ1NA==",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "If this was a boolean option (default to false), it would be easier to review than this time-based threshold. Obviously, it would also lose the node-fixes-itself-after-three-days feature. Though, I am still sceptical of it's use. It assumes that *all* of your connections (inbound, as well as block-feeler, outbound block-relay, ...) are out of IBD for three days without a single one of them setting the flag manually.\r\n\r\n(Edit: I wrote this before the previous comment, so it is not a reply to that)",
      "created_at" : "2021-02-10T10:46:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776619931",
      "id" : 776619931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjYxOTkzMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T10:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776619931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke In IBD we do not request headers from inbound peers.  Literally only from a single outbound peer with a timeout.\r\n\r\nA setting to disable IBD for your own node might fix your node if your node is listening and receiving inbound connections from nodes which are sync'd with miners.  Relying on that would be extremely fragile.\r\n\r\nEven if you were able to fix your own node, you can't then heal the rest of the network without them connecting to you as the single initial sync peer, the odds of which are extremely low.\r\n\r\nThe timeout prevents the network from being in this state for more than 48 hours with a bunch of nodes stuck in IBD.\r\n\r\nI'm assuming that the vast majority of listening nodes are not actively maintained and have no wallet, but are rather used as a kind of gateway, so being down for 48 hours is a nuisance to the rest of the network, but is probably not directly going to cause them to take action.",
      "created_at" : "2021-02-10T18:51:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776932029",
      "id" : 776932029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjkzMjAyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T18:51:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776932029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@gmaxwell Yes just writing the latch to disk is probably the best solution.",
      "created_at" : "2021-02-10T19:23:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776956299",
      "id" : 776956299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3Njk1NjI5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T19:23:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776956299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, if we can avoid using time that would be a real win. Easier to test too.",
      "created_at" : "2021-02-10T19:26:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-776957620",
      "id" : 776957620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3Njk1NzYyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T19:26:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776957620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574085139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574085139"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we now use bracket syntax for the conditional (after a famous Apple bug iirc)\r\n```diff\r\n-    if (!f) LogPrintf(\"Failed to write %s \\n\", latch_filename.c_str());\r\n-    else fclose(f);\r\n+    if (f) {\r\n+        fclose(f);\r\n+    } else {\r\n+        LogPrintf(\"Failed to write %s \\n\", latch_filename.c_str());\r\n+    }\r\n```\r\n",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-10T21:19:53Z",
      "diff_hunk" : "@@ -1312,6 +1323,9 @@ bool CChainState::IsInitialBlockDownload() const\n     if (m_chain.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n     LogPrintf(\"Leaving InitialBlockDownload (latching to false)\\n\");\n+    f = fsbridge::fopen(latch_filename, \"wb\");\n+    if (!f) LogPrintf(\"Failed to write %s \\n\", latch_filename.string().c_str());\n+    else fclose(f);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574085139",
      "id" : 574085139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDA4NTEzOQ==",
      "original_commit_id" : "cf742ecc4447f17751e13f0e61e23fd7859c5f57",
      "original_line" : 1328,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 588064190,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574085139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574092299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574092299"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Coding style guidelines doesn't agree, but I will expand it to new lines to make it easier to read.\r\n\r\n(Indeed ironically I argued for using braces everywhere, but we don't).\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-10T21:32:44Z",
      "diff_hunk" : "@@ -1312,6 +1323,9 @@ bool CChainState::IsInitialBlockDownload() const\n     if (m_chain.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n     LogPrintf(\"Leaving InitialBlockDownload (latching to false)\\n\");\n+    f = fsbridge::fopen(latch_filename, \"wb\");\n+    if (!f) LogPrintf(\"Failed to write %s \\n\", latch_filename.string().c_str());\n+    else fclose(f);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574092299",
      "id" : 574092299,
      "in_reply_to_id" : 574085139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDA5MjI5OQ==",
      "original_commit_id" : "cf742ecc4447f17751e13f0e61e23fd7859c5f57",
      "original_line" : 1328,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 588073442,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574092299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574098661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574098661"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The developer notes state:\r\n```\r\n  - If an `if` only has a single-statement `then`-clause, it can appear\r\n    on the same line as the `if`, without braces. In every other case,\r\n    braces are required, and the `then` and `else` clauses must appear\r\n    correctly indented on a new line.\r\n```\r\n",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-10T21:43:51Z",
      "diff_hunk" : "@@ -1312,6 +1323,9 @@ bool CChainState::IsInitialBlockDownload() const\n     if (m_chain.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n     LogPrintf(\"Leaving InitialBlockDownload (latching to false)\\n\");\n+    f = fsbridge::fopen(latch_filename, \"wb\");\n+    if (!f) LogPrintf(\"Failed to write %s \\n\", latch_filename.string().c_str());\n+    else fclose(f);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574098661",
      "id" : 574098661,
      "in_reply_to_id" : 574085139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDA5ODY2MQ==",
      "original_commit_id" : "cf742ecc4447f17751e13f0e61e23fd7859c5f57",
      "original_line" : 1328,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 588081125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574098661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574099441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574099441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So if I read it correctly, without the `else` it would be fine, but with the `else` then braces are required (at any rate, that is what I've been doing).",
      "commit_id" : "f02469bd4020e4dc2abb281162983abf2817d769",
      "created_at" : "2021-02-10T21:45:19Z",
      "diff_hunk" : "@@ -1312,6 +1323,9 @@ bool CChainState::IsInitialBlockDownload() const\n     if (m_chain.Tip()->GetBlockTime() < (GetTime() - nMaxTipAge))\n         return true;\n     LogPrintf(\"Leaving InitialBlockDownload (latching to false)\\n\");\n+    f = fsbridge::fopen(latch_filename, \"wb\");\n+    if (!f) LogPrintf(\"Failed to write %s \\n\", latch_filename.string().c_str());\n+    else fclose(f);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#discussion_r574099441",
      "id" : 574099441,
      "in_reply_to_id" : 574085139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDA5OTQ0MQ==",
      "original_commit_id" : "cf742ecc4447f17751e13f0e61e23fd7859c5f57",
      "original_line" : 1328,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 588082083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21106",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-10T22:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574099441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The CI failures are all random zmq issues.",
      "created_at" : "2021-02-11T03:16:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21106#issuecomment-777179339",
      "id" : 777179339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21106",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NzE3OTMzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-11T03:16:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/777179339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=4",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "node_id" : "MDQ6VXNlcjYyMDYxMQ==",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   }
]
