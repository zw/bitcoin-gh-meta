{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "By all accounts, the bitcoin difficulty algorithm does not seem to be a good one. If there is a fork due to miners seeking to maximize profit without regard to security, users, and nodes, the \"better\" coin could end up being the minority chain, at least for a time.  If 95% of hashrate is really going to be biased towards using SegWit2x, BTC would face 20x delays in confirmations until the next difficulty adjustment, negatively affecting its price relative to BTC1, causing further delays from even more miner abandonment, until the adjustment.  The 5% miners remaining on BTC do not inevitably lose by staying to endure 20x delays because they have 20x less competition.  If the BTC price does not fall to reflect the decreased hashrate, the situation still seems to be a big problem for both coins: BTC1 miners will jump back to BTC, initiating oscillations between the two coins, potentially even worse than what BCH is experiencing due to  asymmetric rise and fall coding in the difficulty algorithm and BTC miners switching back and forth to maximize profit.  On the upside, BTC and BTC1 will not issue coins too fast since the algorithm is symmetrical.\r\n\r\nI have worked a lot in trying to find the ideal difficulty algorithm for Zcash, Sumokoin, and Karbowanek.  A karbowanek github thread shows my work (every failed alternative) this year.  Zcash is an example of a coin that wanted to follow BTC exactly, but felt compelled to completely abandon the difficulty algorithm, like almost every other alt coin.  I do not recommend Zcash's method because it take over 60 blocks to adjust to hashrate changes and a 6 block delay due to using bitcoin's MPT.\r\n\r\nI recommend the following difficulty algorithm for Bitcoin, as fast, simple, and better than any other algorithm I'm aware of.\r\n\r\n```\r\n# Zawy v6 difficulty algorithm (modified for bitcoin)\r\n# Alt coins see more complete v6 at\r\n# http://zawy1.blogspot.com/2017/07/best-difficulty-algorithm-zawy-v1b.html\r\n# Keep negative solvetimes to correct bad timestamps.\r\n# Do not be tempted to use the next line.\r\n# next_D = sum(last N Ds) * T / [max(last N TSs) - min(last N TSs];\r\n# ST= Solvetime, TS = timestamp, \r\n\r\n# set constants until next hard fork:\r\n\r\nT=600; # coin's TargetSolvetime\r\nN=30; # a nod to statistics. Smoother than N=15, faster response than N=60.\r\nX=5;\r\nlimit = X^(2/N); # limit rise and fall in case of timestamp manipulation\r\nadjust = 1/(1+0.67/N);  # keeps avg solvetime on track\r\n \r\n# begin difficulty algorithm \r\n\r\navg_ST=0; avg_D=0;\r\nfor ( i=height;  i > height-N;  i--) {  # go through N most recent blocks\r\n   avg_ST += (TS[i] - TS[i-1]) / N; # Note:  ST != TS\r\n   avg_D += D[i]/N;\r\n}\r\navg_ST = T*limit if avg_ST > T*limit; \r\navg_ST = T/limit if avg_ST < T/limit; \r\n\r\nnext_D = avg_D * T / avg_ST * adjust; \r\n\r\n# Tim Olsen suggested changing coin reward to protect against hash attacks.\r\n# The method below also keeps number of coins issued per real time correct \r\n# for the life of the coin.\r\n# BaseReward = coins per block\r\nnext_reward = BaseReward * avg_ST / T;\r\n```\r\nDue to the limit and keeping negative solvetimes in a true average, timestamp errors resulting in negative solvetimes are corrected in the next block.  Otherwise, one would need to do like Zcash and cause a 5-block delay in the response by resorting to the median of past 11 blocks (MPT) as the most recent timestamp, offsetting the timestamps from the difficulties that \"caused\" those solvetimes by 5 blocks. \r\n\r\nPhilosophical note: Even if BTC1 results in lower transaction fees for the user and better profits for the miner, it sets a bad precedence. Bitcoin was started as a way to stop banks from influencing the law (code) that governs our currency via its lobbying. It's hard not to see miners as an excellent parallel to banks and the Fed, creating coin and trying to influence the fees gained from coin transfers. If they successfully cause a fork to double the coin quantity, it is inflation all over again.\r\n",
   "closed_at" : "2017-10-09T19:21:06Z",
   "closed_by" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   },
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11470/comments",
   "created_at" : "2017-10-09T18:57:39Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11470/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/11470",
   "id" : 263994117,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11470/labels{/name}",
   "locked" : true,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUyNjM5OTQxMTc=",
   "number" : 11470,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "New difficulty algorithm needed for SegWit2x fork",
   "updated_at" : "2017-12-14T03:42:29Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11470",
   "user" : {
      "avatar_url" : "https://avatars2.githubusercontent.com/u/18004719?v=4",
      "events_url" : "https://api.github.com/users/zawy12/events{/privacy}",
      "followers_url" : "https://api.github.com/users/zawy12/followers",
      "following_url" : "https://api.github.com/users/zawy12/following{/other_user}",
      "gists_url" : "https://api.github.com/users/zawy12/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/zawy12",
      "id" : 18004719,
      "login" : "zawy12",
      "node_id" : "MDQ6VXNlcjE4MDA0NzE5",
      "organizations_url" : "https://api.github.com/users/zawy12/orgs",
      "received_events_url" : "https://api.github.com/users/zawy12/received_events",
      "repos_url" : "https://api.github.com/users/zawy12/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/zawy12/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/zawy12/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/zawy12"
   }
}
