[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28368).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/28368#pullrequestreview-1705133591) |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1700604120), [darosior](https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1700990113), [vincenzopalazzo](https://github.com/bitcoin/bitcoin/pull/28368#pullrequestreview-1677960100), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/28368#pullrequestreview-1704870532) |\n| Approach ACK | [hernanmarino](https://github.com/bitcoin/bitcoin/pull/28368#pullrequestreview-1708559433) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28687](https://github.com/bitcoin/bitcoin/pull/28687) ([POC][WIP] C++20 std::views::reverse by stickies-v)\n* [#28391](https://github.com/bitcoin/bitcoin/pull/28391) (refactor: Simplify CTxMempool/BlockAssembler fields, remove some external mapTx access by TheCharlatan)\n* [#27277](https://github.com/bitcoin/bitcoin/pull/27277) (Move log messages: tx enqueue to mempool, allocation to blockstorage by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-08-30T10:45:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1698925402",
      "id" : 1698925402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585lQ4ta",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698925402/reactions"
      },
      "updated_at" : "2023-11-01T16:14:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698925402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice work!\r\n\r\nSo if correctly implemented this should speed up block relay, and enable (future) fee estimator changes to be added without blocking critical codepaths.\r\n\r\nIt would be nice to try and benchmark this somehow, but I'm unsure immediately what the best way to do this would be...\r\n\r\n@glozow @TheCharlatan @instagibbs would be curious to know what y'all think of the approach here.",
      "created_at" : "2023-08-30T10:52:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1698935177",
      "id" : 1698935177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585lQ7GJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698935177/reactions"
      },
      "updated_at" : "2023-08-30T10:52:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698935177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I haven't spent much/any time on the interfaces themselves, will defer to others",
      "created_at" : "2023-08-30T14:54:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1699339618",
      "id" : 1699339618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585lSd1i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699339618/reactions"
      },
      "updated_at" : "2023-08-30T14:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699339618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1310449552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310449552"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n        UnregisterSharedValidationInterface(node.fee_estimator);\r\n```\r\n\r\nif you want you can also do the check of null pointer inside the `UnregisterValidationInterface`",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-30T15:22:10Z",
      "diff_hunk" : "@@ -348,6 +348,10 @@ void Shutdown(NodeContext& node)\n     node.chainman.reset();\n     node.scheduler.reset();\n \n+    if (node.fee_estimator) {\n+        UnregisterValidationInterface(node.fee_estimator.get());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1310449552",
      "id" : 1310449552,
      "line" : 352,
      "node_id" : "PRRC_kwDOABII585OG9-Q",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 352,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 1602964769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310449552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-30T15:22:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310449552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17150045?v=4",
         "events_url" : "https://api.github.com/users/vincenzopalazzo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vincenzopalazzo/followers",
         "following_url" : "https://api.github.com/users/vincenzopalazzo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vincenzopalazzo",
         "id" : 17150045,
         "login" : "vincenzopalazzo",
         "node_id" : "MDQ6VXNlcjE3MTUwMDQ1",
         "organizations_url" : "https://api.github.com/users/vincenzopalazzo/orgs",
         "received_events_url" : "https://api.github.com/users/vincenzopalazzo/received_events",
         "repos_url" : "https://api.github.com/users/vincenzopalazzo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vincenzopalazzo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vincenzopalazzo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1310451650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310451650"
         }
      },
      "author_association" : "NONE",
      "body" : "I will also change this in a separate commit to use static cast with CPP std",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-30T15:23:39Z",
      "diff_hunk" : "@@ -605,36 +591,39 @@ void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, boo\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n     AssertLockHeld(m_cs_fee_estimator);\n-    if (!_removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n+\n+    // Feerates are stored and reported as BTC-per-kb:\n+    CAmount feerate = pos->second.m_fee_per_k;\n+    _removeTx(tx->GetHash(), true);\n+\n     if (blocksToConfirm <= 0) {\n         // This can't happen because we don't process transactions from a block with a height\n         // lower than our greatest seen height\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error Transaction had negative blocksToConfirm\\n\");\n         return false;\n     }\n \n-    // Feerates are stored and reported as BTC-per-kb:\n-    CFeeRate feeRate(entry->GetFee(), entry->GetTxSize());\n-\n-    feeStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    shortStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    longStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n+    feeStats->Record(blocksToConfirm, (double)feerate);\n+    shortStats->Record(blocksToConfirm, (double)feerate);\n+    longStats->Record(blocksToConfirm, (double)feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1310451650",
      "id" : 1310451650,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OG-fC",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 621,
      "original_position" : 96,
      "original_start_line" : 619,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1602967798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310451650/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-30T15:23:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310451650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17150045?v=4",
         "events_url" : "https://api.github.com/users/vincenzopalazzo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vincenzopalazzo/followers",
         "following_url" : "https://api.github.com/users/vincenzopalazzo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vincenzopalazzo",
         "id" : 17150045,
         "login" : "vincenzopalazzo",
         "node_id" : "MDQ6VXNlcjE3MTUwMDQ1",
         "organizations_url" : "https://api.github.com/users/vincenzopalazzo/orgs",
         "received_events_url" : "https://api.github.com/users/vincenzopalazzo/received_events",
         "repos_url" : "https://api.github.com/users/vincenzopalazzo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vincenzopalazzo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vincenzopalazzo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1310453670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310453670"
         }
      },
      "author_association" : "NONE",
      "body" : "```suggestion\r\n * Called when a block is connected. Removes from mempool.\r\n```",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-30T15:24:57Z",
      "diff_hunk" : "@@ -618,33 +611,25 @@ void CTxMemPool::removeConflicts(const CTransaction &tx)\n }\n \n /**\n- * Called when a block is connected. Removes from mempool and updates the miner fee estimator.\n+ * Called when a block is connected. Removes from mempool`  .",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1310453670",
      "id" : 1310453670,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OG--m",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 614,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1602970445,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310453670/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-30T15:26:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310453670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17150045?v=4",
         "events_url" : "https://api.github.com/users/vincenzopalazzo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vincenzopalazzo/followers",
         "following_url" : "https://api.github.com/users/vincenzopalazzo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vincenzopalazzo",
         "id" : 17150045,
         "login" : "vincenzopalazzo",
         "node_id" : "MDQ6VXNlcjE3MTUwMDQ1",
         "organizations_url" : "https://api.github.com/users/vincenzopalazzo/orgs",
         "received_events_url" : "https://api.github.com/users/vincenzopalazzo/received_events",
         "repos_url" : "https://api.github.com/users/vincenzopalazzo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vincenzopalazzo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vincenzopalazzo"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK! Background fee estimator would be really nice (fwiw it seems like this was always the plan: https://github.com/bitcoin/bitcoin/pull/10199#discussion_r115530273 and  #11775 had a lot of fans). Updating asynchronously instead of blocking `removeForBlock` / `ConnectTip` should make things faster - I personally don't need a bench to be convinced though it'd be nice to see. I don't think `CTxMemPool` should know anything about there being a fee estimator; the dependency should be the other way around. I agree that if we want to pursue having multiple fee estimator approaches (e.g. #27995) it would be best for them to be in the background so we don't need to worry about the performance impact on every mempool operation. I can also imagine using this to test fee estimator PRs, as it'd be easy to create 2 fee estimators that use the exact same mempool data and compare their results.\r\n\r\nI haven't reviewed the new interface closely yet but will do as soon as I can.",
      "created_at" : "2023-08-31T08:36:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1700604120",
      "id" : 1700604120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585lXSjY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700604120/reactions"
      },
      "updated_at" : "2023-08-31T08:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700604120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Not sure i'll be able to review anytime soon though.",
      "created_at" : "2023-08-31T12:56:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1700990113",
      "id" : 1700990113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585lYwyh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700990113/reactions"
      },
      "updated_at" : "2023-08-31T12:56:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700990113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311902131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311902131"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Don't forget to remove policy/fees.h from the includes",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-31T16:32:27Z",
      "diff_hunk" : "@@ -387,7 +387,6 @@ void CTxMemPoolEntry::UpdateAncestorState(int32_t modifySize, CAmount modifyFee,\n \n CTxMemPool::CTxMemPool(const Options& opts)\n     : m_check_ratio{opts.check_ratio},\n-      minerPolicyEstimator{opts.estimator},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311902131",
      "id" : 1311902131,
      "line" : 390,
      "node_id" : "PRRC_kwDOABII585OMgmz",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 390,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1605177492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311902131/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-31T17:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311902131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311918625"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311918625"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5896c742ca6542ac997ca4ac693d429193c22e57\r\nreserve for size equal to block.vtx.size()?",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-31T16:46:07Z",
      "diff_hunk" : "@@ -634,17 +634,20 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n     }\n     // Before the txs in the new block have been removed from the mempool, update policy estimates\n     if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, entries);}\n+    std::vector<CTransactionRef> txs_removed_for_block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311918625",
      "id" : 1311918625,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585OMkoh",
      "original_commit_id" : "5896c742ca6542ac997ca4ac693d429193c22e57",
      "original_line" : 618,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 77,
      "pull_request_review_id" : 1605177492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311918625/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-31T17:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311918625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311919610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311919610"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c343bb37ebe15219ac840de2deef1111a5d9be31 nit: would slightly prefer keeping tx outside of the struct",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-31T16:47:05Z",
      "diff_hunk" : "@@ -59,9 +60,9 @@ struct TransactionsDelta final : public CValidationInterface {\n     explicit TransactionsDelta(std::set<CTransactionRef>& r, std::set<CTransactionRef>& a)\n         : m_removed{r}, m_added{a} {}\n \n-    void TransactionAddedToMempool(const CTransactionRef& tx, uint64_t /* mempool_sequence */) override\n+    void TransactionAddedToMempool(const NewMempoolTransactionInfo& tx_info, uint64_t /* mempool_sequence */) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311919610",
      "id" : 1311919610,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OMk36",
      "original_commit_id" : "c343bb37ebe15219ac840de2deef1111a5d9be31",
      "original_line" : 63,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1605177492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311919610/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-31T17:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311919610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311925008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311925008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c343bb37ebe15219ac840de2deef1111a5d9be31\r\nnot a fan of this logic being repeated in 2 places, and imo it should live in the fee estimator instead of in validation\r\nPerhaps instead add these bools to the `NewMempoolTransactionInfo` struct:\r\n```\r\nbool m_from_disconnected_block;\r\nbool m_submitted_in_package;\r\nbool m_chainstate_is_current;\r\nbool m_has_mempool_parents;\r\n```\r\nAnd the fee estimator decides on `validForFeeEstimation` based on these variables.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-31T16:52:21Z",
      "diff_hunk" : "@@ -1196,7 +1196,14 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n             results.emplace(ws.m_ptx->GetWitnessHash(),\n                 MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n                                              ws.m_base_fees, effective_feerate, effective_feerate_wtxids));\n-            GetMainSignals().TransactionAddedToMempool(ws.m_ptx, m_pool.GetAndIncrementSequence());\n+            const CTransaction& tx = *ws.m_ptx;\n+            bool validForFeeEstimation = !args.m_bypass_limits && !args.m_package_submission && IsCurrentForFeeEstimation(m_active_chainstate) && m_pool.HasNoInputsOf(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311925008",
      "id" : 1311925008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OMmMQ",
      "original_commit_id" : "c343bb37ebe15219ac840de2deef1111a5d9be31",
      "original_line" : 1200,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1605177492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311925008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-31T17:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311925008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311930186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311930186"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bbfe01fa9fabec3982b7cfc25c08b94653fb5b52\r\n\r\ncan you provide rationale why it's ok to remove this? Could be worth splitting into its own commit.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-31T16:57:05Z",
      "diff_hunk" : "@@ -566,37 +566,28 @@ CBlockPolicyEstimator::CBlockPolicyEstimator(const fs::path& estimation_filepath\n \n CBlockPolicyEstimator::~CBlockPolicyEstimator() = default;\n \n-void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate)\n+void CBlockPolicyEstimator::processTransaction(const NewMempoolTransactionInfo& tx_info)\n {\n     LOCK(m_cs_fee_estimator);\n-    unsigned int txHeight = entry.GetHeight();\n-    uint256 hash = entry.GetTx().GetHash();\n+    unsigned int txHeight = nBestSeenHeight;\n+    uint256 hash = tx_info.m_tx->GetHash();\n     if (mapMemPoolTxs.count(hash)) {\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error mempool tx %s already being tracked\\n\",\n                  hash.ToString());\n         return;\n     }\n-\n-    if (txHeight != nBestSeenHeight) {\n-        // Ignore side chains and re-orgs; assuming they are random they don't\n-        // affect the estimate.  We'll potentially double count transactions in 1-block reorgs.\n-        // Ignore txs if BlockPolicyEstimator is not in sync with ActiveChain().Tip().\n-        // It will be synced next time a block is processed.\n-        return;\n-    }\n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311930186",
      "id" : 1311930186,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OMndK",
      "original_commit_id" : "bbfe01fa9fabec3982b7cfc25c08b94653fb5b52",
      "original_line" : 587,
      "original_position" : 25,
      "original_start_line" : 579,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1605177492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311930186/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-08-31T17:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311930186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311941008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311941008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4f22c0da092e1c2287e4bc2d84e646d56abbe133\r\nWhy move this into the `reason != BLOCK` case?",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-08-31T17:05:27Z",
      "diff_hunk" : "@@ -481,13 +481,16 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     // We increment mempool sequence value no matter removal reason\n     // even if not directly reported below.\n     uint64_t mempool_sequence = GetAndIncrementSequence();\n-\n+    const uint256 hash = it->GetTx().GetHash();\n     if (reason != MemPoolRemovalReason::BLOCK) {\n         // Notify clients that a transaction has been removed from the mempool\n         // for any reason except being included in a block. Clients interested\n         // in transactions included in blocks can subscribe to the BlockConnected\n         // notification.\n         GetMainSignals().TransactionRemovedFromMempool(it->GetSharedTx(), reason, mempool_sequence);\n+        if (minerPolicyEstimator) {\n+            minerPolicyEstimator->removeTx(hash, false);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1311941008",
      "id" : 1311941008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OMqGQ",
      "original_commit_id" : "4f22c0da092e1c2287e4bc2d84e646d56abbe133",
      "original_line" : 493,
      "original_position" : 14,
      "original_start_line" : 491,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1605177492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311941008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-31T17:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311941008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312866440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312866440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed thanks.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:36:16Z",
      "diff_hunk" : "@@ -605,36 +591,39 @@ void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, boo\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n     AssertLockHeld(m_cs_fee_estimator);\n-    if (!_removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n+\n+    // Feerates are stored and reported as BTC-per-kb:\n+    CAmount feerate = pos->second.m_fee_per_k;\n+    _removeTx(tx->GetHash(), true);\n+\n     if (blocksToConfirm <= 0) {\n         // This can't happen because we don't process transactions from a block with a height\n         // lower than our greatest seen height\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error Transaction had negative blocksToConfirm\\n\");\n         return false;\n     }\n \n-    // Feerates are stored and reported as BTC-per-kb:\n-    CFeeRate feeRate(entry->GetFee(), entry->GetTxSize());\n-\n-    feeStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    shortStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    longStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n+    feeStats->Record(blocksToConfirm, (double)feerate);\n+    shortStats->Record(blocksToConfirm, (double)feerate);\n+    longStats->Record(blocksToConfirm, (double)feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312866440",
      "id" : 1312866440,
      "in_reply_to_id" : 1310451650,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OQMCI",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 621,
      "original_position" : 96,
      "original_start_line" : 619,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1606701292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312866440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-01T10:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312866440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312866725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312866725"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated thank you.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:36:38Z",
      "diff_hunk" : "@@ -618,33 +611,25 @@ void CTxMemPool::removeConflicts(const CTransaction &tx)\n }\n \n /**\n- * Called when a block is connected. Removes from mempool and updates the miner fee estimator.\n+ * Called when a block is connected. Removes from mempool`  .",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312866725",
      "id" : 1312866725,
      "in_reply_to_id" : 1310453670,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OQMGl",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 614,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1606701749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312866725/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-01T10:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312866725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312867132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I remove the include thank you.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:37:06Z",
      "diff_hunk" : "@@ -387,7 +387,6 @@ void CTxMemPoolEntry::UpdateAncestorState(int32_t modifySize, CAmount modifyFee,\n \n CTxMemPool::CTxMemPool(const Options& opts)\n     : m_check_ratio{opts.check_ratio},\n-      minerPolicyEstimator{opts.estimator},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312867132",
      "id" : 1312867132,
      "in_reply_to_id" : 1311902131,
      "line" : 390,
      "node_id" : "PRRC_kwDOABII585OQMM8",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 390,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1606702432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867132/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-01T10:37:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312867392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867392"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed thank you",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:37:25Z",
      "diff_hunk" : "@@ -634,17 +634,20 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n     }\n     // Before the txs in the new block have been removed from the mempool, update policy estimates\n     if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, entries);}\n+    std::vector<CTransactionRef> txs_removed_for_block;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312867392",
      "id" : 1312867392,
      "in_reply_to_id" : 1311918625,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585OQMRA",
      "original_commit_id" : "5896c742ca6542ac997ca4ac693d429193c22e57",
      "original_line" : 618,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 77,
      "pull_request_review_id" : 1606702859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867392/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-01T10:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312867696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867696"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I remove it out of the struct, thank you.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:37:48Z",
      "diff_hunk" : "@@ -59,9 +60,9 @@ struct TransactionsDelta final : public CValidationInterface {\n     explicit TransactionsDelta(std::set<CTransactionRef>& r, std::set<CTransactionRef>& a)\n         : m_removed{r}, m_added{a} {}\n \n-    void TransactionAddedToMempool(const CTransactionRef& tx, uint64_t /* mempool_sequence */) override\n+    void TransactionAddedToMempool(const NewMempoolTransactionInfo& tx_info, uint64_t /* mempool_sequence */) override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312867696",
      "id" : 1312867696,
      "in_reply_to_id" : 1311919610,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OQMVw",
      "original_commit_id" : "c343bb37ebe15219ac840de2deef1111a5d9be31",
      "original_line" : 63,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/tx_pool.cpp",
      "position" : null,
      "pull_request_review_id" : 1606703373,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867696/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-01T10:37:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312867696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312869463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312869463"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\r\nEdit: I updated and now the fee estimator decides.\r\nThank you",
      "commit_id" : "2d4b66b3b9fd907387fe96676c025b54d9925ebb",
      "created_at" : "2023-09-01T10:39:51Z",
      "diff_hunk" : "@@ -1196,7 +1196,14 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n             results.emplace(ws.m_ptx->GetWitnessHash(),\n                 MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n                                              ws.m_base_fees, effective_feerate, effective_feerate_wtxids));\n-            GetMainSignals().TransactionAddedToMempool(ws.m_ptx, m_pool.GetAndIncrementSequence());\n+            const CTransaction& tx = *ws.m_ptx;\n+            bool validForFeeEstimation = !args.m_bypass_limits && !args.m_package_submission && IsCurrentForFeeEstimation(m_active_chainstate) && m_pool.HasNoInputsOf(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312869463",
      "id" : 1312869463,
      "in_reply_to_id" : 1311925008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OQMxX",
      "original_commit_id" : "c343bb37ebe15219ac840de2deef1111a5d9be31",
      "original_line" : 1200,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1606705976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312869463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-07T16:58:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312869463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312879960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312879960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This was from rebase in a734d1d166f9936e453b3c1f65b7a569af894082\r\nI think it has to do with [Handle reorgs much better in fee estimator.](https://github.com/bitcoin/bitcoin/pull/11775/commits/660190c8f52737bb26b99d05eace4b5d754565c1)\r\n\r\nI think its worth to be in its own PR, its not part of this.\r\n\r\nI removed it from this PR.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:52:06Z",
      "diff_hunk" : "@@ -566,37 +566,28 @@ CBlockPolicyEstimator::CBlockPolicyEstimator(const fs::path& estimation_filepath\n \n CBlockPolicyEstimator::~CBlockPolicyEstimator() = default;\n \n-void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate)\n+void CBlockPolicyEstimator::processTransaction(const NewMempoolTransactionInfo& tx_info)\n {\n     LOCK(m_cs_fee_estimator);\n-    unsigned int txHeight = entry.GetHeight();\n-    uint256 hash = entry.GetTx().GetHash();\n+    unsigned int txHeight = nBestSeenHeight;\n+    uint256 hash = tx_info.m_tx->GetHash();\n     if (mapMemPoolTxs.count(hash)) {\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error mempool tx %s already being tracked\\n\",\n                  hash.ToString());\n         return;\n     }\n-\n-    if (txHeight != nBestSeenHeight) {\n-        // Ignore side chains and re-orgs; assuming they are random they don't\n-        // affect the estimate.  We'll potentially double count transactions in 1-block reorgs.\n-        // Ignore txs if BlockPolicyEstimator is not in sync with ActiveChain().Tip().\n-        // It will be synced next time a block is processed.\n-        return;\n-    }\n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312879960",
      "id" : 1312879960,
      "in_reply_to_id" : 1311930186,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OQPVY",
      "original_commit_id" : "bbfe01fa9fabec3982b7cfc25c08b94653fb5b52",
      "original_line" : 587,
      "original_position" : 25,
      "original_start_line" : 579,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1606721870,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312879960/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-09-01T13:59:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312879960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312885030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312885030"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Any transaction whose removal reason is `BLOCK` will be removed by the fee estimator  from the `processBlock` call in `removeForBlock`.\r\n\r\nEdit\r\nHaving `removeTx(hash, false);` call outside reason != `BLOCK` is incorrect.\r\n\r\nIf the reason  for tx removal is `BLOCK` the `removeTx` boolean argument should be true.\r\n\r\nThe reason why this passed before is that the fee estimator must have finish removing all txs whose reason is `BLOCK` before the mempool clears.\r\n\r\n It suppose to be in the reason != BLOCK case.\r\n\r\n",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:57:52Z",
      "diff_hunk" : "@@ -481,13 +481,16 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     // We increment mempool sequence value no matter removal reason\n     // even if not directly reported below.\n     uint64_t mempool_sequence = GetAndIncrementSequence();\n-\n+    const uint256 hash = it->GetTx().GetHash();\n     if (reason != MemPoolRemovalReason::BLOCK) {\n         // Notify clients that a transaction has been removed from the mempool\n         // for any reason except being included in a block. Clients interested\n         // in transactions included in blocks can subscribe to the BlockConnected\n         // notification.\n         GetMainSignals().TransactionRemovedFromMempool(it->GetSharedTx(), reason, mempool_sequence);\n+        if (minerPolicyEstimator) {\n+            minerPolicyEstimator->removeTx(hash, false);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312885030",
      "id" : 1312885030,
      "in_reply_to_id" : 1311941008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OQQkm",
      "original_commit_id" : "4f22c0da092e1c2287e4bc2d84e646d56abbe133",
      "original_line" : 493,
      "original_position" : 14,
      "original_start_line" : 491,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1606729557,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312885030/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-01T13:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312885030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312886158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312886158"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, I will leave this as is since there is a check above.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-01T10:59:13Z",
      "diff_hunk" : "@@ -348,6 +348,10 @@ void Shutdown(NodeContext& node)\n     node.chainman.reset();\n     node.scheduler.reset();\n \n+    if (node.fee_estimator) {\n+        UnregisterValidationInterface(node.fee_estimator.get());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1312886158",
      "id" : 1312886158,
      "in_reply_to_id" : 1310449552,
      "line" : 352,
      "node_id" : "PRRC_kwDOABII585OQQ2O",
      "original_commit_id" : "a7250f6597f05b7064716610d6e88d7d9a744c40",
      "original_line" : 352,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 5,
      "pull_request_review_id" : 1606731326,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312886158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-01T10:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312886158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314180859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314180859"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: The notification name is a bit non-descript and does not fit the existing naming pattern. How about \"MempoolTransactionsRemovedForConnectedBlock\"?",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-03T08:42:58Z",
      "diff_hunk" : "@@ -130,9 +131,18 @@ class CValidationInterface {\n      * Called on a background thread.\n      */\n     virtual void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason, uint64_t mempool_sequence) {}\n+    /* Notifies listeners of transactions removed from the mempool as\n+     * as a result of new block being connected.\n+     * MempoolBlockConnect will be fired before BlockConnected.\n+     *\n+     * Called on a background thread.\n+     */\n+    virtual void MempoolBlockConnect(const std::vector<CTransactionRef>& txs_removed_for_block, unsigned int nBlockHeight) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314180859",
      "id" : 1314180859,
      "line" : 140,
      "node_id" : "PRRC_kwDOABII585OVM77",
      "original_commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "original_line" : 140,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : 49,
      "pull_request_review_id" : 1608456395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 1,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314180859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T10:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314180859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314184992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314184992"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is always false, since `node.fee_estimator` is reset a couple of lines further up. I'd move this to the line where `node.fee_estimator->Flush()` is called.",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-03T08:54:13Z",
      "diff_hunk" : "@@ -348,6 +348,10 @@ void Shutdown(NodeContext& node)\n     node.chainman.reset();\n     node.scheduler.reset();\n \n+    if (node.fee_estimator) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314184992",
      "id" : 1314184992,
      "line" : 351,
      "node_id" : "PRRC_kwDOABII585OVN8g",
      "original_commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "original_line" : 351,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 4,
      "pull_request_review_id" : 1608456395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314184992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T10:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314184992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314217968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314217968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Could forward-declare `NewMempoolTransactionInfo` instead (and in other places where this is included in a header).",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-03T09:46:31Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #define BITCOIN_VALIDATIONINTERFACE_H\n \n #include <kernel/cs_main.h>\n+#include <kernel/mempool_entry.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314217968",
      "id" : 1314217968,
      "line" : 10,
      "node_id" : "PRRC_kwDOABII585OVV_w",
      "original_commit_id" : "a34aaf88c1fba2811089b49bf3f29b0da32f1a7a",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : 4,
      "pull_request_review_id" : 1608456395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314217968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T10:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314217968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314227670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314227670"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is this line moved?",
      "commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "created_at" : "2023-09-03T10:15:43Z",
      "diff_hunk" : "@@ -603,36 +603,39 @@ void CBlockPolicyEstimator::processTransaction(const CTransactionRef& tx, const\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n     AssertLockHeld(m_cs_fee_estimator);\n-    if (!_removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n+\n+    // Feerates are stored and reported as BTC-per-kb:\n+    CAmount feerate = pos->second.m_fee_per_k;\n+    _removeTx(tx->GetHash(), true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314227670",
      "id" : 1314227670,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585OVYXW",
      "original_commit_id" : "3b17461f743c8c2335af14169b3d3f8a36d23621",
      "original_line" : 622,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 80,
      "pull_request_review_id" : 1608456395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314227670/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T10:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314227670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293213"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for your review.\r\nI updated the name",
      "commit_id" : "9ae8482ae1842ea96479514fffd8b05f090561c6",
      "created_at" : "2023-09-03T17:36:12Z",
      "diff_hunk" : "@@ -130,9 +131,18 @@ class CValidationInterface {\n      * Called on a background thread.\n      */\n     virtual void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason, uint64_t mempool_sequence) {}\n+    /* Notifies listeners of transactions removed from the mempool as\n+     * as a result of new block being connected.\n+     * MempoolBlockConnect will be fired before BlockConnected.\n+     *\n+     * Called on a background thread.\n+     */\n+    virtual void MempoolBlockConnect(const std::vector<CTransactionRef>& txs_removed_for_block, unsigned int nBlockHeight) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293213",
      "id" : 1314293213,
      "in_reply_to_id" : 1314180859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OVoXd",
      "original_commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "original_line" : 140,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : null,
      "pull_request_review_id" : 1608557706,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T17:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293285"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch.\r\nI moved it below the Flush",
      "commit_id" : "9ae8482ae1842ea96479514fffd8b05f090561c6",
      "created_at" : "2023-09-03T17:36:48Z",
      "diff_hunk" : "@@ -348,6 +348,10 @@ void Shutdown(NodeContext& node)\n     node.chainman.reset();\n     node.scheduler.reset();\n \n+    if (node.fee_estimator) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293285",
      "id" : 1314293285,
      "in_reply_to_id" : 1314184992,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OVoYl",
      "original_commit_id" : "db4849c3548f6802286875eff7135ffb07e8722c",
      "original_line" : 351,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1608557761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293285/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T17:36:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks fixed",
      "commit_id" : "9ae8482ae1842ea96479514fffd8b05f090561c6",
      "created_at" : "2023-09-03T17:36:59Z",
      "diff_hunk" : "@@ -7,6 +7,7 @@\n #define BITCOIN_VALIDATIONINTERFACE_H\n \n #include <kernel/cs_main.h>\n+#include <kernel/mempool_entry.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293297",
      "id" : 1314293297,
      "in_reply_to_id" : 1314217968,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OVoYx",
      "original_commit_id" : "a34aaf88c1fba2811089b49bf3f29b0da32f1a7a",
      "original_line" : 10,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : null,
      "pull_request_review_id" : 1608557777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T17:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314293297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314294642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314294642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because `_removeTx` clear the tx from `mapMemPoolTxs`.\r\nSo using\r\n```c++\r\n _removeTx(tx->GetHash(), true);\r\n std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\r\n```  \r\n`pos` will always be an empty iterator.\r\n\r\nSo I find the iterator of the tx from `mapMemPoolTxs` and capture all the values I need (tx fee rate and entry height) before removing the tx. \r\n\r\nBefore this pull request, we could get all those details from the tx  because it's in `CTxMempoolEntry` format.\r\n",
      "commit_id" : "9ae8482ae1842ea96479514fffd8b05f090561c6",
      "created_at" : "2023-09-03T17:48:20Z",
      "diff_hunk" : "@@ -603,36 +603,39 @@ void CBlockPolicyEstimator::processTransaction(const CTransactionRef& tx, const\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n     AssertLockHeld(m_cs_fee_estimator);\n-    if (!_removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n+\n+    // Feerates are stored and reported as BTC-per-kb:\n+    CAmount feerate = pos->second.m_fee_per_k;\n+    _removeTx(tx->GetHash(), true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314294642",
      "id" : 1314294642,
      "in_reply_to_id" : 1314227670,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585OVoty",
      "original_commit_id" : "3b17461f743c8c2335af14169b3d3f8a36d23621",
      "original_line" : 618,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 80,
      "pull_request_review_id" : 1608558829,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314294642/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T17:49:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314294642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314295232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314295232"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the explainer :)\r\nFeel free to resolve.",
      "commit_id" : "9ae8482ae1842ea96479514fffd8b05f090561c6",
      "created_at" : "2023-09-03T17:53:04Z",
      "diff_hunk" : "@@ -603,36 +603,39 @@ void CBlockPolicyEstimator::processTransaction(const CTransactionRef& tx, const\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n     AssertLockHeld(m_cs_fee_estimator);\n-    if (!_removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n+\n+    // Feerates are stored and reported as BTC-per-kb:\n+    CAmount feerate = pos->second.m_fee_per_k;\n+    _removeTx(tx->GetHash(), true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314295232",
      "id" : 1314295232,
      "in_reply_to_id" : 1314227670,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585OVo3A",
      "original_commit_id" : "3b17461f743c8c2335af14169b3d3f8a36d23621",
      "original_line" : 618,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 80,
      "pull_request_review_id" : 1608559262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314295232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-03T17:53:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314295232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach ACK\r\n\r\nWill give this another pass soon.",
      "created_at" : "2023-09-03T19:30:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1704382991",
      "id" : 1704382991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585lltIP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1704382991/reactions"
      },
      "updated_at" : "2023-09-03T19:30:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1704382991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed to 55beb4f39bb029e19b333dea205e4b035d01bd12\r\n\r\n- Modified `MempoolTransactionsRemovedForConnectedBlock` callback parameter to vector of `NewMempoolTransactionInfo` instead of `CTransactionRef` to resolve conflict with #25380.\r\nSee [comment](https://github.com/bitcoin/bitcoin/pull/25380#issuecomment-1713512238)\r\n- Hence add `CTransactionRef` back to `NewMempoolTransactionInfo`\r\n",
      "created_at" : "2023-09-13T13:08:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1717605255",
      "id" : 1717605255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585mYJOH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717605255/reactions"
      },
      "updated_at" : "2023-09-13T13:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717605255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-02T21:51:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1743821609",
      "id" : 1743821609,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585n8Jsp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743821609/reactions"
      },
      "updated_at" : "2023-10-02T21:51:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743821609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1359286867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359286867"
         }
      },
      "author_association" : "NONE",
      "body" : "why not\r\n```suggestion\r\n    /* The fee the added transaction paid */\r\n```",
      "commit_id" : "2d4b66b3b9fd907387fe96676c025b54d9925ebb",
      "created_at" : "2023-10-14T09:30:45Z",
      "diff_hunk" : "@@ -170,10 +170,43 @@ class CTxMemPoolEntry\n     const Parents& GetMemPoolParentsConst() const { return m_parents; }\n     const Children& GetMemPoolChildrenConst() const { return m_children; }\n     Parents& GetMemPoolParents() const { return m_parents; }\n+    std::vector<CTransactionRef> GetMemPoolParentsCopy() const\n+    {\n+        std::vector<CTransactionRef> parents;\n+        parents.reserve(m_parents.size());\n+        for (const auto& parent : m_parents) {\n+            parents.push_back(parent.get().GetSharedTx());\n+        }\n+        return parents;\n+    }\n     Children& GetMemPoolChildren() const { return m_children; }\n \n     mutable size_t vTxHashesIdx; //!< Index in mempool's vTxHashes\n     mutable Epoch::Marker m_epoch_marker; //!< epoch when last touched, useful for graph algorithms\n };\n \n+struct NewMempoolTransactionInfo {\n+    CTransactionRef m_tx;\n+    std::vector<CTransactionRef> m_parents;\n+    //! The fee the added transaction paid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1359286867",
      "id" : 1359286867,
      "line" : 191,
      "node_id" : "PRRC_kwDOABII585RBRJT",
      "original_commit_id" : "2d4b66b3b9fd907387fe96676c025b54d9925ebb",
      "original_line" : 191,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 22,
      "pull_request_review_id" : 1677960100,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359286867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-14T09:31:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359286867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/17150045?v=4",
         "events_url" : "https://api.github.com/users/vincenzopalazzo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vincenzopalazzo/followers",
         "following_url" : "https://api.github.com/users/vincenzopalazzo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vincenzopalazzo",
         "id" : 17150045,
         "login" : "vincenzopalazzo",
         "node_id" : "MDQ6VXNlcjE3MTUwMDQ1",
         "organizations_url" : "https://api.github.com/users/vincenzopalazzo/orgs",
         "received_events_url" : "https://api.github.com/users/vincenzopalazzo/received_events",
         "repos_url" : "https://api.github.com/users/vincenzopalazzo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vincenzopalazzo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vincenzopalazzo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1373129712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1373129712"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 1d116df4c0e021c4c810450e3e5358f34d72940b:\r\n\r\nFollowing up on https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1314293297, in implementation/`.cpp` files foward-declarations don't make much sense. Since it is already transitively included through `test/util/txmempool.h` this can just be removed again. Same for the other fuzz test.",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-26T12:58:55Z",
      "diff_hunk" : "@@ -20,6 +20,8 @@\n \n using node::NodeContext;\n \n+struct NewMempoolTransactionInfo;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1373129712",
      "id" : 1373129712,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585R2Evw",
      "original_commit_id" : "79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13",
      "original_line" : 23,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/package_eval.cpp",
      "position" : null,
      "pull_request_review_id" : 1699568043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1373129712/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T07:24:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1373129712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1374111733"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1374111733"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Why introduce this temporary?",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-27T06:10:11Z",
      "diff_hunk" : "@@ -566,37 +566,36 @@ CBlockPolicyEstimator::CBlockPolicyEstimator(const fs::path& estimation_filepath\n \n CBlockPolicyEstimator::~CBlockPolicyEstimator() = default;\n \n-void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate)\n+void CBlockPolicyEstimator::processTransaction(const NewMempoolTransactionInfo& tx_info, bool validForFeeEstimation)\n {\n     LOCK(m_cs_fee_estimator);\n-    unsigned int txHeight = entry.GetHeight();\n-    uint256 hash = entry.GetTx().GetHash();\n+    const CTransactionRef& tx = tx_info.m_tx;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1374111733",
      "id" : 1374111733,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585R50f1",
      "original_commit_id" : "576de764e0a7ac7fd624e6c17a2ebdf98f6a1d1d",
      "original_line" : 572,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1699568043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1374111733/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T07:24:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1374111733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1375481088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375481088"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: I think this would be nicer with designated initializers instead of setting all the values after initialization. Also might make things more readable in general when initializing `NewMempoolTransactionInfo`.",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-29T17:45:25Z",
      "diff_hunk" : "@@ -67,16 +67,16 @@ BOOST_AUTO_TEST_CASE(BlockPolicyEstimates)\n                     // Since TransactionAddedToMempool callbacks are generated in ATMP,\n                     // not addUnchecked, we cheat and create one manually here\n                     int64_t virtual_size = GetVirtualTransactionSize(*MakeTransactionRef(tx));\n-                    GetMainSignals().TransactionAddedToMempool(\n-                        {MakeTransactionRef(tx),\n-                         feeV[j],\n-                         virtual_size,\n-                         entry.nHeight,\n-                         false,\n-                         false,\n-                         true,\n-                         true},\n-                        mpool.GetAndIncrementSequence());\n+                    NewMempoolTransactionInfo tx_info;\n+                    tx_info.m_tx = MakeTransactionRef(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1375481088",
      "id" : 1375481088,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585R_C0A",
      "original_commit_id" : "79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13",
      "original_line" : 71,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/test/policyestimator_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1699568043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375481088/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T07:24:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375481088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1375763890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375763890"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13 the last paragraph of its commit message seems like it misses part of a sentence.",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T07:24:04Z",
      "diff_hunk" : "@@ -170,6 +170,15 @@ class CTxMemPoolEntry\n     const Parents& GetMemPoolParentsConst() const { return m_parents; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1375763890",
      "id" : 1375763890,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII585SAH2y",
      "original_commit_id" : "79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13",
      "original_line" : 170,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 1,
      "pull_request_review_id" : 1699568043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375763890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T07:24:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375763890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376061977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376061977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thank you for you review, removed the forward declaration.",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T11:36:54Z",
      "diff_hunk" : "@@ -20,6 +20,8 @@\n \n using node::NodeContext;\n \n+struct NewMempoolTransactionInfo;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376061977",
      "id" : 1376061977,
      "in_reply_to_id" : 1373129712,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SBQoZ",
      "original_commit_id" : "79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13",
      "original_line" : 23,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/fuzz/package_eval.cpp",
      "position" : null,
      "pull_request_review_id" : 1703881361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376061977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T11:36:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376061977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376063168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063168"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed, since I can get the hash directly with `tx_info.m_tx->GetHash();`",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T11:38:12Z",
      "diff_hunk" : "@@ -566,37 +566,36 @@ CBlockPolicyEstimator::CBlockPolicyEstimator(const fs::path& estimation_filepath\n \n CBlockPolicyEstimator::~CBlockPolicyEstimator() = default;\n \n-void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate)\n+void CBlockPolicyEstimator::processTransaction(const NewMempoolTransactionInfo& tx_info, bool validForFeeEstimation)\n {\n     LOCK(m_cs_fee_estimator);\n-    unsigned int txHeight = entry.GetHeight();\n-    uint256 hash = entry.GetTx().GetHash();\n+    const CTransactionRef& tx = tx_info.m_tx;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376063168",
      "id" : 1376063168,
      "in_reply_to_id" : 1374111733,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SBQ7A",
      "original_commit_id" : "576de764e0a7ac7fd624e6c17a2ebdf98f6a1d1d",
      "original_line" : 572,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1703883351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063168/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T11:38:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376063741"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063741"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, thank you",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T11:38:48Z",
      "diff_hunk" : "@@ -67,16 +67,16 @@ BOOST_AUTO_TEST_CASE(BlockPolicyEstimates)\n                     // Since TransactionAddedToMempool callbacks are generated in ATMP,\n                     // not addUnchecked, we cheat and create one manually here\n                     int64_t virtual_size = GetVirtualTransactionSize(*MakeTransactionRef(tx));\n-                    GetMainSignals().TransactionAddedToMempool(\n-                        {MakeTransactionRef(tx),\n-                         feeV[j],\n-                         virtual_size,\n-                         entry.nHeight,\n-                         false,\n-                         false,\n-                         true,\n-                         true},\n-                        mpool.GetAndIncrementSequence());\n+                    NewMempoolTransactionInfo tx_info;\n+                    tx_info.m_tx = MakeTransactionRef(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376063741",
      "id" : 1376063741,
      "in_reply_to_id" : 1375481088,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SBRD9",
      "original_commit_id" : "79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13",
      "original_line" : 71,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/test/policyestimator_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1703884294,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063741/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T11:38:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063741",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376063953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063953"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated the commit message",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T11:39:02Z",
      "diff_hunk" : "@@ -170,6 +170,15 @@ class CTxMemPoolEntry\n     const Parents& GetMemPoolParentsConst() const { return m_parents; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376063953",
      "id" : 1376063953,
      "in_reply_to_id" : 1375763890,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII585SBRHR",
      "original_commit_id" : "79bcc5ca0679daf6e57fc4d7ce2244262a7cfd13",
      "original_line" : 170,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 1,
      "pull_request_review_id" : 1703884661,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063953/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T11:39:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376063953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376400525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376400525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 4986edb99f8aa73f72e87f3bdc09387c3e516197 \r\nI don't think these comments are necessary since they're just facts about block transactions that might not be relevant to the user\r\n```suggestion\r\n```",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-10-30T15:20:01Z",
      "diff_hunk" : "@@ -131,9 +132,18 @@ class CValidationInterface {\n      * Called on a background thread.\n      */\n     virtual void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason, uint64_t mempool_sequence) {}\n+    /* Notifies listeners of transactions removed from the mempool as\n+     * as a result of new block being connected.\n+     * MempoolTransactionsRemovedForConnectedBlock will be fired before BlockConnected.\n+     *\n+     * Called on a background thread.\n+     */\n+    virtual void MempoolTransactionsRemovedForConnectedBlock(const std::vector<NewMempoolTransactionInfo>& txs_removed_for_block, unsigned int nBlockHeight) {}\n     /**\n      * Notifies listeners of a block being connected.\n-     * Provides a vector of transactions evicted from the mempool as a result.\n+     * Provides the block that was connected.\n+     * The block contains a vector of transactions from the new block,\n+     * some of the transactions in the vector may not be in our mempool.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376400525",
      "id" : 1376400525,
      "line" : 146,
      "node_id" : "PRRC_kwDOABII585SCjSN",
      "original_commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "original_line" : 146,
      "original_position" : 55,
      "original_start_line" : 145,
      "path" : "src/validationinterface.h",
      "position" : 55,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376400525/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 145,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:45:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376400525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376404497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376404497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe create a `NewMempoolTransactionInfo` constructor that takes a `CTxMemPoolEntry` as a param instead?",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-10-30T15:22:51Z",
      "diff_hunk" : "@@ -633,33 +625,37 @@ void CTxMemPool::removeConflicts(const CTransaction &tx)\n }\n \n /**\n- * Called when a block is connected. Removes from mempool and updates the miner fee estimator.\n+ * Called when a block is connected. Removes from mempool.\n  */\n void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigned int nBlockHeight)\n {\n     AssertLockHeld(cs);\n-    std::vector<const CTxMemPoolEntry*> entries;\n-    for (const auto& tx : vtx)\n-    {\n-        uint256 hash = tx->GetHash();\n-\n-        indexed_transaction_set::iterator i = mapTx.find(hash);\n-        if (i != mapTx.end())\n-            entries.push_back(&*i);\n-    }\n-    // Before the txs in the new block have been removed from the mempool, update policy estimates\n-    if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, entries);}\n+    std::vector<NewMempoolTransactionInfo> txs_removed_for_block;\n+    txs_removed_for_block.reserve(vtx.size());\n     for (const auto& tx : vtx)\n     {\n         txiter it = mapTx.find(tx->GetHash());\n         if (it != mapTx.end()) {\n-            setEntries stage;\n-            stage.insert(it);\n-            RemoveStaged(stage, true, MemPoolRemovalReason::BLOCK);\n+            NewMempoolTransactionInfo tx_info = {\n+                .m_tx = it->GetSharedTx(),\n+                .m_parents = it->GetMemPoolParentsCopy(),\n+                .m_fee = it->GetFee(),\n+                .m_virtual_transaction_size = it->GetTxSize(),\n+                .txHeight = it->GetHeight(),\n+                .nSizeWithAncestors = it->GetSizeWithAncestors(),\n+                .nModFeesWithAncestors = it->GetModFeesWithAncestors()};\n+            txs_removed_for_block.push_back(tx_info);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376404497",
      "id" : 1376404497,
      "line" : 647,
      "node_id" : "PRRC_kwDOABII585SCkQR",
      "original_commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "original_line" : 647,
      "original_position" : 103,
      "original_start_line" : 639,
      "path" : "src/txmempool.cpp",
      "position" : 103,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376404497/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 639,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376404497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376411380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376411380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's quite confusing to store info about a transaction that isn't new and isn't in the mempool in a struct called `NewMempoolTransactionInfo`. It also has fields that don't apply to a removed transaction - we aren't able to populate any of the validforfeeestimate bools. Why not make separate structs for newly added transactions and removed transactions?",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-10-30T15:26:49Z",
      "diff_hunk" : "@@ -131,9 +132,18 @@ class CValidationInterface {\n      * Called on a background thread.\n      */\n     virtual void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason, uint64_t mempool_sequence) {}\n+    /* Notifies listeners of transactions removed from the mempool as\n+     * as a result of new block being connected.\n+     * MempoolTransactionsRemovedForConnectedBlock will be fired before BlockConnected.\n+     *\n+     * Called on a background thread.\n+     */\n+    virtual void MempoolTransactionsRemovedForConnectedBlock(const std::vector<NewMempoolTransactionInfo>& txs_removed_for_block, unsigned int nBlockHeight) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376411380",
      "id" : 1376411380,
      "line" : 141,
      "node_id" : "PRRC_kwDOABII585SCl70",
      "original_commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "original_line" : 141,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : 49,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376411380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376411380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376840119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376840119"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nitty nit: Inconsistent with closing bracket placement.",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T21:52:05Z",
      "diff_hunk" : "@@ -56,12 +70,21 @@ FUZZ_TARGET(policy_estimator, .init = initialize_policy_estimator)\n                     const CTransaction tx{*mtx};\n                     mempool_entries.push_back(ConsumeTxMemPoolEntry(fuzzed_data_provider, tx));\n                 }\n-                std::vector<const CTxMemPoolEntry*> ptrs;\n-                ptrs.reserve(mempool_entries.size());\n+                std::vector<NewMempoolTransactionInfo> txs;\n+                txs.reserve(mempool_entries.size());\n                 for (const CTxMemPoolEntry& mempool_entry : mempool_entries) {\n-                    ptrs.push_back(&mempool_entry);\n+                    NewMempoolTransactionInfo tx_info = {\n+                        .m_tx = mempool_entry.GetSharedTx(),\n+                        .m_parents = mempool_entry.GetMemPoolParentsCopy(),\n+                        .m_fee = mempool_entry.GetFee(),\n+                        .m_virtual_transaction_size = mempool_entry.GetTxSize(),\n+                        .txHeight = mempool_entry.GetHeight(),\n+                        .nSizeWithAncestors = mempool_entry.GetSizeWithAncestors(),\n+                        .nModFeesWithAncestors = mempool_entry.GetModFeesWithAncestors(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376840119",
      "id" : 1376840119,
      "line" : 83,
      "node_id" : "PRRC_kwDOABII585SEOm3",
      "original_commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "original_line" : 83,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/test/fuzz/policy_estimator.cpp",
      "position" : 47,
      "pull_request_review_id" : 1705133591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376840119/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T21:59:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376840119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376840676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376840676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: There is trailing whitespace here in commit 5ab08d23b2e88c1a8fda1535114e04b695c3483b. Also, why remove the const qualifier? Can't all the `tx_info` be made `const`?",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-30T21:52:53Z",
      "diff_hunk" : "@@ -41,7 +42,20 @@ FUZZ_TARGET(policy_estimator, .init = initialize_policy_estimator)\n                     return;\n                 }\n                 const CTransaction tx{*mtx};\n-                block_policy_estimator.processTransaction(ConsumeTxMemPoolEntry(fuzzed_data_provider, tx), fuzzed_data_provider.ConsumeBool());\n+                const CTxMemPoolEntry entry = ConsumeTxMemPoolEntry(fuzzed_data_provider, tx);\n+                NewMempoolTransactionInfo tx_info = {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1376840676",
      "id" : 1376840676,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII585SEOvk",
      "original_commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "original_line" : 46,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/policy_estimator.cpp",
      "position" : 14,
      "pull_request_review_id" : 1705133591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376840676/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-30T21:59:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1376840676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1377597617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1377597617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thank you, Will update if there is need to re touch.",
      "commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "created_at" : "2023-10-31T13:35:41Z",
      "diff_hunk" : "@@ -41,7 +42,20 @@ FUZZ_TARGET(policy_estimator, .init = initialize_policy_estimator)\n                     return;\n                 }\n                 const CTransaction tx{*mtx};\n-                block_policy_estimator.processTransaction(ConsumeTxMemPoolEntry(fuzzed_data_provider, tx), fuzzed_data_provider.ConsumeBool());\n+                const CTxMemPoolEntry entry = ConsumeTxMemPoolEntry(fuzzed_data_provider, tx);\n+                NewMempoolTransactionInfo tx_info = {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1377597617",
      "id" : 1377597617,
      "in_reply_to_id" : 1376840676,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII585SHHix",
      "original_commit_id" : "59db4d1739de1a008e6f34d0f03c3e8e8da60a93",
      "original_line" : 46,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/policy_estimator.cpp",
      "position" : 14,
      "pull_request_review_id" : 1706322055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1377597617/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-31T13:35:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1377597617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems like with the changes here, the `policy/fees` can be removed the kernel library. If you want to, you can integrate this [one-line commit](https://github.com/TheCharlatan/bitcoin/commit/32846141df1a2e110f84f3244d5e98626d379185), otherwise I'll make a tiny follow up.",
      "created_at" : "2023-11-01T20:07:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#issuecomment-1789598015",
      "id" : 1789598015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
      "node_id" : "IC_kwDOABII585qqxk_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789598015/reactions"
      },
      "updated_at" : "2023-11-01T20:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789598015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380264004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380264004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: This log should probably say \"num txs removed=\" instead of \"txs=\".",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T14:45:57Z",
      "diff_hunk" : "@@ -214,6 +214,16 @@ void CMainSignals::TransactionAddedToMempool(const CTransactionRef& tx, uint64_t\n                           tx->GetWitnessHash().ToString());\n }\n \n+void CMainSignals::MempoolTransactionsRemovedForConnectedBlock(const std::vector<CTransactionRef>& txs_removed_for_block, unsigned int nBlockHeight)\n+{\n+    auto event = [txs_removed_for_block, nBlockHeight, this] {\n+        m_internals->Iterate([&](CValidationInterface& callbacks) { callbacks.MempoolTransactionsRemovedForConnectedBlock(txs_removed_for_block, nBlockHeight); });\n+    };\n+    ENQUEUE_AND_LOG_EVENT(event, \"%s: block height=%s txs=%s\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380264004",
      "id" : 1380264004,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585SRShE",
      "original_commit_id" : "4986edb99f8aa73f72e87f3bdc09387c3e516197",
      "original_line" : 222,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/validationinterface.cpp",
      "position" : 32,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380264004/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380264004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380269895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380269895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bb22a5148af0f8aad3d8e7b242cc65fe6dd4ced9 this is missing a doxygen comment ",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T14:49:46Z",
      "diff_hunk" : "@@ -176,4 +176,21 @@ class CTxMemPoolEntry\n     mutable Epoch::Marker m_epoch_marker; //!< epoch when last touched, useful for graph algorithms\n };\n \n+struct NewMempoolTransactionInfo {\n+    CTransactionRef m_tx;\n+    /* The fee the added transaction paid */\n+    CAmount m_fee;\n+    /**\n+     * The virtual transaction size.\n+     *\n+     * This is a policy field which considers the sigop cost of the\n+     * transaction as well as its weight, and reinterprets it as bytes.\n+     *\n+     * It is the primary metric by which the mining algorithm selects\n+     * transactions.\n+     */\n+    int64_t m_virtual_transaction_size;\n+    unsigned int txHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380269895",
      "id" : 1380269895,
      "line" : 203,
      "node_id" : "PRRC_kwDOABII585SRT9H",
      "original_commit_id" : "bb22a5148af0f8aad3d8e7b242cc65fe6dd4ced9",
      "original_line" : 203,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 34,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380269895/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380269895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380273335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380273335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f03720ee9962b3c4657cd59ce1ea2125ec9b1cbe\r\n\r\nwhat is the purpose of adding `m_fee_per_k` here? it adds 64b to every `TxStatsInfo` we store (note that there is one for every unconfirmed transaction). You can get the same information from the `NewMempoolTransactionInfo` in `processBlock`.",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T14:51:56Z",
      "diff_hunk" : "@@ -272,6 +274,7 @@ class CBlockPolicyEstimator\n     {\n         unsigned int blockHeight{0};\n         unsigned int bucketIndex{0};\n+        CAmount m_fee_per_k;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380273335",
      "id" : 1380273335,
      "line" : 287,
      "node_id" : "PRRC_kwDOABII585SRUy3",
      "original_commit_id" : "f03720ee9962b3c4657cd59ce1ea2125ec9b1cbe",
      "original_line" : 287,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 74,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380273335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380273335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380283948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380283948"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're making this const in 9b0843042ab5c30e6ef4753d590c69c4811d9a70 - why not just introduce it as const?",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T14:58:48Z",
      "diff_hunk" : "@@ -634,7 +637,7 @@ bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTra\n }\n \n void CBlockPolicyEstimator::processBlock(unsigned int nBlockHeight,\n-                                         std::vector<CTransactionRef>& txs_removed_for_block)\n+                                         const std::vector<CTransactionRef>& txs_removed_for_block)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380283948",
      "id" : 1380283948,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SRXYs",
      "original_commit_id" : "9b0843042ab5c30e6ef4753d590c69c4811d9a70",
      "original_line" : 640,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380283948/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380283948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380289810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380289810"
         }
      },
      "author_association" : "MEMBER",
      "body" : "9b0843042ab5c30e6ef4753d590c69c4811d9a70 seems to be doing multiple things: (1) making `CBlockPolicyEstimator` react to validationinterface and (2) delegating the `validForFeeEstimation` from validation to the `CBlockPolicyEstimator` by providing these bools in the `TransactionAddedToMempool` signal (but this isn't fully done until the next commit which cleans things up).\r\n\r\nThese should be separate commits, e.g. (2) and then (1).",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T15:02:44Z",
      "diff_hunk" : "@@ -191,6 +191,10 @@ struct NewMempoolTransactionInfo {\n      */\n     int64_t m_virtual_transaction_size;\n     unsigned int txHeight;\n+    bool m_from_disconnected_block;\n+    bool m_submitted_in_package;\n+    bool m_chainstate_is_current;\n+    bool m_has_no_mempool_parents;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380289810",
      "id" : 1380289810,
      "line" : 209,
      "node_id" : "PRRC_kwDOABII585SRY0S",
      "original_commit_id" : "9b0843042ab5c30e6ef4753d590c69c4811d9a70",
      "original_line" : 197,
      "original_position" : 7,
      "original_start_line" : 194,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 40,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380289810/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 206,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380289810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380307655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380307655"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is quite verbose and repeated in several places. Why not create a dedicated constructor?",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T15:12:07Z",
      "diff_hunk" : "@@ -1214,11 +1214,16 @@ bool MemPoolAccept::SubmitPackage(const ATMPArgs& args, std::vector<Workspace>&\n         results.emplace(ws.m_ptx->GetWitnessHash(),\n                         MempoolAcceptResult::Success(std::move(ws.m_replaced_transactions), ws.m_vsize,\n                                          ws.m_base_fees, effective_feerate, effective_feerate_wtxids));\n+        const CTransaction& tx = *ws.m_ptx;\n         const NewMempoolTransactionInfo tx_info = {\n             .m_tx = ws.m_ptx,\n             .m_fee = ws.m_base_fees,\n             .m_virtual_transaction_size = ws.m_vsize,\n-            .txHeight = ws.m_entry->GetHeight()};\n+            .txHeight = ws.m_entry->GetHeight(),\n+            .m_from_disconnected_block = args.m_bypass_limits,\n+            .m_submitted_in_package = args.m_package_submission,\n+            .m_chainstate_is_current = IsCurrentForFeeEstimation(m_active_chainstate),\n+            .m_has_no_mempool_parents = m_pool.HasNoInputsOf(tx)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380307655",
      "id" : 1380307655,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SRdLH",
      "original_commit_id" : "9b0843042ab5c30e6ef4753d590c69c4811d9a70",
      "original_line" : 1226,
      "original_position" : 14,
      "original_start_line" : 1217,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380307655/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380307655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380314393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380314393"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function is newly added in 4986edb99f8aa73f72e87f3bdc09387c3e516197 and then changed in 863d46751900a0c69c4f7fbd92d4d8a651b2cc7b",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T15:16:40Z",
      "diff_hunk" : "@@ -131,9 +131,18 @@ class CValidationInterface {\n      * Called on a background thread.\n      */\n     virtual void TransactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRemovalReason reason, uint64_t mempool_sequence) {}\n+    /* Notifies listeners of transactions removed from the mempool as\n+     * as a result of new block being connected.\n+     * MempoolTransactionsRemovedForConnectedBlock will be fired before BlockConnected.\n+     *\n+     * Called on a background thread.\n+     */\n+    virtual void MempoolTransactionsRemovedForConnectedBlock(const std::vector<CTransactionRef>& txs_removed_for_block, unsigned int nBlockHeight) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380314393",
      "id" : 1380314393,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SRe0Z",
      "original_commit_id" : "4986edb99f8aa73f72e87f3bdc09387c3e516197",
      "original_line" : 140,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/validationinterface.h",
      "position" : null,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380314393/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380314393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380320875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380320875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "863d46751900a0c69c4f7fbd92d4d8a651b2cc7b why are you making the element type const?",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T15:18:40Z",
      "diff_hunk" : "@@ -68,10 +70,18 @@ FUZZ_TARGET(policy_estimator, .init = initialize_policy_estimator)\n                     const CTransaction tx{*mtx};\n                     mempool_entries.push_back(ConsumeTxMemPoolEntry(fuzzed_data_provider, tx));\n                 }\n-                std::vector<CTransactionRef> txs;\n+                std::vector<const NewMempoolTransactionInfo> txs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380320875",
      "id" : 1380320875,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SRgZr",
      "original_commit_id" : "863d46751900a0c69c4f7fbd92d4d8a651b2cc7b",
      "original_line" : 73,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/fuzz/policy_estimator.cpp",
      "position" : null,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380320875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380320875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380331021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380331021"
         }
      },
      "author_association" : "MEMBER",
      "body" : "These fields added in 53bbc791d47a51a7c2bbefb32835fd4001b68890 aren't necessary as you're not using them anywhere. At quick glance I don't think we should ever tell the fee estimator about *modified* fees.",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T15:25:24Z",
      "diff_hunk" : "@@ -191,6 +201,8 @@ struct NewMempoolTransactionInfo {\n      */\n     int64_t m_virtual_transaction_size;\n     unsigned int txHeight;\n+    int64_t nSizeWithAncestors;\n+    CAmount nModFeesWithAncestors;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380331021",
      "id" : 1380331021,
      "line" : 205,
      "node_id" : "PRRC_kwDOABII585SRi4N",
      "original_commit_id" : "53bbc791d47a51a7c2bbefb32835fd4001b68890",
      "original_line" : 205,
      "original_position" : 29,
      "original_start_line" : 204,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 36,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380331021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 204,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380331021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380347559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380347559"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok, I think this should be its own commit with this explanation as it is not relevant to refactoring `processBlock`",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T15:36:35Z",
      "diff_hunk" : "@@ -481,13 +481,16 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     // We increment mempool sequence value no matter removal reason\n     // even if not directly reported below.\n     uint64_t mempool_sequence = GetAndIncrementSequence();\n-\n+    const uint256 hash = it->GetTx().GetHash();\n     if (reason != MemPoolRemovalReason::BLOCK) {\n         // Notify clients that a transaction has been removed from the mempool\n         // for any reason except being included in a block. Clients interested\n         // in transactions included in blocks can subscribe to the BlockConnected\n         // notification.\n         GetMainSignals().TransactionRemovedFromMempool(it->GetSharedTx(), reason, mempool_sequence);\n+        if (minerPolicyEstimator) {\n+            minerPolicyEstimator->removeTx(hash, false);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380347559",
      "id" : 1380347559,
      "in_reply_to_id" : 1311941008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SRm6n",
      "original_commit_id" : "4f22c0da092e1c2287e4bc2d84e646d56abbe133",
      "original_line" : 493,
      "original_position" : 14,
      "original_start_line" : 491,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1704427495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380347559/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T15:44:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380347559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380403135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380403135"
         }
      },
      "author_association" : "MEMBER",
      "body" : "these fields were added to solve silent merge conflict https://github.com/bitcoin/bitcoin/pull/25380#issuecomment-1713512238 , but you are right they should be added when needed.",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T16:13:27Z",
      "diff_hunk" : "@@ -191,6 +201,8 @@ struct NewMempoolTransactionInfo {\n      */\n     int64_t m_virtual_transaction_size;\n     unsigned int txHeight;\n+    int64_t nSizeWithAncestors;\n+    CAmount nModFeesWithAncestors;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380403135",
      "id" : 1380403135,
      "in_reply_to_id" : 1380331021,
      "line" : 205,
      "node_id" : "PRRC_kwDOABII585SR0e_",
      "original_commit_id" : "53bbc791d47a51a7c2bbefb32835fd4001b68890",
      "original_line" : 205,
      "original_position" : 29,
      "original_start_line" : 204,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 36,
      "pull_request_review_id" : 1710715063,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380403135/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 204,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-11-02T16:13:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380403135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380403540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380403540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is fixed in latest push.",
      "commit_id" : "6d676c69195dc9032c4558987fb88f4c4b71092c",
      "created_at" : "2023-11-02T16:13:49Z",
      "diff_hunk" : "@@ -68,10 +70,18 @@ FUZZ_TARGET(policy_estimator, .init = initialize_policy_estimator)\n                     const CTransaction tx{*mtx};\n                     mempool_entries.push_back(ConsumeTxMemPoolEntry(fuzzed_data_provider, tx));\n                 }\n-                std::vector<CTransactionRef> txs;\n+                std::vector<const NewMempoolTransactionInfo> txs;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28368#discussion_r1380403540",
      "id" : 1380403540,
      "in_reply_to_id" : 1380320875,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585SR0lU",
      "original_commit_id" : "863d46751900a0c69c4f7fbd92d4d8a651b2cc7b",
      "original_line" : 73,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/fuzz/policy_estimator.cpp",
      "position" : null,
      "pull_request_review_id" : 1710716174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380403540/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-02T16:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380403540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   }
]
