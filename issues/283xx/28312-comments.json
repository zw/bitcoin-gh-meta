[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-08-22T01:33:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#issuecomment-1687280270",
      "id" : 1687280270,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28312",
      "node_id" : "IC_kwDOABII585kkdqO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1687280270/reactions"
      },
      "updated_at" : "2023-08-22T01:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1687280270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe add a functional test that would have failed too?",
      "created_at" : "2023-08-23T17:35:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#issuecomment-1690367321",
      "id" : 1690367321,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28312",
      "node_id" : "IC_kwDOABII585kwPVZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1690367321/reactions"
      },
      "updated_at" : "2023-08-23T17:35:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1690367321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Maybe add a functional test that would have failed too?\r\n\r\nYeah, seems like a good idea. Added one in `rpc_createmultisig` which checks that the multisig script encoding (returned as 'redeemScript') is as expected for all possible n (1..20), only using n-of-n for now to keep it simple.",
      "created_at" : "2023-08-23T22:14:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#issuecomment-1690714844",
      "id" : 1690714844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28312",
      "node_id" : "IC_kwDOABII585kxkLc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 1,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1690714844/reactions"
      },
      "updated_at" : "2023-08-23T22:14:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1690714844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530162458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530162458"
         }
      },
      "author_association" : "NONE",
      "body" : "Should we add a comment explaining the logic behind the math in these script length assert calls?\r\nOr maybe refer an existing doc?",
      "commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "created_at" : "2024-03-19T11:12:30Z",
      "diff_hunk" : "@@ -122,3 +126,19 @@ def check_script(script):\n     if isinstance(script, bytes) or isinstance(script, CScript):\n         return script\n     assert False\n+\n+\n+class TestFrameworkScriptUtil(unittest.TestCase):\n+    def test_multisig(self):\n+        fake_pubkey = bytes([0]*33)\n+        # check correct encoding of P2MS script with n,k <= 16\n+        normal_ms_script = keys_to_multisig_script([fake_pubkey]*16, k=15)\n+        self.assertEqual(len(normal_ms_script), 1 + 16*34 + 1 + 1)\n+        self.assertTrue(normal_ms_script.startswith(bytes([OP_15])))\n+        self.assertTrue(normal_ms_script.endswith(bytes([OP_16, OP_CHECKMULTISIG])))\n+\n+        # check correct encoding of P2MS script with n,k > 16\n+        max_ms_script = keys_to_multisig_script([fake_pubkey]*20, k=19)\n+        self.assertEqual(len(max_ms_script), 2 + 20*34 + 2 + 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530162458",
      "id" : 1530162458,
      "line" : 142,
      "node_id" : "PRRC_kwDOABII585bNG0a",
      "original_commit_id" : "a36ad0cb1d79999268345901b0889fc4f05556c5",
      "original_line" : 142,
      "original_position" : 31,
      "original_start_line" : 136,
      "path" : "test/functional/test_framework/script_util.py",
      "position" : 44,
      "pull_request_review_id" : 1945878720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530162458/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 136,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T11:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530162458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530170475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170475"
         }
      },
      "author_association" : "NONE",
      "body" : "Nit: Checking for integers between 15 and 17 would also suffice, right?",
      "commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "created_at" : "2024-03-19T11:19:14Z",
      "diff_hunk" : "@@ -118,6 +119,16 @@ def run_test(self):\n         # Check that bech32m is currently not allowed\n         assert_raises_rpc_error(-5, \"createmultisig cannot create bech32m multisig addresses\", self.nodes[0].createmultisig, 2, self.pub, \"bech32m\")\n \n+        self.log.info('Check correct encoding of multisig script for all n (1..20)')\n+        for nkeys in range(1, 20+1):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530170475",
      "id" : 1530170475,
      "line" : 123,
      "node_id" : "PRRC_kwDOABII585bNIxr",
      "original_commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "original_line" : 123,
      "original_position" : 13,
      "original_start_line" : 122,
      "path" : "test/functional/rpc_createmultisig.py",
      "position" : 13,
      "pull_request_review_id" : 1945878720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170475/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 122,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T11:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530170800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170800"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks for adding the comment, helpful!",
      "commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "created_at" : "2024-03-19T11:19:32Z",
      "diff_hunk" : "@@ -118,6 +119,16 @@ def run_test(self):\n         # Check that bech32m is currently not allowed\n         assert_raises_rpc_error(-5, \"createmultisig cannot create bech32m multisig addresses\", self.nodes[0].createmultisig, 2, self.pub, \"bech32m\")\n \n+        self.log.info('Check correct encoding of multisig script for all n (1..20)')\n+        for nkeys in range(1, 20+1):\n+            keys = [self.pub[0]]*nkeys\n+            expected_ms_script = keys_to_multisig_script(keys, k=nkeys)  # simply use n-of-n\n+            # note that the 'legacy' address type fails for n values larger than 15\n+            # due to exceeding the P2SH size limit (520 bytes), so we use 'bech32' instead\n+            # (for the purpose of this encoding test, we don't care about the resulting address)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530170800",
      "id" : 1530170800,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585bNI2w",
      "original_commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "original_line" : 128,
      "original_position" : 18,
      "original_start_line" : 126,
      "path" : "test/functional/rpc_createmultisig.py",
      "position" : 18,
      "pull_request_review_id" : 1945878720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 126,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T11:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530184418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530184418"
         }
      },
      "author_association" : "NONE",
      "body" : "Curious: Is it common to test the correctness of a test utility function against the response from the bitcoin node?",
      "commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "created_at" : "2024-03-19T11:30:33Z",
      "diff_hunk" : "@@ -118,6 +119,16 @@ def run_test(self):\n         # Check that bech32m is currently not allowed\n         assert_raises_rpc_error(-5, \"createmultisig cannot create bech32m multisig addresses\", self.nodes[0].createmultisig, 2, self.pub, \"bech32m\")\n \n+        self.log.info('Check correct encoding of multisig script for all n (1..20)')\n+        for nkeys in range(1, 20+1):\n+            keys = [self.pub[0]]*nkeys\n+            expected_ms_script = keys_to_multisig_script(keys, k=nkeys)  # simply use n-of-n",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28312#discussion_r1530184418",
      "id" : 1530184418,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII585bNMLi",
      "original_commit_id" : "d113709dc4e68535605d22814ea987b55469bd32",
      "original_line" : 125,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/rpc_createmultisig.py",
      "position" : 15,
      "pull_request_review_id" : 1945913192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28312",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530184418/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-19T11:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530184418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   }
]
