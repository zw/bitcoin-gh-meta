[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. \r\n\r\nThis fixes the crashing case in #16087, however I think we could make a more extensive change, as even with this fix it's still possible to cause a crash via the other menus. \r\n\r\ni.e: if you open Window -> Console and try and execute any command (can be garbage) `bitcoin-qt` will crash:\r\n```bash\r\nOn branch pull/16118/local-merge\r\n\r\nProcess 89287 launched: '/Users/michael/github/bitcoin/src/qt/bitcoin-qt' (x86_64)\r\n2019-05-29 09:57:56.276746-0400 bitcoin-qt[89287:939924] MessageTracer: Falling back to default whitelist\r\nProcess 89287 stopped\r\n* thread #1, name = 'bitcoin-main', queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x8)\r\n    frame #0: 0x00000001015158ba QtWidgets`QCompleter::popup() const + 10\r\nQtWidgets`QCompleter::popup:\r\n->  0x1015158ba <+10>: movq   0x8(%rdi), %rbx\r\n    0x1015158be <+14>: movq   0x88(%rbx), %rax\r\n    0x1015158c5 <+21>: testq  %rax, %rax\r\n    0x1015158c8 <+24>: jne    0x101515942               ; <+146>\r\nTarget 0: (bitcoin-qt) stopped.\r\n```\r\n",
      "created_at" : "2019-05-29T14:09:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-496952931",
      "id" : 496952931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5Njk1MjkzMQ==",
      "updated_at" : "2019-05-29T14:09:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496952931",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "tACK https://github.com/bitcoin/bitcoin/pull/16122/commits/2d8ad2f99710a8981e33fe2d6ce834b0076c4e80 on macOS\r\n\r\nUsing master (https://github.com/bitcoin/bitcoin/commit/c7cfd20a77ce57d200b3b9e5e0dfb0d63818abdc) you can trigger a crash by mousing over the `File` -> `Open Wallet` menu during startup:\r\n```bash\r\n./autogen.sh && ./configure && make check -j6 && make deploy\r\nlldb Bitcoin-Qt.app\r\n(lldb) target create \"Bitcoin-Qt.app\"\r\nCurrent executable set to 'Bitcoin-Qt.app' (x86_64).\r\n(lldb) run\r\nProcess 35368 launched: '/Users/michael/github/bitcoin/Bitcoin-Qt.app/Contents/MacOS/Bitcoin-Qt' (x86_64)\r\n2019-05-31 09:12:37.511797-0400 Bitcoin-Qt[35368:3580703] MessageTracer: Falling back to default whitelist\r\nProcess 35368 stopped\r\n* thread #1, name = 'bitcoin-main', queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x38)\r\n    frame #0: 0x000000010192fb8e QtCore`QMutex::lock() + 14\r\nQtCore`QMutex::lock:\r\n->  0x10192fb8e <+14>: lock   \r\n    0x10192fb8f <+15>: cmpxchgq %rcx, (%rdi)\r\n    0x10192fb93 <+19>: je     0x10192fba8               ; <+40>\r\n    0x10192fb95 <+21>: movq   %rax, %rbx\r\nTarget 0: (Bitcoin-Qt) stopped.\r\n```\r\n\r\nUsing this PR (https://github.com/bitcoin/bitcoin/pull/16118/commits/75485ef0962a53946f17b761c4445627b07e6eff) the `File` menu items are disabled during startup:\r\n```bash\r\nmerge 16118\r\nmake check -j6 && make deploy\r\nlldb Bitcoin-Qt.app\r\n```\r\n![disabled menu](https://user-images.githubusercontent.com/863730/58708680-7303dc80-8386-11e9-8d97-a10510118995.png)\r\n\r\nThe other crash I mentioned above is being fixed separately in #16122.",
      "created_at" : "2019-05-31T13:32:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-497709833",
      "id" : 497709833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NzcwOTgzMw==",
      "updated_at" : "2019-05-31T13:32:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/497709833",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 75485ef0962a53946f17b761c4445627b07e6eff",
      "created_at" : "2019-06-12T08:33:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-501174858",
      "id" : 501174858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMTE3NDg1OA==",
      "updated_at" : "2019-06-12T08:33:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/501174858",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@promag, you mentioned that this change caused a bug listing wallets in #16230 (fixed in #16231), that you, me, jonas, and fanquake all didn't notice during review.\r\n\r\nCould you explain how this PR caused the bug? Also, it'd be good to know if you have any suggestions for things we should look for during reviews, or better ways to structure code to prevent initialization bugs in the future.",
      "created_at" : "2019-06-18T14:19:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-503156728",
      "id" : 503156728,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzE1NjcyOA==",
      "updated_at" : "2019-06-18T14:19:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503156728",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Like you said [above](https://github.com/bitcoin/bitcoin/pull/16118#pullrequestreview-248851975), and considering this was already a fix to another problem, at the time I didn't pay attention to remaining functionality. I guess other reviewers made the same mistake. Ideally we should have tests to prevent regressions like you say in #16075.\r\n\r\nWith this change the following\r\nhttps://github.com/bitcoin/bitcoin/blob/e2182b02b5af13f0de38cf8b08bb81723387c570/src/qt/bitcoingui.cpp#L371\r\nis worthless as the menu is only created and set later on `setWalletController`.\r\n\r\nI'm a bit surprised it works because (haven't checked for runtime warnings though) `->menu()` is null. The result is that the menu is never updated.\r\n\r\nNot sure if there's a way to abort if `QObject::connect()` is called with `nullptr`.",
      "created_at" : "2019-06-18T14:40:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-503166407",
      "id" : 503166407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzE2NjQwNw==",
      "updated_at" : "2019-06-18T14:41:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503166407",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the explanation, that makes a lot of sense. I agree it's is odd that Qt doesn't complain about trying to connect to a signal from a null object. In retrospect, I guess if we see a change delaying initialization like this (delaying `m_open_wallet_action->setMenu()`), a good thing to do would be to scroll down and make sure the uninitialized object (`m_open_wallet_action->menu()`) is not used in the meantime.",
      "created_at" : "2019-06-18T14:59:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-503175115",
      "id" : 503175115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzE3NTExNQ==",
      "updated_at" : "2019-06-18T14:59:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503175115",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky actually running with `-debug` it shows a warning:\r\n```\r\n2019-06-18T15:16:13Z GUI: QObject::connect(QMenu, Unknown): invalid null parameter\r\n```",
      "created_at" : "2019-06-18T15:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-503182614",
      "id" : 503182614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzE4MjYxNA==",
      "updated_at" : "2019-06-18T15:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503182614",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky So after some googling a suggestion is to run like:\r\n```\r\nQT_FATAL_WARNINGS=1 lldb src/qt/bitcoin-qt -- --regtest -debug\r\n...\r\nbt\r\n...\r\n* thread #1, name = 'bitcoin-main', queue = 'com.apple.main-thread', stop reason = signal SIGABRT\r\n  * frame #0: 0x00007fff653d823e libsystem_kernel.dylib`__pthread_kill + 10\r\n    frame #1: 0x00007fff6548ec1c libsystem_pthread.dylib`pthread_kill + 285\r\n    frame #2: 0x00007fff653411c9 libsystem_c.dylib`abort + 127\r\n    frame #3: 0x0000000101c2e2d9 QtCore`___lldb_unnamed_symbol169$$QtCore + 9\r\n    frame #4: 0x0000000101c2ee0b QtCore`QMessageLogger::warning(char const*, ...) const + 241\r\n    frame #5: 0x0000000101e328ff QtCore`QObjectPrivate::connectImpl(QObject const*, int, QObject const*, void**, QtPrivate::QSlotObjectBase*, Qt::ConnectionType, int const*, QMetaObject const*) + 863\r\n    frame #6: 0x0000000101e32507 QtCore`QObject::connectImpl(QObject const*, void**, QObject const*, void**, QtPrivate::QSlotObjectBase*, Qt::ConnectionType, int const*, QMetaObject const*) + 359\r\n    frame #7: 0x000000010001af79 bitcoin-qt`BitcoinGUI::createActions() [inlined] std::__1::enable_if<(QtPrivate::FunctionPointer<BitcoinGUI::createActions()::$_14>::ArgumentCount) == (-(1)), QMetaObject::Connection>::type QObject::connect<void (sender=0x0000000000000000, context=0x0000000000000000, slot=<unavailable>, type=DirectConnection)(), BitcoinGUI::createActions()::$_14>(QtPrivate::FunctionPointer<void (QMenu::*)()>::Object const*, void (QMenu::*)(), QObject const*, BitcoinGUI::createActions()::$_14, Qt::ConnectionType) at qobject.h:329:16 [opt]\r\n    frame #8: 0x000000010001af1f bitcoin-qt`BitcoinGUI::createActions() [inlined] std::__1::enable_if<(QtPrivate::FunctionPointer<BitcoinGUI::createActions()::$_14>::ArgumentCount) == (-(1)), QMetaObject::Connection>::type QObject::connect<void (sender=0x0000000000000000, signal=00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00, slot=<unavailable>)(), BitcoinGUI::createActions()::$_14>(QtPrivate::FunctionPointer<void (QMenu::*)()>::Object const*, void (QMenu::*)(), BitcoinGUI::createActions()::$_14) at qobject.h:302 [opt]\r\n    frame #9: 0x000000010001af1f bitcoin-qt`BitcoinGUI::createActions(this=0x0000000102b4d700) at bitcoingui.cpp:371 [opt]\r\n    frame #10: 0x000000010001732c bitcoin-qt`BitcoinGUI::BitcoinGUI(this=0x0000000102b4d700, node=0x00000001029d7a40, _platformStyle=0x0000000102d81e70, networkStyle=<unavailable>, parent=<unavailable>) at bitcoingui.cpp:120:5 [opt]\r\n    frame #11: 0x000000010000abe4 bitcoin-qt`BitcoinApplication::createWindow(this=0x00007ffeefbff660, networkStyle=<unavailable>) at bitcoin.cpp:239:18 [opt]\r\n    frame #12: 0x000000010000d2cd bitcoin-qt`GuiMain(argc=<unavailable>, argv=<unavailable>) at bitcoin.cpp:569:13 [opt]\r\n    frame #13: 0x00007fff65298ed9 libdyld.dylib`start + 1\r\n```\r\nWhich clearly shows the problem. Going to add this to doc/productivity.md.",
      "created_at" : "2019-06-18T15:22:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16118#issuecomment-503184695",
      "id" : 503184695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16118",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzE4NDY5NQ==",
      "updated_at" : "2019-06-18T15:38:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503184695",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   }
]
