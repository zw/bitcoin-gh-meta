[
   {
      "body" : "I don't think -noconnect was ever supported as a valid option.",
      "created_at" : "2012-08-09T01:40:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-7603086",
      "id" : 7603086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-08-09T01:40:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7603086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "As Luke says, that wasn't an intended option as far as I know. But it sounds like a reasonable thing to support, though we should probably also audit the other cases were a no wasn't really anticipated.",
      "created_at" : "2012-08-09T01:48:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-7603214",
      "id" : 7603214,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-08-09T01:48:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7603214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "This also appears to happen when it simply has no nodes to connect to, even without -noconnect.  In my case I have a testnet node that has no addresses to connect to, so it keeps cycling through them and the \"bitcoin-opencon\" thread takes a lot of CPU time.\n\nIn my case, it keeps selecting the same peer every half a second (with a nonstandard port #, so after 50 tries), trying to connect to it:\n\n    trying connection XX.XX.XX.XX:18334 lastseen=1542.8hrs\n    connect() failed after select(): Connection refused\n\nNot yet sure why that takes so much CPU usage %, though, as the thread sleeps mostly.\n\nEdit: According to callgrind, most time is spent inside CAddrMan::Select(int), calling CAddrMan::Select_(int), calling GetRandInt(int). \n\nIs that random function so expensive? I think so, after changing to simply use rand(), putting at the top of addrman.cpp a hack\n\n    #define GetRandInt(x) (rand()%(x))\n\nThe CPU usage dropped back to 4% only. Still significant, but not close to holding up a core. Using rand might be good enough here, as there is no need for cryptographically secure number here. See also issue #1057.\n\nAnyway, using something like exponential backoff in the connection thread is probably the real fix. Just wanted to know why peer selection was so expensive.\n\n",
      "created_at" : "2012-08-18T11:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-7843758",
      "id" : 7843758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-08-18T12:39:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/7843758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Is this fixed in 0.7.0?\n",
      "created_at" : "2012-09-19T06:50:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8680801",
      "id" : 8680801,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-19T06:50:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8680801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "It doesn't use 100% CPU, but it doesn't work either - it still tries to connect:\n\n    (gdb) run -server -nolisten -noconnect\n    [...]\n    Bitcoin version v0.7.0rc3-dirty-beta (2012-09-12 14:07:22 -0400)\n    [...]\n    trying connection 92.240.248.99:8333 lastseen=2.7hrs\n    connected 92.240.248.99:8333\n",
      "created_at" : "2012-09-19T18:15:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8700825",
      "id" : 8700825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-19T18:15:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8700825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "I see Pieter's commit fixing the 100% CPU bug in the 0.7.0 code:\n\n    commit f161a2c2114cd7d950248ce75a91ba1923e9abb1\n    Author: Pieter Wuille <pieter.wuille@gmail.com>\n    Date:   Tue Aug 21 17:32:04 2012 +0200\n    \n        Fix infinite loops in connection logic\n\nbut nothing implementing \"-noconnect\" (which apparently was never intended to work anyway).",
      "created_at" : "2012-09-19T18:19:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8700945",
      "id" : 8700945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-19T18:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8700945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "Since -connect=X means \"connect only to X\", -noconnect would mean \"don't just connect to one peer\", which is exactly what it does :)\n\nOk, I admit, it wasn't ever considered.",
      "created_at" : "2012-09-19T22:11:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8710056",
      "id" : 8710056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-19T22:11:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8710056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "`-noconnect` makes no sense. But aren't there other ways already to say \"don't connect to any peers\", or limit the number of outgoing connections? \n\n\n",
      "created_at" : "2012-09-21T11:54:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8762276",
      "id" : 8762276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-21T11:54:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8762276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I've used \"-connect=127.0.0.1\" in the past to get no connections.\n\nI'm wondering whether \"-maxconnections=0\" would work too:\n\n    Starting program: /home/chris/Bin/bitcoin -maxconnections=0\n    [...]\n    Bitcoin version v0.7.0rc3-dirty-beta (2012-09-12 14:07:22 -0400)\n    [...]\n    send version message: version 60002, blocks=199858, us=0.0.0.0:0, them=0.0.0.0:0, peer=127.0.0.1:0\n    [...]\n    CTxMemPool::accept() : accepted 058cdc9c4d (poolsz 1)\n    [...]\n    Added 4 addresses from 178.18.90.41: 1646 tried, 12503 new\n    Added 4 addresses from 87.155.86.94: 1646 tried, 12506 new\n    Added 4 addresses from 173.242.112.53: 1646 tried, 12507 new\n    [...]\n    Added 3 addresses from ::: 1646 tried, 12508 new\n    94 addresses found from DNS seeds\n    ThreadDNSAddressSeed exited\n\nThe GUI says \"0 active connections\" but the log (above) appears to show some communication with peers, so I'm a bit confused about what's going on there.",
      "created_at" : "2012-09-21T16:02:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8769408",
      "id" : 8769408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-21T16:02:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8769408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "In particular, my client somehow received notification of a payment to one of my addresses (not a payment to self) while I was running with \"-maxconnections=0\".  How can that happen?\n\n    CTxMemPool::accept() : accepted 058cdc9c4d (poolsz 1)\n\nWhen I try sending a payment it doesn't send, as expected:\n\n    Status: 0/unconfirmed, has not been successfully broadcast yet\n    Date: 12-09-21 09:22\n    To: satoshidice lessthan 8000 1dice6YgEVBf88erBFra9BHf6ZMoyvG88\n\nbut for some reason I was able to receive a payment.",
      "created_at" : "2012-09-21T16:24:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-8770053",
      "id" : 8770053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2012-09-21T16:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/8770053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "body" : "The CPU issue was solved, and `mapMultiArgs[\"-connect\"].size() > 0` was added, so closing\r\n",
      "created_at" : "2013-10-26T08:02:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/1664#issuecomment-27141654",
      "id" : 27141654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1664",
      "updated_at" : "2013-10-26T08:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/27141654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
