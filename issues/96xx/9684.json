{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "I'm running the current master branch version (1c2edd9f) and find that most times when I start bitcoind it spends about 10 minutes thrashing my hard drive doing a 'compaction' of the chainstate database.\r\n\r\nThe relevant stack trace:\r\n\r\n    #9  0x000055555596ce1f in leveldb::DBImpl::DoCompactionWork (this=0x7fffd8619e90, compact=0x7fffa8015860) at leveldb/db/db_impl.cc:1006\r\n    #10 0x000055555596d69f in leveldb::DBImpl::BackgroundCompaction (this=0x7fffd8619e90) at leveldb/db/db_impl.cc:736\r\n    #11 0x000055555596e192 in leveldb::DBImpl::BackgroundCall (this=0x7fffd8619e90) at leveldb/db/db_impl.cc:674\r\n    #12 0x00005555559951a3 in BGThread (this=0x7fffd847c490) at leveldb/util/env_posix.cc:582\r\n    #13 leveldb::(anonymous namespace)::PosixEnv::BGThreadWrapper (arg=0x7fffd847c490) at leveldb/util/env_posix.cc:521\r\n    #14 0x00007ffff4cc30a4 in start_thread (arg=0x7fffb73bc700) at pthread_create.c:309\r\n\r\nI tried restarting bitcoind 10 times and kept a copy of the LOG file each time. Here are the file sizes:\r\n\r\n    -rw------- 1 chris chris 184366 Feb  3 11:19 LOG.00\r\n    -rw------- 1 chris chris 182024 Feb  3 11:30 LOG.01\r\n    -rw------- 1 chris chris    344 Feb  3 12:11 LOG.02\r\n    -rw------- 1 chris chris 194758 Feb  3 12:27 LOG.03\r\n    -rw------- 1 chris chris    344 Feb  3 12:27 LOG.04\r\n    -rw------- 1 chris chris 187248 Feb  3 12:36 LOG.05\r\n    -rw------- 1 chris chris    571 Feb  3 15:28 LOG.06\r\n    -rw------- 1 chris chris 189728 Feb  3 15:45 LOG.07\r\n    -rw------- 1 chris chris 194434 Feb  3 16:00 LOG.08\r\n    -rw------- 1 chris chris 188599 Feb  3 16:16 LOG.09\r\n\r\n7 out of 10 times it did a full recompact, causing the computer to almost come to a standstill while it kept the harddrive busy. One of the 10 times bitcoind crashed hard almost immediately, but I'm sure that's a separate issue (#9683).\r\n\r\nHere's the [LOG](https://github.com/bitcoin/bitcoin/files/751895/LOG.txt) file from the ~/.bitcoin/chainstate/ folder.\r\n\r\nEdit: note that I use:\r\n\r\n    ./configure --with-incompatible-bdb\r\n\r\nAnd see \"Using BerkeleyDB version Berkeley DB 5.3.28: (September  9, 2013)\" in the debug.log.\r\n\r\nIf I run configure without that flag I see an error:\r\n\r\n    configure: error: Found Berkeley DB other than 4.8, required for portable wallets (--with-incompatible-bdb to ignore or --disable-wallet to disable wallet functionality)",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 7,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9684/comments",
   "created_at" : "2017-02-04T01:22:56Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9684/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/9684",
   "id" : 205311243,
   "labels" : [
      {
         "color" : "fbca04",
         "default" : false,
         "id" : 97470796,
         "name" : "UTXO Db and Indexes",
         "node_id" : "MDU6TGFiZWw5NzQ3MDc5Ng==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9684/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWUyMDUzMTEyNDM=",
   "number" : 9684,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "bitcoind 'compacts' chainstate database almost every time I run it",
   "updated_at" : "2018-03-10T07:20:25Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9684",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
      "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dooglus/followers",
      "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dooglus",
      "id" : 573356,
      "login" : "dooglus",
      "node_id" : "MDQ6VXNlcjU3MzM1Ng==",
      "organizations_url" : "https://api.github.com/users/dooglus/orgs",
      "received_events_url" : "https://api.github.com/users/dooglus/received_events",
      "repos_url" : "https://api.github.com/users/dooglus/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dooglus"
   }
}
