[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "cirrus task: https://cirrus-ci.com/build/5675560427847680\r\ncommit: https://github.com/RandyMcMillan/bitcoin/commit/b41f962f349ab3d3f8a4d8e761ac5592120f8576\r\n\r\nWe cover an array of possible command line combinations:\r\n\r\n![Screen Shot 2022-02-06 at 6 23 28 PM](https://user-images.githubusercontent.com/152159/152705961-b6d624e3-80b5-4d76-8098-3e1175c15370.png)\r\n\r\n",
      "created_at" : "2022-02-06T18:22:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#issuecomment-1030886850",
      "id" : 1030886850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24269",
      "node_id" : "IC_kwDOABII5849chXC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030886850/reactions"
      },
      "updated_at" : "2022-02-06T23:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1030886850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/152159?v=4",
         "events_url" : "https://api.github.com/users/RandyMcMillan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RandyMcMillan/followers",
         "following_url" : "https://api.github.com/users/RandyMcMillan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RandyMcMillan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RandyMcMillan",
         "id" : 152159,
         "login" : "RandyMcMillan",
         "node_id" : "MDQ6VXNlcjE1MjE1OQ==",
         "organizations_url" : "https://api.github.com/users/RandyMcMillan/orgs",
         "received_events_url" : "https://api.github.com/users/RandyMcMillan/received_events",
         "repos_url" : "https://api.github.com/users/RandyMcMillan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RandyMcMillan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RandyMcMillan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RandyMcMillan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2022-03-19T17:39:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#issuecomment-1073050921",
      "id" : 1073050921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24269",
      "node_id" : "IC_kwDOABII584_9XUp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073050921/reactions"
      },
      "updated_at" : "2022-03-19T17:39:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073050921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834187432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834187432"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, maybe use named args (for all, or after the first one), maybe better to omit a default value if you're passing values in for clarity, and naming suggestion \r\n```diff\r\n-    def test_local_addresses(self, test_case, should_be_empty=False):\r\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\r\n\r\n...\r\n\r\n         for test_case in test_cases:\r\n-            self.test_local_addresses(test_case, False)\r\n+            self.test_local_addresses(test_case, expect_empty=False)\r\n \r\n         for test_case in test_cases_empty:\r\n-            self.test_local_addresses(test_case, True)\r\n+            self.test_local_addresses(test_case, expect_empty=True)\r\n```",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T11:08:45Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834187432",
      "id" : 834187432,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII584xuLCo",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 42,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 42,
      "pull_request_review_id" : 920094371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834187432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834187432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834191148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834191148"
         }
      },
      "author_association" : "MEMBER",
      "body" : "formatting nit\r\n```diff\r\n     def run_test(self):\r\n-        test_cases = [[\"-listen\", \"-discover\"],\r\n-                      [\"-listen=1\", \"-discover\"],\r\n-                      [\"-listen\", \"-discover=1\"],\r\n-                      [\"-listen=1\", \"-discover=1\"],\r\n-                      [\"-discover\"]]\r\n-\r\n-        test_cases_empty = [[\"-discover=0\"],\r\n-                            [\"-listen\", \"-discover=0\"],\r\n-                            []]\r\n+        test_cases = [\r\n+            [\"-listen\", \"-discover\"],\r\n+            [\"-listen=1\", \"-discover\"],\r\n+            [\"-listen\", \"-discover=1\"],\r\n+            [\"-listen=1\", \"-discover=1\"],\r\n+            [\"-discover\"],\r\n+        ]\r\n+\r\n+        test_cases_empty = [\r\n+            [\"-discover=0\"],\r\n+            [\"-listen\", \"-discover=0\"],\r\n+            [],\r\n+        ]\r\n```\r\n",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T11:12:22Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [[\"-listen\", \"-discover\"],\n+                      [\"-listen=1\", \"-discover\"],\n+                      [\"-listen\", \"-discover=1\"],\n+                      [\"-listen=1\", \"-discover=1\"],\n+                      [\"-discover\"]]\n+\n+        test_cases_empty = [[\"-discover=0\"],\n+                            [\"-listen\", \"-discover=0\"],\n+                            []]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834191148",
      "id" : 834191148,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII584xuL8s",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 63,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 63,
      "pull_request_review_id" : 920094371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834191148/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834191148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834193652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834193652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On my system (Debian 5.16.14-1 (2022-03-15) x86_64 GNU/Linux) this is never hit and so `validate_addresses()`, `is_valid_ipv4_address()` and `is_valid_ipv6_address()` are all unused. Is it ever hit for you?\r\n\r\n(maybe have a look at `test/functional/feature_bind_port_discover.py` and add the tests there, if helpful)",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T11:15:40Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834193652",
      "id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xuMj0",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920094371,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834193652/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834193652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834571453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834571453"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, it hits here. Example:\r\n\r\n```\r\n2022-03-24T17:37:48.362000Z TestFramework (INFO): Restart node with ['-listen', '-discover']\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:c84:4731:10d6:7311\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:1c3e:c153:e75f:59c3\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:3132:b83c:1915:c06e\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:4152:dcc5:5862:734\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:4d52:b4d3:d93d:8f8e\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:5594:b545:6081:a40b\r\n2022-03-24T17:37:49.181000Z TestFramework (INFO): Validating 2804:14d:5281:8ae2:f97b:bd76:25aa:a0d3\r\n```\r\n\r\nI researched about `localaddresses` and noticed it's not accurate, this is a reason I don't ensure in the test that `localaddresses` MUST be filled. See: https://bitcoin.stackexchange.com/questions/74991/when-ipv6-is-enabled-my-ipv4-address-does-not-appear-in-getnetworkinfo-localaddr",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T17:43:20Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834571453",
      "id" : 834571453,
      "in_reply_to_id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xvoy9",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920644912,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834571453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T18:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834571453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834575024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834575024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On which platform/OS?",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T17:47:40Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834575024",
      "id" : 834575024,
      "in_reply_to_id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xvpqw",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920649986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834575024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T17:47:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834575024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834585870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834585870"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "MacOS 12.0.1 Monterey\r\n\r\nI edited the last comment because the link was wrong haha. ",
      "commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "created_at" : "2022-03-24T18:00:40Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r834585870",
      "id" : 834585870,
      "in_reply_to_id" : 834193652,
      "line" : 52,
      "node_id" : "PRRC_kwDOABII584xvsUO",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 52,
      "pull_request_review_id" : 920665332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834585870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-24T18:00:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/834585870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r835282619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/835282619"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Great, done! ",
      "commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "created_at" : "2022-03-25T13:43:33Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r835282619",
      "id" : 835282619,
      "in_reply_to_id" : 834187432,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xyWa7",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 42,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 921663292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/835282619/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-25T13:43:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/835282619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r835282817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/835282817"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Cool, done! ",
      "commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "created_at" : "2022-03-25T13:43:46Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [[\"-listen\", \"-discover\"],\n+                      [\"-listen=1\", \"-discover\"],\n+                      [\"-listen\", \"-discover=1\"],\n+                      [\"-listen=1\", \"-discover=1\"],\n+                      [\"-discover\"]]\n+\n+        test_cases_empty = [[\"-discover=0\"],\n+                            [\"-listen\", \"-discover=0\"],\n+                            []]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r835282817",
      "id" : 835282817,
      "in_reply_to_id" : 834191148,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584xyWeB",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 63,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 921663590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/835282817/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-25T13:43:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/835282817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892210648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892210648"
         }
      },
      "author_association" : "NONE",
      "body" : "Are there any other occasions where we test the same behavior for different variations of an argument? Testing with combinations of `-discover`, `-discover=1` or `-listen`, `-listen=1` seems redundant. Taking that into consideration, I  think that this test could be replaced with just a test case for `discover=0` at `test/functional/feature_bind_port_discover.py`.",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-06-08T10:50:44Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-listen=1\", \"-discover\"],\n+            [\"-listen\", \"-discover=1\"],\n+            [\"-listen=1\", \"-discover=1\"],\n+            [\"-discover\"],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892210648",
      "id" : 892210648,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Lg3Y",
      "original_commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "original_line" : 59,
      "original_position" : 61,
      "original_start_line" : 55,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 999520003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892210648/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-08T10:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892210648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892213746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892213746"
         }
      },
      "author_association" : "NONE",
      "body" : "On my system (MacOS 10.15.7) `localaddresses` is always empty. Which is a different behavior from what I see at `test/functional/feature_bind_port_discover.py` where `localaddresses` is accurate.\r\n\r\nWhat I think is the problem is that without explicitly set `bind_to_localhost_only = False` [the node binds to localhost](https://github.com/brunoerg/bitcoin/blob/2022-02-discover-test/test/functional/test_framework/test_framework.py#L470-L471) which [is NET_UNROUTABLE](https://github.com/brunoerg/bitcoin/blob/2022-02-discover-test/src/test/netbase_tests.cpp#L47) thus [never added to mapLocalHost](https://github.com/brunoerg/bitcoin/blob/2022-02-discover-test/src/net.cpp#L286-L313) which is what is [returned for `localaddresses` by the `getnetworkinfo` RPC call](https://github.com/brunoerg/bitcoin/blob/2022-02-discover-test/src/rpc/net.cpp#L649-L661). With this change, `localaddresses` always contains my addresses as expected. \r\n\r\n```suggestion\r\n    def set_test_params(self):\r\n        self.setup_clean_chain = True\r\n        self.bind_to_localhost_only = False\r\n        self.num_nodes = 1\r\n```\r\n\r\nBut I still don't understand how this works for others, so there must be a flaw in my thinking.",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-06-08T10:54:34Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892213746",
      "id" : 892213746,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Lhny",
      "original_commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "original_line" : 33,
      "original_position" : 32,
      "original_start_line" : 30,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 999520003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892213746/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-08T10:57:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892213746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892217116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892217116"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It was suggested by other reviewer, but I agree with you, there is no need to test redundant cases. ",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-06-08T10:58:27Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-listen=1\", \"-discover\"],\n+            [\"-listen\", \"-discover=1\"],\n+            [\"-listen=1\", \"-discover=1\"],\n+            [\"-discover\"],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892217116",
      "id" : 892217116,
      "in_reply_to_id" : 892210648,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Licc",
      "original_commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "original_line" : 59,
      "original_position" : 61,
      "original_start_line" : 55,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 999529055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892217116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-08T10:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892217116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892218684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892218684"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done! ",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-06-08T11:00:20Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-listen=1\", \"-discover\"],\n+            [\"-listen\", \"-discover=1\"],\n+            [\"-listen=1\", \"-discover=1\"],\n+            [\"-discover\"],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892218684",
      "id" : 892218684,
      "in_reply_to_id" : 892210648,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Li08",
      "original_commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "original_line" : 59,
      "original_position" : 61,
      "original_start_line" : 55,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 999531185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892218684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-08T11:00:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892218684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892220636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892220636"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Please, try again with the new changes.",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-06-08T11:02:38Z",
      "diff_hunk" : "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, should_be_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if should_be_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892220636",
      "id" : 892220636,
      "in_reply_to_id" : 834193652,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII5841LjTc",
      "original_commit_id" : "99d50f48c9f7cf59f9ee88cb8517ab48b730d21b",
      "original_line" : 53,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 53,
      "pull_request_review_id" : 999533903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892220636/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-08T11:02:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892220636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892220915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892220915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Make sense, `bind_to_localhost_only`is True by default. thanks!",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-06-08T11:02:57Z",
      "diff_hunk" : "@@ -0,0 +1,77 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r892220915",
      "id" : 892220915,
      "in_reply_to_id" : 892213746,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841LjXz",
      "original_commit_id" : "0046050607e8506dcb926488e7b5a4d75b85bbec",
      "original_line" : 33,
      "original_position" : 32,
      "original_start_line" : 30,
      "path" : "test/functional/feature_discover.py",
      "position" : null,
      "pull_request_review_id" : 999534345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892220915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-08T11:02:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/892220915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK c80df01cf19d702b94a3e7a883fcf5f400289586 ",
      "created_at" : "2022-06-08T11:12:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#issuecomment-1149780940",
      "id" : 1149780940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24269",
      "node_id" : "IC_kwDOABII585EiEPM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1149780940/reactions"
      },
      "updated_at" : "2022-06-08T11:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1149780940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18506343?v=4",
         "events_url" : "https://api.github.com/users/kouloumos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kouloumos/followers",
         "following_url" : "https://api.github.com/users/kouloumos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kouloumos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kouloumos",
         "id" : 18506343,
         "login" : "kouloumos",
         "node_id" : "MDQ6VXNlcjE4NTA2MzQz",
         "organizations_url" : "https://api.github.com/users/kouloumos/orgs",
         "received_events_url" : "https://api.github.com/users/kouloumos/received_events",
         "repos_url" : "https://api.github.com/users/kouloumos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kouloumos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kouloumos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kouloumos"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16545](https://github.com/bitcoin/bitcoin/pull/16545) (refactor: Implement missing error checking for ArgsManager flags by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-09-23T13:14:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#issuecomment-1256196070",
      "id" : 1256196070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24269",
      "node_id" : "IC_kwDOABII585K4Afm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1256196070/reactions"
      },
      "updated_at" : "2022-09-23T13:14:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1256196070",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982265668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982265668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems for both these cases local address list is empty. Is that expected behavior? ",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-09-28T11:08:45Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-discover\"],\n+        ]\n+\n+        test_cases_empty = [\n+            [\"-discover=0\"],\n+            [\"-listen\", \"-discover=0\"],\n+            [],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982265668",
      "id" : 982265668,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII5846jC9E",
      "original_commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "original_line" : 65,
      "original_position" : 65,
      "original_start_line" : 57,
      "path" : "test/functional/feature_discover.py",
      "position" : 65,
      "pull_request_review_id" : 1123485308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982265668/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-28T11:16:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982265668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982582168"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982582168"
         }
      },
      "author_association" : "NONE",
      "body" : "I get a list of addresses only for ipv6. Testing on macOS.",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-09-28T15:52:00Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-discover\"],\n+        ]\n+\n+        test_cases_empty = [\n+            [\"-discover=0\"],\n+            [\"-listen\", \"-discover=0\"],\n+            [],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982582168",
      "id" : 982582168,
      "in_reply_to_id" : 982265668,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII5846kQOY",
      "original_commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "original_line" : 65,
      "original_position" : 65,
      "original_start_line" : 57,
      "path" : "test/functional/feature_discover.py",
      "position" : 65,
      "pull_request_review_id" : 1123953390,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982582168/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-28T15:52:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982582168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/20156932?v=4",
         "events_url" : "https://api.github.com/users/i5hi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/i5hi/followers",
         "following_url" : "https://api.github.com/users/i5hi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/i5hi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/i5hi",
         "id" : 20156932,
         "login" : "i5hi",
         "node_id" : "MDQ6VXNlcjIwMTU2OTMy",
         "organizations_url" : "https://api.github.com/users/i5hi/orgs",
         "received_events_url" : "https://api.github.com/users/i5hi/received_events",
         "repos_url" : "https://api.github.com/users/i5hi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/i5hi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/i5hi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/i5hi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982695339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982695339"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't `expect_empty` be `True` for the `test_cases_empty` cases? If it's `False` for all calls to `test_local_addresses`, it doesn't really make sense to split up the test cases `test_cases`  and `test_cases_empty` or have a `expect_empty` argument in the first place.",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-09-28T17:41:53Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-discover\"],\n+        ]\n+\n+        test_cases_empty = [\n+            [\"-discover=0\"],\n+            [\"-listen\", \"-discover=0\"],\n+            [],\n+        ]\n+\n+        for test_case in test_cases:\n+            self.test_local_addresses(test_case, expect_empty=False)\n+\n+        for test_case in test_cases_empty:\n+            self.test_local_addresses(test_case, expect_empty=False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982695339",
      "id" : 982695339,
      "line" : 71,
      "node_id" : "PRRC_kwDOABII5846kr2r",
      "original_commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "original_line" : 71,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 71,
      "pull_request_review_id" : 1124117563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982695339/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-28T17:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982695339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982698971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982698971"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It depends on the specifics of your network. In some cases, the `-discover` functionality is able to find local addresses, in other cases it isn't. I think that's why this test doesn't assert that anything is found, just that **if** something is found, it is valid (`validate_addresses`).",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-09-28T17:46:10Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-discover\"],\n+        ]\n+\n+        test_cases_empty = [\n+            [\"-discover=0\"],\n+            [\"-listen\", \"-discover=0\"],\n+            [],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r982698971",
      "id" : 982698971,
      "in_reply_to_id" : 982265668,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII5846ksvb",
      "original_commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "original_line" : 65,
      "original_position" : 65,
      "original_start_line" : 57,
      "path" : "test/functional/feature_discover.py",
      "position" : 65,
      "pull_request_review_id" : 1124122993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982698971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-28T17:46:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982698971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r983181798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983181798"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "+1  Have the same question.. ",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-09-29T07:48:57Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-discover\"],\n+        ]\n+\n+        test_cases_empty = [\n+            [\"-discover=0\"],\n+            [\"-listen\", \"-discover=0\"],\n+            [],\n+        ]\n+\n+        for test_case in test_cases:\n+            self.test_local_addresses(test_case, expect_empty=False)\n+\n+        for test_case in test_cases_empty:\n+            self.test_local_addresses(test_case, expect_empty=False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r983181798",
      "id" : 983181798,
      "in_reply_to_id" : 982695339,
      "line" : 71,
      "node_id" : "PRRC_kwDOABII5846minm",
      "original_commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "original_line" : 71,
      "original_position" : 71,
      "original_start_line" : null,
      "path" : "test/functional/feature_discover.py",
      "position" : 71,
      "pull_request_review_id" : 1124791786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983181798/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T07:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983181798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r983554141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983554141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perfect, @mzumsande ",
      "commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "created_at" : "2022-09-29T13:36:51Z",
      "diff_hunk" : "@@ -0,0 +1,75 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test -discover command.\"\"\"\n+\n+import socket\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+\n+\n+def is_valid_ipv4_address(address):\n+    try:\n+        socket.inet_aton(address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+def is_valid_ipv6_address(address):\n+    try:\n+        socket.inet_pton(socket.AF_INET6, address)\n+    except socket.error:\n+        return False\n+    return True\n+\n+\n+class DiscoverTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.bind_to_localhost_only = False\n+        self.num_nodes = 1\n+\n+    def validate_addresses(self, addresses_obj):\n+        for address_obj in addresses_obj:\n+            address = address_obj['address']\n+            self.log.info(f\"Validating {address}\")\n+            valid = (is_valid_ipv4_address(address)\n+                     or is_valid_ipv6_address(address))\n+            assert_equal(valid, True)\n+\n+    def test_local_addresses(self, test_case, *, expect_empty=False):\n+        self.log.info(f\"Restart node with {test_case}\")\n+        self.restart_node(0, test_case)\n+        network_info = self.nodes[0].getnetworkinfo()\n+        network_enabled = [n for n in network_info['networks']\n+                           if n['reachable'] and n['name'] in ['ipv4', 'ipv6']]\n+        local_addrs = list(network_info[\"localaddresses\"])\n+        if expect_empty or not network_enabled:\n+            assert_equal(local_addrs, [])\n+        elif len(local_addrs) > 0:\n+            self.validate_addresses(local_addrs)\n+\n+    def run_test(self):\n+        test_cases = [\n+            [\"-listen\", \"-discover\"],\n+            [\"-discover\"],\n+        ]\n+\n+        test_cases_empty = [\n+            [\"-discover=0\"],\n+            [\"-listen\", \"-discover=0\"],\n+            [],\n+        ]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24269#discussion_r983554141",
      "id" : 983554141,
      "in_reply_to_id" : 982265668,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII5846n9hd",
      "original_commit_id" : "c80df01cf19d702b94a3e7a883fcf5f400289586",
      "original_line" : 65,
      "original_position" : 65,
      "original_start_line" : 57,
      "path" : "test/functional/feature_discover.py",
      "position" : 65,
      "pull_request_review_id" : 1125314821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24269",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983554141/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-29T13:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983554141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   }
]
