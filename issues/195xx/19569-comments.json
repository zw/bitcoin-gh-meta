[
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns I made a few changes compared to your branch:\r\n\r\n* The pair type is a bit richer, and in primitives/transaction.h (so that it's available from txrequest in #19184).\r\n* All of the txrequest data structures use it, not just `m_tx_process_time` - this feels more obviously correct.\r\n* The restriction that wtxidrelay peers can only announce using MSG_WTX invs remains - this isn't violated by txid-based orphan parent requests (which are get GETDATAs, not INVs).\r\n\r\nLet me know what you think.\r\n",
      "created_at" : "2020-07-23T01:04:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-662771502",
      "id" : 662771502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Mjc3MTUwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-23T02:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662771502",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459247426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459247426"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since you're using accessor methods anyway, could make it:\r\n\r\n```c++\r\nprivate:\r\n    const std::tuple<bool, uint256> data;\r\npublic:\r\n    friend bool operator<(const GenTxid& a, const GenTxid& b) { return a.data < b.data; }\r\n```",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T06:54:20Z",
      "diff_hunk" : "@@ -388,4 +390,17 @@ typedef std::shared_ptr<const CTransaction> CTransactionRef;\n static inline CTransactionRef MakeTransactionRef() { return std::make_shared<const CTransaction>(); }\n template <typename Tx> static inline CTransactionRef MakeTransactionRef(Tx&& txIn) { return std::make_shared<const CTransaction>(std::forward<Tx>(txIn)); }\n \n+/** A generic txid reference (txid or wtxid). */\n+class GenTxid\n+{\n+    const bool m_is_wtxid;\n+    const uint256 m_hash;\n+public:\n+    GenTxid(bool is_wtxid, const uint256& hash) : m_is_wtxid(is_wtxid), m_hash(hash) {}\n+    bool IsWtxid() const { return m_is_wtxid; }\n+    const uint256& GetHash() const { return m_hash; }\n+    friend bool operator==(const GenTxid& a, const GenTxid& b) { return a.m_is_wtxid == b.m_is_wtxid && a.m_hash == b.m_hash; }\n+    friend bool operator<(const GenTxid& a, const GenTxid& b) { return std::tie(a.m_is_wtxid, a.m_hash) < std::tie(b.m_is_wtxid, b.m_hash); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459247426",
      "id" : 459247426,
      "line" : 403,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI0NzQyNg==",
      "original_commit_id" : "f47310f0cf34c109f9fe6f2ea3d05470a47b5f0a",
      "original_line" : 403,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : 23,
      "pull_request_review_id" : 453873474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459247426",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459258317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459258317"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not a super-strong opinion, but I'm wondering if we should call it `gtxid` or `gentxid` everywhere. txid used to mean something different before, and it still sort of does?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T07:20:59Z",
      "diff_hunk" : "@@ -4519,24 +4522,24 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n \n         auto& tx_process_time = state.m_tx_download.m_tx_process_time;\n         while (!tx_process_time.empty() && tx_process_time.begin()->first <= current_time && state.m_tx_download.m_tx_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n-            const uint256 txid = tx_process_time.begin()->second;\n+            const GenTxid txid = tx_process_time.begin()->second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459258317",
      "id" : 459258317,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI1ODMxNw==",
      "original_commit_id" : "f47310f0cf34c109f9fe6f2ea3d05470a47b5f0a",
      "original_line" : 4525,
      "original_position" : 135,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 453886838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459258317",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459263434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459263434"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this wouldn't work at the moment, because there's a check:\r\n```\r\n            if (State(pfrom.GetId())->m_wtxid_relay) {\r\n                if (inv.type == MSG_TX) continue;\r\n            } else {\r\n                if (inv.type == MSG_WTX) continue;\r\n            }\r\n```\r\n\r\nDoes it rely on some other pending PR? Is that what you referring to: \"Based on a commit by Anthony Towns.\"? ",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T07:32:33Z",
      "diff_hunk" : "@@ -2992,17 +2992,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459263434",
      "id" : 459263434,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2MzQzNA==",
      "original_commit_id" : "54a09366a43bfa890651951a624240e2899632e0",
      "original_line" : 3000,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 453886838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459263434",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459264128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459264128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Or maybe it's just missing a commit to remove this check, I don't know :)",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T07:34:03Z",
      "diff_hunk" : "@@ -2992,17 +2992,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459264128",
      "id" : 459264128,
      "in_reply_to_id" : 459263434,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2NDEyOA==",
      "original_commit_id" : "54a09366a43bfa890651951a624240e2899632e0",
      "original_line" : 3000,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 453886838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459264128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459264161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459264161"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could have a `GenTxid::ToString` which specifies whether the hash is a wtxid or a regular txid",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T07:34:09Z",
      "diff_hunk" : "@@ -4505,7 +4506,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         if (state.m_tx_download.m_check_expiry_timer <= current_time) {\n             for (auto it=state.m_tx_download.m_tx_in_flight.begin(); it != state.m_tx_download.m_tx_in_flight.end();) {\n                 if (it->second <= current_time - TX_EXPIRY_INTERVAL) {\n-                    LogPrint(BCLog::NET, \"timeout of inflight tx %s from peer=%d\\n\", it->first.ToString(), pto->GetId());\n+                    LogPrint(BCLog::NET, \"timeout of inflight tx %s from peer=%d\\n\", it->first.GetHash().ToString(), pto->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459264161",
      "id" : 459264161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2NDE2MQ==",
      "original_commit_id" : "154778d1e4f053145979e9faf5178d0ece84370a",
      "original_line" : 4509,
      "original_position" : 144,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 453873474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459264161",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459268599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459268599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is in INV handling. When requesting parents of an orphan, there is no INV involved: a GETDATA is sent directly in response to receiving the TX.\n\nAm I missing something why changing this is needed?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T07:44:02Z",
      "diff_hunk" : "@@ -2992,17 +2992,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459268599",
      "id" : 459268599,
      "in_reply_to_id" : 459263434,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2ODU5OQ==",
      "original_commit_id" : "54a09366a43bfa890651951a624240e2899632e0",
      "original_line" : 3000,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 453899770,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459268599",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459278883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459278883"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This works as-is for me both live against a mainnet wtxid relay peer, and via the modified test.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T08:04:57Z",
      "diff_hunk" : "@@ -2992,17 +2992,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459278883",
      "id" : 459278883,
      "in_reply_to_id" : 459263434,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI3ODg4Mw==",
      "original_commit_id" : "54a09366a43bfa890651951a624240e2899632e0",
      "original_line" : 3000,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 453912588,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459278883",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459318734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459318734"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You are right, I was confused by INV/GETDATA. Feel free to mark as resolved :)",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T09:18:39Z",
      "diff_hunk" : "@@ -2992,17 +2992,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459318734",
      "id" : 459318734,
      "in_reply_to_id" : 459263434,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxODczNA==",
      "original_commit_id" : "54a09366a43bfa890651951a624240e2899632e0",
      "original_line" : 3000,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 453962076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459318734",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 154778d",
      "created_at" : "2020-07-23T09:19:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-662904927",
      "id" : 662904927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MjkwNDkyNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-23T09:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/662904927",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459354787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459354787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f8e8a44d suggestion for \"support... is supported\" here if you retouch\r\n```suggestion\r\n* [`BIP 339`](https://github.com/bitcoin/bips/blob/master/bip-0339.mediawiki): Announcing and fetching transactions by wtxid is supported as of **v0.21.0** ([PR 18044](https://github.com/bitcoin/bitcoin/pull/18044)).\r\n```\r\nor just \"Relaying...\"",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T10:28:33Z",
      "diff_hunk" : "@@ -42,3 +42,4 @@ BIPs that are implemented by Bitcoin Core (up-to-date up to **v0.19.0**):\n * [`BIP 173`](https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki): Bech32 addresses for native Segregated Witness outputs are supported as of **v0.16.0** ([PR 11167](https://github.com/bitcoin/bitcoin/pull/11167)). Bech32 addresses are generated by default as of **v0.20.0** ([PR 16884](https://github.com/bitcoin/bitcoin/pull/16884)).\n * [`BIP 174`](https://github.com/bitcoin/bips/blob/master/bip-0174.mediawiki): RPCs to operate on Partially Signed Bitcoin Transactions (PSBT) are present as of **v0.17.0** ([PR 13557](https://github.com/bitcoin/bitcoin/pull/13557)).\n * [`BIP 176`](https://github.com/bitcoin/bips/blob/master/bip-0176.mediawiki): Bits Denomination [QT only] is supported as of **v0.16.0** ([PR 12035](https://github.com/bitcoin/bitcoin/pull/12035)).\n+* [`BIP 339`](https://github.com/bitcoin/bips/blob/master/bip-0339.mediawiki): Support for announcing and fetching transactions by wtxid is supported as of **v0.21.0** ([PR 18044](https://github.com/bitcoin/bitcoin/pull/18044)).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459354787",
      "id" : 459354787,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM1NDc4Nw==",
      "original_commit_id" : "154778d1e4f053145979e9faf5178d0ece84370a",
      "original_line" : 45,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "doc/bips.md",
      "position" : null,
      "pull_request_review_id" : 454007713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459354787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459767301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459767301"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe personal preference, but I don't think slightly easier comparators weighs up against losing meaningful names for the member variables.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T22:40:18Z",
      "diff_hunk" : "@@ -388,4 +390,17 @@ typedef std::shared_ptr<const CTransaction> CTransactionRef;\n static inline CTransactionRef MakeTransactionRef() { return std::make_shared<const CTransaction>(); }\n template <typename Tx> static inline CTransactionRef MakeTransactionRef(Tx&& txIn) { return std::make_shared<const CTransaction>(std::forward<Tx>(txIn)); }\n \n+/** A generic txid reference (txid or wtxid). */\n+class GenTxid\n+{\n+    const bool m_is_wtxid;\n+    const uint256 m_hash;\n+public:\n+    GenTxid(bool is_wtxid, const uint256& hash) : m_is_wtxid(is_wtxid), m_hash(hash) {}\n+    bool IsWtxid() const { return m_is_wtxid; }\n+    const uint256& GetHash() const { return m_hash; }\n+    friend bool operator==(const GenTxid& a, const GenTxid& b) { return a.m_is_wtxid == b.m_is_wtxid && a.m_hash == b.m_hash; }\n+    friend bool operator<(const GenTxid& a, const GenTxid& b) { return std::tie(a.m_is_wtxid, a.m_hash) < std::tie(b.m_is_wtxid, b.m_hash); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459767301",
      "id" : 459767301,
      "in_reply_to_id" : 459247426,
      "line" : 403,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc2NzMwMQ==",
      "original_commit_id" : "f47310f0cf34c109f9fe6f2ea3d05470a47b5f0a",
      "original_line" : 403,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/primitives/transaction.h",
      "position" : 23,
      "pull_request_review_id" : 454542608,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459767301",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459784201"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459784201"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems reasonable; done. I've changed all `GenTxid` variables in net_processing to be `gtxid`.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T23:33:54Z",
      "diff_hunk" : "@@ -4519,24 +4522,24 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n \n         auto& tx_process_time = state.m_tx_download.m_tx_process_time;\n         while (!tx_process_time.empty() && tx_process_time.begin()->first <= current_time && state.m_tx_download.m_tx_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n-            const uint256 txid = tx_process_time.begin()->second;\n+            const GenTxid txid = tx_process_time.begin()->second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459784201",
      "id" : 459784201,
      "in_reply_to_id" : 459258317,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc4NDIwMQ==",
      "original_commit_id" : "f47310f0cf34c109f9fe6f2ea3d05470a47b5f0a",
      "original_line" : 4525,
      "original_position" : 135,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 454561890,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459784201",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459784256"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459784256"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T23:34:05Z",
      "diff_hunk" : "@@ -4505,7 +4506,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         if (state.m_tx_download.m_check_expiry_timer <= current_time) {\n             for (auto it=state.m_tx_download.m_tx_in_flight.begin(); it != state.m_tx_download.m_tx_in_flight.end();) {\n                 if (it->second <= current_time - TX_EXPIRY_INTERVAL) {\n-                    LogPrint(BCLog::NET, \"timeout of inflight tx %s from peer=%d\\n\", it->first.ToString(), pto->GetId());\n+                    LogPrint(BCLog::NET, \"timeout of inflight tx %s from peer=%d\\n\", it->first.GetHash().ToString(), pto->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459784256",
      "id" : 459784256,
      "in_reply_to_id" : 459264161,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc4NDI1Ng==",
      "original_commit_id" : "154778d1e4f053145979e9faf5178d0ece84370a",
      "original_line" : 4509,
      "original_position" : 144,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 454561955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459784256",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459784642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459784642"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-23T23:35:20Z",
      "diff_hunk" : "@@ -42,3 +42,4 @@ BIPs that are implemented by Bitcoin Core (up-to-date up to **v0.19.0**):\n * [`BIP 173`](https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki): Bech32 addresses for native Segregated Witness outputs are supported as of **v0.16.0** ([PR 11167](https://github.com/bitcoin/bitcoin/pull/11167)). Bech32 addresses are generated by default as of **v0.20.0** ([PR 16884](https://github.com/bitcoin/bitcoin/pull/16884)).\n * [`BIP 174`](https://github.com/bitcoin/bips/blob/master/bip-0174.mediawiki): RPCs to operate on Partially Signed Bitcoin Transactions (PSBT) are present as of **v0.17.0** ([PR 13557](https://github.com/bitcoin/bitcoin/pull/13557)).\n * [`BIP 176`](https://github.com/bitcoin/bips/blob/master/bip-0176.mediawiki): Bits Denomination [QT only] is supported as of **v0.16.0** ([PR 12035](https://github.com/bitcoin/bitcoin/pull/12035)).\n+* [`BIP 339`](https://github.com/bitcoin/bips/blob/master/bip-0339.mediawiki): Support for announcing and fetching transactions by wtxid is supported as of **v0.21.0** ([PR 18044](https://github.com/bitcoin/bitcoin/pull/18044)).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r459784642",
      "id" : 459784642,
      "in_reply_to_id" : 459354787,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc4NDY0Mg==",
      "original_commit_id" : "154778d1e4f053145979e9faf5178d0ece84370a",
      "original_line" : 45,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "doc/bips.md",
      "position" : null,
      "pull_request_review_id" : 454562360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/459784642",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 338f80e per `git range-diff 007e15dc 154778d 338f80e` and re-code review. Re-debug build with Clang 12, ran tests and node.",
      "created_at" : "2020-07-24T08:08:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-663400625",
      "id" : 663400625,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzQwMDYyNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-24T08:08:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663400625",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460046862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460046862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this a slight behavior change ?\r\n\r\nBy erasing both wtxid/txid from `g_already_asked_for`, if we receive a wtxid from a wtixd-relay peer and at same time gets an announcement for the same tx from few txid-relay only peers, when we monitor our getdatas in `SendMessages`, we would send a spurious GETDATA for the first-processed txid-relay peer as `last_request_time` is null.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T13:19:33Z",
      "diff_hunk" : "@@ -2936,9 +2936,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (auto gtxid : {GenTxid{false, txid}, GenTxid{true, wtxid}}) {\n+            nodestate->m_tx_download.m_tx_announced.erase(gtxid);\n+            nodestate->m_tx_download.m_tx_in_flight.erase(gtxid);\n+            EraseTxRequest(gtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460046862",
      "id" : 460046862,
      "line" : 2939,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA0Njg2Mg==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 2939,
      "original_position" : 118,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 165,
      "pull_request_review_id" : 454878872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460046862",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460056991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460056991"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Strictly interpreting the BIP, the requirement for wtxid-relay on fetching is scoped to \"announced transactions from that peer\", and orphan parents have not been announced so we don't violate wtxid-relay policy here. Concern is on future BIP implementers on how they interpret \"is required\" and severing the connection for violations. Lightweight clients broadcasting a parent + CPFP tx may know issues due to this.\r\n\r\nIn the meanwhile, I share Suhas [point](https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388444497) to not commit a given handling of this behavior. Maybe we should amend the BIP to invite liberal enforcement of violations, just dropping non-complying invs/getdatas ?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T13:37:50Z",
      "diff_hunk" : "@@ -2992,17 +2994,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460056991",
      "id" : 460056991,
      "line" : 2994,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA1Njk5MQ==",
      "original_commit_id" : "b5ef3470bd7cf5a51e3e1b14380a23f652145126",
      "original_line" : 2994,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 187,
      "pull_request_review_id" : 454878872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460056991",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460188618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460188618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ariard After a tx arrives successfully, it should be AlreadyHave, and new INVs for it (of whatever type) should be ignored.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T17:24:07Z",
      "diff_hunk" : "@@ -2936,9 +2936,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (auto gtxid : {GenTxid{false, txid}, GenTxid{true, wtxid}}) {\n+            nodestate->m_tx_download.m_tx_announced.erase(gtxid);\n+            nodestate->m_tx_download.m_tx_in_flight.erase(gtxid);\n+            EraseTxRequest(gtxid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460188618",
      "id" : 460188618,
      "in_reply_to_id" : 460046862,
      "line" : 2939,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4ODYxOA==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 2939,
      "original_position" : 118,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 165,
      "pull_request_review_id" : 455060287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460188618",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460192659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460192659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Switching from `uint256` here to `GenTxid` means that when a non-segwit transaction is announced by both a wtxid-relay peer and txid-relay peer, we'll be more likely to request it twice -- for instance, if we first hear of it from a txidrelay peer, and then hear about it >2s later from a wtxidrelay peer (but before the transaction is successfully fetched). \r\n\r\nIt doesn't seem to me that we need to change the key in this map; am I missing something?  I don't necessarily expect this to be a large issue, relatively speaking -- we already expect some tx download duplication while having both txidrelay and wtxidrelay peers -- but not sure if this is an oversight or has some good reasons behind it.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T17:32:13Z",
      "diff_hunk" : "@@ -459,7 +459,7 @@ struct CNodeState {\n };\n \n // Keeps track of the time (in microseconds) when transactions were requested last time\n-limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\n+limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460192659",
      "id" : 460192659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE5MjY1OQ==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 462,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455065530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460192659",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460196325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460196325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I could imagine that another way this might manifest itself -- even when only connected to wtxid-relay peers -- is if a non-segwit parent tx and some child tx are announced at roughly the same time, and the child propagates to us before the parent (eg if we request the transactions from different peers), then the orphan fetching on the parent when the child is received might result in a spurious getdata of the parent as a TX when the parent has already been fetched and is in flight as a WTX (possibly even from the same peer!).",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T17:39:37Z",
      "diff_hunk" : "@@ -459,7 +459,7 @@ struct CNodeState {\n };\n \n // Keeps track of the time (in microseconds) when transactions were requested last time\n-limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\n+limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460196325",
      "id" : 460196325,
      "in_reply_to_id" : 460192659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE5NjMyNQ==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 462,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455065530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460196325",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460209907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460209907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As I mentioned elsewhere, this same `uint256` might already be in-flight (from the same peer or another) as a WTX, but because the map keys have all been changed to be by `GenTxid`, this would go undetected.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T18:07:26Z",
      "diff_hunk" : "@@ -2992,17 +2994,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460209907",
      "id" : 460209907,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDIwOTkwNw==",
      "original_commit_id" : "b5ef3470bd7cf5a51e3e1b14380a23f652145126",
      "original_line" : 3000,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 455065530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460209907",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460219698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460219698"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The reason I'm changing it here is because I have a hard time reasoning about the consistency of the various data structures around tx requesting if we don't. That, plus the fact that I don't really see a way to maintain the same behaviour sanely in #19184 where I'd hope to not duplicate the information any more.\r\n\r\nCould this be addressed by instead testing for both WTX+wtxid and TX+wtxid?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-24T18:28:02Z",
      "diff_hunk" : "@@ -459,7 +459,7 @@ struct CNodeState {\n };\n \n // Keeps track of the time (in microseconds) when transactions were requested last time\n-limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\n+limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460219698",
      "id" : 460219698,
      "in_reply_to_id" : 460192659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDIxOTY5OA==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 462,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455099718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460219698",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460432867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460432867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I haven't yet reviewed #19184, so I'll try to do that to get a better sense of what you're referring to.\r\n\r\n> Could this be addressed by instead testing for both WTX+wtxid and TX+wtxid?\r\n\r\nI think that would also work, but if that's how we would do all lookups into `g_already_asked_for`, I don't know why we'd bother with that complexity? \r\n\r\nTo be clear, my suggested change is fairly minimal code:\r\n\r\n```diff\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 6cee368ed72..36c890e395b 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -459,7 +459,7 @@ struct CNodeState {\r\n };\r\n \r\n // Keeps track of the time (in microseconds) when transactions were requested last time\r\n-limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\r\n+limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\r\n \r\n /** Map maintaining per-node state. */\r\n static std::map<NodeId, CNodeState> mapNodeState GUARDED_BY(cs_main);\r\n@@ -756,12 +756,12 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\r\n \r\n void EraseTxRequest(const GenTxid& gtxid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n {\r\n-    g_already_asked_for.erase(gtxid);\r\n+    g_already_asked_for.erase(gtxid.GetHash());\r\n }\r\n \r\n std::chrono::microseconds GetTxRequestTime(const GenTxid& gtxid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n {\r\n-    auto it = g_already_asked_for.find(gtxid);\r\n+    auto it = g_already_asked_for.find(gtxid.GetHash());\r\n     if (it != g_already_asked_for.end()) {\r\n         return it->second;\r\n     }\r\n@@ -770,9 +770,9 @@ std::chrono::microseconds GetTxRequestTime(const GenTxid& gtxid) EXCLUSIVE_LOCKS\r\n \r\n void UpdateTxRequestTime(const GenTxid& gtxid, std::chrono::microseconds request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n {\r\n-    auto it = g_already_asked_for.find(gtxid);\r\n+    auto it = g_already_asked_for.find(gtxid.GetHash());\r\n     if (it == g_already_asked_for.end()) {\r\n-        g_already_asked_for.insert(std::make_pair(gtxid, request_time));\r\n+        g_already_asked_for.insert(std::make_pair(gtxid.GetHash(), request_time));\r\n     } else {\r\n         g_already_asked_for.update(it, request_time);\r\n     }\r\n```\r\n\r\nThis would capture my understanding of the `g_already_asked_for` data structure: when scheduling transaction requests, we don't care how a given txid/wtxid was requested (via txid or wtxid), just that a getdata for that hash was sent out at a certain time.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-25T18:47:44Z",
      "diff_hunk" : "@@ -459,7 +459,7 @@ struct CNodeState {\n };\n \n // Keeps track of the time (in microseconds) when transactions were requested last time\n-limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\n+limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460432867",
      "id" : 460432867,
      "in_reply_to_id" : 460192659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMjg2Nw==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 462,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455302847,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460432867",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460436847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460436847"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see.\r\n\r\nIt's just a question of whether we treat the tx request data as conceptually \"keyed\" by hash (and seeing is_wtxid as metadata along with the request), or by (is_wtxid, hash). The fact that we may want to treat a wtxid request for the same hash as a txid request is a sign that it should probably be the first.\r\n\r\nI picked the (is_wtxid, hash} based keying first as it seemed easier to reason about, but if consistently applied (treating all requests for the same hash as identical), there doesn't seem to be much difference.\r\n\r\nBoth are possible to integrate into #19184, with not much complexity difference. But it has to be consistent - we can't be treating them as identical in some cases, and differentiate in others.\r\n\r\nI think this would also mean making `m_tx_in_flight` and `m_tx_announced` be hash-keyed (as @ajtowns' original patch did)?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-25T19:34:31Z",
      "diff_hunk" : "@@ -459,7 +459,7 @@ struct CNodeState {\n };\n \n // Keeps track of the time (in microseconds) when transactions were requested last time\n-limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\n+limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460436847",
      "id" : 460436847,
      "in_reply_to_id" : 460192659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzNjg0Nw==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 462,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455305392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460436847",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460448528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460448528"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-25T21:29:19Z",
      "diff_hunk" : "@@ -459,7 +459,7 @@ struct CNodeState {\n };\n \n // Keeps track of the time (in microseconds) when transactions were requested last time\n-limitedmap<uint256, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\n+limitedmap<GenTxid, std::chrono::microseconds> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460448528",
      "id" : 460448528,
      "in_reply_to_id" : 460192659,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0ODUyOA==",
      "original_commit_id" : "378a8bd641fa608c0c911d9f473dbc27cc79ee8c",
      "original_line" : 462,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455316976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460448528",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Changed the code to treat tx announcements as keyed by hash (rather than hash+wtxidness), so that txid requests for parents of unconfirmed transactions won't result in a duplicate query if a wtxid with the same hash is already in flight. This reduces the diff a bit as well, and removed the need for ToString().",
      "created_at" : "2020-07-25T21:31:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-663908280",
      "id" : 663908280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MzkwODI4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-25T21:31:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663908280",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I have a hard time reasoning about the consistency of the various data structures around tx requesting if we don't.\r\n\r\nI 100% agree with this. Net processing is complicated enough as it is without having data structures hold a mixture of different types. txids and wtxids are different types that just happen to both be encoded in a uint256, which means the compiler can't protect us from bugs where we mistake one for the other.\r\n\r\nIf we're going to do this, we should at least make it very clear to the programmer by adding comments to the data structures and functions that are doing this. For example, `EraseTxRequest()`, `GetTxRequestTime()`and `UpdateTxRequestTime()` all have a parameter named `txid`. Anyone reading/reviewing that code would therefore expect those parameters to be txids (and by extension, `g_already_asked_for` to be keyed by txid).",
      "created_at" : "2020-07-26T08:28:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-663958303",
      "id" : 663958303,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Mzk1ODMwMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-26T08:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663958303",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460499947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460499947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ed2c0b97baa\r\n```suggestion\r\n        for (const uint256& hash : {txid, wtxid}) {\r\n```",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-26T08:53:43Z",
      "diff_hunk" : "@@ -2936,9 +2938,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (uint256 hash : {txid, wtxid}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460499947",
      "id" : 460499947,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ5OTk0Nw==",
      "original_commit_id" : "707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "original_line" : 2941,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455345378,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460499947",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460528111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460528111"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is there a good reason to not use a `CInv` as the value here, rather than creating a new class just for use here?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-26T13:29:16Z",
      "diff_hunk" : "@@ -401,7 +401,7 @@ struct CNodeState {\n         /* Track when to attempt download of announced transactions (process\n          * time in micros -> txid)\n          */\n-        std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n+        std::multimap<std::chrono::microseconds, GenTxid> m_tx_process_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460528111",
      "id" : 460528111,
      "line" : 401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUyODExMQ==",
      "original_commit_id" : "707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "original_line" : 401,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 455364627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460528111",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460547180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460547180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I have a follow-up PR that changes several functions to take a GenTxid instead of is_wtxid/txid_or_wtxid arguments.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-26T16:30:42Z",
      "diff_hunk" : "@@ -401,7 +401,7 @@ struct CNodeState {\n         /* Track when to attempt download of announced transactions (process\n          * time in micros -> txid)\n          */\n-        std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n+        std::multimap<std::chrono::microseconds, GenTxid> m_tx_process_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460547180",
      "id" : 460547180,
      "in_reply_to_id" : 460528111,
      "line" : 401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU0NzE4MA==",
      "original_commit_id" : "707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "original_line" : 401,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 455378112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460547180",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery Would it help if the various txrequest-related functions take a GenTxid argument, but where appropriate, call GetHash() on it when they really just need a txid-or-wtxid key, instead of passing those keys around as uint256s?",
      "created_at" : "2020-07-26T17:02:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664014014",
      "id" : 664014014,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDAxNDAxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-26T17:02:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664014014",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK, apart from the test change which I haven't reviewed.  Will test.",
      "created_at" : "2020-07-26T19:29:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664030337",
      "id" : 664030337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDAzMDMzNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-26T19:29:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664030337",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "created_at" : "2020-07-26T21:43:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664044340",
      "id" : 664044340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDA0NDM0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-26T21:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664044340",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460699267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460699267"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is a behavior change? We used to call it once on txid OR wtxid, now you calling it twice?\r\n\r\nThat's probably fine, but why use this for loop at all? `hash` is already defined above, depending on the peer's wtxid support",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T07:34:35Z",
      "diff_hunk" : "@@ -2936,9 +2936,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (uint256 hash : {txid, wtxid}) {\n+            nodestate->m_tx_download.m_tx_announced.erase(hash);\n+            nodestate->m_tx_download.m_tx_in_flight.erase(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460699267",
      "id" : 460699267,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5OTI2Nw==",
      "original_commit_id" : "ed2c0b97baa02df959dcceea7b545d1ac1414ce9",
      "original_line" : 2941,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455540655,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460699267",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460704719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460704719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Worst case this causes us to request/track the same transaction twice?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T07:45:18Z",
      "diff_hunk" : "@@ -2992,17 +2994,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460704719",
      "id" : 460704719,
      "in_reply_to_id" : 460209907,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDcxOQ==",
      "original_commit_id" : "b5ef3470bd7cf5a51e3e1b14380a23f652145126",
      "original_line" : 3000,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 455547574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460704719",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460705311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460705311"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I already changed the code to address this.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T07:46:32Z",
      "diff_hunk" : "@@ -2992,17 +2994,15 @@ void ProcessMessage(\n                 uint32_t nFetchFlags = GetFetchFlags(pfrom);\n                 const auto current_time = GetTime<std::chrono::microseconds>();\n \n-                if (!State(pfrom.GetId())->m_wtxid_relay) {\n-                    for (const CTxIn& txin : tx.vin) {\n-                        // Here, we only have the txid (and not wtxid) of the\n-                        // inputs, so we only request parents from\n-                        // non-wtxid-relay peers.\n-                        // Eventually we should replace this with an improved\n-                        // protocol for getting all unconfirmed parents.\n-                        CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n-                        pfrom.AddKnownTx(txin.prevout.hash);\n-                        if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);\n-                    }\n+                for (const CTxIn& txin : tx.vin) {\n+                    // Here, we only have the txid (and not wtxid) of the\n+                    // inputs, so we only request in txid mode, even for\n+                    // wtxidrelay peers.\n+                    // Eventually we should replace this with an improved\n+                    // protocol for getting all unconfirmed parents.\n+                    CInv _inv(MSG_TX | nFetchFlags, txin.prevout.hash);\n+                    pfrom.AddKnownTx(txin.prevout.hash);\n+                    if (!AlreadyHave(_inv, mempool)) RequestTx(State(pfrom.GetId()), ToGenTxid(_inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460705311",
      "id" : 460705311,
      "in_reply_to_id" : 460209907,
      "line" : 3000,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNTMxMQ==",
      "original_commit_id" : "b5ef3470bd7cf5a51e3e1b14380a23f652145126",
      "original_line" : 3000,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 193,
      "pull_request_review_id" : 455548339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460705311",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460711295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460711295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Before, we only ever asked for hashes in one way from a peer, so it was sufficient to only erase that one.\n\nThat's no longer the case: outgoing GETDATA requests may be txid or wtxid based, and we don't remember which of the two (it depends on whether it was in response to an INV, or a request for an orphan parent), so either we track that, or just delete both.\n\nIt's of course a change in behavior, but that's the point: we're now requesting orphans from wtxidrelay peers (using txid requests), and this is one of the consequences.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T07:57:50Z",
      "diff_hunk" : "@@ -2936,9 +2936,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (uint256 hash : {txid, wtxid}) {\n+            nodestate->m_tx_download.m_tx_announced.erase(hash);\n+            nodestate->m_tx_download.m_tx_in_flight.erase(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460711295",
      "id" : 460711295,
      "in_reply_to_id" : 460699267,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxMTI5NQ==",
      "original_commit_id" : "ed2c0b97baa02df959dcceea7b545d1ac1414ce9",
      "original_line" : 2941,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455555670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460711295",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460714058"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460714058"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see how it works now.\r\nPart of my confusion was that it's part of the \"refactor\" commit, perhaps better belongs to the next commit.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T08:03:06Z",
      "diff_hunk" : "@@ -2936,9 +2936,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (uint256 hash : {txid, wtxid}) {\n+            nodestate->m_tx_download.m_tx_announced.erase(hash);\n+            nodestate->m_tx_download.m_tx_in_flight.erase(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460714058",
      "id" : 460714058,
      "in_reply_to_id" : 460699267,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcxNDA1OA==",
      "original_commit_id" : "ed2c0b97baa02df959dcceea7b545d1ac1414ce9",
      "original_line" : 2941,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 455559206,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460714058",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "created_at" : "2020-07-27T09:19:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664232191",
      "id" : 664232191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDIzMjE5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-27T09:19:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664232191",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19611 (p2p: refactor CInv::type from public int to private uint32_t by jonatack)\n* #19610 (p2p, refactor: add `CInv` block message helpers; use in net processing by jonatack)\n* #19596 (Deduplicate parent txid loop of requested transactions and missing parents of orphan transactions by sdaftuar)\n* #19556 (Remove mempool global by MarcoFalke)\n* #19031 (Implement ADDRv2 support (part of BIP155) by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-07-27T10:48:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664311281",
      "id" : 664311281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDMxMTI4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T04:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664311281",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461179757"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461179757"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added those commits to this PR.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T21:26:05Z",
      "diff_hunk" : "@@ -401,7 +401,7 @@ struct CNodeState {\n         /* Track when to attempt download of announced transactions (process\n          * time in micros -> txid)\n          */\n-        std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n+        std::multimap<std::chrono::microseconds, GenTxid> m_tx_process_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461179757",
      "id" : 461179757,
      "in_reply_to_id" : 460528111,
      "line" : 401,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3OTc1Nw==",
      "original_commit_id" : "707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "original_line" : 401,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 14,
      "pull_request_review_id" : 456147106,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461179757",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461179966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461179966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, together with an additional commit to changes it to `GenTxids`.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-27T21:26:27Z",
      "diff_hunk" : "@@ -2936,9 +2938,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (uint256 hash : {txid, wtxid}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461179966",
      "id" : 461179966,
      "in_reply_to_id" : 460499947,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3OTk2Ng==",
      "original_commit_id" : "707d0f4b0b0f21bbc9f962119fb130e4cceec6dc",
      "original_line" : 2941,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 456147323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461179966",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I added 3 extra commits that introduce more `GenTxid` uses, without changing behavior.",
      "created_at" : "2020-07-27T21:28:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664648005",
      "id" : 664648005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDY0ODAwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-27T21:28:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664648005",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c048357f2421eb7a5b81375be267e71fd2d80334",
      "created_at" : "2020-07-27T22:50:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664677749",
      "id" : 664677749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDY3Nzc0OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-27T22:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664677749",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461371724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461371724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: var name should be gtxid",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-28T07:23:13Z",
      "diff_hunk" : "@@ -716,22 +716,24 @@ class CTxMemPool\n         return totalTxSize;\n     }\n \n-    bool exists(const uint256& hash, bool wtxid=false) const\n+    bool exists(const GenTxid& txid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461371724",
      "id" : 461371724,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM3MTcyNA==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 719,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 456366412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461371724",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461371925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461371925"
         }
      },
      "author_association" : "MEMBER",
      "body" : "other places in this commit too: c048357f2421eb7a5b81375be267e71fd2d80334",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-28T07:23:36Z",
      "diff_hunk" : "@@ -716,22 +716,24 @@ class CTxMemPool\n         return totalTxSize;\n     }\n \n-    bool exists(const uint256& hash, bool wtxid=false) const\n+    bool exists(const GenTxid& txid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r461371925",
      "id" : 461371925,
      "in_reply_to_id" : 461371724,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM3MTkyNQ==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 719,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 456366671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/461371925",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c048357",
      "created_at" : "2020-07-28T07:24:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-664827136",
      "id" : 664827136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NDgyNzEzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-28T07:24:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/664827136",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462252378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462252378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Consider renaming `txid_or_wtxid` to `gtxid` to match other functions.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-29T12:14:41Z",
      "diff_hunk" : "@@ -1676,9 +1675,9 @@ void static ProcessGetBlockData(CNode& pfrom, const CChainParams& chainparams, c\n }\n \n //! Determine whether or not a peer can request a transaction, and return it (or nullptr if not found or not allowed).\n-CTransactionRef static FindTxForGetData(const CNode& peer, const uint256& txid_or_wtxid, bool use_wtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now) LOCKS_EXCLUDED(cs_main)\n+CTransactionRef static FindTxForGetData(const CNode& peer, const GenTxid& txid_or_wtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now) LOCKS_EXCLUDED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462252378",
      "id" : 462252378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MjM3OA==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 1678,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 457461115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462252378",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462252929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462252929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sort plz",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-29T12:15:44Z",
      "diff_hunk" : "@@ -10,6 +10,7 @@\n #ifndef BITCOIN_PROTOCOL_H\n #define BITCOIN_PROTOCOL_H\n \n+#include <primitives/transaction.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462252929",
      "id" : 462252929,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MjkyOQ==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 13,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 457461115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462252929",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462267221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462267221"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree with @naumenkogs (https://github.com/bitcoin/bitcoin/pull/19569#discussion_r460714058) that this change should be introduced in _p2p: enable fetching of orphans from wtxid peers_ instead of _refactor: add GenTxid (=txid or wtxid) type and use it for tx request logic_",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-29T12:41:29Z",
      "diff_hunk" : "@@ -2936,9 +2937,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (const GenTxid& gtxid : {GenTxid(false, txid), GenTxid(true, wtxid)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462267221",
      "id" : 462267221,
      "line" : 2936,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI2NzIyMQ==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2936,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 162,
      "pull_request_review_id" : 457461115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462267221",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Light ACK c048357f2421eb7a5b81375be267e71fd2d80334 modulo Gleb's and John's feedback above.",
      "created_at" : "2020-07-30T06:48:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-666163328",
      "id" : 666163328,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjE2MzMyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T06:48:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666163328",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462887483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462887483"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`ToGenTxid()` expects that we constructed the `CInv` ourselves or that we verified that it's for a transaction type CInv. Here, the only guarantee that `inv` is transaction type is that AlreadyHave returns true for non-transaction and non-block type invs. That's not obvious and seems a bit brittle. Perhaps we should change this else branch into an `else if (inv.type == MSG_TX || inv.type == MSG_WITNESS_TX || inv.type == MSG_WTX)` to make this safer?",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T09:58:55Z",
      "diff_hunk" : "@@ -2683,7 +2684,7 @@ void ProcessMessage(\n                     pfrom.fDisconnect = true;\n                     return;\n                 } else if (!fAlreadyHave && !chainman.ActiveChainstate().IsInitialBlockDownload()) {\n-                    RequestTx(State(pfrom.GetId()), inv.hash, current_time);\n+                    RequestTx(State(pfrom.GetId()), ToGenTxid(inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462887483",
      "id" : 462887483,
      "line" : 2683,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4NzQ4Mw==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2683,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 151,
      "pull_request_review_id" : 458258769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462887483",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462902569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462902569"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it'd be better if `AlreadyHave` was split into different functions for block and tx, and the tx version took a GenTxid. Could be done in a follow up. I have a branch here that does that: https://github.com/jnewbery/bitcoin/tree/2020-07-split-already-have",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T10:27:55Z",
      "diff_hunk" : "@@ -2683,7 +2684,7 @@ void ProcessMessage(\n                     pfrom.fDisconnect = true;\n                     return;\n                 } else if (!fAlreadyHave && !chainman.ActiveChainstate().IsInitialBlockDownload()) {\n-                    RequestTx(State(pfrom.GetId()), inv.hash, current_time);\n+                    RequestTx(State(pfrom.GetId()), ToGenTxid(inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r462902569",
      "id" : 462902569,
      "in_reply_to_id" : 462887483,
      "line" : 2683,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMjU2OQ==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2683,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 151,
      "pull_request_review_id" : 458277730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/462902569",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T14:28:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-666399932",
      "id" : 666399932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjM5OTkzMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T14:28:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666399932",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463108297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463108297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> `else if (inv.type == MSG_TX || inv.type == MSG_WITNESS_TX || inv.type == MSG_WTX)` to make this safer?\r\n\r\nper change in `protocol.h:L447` this would now be simpler: `else if (inv.IsGenTxMsg())`\r\n",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T16:07:48Z",
      "diff_hunk" : "@@ -2683,7 +2684,7 @@ void ProcessMessage(\n                     pfrom.fDisconnect = true;\n                     return;\n                 } else if (!fAlreadyHave && !chainman.ActiveChainstate().IsInitialBlockDownload()) {\n-                    RequestTx(State(pfrom.GetId()), inv.hash, current_time);\n+                    RequestTx(State(pfrom.GetId()), ToGenTxid(inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463108297",
      "id" : 463108297,
      "in_reply_to_id" : 462887483,
      "line" : 2683,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEwODI5Nw==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2683,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 151,
      "pull_request_review_id" : 458548871,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463108297",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261444"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're right; moved it to the other commit.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T20:46:51Z",
      "diff_hunk" : "@@ -2936,9 +2936,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (uint256 hash : {txid, wtxid}) {\n+            nodestate->m_tx_download.m_tx_announced.erase(hash);\n+            nodestate->m_tx_download.m_tx_in_flight.erase(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261444",
      "id" : 463261444,
      "in_reply_to_id" : 460699267,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MTQ0NA==",
      "original_commit_id" : "ed2c0b97baa02df959dcceea7b545d1ac1414ce9",
      "original_line" : 2941,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 458744151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:46:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261444",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T20:47:05Z",
      "diff_hunk" : "@@ -716,22 +716,24 @@ class CTxMemPool\n         return totalTxSize;\n     }\n \n-    bool exists(const uint256& hash, bool wtxid=false) const\n+    bool exists(const GenTxid& txid) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261543",
      "id" : 463261543,
      "in_reply_to_id" : 461371724,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MTU0Mw==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 719,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 458744280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261543",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261619"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T20:47:13Z",
      "diff_hunk" : "@@ -1676,9 +1675,9 @@ void static ProcessGetBlockData(CNode& pfrom, const CChainParams& chainparams, c\n }\n \n //! Determine whether or not a peer can request a transaction, and return it (or nullptr if not found or not allowed).\n-CTransactionRef static FindTxForGetData(const CNode& peer, const uint256& txid_or_wtxid, bool use_wtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now) LOCKS_EXCLUDED(cs_main)\n+CTransactionRef static FindTxForGetData(const CNode& peer, const GenTxid& txid_or_wtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now) LOCKS_EXCLUDED(cs_main)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261619",
      "id" : 463261619,
      "in_reply_to_id" : 462252378,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MTYxOQ==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 1678,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 458744369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261619",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261665"
         }
      },
      "author_association" : "MEMBER",
      "body" : "don.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T20:47:21Z",
      "diff_hunk" : "@@ -10,6 +10,7 @@\n #ifndef BITCOIN_PROTOCOL_H\n #define BITCOIN_PROTOCOL_H\n \n+#include <primitives/transaction.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261665",
      "id" : 463261665,
      "in_reply_to_id" : 462252929,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MTY2NQ==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 13,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 458744452,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:47:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261665",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261736"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T20:47:29Z",
      "diff_hunk" : "@@ -2936,9 +2937,11 @@ void ProcessMessage(\n \n         TxValidationState state;\n \n-        nodestate->m_tx_download.m_tx_announced.erase(hash);\n-        nodestate->m_tx_download.m_tx_in_flight.erase(hash);\n-        EraseTxRequest(hash);\n+        for (const GenTxid& gtxid : {GenTxid(false, txid), GenTxid(true, wtxid)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463261736",
      "id" : 463261736,
      "in_reply_to_id" : 462267221,
      "line" : 2936,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MTczNg==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2936,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 162,
      "pull_request_review_id" : 458744559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:47:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463261736",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463262396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463262396"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Let's fix that by splitting AlreadyHave up separately.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-30T20:48:46Z",
      "diff_hunk" : "@@ -2683,7 +2684,7 @@ void ProcessMessage(\n                     pfrom.fDisconnect = true;\n                     return;\n                 } else if (!fAlreadyHave && !chainman.ActiveChainstate().IsInitialBlockDownload()) {\n-                    RequestTx(State(pfrom.GetId()), inv.hash, current_time);\n+                    RequestTx(State(pfrom.GetId()), ToGenTxid(inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r463262396",
      "id" : 463262396,
      "in_reply_to_id" : 462887483,
      "line" : 2683,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MjM5Ng==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2683,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 151,
      "pull_request_review_id" : 458745402,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-30T20:48:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463262396",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and addressed comments.",
      "created_at" : "2020-07-30T20:49:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-666686843",
      "id" : 666686843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjY4Njg0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T20:49:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666686843",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK 10b7a6d532148f880568c529e61a6d7edc7c91a9 -- code review. Using gtxid to replace the is_txid_or_wtxid flag for the mempool functions is nice.",
      "created_at" : "2020-07-31T06:23:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-666951196",
      "id" : 666951196,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Njk1MTE5Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T06:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666951196",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 10b7a6d",
      "created_at" : "2020-07-31T07:19:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-666974158",
      "id" : 666974158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Njk3NDE1OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T07:19:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666974158",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-31T08:06:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-666993517",
      "id" : 666993517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2Njk5MzUxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T08:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666993517",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-07-31T11:13:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-667068668",
      "id" : 667068668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NzA2ODY2OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T11:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667068668",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have a backport of (the first 4 commits of) this to v0.20 here: https://github.com/jnewbery/bitcoin/tree/2020-07-v20-wtxid-orphan. It can be added to #19606 or PR'ed separately. Whatever is easiest for reviewers.",
      "created_at" : "2020-07-31T13:20:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-667116307",
      "id" : 667116307,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NzExNjMwNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-31T13:20:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667116307",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r467467113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467467113"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done in #19610.",
      "commit_id" : "10b7a6d532148f880568c529e61a6d7edc7c91a9",
      "created_at" : "2020-08-08T13:52:23Z",
      "diff_hunk" : "@@ -2683,7 +2684,7 @@ void ProcessMessage(\n                     pfrom.fDisconnect = true;\n                     return;\n                 } else if (!fAlreadyHave && !chainman.ActiveChainstate().IsInitialBlockDownload()) {\n-                    RequestTx(State(pfrom.GetId()), inv.hash, current_time);\n+                    RequestTx(State(pfrom.GetId()), ToGenTxid(inv), current_time);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#discussion_r467467113",
      "id" : 467467113,
      "in_reply_to_id" : 462887483,
      "line" : 2683,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ2NzExMw==",
      "original_commit_id" : "c048357f2421eb7a5b81375be267e71fd2d80334",
      "original_line" : 2683,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 151,
      "pull_request_review_id" : 463804398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19569",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-08-08T13:52:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/467467113",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Backported to 0.20 in #20317",
      "created_at" : "2020-11-05T15:40:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19569#issuecomment-722457108",
      "id" : 722457108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19569",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMjQ1NzEwOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-05T15:40:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/722457108",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
