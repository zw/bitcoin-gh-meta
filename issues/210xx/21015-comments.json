[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21261 (p2p, test: add inbound eviction protection for I2P peers by jonatack)\n* #21186 (Net/Net Processing: Move addr data into net_processing by jnewbery)\n* #21160 (Net/Net processing: Move tx inventory into net_processing by jnewbery)\n* #20197 (p2p: protect onions in AttemptToEvictConnection(), add eviction protection test coverage by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-01-27T01:24:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-767943601",
      "id" : 767943601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2Nzk0MzYwMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-22T05:05:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/767943601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I am still working on figuring out why `test/functional/wallet_groups.py` is failing with an off-by-one error only on some platforms. In the meantime, ready for initial review.",
      "created_at" : "2021-01-27T06:02:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-768054110",
      "id" : 768054110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODA1NDExMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T06:15:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768054110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565054974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565054974"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit bbc01cf8b2965f716e899f413d36e2beb48c1f06: what is this?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T06:21:29Z",
      "diff_hunk" : "@@ -70,6 +70,7 @@ def run_test(self):\n             # Tell scheduler to call MaybeResendWalletTxn now.\n             node.mockscheduler(1)\n         # Give some time for trickle to occur\n+        time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565054974",
      "id" : 565054974,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTA1NDk3NA==",
      "original_commit_id" : "bbc01cf8b2965f716e899f413d36e2beb48c1f06",
      "original_line" : 73,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 577015045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565054974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565060262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565060262"
         }
      },
      "author_association" : "MEMBER",
      "body" : "you dropped the `-`",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T06:36:07Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    double scaled = unscaled * count_microseconds(average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565060262",
      "id" : 565060262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTA2MDI2Mg==",
      "original_commit_id" : "f4bc3c67795e0e9c4d170869a8000433f2bdc12d",
      "original_line" : 2934,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577015045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565060262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. This refactoring should only be changing the types at compile-time, not any values at run time.",
      "created_at" : "2021-01-27T06:38:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-768069372",
      "id" : 768069372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODA2OTM3Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T06:38:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768069372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565069299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565069299"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This was originally in d7fad1690c27bf270774da6eebc4ef8b550caf09. However, i just ran the test without the line and it seems to not be needed. Removed.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T06:59:21Z",
      "diff_hunk" : "@@ -70,6 +70,7 @@ def run_test(self):\n             # Tell scheduler to call MaybeResendWalletTxn now.\n             node.mockscheduler(1)\n         # Give some time for trickle to occur\n+        time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565069299",
      "id" : 565069299,
      "in_reply_to_id" : 565054974,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTA2OTI5OQ==",
      "original_commit_id" : "bbc01cf8b2965f716e899f413d36e2beb48c1f06",
      "original_line" : 73,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 577031791,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565069299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565071275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565071275"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to keep an empty commit  d5a0f24807d5423469824efe8253c8e809b2044b",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T07:04:18Z",
      "diff_hunk" : "@@ -70,6 +70,7 @@ def run_test(self):\n             # Tell scheduler to call MaybeResendWalletTxn now.\n             node.mockscheduler(1)\n         # Give some time for trickle to occur\n+        time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565071275",
      "id" : 565071275,
      "in_reply_to_id" : 565054974,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTA3MTI3NQ==",
      "original_commit_id" : "bbc01cf8b2965f716e899f413d36e2beb48c1f06",
      "original_line" : 73,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 577034242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565071275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565074405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565074405"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the catch!",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T07:11:49Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    double scaled = unscaled * count_microseconds(average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565074405",
      "id" : 565074405,
      "in_reply_to_id" : 565060262,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTA3NDQwNQ==",
      "original_commit_id" : "f4bc3c67795e0e9c4d170869a8000433f2bdc12d",
      "original_line" : 2934,
      "original_position" : 119,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577037984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565074405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565074784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565074784"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T07:12:51Z",
      "diff_hunk" : "@@ -70,6 +70,7 @@ def run_test(self):\n             # Tell scheduler to call MaybeResendWalletTxn now.\n             node.mockscheduler(1)\n         # Give some time for trickle to occur\n+        time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565074784",
      "id" : 565074784,
      "in_reply_to_id" : 565054974,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTA3NDc4NA==",
      "original_commit_id" : "bbc01cf8b2965f716e899f413d36e2beb48c1f06",
      "original_line" : 73,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/wallet_resendwallettransactions.py",
      "position" : null,
      "pull_request_review_id" : 577038512,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565074784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565135678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565135678"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35: Can use `0us`, like above, which is shorter",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:04:15Z",
      "diff_hunk" : "@@ -588,9 +588,9 @@ class CNode\n     /** When the last ping was sent, or 0 if no ping was ever sent */\n     std::atomic<std::chrono::microseconds> m_ping_start{0us};\n     // Last measured round-trip time.\n-    std::atomic<int64_t> nPingUsecTime{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{std::chrono::microseconds{0}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565135678",
      "id" : 565135678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTEzNTY3OA==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 591,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565135678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565137023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565137023"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same commit: Can use `ping_time == 0us`, which is shorter",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:06:12Z",
      "diff_hunk" : "@@ -811,9 +813,11 @@ QString formatServicesStr(quint64 mask)\n         return QObject::tr(\"None\");\n }\n \n-QString formatPingTime(int64_t ping_usec)\n+QString formatPingTime(std::chrono::microseconds ping_time)\n {\n-    return (ping_usec == std::numeric_limits<int64_t>::max() || ping_usec == 0) ? QObject::tr(\"N/A\") : QString(QObject::tr(\"%1 ms\")).arg(QString::number((int)(ping_usec / 1000), 10));\n+    return (ping_time == std::chrono::microseconds::max() || ping_time.count() == 0) ?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565137023",
      "id" : 565137023,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTEzNzAyMw==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 818,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/qt/guiutil.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565137023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565138476"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565138476"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35: Why is this changed?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:08:17Z",
      "diff_hunk" : "@@ -238,8 +240,8 @@ namespace GUIUtil\n     /** Format CNodeStats.nServices bitmask into a user-readable string */\n     QString formatServicesStr(quint64 mask);\n \n-    /** Format a CNodeStats.m_ping_usec into a user-readable string or display N/A, if 0 */\n-    QString formatPingTime(int64_t ping_usec);\n+    /* Format a CNodeStats.m_ping_time into a user-readable string or display N/A, if 0*/",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565138476",
      "id" : 565138476,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTEzODQ3Ng==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 243,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/qt/guiutil.h",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565138476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565139181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565139181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35: Can use `time > 0us`, which is shorter",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:09:24Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time.count() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565139181",
      "id" : 565139181,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTEzOTE4MQ==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 206,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565139181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565139786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565139786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:10:16Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time.count() > 0) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);\n         }\n-        if (stats.m_min_ping_usec < std::numeric_limits<int64_t>::max()) {\n-            obj.pushKV(\"minping\", ((double)stats.m_min_ping_usec) / 1e6);\n+        if (stats.m_min_ping_time < std::chrono::microseconds::max()) {\n+            obj.pushKV(\"minping\", count_microseconds(stats.m_min_ping_time) * 0.000001);\n         }\n-        if (stats.m_ping_wait_usec > 0) {\n-            obj.pushKV(\"pingwait\", ((double)stats.m_ping_wait_usec) / 1e6);\n+        if (stats.m_ping_wait.count() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565139786",
      "id" : 565139786,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTEzOTc4Ng==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 212,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565139786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565140500"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565140500"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unrelated style-nit: Could use named args, like in `src/test/net_tests.cpp`?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:11:10Z",
      "diff_hunk" : "@@ -23,7 +23,7 @@ FUZZ_TARGET(node_eviction)\n         eviction_candidates.push_back({\n             fuzzed_data_provider.ConsumeIntegral<NodeId>(),\n             fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int64_t>()},\n             fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n             fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n             fuzzed_data_provider.ConsumeBool(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565140500",
      "id" : 565140500,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE0MDUwMA==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 29,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/fuzz/node_eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565140500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565142431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565142431"
         }
      },
      "author_association" : "MEMBER",
      "body" : "if you are changing whitespace, it would be good to do it right. One space too much here",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:13:45Z",
      "diff_hunk" : "@@ -899,10 +899,10 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n             // Combination of all tests above.\n             BOOST_CHECK(!IsEvicted(\n                 number_of_nodes, [number_of_nodes](NodeEvictionCandidate& candidate) {\n-                    candidate.nKeyedNetGroup = number_of_nodes - candidate.id; // 4 protected\n-                    candidate.nMinPingUsecTime = candidate.id;                 // 8 protected\n-                    candidate.nLastTXTime = number_of_nodes - candidate.id;    // 4 protected\n-                    candidate.nLastBlockTime = number_of_nodes - candidate.id; // 4 protected\n+                    candidate.nKeyedNetGroup = number_of_nodes - candidate.id;            // 4 protected",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565142431",
      "id" : 565142431,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE0MjQzMQ==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 902,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565142431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565142762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565142762"
         }
      },
      "author_association" : "MEMBER",
      "body" : "two spaces before `=`",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:14:09Z",
      "diff_hunk" : "@@ -610,9 +610,9 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     }\n \n     // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;\n-    stats.m_ping_wait_usec = count_microseconds(ping_wait);\n+    stats.m_ping_time = m_ping_time;\n+    stats.m_min_ping_time  = m_min_ping_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565142762",
      "id" : 565142762,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE0Mjc2Mg==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 614,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565142762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565143996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565143996"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit aa30fdfcc4e8801c3abd74468f849f6124815e10: Can use `15min`, which is shorter",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:15:53Z",
      "diff_hunk" : "@@ -45,8 +45,8 @@ static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes\n static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n /** Headers download timeout expressed in microseconds\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = std::chrono::minutes{15};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565143996",
      "id" : 565143996,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE0Mzk5Ng==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 48,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565143996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565145011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565145011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "aa30fdfcc4e8801c3abd74468f849f6124815e10: `2s`",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:17:19Z",
      "diff_hunk" : "@@ -93,8 +93,8 @@ static constexpr std::chrono::microseconds GETDATA_TX_INTERVAL{std::chrono::seco\n static const unsigned int MAX_GETDATA_SZ = 1000;\n /** Number of blocks that can be requested at any given time from a single peer. */\n static const int MAX_BLOCKS_IN_TRANSIT_PER_PEER = 16;\n-/** Timeout in seconds during which a peer must stall block download progress before being disconnected. */\n-static const unsigned int BLOCK_STALLING_TIMEOUT = 2;\n+/** Time during which a peer must stall block download progress before being disconnected. */\n+static constexpr auto BLOCK_STALLING_TIMEOUT = std::chrono::seconds{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565145011",
      "id" : 565145011,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE0NTAxMQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 97,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565145011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565156674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565156674"
         }
      },
      "author_association" : "MEMBER",
      "body" : "aa30fdfcc4e8801c3abd74468f849f6124815e10: `0us` on all three",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:33:38Z",
      "diff_hunk" : "@@ -572,9 +572,9 @@ struct CNodeState {\n         pindexBestHeaderSent = nullptr;\n         nUnconnectingHeaders = 0;\n         fSyncStarted = false;\n-        nHeadersSyncTimeout = 0;\n-        nStallingSince = 0;\n-        nDownloadingSince = 0;\n+        m_headers_sync_timeout = std::chrono::microseconds{0};\n+        m_stalling_since = std::chrono::microseconds{0};\n+        m_downloading_since = std::chrono::microseconds{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565156674",
      "id" : 565156674,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE1NjY3NA==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 577,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565156674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565157442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565157442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:34:49Z",
      "diff_hunk" : "@@ -624,11 +624,11 @@ static bool MarkBlockAsReceived(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs\n         }\n         if (state->vBlocksInFlight.begin() == itInFlight->second.second) {\n             // First block on the queue was received, update the start download time for the next one\n-            state->nDownloadingSince = std::max(state->nDownloadingSince, count_microseconds(GetTime<std::chrono::microseconds>()));\n+            state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n         }\n         state->vBlocksInFlight.erase(itInFlight->second.second);\n         state->nBlocksInFlight--;\n-        state->nStallingSince = 0;\n+        state->m_stalling_since = std::chrono::microseconds{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565157442",
      "id" : 565157442,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE1NzQ0Mg==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 631,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565157442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565159349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565159349"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why `((foo))` instead of `(foo)`?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:37:35Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * ((GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565159349",
      "id" : 565159349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE1OTM0OQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 4386,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565159349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565161588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565161588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0us",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:40:47Z",
      "diff_hunk" : "@@ -4738,13 +4738,13 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         // this peer (eventually).\n                         state.fSyncStarted = false;\n                         nSyncStarted--;\n-                        state.nHeadersSyncTimeout = 0;\n+                        state.m_headers_sync_timeout = std::chrono::microseconds{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565161588",
      "id" : 565161588,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2MTU4OA==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 4741,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565161588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565161799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565161799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`== 0us`",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:41:04Z",
      "diff_hunk" : "@@ -4768,8 +4768,8 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     pindex->nHeight, pto->GetId());\n             }\n             if (state.nBlocksInFlight == 0 && staller != -1) {\n-                if (State(staller)->nStallingSince == 0) {\n-                    State(staller)->nStallingSince = count_microseconds(current_time);\n+                if (State(staller)->m_stalling_since.count() == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565161799",
      "id" : 565161799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2MTc5OQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 4771,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565161799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565164331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565164331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc: `> 1min`",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:44:38Z",
      "diff_hunk" : "@@ -1788,7 +1788,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         // Note that we only do this if we started with an empty peers.dat,\n         // (in which case we will query DNS seeds immediately) *and* the DNS\n         // seeds have not returned any results.\n-        if (addrman.size() == 0 && (GetTime() - nStart > 60)) {\n+        if (addrman.size() == 0 && (GetTime<std::chrono::microseconds>() - start > std::chrono::minutes{1})) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565164331",
      "id" : 565164331,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2NDMzMQ==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 1791,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565164331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565167722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565167722"
         }
      },
      "author_association" : "MEMBER",
      "body" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc: Style nit: I'd say the minus goes conceptually before log1p: `-log1p(...)`. Putting it in the round-to-integer step seems confusing, because the negation is unrelated to rounding.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:49:20Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565167722",
      "id" : 565167722,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2NzcyMg==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 2933,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565167722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565167975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565167975"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2min",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:49:43Z",
      "diff_hunk" : "@@ -47,10 +47,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565167975",
      "id" : 565167975,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2Nzk3NQ==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 52,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565167975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565168106"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565168106"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5min",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:49:51Z",
      "diff_hunk" : "@@ -47,10 +47,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};\n /** Run the extra block-relay-only connection loop once every 5 minutes. **/\n-static const int EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL = 300;\n+static constexpr auto EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL = std::chrono::minutes{5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565168106",
      "id" : 565168106,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2ODEwNg==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 53,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565168106",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565168337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565168337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0us",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:50:14Z",
      "diff_hunk" : "@@ -1219,7 +1219,7 @@ class CConnman\n      */\n     std::atomic_bool m_start_extra_block_relay_peers{false};\n \n-    std::atomic<int64_t> m_next_send_inv_to_incoming{0};\n+    std::atomic<std::chrono::microseconds> m_next_send_inv_to_incoming{std::chrono::microseconds{0}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565168337",
      "id" : 565168337,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2ODMzNw==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 1222,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565168337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169020"
         }
      },
      "author_association" : "MEMBER",
      "body" : "24h",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:51:06Z",
      "diff_hunk" : "@@ -119,17 +119,17 @@ static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = std::chrono::hours{24};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169020",
      "id" : 565169020,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2OTAyMA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 122,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "30s",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:51:13Z",
      "diff_hunk" : "@@ -119,17 +119,17 @@ static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = std::chrono::hours{24};\n /** Average delay between peer address broadcasts */\n-static constexpr std::chrono::seconds AVG_ADDRESS_BROADCAST_INTERVAL{30};\n+static constexpr auto AVG_ADDRESS_BROADCAST_INTERVAL = std::chrono::seconds{30};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169112",
      "id" : 565169112,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2OTExMg==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 124,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169184"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5s",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:51:20Z",
      "diff_hunk" : "@@ -119,17 +119,17 @@ static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = std::chrono::hours{24};\n /** Average delay between peer address broadcasts */\n-static constexpr std::chrono::seconds AVG_ADDRESS_BROADCAST_INTERVAL{30};\n+static constexpr auto AVG_ADDRESS_BROADCAST_INTERVAL = std::chrono::seconds{30};\n /** Average delay between trickled inventory transmissions in seconds.\n  *  Blocks and peers with noban permission bypass this, outbound peers get half this delay. */\n-static const unsigned int INVENTORY_BROADCAST_INTERVAL = 5;\n+static constexpr auto INVENTORY_BROADCAST_INTERVAL = std::chrono::seconds{5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169184",
      "id" : 565169184,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2OTE4NA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 127,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same for those two",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:51:43Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ static constexpr unsigned int INVENTORY_MAX_RECENT_RELAY = 3500;\n  *  peers, and random variations in the broadcast mechanism. */\n static_assert(INVENTORY_MAX_RECENT_RELAY >= INVENTORY_BROADCAST_PER_SECOND * UNCONDITIONAL_RELAY_DELAY / std::chrono::seconds{1}, \"INVENTORY_RELAY_MAX too low\");\n /** Average delay between feefilter broadcasts in seconds. */\n-static constexpr unsigned int AVG_FEEFILTER_BROADCAST_INTERVAL = 10 * 60;\n+static constexpr auto AVG_FEEFILTER_BROADCAST_INTERVAL = std::chrono::minutes{10};\n /** Maximum feefilter broadcast delay after significant change. */\n-static constexpr unsigned int MAX_FEEFILTER_CHANGE_DELAY = 5 * 60;\n+static constexpr auto MAX_FEEFILTER_CHANGE_DELAY = std::chrono::minutes{5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565169416",
      "id" : 565169416,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE2OTQxNg==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 143,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565169416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565173767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565173767"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note to other reviewers: Division does not have any truncation warnings at compile time",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T09:57:54Z",
      "diff_hunk" : "@@ -4564,10 +4564,10 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->nNextInvSend < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = std::chrono::microseconds{m_connman.PoissonNextSendInbound(count_microseconds(current_time), INVENTORY_BROADCAST_INTERVAL)};\n+                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n                         // Use half the delay for outbound peers, as there is less privacy concern for them.\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, std::chrono::seconds{INVENTORY_BROADCAST_INTERVAL >> 1});\n+                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, INVENTORY_BROADCAST_INTERVAL / 2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565173767",
      "id" : 565173767,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE3Mzc2Nw==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 4570,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565173767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565183947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565183947"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you can simply assign this to `0`, as the goal is to send immediately",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T10:11:53Z",
      "diff_hunk" : "@@ -4822,24 +4822,24 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->lastSentFeeFilter == MAX_FILTER) {\n                     // Send the current filter if we sent MAX_FILTER previously\n                     // and made it out of IBD.\n-                    pto->m_tx_relay->nextSendTimeFeeFilter = count_microseconds(current_time) - 1;\n+                    pto->m_tx_relay->m_next_send_feefilter = current_time - std::chrono::microseconds{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565183947",
      "id" : 565183947,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE4Mzk0Nw==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 4825,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565183947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565186801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565186801"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit c9a8cbc64eddd98d2183380148a3d9c79c1bd7d2: 15min",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T10:15:59Z",
      "diff_hunk" : "@@ -40,9 +40,9 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = std::chrono::minutes{15};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565186801",
      "id" : 565186801,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTE4NjgwMQ==",
      "original_commit_id" : "c9a8cbc64eddd98d2183380148a3d9c79c1bd7d2",
      "original_line" : 43,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577115443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565186801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565527034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565527034"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This function is invoked with `CNodeStats:m_.*ping.*` variables in (for example) `rpcconsole.cpp:1105`. Those member variables are now chrono, so we updated this function.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T18:12:04Z",
      "diff_hunk" : "@@ -238,8 +240,8 @@ namespace GUIUtil\n     /** Format CNodeStats.nServices bitmask into a user-readable string */\n     QString formatServicesStr(quint64 mask);\n \n-    /** Format a CNodeStats.m_ping_usec into a user-readable string or display N/A, if 0 */\n-    QString formatPingTime(int64_t ping_usec);\n+    /* Format a CNodeStats.m_ping_time into a user-readable string or display N/A, if 0*/",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565527034",
      "id" : 565527034,
      "in_reply_to_id" : 565138476,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTUyNzAzNA==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 243,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/qt/guiutil.h",
      "position" : null,
      "pull_request_review_id" : 577623300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565527034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565533857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565533857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I mean, why are you removing the doxygen comment?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T18:22:12Z",
      "diff_hunk" : "@@ -238,8 +240,8 @@ namespace GUIUtil\n     /** Format CNodeStats.nServices bitmask into a user-readable string */\n     QString formatServicesStr(quint64 mask);\n \n-    /** Format a CNodeStats.m_ping_usec into a user-readable string or display N/A, if 0 */\n-    QString formatPingTime(int64_t ping_usec);\n+    /* Format a CNodeStats.m_ping_time into a user-readable string or display N/A, if 0*/",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565533857",
      "id" : 565533857,
      "in_reply_to_id" : 565138476,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTUzMzg1Nw==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 243,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/qt/guiutil.h",
      "position" : null,
      "pull_request_review_id" : 577631853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565533857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561266"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561266"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:04:23Z",
      "diff_hunk" : "@@ -588,9 +588,9 @@ class CNode\n     /** When the last ping was sent, or 0 if no ping was ever sent */\n     std::atomic<std::chrono::microseconds> m_ping_start{0us};\n     // Last measured round-trip time.\n-    std::atomic<int64_t> nPingUsecTime{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{std::chrono::microseconds{0}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561266",
      "id" : 565561266,
      "in_reply_to_id" : 565135678,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTI2Ng==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 591,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577666560,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:04:33Z",
      "diff_hunk" : "@@ -811,9 +813,11 @@ QString formatServicesStr(quint64 mask)\n         return QObject::tr(\"None\");\n }\n \n-QString formatPingTime(int64_t ping_usec)\n+QString formatPingTime(std::chrono::microseconds ping_time)\n {\n-    return (ping_usec == std::numeric_limits<int64_t>::max() || ping_usec == 0) ? QObject::tr(\"N/A\") : QString(QObject::tr(\"%1 ms\")).arg(QString::number((int)(ping_usec / 1000), 10));\n+    return (ping_time == std::chrono::microseconds::max() || ping_time.count() == 0) ?",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561363",
      "id" : 565561363,
      "in_reply_to_id" : 565137023,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTM2Mw==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 818,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/qt/guiutil.cpp",
      "position" : null,
      "pull_request_review_id" : 577666683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561439"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:04:41Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time.count() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561439",
      "id" : 565561439,
      "in_reply_to_id" : 565139181,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTQzOQ==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 206,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577666815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561501"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:04:47Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time.count() > 0) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);\n         }\n-        if (stats.m_min_ping_usec < std::numeric_limits<int64_t>::max()) {\n-            obj.pushKV(\"minping\", ((double)stats.m_min_ping_usec) / 1e6);\n+        if (stats.m_min_ping_time < std::chrono::microseconds::max()) {\n+            obj.pushKV(\"minping\", count_microseconds(stats.m_min_ping_time) * 0.000001);\n         }\n-        if (stats.m_ping_wait_usec > 0) {\n-            obj.pushKV(\"pingwait\", ((double)stats.m_ping_wait_usec) / 1e6);\n+        if (stats.m_ping_wait.count() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561501",
      "id" : 565561501,
      "in_reply_to_id" : 565139786,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTUwMQ==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 212,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577666887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:04:54Z",
      "diff_hunk" : "@@ -23,7 +23,7 @@ FUZZ_TARGET(node_eviction)\n         eviction_candidates.push_back({\n             fuzzed_data_provider.ConsumeIntegral<NodeId>(),\n             fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int64_t>()},\n             fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n             fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n             fuzzed_data_provider.ConsumeBool(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561581",
      "id" : 565561581,
      "in_reply_to_id" : 565140500,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTU4MQ==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 29,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/fuzz/node_eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 577666985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561767"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561767"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oops. Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:11Z",
      "diff_hunk" : "@@ -899,10 +899,10 @@ BOOST_AUTO_TEST_CASE(node_eviction_test)\n             // Combination of all tests above.\n             BOOST_CHECK(!IsEvicted(\n                 number_of_nodes, [number_of_nodes](NodeEvictionCandidate& candidate) {\n-                    candidate.nKeyedNetGroup = number_of_nodes - candidate.id; // 4 protected\n-                    candidate.nMinPingUsecTime = candidate.id;                 // 8 protected\n-                    candidate.nLastTXTime = number_of_nodes - candidate.id;    // 4 protected\n-                    candidate.nLastBlockTime = number_of_nodes - candidate.id; // 4 protected\n+                    candidate.nKeyedNetGroup = number_of_nodes - candidate.id;            // 4 protected",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561767",
      "id" : 565561767,
      "in_reply_to_id" : 565142431,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTc2Nw==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 902,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 577667205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561767",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561835"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:15Z",
      "diff_hunk" : "@@ -610,9 +610,9 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     }\n \n     // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;\n-    stats.m_ping_wait_usec = count_microseconds(ping_wait);\n+    stats.m_ping_time = m_ping_time;\n+    stats.m_min_ping_time  = m_min_ping_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561835",
      "id" : 565561835,
      "in_reply_to_id" : 565142762,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTgzNQ==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 614,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577667275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561859"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:19Z",
      "diff_hunk" : "@@ -45,8 +45,8 @@ static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes\n static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n /** Headers download timeout expressed in microseconds\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = std::chrono::minutes{15};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561859",
      "id" : 565561859,
      "in_reply_to_id" : 565143996,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTg1OQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 48,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561889"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:23Z",
      "diff_hunk" : "@@ -93,8 +93,8 @@ static constexpr std::chrono::microseconds GETDATA_TX_INTERVAL{std::chrono::seco\n static const unsigned int MAX_GETDATA_SZ = 1000;\n /** Number of blocks that can be requested at any given time from a single peer. */\n static const int MAX_BLOCKS_IN_TRANSIT_PER_PEER = 16;\n-/** Timeout in seconds during which a peer must stall block download progress before being disconnected. */\n-static const unsigned int BLOCK_STALLING_TIMEOUT = 2;\n+/** Time during which a peer must stall block download progress before being disconnected. */\n+static constexpr auto BLOCK_STALLING_TIMEOUT = std::chrono::seconds{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561889",
      "id" : 565561889,
      "in_reply_to_id" : 565145011,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTg4OQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 97,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561971"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:29Z",
      "diff_hunk" : "@@ -572,9 +572,9 @@ struct CNodeState {\n         pindexBestHeaderSent = nullptr;\n         nUnconnectingHeaders = 0;\n         fSyncStarted = false;\n-        nHeadersSyncTimeout = 0;\n-        nStallingSince = 0;\n-        nDownloadingSince = 0;\n+        m_headers_sync_timeout = std::chrono::microseconds{0};\n+        m_stalling_since = std::chrono::microseconds{0};\n+        m_downloading_since = std::chrono::microseconds{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565561971",
      "id" : 565561971,
      "in_reply_to_id" : 565156674,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MTk3MQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 577,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565561971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562031"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:35Z",
      "diff_hunk" : "@@ -624,11 +624,11 @@ static bool MarkBlockAsReceived(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs\n         }\n         if (state->vBlocksInFlight.begin() == itInFlight->second.second) {\n             // First block on the queue was received, update the start download time for the next one\n-            state->nDownloadingSince = std::max(state->nDownloadingSince, count_microseconds(GetTime<std::chrono::microseconds>()));\n+            state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n         }\n         state->vBlocksInFlight.erase(itInFlight->second.second);\n         state->nBlocksInFlight--;\n-        state->nStallingSince = 0;\n+        state->m_stalling_since = std::chrono::microseconds{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562031",
      "id" : 565562031,
      "in_reply_to_id" : 565157442,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjAzMQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 631,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:43Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * ((GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562141",
      "id" : 565562141,
      "in_reply_to_id" : 565159349,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjE0MQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 4386,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667668,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:47Z",
      "diff_hunk" : "@@ -4738,13 +4738,13 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         // this peer (eventually).\n                         state.fSyncStarted = false;\n                         nSyncStarted--;\n-                        state.nHeadersSyncTimeout = 0;\n+                        state.m_headers_sync_timeout = std::chrono::microseconds{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562199",
      "id" : 565562199,
      "in_reply_to_id" : 565161588,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjE5OQ==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 4741,
      "original_position" : 141,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562264"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:52Z",
      "diff_hunk" : "@@ -4768,8 +4768,8 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                     pindex->nHeight, pto->GetId());\n             }\n             if (state.nBlocksInFlight == 0 && staller != -1) {\n-                if (State(staller)->nStallingSince == 0) {\n-                    State(staller)->nStallingSince = count_microseconds(current_time);\n+                if (State(staller)->m_stalling_since.count() == 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562264",
      "id" : 565562264,
      "in_reply_to_id" : 565161799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjI2NA==",
      "original_commit_id" : "aa30fdfcc4e8801c3abd74468f849f6124815e10",
      "original_line" : 4771,
      "original_position" : 158,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577667784,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562300"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:05:55Z",
      "diff_hunk" : "@@ -1788,7 +1788,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         // Note that we only do this if we started with an empty peers.dat,\n         // (in which case we will query DNS seeds immediately) *and* the DNS\n         // seeds have not returned any results.\n-        if (addrman.size() == 0 && (GetTime() - nStart > 60)) {\n+        if (addrman.size() == 0 && (GetTime<std::chrono::microseconds>() - start > std::chrono::minutes{1})) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562300",
      "id" : 565562300,
      "in_reply_to_id" : 565164331,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjMwMA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 1791,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577667846,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562435"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That makes more sense. Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:08Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562435",
      "id" : 565562435,
      "in_reply_to_id" : 565167722,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjQzNQ==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 2933,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 577668052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562490"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:13Z",
      "diff_hunk" : "@@ -47,10 +47,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562490",
      "id" : 565562490,
      "in_reply_to_id" : 565167975,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjQ5MA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 52,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577668128,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562524"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:16Z",
      "diff_hunk" : "@@ -47,10 +47,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};\n /** Run the extra block-relay-only connection loop once every 5 minutes. **/\n-static const int EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL = 300;\n+static constexpr auto EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL = std::chrono::minutes{5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562524",
      "id" : 565562524,
      "in_reply_to_id" : 565168106,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjUyNA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 53,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577668169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562560"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:20Z",
      "diff_hunk" : "@@ -1219,7 +1219,7 @@ class CConnman\n      */\n     std::atomic_bool m_start_extra_block_relay_peers{false};\n \n-    std::atomic<int64_t> m_next_send_inv_to_incoming{0};\n+    std::atomic<std::chrono::microseconds> m_next_send_inv_to_incoming{std::chrono::microseconds{0}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562560",
      "id" : 565562560,
      "in_reply_to_id" : 565168337,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjU2MA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 1222,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 577668216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562608"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:24Z",
      "diff_hunk" : "@@ -119,17 +119,17 @@ static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = std::chrono::hours{24};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562608",
      "id" : 565562608,
      "in_reply_to_id" : 565169020,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjYwOA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 122,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577668269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:28Z",
      "diff_hunk" : "@@ -119,17 +119,17 @@ static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = std::chrono::hours{24};\n /** Average delay between peer address broadcasts */\n-static constexpr std::chrono::seconds AVG_ADDRESS_BROADCAST_INTERVAL{30};\n+static constexpr auto AVG_ADDRESS_BROADCAST_INTERVAL = std::chrono::seconds{30};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562665",
      "id" : 565562665,
      "in_reply_to_id" : 565169112,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjY2NQ==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 124,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577668332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562709"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:32Z",
      "diff_hunk" : "@@ -119,17 +119,17 @@ static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = std::chrono::hours{24};\n /** Average delay between peer address broadcasts */\n-static constexpr std::chrono::seconds AVG_ADDRESS_BROADCAST_INTERVAL{30};\n+static constexpr auto AVG_ADDRESS_BROADCAST_INTERVAL = std::chrono::seconds{30};\n /** Average delay between trickled inventory transmissions in seconds.\n  *  Blocks and peers with noban permission bypass this, outbound peers get half this delay. */\n-static const unsigned int INVENTORY_BROADCAST_INTERVAL = 5;\n+static constexpr auto INVENTORY_BROADCAST_INTERVAL = std::chrono::seconds{5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562709",
      "id" : 565562709,
      "in_reply_to_id" : 565169184,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjcwOQ==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 127,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577668382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562740"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:36Z",
      "diff_hunk" : "@@ -138,9 +138,9 @@ static constexpr unsigned int INVENTORY_MAX_RECENT_RELAY = 3500;\n  *  peers, and random variations in the broadcast mechanism. */\n static_assert(INVENTORY_MAX_RECENT_RELAY >= INVENTORY_BROADCAST_PER_SECOND * UNCONDITIONAL_RELAY_DELAY / std::chrono::seconds{1}, \"INVENTORY_RELAY_MAX too low\");\n /** Average delay between feefilter broadcasts in seconds. */\n-static constexpr unsigned int AVG_FEEFILTER_BROADCAST_INTERVAL = 10 * 60;\n+static constexpr auto AVG_FEEFILTER_BROADCAST_INTERVAL = std::chrono::minutes{10};\n /** Maximum feefilter broadcast delay after significant change. */\n-static constexpr unsigned int MAX_FEEFILTER_CHANGE_DELAY = 5 * 60;\n+static constexpr auto MAX_FEEFILTER_CHANGE_DELAY = std::chrono::minutes{5};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562740",
      "id" : 565562740,
      "in_reply_to_id" : 565169416,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2Mjc0MA==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 143,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577668434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562862"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:51Z",
      "diff_hunk" : "@@ -4822,24 +4822,24 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->lastSentFeeFilter == MAX_FILTER) {\n                     // Send the current filter if we sent MAX_FILTER previously\n                     // and made it out of IBD.\n-                    pto->m_tx_relay->nextSendTimeFeeFilter = count_microseconds(current_time) - 1;\n+                    pto->m_tx_relay->m_next_send_feefilter = current_time - std::chrono::microseconds{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562862",
      "id" : 565562862,
      "in_reply_to_id" : 565183947,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2Mjg2Mg==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 4825,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577668621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562911"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T19:06:56Z",
      "diff_hunk" : "@@ -40,9 +40,9 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = std::chrono::minutes{15};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565562911",
      "id" : 565562911,
      "in_reply_to_id" : 565186801,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU2MjkxMQ==",
      "original_commit_id" : "c9a8cbc64eddd98d2183380148a3d9c79c1bd7d2",
      "original_line" : 43,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577668685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565562911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review, @MarcoFalke. Comments addressed. Ready for further review.",
      "created_at" : "2021-01-27T19:08:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-768507748",
      "id" : 768507748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODUwNzc0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T19:08:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768507748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565659034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565659034"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That was unintentional. Fixed.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-27T21:50:34Z",
      "diff_hunk" : "@@ -238,8 +240,8 @@ namespace GUIUtil\n     /** Format CNodeStats.nServices bitmask into a user-readable string */\n     QString formatServicesStr(quint64 mask);\n \n-    /** Format a CNodeStats.m_ping_usec into a user-readable string or display N/A, if 0 */\n-    QString formatPingTime(int64_t ping_usec);\n+    /* Format a CNodeStats.m_ping_time into a user-readable string or display N/A, if 0*/",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565659034",
      "id" : 565659034,
      "in_reply_to_id" : 565138476,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTY1OTAzNA==",
      "original_commit_id" : "4089bc6489255ab26a350bbadc06d1cc5cff6d35",
      "original_line" : 243,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/qt/guiutil.h",
      "position" : null,
      "pull_request_review_id" : 577790500,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565659034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed to fix [doxygen comment](https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565533857).",
      "created_at" : "2021-01-27T21:54:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-768602039",
      "id" : 768602039,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODYwMjAzOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T21:54:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768602039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565810794"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565810794"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n\r\n```suggestion\r\n            .id = fuzzed_data_provider.ConsumeIntegral<NodeId>(),\r\n            .nTimeConnected = fuzzed_data_provider.ConsumeIntegral<int64_t>(),\r\n            .m_min_ping_time = std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int64_t>()},\r\n            .nLastBlockTime = fuzzed_data_provider.ConsumeIntegral<int64_t>(),\r\n            .nLastTXTime = fuzzed_data_provider.ConsumeIntegral<int64_t>(),\r\n            .fRelevantServices = fuzzed_data_provider.ConsumeBool(),\r\n            .fRelayTxes = fuzzed_data_provider.ConsumeBool(),\r\n            .fBloomFilter = fuzzed_data_provider.ConsumeBool(),\r\n            .nKeyedNetGroup = fuzzed_data_provider.ConsumeIntegral<uint64_t>(),\r\n            .prefer_evict = fuzzed_data_provider.ConsumeBool(),\r\n            .m_is_local = fuzzed_data_provider.ConsumeBool(),\r\n```\r\n\r\nDesignated initializers are already used [elsewhere in the fuzz tests](https://github.com/bitcoin/bitcoin/blob/9deba2de764f0043061d68cc3b984b9df67cf23b/src/test/fuzz/util.h#L272-L273). Should be ok, even though it is a [c++20 feature](https://github.com/bitcoin/bitcoin/pull/20197#discussion_r557297105).",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T04:21:50Z",
      "diff_hunk" : "@@ -21,17 +21,17 @@ FUZZ_TARGET(node_eviction)\n     std::vector<NodeEvictionCandidate> eviction_candidates;\n     while (fuzzed_data_provider.ConsumeBool()) {\n         eviction_candidates.push_back({\n-            fuzzed_data_provider.ConsumeIntegral<NodeId>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeIntegral<uint64_t>(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeBool(),\n+            /* id */ fuzzed_data_provider.ConsumeIntegral<NodeId>(),\n+            /* nTimeConnected */ fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            /* m_min_ping_time */ std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int64_t>()},\n+            /* nLastBlockTime */ fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            /* nLastTXTime */ fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            /* fRelevantServices */ fuzzed_data_provider.ConsumeBool(),\n+            /* fRelayTxes */ fuzzed_data_provider.ConsumeBool(),\n+            /* fBloomFilter */ fuzzed_data_provider.ConsumeBool(),\n+            /* nKeyedNetGroup */ fuzzed_data_provider.ConsumeIntegral<uint64_t>(),\n+            /* prefer_evict */ fuzzed_data_provider.ConsumeBool(),\n+            /* m_is_local */ fuzzed_data_provider.ConsumeBool(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565810794",
      "id" : 565810794,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgxMDc5NA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 34,
      "original_position" : 25,
      "original_start_line" : 24,
      "path" : "src/test/fuzz/node_eviction.cpp",
      "position" : 25,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565810794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565812808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565812808"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, it is shorter than `static_cast` and consistent with the code afterwards (`std::chrono::microseconds{candidate.id}`):\r\n\r\n```suggestion\r\n            .m_min_ping_time = std::chrono::microseconds{random_context.randrange(100)},\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T04:29:18Z",
      "diff_hunk" : "@@ -771,29 +771,14 @@ BOOST_AUTO_TEST_CASE(LocalAddress_BasicLifecycle)\n     BOOST_CHECK_EQUAL(IsLocal(addr), false);\n }\n \n-BOOST_AUTO_TEST_CASE(PoissonNextSend)\n-{\n-    g_mock_deterministic_tests = true;\n-\n-    int64_t now = 5000;\n-    int average_interval_seconds = 600;\n-\n-    auto poisson = ::PoissonNextSend(now, average_interval_seconds);\n-    std::chrono::microseconds poisson_chrono = ::PoissonNextSend(std::chrono::microseconds{now}, std::chrono::seconds{average_interval_seconds});\n-\n-    BOOST_CHECK_EQUAL(poisson, poisson_chrono.count());\n-\n-    g_mock_deterministic_tests = false;\n-}\n-\n std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_candidates, FastRandomContext& random_context)\n {\n     std::vector<NodeEvictionCandidate> candidates;\n     for (int id = 0; id < n_candidates; ++id) {\n         candidates.push_back({\n             /* id */ id,\n             /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n-            /* nMinPingUsecTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ static_cast<std::chrono::microseconds>(random_context.randrange(100)),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565812808",
      "id" : 565812808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgxMjgwOA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 781,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565812808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565826688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565826688"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This looks wrong, but it is not! `HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER` is `std::chrono::milliseconds` while `GetAdjustedTime()` is `int64_t` seconds and we seem to be doing arithmetic with them. Maybe some comment would make it clearer?\r\n\r\n```suggestion\r\n                state.m_headers_sync_timeout =\r\n                    current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE +\r\n                    HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER *\r\n                        // Expected number of headers [unitless].\r\n                        (GetAdjustedTime() - pindexBestHeader->GetBlockTime()) /\r\n                        consensusParams.nPowTargetSpacing;\r\n```\r\n\r\nNote: if we put the unitless expression in a variable, then it will do the division first and after that the multiplication which may produce different results.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T05:18:27Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565826688",
      "id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgyNjY4OA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565826688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565827205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565827205"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n/** Headers download timeout.\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T05:20:19Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n /** Headers download timeout expressed in microseconds",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565827205",
      "id" : 565827205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgyNzIwNQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 46,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565827205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565827412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565827412"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\nstatic constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1ms;\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T05:20:56Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n /** Headers download timeout expressed in microseconds\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = std::chrono::milliseconds{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565827412",
      "id" : 565827412,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgyNzQxMg==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 49,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565827412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565838950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565838950"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: this uses `*` and `times` to denote multiplication:\r\n\r\n```suggestion\r\n        // In case there is a block that has been in flight from this peer for (the block interval) * (1 + 0.5 * N)\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T05:59:27Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for 1 + 0.5 * N times the block interval",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565838950",
      "id" : 565838950,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgzODk1MA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4704,
      "original_position" : 211,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565838950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565842448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565842448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`-x * -y` should be the same as `x * y`:\r\n\r\n```suggestion\r\n    double unscaled = log1p(GetRand(1ULL << 48) * 0.0000000000000035527136788 /* -1/2^48 */);\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T06:10:41Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565842448",
      "id" : 565842448,
      "line" : 2998,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg0MjQ0OA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 2998,
      "original_position" : 118,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 90,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565842448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565844097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565844097"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n/** Average delay between trickled inventory transmissions.\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T06:15:55Z",
      "diff_hunk" : "@@ -108,28 +108,28 @@ static const int MAX_BLOCKTXN_DEPTH = 10;\n  *  degree of disordering of blocks on disk (which make reindexing and pruning harder). We'll probably\n  *  want to make this a per-peer adaptive value at some point. */\n static const unsigned int BLOCK_DOWNLOAD_WINDOW = 1024;\n-/** Block download timeout base, expressed in millionths of the block interval (i.e. 10 min) */\n-static const int64_t BLOCK_DOWNLOAD_TIMEOUT_BASE = 1000000;\n+/** Block download timeout base, expressed in multiples of the block interval (i.e. 10 min) */\n+static constexpr double BLOCK_DOWNLOAD_TIMEOUT_BASE = 1;\n /** Additional block download timeout per parallel downloading peer (i.e. 5 min) */\n-static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n+static constexpr double BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 0.5;\n /** Maximum number of headers to announce when relaying blocks with headers message.*/\n static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n /** Maximum number of unconnecting headers announcements before DoS score */\n static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = 24h;\n /** Average delay between peer address broadcasts */\n-static constexpr std::chrono::seconds AVG_ADDRESS_BROADCAST_INTERVAL{30};\n+static constexpr auto AVG_ADDRESS_BROADCAST_INTERVAL = 30s;\n /** Average delay between trickled inventory transmissions in seconds.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565844097",
      "id" : 565844097,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg0NDA5Nw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 125,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565844097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565848250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565848250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The meaning of the second argument was \"seconds\" before, to keep the behavior:\r\n\r\n```suggestion\r\n                (void)connman.PoissonNextSendInbound(\r\n                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int32_t>()},\r\n                        std::chrono::seconds{fuzzed_data_provider.ConsumeIntegral<int>()});\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T06:28:06Z",
      "diff_hunk" : "@@ -104,7 +104,9 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n             },\n             [&] {\n                 // Limit now to int32_t to avoid signed integer overflow\n-                (void)connman.PoissonNextSendInbound(fuzzed_data_provider.ConsumeIntegral<int32_t>(), fuzzed_data_provider.ConsumeIntegral<int>());\n+                (void)connman.PoissonNextSendInbound(\n+                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int32_t>()},\n+                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int>()});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565848250",
      "id" : 565848250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg0ODI1MA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565848250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565849170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565849170"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\nstatic constexpr auto UNCONDITIONAL_RELAY_DELAY = 2min;\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T06:30:37Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565849170",
      "id" : 565849170,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg0OTE3MA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 45,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 577975776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565849170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565851377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565851377"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not done yet in c0822a71b.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T06:37:36Z",
      "diff_hunk" : "@@ -47,10 +47,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565851377",
      "id" : 565851377,
      "in_reply_to_id" : 565167975,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg1MTM3Nw==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 52,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 578023182,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565851377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565869387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565869387"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Actually I think this changes the rounding calculation: `HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER` used to be 1000, in us. Now its 1 in milliseconds. The calculation `HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * x / y` used to be in us precision, but now it is only in ms precision. So there is now a bit more of a rounding error than there was before",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T07:24:28Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565869387",
      "id" : 565869387,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg2OTM4Nw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 578044962,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565869387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565889928"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565889928"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pls no. This is a bug in the upstream compilers, we shouldn't rely on that.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:07:34Z",
      "diff_hunk" : "@@ -21,17 +21,17 @@ FUZZ_TARGET(node_eviction)\n     std::vector<NodeEvictionCandidate> eviction_candidates;\n     while (fuzzed_data_provider.ConsumeBool()) {\n         eviction_candidates.push_back({\n-            fuzzed_data_provider.ConsumeIntegral<NodeId>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeIntegral<uint64_t>(),\n-            fuzzed_data_provider.ConsumeBool(),\n-            fuzzed_data_provider.ConsumeBool(),\n+            /* id */ fuzzed_data_provider.ConsumeIntegral<NodeId>(),\n+            /* nTimeConnected */ fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            /* m_min_ping_time */ std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int64_t>()},\n+            /* nLastBlockTime */ fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            /* nLastTXTime */ fuzzed_data_provider.ConsumeIntegral<int64_t>(),\n+            /* fRelevantServices */ fuzzed_data_provider.ConsumeBool(),\n+            /* fRelayTxes */ fuzzed_data_provider.ConsumeBool(),\n+            /* fBloomFilter */ fuzzed_data_provider.ConsumeBool(),\n+            /* nKeyedNetGroup */ fuzzed_data_provider.ConsumeIntegral<uint64_t>(),\n+            /* prefer_evict */ fuzzed_data_provider.ConsumeBool(),\n+            /* m_is_local */ fuzzed_data_provider.ConsumeBool(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565889928",
      "id" : 565889928,
      "in_reply_to_id" : 565810794,
      "line" : 34,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg4OTkyOA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 34,
      "original_position" : 25,
      "original_start_line" : 24,
      "path" : "src/test/fuzz/node_eviction.cpp",
      "position" : 25,
      "pull_request_review_id" : 578070577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : 24,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565889928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565891469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565891469"
         }
      },
      "author_association" : "MEMBER",
      "body" : "no. log1p(-a) is not equal to -log1p(a)",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:10:18Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565891469",
      "id" : 565891469,
      "in_reply_to_id" : 565842448,
      "line" : 2998,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg5MTQ2OQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 2998,
      "original_position" : 118,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 90,
      "pull_request_review_id" : 578072420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565891469",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565894100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565894100"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How so? GetAdjustedTime is divided by the time it takes for a header, so the result it the number of headers (no unit).\r\n\r\nMultiplying a (no unit) with 1000us will give exactly (a)ms, just like multplying a (no unit) with 1ms will give exactly (a)ms.\r\n\r\nThis is correct",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:15:07Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565894100",
      "id" : 565894100,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg5NDEwMA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 578075667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565894100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565894967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565894967"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could add `(` and `)` to clarify this:\r\n\r\n```suggestion\r\n                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * ((GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing);\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:16:31Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565894967",
      "id" : 565894967,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg5NDk2Nw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 578076754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565894967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565897029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565897029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it is fine to change the meaning with the benefit that the fuzz test will be also grinding at a smaller resolution, which is more likely to be used. I don't think we have a poisson delay of int::max() seconds anywhere. And I don't think it makes sense in practice.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:20:05Z",
      "diff_hunk" : "@@ -104,7 +104,9 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n             },\n             [&] {\n                 // Limit now to int32_t to avoid signed integer overflow\n-                (void)connman.PoissonNextSendInbound(fuzzed_data_provider.ConsumeIntegral<int32_t>(), fuzzed_data_provider.ConsumeIntegral<int>());\n+                (void)connman.PoissonNextSendInbound(\n+                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int32_t>()},\n+                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int>()});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565897029",
      "id" : 565897029,
      "in_reply_to_id" : 565848250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg5NzAyOQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : null,
      "pull_request_review_id" : 578079441,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565897029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565897753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565897753"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems fine to remove the cast, but please don't use the C++20 feature",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:21:21Z",
      "diff_hunk" : "@@ -771,29 +771,14 @@ BOOST_AUTO_TEST_CASE(LocalAddress_BasicLifecycle)\n     BOOST_CHECK_EQUAL(IsLocal(addr), false);\n }\n \n-BOOST_AUTO_TEST_CASE(PoissonNextSend)\n-{\n-    g_mock_deterministic_tests = true;\n-\n-    int64_t now = 5000;\n-    int average_interval_seconds = 600;\n-\n-    auto poisson = ::PoissonNextSend(now, average_interval_seconds);\n-    std::chrono::microseconds poisson_chrono = ::PoissonNextSend(std::chrono::microseconds{now}, std::chrono::seconds{average_interval_seconds});\n-\n-    BOOST_CHECK_EQUAL(poisson, poisson_chrono.count());\n-\n-    g_mock_deterministic_tests = false;\n-}\n-\n std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_candidates, FastRandomContext& random_context)\n {\n     std::vector<NodeEvictionCandidate> candidates;\n     for (int id = 0; id < n_candidates; ++id) {\n         candidates.push_back({\n             /* id */ id,\n             /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n-            /* nMinPingUsecTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ static_cast<std::chrono::microseconds>(random_context.randrange(100)),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565897753",
      "id" : 565897753,
      "in_reply_to_id" : 565812808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTg5Nzc1Mw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 781,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 578080400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565897753",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565903198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565903198"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The original calculation order was `(HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * ((GetAdjustedTime() - pindexBestHeader->GetBlockTime())) / consensusParams.nPowTargetSpacing`, so `(1000 * x) / y`. The PR has basically changed this into `(1 * x) / y`. I don't think this is a problem, but the result might be off by up to 999us: https://godbolt.org/z/TEYood",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:30:30Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565903198",
      "id" : 565903198,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkwMzE5OA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 578087315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565903198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565910777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565910777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "not if you assume that x/y is in ",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:42:53Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565910777",
      "id" : 565910777,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkxMDc3Nw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 578096776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565910777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565911113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565911113"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oh wait, it isn't. Missed that (edit: :sweat_smile: )",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T08:43:22Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565911113",
      "id" : 565911113,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkxMTExMw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 578097172,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565911113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565927236"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565927236"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe use this to get rid of the hardcoded constant:\r\n```suggestion\r\n            obj.pushKV(\"pingtime\", std::chrono::duration<double>{stats.m_ping_time}.count());\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T09:08:22Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565927236",
      "id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkyNzIzNg==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578118079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565927236",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565933768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565933768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could directly use chrono features for this:\r\n```suggestion\r\n    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);\r\n```\r\n",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T09:17:59Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    double scaled = unscaled * count_microseconds(average_interval);\n+    return now + std::chrono::microseconds{int64_t(scaled + 0.5)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565933768",
      "id" : 565933768,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkzMzc2OA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 2935,
      "original_position" : 120,
      "original_start_line" : 2934,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578118079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565933768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565943304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565943304"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That'd be a breaking RPC change if someone changed the type of `m_ping_time` to nanoseconds. Unlikely here, but plausible for other durations, so I'd rather not encourage such code.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T09:32:02Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565943304",
      "id" : 565943304,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk0MzMwNA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578138925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565943304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Review ACK c0822a71b5fabb39e6bbf7355b69f9f1b9264fde, I have not tested the code, looked through it and found only nits",
      "created_at" : "2021-01-28T09:48:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-768932817",
      "id" : 768932817,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODkzMjgxNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T10:28:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768932817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566002067"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566002067"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Doh, I misread this as `-log1p(a) * -b`.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T10:58:33Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566002067",
      "id" : 566002067,
      "in_reply_to_id" : 565842448,
      "line" : 2998,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAwMjA2Nw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 2998,
      "original_position" : 118,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 90,
      "pull_request_review_id" : 578213730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566002067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566006850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566006850"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```cpp\r\n    auto us = 500000us;\r\n    auto ns = 500000000ns;\r\n\r\n    std::cout << us.count() * 0.000001 << std::endl;\r\n    std::cout << std::chrono::duration<double>{us}.count() << std::endl;\r\n    std::cout << std::chrono::duration<double>{ns}.count() << std::endl;\r\n```\r\nall 3 print `0.5`.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T11:06:02Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566006850",
      "id" : 566006850,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAwNjg1MA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578219790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566006850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566011941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566011941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm, then it must be broken in another way. There is no way the compiler can figure out what time unit `double` should represent in the Univalue object.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T11:14:15Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566011941",
      "id" : 566011941,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAxMTk0MQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578226124,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566011941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566014703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566014703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, it will always represent the result in seconds? Seems fair enough, but it would be good to wrap that into a helper method, so that the C++ docs don't have to be looked up every time this is used. (This relies on the default ration being `1`)",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T11:18:39Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566014703",
      "id" : 566014703,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAxNDcwMw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578229425,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566014703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566025525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566025525"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> all 3 print `0.5`.\r\n\r\nyes, the only difference I see should be that `count_microseconds` won't accept a nanoseconds argument and you'd get a compile error in that case. But the `std::chrono::duration<double>(...)` should always work. Also the `round()` should be more correct than `+ 0.5` for negative durations, but that shouldn't matter here\r\n\r\n> Oh, it will always represent the result in seconds\r\n\r\nyes, std::chrono duration's default to `std::ratio<1>` which is seconds",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T11:37:34Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566025525",
      "id" : 566025525,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAyNTUyNQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578243712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566025525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566038761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566038761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `GetTime` should actually return a `std::chrono::time_point` instead of a duration. But that's probably out of scope for this PR. Then we'd have a few more compile time checks concerning the allowed operations (e.g. you can't add two timepoints, you can't accidentally compare a timepoints with a duration and you can't accidentally mix timepoints from different clocks)",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T12:00:23Z",
      "diff_hunk" : "@@ -1768,11 +1768,11 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n \n     // Initiate network connections\n-    int64_t nStart = GetTime();\n+    auto start = GetTime<std::chrono::microseconds>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566038761",
      "id" : 566038761,
      "line" : 1764,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjAzODc2MQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 1764,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 578260350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566038761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566048527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566048527"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "no millis, no nanos, no kilos, no megas, just seconds :)",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T12:16:58Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566048527",
      "id" : 566048527,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjA0ODUyNw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578273000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566048527",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566069323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566069323"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about adding `SecondsFloat`, similar to the ` std::chrono::seconds` helper type?\r\n\r\n```cpp\r\nusing SecondsFloat = std::chrono::duration<double>;\r\ninline auto count_seconds_f(SecondsFloat t) { return t.count(); }\r\n",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T12:50:31Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566069323",
      "id" : 566069323,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjA2OTMyMw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578299244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566069323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566102943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566102943"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like the idea. Shouldn't it be `CountSeconds()` to follow the naming convention? I think `Float` in the name could be confusing because it is using `double`, not `float`.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T13:44:08Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566102943",
      "id" : 566102943,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjEwMjk0Mw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578344157,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566102943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566334979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566334979"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd personally prefer just `std::chrono::duration<double>`, but most likely because I've recently done a lot of chrono related refactoring at work so I'm already used to what this means :smile: \r\n",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-28T18:58:55Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r566334979",
      "id" : 566334979,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjMzNDk3OQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 578647384,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566334979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145727"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Awesome catch, @martinus ! I've changed `HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER` to be `1000us` instead of `1ms` to keep things consistent. The change may not be a problem, but I don't see a reason to risk it for moving to chrono types.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:18:49Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145727",
      "id" : 567145727,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NTcyNw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579682062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145808"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:18:59Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n /** Headers download timeout expressed in microseconds",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145808",
      "id" : 567145808,
      "in_reply_to_id" : 565827205,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NTgwOA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 46,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579682123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145856"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:19:08Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n /** Headers download timeout expressed in microseconds\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = std::chrono::milliseconds{1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145856",
      "id" : 567145856,
      "in_reply_to_id" : 565827412,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NTg1Ng==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 49,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579682175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:19:16Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for 1 + 0.5 * N times the block interval",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145904",
      "id" : 567145904,
      "in_reply_to_id" : 565838950,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NTkwNA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4704,
      "original_position" : 211,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579682226,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145982"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:19:32Z",
      "diff_hunk" : "@@ -108,28 +108,28 @@ static const int MAX_BLOCKTXN_DEPTH = 10;\n  *  degree of disordering of blocks on disk (which make reindexing and pruning harder). We'll probably\n  *  want to make this a per-peer adaptive value at some point. */\n static const unsigned int BLOCK_DOWNLOAD_WINDOW = 1024;\n-/** Block download timeout base, expressed in millionths of the block interval (i.e. 10 min) */\n-static const int64_t BLOCK_DOWNLOAD_TIMEOUT_BASE = 1000000;\n+/** Block download timeout base, expressed in multiples of the block interval (i.e. 10 min) */\n+static constexpr double BLOCK_DOWNLOAD_TIMEOUT_BASE = 1;\n /** Additional block download timeout per parallel downloading peer (i.e. 5 min) */\n-static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 500000;\n+static constexpr double BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 0.5;\n /** Maximum number of headers to announce when relaying blocks with headers message.*/\n static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n /** Maximum number of unconnecting headers announcements before DoS score */\n static const int MAX_UNCONNECTING_HEADERS = 10;\n /** Minimum blocks required to signal NODE_NETWORK_LIMITED */\n static const unsigned int NODE_NETWORK_LIMITED_MIN_BLOCKS = 288;\n /** Average delay between local address broadcasts */\n-static constexpr std::chrono::hours AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL{24};\n+static constexpr auto AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL = 24h;\n /** Average delay between peer address broadcasts */\n-static constexpr std::chrono::seconds AVG_ADDRESS_BROADCAST_INTERVAL{30};\n+static constexpr auto AVG_ADDRESS_BROADCAST_INTERVAL = 30s;\n /** Average delay between trickled inventory transmissions in seconds.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567145982",
      "id" : 567145982,
      "in_reply_to_id" : 565844097,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NTk4Mg==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 125,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579682323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567145982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567146092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567146092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Left it as-is.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:19:49Z",
      "diff_hunk" : "@@ -104,7 +104,9 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\n             },\n             [&] {\n                 // Limit now to int32_t to avoid signed integer overflow\n-                (void)connman.PoissonNextSendInbound(fuzzed_data_provider.ConsumeIntegral<int32_t>(), fuzzed_data_provider.ConsumeIntegral<int>());\n+                (void)connman.PoissonNextSendInbound(\n+                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int32_t>()},\n+                        std::chrono::microseconds{fuzzed_data_provider.ConsumeIntegral<int>()});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567146092",
      "id" : 567146092,
      "in_reply_to_id" : 565848250,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NjA5Mg==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 109,
      "original_position" : 7,
      "original_start_line" : 107,
      "path" : "src/test/fuzz/connman.cpp",
      "position" : null,
      "pull_request_review_id" : 579682421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567146092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567146147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567146147"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:20:00Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567146147",
      "id" : 567146147,
      "in_reply_to_id" : 565849170,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NjE0Nw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 45,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579682485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567146147",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567146963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567146963"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for teaching me through code review! I essentially used @MarcoFalke's approach, but made the ratio and the return type explicit for the reader.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:22:54Z",
      "diff_hunk" : "@@ -203,14 +203,14 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", stats.nTimeConnected);\n         obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n-        if (stats.m_ping_usec > 0) {\n-            obj.pushKV(\"pingtime\", ((double)stats.m_ping_usec) / 1e6);\n+        if (stats.m_ping_time > 0us) {\n+            obj.pushKV(\"pingtime\", count_microseconds(stats.m_ping_time) * 0.000001);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567146963",
      "id" : 567146963,
      "in_reply_to_id" : 565927236,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0Njk2Mw==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 207,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 579683479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567146963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567147038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567147038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:23:13Z",
      "diff_hunk" : "@@ -2917,20 +2917,22 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    double scaled = unscaled * count_microseconds(average_interval);\n+    return now + std::chrono::microseconds{int64_t(scaled + 0.5)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567147038",
      "id" : 567147038,
      "in_reply_to_id" : 565933768,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NzAzOA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 2935,
      "original_position" : 120,
      "original_start_line" : 2934,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 579683582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567147038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567147379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567147379"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-29T23:24:21Z",
      "diff_hunk" : "@@ -771,29 +771,14 @@ BOOST_AUTO_TEST_CASE(LocalAddress_BasicLifecycle)\n     BOOST_CHECK_EQUAL(IsLocal(addr), false);\n }\n \n-BOOST_AUTO_TEST_CASE(PoissonNextSend)\n-{\n-    g_mock_deterministic_tests = true;\n-\n-    int64_t now = 5000;\n-    int average_interval_seconds = 600;\n-\n-    auto poisson = ::PoissonNextSend(now, average_interval_seconds);\n-    std::chrono::microseconds poisson_chrono = ::PoissonNextSend(std::chrono::microseconds{now}, std::chrono::seconds{average_interval_seconds});\n-\n-    BOOST_CHECK_EQUAL(poisson, poisson_chrono.count());\n-\n-    g_mock_deterministic_tests = false;\n-}\n-\n std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_candidates, FastRandomContext& random_context)\n {\n     std::vector<NodeEvictionCandidate> candidates;\n     for (int id = 0; id < n_candidates; ++id) {\n         candidates.push_back({\n             /* id */ id,\n             /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n-            /* nMinPingUsecTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ static_cast<std::chrono::microseconds>(random_context.randrange(100)),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567147379",
      "id" : 567147379,
      "in_reply_to_id" : 565812808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE0NzM3OQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 781,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 579683973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567147379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the thorough review, @vasild @martinus and @MarcoFalke!\r\n\r\nComments addressed. Ready for review.",
      "created_at" : "2021-01-30T00:23:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-770117804",
      "id" : 770117804,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDExNzgwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-30T00:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770117804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567219816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567219816"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Was the logic changed on purpose?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-30T08:54:13Z",
      "diff_hunk" : "@@ -4822,24 +4822,24 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->lastSentFeeFilter == MAX_FILTER) {\n                     // Send the current filter if we sent MAX_FILTER previously\n                     // and made it out of IBD.\n-                    pto->m_tx_relay->nextSendTimeFeeFilter = count_microseconds(current_time) - 1;\n+                    pto->m_tx_relay->m_next_send_feefilter = 0us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567219816",
      "id" : 567219816,
      "line" : 4933,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzIxOTgxNg==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 4933,
      "original_position" : 270,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 276,
      "pull_request_review_id" : 579741938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567219816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567222658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567222658"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Behaviour shouldn't change: https://github.com/bitcoin/bitcoin/pull/21015#discussion_r565183947",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-30T09:25:30Z",
      "diff_hunk" : "@@ -4822,24 +4822,24 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->lastSentFeeFilter == MAX_FILTER) {\n                     // Send the current filter if we sent MAX_FILTER previously\n                     // and made it out of IBD.\n-                    pto->m_tx_relay->nextSendTimeFeeFilter = count_microseconds(current_time) - 1;\n+                    pto->m_tx_relay->m_next_send_feefilter = 0us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567222658",
      "id" : 567222658,
      "in_reply_to_id" : 567219816,
      "line" : 4933,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzIyMjY1OA==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 4933,
      "original_position" : 270,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 276,
      "pull_request_review_id" : 579743530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567222658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8 looked through all changes and looks good, did not run the code though.",
      "created_at" : "2021-01-30T09:38:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-770184787",
      "id" : 770184787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDE4NDc4Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-30T09:40:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770184787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567453479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567453479"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`X(m_ping_time); X(m_min_ping_time);` ?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-31T16:55:39Z",
      "diff_hunk" : "@@ -610,9 +610,9 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     }\n \n     // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;\n-    stats.m_ping_wait_usec = count_microseconds(ping_wait);\n+    stats.m_ping_time = m_ping_time;\n+    stats.m_min_ping_time = m_min_ping_time;\n+    stats.m_ping_wait = ping_wait;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567453479",
      "id" : 567453479,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ1MzQ3OQ==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 618,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567453479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567454300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567454300"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is this `CountSeconds` not `count_seconds_double` to match the existing `count_microseconds` and `count_seconds`?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-31T17:02:33Z",
      "diff_hunk" : "@@ -27,6 +27,12 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n \n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567454300",
      "id" : 567454300,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ1NDMwMA==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 38,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567454300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567454798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567454798"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why isn't this `1ms` ?\r\n\r\nI see it's mentioned in review comments for code below, but if the precision is actually needed, it should be `std::chrono::microseconds` not `auto` and the reason should probably be commented here too.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-31T17:07:00Z",
      "diff_hunk" : "@@ -43,10 +43,10 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n-/** Headers download timeout expressed in microseconds\n+/** Headers download timeout.\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567454798",
      "id" : 567454798,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ1NDc5OA==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 49,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567454798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567457582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567457582"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think making it:\r\n\r\n```c++\r\n\r\nstate.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE +\r\n     (\r\n         std::chrono::microseconds(HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER) *\r\n         (GetAdjustedTime() - pindexBestHeader->GetBlockTime())\r\n     ) / consensusParams.nPowTargetSpacing;\r\n     // GetAdjustedTime/GetBlockTime/nPowTargetSpacing return time in seconds as an int,\r\n     // so we get maximum precision by working in microseconds and multiplying first, then dividing.\r\n```\r\n\r\nwould let you have the constexpr be `1ms` while maintaining precision by still doing the calculation as `((HDTPH * (GAT-GBT)) / nPowTS)` (even though that involves an intermediate value whose unit is \"microseconds * seconds\"). Converting GAT/GBT/nPowTS to use chrono::seconds would mean you'd need to wrap them with `count_seconds()` in addition, I think.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-01-31T17:28:34Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567457582",
      "id" : 567457582,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ1NzU4Mg==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567457582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8 changes since last review: \r\n\r\n* Restore doxygen comment\r\n* Use chrono literals where possible\r\n* Add \"named initializer comments\" in fuzz tests\r\n* Adding missing negation of log1p result\r\n* Using std::chrono::round instead of own round implementation\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8 changes since last review: \r\n\r\n* Restore doxygen comment\r\n* Use chrono literals where possible\r\n* Add \"named initializer comments\" in fuzz tests\r\n* Adding missing negation of log1p result\r\n* Using std::chrono::round instead of own round implementation\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUiNOgv/esnDzAD/Kt43N+9AyPE/F2YIwzavHnuWrj/SXUud1w6esEg2hIyXtLQV\r\n4XaR+pDY04odSoU/ug7hIDf6YuMjP+/9GP7H0NOmVdNpVRtmTwrlRyQWj0C7ywz4\r\nzwmU5cymrTY72AdR9kY4KqDbSoYoUfsVduxRfJc4zV94TvddXKjHkDEx5dK1lM7I\r\nErYKjiXovXU92giHP9WB9VEwNrQ0I771whBYtQGceGMUMCq6Yv1LhCG3YUzK1ywN\r\nYLdjr6dKO4h4xl19aRu4NXh6g6c70k9o8Jdw9slska93nMT+hNH9EOVnhpU1Oc5w\r\nkUC3CVZlsJFx+ko/wtYJNnETyRiHkkFrxnCf7RdoS7zSaeIdoZ/Ib7cfXj11CxX3\r\nCNEkJ1lBzaWt80zmAaFOnvRHlcnPBY0njOcydJB86ZZMu5/NUo0iKIopCl61MDtB\r\nApbnZZ0i1u/+P6DGdlC+MsSCjeG3FZjFvP6iPWv18bximVEeRNZc2FXT0usZspSl\r\nH7g3SvAP\r\n=VrHQ\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `4921d55322dc9a709473933b73c325e72d8e67b146d2eb0c9da16764d7486ae0  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401084921d55322dc9a709473933b73c325e72d8e67b146d2eb0c9da16764d7486ae0f0104c44abc6a5466fade6e369339af2896408fff0106a2df8543c90b4b85f45618f4c4dc43408f1046017dce2f008c4d825a5bfc8201a0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0106dc98a7b46bbfa0e29bbfe335355424908f1046017dce2f008031efbe02fd4d1f00083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff01084fb4810b32c16132623a1b536d60c1d08f1046017cf12f008b359c940d0daa67c0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df0109492e9dcdbabd12b5bf6befc3e4a64aa08f1046017dce1f008b08de79f2c81cb940083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2021-02-01T10:50:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-770764084",
      "id" : 770764084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MDc2NDA4NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-01T10:50:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/770764084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567730351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567730351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "it would be nicer to cast to the desired and wanted resolution where needed in the source code. Otherwise the move to chrono doesn't feel like an improvement. Image this being changed to 200ms, you'd have to type `200*1000` here again.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T10:52:58Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n-/** Headers download timeout expressed in microseconds\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = 2min;\n+/** Headers download timeout.\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567730351",
      "id" : 567730351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzczMDM1MQ==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 49,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 580231303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567730351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567735384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567735384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Would be nice to inherit the period from \"upstream\"\r\n\r\n\r\n```diff\r\ndiff --git a/src/util/time.h b/src/util/time.h\r\nindex deb9ceefe2..f1b2beb0f3 100644\r\n--- a/src/util/time.h\r\n+++ b/src/util/time.h\r\n@@ -30,7 +30,7 @@ constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { retur\r\n /**\r\n  * Helper to count the seconds in any std::chrono::duration type\r\n  */\r\n-using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\r\n+using SecondsDouble = std::chrono::duration<double, std::chrono::seconds::period>;\r\n inline double CountSeconds(SecondsDouble t) { return t.count(); }\r\n \r\n /**\r\n",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T11:00:28Z",
      "diff_hunk" : "@@ -24,8 +24,14 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n  * This helper is used to convert durations before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n-inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n-inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+constexpr inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n+constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+\n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567735384",
      "id" : 567735384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzczNTM4NA==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 33,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 580231303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567735384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567872655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567872655"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, in the way it is used it will behave the same as long as `m_next_send_feefilter` is in the past.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T14:38:09Z",
      "diff_hunk" : "@@ -4822,24 +4822,24 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->lastSentFeeFilter == MAX_FILTER) {\n                     // Send the current filter if we sent MAX_FILTER previously\n                     // and made it out of IBD.\n-                    pto->m_tx_relay->nextSendTimeFeeFilter = count_microseconds(current_time) - 1;\n+                    pto->m_tx_relay->m_next_send_feefilter = 0us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567872655",
      "id" : 567872655,
      "in_reply_to_id" : 567219816,
      "line" : 4933,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg3MjY1NQ==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 4933,
      "original_position" : 270,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 276,
      "pull_request_review_id" : 580415789,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567872655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567898898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567898898"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: in the doxygen-generated documentation the comment will be assigned to `SecondsDouble` and `CountSeconds` will be left undocumented.\r\n\r\n```cpp\r\n/** These are the coordinates of the buzz point in the hyper plane. */\r\nint x;\r\nint y;\r\n```\r\nthis looks ok in the source code but will produce unexpected result in the doxygen docs, leaving `y` undocumented.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T15:11:44Z",
      "diff_hunk" : "@@ -24,8 +24,14 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n  * This helper is used to convert durations before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n-inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n-inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+constexpr inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n+constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+\n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567898898",
      "id" : 567898898,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg5ODg5OA==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 38,
      "original_position" : 13,
      "original_start_line" : 30,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 580450807,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567898898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567919426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567919426"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this is changing: `micros > micros + seconds * (millions + millions * count)` to `micros > micros + (seconds * (double + double * count))*scale` which doesn't really seem right to me.\r\n\r\nLeaving `BLOCK_DOWNLOAD_TIMEOUT_{BASE,PER_PEER}` as they are, documenting that they're measured in microseconds-per-second (and thus are int's not chrono::durations), and wrapping the entire `nPowTargetSpacing * (...)` in a `std::chrono::microseconds{ .. }` cast/constructor seems like a more accurate refactor to me.\r\n",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T15:37:32Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for block_interval * (1 + 0.5 * N)\n         // (with N the number of peers from which we're downloading validated blocks), disconnect due to timeout.\n         // We compensate for other peers to prevent killing off peers due to our own downstream link\n         // being saturated. We only count validated in-flight blocks so peers can't advertise non-existing block hashes\n         // to unreasonably increase our timeout.\n         if (state.vBlocksInFlight.size() > 0) {\n             QueuedBlock &queuedBlock = state.vBlocksInFlight.front();\n             int nOtherPeersWithValidatedDownloads = nPeersWithValidatedDownloads - (state.nBlocksInFlightValidHeaders > 0);\n-            if (count_microseconds(current_time) > state.nDownloadingSince + consensusParams.nPowTargetSpacing * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {\n+            if (current_time > state.m_downloading_since + std::chrono::seconds{consensusParams.nPowTargetSpacing} * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567919426",
      "id" : 567919426,
      "line" : 4820,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzkxOTQyNg==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 4820,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 228,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567919426",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567941530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567941530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've had a look at this a while ago: https://github.com/ajtowns/bitcoin/commits/201908-systime It's particularly nice that your types can then encode what sort of time you've got -- if it's a high precision clock, if it's a stable clock, or, for us, if it's a mockable clock. One drawback is that time_point's aren't compatible with atomic, so you have to hack around that. I think we'd want to think some more about exactly what sorts of times we care about before doing that conversion seriously.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T16:04:32Z",
      "diff_hunk" : "@@ -1768,11 +1768,11 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n     }\n \n     // Initiate network connections\n-    int64_t nStart = GetTime();\n+    auto start = GetTime<std::chrono::microseconds>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567941530",
      "id" : 567941530,
      "in_reply_to_id" : 566038761,
      "line" : 1764,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzk0MTUzMA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 1764,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567941530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567964258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567964258"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure it makes much sense to have the average interval measured in microseconds rather than seconds -- poisson timings are for things that don't happen too frequently. With the different types, you get compile time errors if you swap the arguments or if you try setting the poisson interval far too low.\r\n\r\nLooking at godbolt, using `chrono::round` seems to produce much more complicated assembly than doing the math by hand (perhaps due to rounding towards an even value, rather than [0,0.5) going down and [0.5,1.0) going up?). Having it be:\r\n\r\n```c++\r\nstd::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::seconds average_interval)\r\n{\r\n    int64_t delta = (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * (-1.0 * count_microseconds(average_interval)) + 0.5);\r\n    return now + std::chrono::microseconds{ delta };\r\n}\r\n```\r\n\r\nseems like a simpler way to switch the Poisson intervals to chrono types.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T16:33:05Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567964258",
      "id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzk2NDI1OA==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567964258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567992327"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567992327"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might be clearer to have separate constants for inbound/outbound inventory broadcast intervals so it's clear one's 5s and one is 2s?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-01T17:08:25Z",
      "diff_hunk" : "@@ -4564,10 +4564,10 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->nNextInvSend < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = std::chrono::microseconds{m_connman.PoissonNextSendInbound(count_microseconds(current_time), INVENTORY_BROADCAST_INTERVAL)};\n+                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n                         // Use half the delay for outbound peers, as there is less privacy concern for them.\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, std::chrono::seconds{INVENTORY_BROADCAST_INTERVAL >> 1});\n+                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, INVENTORY_BROADCAST_INTERVAL / 2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567992327",
      "id" : 567992327,
      "in_reply_to_id" : 565173767,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzk5MjMyNw==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 4570,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 579913423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/567992327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r568477146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568477146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See also https://github.com/bitcoin/bitcoin/pull/21015#discussion_r567730351",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-02T10:08:41Z",
      "diff_hunk" : "@@ -43,10 +43,10 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n-/** Headers download timeout expressed in microseconds\n+/** Headers download timeout.\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r568477146",
      "id" : 568477146,
      "in_reply_to_id" : 567454798,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODQ3NzE0Ng==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 49,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 581179494,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568477146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r568687558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568687558"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To my understanding, new code should follow the naming convention:\r\n\r\n> Class names, function names, and method names are UpperCamelCase\r\n\r\ninstead of trying to mimic existent code.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-02T15:21:11Z",
      "diff_hunk" : "@@ -27,6 +27,12 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n \n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r568687558",
      "id" : 568687558,
      "in_reply_to_id" : 567454300,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY4NzU1OA==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 38,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 581457404,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/568687558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570249043"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570249043"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> which doesn't really seem right to me.\r\n\r\nDo you mean mathematically or conceptually on a meta level?\r\n\r\nMathematically, it seems correct. Since all variables are constants, we have:\r\n\r\n* Before `600 * ( 1000000 + 500000 * nOtherPeersWithValidatedDownloads)` (unit is `us`, implicitly)\r\n* After `600 * (1. + .5 * nOtherPeersWithValidatedDownloads)`, (unit is `s`, explicitly. Converted by the compiler to `us` by multiplying with 1kk)\r\n\r\nThe difference between the two is zero:\r\n\r\nhttps://www.wolframalpha.com/input/?i=%28+600+*+%28+1000000+%2B+500000+*+x+%29+%29+-+%28+1000000+*+%28+600+*+%28+1+%2B+0.5+*+x+%29+%29+%29",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T14:06:21Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for block_interval * (1 + 0.5 * N)\n         // (with N the number of peers from which we're downloading validated blocks), disconnect due to timeout.\n         // We compensate for other peers to prevent killing off peers due to our own downstream link\n         // being saturated. We only count validated in-flight blocks so peers can't advertise non-existing block hashes\n         // to unreasonably increase our timeout.\n         if (state.vBlocksInFlight.size() > 0) {\n             QueuedBlock &queuedBlock = state.vBlocksInFlight.front();\n             int nOtherPeersWithValidatedDownloads = nPeersWithValidatedDownloads - (state.nBlocksInFlightValidHeaders > 0);\n-            if (count_microseconds(current_time) > state.nDownloadingSince + consensusParams.nPowTargetSpacing * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {\n+            if (current_time > state.m_downloading_since + std::chrono::seconds{consensusParams.nPowTargetSpacing} * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570249043",
      "id" : 570249043,
      "in_reply_to_id" : 567919426,
      "line" : 4820,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDI0OTA0Mw==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 4820,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 228,
      "pull_request_review_id" : 583425315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570249043",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570386265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570386265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T16:56:58Z",
      "diff_hunk" : "@@ -40,13 +40,13 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_TIME = 20 * 60;\n /** Minimum time between orphan transactions expire time checks in seconds */\n static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n /** How long to cache transactions in mapRelay for normal relay */\n-static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n+static constexpr auto RELAY_TX_CACHE_TIME = 15min;\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n-static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n-/** Headers download timeout expressed in microseconds\n+static constexpr auto UNCONDITIONAL_RELAY_DELAY = 2min;\n+/** Headers download timeout.\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570386265",
      "id" : 570386265,
      "in_reply_to_id" : 567730351,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4NjI2NQ==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 49,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 583609463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570386265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570386566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570386566"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T16:57:21Z",
      "diff_hunk" : "@@ -24,8 +24,14 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n  * This helper is used to convert durations before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n-inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n-inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+constexpr inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n+constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+\n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570386566",
      "id" : 570386566,
      "in_reply_to_id" : 567735384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4NjU2Ng==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 33,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 583609853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570386566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570386951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570386951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T16:57:47Z",
      "diff_hunk" : "@@ -24,8 +24,14 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n  * This helper is used to convert durations before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n-inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n-inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+constexpr inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n+constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+\n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570386951",
      "id" : 570386951,
      "in_reply_to_id" : 567898898,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4Njk1MQ==",
      "original_commit_id" : "e5fb29086d3c0502ec63c1890b6b56be5cb7b1d8",
      "original_line" : 38,
      "original_position" : 13,
      "original_start_line" : 30,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 583610271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570386951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570387233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570387233"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T16:58:06Z",
      "diff_hunk" : "@@ -610,9 +610,9 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     }\n \n     // Raw ping time is in microseconds, but show it to user as whole seconds (Bitcoin users should be well used to small numbers with many decimal places by now :)\n-    stats.m_ping_usec = nPingUsecTime;\n-    stats.m_min_ping_usec  = nMinPingUsecTime;\n-    stats.m_ping_wait_usec = count_microseconds(ping_wait);\n+    stats.m_ping_time = m_ping_time;\n+    stats.m_min_ping_time = m_min_ping_time;\n+    stats.m_ping_wait = ping_wait;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570387233",
      "id" : 570387233,
      "in_reply_to_id" : 567453479,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4NzIzMw==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 618,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 583610615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570387233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570387416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570387416"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That was my reasoning as well.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T16:58:19Z",
      "diff_hunk" : "@@ -27,6 +27,12 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n \n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570387416",
      "id" : 570387416,
      "in_reply_to_id" : 567454300,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4NzQxNg==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 38,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 583610837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570387416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570387662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570387662"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks! Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T16:58:38Z",
      "diff_hunk" : "@@ -43,10 +43,10 @@ static constexpr int64_t ORPHAN_TX_EXPIRE_INTERVAL = 5 * 60;\n static constexpr std::chrono::seconds RELAY_TX_CACHE_TIME = std::chrono::minutes{15};\n /** How long a transaction has to be in the mempool before it can unconditionally be relayed (even when not in mapRelay). */\n static constexpr std::chrono::seconds UNCONDITIONAL_RELAY_DELAY = std::chrono::minutes{2};\n-/** Headers download timeout expressed in microseconds\n+/** Headers download timeout.\n  *  Timeout = base + per_header * (expected number of headers) */\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE = 15 * 60 * 1000000; // 15 minutes\n-static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000; // 1ms/header\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_BASE = 15min;\n+static constexpr auto HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER = 1000us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570387662",
      "id" : 570387662,
      "in_reply_to_id" : 567454798,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4NzY2Mg==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 49,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 583611152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570387662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570389331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570389331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As @MarcoFalke mentioned, the units do make sense to me. Also BLOCK_DOWNLOAD_TIMEOUT_BASE in multiples of block intervals seems easier to understand?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T17:00:42Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for block_interval * (1 + 0.5 * N)\n         // (with N the number of peers from which we're downloading validated blocks), disconnect due to timeout.\n         // We compensate for other peers to prevent killing off peers due to our own downstream link\n         // being saturated. We only count validated in-flight blocks so peers can't advertise non-existing block hashes\n         // to unreasonably increase our timeout.\n         if (state.vBlocksInFlight.size() > 0) {\n             QueuedBlock &queuedBlock = state.vBlocksInFlight.front();\n             int nOtherPeersWithValidatedDownloads = nPeersWithValidatedDownloads - (state.nBlocksInFlightValidHeaders > 0);\n-            if (count_microseconds(current_time) > state.nDownloadingSince + consensusParams.nPowTargetSpacing * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {\n+            if (current_time > state.m_downloading_since + std::chrono::seconds{consensusParams.nPowTargetSpacing} * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570389331",
      "id" : 570389331,
      "in_reply_to_id" : 567919426,
      "line" : 4820,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM4OTMzMQ==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 4820,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 228,
      "pull_request_review_id" : 583613314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570389331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570392029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570392029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've converted to microseconds, but left the parenthesis the same as before because it felt more intuitive to be multiplying HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER with something that was a measure of number of headers. C++ operator precedence for `*` and `/` is left -to-right so the math shouldn't change afaict.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T17:04:28Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570392029",
      "id" : 570392029,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM5MjAyOQ==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 583617003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570392029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570394154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570394154"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It does seem better to have the average interval in seconds. Updated.\r\n\r\nI felt that the code reads cleaner with `chrono::round` and have left it in for now. If other reviewers also think more optimal assembly is necessary here, I'll be happy to change it.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T17:07:15Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570394154",
      "id" : 570394154,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM5NDE1NA==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 583619805,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570394154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570394532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570394532"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, that's indeed clearer. Updated.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-04T17:07:47Z",
      "diff_hunk" : "@@ -4564,10 +4564,10 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                 if (pto->m_tx_relay->nNextInvSend < current_time) {\n                     fSendTrickle = true;\n                     if (pto->IsInboundConn()) {\n-                        pto->m_tx_relay->nNextInvSend = std::chrono::microseconds{m_connman.PoissonNextSendInbound(count_microseconds(current_time), INVENTORY_BROADCAST_INTERVAL)};\n+                        pto->m_tx_relay->nNextInvSend = m_connman.PoissonNextSendInbound(current_time, INVENTORY_BROADCAST_INTERVAL);\n                     } else {\n                         // Use half the delay for outbound peers, as there is less privacy concern for them.\n-                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, std::chrono::seconds{INVENTORY_BROADCAST_INTERVAL >> 1});\n+                        pto->m_tx_relay->nNextInvSend = PoissonNextSend(current_time, INVENTORY_BROADCAST_INTERVAL / 2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r570394532",
      "id" : 570394532,
      "in_reply_to_id" : 565173767,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDM5NDUzMg==",
      "original_commit_id" : "64f3fb1a966cfee47e6cfccdd5e9c9540bfebecc",
      "original_line" : 4570,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 583620301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/570394532",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, @MarcoFalke @ajtowns @vasild.\r\n\r\nRebased. Comments addressed. Ready for further review.",
      "created_at" : "2021-02-04T18:50:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-773528387",
      "id" : 773528387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MzUyODM4Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-04T18:50:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773528387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed a test and pushed - ready for further review. Test failure for `test/fuzz/system.cpp` seems to be unrelated and happening on other recent PRs as well.",
      "created_at" : "2021-02-05T01:54:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-773726393",
      "id" : 773726393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MzcyNjM5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-05T01:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/773726393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-11T13:11:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-777445343",
      "id" : 777445343,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NzQ0NTM0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-11T13:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/777445343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574687932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574687932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nconstexpr int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\r\n```\r\n\r\nnit: constexpr implies inline, so no need to specify twice",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-11T17:26:01Z",
      "diff_hunk" : "@@ -24,8 +24,15 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n  * This helper is used to convert durations before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n-inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n-inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+constexpr inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n+constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574687932",
      "id" : 574687932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDY4NzkzMg==",
      "original_commit_id" : "054c6c29366a7f503554d9c85e6fd231008f2f20",
      "original_line" : 28,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 588806614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574687932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 054c6c29366a7f503554d9c85e6fd231008f2f20 changes since last review: \r\n\r\n* Use X macro where possible\r\n* Use std::chrono::seconds::period where possible\r\n* Replace 1000us with 1ms and cast to us where needed\r\n* Use seconds as type for poisson average interval\r\n* Split up inbound/outbound avg interval\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK 054c6c29366a7f503554d9c85e6fd231008f2f20 changes since last review: \r\n\r\n* Use X macro where possible\r\n* Use std::chrono::seconds::period where possible\r\n* Replace 1000us with 1ms and cast to us where needed\r\n* Use seconds as type for poisson average interval\r\n* Split up inbound/outbound avg interval\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUgN/gv9H2XeUVZtB1zj0HIuOVbmki5BuvT6oGnWiKgnzZERJ/zBpbLghWP0snBG\r\n05IunLcL/atno/SNQ6w7B0IXZOtCHiCBgA8nbbEhTngkLY8oLn+rgyAlpc14NGHQ\r\nX3Du9itIuVBjVfVt9v6qK1ywYSdUexgg38XItqgq2UwANXV9CP2koavvZfeiEs48\r\nim/aE92SDUo9cGpx1SjKHFAOc4fnCuWfyuElgnfe3kahYwOoygpdCemQhfo1vyHO\r\nMHMs/EVjhWM9xdpGJ2fPCjrHQbfCz4UdVcouxnqdubM79/7O77EFPMPYMMm+4RhT\r\nyxumFZGX4iSacrwHKdaGB1bh0kA4Lor+zFqu+q5nF13Nj3CI91scaHUGIXc0pqJG\r\n1zbvr/Uks2g1lcJCRoeO04WaZxNKWe5xGHYPWdrdXs9OC+UPnKWAC8PkLdVwHfKH\r\nrN+EUHfsARfLVIYDfq3247k4DCZUM4zipp/B03Nndo1QwqBFvBxpcpcgqaE8eehE\r\nfUIk46tK\r\n=2UZp\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `2a4b9786606b664d2c4b408f943adf429fbf9af7568a63e4d184c0ab0674bedf  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401082a4b9786606b664d2c4b408f943adf429fbf9af7568a63e4d184c0ab0674bedff0108f2665f411577443304b6734f223670008fff0108233bf6300b78d1fac482ffe183a20a008f10460255ce2f008d3b0187fe19d2b3b0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff01089176a0c99a96f07eacca9427acb57aa08f10460256ab4f008538bd40337558e5d0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0108d3ff7ce1f3cc36d7810ce19478076ae08f10460256ab4f00886b6b5cb6cbaa84c0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010ff86b78463c6e7c5feb863fdebf2c5a408f10460256ab4f008de27d14be29669bf0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2021-02-11T17:34:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-777665019",
      "id" : 777665019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NzY2NTAxOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-11T17:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/777665019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574909973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574909973"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-11T23:57:58Z",
      "diff_hunk" : "@@ -24,8 +24,15 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n  * This helper is used to convert durations before passing them over an\n  * interface that doesn't support std::chrono (e.g. RPC, debug log, or the GUI)\n  */\n-inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n-inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n+constexpr inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n+constexpr inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574909973",
      "id" : 574909973,
      "in_reply_to_id" : 574687932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDkwOTk3Mw==",
      "original_commit_id" : "054c6c29366a7f503554d9c85e6fd231008f2f20",
      "original_line" : 28,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 589088312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574909973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. Comment addressed. Ready for further review.",
      "created_at" : "2021-02-12T00:48:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-777894191",
      "id" : 777894191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3Nzg5NDE5MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-12T00:48:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/777894191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574986644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574986644"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, I'd still suggest adding a comment explaining the conversion to `std::chrono::microseconds` -- the usual point of chrono types is that it does the right conversions behind the scenes, so the fact it's getting done manually is weird and could use an explanation I think.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-12T04:43:46Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574986644",
      "id" : 574986644,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDk4NjY0NA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 589170681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574986644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574998489"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574998489"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"doesn't really seem right\" -- yeah, more along the lines of \"morally right\" vs \"mathematically correct\" :)\r\n\r\nIn general using doubles where they're not needed just seems like a bad idea to me -- there's way more possible special cases and pitfalls with them, and the code already works fine without them, so why change it? Changing behaviour in potentially subtle ways in refactors bothers me in general -- to me that seems like the easiest way for a potential attacker to slip vulnerabilities into the codebase.\r\n\r\nFor example, in this line, I think behind the scenes chrono is:\r\n\r\n * converting the `chrono::seconds` version of `nPowTargetSpacing` to `duration<double,ratio=1,1>` when multiplying by a double\r\n * converting both `m_downloading_since` and the result of the above to `duration<double,ratio=1,1000000>` (converting one to a double, multiplying the other by 1M)\r\n * converting `current_time` to the `duration<double,ratio=1,1000000>` (ie conveting to a double) as well and then doing a floating point comparison between the two\r\n\r\nAre those all fine? Yeah, I think so -- but why add the burden of reviewing all that just to use \"0.5\" instead of \"500000\"? In general, figuring out what the code actually does is the tricky part, so  making it easy to see what the plan was and hard to see what the compiler's going to do seems backwards to me in general. After all, if it's not clear from the code what the plan was, you can add a comment.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-12T05:33:41Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for block_interval * (1 + 0.5 * N)\n         // (with N the number of peers from which we're downloading validated blocks), disconnect due to timeout.\n         // We compensate for other peers to prevent killing off peers due to our own downstream link\n         // being saturated. We only count validated in-flight blocks so peers can't advertise non-existing block hashes\n         // to unreasonably increase our timeout.\n         if (state.vBlocksInFlight.size() > 0) {\n             QueuedBlock &queuedBlock = state.vBlocksInFlight.front();\n             int nOtherPeersWithValidatedDownloads = nPeersWithValidatedDownloads - (state.nBlocksInFlightValidHeaders > 0);\n-            if (count_microseconds(current_time) > state.nDownloadingSince + consensusParams.nPowTargetSpacing * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {\n+            if (current_time > state.m_downloading_since + std::chrono::seconds{consensusParams.nPowTargetSpacing} * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r574998489",
      "id" : 574998489,
      "in_reply_to_id" : 567919426,
      "line" : 4820,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDk5ODQ4OQ==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 4820,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 228,
      "pull_request_review_id" : 589183319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574998489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575006627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575006627"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Optimal assembly doesn't matter so much (we're calculating log1p at the same time which presumably isn't that quick), it's more that it's not particularly obvious to me that using `chrono::round` doesn't introduce a bug, and I don't see any need for the change. Obviously if it does introduce a bug, that would be the compiler's fault rather than yours per se, but that happens too.\r\n\r\nI think an alternative way of writing what we currently do would be:\r\n\r\n```c++\r\n    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\r\n    return now + std::chrono::duration_cast<std::chrono::microseconds>(unscaled * average_interval + 0.5us);\r\n```\r\n\r\nIt doesn't generate precisely the same asm as the current code because the \"-\" isn't attached to the factor of 1M anymore but I think that's the only difference, so it seems easier to be sure that's actually not changing any behaviour.\r\n\r\n(I don't think there's any real value in rounding to the nearest microsecond rather than just truncating -- everything we do ends up being at intervals of 50,000 or 100,000 microseconds anyway)\r\n\r\nEDIT: (`0.5*1us` -> `0.5us`)",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-12T06:04:56Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575006627",
      "id" : 575006627,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTAwNjYyNw==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 589192070,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575006627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Codereview ACK 7b57704",
      "created_at" : "2021-02-12T06:39:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-778009321",
      "id" : 778009321,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3ODAwOTMyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-12T06:39:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/778009321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575057402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575057402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Personally I think this is an example of where the naming convention is buggy rather than the code; but especially if `int64_t count_seconds(seconds)` should be `int64_t CountSeconds(seconds)` we shouldn't be introducing `double CountSeconds(SecondsDouble)` with a name clash like that -- would `CountSeconds(micros)` return an int or double?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-12T08:30:04Z",
      "diff_hunk" : "@@ -27,6 +27,12 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n \n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575057402",
      "id" : 575057402,
      "in_reply_to_id" : 567454300,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTA1NzQwMg==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 38,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 589252252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575057402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575165654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575165654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'd personally just prefer `std::chrono::duration<double>(t).count()` instead of a helper.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-12T11:42:13Z",
      "diff_hunk" : "@@ -27,6 +27,12 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n \n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575165654",
      "id" : 575165654,
      "in_reply_to_id" : 567454300,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTE2NTY1NA==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 38,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 589388230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575165654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK 7b577049fe87a20f6d12fb7ce4e7d9941d971de1 only change is removing redundant inline \r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK 7b577049fe87a20f6d12fb7ce4e7d9941d971de1 only change is removing redundant inline \r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjaCQv/eNRybP+jarAixi/2KGfs6eWdq5SLdk9Vrgz5WQg9o0IW4QMh5Hcs0515\r\nOGgZ2bI6MtSr/BioiFWsfbfvu0OyLonkfKAuQ4TBhkhlRCTXPsG0pq2RiGfaevWC\r\nh79FhANZdnyYpDAAdOvQ2DmPsN6qnymMq3XjWDlgUZAXeSpS2hG5Df0EKsIGicx4\r\nd9EUOH2safkGaXQDwlQpKRlmlIO7OoXYvHhg6JnJy/WrGB3aiyFw+OBs5EdlhGV3\r\nPxwCDbkWBtKqTXtyt/Qvrbzg5tFTzh4x0YF70NxMuKO0SJ2MXOmCDnQ3JjnZqO/U\r\nKoNKcDHn+JSIHducBWVuDcLjTBOa6/RWs9kfZJsCx/zGoqBHbCPfenn6DHZS0g4a\r\n72k6Qu9Nax14WdsF6iejGIebCVmgD3NR1MYu+FPvzuTGwzfcXM7EhdCNl2QLGRET\r\nIFP0YsVwlPNjhHT2suOi70Ccxa2DfTYP5QhEY4sD0BJjl+WnTWeQnE2c4KNqmjfA\r\nbvyLfPAi\r\n=zPnG\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `f12ad6bf5ab4e44d86abf6dc1d7b5e4d1055bbe1d0a8c92f66c2328ae35c674f  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e892940108f12ad6bf5ab4e44d86abf6dc1d7b5e4d1055bbe1d0a8c92f66c2328ae35c674ff010cb62e331da1cd70b1a319136fc53f19708fff0103b6415a6e230dad80a5dcfafd9213a1808f020e1e2e7dddca2d012b196b02d53517de4a8b5cbb7a48509b3d10c3b84b344a94008f104602669fff008d7b1456dd2e1f81e0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010687b0df24b21283acf72ad297bd2378008f020189ec756b0d12c147f47dd0d658248dbcbc12ac402e264f3b2e16d3b76d820de08f10460265c2df008c49ba796f2bf7d6a0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff010b542d35e7e6db6986cee154e1e12910f08f0200197458580af977a33d7c3aafc09e5f291fad1922cde5207d7d04c3e8d8b57be08f104602669fff008d0b97129760822660083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6df010eaf4522f55b52da5ed467f7db023871908f120b8b992a4fa7757780b8533b214b02d9879e8b764213646fbff0a36dac87187f908f104602669fff008cc9f11e5cdfb224d0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2021-02-12T11:44:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-778147114",
      "id" : 778147114,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3ODE0NzExNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-12T11:44:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/778147114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-12T12:12:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-778159609",
      "id" : 778159609,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3ODE1OTYwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-12T12:12:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/778159609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575823488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575823488"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-14T15:22:38Z",
      "diff_hunk" : "@@ -4383,7 +4383,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             // Only actively request headers from a single peer, unless we're close to today.\n             if ((nSyncStarted == 0 && fFetch) || pindexBestHeader->GetBlockTime() > GetAdjustedTime() - 24 * 60 * 60) {\n                 state.fSyncStarted = true;\n-                state.nHeadersSyncTimeout = count_microseconds(current_time) + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/(consensusParams.nPowTargetSpacing);\n+                state.m_headers_sync_timeout = current_time + HEADERS_DOWNLOAD_TIMEOUT_BASE + HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER * (GetAdjustedTime() - pindexBestHeader->GetBlockTime())/consensusParams.nPowTargetSpacing;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575823488",
      "id" : 575823488,
      "in_reply_to_id" : 565826688,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTgyMzQ4OA==",
      "original_commit_id" : "c0822a71b5fabb39e6bbf7355b69f9f1b9264fde",
      "original_line" : 4386,
      "original_position" : 154,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 590057951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575823488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575823493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575823493"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Renamed to `CountSecondsDouble`",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-14T15:22:42Z",
      "diff_hunk" : "@@ -27,6 +27,12 @@ void UninterruptibleSleep(const std::chrono::microseconds& n);\n inline int64_t count_seconds(std::chrono::seconds t) { return t.count(); }\n inline int64_t count_microseconds(std::chrono::microseconds t) { return t.count(); }\n \n+/**\n+ * Helper to count the seconds in any std::chrono::duration type\n+ */\n+using SecondsDouble = std::chrono::duration<double, std::ratio<1, 1>>;\n+inline double CountSeconds(SecondsDouble t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575823493",
      "id" : 575823493,
      "in_reply_to_id" : 567454300,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTgyMzQ5Mw==",
      "original_commit_id" : "0b7cf5889c3baddbe4dcca7231a81e113a2c0c0c",
      "original_line" : 38,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : null,
      "pull_request_review_id" : 590057955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575823493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575825925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575825925"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There's definitely a tradeoff between the probability of introducing a bug and modernizing our codebase. When we choose to embrace a new stdlib or language feature, I'd propose we should do it _relatively_ consistently (lower level code will be more resistant). It seems we're adopting `std::chrono`, so `std::chrono::round` is not that different.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-14T15:41:48Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r575825925",
      "id" : 575825925,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTgyNTkyNQ==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 590059603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/575825925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. Ready for further review.",
      "created_at" : "2021-02-14T15:43:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-778795575",
      "id" : 778795575,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3ODc5NTU3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-14T15:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/778795575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fuzz tests on CI are timing out. I tried re-running but that did not help and I do not believe the failure to be related to this PR.",
      "created_at" : "2021-02-15T05:45:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-778960066",
      "id" : 778960066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3ODk2MDA2Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T05:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/778960066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r576159108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576159108"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think if we can't trust the compiler to produce correct code, and can't trust our test to catch the issue either, there is nothing we can do preemptively other than write more tests. Choosing one version of the code over another in the absence of any known compiler miscompilation bugs doesn't seem too helpful to me, because we don't know if any of our dependencies use that piece of code in either a header or library.\r\n\r\n(I am not saying which version to pick here. I am happy to review and ACK any version that does the right thing)",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-15T12:30:32Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r576159108",
      "id" : 576159108,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjE1OTEwOA==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 590433844,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576159108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ci timeout is unrelated and can be ignored\r\n\r\nre-ACK 7b6775ba7e2303128743db55e769e3339b3fc28f only changes are rename to CountSecondsDouble, adding a comment, rebase \r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK 7b6775ba7e2303128743db55e769e3339b3fc28f only changes are rename to CountSecondsDouble, adding a comment, rebase \r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUhRhgwArVe9YuYCz8vG/HmuQ1fTwAMMq4rn+C3DYUi2xXGzKJvkESpCCeXfuR6v\r\nrrJF1Jec0Oa4okln8GoNtnweBDMpJKUZ+hecuCF1zkz8QP/Krifps/HdE95cpDEr\r\nfZD1Y6PtpARGQZ4fLs4AF1XixA5iwT7HemwQ7r1c2AIx4AqNogGts4ysOd7+aRTd\r\nN94vnABZqiXnwFrwosMfXGTvsmnnxe2UpjI7oZV8zUOeJTna4GZnsxTwKrgaqPLD\r\n8igcQJmLmfy9bvxab7nyCzfgU1CziA+L9RXov0JExh5rj8gKYwt93zoHanu4XsMf\r\nhgTlPihTkfktMUaddBelhrX1RHsljS4eSiFZpHQkglO3CCX8xpsFSs4gJIkN3u+V\r\nOYwnvMBHFZqcau1zXrDExXRc/FMwdcJ8/NNTcm1dXqFMf7JF7Z79NYFwABIrWT6u\r\nsemQaAMGVTmFY6edIcIU6ub6TkHl3+LPZKXeiqaiep4kwZ02YdJikaQ9lx71peAR\r\nzyaVKgcx\r\n=1zZf\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `56cb64cc51974c4141f8d6d3e56dc029e55880ad9edea70a140e1d4e5d83605f  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e89294010856cb64cc51974c4141f8d6d3e56dc029e55880ad9edea70a140e1d4e5d83605ff010d1f163d06c2aab4006989baea2cdad1b08fff01090826f2c246d668fcb949cec3bfae37108f104602a5cbcf008d8d29f32bce36bb60083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff010d8f0ff3b4253e6d4da056d269e65074908f104602a6a8ff008bc8ed3052a6542290083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010e21f805d6465724269cda6808951541708f104602a6a8ef008a6dc818e4899f80e0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6df010ef6142f9b8aa50be873a34770185ed3008f104602a6a8ef008e5fd1eb232939a870083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2021-02-15T12:36:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-779195504",
      "id" : 779195504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTE5NTUwNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-15T12:36:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779195504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r576507483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576507483"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> It seems we're adopting `std::chrono`, so `std::chrono::round` is not that different.\r\n\r\nI just explained why std::chrono::round is different -- it does different, substantially more complicated logic than the current code [0]. Converting to `std::chrono::duration` doesn't do different logic to just having an `int64_t`, it just adds type safety to help avoid mixing different scales. We don't need to use `::round` to use `std::chrono`-- we can do `duration_cast` to truncate instead. Rounding to even has its place (https://mathematica.stackexchange.com/questions/2116/why-round-to-even-integers) but none of those reasons apply here.\r\n\r\n[0] It's kind-of weird that it does more logic -- round to even is a standard IEEE754 rounding mode so it ought not to require custom template code or result in complicated assembly.\r\n\r\n> Choosing one version of the code over another in the absence of any known compiler miscompilation bugs\r\n\r\nIn the absence of a good reason to make a change, don't make a change. If there's two approaches that achieve the same result, choose the simpler one.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-16T02:09:52Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r576507483",
      "id" : 576507483,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjUwNzQ4Mw==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 590840834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576507483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r576594274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576594274"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have now actually benchmarked the `PoissonNextSend` in 3 different variants: original, round, duration_cast. Here are the results:\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,338.00 |          427,716.00 |    0.4% |        6,721.29 |        7,467.00 |  0.900 |         193.00 |    0.5% |      0.00 | `old`\r\n|            2,380.33 |          420,109.23 |    1.8% |        6,749.57 |        7,603.17 |  0.888 |         199.29 |    0.4% |      0.00 | `round`\r\n|            2,338.12 |          427,693.13 |    0.3% |        6,749.00 |        7,486.00 |  0.902 |         199.29 |    0.4% |      0.00 | `duration_cast`\r\n\r\nThe runtime difference here unmeasurable. The overhead is completely dwarfed by `GetRand`. When I then replaced `GetRand` with the simplest possible random generator I could think of:\r\n\r\n```cpp\r\ninline uint64_t myRand(uint64_t maxnum) {\r\n    static uint64_t x = 1;\r\n    auto tmp = x % maxnum;\r\n    x *= 123123121;\r\n    return tmp;\r\n}\r\n```\r\n\r\nRan the benchmark again:\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|               18.43 |       54,269,715.35 |    0.4% |          110.27 |           58.90 |  1.872 |          13.78 |    4.5% |      0.00 | `original`\r\n|               24.60 |       40,642,221.28 |    0.3% |          143.80 |           78.60 |  1.830 |          20.85 |    3.1% |      0.00 | `round`\r\n|               24.55 |       40,724,958.20 |    0.3% |          143.82 |           78.57 |  1.831 |          20.85 |    3.0% |      0.00 | `duration_cast`\r\n\r\nThere is a slight difference between `duration_cast` and `round`, but hardly significant. \r\n\r\nSo at least on my Intel CPU there is no performance argument for duration_cast in this case.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-16T07:16:28Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r576594274",
      "id" : 576594274,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjU5NDI3NA==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 590935911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/576594274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-16T11:56:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-779789916",
      "id" : 779789916,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3OTc4OTkxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-16T11:56:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/779789916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r577016316"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577016316"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "With no material performance difference, my preference aside, I do not see a reason to hold up this PR. Updated the code to use `duration_cast`.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-16T17:47:00Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r577016316",
      "id" : 577016316,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzAxNjMxNg==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 591475037,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/577016316",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. Ready for further review.",
      "created_at" : "2021-02-16T17:47:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-780007354",
      "id" : 780007354,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4MDAwNzM1NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-16T17:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/780007354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578164955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578164955"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in the first commit: why is this renamed?",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T06:36:25Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578164955",
      "id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODE2NDk1NQ==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 592889285,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578164955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578166464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578166464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did that to make it more consistent (and as the type changes, all call sites have to be touched anyway).",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T06:39:57Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578166464",
      "id" : 578166464,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODE2NjQ2NA==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 592890862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578166464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578168275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578168275"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I mean rename from `m_last_ping_time` to `m_ping_time` (removing the \"last\"), which happened in the latest rebase.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T06:45:19Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578168275",
      "id" : 578168275,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODE2ODI3NQ==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 592893183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578168275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578179011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578179011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> In the absence of a good reason to make a change, don't make a change. If there's two approaches that achieve the same result, choose the simpler one.\r\n\r\nObviously I agree with that statement, but it doesn't seem applicable here. First, it doesn't look like the duration cast produces the same binary for me: https://godbolt.org/z/nejf46. And second, the `round` variant is simpler and shorter code.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T07:11:24Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578179011",
      "id" : 578179011,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODE3OTAxMQ==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 592905984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578179011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578179328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578179328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Still not addressed",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T07:12:13Z",
      "diff_hunk" : "@@ -48,10 +48,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578179328",
      "id" : 578179328,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODE3OTMyOA==",
      "original_commit_id" : "f4450e105781441020964af1e488a033ec1c4be4",
      "original_line" : 52,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 592906422,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578179328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578239662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578239662"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Notice - it was renamed _to_ `m_ping_time` in previous incarnations of this PR:\r\n\r\n`df8892dc9..7b6775ba7`: `nPingUsecTime` -> `m_ping_time`\r\n`9bbf08bf9..f4450e105`: `m_last_ping_time` -> `m_ping_time`\r\n\r\nSo, it is all consistent from this PR's point of view. Just `master` changed from `nPingUsecTime` to `m_last_ping_time`. I think either one of `m_last_ping_time` or `m_ping_time` is fine.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T08:58:36Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578239662",
      "id" : 578239662,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODIzOTY2Mg==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 592982118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578239662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578241303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578241303"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I know :)\r\n\r\nMy opinion is just that it doesn't make sense to rename this after the rebase",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T09:00:59Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578241303",
      "id" : 578241303,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODI0MTMwMw==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 592984281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578241303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578268032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578268032"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe the differences are that `average_interval` goes from `int` to `int64_t` precision, and `0.5us` is a long double while `0.5` is a double. I think replacing `chrono::round<chrono::microseconds>` with:\r\n\r\n```c++\r\ntemplate<typename Dur, typename Dur2>\r\nconstexpr Dur chrono_round_half_up(Dur2 dur)\r\n{\r\n    return std::chrono::duration_cast<Dur>(Dur{1}*0.5 + dur);\r\n}\r\n```\r\n\r\nwill generate the same code that we currently get on clang (except for `average_interval_seconds` being int vs int64_t):  https://godbolt.org/z/rxjdc8 . gcc seems to generate different code due to negating the log1p result then multiplying by 1M rather than just multiplying by -1M.\r\n\r\n[EDIT: function can be constexpr]",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T09:39:24Z",
      "diff_hunk" : "@@ -2917,20 +2917,21 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     return found != nullptr && NodeFullyConnected(found) && func(found);\n }\n \n-int64_t CConnman::PoissonNextSendInbound(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds CConnman::PoissonNextSendInbound(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    if (m_next_send_inv_to_incoming < now) {\n+    if (m_next_send_inv_to_incoming.load() < now) {\n         // If this function were called from multiple threads simultaneously\n         // it would possible that both update the next send variable, and return a different result to their caller.\n         // This is not possible in practice as only the net processing thread invokes this function.\n-        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval_seconds);\n+        m_next_send_inv_to_incoming = PoissonNextSend(now, average_interval);\n     }\n     return m_next_send_inv_to_incoming;\n }\n \n-int64_t PoissonNextSend(int64_t now, int average_interval_seconds)\n+std::chrono::microseconds PoissonNextSend(std::chrono::microseconds now, std::chrono::microseconds average_interval)\n {\n-    return now + (int64_t)(log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */) * average_interval_seconds * -1000000.0 + 0.5);\n+    double unscaled = -log1p(GetRand(1ULL << 48) * -0.0000000000000035527136788 /* -1/2^48 */);\n+    return now + std::chrono::round<std::chrono::microseconds>(unscaled * average_interval);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578268032",
      "id" : 578268032,
      "in_reply_to_id" : 567964258,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODI2ODAzMg==",
      "original_commit_id" : "0473d80bca0ca96f4a75cd49d697cbc13aafcdc8",
      "original_line" : 2958,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 593018847,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578268032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578529918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578529918"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What I'd prefer is something more like:\r\n\r\n```c++\r\nconstexpr Fraction BLOCK_DOWNLOAD_TIMEOUT_BASE{1};\r\nconstexpr Fraction BLOCK_DOWNLOAD_TIMEOUT_PER_PEER{1,2};\r\n```\r\n\r\nso that you can define the constants meaningfully, but still have all the calculations done with integer math. You can make that actually work relatively easily:\r\n\r\n```c++\r\nclass Fraction {\r\npublic:\r\n    constexpr Fraction(int64_t n, int64_t d) : num{n}, den{d} { }\r\n    explicit constexpr Fraction(int64_t n) : num{n}, den{1} { }\r\n    int64_t num = 0, den = 1;\r\n};\r\n\r\nconstexpr Fraction operator+(Fraction l, Fraction r) { return Fraction{l.num*r.den + r.num*l.den, l.den*r.den}; }\r\nconstexpr Fraction operator*(Fraction l, int64_t n) { return Fraction{l.num*n, l.den}; }\r\nconstexpr std::chrono::microseconds operator*(std::chrono::microseconds t, Fraction f) { return t*f.num/f.den; }\r\n```\r\n\r\nbut maintaining a special class for this seems crazy, and C++ stdlib seems to only provide compile-time rationals (via std::ratio) which is useless here, and boost::rational seems to insist on normalising the denominator for no particular reason (and the fixedpoint stuff seems even more overkill). Still not convinced having floating point math is a win compared to just having 1M and 500k as constants, but there doesn't seem to be any better alternatives than those.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-18T15:49:17Z",
      "diff_hunk" : "@@ -4693,33 +4693,33 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n \n         // Detect whether we're stalling\n         current_time = GetTime<std::chrono::microseconds>();\n-        if (state.nStallingSince && state.nStallingSince < count_microseconds(current_time) - 1000000 * BLOCK_STALLING_TIMEOUT) {\n+        if (state.m_stalling_since.count() && state.m_stalling_since < current_time - BLOCK_STALLING_TIMEOUT) {\n             // Stalling only triggers when the block download window cannot move. During normal steady state,\n             // the download window should be much larger than the to-be-downloaded set of blocks, so disconnection\n             // should only happen during initial block download.\n             LogPrintf(\"Peer=%d is stalling block download, disconnecting\\n\", pto->GetId());\n             pto->fDisconnect = true;\n             return true;\n         }\n-        // In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval\n+        // In case there is a block that has been in flight from this peer for block_interval * (1 + 0.5 * N)\n         // (with N the number of peers from which we're downloading validated blocks), disconnect due to timeout.\n         // We compensate for other peers to prevent killing off peers due to our own downstream link\n         // being saturated. We only count validated in-flight blocks so peers can't advertise non-existing block hashes\n         // to unreasonably increase our timeout.\n         if (state.vBlocksInFlight.size() > 0) {\n             QueuedBlock &queuedBlock = state.vBlocksInFlight.front();\n             int nOtherPeersWithValidatedDownloads = nPeersWithValidatedDownloads - (state.nBlocksInFlightValidHeaders > 0);\n-            if (count_microseconds(current_time) > state.nDownloadingSince + consensusParams.nPowTargetSpacing * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {\n+            if (current_time > state.m_downloading_since + std::chrono::seconds{consensusParams.nPowTargetSpacing} * (BLOCK_DOWNLOAD_TIMEOUT_BASE + BLOCK_DOWNLOAD_TIMEOUT_PER_PEER * nOtherPeersWithValidatedDownloads)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578529918",
      "id" : 578529918,
      "in_reply_to_id" : 567919426,
      "line" : 4820,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODUyOTkxOA==",
      "original_commit_id" : "bc5f977be87f227f2dbd5bfc0f3673fc958f8f64",
      "original_line" : 4820,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 228,
      "pull_request_review_id" : 593363274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/578529918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-02-25T15:46:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-785999188",
      "id" : 785999188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NTk5OTE4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-25T15:46:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/785999188",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r583474249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583474249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I renamed this from `nPingUsecTime` to `m_last_ping_time` in #20721. I think `m_last_ping_time` is slightly better than `m_ping_time` because it makes it clear that this is the time from the most recent ping/pong round trip. The next field is `m_min_ping_time`, which is the minimum time of all the ping/pong round trips.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-02-26T08:46:16Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r583474249",
      "id" : 583474249,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MzQ3NDI0OQ==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 599361709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583474249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns if there are specifics that you want to see addressed, it might help to post a patch which compiles and that can be taken in the next rebase. Otherwise I think this is ready for merge (mod the nits, which can be fixed in the next rebase as well).",
      "created_at" : "2021-02-26T08:56:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-786506585",
      "id" : 786506585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4NjUwNjU4NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-26T08:56:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/786506585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586316752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586316752"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since you're changing these lines already, it might be a nice opportunity to remove them from the ctor and use default initialization:\r\n\r\n```diff\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 3c8ef345e1..caac75b72e 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -537,12 +537,12 @@ struct CNodeState {\r\n     //! Whether we've started headers synchronization with this peer.\r\n     bool fSyncStarted;\r\n     //! When to potentially disconnect peer for stalling headers download\r\n-    std::chrono::microseconds m_headers_sync_timeout;\r\n+    std::chrono::microseconds m_headers_sync_timeout{0us};\r\n     //! Since when we're stalling block download progress (in microseconds), or 0.\r\n-    std::chrono::microseconds m_stalling_since;\r\n+    std::chrono::microseconds m_stalling_since{0us};\r\n     std::list<QueuedBlock> vBlocksInFlight;\r\n     //! When the first entry in vBlocksInFlight started downloading. Don't care when vBlocksInFlight is empty.\r\n-    std::chrono::microseconds m_downloading_since;\r\n+    std::chrono::microseconds m_downloading_since{0us};\r\n     int nBlocksInFlight;\r\n     int nBlocksInFlightValidHeaders;\r\n     //! Whether we consider this a preferred download peer.\r\n@@ -625,9 +625,6 @@ struct CNodeState {\r\n         pindexBestHeaderSent = nullptr;\r\n         nUnconnectingHeaders = 0;\r\n         fSyncStarted = false;\r\n-        m_headers_sync_timeout = 0us;\r\n-        m_stalling_since = 0us;\r\n-        m_downloading_since = 0us;\r\n         nBlocksInFlight = 0;\r\n         nBlocksInFlightValidHeaders = 0;\r\n         fPreferredDownload = false;\r\n```",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T10:55:45Z",
      "diff_hunk" : "@@ -621,9 +625,9 @@ struct CNodeState {\n         pindexBestHeaderSent = nullptr;\n         nUnconnectingHeaders = 0;\n         fSyncStarted = false;\n-        nHeadersSyncTimeout = 0;\n-        nStallingSince = 0;\n-        nDownloadingSince = 0;\n+        m_headers_sync_timeout = 0us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586316752",
      "id" : 586316752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjMxNjc1Mg==",
      "original_commit_id" : "f4450e105781441020964af1e488a033ec1c4be4",
      "original_line" : 628,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 602764077,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586316752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586639056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586639056"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T17:44:56Z",
      "diff_hunk" : "@@ -621,9 +625,9 @@ struct CNodeState {\n         pindexBestHeaderSent = nullptr;\n         nUnconnectingHeaders = 0;\n         fSyncStarted = false;\n-        nHeadersSyncTimeout = 0;\n-        nStallingSince = 0;\n-        nDownloadingSince = 0;\n+        m_headers_sync_timeout = 0us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586639056",
      "id" : 586639056,
      "in_reply_to_id" : 586316752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjYzOTA1Ng==",
      "original_commit_id" : "f4450e105781441020964af1e488a033ec1c4be4",
      "original_line" : 628,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 603174551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586639056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586639269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586639269"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T17:45:16Z",
      "diff_hunk" : "@@ -48,10 +48,10 @@ static const bool DEFAULT_WHITELISTFORCERELAY = false;\n \n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n-/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n-static const int FEELER_INTERVAL = 120;\n+/** Run the feeler connection loop once every 2 minutes. **/\n+static constexpr auto FEELER_INTERVAL = std::chrono::minutes{2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586639269",
      "id" : 586639269,
      "in_reply_to_id" : 578179328,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjYzOTI2OQ==",
      "original_commit_id" : "f4450e105781441020964af1e488a033ec1c4be4",
      "original_line" : 52,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 603174851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586639269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586639685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586639685"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. Using m_last_ping_time now.",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T17:45:45Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586639685",
      "id" : 586639685,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjYzOTY4NQ==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 603175342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T17:48:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586639685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. `master` changed while I was rebasing, so we see 2 force pushes. Reviewers can use `git range-diff cabe637 f4450e1 0eaea66` for convenience.\r\n\r\nComments addressed:\r\n- https://github.com/bitcoin/bitcoin/pull/21015#discussion_r583474249\r\n- https://github.com/bitcoin/bitcoin/pull/21015#discussion_r578179328\r\n- https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586316752\r\n\r\nReady for further review.",
      "created_at" : "2021-03-03T17:57:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-789937555",
      "id" : 789937555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc4OTkzNzU1NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-03T18:23:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/789937555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586719272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586719272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T19:31:20Z",
      "diff_hunk" : "@@ -621,9 +625,9 @@ struct CNodeState {\n         pindexBestHeaderSent = nullptr;\n         nUnconnectingHeaders = 0;\n         fSyncStarted = false;\n-        nHeadersSyncTimeout = 0;\n-        nStallingSince = 0;\n-        nDownloadingSince = 0;\n+        m_headers_sync_timeout = 0us;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586719272",
      "id" : 586719272,
      "in_reply_to_id" : 586316752,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjcxOTI3Mg==",
      "original_commit_id" : "f4450e105781441020964af1e488a033ec1c4be4",
      "original_line" : 628,
      "original_position" : 116,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 603270273,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T19:31:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586719272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586719386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586719386"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks!",
      "commit_id" : "0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T19:31:33Z",
      "diff_hunk" : "@@ -591,11 +591,11 @@ class CNode\n     std::atomic<int64_t> nLastTXTime{0};\n \n     /** Last measured round-trip time. Used only for RPC/GUI stats/debugging.*/\n-    std::atomic<int64_t> m_last_ping_time{0};\n+    std::atomic<std::chrono::microseconds> m_ping_time{0us};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#discussion_r586719386",
      "id" : 586719386,
      "in_reply_to_id" : 578164955,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NjcxOTM4Ng==",
      "original_commit_id" : "3e99b4c23a6cc55d6e0c29a8683e78afab88f78a",
      "original_line" : 594,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 603270438,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21015",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-03T19:31:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/586719386",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 0eaea66e8bfdfb23ff86c0f0924c2d75f5aca75f",
      "created_at" : "2021-03-03T19:36:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21015#issuecomment-790001460",
      "id" : 790001460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21015",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5MDAwMTQ2MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-03T19:36:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/790001460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
