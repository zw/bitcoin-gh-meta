[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20362 by MarcoFalke\n* #18554 by rodentrabies\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-06T01:22:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-774370548",
      "id" : 774370548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDM3MDU0OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-09T06:56:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774370548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This needs rebase now that #21009 is merged. I did my own rebase here: https://github.com/jnewbery/bitcoin/tree/pr21090.1 since I need it for #20799. Feel free to take that if it's helpful.\r\n\r\nI think it might make sense to remove the `test_upgrade_after_activation()` subtest from p2p_segwit.py and place it in its own file. It's not anything to do with p2p and doesn't have any dependencies on the rest of that test.",
      "created_at" : "2021-04-27T09:00:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-827442618",
      "id" : 827442618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyNzQ0MjYxOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-27T09:00:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/827442618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased against master, ready for review.\r\n\r\n@jnewbery it does make a ton of sense to extract `test_upgrade_after_activation()` into another file. Once `-reindex` has the expected effect, the rest of the test merely verifies that the node syncs on to the strongest chain, and that is in covered in other tests. I've gone ahead and done that refactor. This also simplified `p2p_segwit.py` since it now only needs two nodes for the rest of the test cases.",
      "created_at" : "2021-04-29T18:16:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-829482770",
      "id" : 829482770,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgyOTQ4Mjc3MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-29T18:16:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/829482770",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623302697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623302697"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            throw std::runtime_error(strprintf(\"Activation height %ld for segwit is out of valid range.\", height));\r\n```",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-29T18:42:41Z",
      "diff_hunk" : "@@ -490,11 +490,8 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n {\n     if (args.IsArgSet(\"-segwitheight\")) {\n         int64_t height = args.GetArg(\"-segwitheight\", consensus.SegwitHeight);\n-        if (height < -1 || height >= std::numeric_limits<int>::max()) {\n+        if (height < 0 || height >= std::numeric_limits<int>::max()) {\n             throw std::runtime_error(strprintf(\"Activation height %ld for segwit is out of valid range. Use -1 to disable segwit.\", height));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623302697",
      "id" : 623302697,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzMwMjY5Nw==",
      "original_commit_id" : "117ae3f264ec6d3dd23e2e71a308d4df8e3d0702",
      "original_line" : 494,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : null,
      "pull_request_review_id" : 648536417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623302697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623519618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623519618"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I [think](https://developer.bitcoin.org/reference/p2p_networking.html#sendcmpct) the only allowed values for `nCMPCTBLOCKVersion` are 1 or 2. Can this conditional be removed altogether (especially since `fWantsCmpctWitness` is conditioned appropriately below)? Or perhaps replaced with `if (0 < nCMPCTBLOCKVersion < 3)` ?",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T01:03:48Z",
      "diff_hunk" : "@@ -2586,7 +2585,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         bool fAnnounceUsingCMPCTBLOCK = false;\n         uint64_t nCMPCTBLOCKVersion = 0;\n         vRecv >> fAnnounceUsingCMPCTBLOCK >> nCMPCTBLOCKVersion;\n-        if (nCMPCTBLOCKVersion == 1 || ((pfrom.GetLocalServices() & NODE_WITNESS) && nCMPCTBLOCKVersion == 2)) {\n+        if (nCMPCTBLOCKVersion == 1 || nCMPCTBLOCKVersion == 2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623519618",
      "id" : 623519618,
      "line" : 2588,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzUxOTYxOA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 2588,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 33,
      "pull_request_review_id" : 648789506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623519618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623520004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623520004"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T01:05:10Z",
      "diff_hunk" : "@@ -490,11 +490,8 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n {\n     if (args.IsArgSet(\"-segwitheight\")) {\n         int64_t height = args.GetArg(\"-segwitheight\", consensus.SegwitHeight);\n-        if (height < -1 || height >= std::numeric_limits<int>::max()) {\n+        if (height < 0 || height >= std::numeric_limits<int>::max()) {\n             throw std::runtime_error(strprintf(\"Activation height %ld for segwit is out of valid range. Use -1 to disable segwit.\", height));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623520004",
      "id" : 623520004,
      "in_reply_to_id" : 623302697,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzUyMDAwNA==",
      "original_commit_id" : "117ae3f264ec6d3dd23e2e71a308d4df8e3d0702",
      "original_line" : 494,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : null,
      "pull_request_review_id" : 648789919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623520004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623661970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623661970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, the only permitted values for nCMPCTBLOCKVersion are `1` and `2`, which is why this conditional is here. We want to ignore any `sendcmpct` message received where nCMPCTBLOCKVersion is not 1 or 2.\r\n\r\n`if (0 < nCMPCTBLOCKVersion < 3)` does not do what you I think you expect it to do.",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T07:11:00Z",
      "diff_hunk" : "@@ -2586,7 +2585,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         bool fAnnounceUsingCMPCTBLOCK = false;\n         uint64_t nCMPCTBLOCKVersion = 0;\n         vRecv >> fAnnounceUsingCMPCTBLOCK >> nCMPCTBLOCKVersion;\n-        if (nCMPCTBLOCKVersion == 1 || ((pfrom.GetLocalServices() & NODE_WITNESS) && nCMPCTBLOCKVersion == 2)) {\n+        if (nCMPCTBLOCKVersion == 1 || nCMPCTBLOCKVersion == 2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623661970",
      "id" : 623661970,
      "in_reply_to_id" : 623519618,
      "line" : 2588,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY2MTk3MA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 2588,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 33,
      "pull_request_review_id" : 648941997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623661970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623672844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623672844"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This method override can be removed entirely, since it's doing the same as the default `setup_network()` in test_framework.py",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T07:28:26Z",
      "diff_hunk" : "@@ -224,7 +222,6 @@ def skip_test_if_missing_module(self):\n     def setup_network(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623672844",
      "id" : 623672844,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY3Mjg0NA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 222,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : null,
      "pull_request_review_id" : 648952878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623672844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623675320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623675320"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not needed. This is default behaviour.",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T07:32:54Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623675320",
      "id" : 623675320,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY3NTMyMA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 18,
      "original_position" : 20,
      "original_start_line" : 18,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 648952878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623675320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623675668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623675668"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to have a run_test() method that only calls one method. Just put the logic in `run_test()`.\r\n\r\n```suggestion\r\n    def run_test(self):\r\n        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"\r\n```",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T07:33:36Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.test_upgrade_after_activation()\n+\n+    def test_upgrade_after_activation(self):\n+        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623675668",
      "id" : 623675668,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY3NTY2OA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 20,
      "original_position" : 25,
      "original_start_line" : 21,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 648952878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623675668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623675932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623675932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not just start the node with `\"-segwitheight=10\"` first time, rather than starting and then restarting?",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T07:34:11Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.test_upgrade_after_activation()\n+\n+    def test_upgrade_after_activation(self):\n+        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"\n+\n+        self.log.info(\"Testing upgrade behaviour for pre-segwit node to segwit rules\")\n+        node = self.nodes[0]\n+\n+        # Node hasn't been used or connected yet\n+        assert_equal(node.getblockcount(), 0)\n+\n+        self.restart_node(0, extra_args=[\"-segwitheight=10\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623675932",
      "id" : 623675932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY3NTkzMg==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 648952878,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623675932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623894000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623894000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I'll leave the conditional in there then. Nice mental compiling! For others following along `if (0 < nCMPCTBLOCKVersion < 3)` ends up comparing a `bool` resulting from the first half of the expression to 3. Fortunately `clang++` issues a warning.\r\n```\r\nwarning: result of comparison of constant 3 with\r\n      expression of type 'bool' is always true\r\n      [-Wtautological-constant-out-of-range-compare]\r\n    if (0 < i < 3) {\r\n```",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T13:51:59Z",
      "diff_hunk" : "@@ -2586,7 +2585,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         bool fAnnounceUsingCMPCTBLOCK = false;\n         uint64_t nCMPCTBLOCKVersion = 0;\n         vRecv >> fAnnounceUsingCMPCTBLOCK >> nCMPCTBLOCKVersion;\n-        if (nCMPCTBLOCKVersion == 1 || ((pfrom.GetLocalServices() & NODE_WITNESS) && nCMPCTBLOCKVersion == 2)) {\n+        if (nCMPCTBLOCKVersion == 1 || nCMPCTBLOCKVersion == 2) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623894000",
      "id" : 623894000,
      "in_reply_to_id" : 623519618,
      "line" : 2588,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzg5NDAwMA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 2588,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 33,
      "pull_request_review_id" : 649237612,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623894000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623908286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623908286"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T14:11:28Z",
      "diff_hunk" : "@@ -224,7 +222,6 @@ def skip_test_if_missing_module(self):\n     def setup_network(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623908286",
      "id" : 623908286,
      "in_reply_to_id" : 623672844,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzkwODI4Ng==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 222,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : null,
      "pull_request_review_id" : 649256811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623908286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623908361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623908361"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T14:11:34Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623908361",
      "id" : 623908361,
      "in_reply_to_id" : 623675320,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzkwODM2MQ==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 18,
      "original_position" : 20,
      "original_start_line" : 18,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 649256922,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623908361",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623911977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623911977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I am not sure I understand. It seems we call `main()` which then calls `test_framework.py::run_test()`. I am not sure how I could remove this `run_test()` and put the logic in `test_framework.py::run_test()`? \r\n\r\nAlso, it seems `BitcoinTestFramework` [requires](https://github.com/bitcoin/bitcoin/blob/480bf01c295527bd212964efe4df3bb886db5654/test/functional/test_framework/test_framework.py#L69) overriding `run_test()`.",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T14:16:28Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.test_upgrade_after_activation()\n+\n+    def test_upgrade_after_activation(self):\n+        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623911977",
      "id" : 623911977,
      "in_reply_to_id" : 623675668,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzkxMTk3Nw==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 20,
      "original_position" : 25,
      "original_start_line" : 21,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 649261732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623911977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623912110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623912110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice! Done.",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T14:16:38Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.test_upgrade_after_activation()\n+\n+    def test_upgrade_after_activation(self):\n+        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"\n+\n+        self.log.info(\"Testing upgrade behaviour for pre-segwit node to segwit rules\")\n+        node = self.nodes[0]\n+\n+        # Node hasn't been used or connected yet\n+        assert_equal(node.getblockcount(), 0)\n+\n+        self.restart_node(0, extra_args=[\"-segwitheight=10\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623912110",
      "id" : 623912110,
      "in_reply_to_id" : 623675932,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzkxMjExMA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 649261901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623912110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Comments addressed. Ready for further review.",
      "created_at" : "2021-04-30T14:54:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-830151051",
      "id" : 830151051,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMDE1MTA1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-30T14:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/830151051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623944315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623944315"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Have you tried applying this diff?",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T14:58:53Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.test_upgrade_after_activation()\n+\n+    def test_upgrade_after_activation(self):\n+        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623944315",
      "id" : 623944315,
      "in_reply_to_id" : 623675668,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk0NDMxNQ==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 20,
      "original_position" : 25,
      "original_start_line" : 21,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 649305501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T15:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623944315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623982580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623982580"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right. My apologies for misreading the diff as just removing the `run_test()` function (which I did try manually). Updated. Thanks for your patience.",
      "commit_id" : "0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e",
      "created_at" : "2021-04-30T15:48:29Z",
      "diff_hunk" : "@@ -0,0 +1,58 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-2020 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test a pre-segwit node upgrading to segwit consensus\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    softfork_active,\n+)\n+\n+class SegwitUpgradeTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        self.test_upgrade_after_activation()\n+\n+    def test_upgrade_after_activation(self):\n+        \"\"\"A pre-segwit node with insufficiently validated blocks needs to redownload blocks\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r623982580",
      "id" : 623982580,
      "in_reply_to_id" : 623675668,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzk4MjU4MA==",
      "original_commit_id" : "f43a12789b70dc4fc8a4aa1067229d3476a6c29f",
      "original_line" : 20,
      "original_position" : 25,
      "original_start_line" : 21,
      "path" : "test/functional/feature_presegwit_node_upgrade.py",
      "position" : null,
      "pull_request_review_id" : 649354282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2021-04-30T15:48:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/623982580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 0dd10ccfd6ef13e5caa06fc380d6eb7f3a8fd22e\r\n\r\nLooks great. Thanks @dhruv!",
      "created_at" : "2021-05-03T08:04:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-831096059",
      "id" : 831096059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTA5NjA1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T08:04:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831096059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\n @sipa has been requested to review this pull request as specified in the REVIEWERS file.",
      "created_at" : "2021-05-03T09:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-831142763",
      "id" : 831142763,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgzMTE0Mjc2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-03T09:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831142763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r650584482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650584482"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "With the `segwitheight=-1` option removed, I think that also `IsScriptWitnessEnabled()` in `validation.cpp` has become obsolete and could be removed as well (the comment there also seems to say that it's only kept along for `p2p_segwit.py`).",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-06-13T22:14:34Z",
      "diff_hunk" : "@@ -490,11 +490,8 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n {\n     if (args.IsArgSet(\"-segwitheight\")) {\n         int64_t height = args.GetArg(\"-segwitheight\", consensus.SegwitHeight);\n-        if (height < -1 || height >= std::numeric_limits<int>::max()) {\n-            throw std::runtime_error(strprintf(\"Activation height %ld for segwit is out of valid range. Use -1 to disable segwit.\", height));\n-        } else if (height == -1) {\n-            LogPrintf(\"Segwit disabled for testing\\n\");\n-            height = std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r650584482",
      "id" : 650584482,
      "line" : 497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDU4NDQ4Mg==",
      "original_commit_id" : "a552c1ae3607cea3d22c49c6bed8bd619acc2ba7",
      "original_line" : 497,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 8,
      "pull_request_review_id" : 682449517,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T22:18:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650584482",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r650586262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650586262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There is another check for `consensusParams.SegwitHeight != std::numeric_limits<int>::max())` in `GenerateCoinbaseCommitment()`, also in validation.",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-06-13T22:32:58Z",
      "diff_hunk" : "@@ -490,11 +490,8 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n {\n     if (args.IsArgSet(\"-segwitheight\")) {\n         int64_t height = args.GetArg(\"-segwitheight\", consensus.SegwitHeight);\n-        if (height < -1 || height >= std::numeric_limits<int>::max()) {\n-            throw std::runtime_error(strprintf(\"Activation height %ld for segwit is out of valid range. Use -1 to disable segwit.\", height));\n-        } else if (height == -1) {\n-            LogPrintf(\"Segwit disabled for testing\\n\");\n-            height = std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r650586262",
      "id" : 650586262,
      "in_reply_to_id" : 650584482,
      "line" : 497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDU4NjI2Mg==",
      "original_commit_id" : "a552c1ae3607cea3d22c49c6bed8bd619acc2ba7",
      "original_line" : 497,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 8,
      "pull_request_review_id" : 682450586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-13T22:32:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650586262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r654972447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654972447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Great catches. Thank you, @mzumsande! Both comments addressed.",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-06-20T18:32:43Z",
      "diff_hunk" : "@@ -490,11 +490,8 @@ void CRegTestParams::UpdateActivationParametersFromArgs(const ArgsManager& args)\n {\n     if (args.IsArgSet(\"-segwitheight\")) {\n         int64_t height = args.GetArg(\"-segwitheight\", consensus.SegwitHeight);\n-        if (height < -1 || height >= std::numeric_limits<int>::max()) {\n-            throw std::runtime_error(strprintf(\"Activation height %ld for segwit is out of valid range. Use -1 to disable segwit.\", height));\n-        } else if (height == -1) {\n-            LogPrintf(\"Segwit disabled for testing\\n\");\n-            height = std::numeric_limits<int>::max();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r654972447",
      "id" : 654972447,
      "in_reply_to_id" : 650584482,
      "line" : 497,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NDk3MjQ0Nw==",
      "original_commit_id" : "a552c1ae3607cea3d22c49c6bed8bd619acc2ba7",
      "original_line" : 497,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/chainparams.cpp",
      "position" : 8,
      "pull_request_review_id" : 687930827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-06-20T18:32:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/654972447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed comments from @mzumsande. Ready for further review.",
      "created_at" : "2021-06-20T18:33:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-864594489",
      "id" : 864594489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NDU5NDQ4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-20T18:33:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864594489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK c44bac14b4",
      "created_at" : "2021-06-22T19:48:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-866284416",
      "id" : 866284416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg2NjI4NDQxNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-06-22T19:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866284416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-07-01T19:13:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-872488124",
      "id" : 872488124,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3MjQ4ODEyNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-01T19:13:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872488124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r662984447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662984447"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why is the test for default_witness_commitment removed?",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-07-02T12:43:08Z",
      "diff_hunk" : "@@ -550,37 +535,9 @@ def test_v0_outputs_arent_spendable(self):\n             # TODO: support multiple acceptable reject reasons.\n             test_witness_block(self.nodes[0], self.test_node, block, accepted=False, with_witness=False)\n \n-        self.connect_nodes(0, 2)\n-\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(txid, 2, value))\n \n-    @subtest  # type: ignore\n-    def test_getblocktemplate_before_lockin(self):\n-        txid = int(self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), 1), 16)\n-\n-        for node in [self.nodes[0], self.nodes[2]]:\n-            gbt_results = node.getblocktemplate({\"rules\": [\"segwit\"]})\n-            if node == self.nodes[2]:\n-                # If this is a non-segwit node, we should not get a witness\n-                # commitment.\n-                assert 'default_witness_commitment' not in gbt_results\n-            else:\n-                # For segwit-aware nodes, check the witness\n-                # commitment is correct.\n-                assert 'default_witness_commitment' in gbt_results\n-                witness_commitment = gbt_results['default_witness_commitment']\n-\n-                # Check that default_witness_commitment is present.\n-                witness_root = CBlock.get_merkle_root([ser_uint256(0),\n-                                                       ser_uint256(txid)])\n-                script = get_witness_script(witness_root, 0)\n-                assert_equal(witness_commitment, script.hex())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r662984447",
      "id" : 662984447,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk4NDQ0Nw==",
      "original_commit_id" : "c24ffdcbaf7b38a136566dc7e54d6cc3a80d373b",
      "original_line" : 578,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 96,
      "pull_request_review_id" : 698147566,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T12:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662984447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r662990109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662990109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Segwit is a buried deployment. There are no miners calling `getblocktemplate` before the segwit activation is locked in.",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-07-02T12:52:34Z",
      "diff_hunk" : "@@ -550,37 +535,9 @@ def test_v0_outputs_arent_spendable(self):\n             # TODO: support multiple acceptable reject reasons.\n             test_witness_block(self.nodes[0], self.test_node, block, accepted=False, with_witness=False)\n \n-        self.connect_nodes(0, 2)\n-\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(txid, 2, value))\n \n-    @subtest  # type: ignore\n-    def test_getblocktemplate_before_lockin(self):\n-        txid = int(self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), 1), 16)\n-\n-        for node in [self.nodes[0], self.nodes[2]]:\n-            gbt_results = node.getblocktemplate({\"rules\": [\"segwit\"]})\n-            if node == self.nodes[2]:\n-                # If this is a non-segwit node, we should not get a witness\n-                # commitment.\n-                assert 'default_witness_commitment' not in gbt_results\n-            else:\n-                # For segwit-aware nodes, check the witness\n-                # commitment is correct.\n-                assert 'default_witness_commitment' in gbt_results\n-                witness_commitment = gbt_results['default_witness_commitment']\n-\n-                # Check that default_witness_commitment is present.\n-                witness_root = CBlock.get_merkle_root([ser_uint256(0),\n-                                                       ser_uint256(txid)])\n-                script = get_witness_script(witness_root, 0)\n-                assert_equal(witness_commitment, script.hex())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r662990109",
      "id" : 662990109,
      "in_reply_to_id" : 662984447,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk5MDEwOQ==",
      "original_commit_id" : "c24ffdcbaf7b38a136566dc7e54d6cc3a80d373b",
      "original_line" : 578,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 96,
      "pull_request_review_id" : 698155292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T12:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662990109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r662995852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662995852"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The commitment is produced regardless of whether segwit locked in or not.",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-07-02T13:01:36Z",
      "diff_hunk" : "@@ -550,37 +535,9 @@ def test_v0_outputs_arent_spendable(self):\n             # TODO: support multiple acceptable reject reasons.\n             test_witness_block(self.nodes[0], self.test_node, block, accepted=False, with_witness=False)\n \n-        self.connect_nodes(0, 2)\n-\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(txid, 2, value))\n \n-    @subtest  # type: ignore\n-    def test_getblocktemplate_before_lockin(self):\n-        txid = int(self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), 1), 16)\n-\n-        for node in [self.nodes[0], self.nodes[2]]:\n-            gbt_results = node.getblocktemplate({\"rules\": [\"segwit\"]})\n-            if node == self.nodes[2]:\n-                # If this is a non-segwit node, we should not get a witness\n-                # commitment.\n-                assert 'default_witness_commitment' not in gbt_results\n-            else:\n-                # For segwit-aware nodes, check the witness\n-                # commitment is correct.\n-                assert 'default_witness_commitment' in gbt_results\n-                witness_commitment = gbt_results['default_witness_commitment']\n-\n-                # Check that default_witness_commitment is present.\n-                witness_root = CBlock.get_merkle_root([ser_uint256(0),\n-                                                       ser_uint256(txid)])\n-                script = get_witness_script(witness_root, 0)\n-                assert_equal(witness_commitment, script.hex())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r662995852",
      "id" : 662995852,
      "in_reply_to_id" : 662984447,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk5NTg1Mg==",
      "original_commit_id" : "c24ffdcbaf7b38a136566dc7e54d6cc3a80d373b",
      "original_line" : 578,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 96,
      "pull_request_review_id" : 698162954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-02T13:01:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662995852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r663766372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663766372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I see now that `default_witness_commitment` is not tested anywhere else. Perhaps it should be tested in mining_basic.py?",
      "commit_id" : "c44bac14b4de793ac1f12f7274ca495be0a3e875",
      "created_at" : "2021-07-05T09:07:28Z",
      "diff_hunk" : "@@ -550,37 +535,9 @@ def test_v0_outputs_arent_spendable(self):\n             # TODO: support multiple acceptable reject reasons.\n             test_witness_block(self.nodes[0], self.test_node, block, accepted=False, with_witness=False)\n \n-        self.connect_nodes(0, 2)\n-\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(txid, 2, value))\n \n-    @subtest  # type: ignore\n-    def test_getblocktemplate_before_lockin(self):\n-        txid = int(self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), 1), 16)\n-\n-        for node in [self.nodes[0], self.nodes[2]]:\n-            gbt_results = node.getblocktemplate({\"rules\": [\"segwit\"]})\n-            if node == self.nodes[2]:\n-                # If this is a non-segwit node, we should not get a witness\n-                # commitment.\n-                assert 'default_witness_commitment' not in gbt_results\n-            else:\n-                # For segwit-aware nodes, check the witness\n-                # commitment is correct.\n-                assert 'default_witness_commitment' in gbt_results\n-                witness_commitment = gbt_results['default_witness_commitment']\n-\n-                # Check that default_witness_commitment is present.\n-                witness_root = CBlock.get_merkle_root([ser_uint256(0),\n-                                                       ser_uint256(txid)])\n-                script = get_witness_script(witness_root, 0)\n-                assert_equal(witness_commitment, script.hex())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r663766372",
      "id" : 663766372,
      "in_reply_to_id" : 662984447,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzc2NjM3Mg==",
      "original_commit_id" : "c24ffdcbaf7b38a136566dc7e54d6cc3a80d373b",
      "original_line" : 578,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 96,
      "pull_request_review_id" : 698961314,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-05T09:07:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663766372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@dhruv - do you plan to rebase this?",
      "created_at" : "2021-07-06T07:40:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-874535099",
      "id" : 874535099,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDUzNTA5OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T07:40:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874535099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jnewbery I do. Been on break for a long weekend where I live. ",
      "created_at" : "2021-07-06T13:34:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-874765251",
      "id" : 874765251,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NDc2NTI1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-06T13:34:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874765251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2021-07-07T00:04:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-875163152",
      "id" : 875163152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NTE2MzE1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-07T00:04:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875163152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r665876449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665876449"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the catch, @MarcoFalke ! Test is now moved into mining_basic.py",
      "commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-08T05:18:11Z",
      "diff_hunk" : "@@ -550,37 +535,9 @@ def test_v0_outputs_arent_spendable(self):\n             # TODO: support multiple acceptable reject reasons.\n             test_witness_block(self.nodes[0], self.test_node, block, accepted=False, with_witness=False)\n \n-        self.connect_nodes(0, 2)\n-\n         self.utxo.pop(0)\n         self.utxo.append(UTXO(txid, 2, value))\n \n-    @subtest  # type: ignore\n-    def test_getblocktemplate_before_lockin(self):\n-        txid = int(self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), 1), 16)\n-\n-        for node in [self.nodes[0], self.nodes[2]]:\n-            gbt_results = node.getblocktemplate({\"rules\": [\"segwit\"]})\n-            if node == self.nodes[2]:\n-                # If this is a non-segwit node, we should not get a witness\n-                # commitment.\n-                assert 'default_witness_commitment' not in gbt_results\n-            else:\n-                # For segwit-aware nodes, check the witness\n-                # commitment is correct.\n-                assert 'default_witness_commitment' in gbt_results\n-                witness_commitment = gbt_results['default_witness_commitment']\n-\n-                # Check that default_witness_commitment is present.\n-                witness_root = CBlock.get_merkle_root([ser_uint256(0),\n-                                                       ser_uint256(txid)])\n-                script = get_witness_script(witness_root, 0)\n-                assert_equal(witness_commitment, script.hex())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r665876449",
      "id" : 665876449,
      "in_reply_to_id" : 662984447,
      "line" : 578,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTg3NjQ0OQ==",
      "original_commit_id" : "c24ffdcbaf7b38a136566dc7e54d6cc3a80d373b",
      "original_line" : 578,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "test/functional/p2p_segwit.py",
      "position" : 96,
      "pull_request_review_id" : 701647822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-08T05:18:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665876449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased. Addressed comments. Ready for further review.",
      "created_at" : "2021-07-08T05:18:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-876135029",
      "id" : 876135029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg3NjEzNTAyOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-08T05:18:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876135029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r665977709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665977709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is ok for now, but it'd be nice to rework this test so that it doesn't require a wallet.\r\n\r\nWe could also update the test to verify that the witness commitment commits to the wtxids of the transactions in the block rather than the txids. Currently the block being tested contains only the coinbase transaction and one transaction that spends from a P2PKH output, so the txid is the same as wtxid. It could be updated to include transactions that spend segwit outputs so that the txid and wtxid are different.",
      "commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-08T08:22:44Z",
      "diff_hunk" : "@@ -49,6 +51,9 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.supports_cli = False\n \n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r665977709",
      "id" : 665977709,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTk3NzcwOQ==",
      "original_commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "original_line" : 55,
      "original_position" : 21,
      "original_start_line" : 54,
      "path" : "test/functional/mining_basic.py",
      "position" : 21,
      "pull_request_review_id" : 701776960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : 54,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-08T08:53:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665977709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r666523282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666523282"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I can do those in a follow-up PR. Can you tell me more about how I could remove the wallet dependency? My understanding is that to have `getblocktemplate` include a transaction that the witness root commits to, I need a valid transaction in the mempool, and to create that valid tx, I need a wallet. I feel like I am missing something about the test framework perhaps?",
      "commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-08T21:15:22Z",
      "diff_hunk" : "@@ -49,6 +51,9 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.supports_cli = False\n \n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r666523282",
      "id" : 666523282,
      "in_reply_to_id" : 665977709,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjUyMzI4Mg==",
      "original_commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "original_line" : 55,
      "original_position" : 21,
      "original_start_line" : 54,
      "path" : "test/functional/mining_basic.py",
      "position" : 21,
      "pull_request_review_id" : 702506742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : 54,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-08T21:15:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666523282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/856960?v=4",
         "events_url" : "https://api.github.com/users/dhruv/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dhruv/followers",
         "following_url" : "https://api.github.com/users/dhruv/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dhruv/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dhruv",
         "id" : 856960,
         "login" : "dhruv",
         "node_id" : "MDQ6VXNlcjg1Njk2MA==",
         "organizations_url" : "https://api.github.com/users/dhruv/orgs",
         "received_events_url" : "https://api.github.com/users/dhruv/received_events",
         "repos_url" : "https://api.github.com/users/dhruv/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dhruv/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dhruv"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r666592597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666592597"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@dhruv: Luckily we have a minimalistic wallet implementation for the functional test framework (first introduced by MarcoFalke last year, see #19800). Look for modules importing `MiniWallet` for example usage, see also issue #20078. Also, feel free to tag me in your follow-up PR, will be happy to review.",
      "commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-09T00:17:38Z",
      "diff_hunk" : "@@ -49,6 +51,9 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.supports_cli = False\n \n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r666592597",
      "id" : 666592597,
      "in_reply_to_id" : 665977709,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjU5MjU5Nw==",
      "original_commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "original_line" : 55,
      "original_position" : 21,
      "original_start_line" : 54,
      "path" : "test/functional/mining_basic.py",
      "position" : 21,
      "pull_request_review_id" : 702590827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : 54,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-09T00:17:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666592597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code-Review ACK a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-17T20:41:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-881957339",
      "id" : 881957339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "IC_kwDOABII5840kZnb",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-17T20:41:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881957339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK a806647d260132a00cd633160040625c7dd17803, nice cleanup",
      "created_at" : "2021-07-22T15:36:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#issuecomment-885010966",
      "id" : 885010966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21090",
      "node_id" : "IC_kwDOABII5840wDIW",
      "performed_via_github_app" : null,
      "updated_at" : "2021-07-22T15:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/885010966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r675101211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675101211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Python will throw key-error, so you don't need the \"# Check that default_witness_commitment is present.\" section.\r\n\r\nSee:\r\n\r\n```\r\n>>> {'b':1}['a']\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nKeyError: 'a'\r\n```\r\n\r\nSuggestion:\r\n\r\n```py\r\n         assert_equal(tmpl['default_witness_commitment'], script.hex())",
      "commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-22T19:24:04Z",
      "diff_hunk" : "@@ -89,7 +94,21 @@ def assert_submitblock(block, result_str_1, result_str_2=None):\n         assert_equal(mining_info['networkhashps'], Decimal('0.003333333333333334'))\n         assert_equal(mining_info['pooledtx'], 0)\n \n-        # Mine a block to leave initial block download\n+        self.log.info(\"getblocktemplate: Test default witness commitment\")\n+        txid = int(node.sendtoaddress(node.getnewaddress(), 1), 16)\n+        tmpl = node.getblocktemplate(NORMAL_GBT_REQUEST_PARAMS)\n+\n+        # Check that default_witness_commitment is present.\n+        assert 'default_witness_commitment' in tmpl\n+        witness_commitment = tmpl['default_witness_commitment']\n+\n+        # Check that default_witness_commitment is correct.\n+        witness_root = CBlock.get_merkle_root([ser_uint256(0),\n+                                               ser_uint256(txid)])\n+        script = get_witness_script(witness_root, 0)\n+        assert_equal(witness_commitment, script.hex())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r675101211",
      "id" : 675101211,
      "line" : 109,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTEwMTIxMQ==",
      "original_commit_id" : "eba5b1cd6460c98e75d0422bd394e12af7f11e4c",
      "original_line" : 109,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "test/functional/mining_basic.py",
      "position" : 43,
      "pull_request_review_id" : 713156421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-07-22T19:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675101211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r675101560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675101560"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree",
      "commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "created_at" : "2021-07-22T19:24:38Z",
      "diff_hunk" : "@@ -49,6 +51,9 @@ def set_test_params(self):\n         self.setup_clean_chain = True\n         self.supports_cli = False\n \n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21090#discussion_r675101560",
      "id" : 675101560,
      "in_reply_to_id" : 665977709,
      "line" : 55,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3NTEwMTU2MA==",
      "original_commit_id" : "a806647d260132a00cd633160040625c7dd17803",
      "original_line" : 55,
      "original_position" : 21,
      "original_start_line" : 54,
      "path" : "test/functional/mining_basic.py",
      "position" : 21,
      "pull_request_review_id" : 713156421,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21090",
      "side" : "RIGHT",
      "start_line" : 54,
      "start_side" : "RIGHT",
      "updated_at" : "2021-07-22T19:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/675101560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
