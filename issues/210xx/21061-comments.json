[
   {
      "author_association" : "MEMBER",
      "body" : "## Merge Plan & Next Steps:\r\nAll of the functionality in this PR is hidden behind a configuration switch that defaults to off, and the wallet rebroadcast logic is currently untouched. The idea is to make these changes as safe as possible to merge into master, and allow reviewers to easily enable and observe the new rebroadcast mechanism in todayâs network conditions. \r\n\r\nIf we build confidence that these changes are safe and desirable, we can default enable this new node rebroadcast logic and disable the legacy wallet rebroadcast logic. This is the desired end goal. \r\n\r\n## Project History: \r\nA version of these changes were originally proposed in #16698. \r\n\r\n#18038 broke out a subset of the functionality, enabling the node to provide a guarantee around minimal initial broadcast & reducing the frequency of the existing wallet rebroadcast functionality (unbroadcast set) \r\n\r\nSince #16698, there have been some changes in approach, and all of the unbroadcast conversation is no longer relevant. So, to help with review, I've decided to open a new PR. To preserve the relevant feedback and concerns, I've tried my best to capture the history of conversations in the following write-up: https://github.com/amitiuttarwar/bitcoin-notes/blob/main/rebroadcast-history.md. warning: it goes quite in depth.\r\n\r\n\r\nðð½ Huge shout out to the village of core contributors who have provided feedback & guidance on this project so far. Honestly too many to name, but this project is much better for it. Thank you :) \r\n",
      "created_at" : "2021-02-02T07:23:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-771426879",
      "id" : 771426879,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTQyNjg3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-08T17:50:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771426879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20925 (RFC: Move Peer and PeerManagerImpl declarations to separate header by jnewbery)\n* #20892 (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n* #20158 (tree-wide: De-globalize ChainstateManager by dongcarl)\n* #19806 (validation: UTXO snapshot activation by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2021-02-02T08:05:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-771448221",
      "id" : 771448221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MTQ0ODIyMQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T01:47:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/771448221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "marking as draft until I resolve CI issues",
      "created_at" : "2021-02-03T03:32:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-772195305",
      "id" : 772195305,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3MjE5NTMwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-03T03:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/772195305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r572243729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572243729"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm importing this file so I can use the default key extractors in the `indexed_rebroadcast_set` multi_index: 1. https://github.com/bitcoin/bitcoin/pull/21061/files#diff-eccf6b88ae8b612dbdbdb92c110b66e4e7e3ffa665ccdc1acf08093aadc66b82R49 2. https://github.com/bitcoin/bitcoin/pull/21061/files#diff-eccf6b88ae8b612dbdbdb92c110b66e4e7e3ffa665ccdc1acf08093aadc66b82R55\r\n\r\nThe contents of the boost header file can be found [here](https://www.boost.org/doc/libs/1_71_0/boost/multi_index/member.hpp).\r\n\r\nIf we'd rather not import another boost header, I can avoid by writing custom key extractors.",
      "commit_id" : "47060cff449da91a6c82405a934562f160da1cf7",
      "created_at" : "2021-02-08T17:44:59Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ EXPECTED_BOOST_INCLUDES=(\n     boost/filesystem.hpp\n     boost/filesystem/fstream.hpp\n     boost/multi_index/hashed_index.hpp\n+    boost/multi_index/member.hpp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r572243729",
      "id" : 572243729,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI0MzcyOQ==",
      "original_commit_id" : "3766479d7924358f9c3b0d53fca1ca2e218e66fb",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/lint/lint-includes.sh",
      "position" : 4,
      "pull_request_review_id" : 585760946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-09T22:39:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/572243729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased master, added a functional test, some small fixups. \r\n\r\nthis PR is ready for review! ð",
      "created_at" : "2021-02-10T02:44:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#issuecomment-776398956",
      "id" : 776398956,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/21061",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NjM5ODk1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-10T02:44:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/776398956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r574281895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574281895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's fine to add a boost multi_index header dependency, it's the only submodule of boost that we really need and for which there is no replacement on the horizon. So just use what you need IMO, re-implementing anything from multi-index without a good plan would be a waste of time, I think. ",
      "commit_id" : "47060cff449da91a6c82405a934562f160da1cf7",
      "created_at" : "2021-02-11T06:58:44Z",
      "diff_hunk" : "@@ -57,6 +57,7 @@ EXPECTED_BOOST_INCLUDES=(\n     boost/filesystem.hpp\n     boost/filesystem/fstream.hpp\n     boost/multi_index/hashed_index.hpp\n+    boost/multi_index/member.hpp",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/21061#discussion_r574281895",
      "id" : 574281895,
      "in_reply_to_id" : 572243729,
      "line" : 60,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDI4MTg5NQ==",
      "original_commit_id" : "3766479d7924358f9c3b0d53fca1ca2e218e66fb",
      "original_line" : 60,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/lint/lint-includes.sh",
      "position" : 4,
      "pull_request_review_id" : 588280404,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/21061",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-11T06:59:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/574281895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
