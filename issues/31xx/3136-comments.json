[
   {
      "body" : "I can't reproduce this (on linux). I've had a problem with my testnet wallet so needed to rebuild a few times yesterday. When I clicked \"abort\" there was no crash.\r\nI'm not using -txindex though.\r\n",
      "created_at" : "2013-10-28T07:07:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-27192563",
      "id" : 27192563,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2013-10-28T07:07:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/27192563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Perhaps you can give it a try with -txindex then?",
      "created_at" : "2013-10-28T07:15:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-27192815",
      "id" : 27192815,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2013-10-28T07:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/27192815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "I tried to debug this, but failed badly... I get a segfault related to ``path.hpp``, which is from Boost filesystem. This happens after ``2013-11-14 20:09:45 Shutdown : done``. I just see that the object contains the correct path to my testnet3 datadir and is unrelated to our datadir caching (as I disabled it for testing purposes).\r\n\r\nPerhaps there is some global that get's destructed after everything is already shutdown, dunno yet...\r\n\r\n@laanwj Any idea how I can nail this down further?\r\n\r\nEdit: I'm going to try Boost 1.55.0 tomorrow and see if that helps ;).",
      "created_at" : "2013-11-14T20:21:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-28519132",
      "id" : 28519132,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2013-11-14T20:23:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/28519132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "Yes that's probably an destruction order problem, do you get a traceback?\r\n\r\nOtherwise I don't know a good way to debug it except for selectively commenting out code.",
      "created_at" : "2013-11-15T11:33:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-28563109",
      "id" : 28563109,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2013-11-15T11:33:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/28563109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I wonder if this also happens with gitian builds.\r\n",
      "created_at" : "2014-01-17T12:23:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-32601458",
      "id" : 32601458,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2014-01-17T12:23:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/32601458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Does this still happen with current master?\r\n",
      "created_at" : "2014-05-02T07:46:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-41999734",
      "id" : 41999734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2014-05-02T07:46:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/41999734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Tested a minute ago, yes still happens with 0.9.1.\r\n\r\n<pre>\r\n  Problemereignisname:\tBEX64\r\n  Anwendungsname:\tbitcoin-qt.exe\r\n  Anwendungsversion:\t0.9.1.0\r\n  Anwendungszeitstempel:\t51a93980\r\n  Fehlermodulname:\tStackHash_e7de\r\n  Fehlermodulversion:\t0.0.0.0\r\n  Fehlermodulzeitstempel:\t00000000\r\n  Ausnahmeoffset:\tPCH_AE_FROM_ntdll+0x000000000009B13A\r\n  Ausnahmecode:\tc0000005\r\n  Ausnahmedaten:\t0000000000000008\r\n</pre>",
      "created_at" : "2014-05-02T07:53:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-42000097",
      "id" : 42000097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2014-05-02T07:53:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/42000097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "I found out that this code in path.hpp causes the segfault:\r\n<pre>\r\n#   ifdef BOOST_WINDOWS_API\r\n    const std::string string() const { return string(codecvt()); } \r\n</pre>\r\n\r\nThis line causes it:\r\n``DbEnv(0).remove(path.string().c_str(), 0);``\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/db.cpp#L49\r\n\r\nI was able to prevent the crash by not using a boost::path there, but add a std::string to the class, init that with ``path.string()`` at the beginning and use that in the above call.\r\n\r\n@laanwj Any idea for this? A use-after-free or something like that?\r\n",
      "created_at" : "2014-09-10T10:26:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-55097256",
      "id" : 55097256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2014-09-10T10:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/55097256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1419649?v=3",
         "events_url" : "https://api.github.com/users/Diapolo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Diapolo/followers",
         "following_url" : "https://api.github.com/users/Diapolo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Diapolo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Diapolo",
         "id" : 1419649,
         "login" : "Diapolo",
         "organizations_url" : "https://api.github.com/users/Diapolo/orgs",
         "received_events_url" : "https://api.github.com/users/Diapolo/received_events",
         "repos_url" : "https://api.github.com/users/Diapolo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Diapolo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Diapolo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Diapolo"
      }
   },
   {
      "body" : "This is yet another shutdown order issue.\r\n\r\nCDbEnv ideally shouldn't be a global object that has the lifetime of the program. I remember this \r\nalso came up for testing by @SergioDemianLerner #4688.\r\n",
      "created_at" : "2014-09-10T11:58:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-55104975",
      "id" : 55104975,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2014-09-10T11:58:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/55104975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I tested this on Windows 8.1 x64 and Windows 10 TP with the 0.9, 0.10 releases, as well as the master branch (build via Gitian route).\r\n\r\nTo reproduce:\r\n\r\n1. Start `bitcoin-qt.exe`, pointing to a new datadir (`-datadir=xxx`, `-choosedatadir`)\r\n2. Shutdown the client\r\n3. Start `bitcoin-qt.exe -txindex=1`\r\n4. Decline to rebuild index\r\n5. Crash\r\n\r\nA similar event can be triggered and observed, when executing `bitcoind.exe` without `rpcuser` and `rpcpassword` defined, which also results in an application crash.\r\n\r\nFWIW, I uploaded the crash report, including error dump files: http://bitwatch.co/uploads/AppCrash_bitcoin-qt_w10x64.zip (1.414 KB)\r\n\r\nRunning `Process Monitor` hints a buffer overflow during the shutdown:\r\n\r\n![bufferoverflow](https://cloud.githubusercontent.com/assets/5836089/6568061/dff6402e-c6d1-11e4-9ccf-43a1c2dced41.png)\r\n\r\nThis error does not occure, when using `-disablewallet` or a wallet-less build.",
      "created_at" : "2015-03-10T20:52:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-78145653",
      "id" : 78145653,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2015-03-10T20:56:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/78145653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "body" : "As follow up: it's a memory access violation and I sort-of debugged it on an assembler level, where I saw that the crash occured when jumping to `0xFEEEFEEE + x`, which indicates previously [freed memory](https://www.google.de/search?q=0xFEEEFEEE) on Windows.\r\n\r\nThe hint about `const std::string string() const { return string(codecvt()); }` was golden, as this indeed pointed to root cause. [Boost path](https://github.com/boostorg/filesystem/blob/boost-1.55.0/src/path.cpp) uses a static initialized pointer internally, which appears to be deinitialized during shutdown, but if this is not done by the main thread, the pointer appears to be already deinitialized, even though there is still an attempted access later. An appearingly working solution was to force the initialization by the main thread.",
      "created_at" : "2015-03-21T11:42:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-84321884",
      "id" : 84321884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2015-03-21T11:42:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/84321884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "body" : "Tested with #5877 on top of current master (https://builds.jonasschnelli.ch/pulls/5877/) on Windows 7. Crash no longer happens.\r\nTestes also current master on same Window 7 instance and could reproduce the reindex->abort crash.",
      "created_at" : "2015-03-21T14:51:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-84363320",
      "id" : 84363320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2015-03-21T14:51:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/84363320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Thanks a lot for testing @jonaschnelli! Closing this.",
      "created_at" : "2015-03-24T07:32:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/3136#issuecomment-85375999",
      "id" : 85375999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3136",
      "updated_at" : "2015-03-24T07:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/85375999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
