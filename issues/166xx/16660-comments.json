[
   {
      "author_association" : "MEMBER",
      "body" : "Closing as duplicate of #14210",
      "created_at" : "2019-08-21T14:54:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16660#issuecomment-523493818",
      "id" : 523493818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16660",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzQ5MzgxOA==",
      "updated_at" : "2019-08-21T14:54:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523493818",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke \r\n\r\nDo you know if we have any tests for the eviction logic? Perhaps my measurements are incorrect.\r\n\r\nAFAICT the eviction logic is by far the most critical code path not covered at all by any test. I mean \"at all\" in the most literal sense: the code path it isn't even entered (if my measurements are correct) when running the full test suite :-)\r\n\r\nI'm not super convinced that this very specific observation/issue is a duplicate of the general observation/issue \"we could do better network testing in general\" (#14210). Fixing the former can be done quickly - fixing the latter will take quite some time. Don't you think? :-)",
      "created_at" : "2019-08-21T15:21:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16660#issuecomment-523506098",
      "id" : 523506098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16660",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzUwNjA5OA==",
      "updated_at" : "2019-08-21T15:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523506098",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixing #14210 is a requirement for fixing this issue. This issue is also mentioned as motivating example in #14210.",
      "created_at" : "2019-08-21T16:00:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16660#issuecomment-523525145",
      "id" : 523525145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16660",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzUyNTE0NQ==",
      "updated_at" : "2019-08-21T16:00:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523525145",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I can see the dependency on #14210 for functional testing, but unit tests could easily be written to cover these functions AFAICT:\r\n\r\n```\r\nstatic bool ReverseCompareNodeMinPingTime(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\r\nstatic bool ReverseCompareNodeTimeConnected(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\r\nstatic bool CompareNetGroupKeyed(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\r\nstatic bool CompareNodeBlockTime(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\r\nstatic bool CompareNodeTXTime(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\r\nstatic void EraseLastKElements(std::vector<T>& elements, Comparator comparator, size_t k)\r\n```\r\n\r\nThat would be good even if #14210 takes time to resolve :-)",
      "created_at" : "2019-08-21T16:15:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16660#issuecomment-523531532",
      "id" : 523531532,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16660",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzUzMTUzMg==",
      "updated_at" : "2019-08-21T16:16:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523531532",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that parts of the eviction logic could be tested in a functional test also prior to #14210 being solved.\r\n\r\nThe eviction logic applies to inbound peers and ignores outbound peers - we can simulate inbound connections with `P2PInterface`, and don't need outbound peers to actually exist.\r\n\r\nI don't see how the logic based on address/netgroup could be tested, but other parts can.\r\nThere is a draft version of a functional test that partially covers the logic of  `CConnman::AttemptToEvictConnection`  in mzumsande@56d38d05c922ec37cae7ca957ad230a1dfbc4e96\r\n\r\nI intend to open a PR based on this in the next days, but for that PR I will also add a commit with unit tests (unless @practicalswift you are working on that?).",
      "created_at" : "2019-08-23T01:06:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16660#issuecomment-524133411",
      "id" : 524133411,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16660",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDEzMzQxMQ==",
      "updated_at" : "2019-08-23T01:07:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/524133411",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@mzumsande Oh, that's excellent news! Very glad to hear that you're working on this! Thanks!\r\n\r\n> [â¦] (unless @practicalswift you are working on that?).\r\n\r\nNo, I'm just sharing my observation: I was quite surprised to see that the code eviction code path wasn't exercised at all when running the full test suite given how important it is that we get this logic correct. An error in this code could lead to attacker triggered network partitioning.\r\n\r\n@MarcoFalke Would you mind re-opening this ticket?",
      "created_at" : "2019-08-23T04:36:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/16660#issuecomment-524169151",
      "id" : 524169151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16660",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNDE2OTE1MQ==",
      "updated_at" : "2019-08-23T04:36:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/524169151",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   }
]
