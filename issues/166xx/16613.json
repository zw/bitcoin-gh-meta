{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "After applying #15363, when I run the functional test suite on a 3 GB RAM disk with `--jobs=100 --cachedir=/Volumes/RAMDisk/cache --tmpdir=/Volumes/RAMDisk/tmp`:\r\n\r\n* CPU usage hovers between 50 and 80% for the first 45 seconds and then drops.\r\n* RAM usage peaks at about 12 GB in the same time period and then drops.\r\n* test suite takes about 120 seconds\r\n\r\nThe above suggests that the total run time is determined by a handful of slow running tests:\r\n\r\n* wallet_backup.py: 120s \r\n* feature_block.py: 115s\r\n* wallet_address_types.py: 102s\r\n* feature_maxuploadtarget.py: 85s\r\n* p2p_segwit.py: 83s\r\n* p2p_tx_download.py: 84s\r\n* mining_getblocktemplate_longpoll.py: 70s\r\n* feature_fee_estimation.py: 68s\r\n\r\nGetting the above tests to run in under 60 seconds should therefore cut total run time in half for me. Whether this benefits slower systems depends on the reason for the bottleneck.\r\n\r\nA bit more detail about the slow running tests:\r\n\r\n## wallet_backup.py\r\n\r\n\"Creating transactions\" takes almost a minute. Backup is nearly instant. \"More transactions\" takes another 50 seconds. The various restores take 22 seconds in total.\r\n\r\nThe test could be made faster by:\r\n1. generating fewer transactions\r\n2. put pre-generated the wallets, use extended test suite to verify their contents. However, it's useful to check that the backup feature actually works for a freshly generated wallet.\r\n3. figuring out why 30 transactions are so slow. I tried setting `wait=0.1` for both sync_mempool and sync_blocks but that didn't help.\r\n\r\n##  feature_block.py\r\n\r\nWhen running this test individually it took only 25 seconds (in contrast to the wallet_backup where running individually didn't make much difference). The slowest checks are `Reject a block with too many P2SH sigops` (7s)\r\n\r\nThis test could be split (in two). This requires moving some helper code into the test framework, as well as studying the sequence of checks for inter-dependencies.\r\n\r\n## wallet_address_types.py\r\n\r\nRuns in 58 seconds individually.\r\n\r\nThis test seems trivial to split. But like `wallet_backup.py` it may be worth investigating why a just a few dozen transactions take so long.\r\n\r\n## feature_maxuploadtarget.py\r\n\r\nRuns in 1 minute individually, could perhaps be split in two.\r\n\r\n## p2p_segwit.py\r\n\r\nTODO\r\n\r\n## p2p_tx_download.py\r\n\r\nTODO\r\n\r\n## mining_getblocktemplate_longpoll.py\r\n\r\nTODO\r\n\r\n## feature_fee_estimation.py\r\n\r\nTODO",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16613/comments",
   "created_at" : "2019-08-14T14:47:58Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16613/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/16613",
   "id" : 480723357,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16613/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0ODA3MjMzNTc=",
   "number" : 16613,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Functional test suite bottlenecks",
   "updated_at" : "2019-08-14T14:47:58Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16613",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
      "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Sjors/followers",
      "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Sjors",
      "id" : 10217,
      "login" : "Sjors",
      "node_id" : "MDQ6VXNlcjEwMjE3",
      "organizations_url" : "https://api.github.com/users/Sjors/orgs",
      "received_events_url" : "https://api.github.com/users/Sjors/received_events",
      "repos_url" : "https://api.github.com/users/Sjors/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Sjors"
   }
}
