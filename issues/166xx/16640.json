{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "I don't know how reproducible this is, e.g. it doesn't happen when I run the same test on macOS.\r\n\r\nOne of the Travis builds for backwards compatibility testing #12134 failed ([log](https://travis-ci.org/bitcoin/bitcoin/jobs/573102685#L7596)). And failed [again](https://travis-ci.org/bitcoin/bitcoin/jobs/573123077#L7612).\r\n\r\nThis happens in w3 in v0.18.1 in the following [test](https://github.com/bitcoin/bitcoin/commit/6e1ed787c7baf269f3ee1909cca29ba17298aa03#diff-78dddeb5de6d2a866997abb8f8055455R133-R139).\r\n\r\n```python\r\n# w3: blank wallet, created on master: update this\r\n#     test when default blank wallets can no longer be opened by older versions.\r\nnode_master.createwallet(wallet_name=\"w3\", blank=True)\r\n...\r\nnode_v18.loadwallet(\"w3\")\r\n```\r\n\r\n`node_master` refers to commit 1124be6111d6ef0f0324bccd0642b17b86bcd213, node_v18 is a binary v0.18.1.\r\n\r\nIt fails as follows:\r\n \r\n```\r\nnode2 2019-08-17T13:16:11.352727Z Using wallet /tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3 \r\n7406 node2 2019-08-17T13:16:11.352777Z BerkeleyEnvironment::Open: LogDir=/tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3/database ErrorFile=/tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3/db.log \r\n7914 node2 2019-08-17T13:16:11.356992Z BerkeleyEnvironment::Open: Error -30974 opening database environment: DB_RUNRECOVERY: Fatal error, run database recovery \r\n7915 node2 2019-08-17T13:16:11.357051Z Moved old /tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3/database to /tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3/database.1566047771.bak. Retrying. \r\n7916 node2 2019-08-17T13:16:11.357124Z BerkeleyEnvironment::Open: LogDir=/tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3/database ErrorFile=/tmp/test_runner_â¿_ð_20190817_130647/feature_backwards_compatibility_53/node2/regtest/wallets/w3/db.log \r\n7917 node2 2019-08-17T13:16:11.438198Z Renamed wallet.dat to wallet.dat.1566047771.bak \r\n7918 node2 2019-08-17T13:16:11.438366Z BerkeleyEnvironment::Salvage: Database salvage found errors, all data may not be recoverable. \r\n7919 node2 2019-08-17T13:16:11.438376Z BerkeleyEnvironment::Salvage: WARNING: Unexpected end of file while reading salvage output. \r\n7920 node2 2019-08-17T13:16:11.438384Z Salvage(aggressive) found no records in wallet.dat.1566047771.bak. \r\n7921 test  2019-08-17T13:16:11.460000Z TestFramework (ERROR): JSONRPC error \r\n...\r\n7657                                   test_framework.authproxy.JSONRPCException: Wallet file verification failed: wallet.dat corrupt, salvage failed (-4)\r\n```",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16640/comments",
   "created_at" : "2019-08-17T13:51:23Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16640/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/16640",
   "id" : 481888565,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16640/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "MDU6SXNzdWU0ODE4ODg1NjU=",
   "number" : 16640,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "[wallet] data corruption opening blank regtest wallet in v0.18.1",
   "updated_at" : "2019-08-17T14:40:09Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16640",
   "user" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
      "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Sjors/followers",
      "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Sjors",
      "id" : 10217,
      "login" : "Sjors",
      "node_id" : "MDQ6VXNlcjEwMjE3",
      "organizations_url" : "https://api.github.com/users/Sjors/orgs",
      "received_events_url" : "https://api.github.com/users/Sjors/received_events",
      "repos_url" : "https://api.github.com/users/Sjors/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Sjors"
   }
}
