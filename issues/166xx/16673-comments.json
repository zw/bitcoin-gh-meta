[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16804](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16804.html) (test: Remove unused try-block in assert_debug_log by MarcoFalke)\n* [#16702](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16702.html) (p2p: supplying and using asmap to improve IP bucketing in addrman by naumenkogs)\n* [#16115](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16115.html) (On bitcoind startup, write config args to debug.log by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-08-21T03:01:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16673#issuecomment-523275433",
      "id" : 523275433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16673",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzI3NTQzMw==",
      "updated_at" : "2019-09-05T02:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523275433",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-21T13:23:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16673#issuecomment-523454836",
      "id" : 523454836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16673",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMzQ1NDgzNg==",
      "updated_at" : "2019-08-21T13:23:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/523454836",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16673#discussion_r317415261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16673"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/317415261"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do you really want `unexpected_msgs` to preserve parameter state between calls? :-)\r\n\r\n```\r\n>>> def foobar(foo, bar=[]):\r\n...     bar.append(foo)\r\n...     print(bar)\r\n...\r\n>>> foobar(\"hello\")\r\n['hello']\r\n>>> foobar(\"hello\")\r\n['hello', 'hello']\r\n>>> foobar(\"hello\")\r\n['hello', 'hello', 'hello']\r\n```\r\n\r\nI think this is what you want:\r\n\r\n```\r\ndef assert_debug_log(self, expected_msgs, unexpected_msgs, timeout=2):\r\n    if unexpected_msgs is None:\r\n        unexpected_msgs = []\r\n```\r\n\r\nFWIW I think we should use a linter to guard against this Python gotcha :-)",
      "commit_id" : "5b413fddc3cf07f20e46ae3d2f462f2bbea14ace",
      "created_at" : "2019-08-25T21:18:07Z",
      "diff_hunk" : "@@ -307,7 +307,7 @@ def wait_until_stopped(self, timeout=BITCOIND_PROC_WAIT_TIMEOUT):\n         wait_until(self.is_node_stopped, timeout=timeout)\n \n     @contextlib.contextmanager\n-    def assert_debug_log(self, expected_msgs, timeout=2):\n+    def assert_debug_log(self, expected_msgs, unexpected_msgs=[], timeout=2):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16673#discussion_r317415261",
      "id" : 317415261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNzQxNTI2MQ==",
      "original_commit_id" : "d252dfe814044450ee8af029f5b26b812f56e053",
      "original_position" : 5,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 279353607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16673",
      "updated_at" : "2019-08-26T03:45:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/317415261",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16673#discussion_r317442421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16673"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/317442421"
         }
      },
      "author_association" : "NONE",
      "body" : "Great catch, I had no idea! I fixed this in #16115 (where it was introduced) and force-pushed rebased this PR onto that branch.",
      "commit_id" : "5b413fddc3cf07f20e46ae3d2f462f2bbea14ace",
      "created_at" : "2019-08-26T03:48:02Z",
      "diff_hunk" : "@@ -307,7 +307,7 @@ def wait_until_stopped(self, timeout=BITCOIND_PROC_WAIT_TIMEOUT):\n         wait_until(self.is_node_stopped, timeout=timeout)\n \n     @contextlib.contextmanager\n-    def assert_debug_log(self, expected_msgs, timeout=2):\n+    def assert_debug_log(self, expected_msgs, unexpected_msgs=[], timeout=2):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16673#discussion_r317442421",
      "id" : 317442421,
      "in_reply_to_id" : 317415261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNzQ0MjQyMQ==",
      "original_commit_id" : "d252dfe814044450ee8af029f5b26b812f56e053",
      "original_position" : 5,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 279388220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16673",
      "updated_at" : "2019-08-26T03:48:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/317442421",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16673#discussion_r319257343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16673"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319257343"
         }
      },
      "author_association" : "NONE",
      "body" : "@practicalswift, I don't think this was an actual problem. I added a debug print and `unexpected_msgs` didn't include previous values. I think it's not broken because this function, `assert_debug_log()`, doesn't modify the variable (it's not mutable). Here's an extremely simplified version of this function and some sample calls to it:\r\n```\r\ndef assert_debug_log(unexpected_msgs=[]):\r\n    print(unexpected_msgs)\r\n    for unexpected_msg in unexpected_msgs:\r\n        print('  ', unexpected_msg)\r\n\r\nassert_debug_log()\r\nassert_debug_log([\"foo\"])\r\nassert_debug_log(unexpected_msgs=[\"foo\"])\r\nassert_debug_log(\"bar\") # not actually called this way but just curious\r\nassert_debug_log()\r\n```\r\nThe output:\r\n```\r\n[]\r\n['foo']\r\n   foo\r\n['foo']\r\n   foo\r\nbar\r\n   b\r\n   a\r\n   r\r\n[]\r\n```\r\nWhat prompted me to investigate this further is that I wondered if any of our existing python code has this problem. I found just one instance, which is in `wallet_importmulti.py`:\r\n```\r\ndef test_importmulti(self, req, success, error_code=None, error_message=None, warnings=[]):\r\n```\r\nBut adding a debug print to that function showed everything was okay. I believe that's because `warnings` isn't modified in that function.",
      "commit_id" : "5b413fddc3cf07f20e46ae3d2f462f2bbea14ace",
      "created_at" : "2019-08-29T20:27:43Z",
      "diff_hunk" : "@@ -307,7 +307,7 @@ def wait_until_stopped(self, timeout=BITCOIND_PROC_WAIT_TIMEOUT):\n         wait_until(self.is_node_stopped, timeout=timeout)\n \n     @contextlib.contextmanager\n-    def assert_debug_log(self, expected_msgs, timeout=2):\n+    def assert_debug_log(self, expected_msgs, unexpected_msgs=[], timeout=2):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16673#discussion_r319257343",
      "id" : 319257343,
      "in_reply_to_id" : 317415261,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxOTI1NzM0Mw==",
      "original_commit_id" : "d252dfe814044450ee8af029f5b26b812f56e053",
      "original_position" : 5,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : null,
      "pull_request_review_id" : 281703538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16673",
      "updated_at" : "2019-08-29T20:27:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/319257343",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-09-05T12:03:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16673#issuecomment-528331157",
      "id" : 528331157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16673",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODMzMTE1Nw==",
      "updated_at" : "2019-09-05T12:03:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528331157",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
