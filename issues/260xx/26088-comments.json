[
   {
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/26088/checks?check_run_id=8346907823:\r\n```bash\r\nThe locale dependent function strtol(...) appears to be used:\r\nsrc/httprpc.cpp:            const auto perms{strtol(cookie_perms_arg->c_str(), &cookie_perms_end, 8)};\r\n\r\nUnnecessary locale depedence can cause bugs that are very tricky to isolate and fix. Please avoid using locale dependent functions if possible.\r\n```",
      "created_at" : "2022-09-14T09:32:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1246495531",
      "id" : 1246495531,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585KTAMr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246495531/reactions"
      },
      "updated_at" : "2022-09-14T09:32:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246495531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed lint error.",
      "created_at" : "2022-09-14T09:43:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1246508091",
      "id" : 1246508091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585KTDQ7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246508091/reactions"
      },
      "updated_at" : "2022-09-14T09:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246508091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971081731"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971081731"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n    if (cookie_perms) {\r\n```",
      "commit_id" : "857d46e47a18265eb229a1ea20064d634786bc72",
      "created_at" : "2022-09-14T17:01:39Z",
      "diff_hunk" : "@@ -98,6 +98,15 @@ bool GenerateAuthCookie(std::string *cookie_out)\n     file << cookie;\n     file.close();\n \n+    if(cookie_perms) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971081731",
      "id" : 971081731,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58454YgD",
      "original_commit_id" : "aa5afedd51f0301b45edfcdb6aa2d5d19e7816a8",
      "original_line" : 101,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/request.cpp",
      "position" : null,
      "pull_request_review_id" : 1107896339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971081731/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T17:01:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971081731",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971087418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971087418"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n        if (cookie_perms_arg) {\r\n```",
      "commit_id" : "857d46e47a18265eb229a1ea20064d634786bc72",
      "created_at" : "2022-09-14T17:08:02Z",
      "diff_hunk" : "@@ -238,12 +238,35 @@ static bool HTTPReq_JSONRPC(const std::any& context, HTTPRequest* req)\n     return true;\n }\n \n+static std::optional<unsigned> StringToOctal(const std::string& str)\n+{\n+    unsigned ret = 0;\n+    for (char c : str) {\n+        if (c < '0' || c > '7') return std::nullopt;\n+        ret = (ret << 3) | (c - '0');\n+    }\n+    return ret;\n+}\n+\n static bool InitRPCAuthentication()\n {\n     if (gArgs.GetArg(\"-rpcpassword\", \"\") == \"\")\n     {\n         LogPrintf(\"Using random cookie authentication.\\n\");\n-        if (!GenerateAuthCookie(&strRPCUserColonPass)) {\n+\n+        std::optional<fs::perms> cookie_perms;\n+        auto cookie_perms_arg{gArgs.GetArg(\"-rpccookieperms\")};\n+        if(cookie_perms_arg) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971087418",
      "id" : 971087418,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58454Z46",
      "original_commit_id" : "aa5afedd51f0301b45edfcdb6aa2d5d19e7816a8",
      "original_line" : 259,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/httprpc.cpp",
      "position" : null,
      "pull_request_review_id" : 1107904911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971087418/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T17:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971087418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971087653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971087653"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n            if (!perms) {\r\n```",
      "commit_id" : "857d46e47a18265eb229a1ea20064d634786bc72",
      "created_at" : "2022-09-14T17:08:18Z",
      "diff_hunk" : "@@ -238,12 +238,35 @@ static bool HTTPReq_JSONRPC(const std::any& context, HTTPRequest* req)\n     return true;\n }\n \n+static std::optional<unsigned> StringToOctal(const std::string& str)\n+{\n+    unsigned ret = 0;\n+    for (char c : str) {\n+        if (c < '0' || c > '7') return std::nullopt;\n+        ret = (ret << 3) | (c - '0');\n+    }\n+    return ret;\n+}\n+\n static bool InitRPCAuthentication()\n {\n     if (gArgs.GetArg(\"-rpcpassword\", \"\") == \"\")\n     {\n         LogPrintf(\"Using random cookie authentication.\\n\");\n-        if (!GenerateAuthCookie(&strRPCUserColonPass)) {\n+\n+        std::optional<fs::perms> cookie_perms;\n+        auto cookie_perms_arg{gArgs.GetArg(\"-rpccookieperms\")};\n+        if(cookie_perms_arg) {\n+            auto perms{StringToOctal(*cookie_perms_arg)};\n+            if(!perms) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971087653",
      "id" : 971087653,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58454Z8l",
      "original_commit_id" : "aa5afedd51f0301b45edfcdb6aa2d5d19e7816a8",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/httprpc.cpp",
      "position" : null,
      "pull_request_review_id" : 1107904911,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971087653/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T17:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971087653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971124443"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971124443"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@aureleoules running clang-format on your changes before pushing avoids these little issues; see `/contrib/devtools/clang-format-diff.py` for more info",
      "commit_id" : "857d46e47a18265eb229a1ea20064d634786bc72",
      "created_at" : "2022-09-14T17:47:41Z",
      "diff_hunk" : "@@ -238,12 +238,35 @@ static bool HTTPReq_JSONRPC(const std::any& context, HTTPRequest* req)\n     return true;\n }\n \n+static std::optional<unsigned> StringToOctal(const std::string& str)\n+{\n+    unsigned ret = 0;\n+    for (char c : str) {\n+        if (c < '0' || c > '7') return std::nullopt;\n+        ret = (ret << 3) | (c - '0');\n+    }\n+    return ret;\n+}\n+\n static bool InitRPCAuthentication()\n {\n     if (gArgs.GetArg(\"-rpcpassword\", \"\") == \"\")\n     {\n         LogPrintf(\"Using random cookie authentication.\\n\");\n-        if (!GenerateAuthCookie(&strRPCUserColonPass)) {\n+\n+        std::optional<fs::perms> cookie_perms;\n+        auto cookie_perms_arg{gArgs.GetArg(\"-rpccookieperms\")};\n+        if(cookie_perms_arg) {\n+            auto perms{StringToOctal(*cookie_perms_arg)};\n+            if(!perms) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971124443",
      "id" : 971124443,
      "in_reply_to_id" : 971087653,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58454i7b",
      "original_commit_id" : "aa5afedd51f0301b45edfcdb6aa2d5d19e7816a8",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/httprpc.cpp",
      "position" : null,
      "pull_request_review_id" : 1107958603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971124443/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T17:47:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971124443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971164132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971164132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes I forgot to run it... Fixed the issues by running it.",
      "commit_id" : "857d46e47a18265eb229a1ea20064d634786bc72",
      "created_at" : "2022-09-14T18:28:23Z",
      "diff_hunk" : "@@ -238,12 +238,35 @@ static bool HTTPReq_JSONRPC(const std::any& context, HTTPRequest* req)\n     return true;\n }\n \n+static std::optional<unsigned> StringToOctal(const std::string& str)\n+{\n+    unsigned ret = 0;\n+    for (char c : str) {\n+        if (c < '0' || c > '7') return std::nullopt;\n+        ret = (ret << 3) | (c - '0');\n+    }\n+    return ret;\n+}\n+\n static bool InitRPCAuthentication()\n {\n     if (gArgs.GetArg(\"-rpcpassword\", \"\") == \"\")\n     {\n         LogPrintf(\"Using random cookie authentication.\\n\");\n-        if (!GenerateAuthCookie(&strRPCUserColonPass)) {\n+\n+        std::optional<fs::perms> cookie_perms;\n+        auto cookie_perms_arg{gArgs.GetArg(\"-rpccookieperms\")};\n+        if(cookie_perms_arg) {\n+            auto perms{StringToOctal(*cookie_perms_arg)};\n+            if(!perms) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#discussion_r971164132",
      "id" : 971164132,
      "in_reply_to_id" : 971087653,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58454snk",
      "original_commit_id" : "aa5afedd51f0301b45edfcdb6aa2d5d19e7816a8",
      "original_line" : 261,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/httprpc.cpp",
      "position" : null,
      "pull_request_review_id" : 1108015410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26088",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971164132/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-14T18:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/971164132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This will work only for Linux. Added a few lines in `src/rpc/request.cpp` from an example on https://en.cppreference.com/w/cpp/filesystem/permissions to test and print permissions in logs:\r\n\r\n<details>\r\n  <summary>diff</summary>\r\n  \r\n  ```diff\r\n+void perms(fs::perms p)\r\n+{\r\n+   std::cout << ((p & fs::perms::owner_read) != fs::perms::none ? \"r\" : \"-\")\r\n+             << ((p & fs::perms::owner_write) != fs::perms::none ? \"w\" : \"-\")\r\n+              << ((p & fs::perms::owner_exec) != fs::perms::none ? \"x\" : \"-\")\r\n+              << ((p & fs::perms::group_read) != fs::perms::none ? \"r\" : \"-\")\r\n+              << ((p & fs::perms::group_write) != fs::perms::none ? \"w\" : \"-\")\r\n+              << ((p & fs::perms::group_exec) != fs::perms::none ? \"x\" : \"-\")\r\n+              << ((p & fs::perms::others_read) != fs::perms::none ? \"r\" : \"-\")\r\n+              << ((p & fs::perms::others_write) != fs::perms::none ? \"w\" : \"-\")\r\n+              << ((p & fs::perms::others_exec) != fs::perms::none ? \"x\" : \"-\")\r\n+              << '\\n';\r\n+}\r\n\r\nbool GenerateAuthCookie(std::string* cookie_out, std::optional<fs::perms> cookie_perms)\r\n{\r\n    const size_t COOKIE_SIZE = 32;\r\n    unsigned char rand_pwd[COOKIE_SIZE];\r\n    GetRandBytes(rand_pwd);\r\n    std::string cookie = COOKIEAUTH_USER + \":\" + HexStr(rand_pwd);\r\n\r\n    /** the umask determines what permissions are used to create this file -\r\n     * these are set to 077 in init.cpp unless overridden with -sysperms.\r\n     */\r\n    std::ofstream file;\r\n    fs::path filepath_tmp = GetAuthCookieFile(true);\r\n    file.open(filepath_tmp);\r\n    if (!file.is_open()) {\r\n        LogPrintf(\"Unable to open cookie authentication file %s for writing\\n\", fs::PathToString(filepath_tmp));\r\n        return false;\r\n    }\r\n    file << cookie;\r\n    file.close();\r\n\r\n    if (cookie_perms) {\r\n        std::error_code code;\r\n        std::filesystem::permissions(filepath_tmp, *cookie_perms, std::filesystem::perm_options::replace, code);\r\n        if (code) {\r\n            LogPrintf(\"Unable to set permissions on cookie authentication file %s\\n\", fs::PathToString(filepath_tmp));\r\n            return false;\r\n        }\r\n    }\r\n\r\n    fs::path filepath = GetAuthCookieFile(false);\r\n    if (!RenameOver(filepath_tmp, filepath)) {\r\n        LogPrintf(\"Unable to rename cookie authentication file %s to %s\\n\", fs::PathToString(filepath_tmp), fs::PathToString(filepath));\r\n        return false;\r\n    }\r\n    LogPrintf(\"Generated RPC authentication cookie %s\\n\", fs::PathToString(filepath));\r\n+ LogPrintf(\"Permissions used for cookie: \");\r\n+ perms(fs::status(filepath).permissions());\r\n\r\n    if (cookie_out)\r\n        *cookie_out = cookie;\r\n    return true;\r\n}\r\n```\r\n  \r\n</details>\r\n\r\n\r\n\r\nWindows:\r\n\r\n```\r\n.\\bitcoind.exe\r\n\r\n2022-09-15T09:57:30Z Using random cookie authentication.\r\n2022-09-15T09:57:30Z Generated RPC authentication cookie C:\\Users\\test\\AppData\\Roaming\\Bitcoin\\signet\\.cookie\r\n2022-09-15T09:57:30Z Permissions used for cookie: rw-rw-rw-\r\n\r\n.\\bitcoind.exe -rpccookieperms=0660\r\n\r\n2022-09-15T09:51:36Z Using random cookie authentication.\r\n2022-09-15T09:51:36Z Generated RPC authentication cookie C:\\Users\\test\\AppData\\Roaming\\Bitcoin\\signet\\.cookie\r\n2022-09-15T09:51:36Z Permissions used for cookie: rw-rw-rw-\r\n```\r\n\r\nFedora:\r\n\r\n```\r\nbitcoind\r\n\r\n2022-09-15T11:34:59Z Using random cookie authentication.\r\n2022-09-15T11:34:59Z Generated RPC authentication cookie /home/test/.bitcoin/regtest/.cookie\r\n2022-09-15T11:34:59Z Permissions used for cookie: rw-------\r\n\r\nbitcoind -rpccookieperms=0660\r\n\r\n2022-09-15T11:39:37Z Using random cookie authentication.\r\n2022-09-15T11:39:37Z Generated RPC authentication cookie /home/test/.bitcoin/regtest/.cookie\r\n2022-09-15T11:39:37Z Permissions used for cookie: rw-rw----\r\n```",
      "created_at" : "2022-09-15T11:50:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1247997441",
      "id" : 1247997441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585KYu4B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1247997441/reactions"
      },
      "updated_at" : "2022-09-15T14:18:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1247997441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added the log message with a slightly modified version. Thanks @1440000bytes.",
      "created_at" : "2022-09-16T19:11:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1249714546",
      "id" : 1249714546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585KfSFy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249714546/reactions"
      },
      "updated_at" : "2022-09-16T19:11:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1249714546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [1440000bytes](https://github.com/bitcoin/bitcoin/pull/26088#pullrequestreview-1111135034) |\n| Stale ACK | [kristapsk](https://github.com/bitcoin/bitcoin/pull/26088#pullrequestreview-1108055001) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2022-09-23T03:42:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1255769157",
      "id" : 1255769157,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585K2YRF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1255769157/reactions"
      },
      "updated_at" : "2023-02-06T16:24:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1255769157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm wondering: would it be perhaps simpler to just state in the documentation that you should run `bitcoind` with a `umask` of `0002` and specify `-sysperms` if you want group access to the cookie?\r\n\r\nA consideration here is that now all `bitcoind` created files will be group accessible including wallet files, but given that the group has access to the cookie, if they have the wallet password they can still `dumpwallet`, so the UNIX permissions don't matter as much (or is just a defense-in-depth thing). It seems that #17127 also solves this as well.\r\n\r\nIn any case, this is something that I run into time and again when deploying Bitcoin Core alongside other services, so I'd love to see some documentation on it.",
      "created_at" : "2022-11-10T16:11:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1310534920",
      "id" : 1310534920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585OHS0I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310534920/reactions"
      },
      "updated_at" : "2022-11-10T16:11:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310534920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@aureleoules did you want to reponds to Carls thoughts here?\r\n\r\n> It seems that https://github.com/bitcoin/bitcoin/pull/17127 also solves this as well.\r\n\r\nIt's probably likey that 17127 will be merged shortly.\r\n",
      "created_at" : "2023-02-06T16:24:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26088#issuecomment-1419361533",
      "id" : 1419361533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26088",
      "node_id" : "IC_kwDOABII585Umbz9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419361533/reactions"
      },
      "updated_at" : "2023-02-06T16:24:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419361533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
