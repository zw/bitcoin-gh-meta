[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1451900443) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27008](https://github.com/bitcoin/bitcoin/pull/27008) (assumeutxo: keep cache when flushing snapshot (#17487 followup) by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-09-08T17:13:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1240993698",
      "id" : 1240993698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585J-A-i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240993698/reactions"
      },
      "updated_at" : "2023-03-02T13:53:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240993698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure it's worth it to save 20%. Presumably generic compressors could do better anyway?",
      "created_at" : "2022-09-10T23:36:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1242820216",
      "id" : 1242820216,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585KE-54",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1242820216/reactions"
      },
      "updated_at" : "2022-09-10T23:36:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1242820216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Not sure it's worth it to save 20%. Presumably generic compressors could do better anyway?\r\n\r\nYes I agree but at least with this implementation the utxo set is still readable as is and doesn't need decompression.",
      "created_at" : "2022-09-12T07:26:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1243324603",
      "id" : 1243324603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585KG6C7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1243324603/reactions"
      },
      "updated_at" : "2022-09-12T07:26:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1243324603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The main downside of this implementation is that the entire UTXO set must be loaded in RAM (in mapCoins) before being written to disk. So running dumptxoutset will consome a lot of RAM on mainnet since the utxo set is large.\r\n>  Not sure how to improve this.\r\n\r\nThe keys in leveldb are guaranteed to be lexicographically sorted. You just need to cache the last txid and flush the txid and outpoint tuples once the next one is reached in the database iterator. I pushed a dirty proof of concept [here](https://github.com/TheCharlatan/bitcoin/commit/b0a22fbd2eee90982d3bc5f65f0d3cde049fd0f4) and it produced the same output file as your current implementation.\r\n\r\nOtherwise Concept ACK. For a file that might be lugged over a network or other data carrier this space improvement is nice. Users can still apply their own compression on top of it. I also like that this provides additional structure to the data.\r\n",
      "created_at" : "2023-03-02T13:53:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1451900443",
      "id" : 1451900443,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585Wij4b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1451900443/reactions"
      },
      "updated_at" : "2023-03-02T13:53:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1451900443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yeah as I specified in the issue and as @TheCharlatan wrote more ram shouldn't be needed because txid are iterated sorted from leveldb.\r\n\r\nI was also wondering why the `bitcoin-cli savetxoutset`  API (same goes for `savemempool`) requires to specify a filename instead of writing to stdout that would offer better composition while maintaining the possibility to write to file with `>utxo.bin`",
      "created_at" : "2023-03-16T16:17:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1472285629",
      "id" : 1472285629,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585XwUu9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472285629/reactions"
      },
      "updated_at" : "2023-03-16T16:17:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472285629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6470319?v=4",
         "events_url" : "https://api.github.com/users/RCasatta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RCasatta/followers",
         "following_url" : "https://api.github.com/users/RCasatta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RCasatta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RCasatta",
         "id" : 6470319,
         "login" : "RCasatta",
         "node_id" : "MDQ6VXNlcjY0NzAzMTk=",
         "organizations_url" : "https://api.github.com/users/RCasatta/orgs",
         "received_events_url" : "https://api.github.com/users/RCasatta/received_events",
         "repos_url" : "https://api.github.com/users/RCasatta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RCasatta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RCasatta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RCasatta"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1472285629\r\n\r\n> I was also wondering why the bitcoin-cli savetxoutset API (same goes for savemempool) requires to specify a filename instead of writing to stdout that would offer better composition while maintaining the possibility to write to file with >utxo.bin\r\n\r\nWriting to stdout would mean that the data would have to be carried over the rpc connection, right?",
      "created_at" : "2023-04-29T08:26:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1528716678",
      "id" : 1528716678,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585bHl2G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1528716678/reactions"
      },
      "updated_at" : "2023-04-29T08:26:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1528716678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Writing to stdout would mean that the data would have to be carried over the rpc connection, right?\n\nYes, would that be a problem?",
      "created_at" : "2023-04-30T13:33:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1529027307",
      "id" : 1529027307,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585bIxrr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529027307/reactions"
      },
      "updated_at" : "2023-04-30T13:33:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529027307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6470319?v=4",
         "events_url" : "https://api.github.com/users/RCasatta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RCasatta/followers",
         "following_url" : "https://api.github.com/users/RCasatta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RCasatta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RCasatta",
         "id" : 6470319,
         "login" : "RCasatta",
         "node_id" : "MDQ6VXNlcjY0NzAzMTk=",
         "organizations_url" : "https://api.github.com/users/RCasatta/orgs",
         "received_events_url" : "https://api.github.com/users/RCasatta/received_events",
         "repos_url" : "https://api.github.com/users/RCasatta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RCasatta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RCasatta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RCasatta"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There is no way we can currently send gigabytes of data as an RPC response; both the server and client likely buffer the result and would OOM.",
      "created_at" : "2023-04-30T13:37:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26045#issuecomment-1529027970",
      "id" : 1529027970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
      "node_id" : "IC_kwDOABII585bIx2C",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529027970/reactions"
      },
      "updated_at" : "2023-04-30T13:37:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529027970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
