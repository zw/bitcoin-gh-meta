[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ping @vasild ",
      "created_at" : "2022-06-08T19:56:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#issuecomment-1150342337",
      "id" : 1150342337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25314",
      "node_id" : "IC_kwDOABII585EkNTB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150342337/reactions"
      },
      "updated_at" : "2022-06-08T19:56:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150342337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 65749ee3933898b54a77443e647ed5c1d12e0f99\r\ngood catch. could be a good functional test?",
      "created_at" : "2022-06-09T11:10:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#issuecomment-1150988398",
      "id" : 1150988398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25314",
      "node_id" : "IC_kwDOABII585EmrBu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150988398/reactions"
      },
      "updated_at" : "2022-06-09T11:10:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1150988398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> good catch. could be a good functional test?\r\n\r\nI think that would be hard, because the local addresses in the functional tests are unroutable, so nodes don't self-advertise there. There is even the workaround of the `-addrmantest` parameter used in `p2p_node_network_limited.py` for this, but that just returns a fixed addr so the code changed here isn't executed.\r\nHowever, the unit test `net_tests/get_local_addr_for_peer_port` covers this (and would fail without the update in this PR). Before, it would just check that the expected and actual CAddress have a default-initialized nTime.",
      "created_at" : "2022-06-09T14:09:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#issuecomment-1151169113",
      "id" : 1151169113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25314",
      "node_id" : "IC_kwDOABII585EnXJZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1151169113/reactions"
      },
      "updated_at" : "2022-06-09T14:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1151169113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893659810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893659810"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Here we want to preserve the `nTime` as it was before the `addrLocal =` assignment. So it is better to use `addrLocal.nTime` instead of `GetAdjustedTime()` because using the latter seeps knowledge that `GetLocalAddress()` has set `nTime` to `GetAdjustedTime()` and so if that is changed to set it to e.g. `GetFooTime()`, this line would have to be changed too.\r\n\r\nLuckily `CAddress` has a constructor that takes `nTime` which is handy:\r\n\r\n```cpp\r\naddrLocal = CAddress{pnode->GetAddrLocal(), addrLocal.nServices, addrLocal.nTime};\r\n```",
      "commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "created_at" : "2022-06-09T15:32:08Z",
      "diff_hunk" : "@@ -251,6 +251,7 @@ std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n             // For inbound connections, assume both the address and the port\n             // as seen from the peer.\n             addrLocal = CAddress{pnode->GetAddrLocal(), addrLocal.nServices};\n+            addrLocal.nTime = GetAdjustedTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893659810",
      "id" : 893659810,
      "line" : 254,
      "node_id" : "PRRC_kwDOABII5841RCqi",
      "original_commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "original_line" : 254,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 1001565116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893659810/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T16:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893659810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893693001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893693001"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These changes would not be needed if the test below is fixed to just compare the address and port - that is/was the intention, but in the last check:\r\n\r\n```cpp\r\nBOOST_CHECK(*chosen_local_addr == peer_us);\r\n```\r\n\r\nit ends up comparing to `CAddress` objects which also compares time and services. That is not intended. Better change it to:\r\n\r\n```cpp\r\nBOOST_CHECK(static_cast<CService>(*chosen_local_addr) == peer_us);\r\n```\r\n\r\nor even more obvious:\r\n\r\n```cpp\r\nBOOST_CHECK(static_cast<CService>(*chosen_local_addr) == static_cast<CService>(peer_us));\r\n```",
      "commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "created_at" : "2022-06-09T15:58:03Z",
      "diff_hunk" : "@@ -678,7 +678,10 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n     // Our address:port as seen from the peer, completely different from the above.\n     in_addr peer_us_addr;\n     peer_us_addr.s_addr = htonl(0x02030405);\n-    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    int64_t current_time{GetAdjustedTime()};\n+    SetMockTime(current_time);\n+    peer_us.nTime = current_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893693001",
      "id" : 893693001,
      "line" : 684,
      "node_id" : "PRRC_kwDOABII5841RKxJ",
      "original_commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "original_line" : 684,
      "original_position" : 8,
      "original_start_line" : 681,
      "path" : "src/test/net_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 1001565116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893693001/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 681,
      "start_side" : "LEFT",
      "updated_at" : "2022-06-09T16:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893693001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893819364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893819364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wouldn't it be better to have the test compare the entire advertised `CAddress`, especially with the difficulties of writing functional test for self-advertisements? \r\nI know it is not the main intention for this test, but I think it is nice to have this tested on the side, especially with the footgunny `CAddress(CService, ServiceFlags)` ctor that is used so frequently, probably to avoid `int64_t`  / `uint32_t` compiler warnings when inserting a `int64_t` time into the full ctor with `nTime`.\r\nSo maybe it would be better to instead also raise the earlier check to the Level of `CAddress`?",
      "commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "created_at" : "2022-06-09T18:09:14Z",
      "diff_hunk" : "@@ -678,7 +678,10 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n     // Our address:port as seen from the peer, completely different from the above.\n     in_addr peer_us_addr;\n     peer_us_addr.s_addr = htonl(0x02030405);\n-    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    int64_t current_time{GetAdjustedTime()};\n+    SetMockTime(current_time);\n+    peer_us.nTime = current_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893819364",
      "id" : 893819364,
      "in_reply_to_id" : 893693001,
      "line" : 684,
      "node_id" : "PRRC_kwDOABII5841Rpnk",
      "original_commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "original_line" : 684,
      "original_position" : 8,
      "original_start_line" : 681,
      "path" : "src/test/net_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 1001787976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893819364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 681,
      "start_side" : "LEFT",
      "updated_at" : "2022-06-09T18:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893819364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893819835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893819835"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good suggestion, will do with the next push.",
      "commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "created_at" : "2022-06-09T18:09:55Z",
      "diff_hunk" : "@@ -251,6 +251,7 @@ std::optional<CAddress> GetLocalAddrForPeer(CNode *pnode)\n             // For inbound connections, assume both the address and the port\n             // as seen from the peer.\n             addrLocal = CAddress{pnode->GetAddrLocal(), addrLocal.nServices};\n+            addrLocal.nTime = GetAdjustedTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893819835",
      "id" : 893819835,
      "in_reply_to_id" : 893659810,
      "line" : 254,
      "node_id" : "PRRC_kwDOABII5841Rpu7",
      "original_commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "original_line" : 254,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 1001788675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893819835/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-09T18:09:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893819835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> The proficiency of the engineers is just astonishing in this community (@mzumsande)! How the hell did you catch this?\r\n\r\nThank you! Pretty much by chance - I was reviewing #25303 and while looking at this [commit msg](https://github.com/bitcoin/bitcoin/pull/25303/commits/00001e57fe74c061aa9cbc72b07252335cb566e0)Â I was wondering if it was possible to somehow have addresses with default-initialised nTime in addrman or addr relay Â - that's how I stumbled upon this.",
      "created_at" : "2022-06-09T18:15:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#issuecomment-1151447597",
      "id" : 1151447597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25314",
      "node_id" : "IC_kwDOABII585EobIt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1151447597/reactions"
      },
      "updated_at" : "2022-06-09T18:15:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1151447597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893844985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893844985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright, it is good to test more, even though this test is targeted at testing the ports stuff. IMO it is better for one test to test one thing, so maybe create a new test that just calls `GetLocalAddrForPeer()` without the ports complications from the `get_local_addr_for_peer_port` test. Anyway, up to you. If the existent test is to be modified, then I guess something like this should suffice:\r\n\r\n```diff\r\n     m_node.args->ForceSetArg(\"-bind\", strprintf(\"3.4.5.6:%u\", bind_port));\r\n \r\n+    const uint32_t current_time = static_cast<uint32_t>(GetAdjustedTime());\r\n+\r\n+    SetMockTime(current_time);\r\n+\r\n     // Our address:port as seen from the peer, completely different from the above.\r\n     in_addr peer_us_addr;\r\n     peer_us_addr.s_addr = htonl(0x02030405);\r\n-    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\r\n+    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK, current_time};\r\n \r\n     // Create a peer with a routable IPv4 address (outbound).\r\n```",
      "commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "created_at" : "2022-06-09T18:42:12Z",
      "diff_hunk" : "@@ -678,7 +678,10 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n     // Our address:port as seen from the peer, completely different from the above.\n     in_addr peer_us_addr;\n     peer_us_addr.s_addr = htonl(0x02030405);\n-    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    int64_t current_time{GetAdjustedTime()};\n+    SetMockTime(current_time);\n+    peer_us.nTime = current_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r893844985",
      "id" : 893844985,
      "in_reply_to_id" : 893693001,
      "line" : 684,
      "node_id" : "PRRC_kwDOABII5841Rv35",
      "original_commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "original_line" : 684,
      "original_position" : 8,
      "original_start_line" : 681,
      "path" : "src/test/net_tests.cpp",
      "position" : 8,
      "pull_request_review_id" : 1001824065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893844985/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 681,
      "start_side" : "LEFT",
      "updated_at" : "2022-06-09T18:42:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/893844985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r894627287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/894627287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I took your suggestion to modify, and also changed the check for `expected` to the level of `CAddress`. I think it's natural for a unit test of a function that returns an object to check the entire object is as expected, and not just parts of it, especially if it's just two more fields and a (thorough) separate test that would have caught this issue would have required to replicate some of the port stuff in order to also get to the branch where nTime was left default-initialized.",
      "commit_id" : "99b9e5f3a9fa29bbc1e45fc958470fbcc207ef23",
      "created_at" : "2022-06-10T15:02:40Z",
      "diff_hunk" : "@@ -678,7 +678,10 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n     // Our address:port as seen from the peer, completely different from the above.\n     in_addr peer_us_addr;\n     peer_us_addr.s_addr = htonl(0x02030405);\n-    const CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    CAddress peer_us{CService{peer_us_addr, 20002}, NODE_NETWORK};\n+    int64_t current_time{GetAdjustedTime()};\n+    SetMockTime(current_time);\n+    peer_us.nTime = current_time;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#discussion_r894627287",
      "id" : 894627287,
      "in_reply_to_id" : 893693001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841Uu3X",
      "original_commit_id" : "65749ee3933898b54a77443e647ed5c1d12e0f99",
      "original_line" : 684,
      "original_position" : 8,
      "original_start_line" : 681,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1002931789,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25314",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/894627287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "LEFT",
      "updated_at" : "2022-06-10T15:02:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/894627287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "[65749ee ](https://github.com/bitcoin/bitcoin/commit/65749ee3933898b54a77443e647ed5c1d12e0f99) -> [99b9e5f](https://github.com/bitcoin/bitcoin/commit/99b9e5f3a9fa29bbc1e45fc958470fbcc207ef23)\r\nAddressed feedback by @vasild (thanks!)",
      "created_at" : "2022-06-10T15:03:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25314#issuecomment-1152457947",
      "id" : 1152457947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25314",
      "node_id" : "IC_kwDOABII585EsRzb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152457947/reactions"
      },
      "updated_at" : "2022-06-10T15:03:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1152457947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
