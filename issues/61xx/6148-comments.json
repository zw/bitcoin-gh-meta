[
   {
      "body" : "Fine with me. Reorg is still a problem, but relaying the tip is at least better than relaying nothing.\r\n\r\nTo solve the reorg-problem, I would want to also call FindNextBlocksToDownload on pruned-nodes, if it is ensured that we can not ask them for pruned blocks.\r\n@sipa Would this be possible, to just call FindNextBlocksToDownload also for pruned nodes, when we are close to being synced?",
      "created_at" : "2015-05-16T11:30:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-102613206",
      "id" : 102613206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-16T11:30:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102613206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=3",
         "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cozz/followers",
         "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cozz",
         "id" : 2814559,
         "login" : "cozz",
         "organizations_url" : "https://api.github.com/users/cozz/orgs",
         "received_events_url" : "https://api.github.com/users/cozz/received_events",
         "repos_url" : "https://api.github.com/users/cozz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cozz"
      }
   },
   {
      "body" : "ACK. Tested for tip relay for master and reorg relay (up to a certain depth) for 0.9.",
      "created_at" : "2015-05-17T21:00:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-102857824",
      "id" : 102857824,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-17T21:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/102857824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I just sopped my pruned node, added this PR on top of the current master, ran again and had the following issue:\r\n\r\n**Stopping:**\r\n```\r\nPrune: target=550MiB actual=467MiB diff=82MiB min_must_keep=356959 removed 0 blk/rev pairs\r\nreceive version message: /bitcoinseeder:0.01/: version 60000, blocks=230000, us=***:8334, peer=18138\r\nreceive version message: /Snoopy:0.1/: version 60001, blocks=0, us=***:8334, peer=18139\r\nreceive version message: /bitcoinseeder:0.01/: version 60000, blocks=230000, us=***:8334, peer=18140\r\nreceive version message: /bitcoinseeder:0.01/: version 60000, blocks=230000, us=***:8334, peer=18141\r\nreceive version message: /getaddr.bitnodes.io:0.1/: version 70002, blocks=357246, us=***:8334, peer=18142\r\nreceive version message: /getaddr.bitnodes.io:0.1/: version 70002, blocks=357246, us=***:8334, peer=18143\r\nreceive version message: /bitcoinseeder:0.01/: version 60000, blocks=230000, us=***:8334, peer=18144\r\nERROR: AcceptToMemoryPool: nonstandard transaction: dust\r\nreceive version message: /breadwallet:0.5.1/: version 70002, blocks=0, us=***:8334, peer=18145\r\nAdded time data, samples 200, offset -1 (+0 minutes)\r\nreceive version message: /Snoopy:0.1/: version 60001, blocks=0, us=***:8334, peer=18146\r\nreceive version message: /getaddr.bitnodes.io:0.1/: version 70002, blocks=357247, us=****:8334, peer=18147\r\nreceive version message: /bitcoinseeder:0.01/: version 60000, blocks=230000, us=***:8334, peer=18148\r\n^Cnet thread interrupt\r\nmsghand thread interrupt\r\naddcon thread interrupt\r\nopencon thread interrupt\r\ndumpaddr thread stop\r\nShutdown: In progress...\r\nRPCAcceptHandler: Error: Operation canceled\r\nRPCAcceptHandler: Error: Operation canceled\r\nStopNode()\r\nPrune: target=550MiB actual=467MiB diff=82MiB min_must_keep=356959 removed 0 blk/rev pairs\r\nShutdown: done\r\n```\r\n\r\n**Restarting (after serval seconds/minutes):**\r\n```\r\nAppInit2 : parameter interaction: -prune -> setting -disablewallet=1\r\nPrune configured to target 550MiB on disk for block and undo files.\r\n---snip---\r\nBitcoin version v0.10.99.0-4b30ade (2015-05-20 11:45:07 +0200)\r\nUsing OpenSSL version OpenSSL 1.0.1e 11 Feb 2013\r\nUsing BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\nDefault data directory ***\r\nUsing data directory ***\r\nUsing config file ***/bitcoin.conf\r\nUsing at most 125 connections (1024 file descriptors available)\r\nUsing 8 threads for script verification\r\nscheduler thread start\r\nAllowing RPC connections from: 127.0.0.0/255.0.0.0 ::1/ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\r\nBinding RPC on address ::1 port *** (IPv4+IPv6 bind any: 0)\r\nBinding RPC on address 127.0.0.1 port *** (IPv4+IPv6 bind any: 0)\r\nBound to [::]:8334\r\nBound to 0.0.0.0:8334\r\nCache configuration:\r\n* Using 2.0MiB for block index database\r\n* Using 32.5MiB for chain state database\r\n* Using 65.5MiB for in-memory UTXO set\r\ninit message: Loading block index...  \r\nOpening LevelDB in ***/blocks/index\r\nOpened LevelDB successfully\r\nOpening LevelDB in ***/chainstate\r\nOpened LevelDB successfully\r\nLoadBlockIndexDB: last block file = 271\r\nLoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=70, size=30105947, heights=357178...357247, time=2015-05-19...2015-05-20)\r\nChecking all blk files are present... \r\nUnable to open file ***/blocks/blk00264.dat\r\n: Error loading block database.\r\n\r\nDo you want to rebuild the block database now?\r\n: Error loading block database.\r\n\r\nDo you want to rebuild the block database now?\r\nAborted block database rebuild. Exiting.\r\nShutdown: In progress...\r\n```\r\n\r\nI doubt that it has something to do with this PR but it could lead to another existing issue.",
      "created_at" : "2015-05-20T11:04:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-103843806",
      "id" : 103843806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-20T11:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103843806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "My `/blocks` dir contains the following:\r\n```\r\nblk00268.dat  blk00269.dat  blk00270.dat  blk00271.dat  index  rev00268.dat  rev00269.dat  rev00270.dat  rev00271.dat\r\n```",
      "created_at" : "2015-05-20T11:06:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-103844273",
      "id" : 103844273,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-20T11:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103844273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Further up i can see in my log that `blk00264.dat` has been deleted because of pruning (around 9 days ago).\r\n\r\n```\r\nreceive version message: /btccrawler.ch:v0.1/: version 70002, blocks=355967, us=***:8334, peer=729\r\nERROR: AcceptToMemoryPool: nonstandard transaction: dust\r\nPrune: target=550MiB actual=532MiB diff=17MiB min_must_keep=355679 removed 0 blk/rev pairs\r\nPrune: target=550MiB actual=388MiB diff=161MiB min_must_keep=355679 removed 1 blk/rev pairs\r\nPrune: UnlinkPrunedFiles deleted blk/rev (00264)\r\nUpdateTip: new best=00000000000000000cbfa2566c81e0bc78f37b66e35ff3657d552154ca9436ca  height=355968  log2_work=82.765851  tx=68384633  date=2015-05-11 20:16:36 progress=1.\r\n00000  cache=0\r\n```",
      "created_at" : "2015-05-20T11:14:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-103846388",
      "id" : 103846388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-20T11:14:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103846388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli any chance you had been running with #6118 and then switched to running without? This looks exactly like what happens when trying to downgrade from lazy updating of mapBlockIndex. If that is the issue you can workaround by restarting your node with #6118 and then quickly stopping; the block index is refreshed on startup. You could then restart without the lazy updating code and things should work fine.",
      "created_at" : "2015-05-20T12:15:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-103860722",
      "id" : 103860722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-20T12:15:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103860722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar pretty sure i did this. I'll now try to run a master-full-node, sync up, add this PR on top and continue to confirm the missing-lazy-update issue.",
      "created_at" : "2015-05-20T12:19:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-103861280",
      "id" : 103861280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-20T12:19:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103861280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Stopped a full-node, copied datadir, ran a new master-full-node with the just copied datadir and pruning target 550, stopped after a while, added this PR on top and it looks good.\r\n\r\nNow testing block relying.",
      "created_at" : "2015-05-20T12:59:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-103875842",
      "id" : 103875842,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-20T12:59:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/103875842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Did some testing.\r\nConnected a fresh mainnet node to a pruned node.\r\nI was expecting that my fresh node can load at least the whole headers-first-chain but encountered:\r\n\r\n```\r\n--- snip\r\nsending: pong (8 bytes) peer=1\r\nreceived: getheaders (997 bytes) peer=1\r\ngetheaders -1 to 0000000000000000000000000000000000000000000000000000000000000000 from peer=1\r\nsending: headers (1 bytes) peer=1\r\nreceived: addr (30003 bytes) peer=1\r\nreceived: pong (8 bytes) peer=1\r\nreceived: inv (37 bytes) peer=1\r\ngot inv: tx f6bfd86ac1d0a4a981fdb950da97c630254e716e3b05ef872a2ca94ebf892e7c  new peer=1\r\n--- snip\r\n```\r\n(no headers response to headers request)\r\n\r\nConnecting a fresh node to a non-pruned full node results in:\r\n```\r\n--- snip\r\nreceived: getheaders (997 bytes) peer=1\r\ngetheaders -1 to 0000000000000000000000000000000000000000000000000000000000000000 from peer=1\r\nsending: headers (1 bytes) peer=1\r\nreceived: pong (8 bytes) peer=1\r\nreceived: headers (162003 bytes) peer=1\r\nmore getheaders (2000) to end to peer=1 (startheight:357399)\r\nsending: getheaders (741 bytes) peer=1\r\nRequesting block 00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048 (1) peer=1\r\n--- snip\r\n```\r\n\r\nWill also try to connect a \"half-synced\" full node to a pruned node where the half-synced node has just some blocks over the prune level of the pruned node. But this needs a little bit time to set up.",
      "created_at" : "2015-05-21T09:24:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-104193558",
      "id" : 104193558,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-21T09:24:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/104193558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli  The fresh node won't load the whole headers from the pruning node on startup, because we only choose full NODE_NETWORK nodes to sync the headers chain.  However, if you were to wait long enough for the pruning node to inv a block, then at that point at getheaders message should be sent to the pruning node, and headers should then sync.\r\n",
      "created_at" : "2015-05-28T13:32:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-106311194",
      "id" : 106311194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-05-28T13:32:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/106311194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Nice, I'm running 0.11.0rc1 and bitcoin in %appdata% is only taking up 1.33 GB of space.. Would love to be able to relay blocks. I'd actually leave this on with this small of a memory footprint.",
      "created_at" : "2015-06-10T04:05:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-110581479",
      "id" : 110581479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-06-10T04:05:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/110581479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/446261?v=3",
         "events_url" : "https://api.github.com/users/Onetallnerd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Onetallnerd/followers",
         "following_url" : "https://api.github.com/users/Onetallnerd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Onetallnerd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Onetallnerd",
         "id" : 446261,
         "login" : "Onetallnerd",
         "organizations_url" : "https://api.github.com/users/Onetallnerd/orgs",
         "received_events_url" : "https://api.github.com/users/Onetallnerd/received_events",
         "repos_url" : "https://api.github.com/users/Onetallnerd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Onetallnerd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Onetallnerd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Onetallnerd"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6148#discussion_r32379784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/32379784"
         }
      },
      "body" : "Can you use a symbolic constant here? Or some calculation based on consensus params?",
      "commit_id" : "ae6f957a628efeeae47b8a2deee595c2ac5e7640",
      "created_at" : "2015-06-14T13:47:40Z",
      "diff_hunk" : "@@ -4153,6 +4151,14 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                 LogPrint(\"net\", \"  getblocks stopping at %d %s\\n\", pindex->nHeight, pindex->GetBlockHash().ToString());\n                 break;\n             }\n+            // If pruning, don't inv blocks unless we have on disk and are likely to still have\n+            // for some reasonable time window that block relay might require.\n+            const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 6;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#discussion_r32379784",
      "id" : 32379784,
      "original_commit_id" : "f3b92daaf8190df5a0f45695a80d1b16b570396d",
      "original_position" : 17,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6148",
      "updated_at" : "2015-06-17T19:43:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/32379784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I haven't followed up on all proposed changes related to this. Is there a plan to also make peers use the inventories we send out? With a change like this, the immediate fetching logic may react to an fClient peer sending a block inv, but the asynchronous fetching won't, making this (for now) useless for reorgs, for example.",
      "created_at" : "2015-06-14T13:49:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-111827959",
      "id" : 111827959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-06-14T13:49:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111827959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I'm confused by the several related and seemingly-overlapping PRs here.",
      "created_at" : "2015-06-14T14:14:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-111829759",
      "id" : 111829759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-06-14T14:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/111829759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Sorry for the PR confusion.  #6130 fixes a bug where pruning nodes would respond badly to a getblocks message by inv'ing blocks they don't actually have.  This pull adds block relaying for pruning nodes, which would not work without the fix in #6130, so I built it on top.\r\n\r\nInitially I thought the bug fix in #6130 should stand on its own, but on further thought I think it could only be triggered once we actually implement block relay.  I'll go ahead and close that pull in favor of this one.\r\n\r\nAs for next steps, yes this pull is insufficient for relaying reorgs to 0.10 and later peers.  I was thinking that we'd hopefully be able to put together a sharding implementation and at that point we'd also implement the more intelligent block requesting at the same time.  I guess if that work seems like it's taking too long, we could (I guess before the 0.12 release) instead do some other change to the parallel-fetch code to try to request recent blocks from pruning peers.  Would you rather see a solution like that as part of this pull? ",
      "created_at" : "2015-06-16T15:11:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-112465268",
      "id" : 112465268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-06-16T15:11:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/112465268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "No, just querying what the current state/plan is :)",
      "created_at" : "2015-06-16T15:19:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-112468327",
      "id" : 112468327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-06-16T15:19:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/112468327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6148#discussion_r32666526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6148"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/32666526"
         }
      },
      "body" : "@sipa Fixed to use a calculation based on consensus params.",
      "commit_id" : "ae6f957a628efeeae47b8a2deee595c2ac5e7640",
      "created_at" : "2015-06-17T19:44:38Z",
      "diff_hunk" : "@@ -4153,6 +4151,14 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                 LogPrint(\"net\", \"  getblocks stopping at %d %s\\n\", pindex->nHeight, pindex->GetBlockHash().ToString());\n                 break;\n             }\n+            // If pruning, don't inv blocks unless we have on disk and are likely to still have\n+            // for some reasonable time window that block relay might require.\n+            const int nPrunedBlocksLikelyToHave = MIN_BLOCKS_TO_KEEP - 6;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#discussion_r32666526",
      "id" : 32666526,
      "original_commit_id" : "f3b92daaf8190df5a0f45695a80d1b16b570396d",
      "original_position" : 17,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6148",
      "updated_at" : "2015-06-17T19:44:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/32666526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Been running on bitcoin.sipa.be for a week, no problems.",
      "created_at" : "2015-06-21T13:22:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6148#issuecomment-113901149",
      "id" : 113901149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6148",
      "updated_at" : "2015-06-21T13:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113901149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
