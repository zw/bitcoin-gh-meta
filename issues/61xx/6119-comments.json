[
   {
      "body" : "@faizkhan00 This tool has a long history. It's not pulled from bitcoinj, but rather from @TheBlueMatt's forked version. See depends/packages/native_comparisontool.mk.\r\n\r\nWe rely on it for behavioral tests and it can't be deprecated until all tests have been recreated. See the recent python test framework from @sdaftuar which may be able to achieve that once it's filled out more.",
      "created_at" : "2015-05-08T21:29:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-100373569",
      "id" : 100373569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-08T21:29:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/100373569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "Thanks @theuni, this is exactly what I was looking for before. I'm still trying to find out, where that comparisontool is built from (makefile-wise)... I didn't notice any references to TheBlueMatt/bitcoinj, but perhaps I'm not looking in the right place.\r\n\r\n(As an aside, it also looks like `native_comparisontool.mk` is pointing to an empty ref (404 for me :/): https://github.com/TheBlueMatt/test-scripts/raw/38b490a2599d422b12d5ce8f165792f63fd8f54f , not sure if this is aggravating the buildbot issues or not, though.)\r\n\r\nMore to the point, if the builds are breaking, where would the fixes go, and are they valuable to update? (versus pushing that off or expanding @sdaftuar's testing framework, instead -* I think having accurate travis builds would provide lots of value)",
      "created_at" : "2015-05-08T21:43:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-100376298",
      "id" : 100376298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-08T21:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/100376298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2230604?v=3",
         "events_url" : "https://api.github.com/users/faizkhan00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/faizkhan00/followers",
         "following_url" : "https://api.github.com/users/faizkhan00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/faizkhan00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/faizkhan00",
         "id" : 2230604,
         "login" : "faizkhan00",
         "organizations_url" : "https://api.github.com/users/faizkhan00/orgs",
         "received_events_url" : "https://api.github.com/users/faizkhan00/received_events",
         "repos_url" : "https://api.github.com/users/faizkhan00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/faizkhan00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/faizkhan00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/faizkhan00"
      }
   },
   {
      "body" : "@faizkhan00 Travis uses that process for each build. It contains no state (other than a download cache) so if the url is bad, builds will eventually fail because they can't fetch it. The full url is download_path + file_name: https://github.com/TheBlueMatt/test-scripts/raw/38b490a2599d422b12d5ce8f165792f63fd8f54f/pull-tests-0f7b5d8.jar\r\n\r\nAs for fixing broken builds, the current tool is built from here: https://github.com/TheBlueMatt/bitcoinj/commits/0f7b5d89b5f70c0803d36e690b702b5050771381 . That commit doesn't appear in any public branches, it looks like it's been rebased into https://github.com/TheBlueMatt/bitcoinj/tree/blocktester. Notice that the package_version in native_comparisontool.mk points to the commit that the jar is built from.\r\n\r\nI suggested at one point that we build the jar from source rather than pulling down some random blob, but I was in the minority and I didn't push it. I'd still like to see it work that way, but at this point, it makes more sense to spend the effort get the python tool up to feature parity.\r\n\r\nIf you'd like to take a stab at fixing, I suggest you checkout the code at 0f7b5d89b5f70c0803d36e690b702b5050771381, track down the issue, build a jar, then submit a PR to bump the version we pull. But again, I'm sure @sdaftuar could come up with a list of ways you could help out with the python framework instead.",
      "created_at" : "2015-05-09T19:22:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-100534311",
      "id" : 100534311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-09T19:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/100534311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : ">Travis uses that process for each build. It contains no state [...] The full url is download_path + file_name: ... \r\n\r\nAh! I see how it works now. That was a strange moment, thanks for clarifying that.\r\n\r\nI also see what you mean about building from source, it seems the jar in `TheBlueMatt/test-scripts` was compiled in a native environment and then distributed using Github, which doesn't feel very good from a deployment perspective. \r\n\r\nIt looks like you're spot-on regarding hash-branch correlations too, I see the tip of `TheBlueMatt/blocktester` is the same hash as whats in the tip of `TheBlueMatt/test-scripts` (the jar, at least); and I think my preference is to try to load the BitcoindComparisonTool tests into the python framework as well.\r\n\r\nSince it likely means debugging the comparison tool, I'll probably start there, and seeing as how its probably not a light fix I'd like to ask @sdaftuar: What are your thoughts about expanding the python framework a bit to replace the current tooling? It looks like I'll be debugging things in parallel, so I'm curious if you see any benefit from adding to your code.",
      "created_at" : "2015-05-10T05:20:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-100585808",
      "id" : 100585808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-10T05:20:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/100585808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2230604?v=3",
         "events_url" : "https://api.github.com/users/faizkhan00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/faizkhan00/followers",
         "following_url" : "https://api.github.com/users/faizkhan00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/faizkhan00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/faizkhan00",
         "id" : 2230604,
         "login" : "faizkhan00",
         "organizations_url" : "https://api.github.com/users/faizkhan00/orgs",
         "received_events_url" : "https://api.github.com/users/faizkhan00/received_events",
         "repos_url" : "https://api.github.com/users/faizkhan00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/faizkhan00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/faizkhan00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/faizkhan00"
      }
   },
   {
      "body" : "@faizkhan00  I think the next step for the python work is to start recreating the tests from the existing bitcoinj comparison tool in a new python test.  I think there are two main hurdles for this work, one is to just carefully understand the existing tests, and the other is to implement whatever additional python infrastructure might be needed to make for well-written tests (ie that are easy to read, write, update, understand, etc).  Not sure yet exactly what those infrastructure changes will look like, but I'm guessing we'll need to refine the ```BlockStore``` object (in ```blockstore.py```) and maybe the ```TestInstance``` in ```comptool.py```, and likely need to add some additional code to support signing transactions.\r\n\r\nI guess a third hurdle is that I think there may be bugs in the existing bitcoinj tests.  For instance one issue I've been meaning to track down but haven't yet is this apparent bug mentioned in an old PR, #2884.\r\n\r\nAnyway I am planning to start working on a python reimplementation, but I expect it to take a while before all the tests are rewritten and before everyone would be comfortable cutting over from the existing tests to a new one.  So if you do spend time debugging/patching the bitcoinj version, which actually also needs to be patched for #5966, that should be generally helpful I think.\r\n\r\nAlso if you're interested in diving in and writing python tests please feel free, though unfortunately I haven't written up documentation yet to explain how the code is structured and how to write new tests (it's on my list of things to do once the interface feels more settled, probably after the next round of changes) -- for now I'd suggest looking at the tests added in #5981 for examples to follow and reading the comments in the code.  And feel free to ping me with any specific questions in the meantime.",
      "created_at" : "2015-05-10T15:28:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-100655765",
      "id" : 100655765,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-10T15:28:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/100655765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : ">So if you do spend time debugging/patching the bitcoinj version, which actually also needs to be patched for #5966, that should be generally helpful I think.\r\n\r\nSo this is where I'll start this week, hopefully the problems aren't nearly as bad as they look. If along the way the documentation for the python code ends up getting written, I might switchover, but I think in either case it will be good to figure out what the Java tool does so we can port that code to Python eventually. I'll update here letting everyone know how it goes when I get a chance to look at it this week.",
      "created_at" : "2015-05-11T03:05:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-100751722",
      "id" : 100751722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-11T03:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/100751722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2230604?v=3",
         "events_url" : "https://api.github.com/users/faizkhan00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/faizkhan00/followers",
         "following_url" : "https://api.github.com/users/faizkhan00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/faizkhan00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/faizkhan00",
         "id" : 2230604,
         "login" : "faizkhan00",
         "organizations_url" : "https://api.github.com/users/faizkhan00/orgs",
         "received_events_url" : "https://api.github.com/users/faizkhan00/received_events",
         "repos_url" : "https://api.github.com/users/faizkhan00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/faizkhan00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/faizkhan00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/faizkhan00"
      }
   },
   {
      "body" : "So, I was able to get Bluematt's tool running against -master, seeing lots of failures; I'll start running them down but its certainly not the 'quick fix' i was expecting... my hope is after all is said and done i'll know what the tests are for , and it will make for an easy port onto @sdaftuar's framework. Interestingly, the commit on test-scripts/master (from Dec) just exits after the 87th block test... Not sure why that is yet, though.\r\n\r\nFull failure listing:\r\n\r\n```\r\norg.bitcoinj.core.VerificationException: Block had too many Signature Operations\r\norg.bitcoinj.core.VerificationException: Block larger than MAX_BLOCK_SIZE\r\norg.bitcoinj.core.VerificationException$CoinbaseScriptSizeOutOfRange: Coinbase script size out of range\r\norg.bitcoinj.core.VerificationException$CoinbaseScriptSizeOutOfRange: Coinbase script size out of range\r\norg.bitcoinj.core.VerificationException: Block had too many Signature Operations\r\norg.bitcoinj.core.VerificationException: Block had too many Signature Operations\r\norg.bitcoinj.core.VerificationException: Block had too many Signature Operations\r\norg.bitcoinj.core.VerificationException: First tx is not coinbase\r\norg.bitcoinj.core.VerificationException: Block had no transactions\r\norg.bitcoinj.core.VerificationException: Hash is higher than target: 8c271620ac810a0c7f4d82d91d04a34e2dd88158b77e865090433ee42b14c090 vs 7fffff0000000000000000000000000000000000000000000000000000000000\r\norg.bitcoinj.core.VerificationException: Block too far in future: 1431574959 vs 1431571359\r\norg.bitcoinj.core.VerificationException: Merkle hashes do not match: 0780c7e4e4499ecd763784f516db0bcb5fb10b0b696566d63fb496c73c117241 vs 5a3cef1e627ddb1a329f2838e7520876c7c57721d77930d54f7fde14890cd8ef\r\norg.bitcoinj.core.VerificationException: TX 2 is coinbase when it should not be.\r\norg.bitcoinj.core.VerificationException: Block had too many Signature Operations\r\norg.bitcoinj.core.VerificationException: Block had too many Signature Operations\r\n```",
      "created_at" : "2015-05-14T00:49:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-101867901",
      "id" : 101867901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-14T00:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101867901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2230604?v=3",
         "events_url" : "https://api.github.com/users/faizkhan00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/faizkhan00/followers",
         "following_url" : "https://api.github.com/users/faizkhan00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/faizkhan00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/faizkhan00",
         "id" : 2230604,
         "login" : "faizkhan00",
         "organizations_url" : "https://api.github.com/users/faizkhan00/orgs",
         "received_events_url" : "https://api.github.com/users/faizkhan00/received_events",
         "repos_url" : "https://api.github.com/users/faizkhan00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/faizkhan00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/faizkhan00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/faizkhan00"
      }
   },
   {
      "body" : "What do you mean by \"running against -master\"? Travis runs the tool runs against every bitcoin pull request on any branch.\r\n\r\nDo you mean that you've rebased his changes into upstream bitcoinj master?",
      "created_at" : "2015-05-14T01:22:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-101874806",
      "id" : 101874806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-14T01:22:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101874806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "```\r\nWhat do you mean by \"running against -master\"? \r\n```\r\n\r\nThats true, but, running the jar on the tip of `TheBlueMatt/test-scripts` means we have the latest code (which differs against the hashes in `native-comparisontool.mk`) and also offers a quick path to start making changes and building the tool from source (which might entail rebasing into upstream bitcoinj master actually- since I've been seeing errors while building the jarfile), while also staying on top of `bitcoin/bitcoin` changes in case new features break more tests.\r\n\r\nMy thought right now is, by getting what's on `TheBlueMatt/test-scripts/master` up-to-date with `bitcoin/bitcoin/master`, then we'll at least have a starting point to start seeing which tests can be ported over while still serving up travis builds.\r\n\r\nAnother thing, I'm not entirely sure if those Exceptions are part of the suite or actual regressions yet, because my thought is those would cause many more build failures across the pull-tester, but they don't seem to cause much of a problem as they're caught when thrown in the pull-tester.\r\n",
      "created_at" : "2015-05-14T05:42:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6119#issuecomment-101920924",
      "id" : 101920924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6119",
      "updated_at" : "2015-05-14T05:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/101920924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2230604?v=3",
         "events_url" : "https://api.github.com/users/faizkhan00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/faizkhan00/followers",
         "following_url" : "https://api.github.com/users/faizkhan00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/faizkhan00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/faizkhan00",
         "id" : 2230604,
         "login" : "faizkhan00",
         "organizations_url" : "https://api.github.com/users/faizkhan00/orgs",
         "received_events_url" : "https://api.github.com/users/faizkhan00/received_events",
         "repos_url" : "https://api.github.com/users/faizkhan00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/faizkhan00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/faizkhan00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/faizkhan00"
      }
   }
]
