[
   {
      "body" : "It could be that this is the issue solved in #5976",
      "created_at" : "2015-05-26T09:59:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105475174",
      "id" : 105475174,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-26T09:59:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105475174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Though that is the type of thing that #5976 should address, I don't think that can be what is going on here -- if this were resolved due to a block download timeout causing a stalling peer to get disconnected, then I think that would have appeared in your debug.log: \r\n\r\n```LogPrintf(\"Timeout downloading block %s from peer=%d, disconnecting\\n\", state.vBlocksInFlight.front().hash.ToString(), pto->id);```.  \r\nAlso, it seems implausible that a fully synced node would have so many blocks in flight that it would take 4 days to disconnect a stalling peer.  But I don't have an alternate guess to offer about what this could be either, puzzling.",
      "created_at" : "2015-05-26T14:11:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105537542",
      "id" : 105537542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-26T14:11:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105537542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "That message does indeed not appear in the log.\r\nAfter reconnecting four days of blocks, the node is back to running as normal.",
      "created_at" : "2015-05-26T15:47:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105572928",
      "id" : 105572928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-26T15:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105572928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "The same node, still running the same version, and not restarted since, has become stuck again since:\r\n\r\n    2015-05-27 10:01:15 UpdateTip: new best=000000000000000001643f7706f3dcbc3a386e4c1bfba852ff628d8024f875b6  height=358228  log2_work=82.845954  tx=6\r\n9953772  date=2015-05-27 10:00:38 progress=0.999999  cache=30.0MiB(3697tx)\r\n\r\nNo strange errors in the log - this time I have getpeerinfo though: https://download.visucore.com/tmp/tangerine_20150527_getpeerinfo_filtered.txt    No blocks in flight from any node, it appears.\r\n\r\nAnything I should try, to see if it gets going again?",
      "created_at" : "2015-05-27T15:20:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105954013",
      "id" : 105954013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T15:44:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105954013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Strange, not a single block in flight, but many nodes with headers beyond\nyour last synced block.\n",
      "created_at" : "2015-05-27T16:14:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105981842",
      "id" : 105981842,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T16:14:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105981842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can you also post a getchaintips result?\n",
      "created_at" : "2015-05-27T16:17:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105982690",
      "id" : 105982690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T16:17:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105982690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Sure: https://download.visucore.com/tmp/tangerine_20150527_getchaintips.json",
      "created_at" : "2015-05-27T16:48:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105990241",
      "id" : 105990241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T16:48:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105990241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Could you verify that the node doesn't have block 358229?  Perhaps:\r\n```bitcoin-cli getblock 00000000000000000a3ed9a4e25407518aa854f09fa1981adaae9455a91d1966```\r\n(I'd like to eliminate the possibility that somehow the node received it and it just failed to connect.)",
      "created_at" : "2015-05-27T17:08:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-105999406",
      "id" : 105999406,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T17:08:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/105999406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Result:\r\n\r\n    $ cli getblock 00000000000000000a3ed9a4e25407518aa854f09fa1981adaae9455a91d1966\r\n     error: {\"code\":-32603,\"message\":\"Can't read block from disk\"}\r\n\r\nIn the log:\r\n\r\n    2015-05-27 17:10:56 ERROR: ReadBlockFromDisk: OpenBlockFile failed for CBlockDiskPos(nFile=-1, nPos=0)\r\n\r\nI do have the block after it, #358230,\r\n\r\n    cli getblock 000000000000000001f942eb4bfa0aeccb6a14c268f4c72d5fff17270da771b9\r\n    {\r\n        \"hash\" : \"000000000000000001f942eb4bfa0aeccb6a14c268f4c72d5fff17270da771b9\",\r\n        \"confirmations\" : -1,\r\n        \"size\" : 749157,\r\n        \"height\" : 358230,\r\n",
      "created_at" : "2015-05-27T17:17:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-106001970",
      "id" : 106001970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T17:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/106001970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "If no one has any better ideas (this is a shot in the dark) maybe it would be helpful to know what happens if you bring down this node's network connection to force disconnection from all your peers, and then bring your network connection back up.  Perhaps that would give us a clue as to whether it could be an inconsistency with mapBlocksInFlight (ie if it is unable to sync even after disconnecting from all peers), or if it does sync, maybe that would be a hint that one of your peers is triggering an issue that disconnecting from them resolves?",
      "created_at" : "2015-05-27T19:39:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-106049207",
      "id" : 106049207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-27T19:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/106049207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "OK - I have rejected all external network access for the user the node runs as, as well as stopped Tor to make sure it doesn't communicate with nodes through the proxy. Now waiting for all connections to time out.\r\n",
      "created_at" : "2015-05-28T09:50:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-106252168",
      "id" : 106252168,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-28T09:50:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/106252168",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "getpeerinfo() is empty now. Still no block connection happens. So it is not a peer deliberately holding up anything.\r\nUnfortunately this bitcoind does not have detailed debugging symbols, so I'm not easily able to dump any internal data structures not exposed on RPC.\r\n\r\nGoing to reopen network connectivity...\r\n\r\n**Edit**: Reopening the network connectivity immediately triggered downloading of the block! It is connecting again. This indeed seems to indicate a problem in the blocks in flight administration, then, although the peerinfo never showed any blocks in flight!\r\n\r\n**Note:** this is a reasonably slow system; it may be a race condition, or an unhanded edge case when a node times out while it is sending the block to you.",
      "created_at" : "2015-05-28T10:28:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6188#issuecomment-106264760",
      "id" : 106264760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6188",
      "updated_at" : "2015-05-28T10:39:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/106264760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
