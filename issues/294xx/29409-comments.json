[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29409).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-02-08T13:54:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#issuecomment-1934172101",
      "id" : 1934172101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29409",
      "node_id" : "IC_kwDOABII585zSR_F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934172101/reactions"
      },
      "updated_at" : "2024-02-08T13:54:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934172101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503377237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503377237"
         }
      },
      "author_association" : "NONE",
      "body" : "Nit: compiles with `value.has_value()` here, which is clearer than `operator bool()`. But maybe you were intending to support types which don't have `.has_value()`?",
      "commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "created_at" : "2024-02-26T22:12:50Z",
      "diff_hunk" : "@@ -103,6 +197,65 @@ decltype(auto) CustomReadField(TypeList<UniValue>, Priority<1>, InvokeContext& i\n         value.read(std::string_view{data.begin(), data.size()});\n     });\n }\n+\n+//! Overload CustomBuildField and CustomReadField to serialize\n+//! UniValue::type_error exceptions as text strings.\n+template <typename Value, typename Output>\n+void CustomBuildField(TypeList<UniValue::type_error>, Priority<1>, InvokeContext& invoke_context,\n+                      Value&& value, Output&& output)\n+{\n+    BuildField(TypeList<std::string>(), invoke_context, output, std::string(value.what()));\n+}\n+\n+template <typename Input, typename ReadDest>\n+decltype(auto) CustomReadField(TypeList<UniValue::type_error>, Priority<1>, InvokeContext& invoke_context,\n+                               Input&& input, ReadDest&& read_dest)\n+{\n+    read_dest.construct(ReadField(TypeList<std::string>(), invoke_context, input, mp::ReadDestTemp<std::string>()));\n+}\n+\n+//! Overload CustomBuildField and CustomReadField to serialize util::Result\n+//! return values as common.capnp Result and ResultVoid structs\n+template <typename LocalType, typename Value, typename Output>\n+void CustomBuildField(TypeList<util::Result<LocalType>>, Priority<1>, InvokeContext& invoke_context, Value&& value,\n+                      Output&& output)\n+{\n+    auto result = output.init();\n+    if (value) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503377237",
      "id" : 1503377237,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585Zm7dV",
      "original_commit_id" : "eeb441ae7c12b5dafadd1c7315e5435731b3da6c",
      "original_line" : 224,
      "original_position" : 174,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : 174,
      "pull_request_review_id" : 1901881088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503377237/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T13:56:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503377237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/581308?v=4",
         "events_url" : "https://api.github.com/users/cbergqvist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cbergqvist/followers",
         "following_url" : "https://api.github.com/users/cbergqvist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cbergqvist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cbergqvist",
         "id" : 581308,
         "login" : "cbergqvist",
         "node_id" : "MDQ6VXNlcjU4MTMwOA==",
         "organizations_url" : "https://api.github.com/users/cbergqvist/orgs",
         "received_events_url" : "https://api.github.com/users/cbergqvist/received_events",
         "repos_url" : "https://api.github.com/users/cbergqvist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cbergqvist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cbergqvist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cbergqvist"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503832875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503832875"
         }
      },
      "author_association" : "NONE",
      "body" : "Builds fine without `#include <any>` using `g++` on Linux?",
      "commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "created_at" : "2024-02-27T08:33:47Z",
      "diff_hunk" : "@@ -0,0 +1,82 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_IPC_CAPNP_CHAIN_TYPES_H\n+#define BITCOIN_IPC_CAPNP_CHAIN_TYPES_H\n+\n+#include <ipc/capnp/chain.capnp.proxy.h>\n+#include <ipc/capnp/common.capnp.proxy-types.h>\n+#include <ipc/capnp/handler.capnp.proxy-types.h>\n+#include <interfaces/chain.h>\n+#include <policy/fees.h>\n+#include <rpc/server.h>\n+\n+#include <any>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503832875",
      "id" : 1503832875,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII585Zoqsr",
      "original_commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/chain-types.h",
      "position" : 15,
      "pull_request_review_id" : 1901881088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503832875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T13:56:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503832875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/581308?v=4",
         "events_url" : "https://api.github.com/users/cbergqvist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cbergqvist/followers",
         "following_url" : "https://api.github.com/users/cbergqvist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cbergqvist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cbergqvist",
         "id" : 581308,
         "login" : "cbergqvist",
         "node_id" : "MDQ6VXNlcjU4MTMwOA==",
         "organizations_url" : "https://api.github.com/users/cbergqvist/orgs",
         "received_events_url" : "https://api.github.com/users/cbergqvist/received_events",
         "repos_url" : "https://api.github.com/users/cbergqvist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cbergqvist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cbergqvist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cbergqvist"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1505998416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505998416"
         }
      },
      "author_association" : "NONE",
      "body" : "Should this say ...\"vector\\<unsigned char\\> *and* GCSFilter::ElementSet set elements.\"?",
      "commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "created_at" : "2024-02-28T13:51:28Z",
      "diff_hunk" : "@@ -256,6 +256,146 @@ decltype(auto) CustomReadField(TypeList<util::Result<LocalType>>, Priority<1>, I\n         }\n     });\n }\n+\n+//! Overload CustomBuildField and CustomReadField to serialize other types of\n+//! objects that have CustomBuildMessage and CustomReadMessage overloads.\n+//! Defining BuildMessage and ReadMessage overloads is simpler than defining\n+//! BuildField and ReadField overloads because these overloads can be normal\n+//! functions instead of template functions, and defined in a .cpp file instead\n+//! of a header.\n+template <typename LocalType, typename Value, typename Output>\n+void CustomBuildField(TypeList<LocalType>, Priority<2>, InvokeContext& invoke_context, Value&& value, Output&& output,\n+                      decltype(CustomBuildMessage(invoke_context, value, std::move(output.get())))* enable = nullptr)\n+{\n+    CustomBuildMessage(invoke_context, value, std::move(output.init()));\n+}\n+\n+template <typename LocalType, typename Reader, typename ReadDest>\n+decltype(auto) CustomReadField(TypeList<LocalType>, Priority<2>, InvokeContext& invoke_context, Reader&& reader,\n+                               ReadDest&& read_dest,\n+                               decltype(CustomReadMessage(invoke_context, reader.get(),\n+                                                          std::declval<LocalType&>()))* enable = nullptr)\n+{\n+    return read_dest.update([&](auto& value) { CustomReadMessage(invoke_context, reader.get(), value); });\n+}\n+\n+//! Helper for CustomPassField below. Call Accessor::get method if it has one,\n+//! otherwise return capnp::Void.\n+template <typename Accessor, typename Message>\n+decltype(auto) MaybeGet(Message&& message, decltype(Accessor::get(message))* enable = nullptr)\n+{\n+    return Accessor::get(message);\n+}\n+\n+template <typename Accessor>\n+::capnp::Void MaybeGet(...)\n+{\n+    return {};\n+}\n+\n+//! Helper for CustomPassField below. Call Accessor::init method if it has one,\n+//! otherwise do nothing.\n+template <typename Accessor, typename Message>\n+decltype(auto) MaybeInit(Message&& message, decltype(Accessor::get(message))* enable = nullptr)\n+{\n+    return Accessor::init(message);\n+}\n+\n+template <typename Accessor>\n+::capnp::Void MaybeInit(...)\n+{\n+    return {};\n+}\n+\n+//! Overload CustomPassField to serialize types of objects that have\n+//! CustomPassMessage overloads. Defining PassMessage overloads is simpler than\n+//! defining PassField overloads, because PassMessage overloads can be normal\n+//! functions instead of template functions, and defined in a .cpp file instead\n+//! of a header.\n+//!\n+//! Defining a PassField or PassMessage overload is useful for input/output\n+//! parameters. If an overload is not defined these parameters will just be\n+//! deserialized on the server side with ReadField into a temporary variable,\n+//! then the server method will be called passing the temporary variable as a\n+//! parameter, then the temporary variable will be serialized and sent back to\n+//! the client with BuildField. But if a PassField or PassMessage overload is\n+//! defined, the overload is called with a callback to invoke and pass\n+//! parameters to the server side function, and run arbitrary code before and\n+//! after invoking the function.\n+template <typename Accessor, typename... LocalTypes, typename ServerContext, typename Fn, typename... Args>\n+auto CustomPassField(TypeList<LocalTypes...>, ServerContext& server_context, Fn&& fn, Args&&... args)\n+    -> decltype(CustomPassMessage(server_context, MaybeGet<Accessor>(server_context.call_context.getParams()),\n+                                  MaybeGet<Accessor>(server_context.call_context.getResults()), nullptr))\n+{\n+    CustomPassMessage(server_context, MaybeGet<Accessor>(server_context.call_context.getParams()),\n+                      MaybeInit<Accessor>(server_context.call_context.getResults()),\n+                      [&](LocalTypes... param) { fn.invoke(server_context, std::forward<Args>(args)..., param...); });\n+}\n+\n+//! Generic ::capnp::Data field builder for any class that a Span can be\n+//! constructed from, particularly BaseHash and base_blob classes and\n+//! subclasses. It's also used to serialize vector<unsigned char>\n+//! GCSFilter::ElementSet set elements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1505998416",
      "id" : 1505998416,
      "line" : 338,
      "node_id" : "PRRC_kwDOABII585Zw7ZQ",
      "original_commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "original_line" : 338,
      "original_position" : 83,
      "original_start_line" : 337,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : 83,
      "pull_request_review_id" : 1901881088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505998416/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 337,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T13:56:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505998416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/581308?v=4",
         "events_url" : "https://api.github.com/users/cbergqvist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cbergqvist/followers",
         "following_url" : "https://api.github.com/users/cbergqvist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cbergqvist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cbergqvist",
         "id" : 581308,
         "login" : "cbergqvist",
         "node_id" : "MDQ6VXNlcjU4MTMwOA==",
         "organizations_url" : "https://api.github.com/users/cbergqvist/orgs",
         "received_events_url" : "https://api.github.com/users/cbergqvist/received_events",
         "repos_url" : "https://api.github.com/users/cbergqvist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cbergqvist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cbergqvist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cbergqvist"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1506146321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506146321"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503377237\r\n\r\n> Nit: compiles with `value.has_value()` here, which is clearer than `operator bool()`. But maybe you were intending to support types which don't have `.has_value()`?\r\n\r\nI mostly just don't agree it is clearer and I like the \"if value, use value\" pattern from c++ and python. I think it removes noise and makes code easier to read, also makes it easier for code to evolve, for example updating code using a plain pointer to switch to smart pointer.\r\n\r\nIn this case I am looking forward to this code working with `ResultPtr` from #26022, where operator bool and has_value have different meanings. Operator bool in that case is true if a pointer is contained AND the pointer value is not null. has_value is true in that case if a pointer is contained, whether or not it is null. After #26022, this code would look something like:\r\n\r\n```c++\r\nif (value) {\r\n     BuildField(..., ValueAccessor, *value);\r\n}\r\nif (!value.has_value()) {\r\n    BuildField(..., FailureAccessor, value.GetFailure());\r\n}\r\nBuildField(..., ErrorsAccessor, value.GetErrors());\r\nBuildField(..., WarningsAccessor, value.GetWarnings());\r\n```\r\n\r\nAnd if `value` is a `ResultPtr` the first line would need to be `if (value)` not `if value.has_value()` to work.",
      "commit_id" : "41831abe06d388ed18b5dbed739bc8fe76457f86",
      "created_at" : "2024-02-28T15:25:51Z",
      "diff_hunk" : "@@ -103,6 +197,65 @@ decltype(auto) CustomReadField(TypeList<UniValue>, Priority<1>, InvokeContext& i\n         value.read(std::string_view{data.begin(), data.size()});\n     });\n }\n+\n+//! Overload CustomBuildField and CustomReadField to serialize\n+//! UniValue::type_error exceptions as text strings.\n+template <typename Value, typename Output>\n+void CustomBuildField(TypeList<UniValue::type_error>, Priority<1>, InvokeContext& invoke_context,\n+                      Value&& value, Output&& output)\n+{\n+    BuildField(TypeList<std::string>(), invoke_context, output, std::string(value.what()));\n+}\n+\n+template <typename Input, typename ReadDest>\n+decltype(auto) CustomReadField(TypeList<UniValue::type_error>, Priority<1>, InvokeContext& invoke_context,\n+                               Input&& input, ReadDest&& read_dest)\n+{\n+    read_dest.construct(ReadField(TypeList<std::string>(), invoke_context, input, mp::ReadDestTemp<std::string>()));\n+}\n+\n+//! Overload CustomBuildField and CustomReadField to serialize util::Result\n+//! return values as common.capnp Result and ResultVoid structs\n+template <typename LocalType, typename Value, typename Output>\n+void CustomBuildField(TypeList<util::Result<LocalType>>, Priority<1>, InvokeContext& invoke_context, Value&& value,\n+                      Output&& output)\n+{\n+    auto result = output.init();\n+    if (value) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1506146321",
      "id" : 1506146321,
      "in_reply_to_id" : 1503377237,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585ZxfgR",
      "original_commit_id" : "eeb441ae7c12b5dafadd1c7315e5435731b3da6c",
      "original_line" : 224,
      "original_position" : 174,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : 174,
      "pull_request_review_id" : 1906565161,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506146321/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:14:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506146321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1506146538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506146538"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503832875\r\n\r\n> Builds fine without `#include <any>` using `g++` on Linux?\r\n\r\nGood catch, I think this must have been left over from a previous version of this file. Removed now.",
      "commit_id" : "41831abe06d388ed18b5dbed739bc8fe76457f86",
      "created_at" : "2024-02-28T15:26:01Z",
      "diff_hunk" : "@@ -0,0 +1,82 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_IPC_CAPNP_CHAIN_TYPES_H\n+#define BITCOIN_IPC_CAPNP_CHAIN_TYPES_H\n+\n+#include <ipc/capnp/chain.capnp.proxy.h>\n+#include <ipc/capnp/common.capnp.proxy-types.h>\n+#include <ipc/capnp/handler.capnp.proxy-types.h>\n+#include <interfaces/chain.h>\n+#include <policy/fees.h>\n+#include <rpc/server.h>\n+\n+#include <any>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1506146538",
      "id" : 1506146538,
      "in_reply_to_id" : 1503832875,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Zxfjq",
      "original_commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/chain-types.h",
      "position" : null,
      "pull_request_review_id" : 1906565161,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506146538/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506146538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1506153142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506153142"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1505998416\r\n\r\n> Should this say ...\"vector<unsigned char> _and_ GCSFilter::ElementSet set elements.\"?\r\n\r\nI think it's technically correct because the the vectors _are_ the set elements but I changed the comment to make it clearer.",
      "commit_id" : "41831abe06d388ed18b5dbed739bc8fe76457f86",
      "created_at" : "2024-02-28T15:30:02Z",
      "diff_hunk" : "@@ -256,6 +256,146 @@ decltype(auto) CustomReadField(TypeList<util::Result<LocalType>>, Priority<1>, I\n         }\n     });\n }\n+\n+//! Overload CustomBuildField and CustomReadField to serialize other types of\n+//! objects that have CustomBuildMessage and CustomReadMessage overloads.\n+//! Defining BuildMessage and ReadMessage overloads is simpler than defining\n+//! BuildField and ReadField overloads because these overloads can be normal\n+//! functions instead of template functions, and defined in a .cpp file instead\n+//! of a header.\n+template <typename LocalType, typename Value, typename Output>\n+void CustomBuildField(TypeList<LocalType>, Priority<2>, InvokeContext& invoke_context, Value&& value, Output&& output,\n+                      decltype(CustomBuildMessage(invoke_context, value, std::move(output.get())))* enable = nullptr)\n+{\n+    CustomBuildMessage(invoke_context, value, std::move(output.init()));\n+}\n+\n+template <typename LocalType, typename Reader, typename ReadDest>\n+decltype(auto) CustomReadField(TypeList<LocalType>, Priority<2>, InvokeContext& invoke_context, Reader&& reader,\n+                               ReadDest&& read_dest,\n+                               decltype(CustomReadMessage(invoke_context, reader.get(),\n+                                                          std::declval<LocalType&>()))* enable = nullptr)\n+{\n+    return read_dest.update([&](auto& value) { CustomReadMessage(invoke_context, reader.get(), value); });\n+}\n+\n+//! Helper for CustomPassField below. Call Accessor::get method if it has one,\n+//! otherwise return capnp::Void.\n+template <typename Accessor, typename Message>\n+decltype(auto) MaybeGet(Message&& message, decltype(Accessor::get(message))* enable = nullptr)\n+{\n+    return Accessor::get(message);\n+}\n+\n+template <typename Accessor>\n+::capnp::Void MaybeGet(...)\n+{\n+    return {};\n+}\n+\n+//! Helper for CustomPassField below. Call Accessor::init method if it has one,\n+//! otherwise do nothing.\n+template <typename Accessor, typename Message>\n+decltype(auto) MaybeInit(Message&& message, decltype(Accessor::get(message))* enable = nullptr)\n+{\n+    return Accessor::init(message);\n+}\n+\n+template <typename Accessor>\n+::capnp::Void MaybeInit(...)\n+{\n+    return {};\n+}\n+\n+//! Overload CustomPassField to serialize types of objects that have\n+//! CustomPassMessage overloads. Defining PassMessage overloads is simpler than\n+//! defining PassField overloads, because PassMessage overloads can be normal\n+//! functions instead of template functions, and defined in a .cpp file instead\n+//! of a header.\n+//!\n+//! Defining a PassField or PassMessage overload is useful for input/output\n+//! parameters. If an overload is not defined these parameters will just be\n+//! deserialized on the server side with ReadField into a temporary variable,\n+//! then the server method will be called passing the temporary variable as a\n+//! parameter, then the temporary variable will be serialized and sent back to\n+//! the client with BuildField. But if a PassField or PassMessage overload is\n+//! defined, the overload is called with a callback to invoke and pass\n+//! parameters to the server side function, and run arbitrary code before and\n+//! after invoking the function.\n+template <typename Accessor, typename... LocalTypes, typename ServerContext, typename Fn, typename... Args>\n+auto CustomPassField(TypeList<LocalTypes...>, ServerContext& server_context, Fn&& fn, Args&&... args)\n+    -> decltype(CustomPassMessage(server_context, MaybeGet<Accessor>(server_context.call_context.getParams()),\n+                                  MaybeGet<Accessor>(server_context.call_context.getResults()), nullptr))\n+{\n+    CustomPassMessage(server_context, MaybeGet<Accessor>(server_context.call_context.getParams()),\n+                      MaybeInit<Accessor>(server_context.call_context.getResults()),\n+                      [&](LocalTypes... param) { fn.invoke(server_context, std::forward<Args>(args)..., param...); });\n+}\n+\n+//! Generic ::capnp::Data field builder for any class that a Span can be\n+//! constructed from, particularly BaseHash and base_blob classes and\n+//! subclasses. It's also used to serialize vector<unsigned char>\n+//! GCSFilter::ElementSet set elements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1506153142",
      "id" : 1506153142,
      "in_reply_to_id" : 1505998416,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZxhK2",
      "original_commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "original_line" : 338,
      "original_position" : 83,
      "original_start_line" : 337,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : null,
      "pull_request_review_id" : 1906565161,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506153142/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T16:14:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1506153142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1515411394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1515411394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "i think `Wrap` could be parameterized with any `CAddress` version.\r\ne.g useful if someone wanna test the native crypto noise framework between bitcoin processes.\r\nor in the future experiment with better crypto-primitives for bip324.",
      "commit_id" : "41831abe06d388ed18b5dbed739bc8fe76457f86",
      "created_at" : "2024-03-07T02:54:34Z",
      "diff_hunk" : "@@ -6,16 +6,63 @@\n #define BITCOIN_IPC_CAPNP_COMMON_TYPES_H\n \n #include <clientversion.h>\n+#include <protocol.h>\n #include <streams.h>\n #include <univalue.h>\n+#include <util/result.h>\n+#include <util/translation.h>\n \n #include <cstddef>\n #include <mp/proxy-types.h>\n #include <type_traits>\n+#include <unordered_set>\n #include <utility>\n \n namespace ipc {\n namespace capnp {\n+//! Convert kj::ArrayPtr to base_blob.\n+template <typename T>\n+inline T ToBlob(const kj::ArrayPtr<const kj::byte>& array)\n+{\n+    return T({array.begin(), array.begin() + array.size()});\n+}\n+\n+//! Convert base_blob to kj::ArrayPtr.\n+template <typename T>\n+inline kj::ArrayPtr<const kj::byte> ToArray(const T& blob)\n+{\n+    return {reinterpret_cast<const kj::byte*>(blob.data()), blob.size()};\n+}\n+\n+//! Construct a ParamStream wrapping data stream with serialization parameters\n+//! needed to pass transaction and address objects between bitcoin processes.\n+template<typename S>\n+auto Wrap(S& s)\n+{\n+    return ParamsStream{s, TX_WITH_WITNESS, CAddress::V2_NETWORK};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1515411394",
      "id" : 1515411394,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII585aU1fC",
      "original_commit_id" : "eeb441ae7c12b5dafadd1c7315e5435731b3da6c",
      "original_line" : 42,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : 37,
      "pull_request_review_id" : 1921347149,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1515411394/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-07T02:57:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1515411394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   }
]
