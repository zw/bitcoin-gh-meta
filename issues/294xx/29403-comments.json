[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29403).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1936428779) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1871254500) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-02-07T13:42:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932079274",
      "id" : 1932079274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
      "node_id" : "IC_kwDOABII585zKTCq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932079274/reactions"
      },
      "updated_at" : "2024-02-09T18:41:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932079274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481506563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, feel free to ignore: Any reason to add `__func__` to this log, when none of the other logs have it here? If someone is interested in the exact source location, they can enable the corresponding log option. If this is needed for context, it could make more sense to clarify the log message itself, so that it is unique and clear without requiring the source code as context.\r\n",
      "commit_id" : "69c5bb5c3ad3da508541a3ef6c29a0bad21f2fc0",
      "created_at" : "2024-02-07T13:50:54Z",
      "diff_hunk" : "@@ -2395,15 +2395,37 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             WalletLogPrintf(\"%s called with IsMine address, NOT SUPPORTED. Please report this bug! %s\\n\", __func__, PACKAGE_BUGREPORT);\n             return false;\n         }\n+\n+        WalletBatch batch(GetDatabase());\n+        if (!batch.TxnBegin()) {\n+            WalletLogPrintf(\"Error: cannot create db txn for address book entry removal\\n\");\n+            return false;\n+        }\n+\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {\n+            WalletLogPrintf(\"%s error erasing purpose/name\\n\", __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481506563",
      "id" : 1481506563,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YTf8D",
      "original_commit_id" : "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "original_line" : 2413,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1867863458,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T13:50:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481525685"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481525685"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Any reason to add `__func__` to this log, when none of the other logs have it here?\r\n\r\nNot really. It is just a bad habit. I pulled 9a4e1f5 from #26836 because it is required for this changes. Will change it there.",
      "commit_id" : "69c5bb5c3ad3da508541a3ef6c29a0bad21f2fc0",
      "created_at" : "2024-02-07T14:04:31Z",
      "diff_hunk" : "@@ -2395,15 +2395,37 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             WalletLogPrintf(\"%s called with IsMine address, NOT SUPPORTED. Please report this bug! %s\\n\", __func__, PACKAGE_BUGREPORT);\n             return false;\n         }\n+\n+        WalletBatch batch(GetDatabase());\n+        if (!batch.TxnBegin()) {\n+            WalletLogPrintf(\"Error: cannot create db txn for address book entry removal\\n\");\n+            return false;\n+        }\n+\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {\n+            WalletLogPrintf(\"%s error erasing purpose/name\\n\", __func__);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481525685",
      "id" : 1481525685,
      "in_reply_to_id" : 1481506563,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YTkm1",
      "original_commit_id" : "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "original_line" : 2413,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1867895148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481525685/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T14:04:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481525685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Updated per feedback. Thanks Marko.",
      "created_at" : "2024-02-07T14:16:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932141334",
      "id" : 1932141334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
      "node_id" : "IC_kwDOABII585zKiMW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932141334/reactions"
      },
      "updated_at" : "2024-02-07T14:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932141334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21321086502</sub>",
      "created_at" : "2024-02-07T14:18:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932145648",
      "id" : 1932145648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
      "node_id" : "IC_kwDOABII585zKjPw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932145648/reactions"
      },
      "updated_at" : "2024-02-07T14:18:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932145648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Green CI. Ready.",
      "created_at" : "2024-02-07T15:21:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932273984",
      "id" : 1932273984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
      "node_id" : "IC_kwDOABII585zLClA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932273984/reactions"
      },
      "updated_at" : "2024-02-07T15:21:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932273984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481997602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481997602"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 2d770f6ae88d9ee6f1775e011f241274059fe275 \"wallet: clean redundancies in DelAddressBook\"\r\n\r\nI'd prefer to have these occur separately so that a distinct error can be logged for each, that way we can discover which operation failed.",
      "commit_id" : "69c5bb5c3ad3da508541a3ef6c29a0bad21f2fc0",
      "created_at" : "2024-02-07T19:43:17Z",
      "diff_hunk" : "@@ -2396,14 +2397,24 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             return false;\n         }\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481997602",
      "id" : 1481997602,
      "line" : 2412,
      "node_id" : "PRRC_kwDOABII585YVX0i",
      "original_commit_id" : "2d770f6ae88d9ee6f1775e011f241274059fe275",
      "original_line" : 2406,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 28,
      "pull_request_review_id" : 1868639990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481997602/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T19:46:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481997602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482000338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482000338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 0dba0b6de03c0c79bb09296b913729ec8eb75aca \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nInstead of `assert`ing, I would prefer if this did `if (!Assume(activeTxn)) return false` so we didn't cause nodes to crash if a transaction were missing for whatever reason. `Assume` should still catch this for developers.",
      "commit_id" : "69c5bb5c3ad3da508541a3ef6c29a0bad21f2fc0",
      "created_at" : "2024-02-07T19:46:01Z",
      "diff_hunk" : "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482000338",
      "id" : 1482000338,
      "line" : 890,
      "node_id" : "PRRC_kwDOABII585YVYfS",
      "original_commit_id" : "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "original_line" : 890,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 1868639990,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482000338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T19:46:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482000338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482126505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482126505"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I'd prefer to have these occur separately so that a distinct error can be logged for each, that way we can discover which operation failed.\r\n\r\nSure. Also decoupled it in #26836.",
      "commit_id" : "0fd7b0dafa980a5dbcee8658d18a83f4eff57085",
      "created_at" : "2024-02-07T21:35:29Z",
      "diff_hunk" : "@@ -2396,14 +2397,24 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             return false;\n         }\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482126505",
      "id" : 1482126505,
      "in_reply_to_id" : 1481997602,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YV3Sp",
      "original_commit_id" : "2d770f6ae88d9ee6f1775e011f241274059fe275",
      "original_line" : 2406,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1868847059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482126505/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T22:38:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482126505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482179514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482179514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Instead of `assert`ing, I would prefer if this did `if (!Assume(activeTxn)) return false` so we didn't cause nodes to crash if a transaction were missing for whatever reason. `Assume` should still catch this for developers.\r\n\r\nThat would be risky in terms of consistency. `BerkeleyBatch::ErasePrefix` traverses the entire db, reading entries one by one, erasing the ones that match the key prefix. If we don't execute this function within a txn context, it's possible that certain records are removed while others remain due to an internal failure during the procedure.\r\n\r\nCurrently, the only function that uses `ErasePrefix()` is `WalletBatch::EraseAddressData`, which is exclusively called from `CWallet::DelAddressBook`, which is modified in the first two commits (thats one of the reasons behind taking those commits from #26836). This prevents any crashing risk.",
      "commit_id" : "0fd7b0dafa980a5dbcee8658d18a83f4eff57085",
      "created_at" : "2024-02-07T22:36:08Z",
      "diff_hunk" : "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482179514",
      "id" : 1482179514,
      "in_reply_to_id" : 1482000338,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YWEO6",
      "original_commit_id" : "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "original_line" : 890,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1868847059,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482179514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T22:39:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482179514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482191573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482191573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure, that's why I suggest using `Assume`, and `return false` if there is no `activeTxn`. The callers of this should already be checking the return value to know whether the records were actually erased from the database.",
      "commit_id" : "0fd7b0dafa980a5dbcee8658d18a83f4eff57085",
      "created_at" : "2024-02-07T22:52:30Z",
      "diff_hunk" : "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482191573",
      "id" : 1482191573,
      "in_reply_to_id" : 1482000338,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YWHLV",
      "original_commit_id" : "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "original_line" : 890,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1868946380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482191573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-07T22:52:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482191573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483038171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483038171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Sure, that's why I suggest using `Assume`, and `return false` if there is no `activeTxn`. The callers of this should already be checking the return value to know whether the records were actually erased from the database.\r\n\r\nah, I completely skipped the `return false` last night.. sorry. All good, pushed.",
      "commit_id" : "784034f8a17d46de9eab7de6fdec673a3a3d79d8",
      "created_at" : "2024-02-08T14:13:45Z",
      "diff_hunk" : "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483038171",
      "id" : 1483038171,
      "in_reply_to_id" : 1482000338,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YZV3b",
      "original_commit_id" : "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "original_line" : 890,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1870328563,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483038171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-08T14:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483038171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514110"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 523525707742fc620039cd67e8f1437f7f613a01 \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nnit: Could use `RunWithinTxn()`.",
      "commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "created_at" : "2024-02-08T19:45:10Z",
      "diff_hunk" : "@@ -228,6 +228,39 @@ BOOST_AUTO_TEST_CASE(db_availability_after_write_error)\n     }\n }\n \n+// Verify 'ErasePrefix' functionality using db keys similar to the ones used by the wallet.\n+// Keys are in the form of std::pair<TYPE, ENTRY_ID>\n+BOOST_AUTO_TEST_CASE(erase_prefix)\n+{\n+    const std::string key = \"key\";\n+    const std::string key2 = \"key2\";\n+    const std::string value = \"value\";\n+    const std::string value2 = \"value_2\";\n+    auto make_key = [](std::string type, std::string id) { return std::make_pair(type, id); };\n+\n+    for (const auto& database : TestDatabases(m_path_root)) {\n+        std::unique_ptr<DatabaseBatch> batch = database->MakeBatch();\n+\n+        // Write two entries with the same key type prefix, a third one with a different prefix\n+        // and a fourth one with the type-id values inverted\n+        BOOST_CHECK(batch->Write(make_key(key, value), value));\n+        BOOST_CHECK(batch->Write(make_key(key, value2), value2));\n+        BOOST_CHECK(batch->Write(make_key(key2, value), value));\n+        BOOST_CHECK(batch->Write(make_key(value, key), value));\n+\n+        // Erase the ones with the same prefix and verify result\n+        BOOST_CHECK(batch->TxnBegin());\n+        BOOST_CHECK(batch->ErasePrefix(DataStream() << key));\n+        BOOST_CHECK(batch->TxnCommit());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514110",
      "id" : 1483514110,
      "line" : 254,
      "node_id" : "PRRC_kwDOABII585YbKD-",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 254,
      "original_position" : 27,
      "original_start_line" : 252,
      "path" : "src/wallet/test/db_tests.cpp",
      "position" : 27,
      "pull_request_review_id" : 1871128813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 252,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-08T19:47:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514234"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514234"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 523525707742fc620039cd67e8f1437f7f613a01 \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nnit: Could use `RunWithinTxn()`.",
      "commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "created_at" : "2024-02-08T19:45:19Z",
      "diff_hunk" : "@@ -447,7 +447,9 @@ BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n             BOOST_CHECK_EQUAL_COLLECTIONS(requests.begin(), requests.end(), std::begin(erequests), std::end(erequests));\n             WalletBatch batch{wallet->GetDatabase()};\n             BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), false));\n+            BOOST_CHECK(batch.TxnBegin()); // bdb requirement (more info at BerkeleyBatch::ErasePrefix)\n             BOOST_CHECK(batch.EraseAddressData(ScriptHash()));\n+            BOOST_CHECK(batch.TxnCommit());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514234",
      "id" : 1483514234,
      "line" : 452,
      "node_id" : "PRRC_kwDOABII585YbKF6",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 452,
      "original_position" : 6,
      "original_start_line" : 450,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 6,
      "pull_request_review_id" : 1871128813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514234/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 450,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-08T19:47:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 523525707742fc620039cd67e8f1437f7f613a01 \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nI think it would be relevant to mention that BDB returns errors on `del()` if it is not in a transaction.",
      "commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "created_at" : "2024-02-08T19:45:53Z",
      "diff_hunk" : "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809",
      "id" : 1483514809,
      "line" : 892,
      "node_id" : "PRRC_kwDOABII585YbKO5",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 892,
      "original_position" : 7,
      "original_start_line" : 890,
      "path" : "src/wallet/bdb.cpp",
      "position" : 7,
      "pull_request_review_id" : 1871128813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514809/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 890,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-08T19:47:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483515740"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483515740"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 757d6516db56e2732ea77624e66025446cb816a4 \"wallet: simplify EraseRecords by using 'ErasePrefix'\"\r\n\r\nThis overload feels unnecessary given that there are only 2 places this function is really used.",
      "commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "created_at" : "2024-02-08T19:46:53Z",
      "diff_hunk" : "@@ -1337,6 +1336,12 @@ bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, con\n     return true;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483515740",
      "id" : 1483515740,
      "line" : 1339,
      "node_id" : "PRRC_kwDOABII585YbKdc",
      "original_commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "original_line" : 1339,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 15,
      "pull_request_review_id" : 1871128813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483515740/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-08T19:47:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483515740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483516605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483516605"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 757d6516db56e2732ea77624e66025446cb816a4 \"wallet: simplify EraseRecords by using 'ErasePrefix'\"\r\n\r\nThis could be done in the commit introducing `RunWithinTxn()` rather than changing it in a later commit.",
      "commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "created_at" : "2024-02-08T19:47:43Z",
      "diff_hunk" : "@@ -1314,9 +1314,8 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n-bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)\n+static bool RunWithinTxn(WalletBatch& batch, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483516605",
      "id" : 1483516605,
      "line" : 1317,
      "node_id" : "PRRC_kwDOABII585YbKq9",
      "original_commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "original_line" : 1317,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 5,
      "pull_request_review_id" : 1871128813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483516605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-08T19:47:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483516605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483579553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483579553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think it would be relevant to mention that BDB returns errors on del() if it is not in a transaction.\r\n\r\nSure, we could mention that the read-write operation is currently disallowed by our current bdb configurations.\r\n\r\nStill, JFYI, I fixed it locally by subdividing the read-write operations. However, since we currently ensure that all callers start a transaction, and this division adds an extra loop over the matching entries (see https://github.com/furszy/bitcoin-core/commit/4e7b5c02837b6b3bc3d1ee81a52e801996f763b7), I didn't see it as worth pushing it.\r\n\r\n",
      "commit_id" : "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-08T20:55:08Z",
      "diff_hunk" : "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483579553",
      "id" : 1483579553,
      "in_reply_to_id" : 1483514809,
      "line" : 892,
      "node_id" : "PRRC_kwDOABII585YbaCh",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 892,
      "original_position" : 7,
      "original_start_line" : 890,
      "path" : "src/wallet/bdb.cpp",
      "position" : 7,
      "pull_request_review_id" : 1871240281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483579553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 890,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T12:12:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483579553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483587941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483587941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> In [5235257](https://github.com/bitcoin/bitcoin/commit/523525707742fc620039cd67e8f1437f7f613a01) \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n> \r\n> nit: Could use `RunWithinTxn()`.\r\n\r\nI did not used it because it needs `walletdb.h` dependency (`RunWithinTxn` provides access to `WalletBatch`). And this tests (`db_tests.cpp`) run on a lower level, using `DatabaseBatch`.",
      "commit_id" : "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-08T21:04:18Z",
      "diff_hunk" : "@@ -228,6 +228,39 @@ BOOST_AUTO_TEST_CASE(db_availability_after_write_error)\n     }\n }\n \n+// Verify 'ErasePrefix' functionality using db keys similar to the ones used by the wallet.\n+// Keys are in the form of std::pair<TYPE, ENTRY_ID>\n+BOOST_AUTO_TEST_CASE(erase_prefix)\n+{\n+    const std::string key = \"key\";\n+    const std::string key2 = \"key2\";\n+    const std::string value = \"value\";\n+    const std::string value2 = \"value_2\";\n+    auto make_key = [](std::string type, std::string id) { return std::make_pair(type, id); };\n+\n+    for (const auto& database : TestDatabases(m_path_root)) {\n+        std::unique_ptr<DatabaseBatch> batch = database->MakeBatch();\n+\n+        // Write two entries with the same key type prefix, a third one with a different prefix\n+        // and a fourth one with the type-id values inverted\n+        BOOST_CHECK(batch->Write(make_key(key, value), value));\n+        BOOST_CHECK(batch->Write(make_key(key, value2), value2));\n+        BOOST_CHECK(batch->Write(make_key(key2, value), value));\n+        BOOST_CHECK(batch->Write(make_key(value, key), value));\n+\n+        // Erase the ones with the same prefix and verify result\n+        BOOST_CHECK(batch->TxnBegin());\n+        BOOST_CHECK(batch->ErasePrefix(DataStream() << key));\n+        BOOST_CHECK(batch->TxnCommit());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483587941",
      "id" : 1483587941,
      "in_reply_to_id" : 1483514110,
      "line" : 254,
      "node_id" : "PRRC_kwDOABII585YbcFl",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 254,
      "original_position" : 27,
      "original_start_line" : 252,
      "path" : "src/wallet/test/db_tests.cpp",
      "position" : 27,
      "pull_request_review_id" : 1871240281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483587941/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 252,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T12:12:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483587941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483588570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483588570"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: db, introduce 'RunWithinTxn()' helper function\" (a8a24cb20974cb8eaec8cb438f6b22489719d605)\r\n\r\nMaybe use string_view instead of string, since in most cases this is just passed a string literal, so no need to create a full string object",
      "commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "created_at" : "2024-02-08T21:04:58Z",
      "diff_hunk" : "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483588570",
      "id" : 1483588570,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YbcPa",
      "original_commit_id" : "a8a24cb20974cb8eaec8cb438f6b22489719d605",
      "original_line" : 1317,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1871254500,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483588570/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-08T21:05:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483588570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483617478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483617478"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> In [757d651](https://github.com/bitcoin/bitcoin/commit/757d6516db56e2732ea77624e66025446cb816a4) \"wallet: simplify EraseRecords by using 'ErasePrefix'\"\r\n> \r\n> This overload feels unnecessary given that there are only 2 places this function is really used.\r\n\r\nThe idea is to use this function as a top-level wrapper for wallet functions and scope the other function for internal `walletdb.cpp` usage mostly/only. This approach avoids creating `WalletBatch` objects across the sources and makes use of the error-handling code in the `WalletBatch` destructor.\r\nFunctions such as `DescriptorScriptPubKeyMan::TopUp`, the two `CWallet::SetupDescriptorScriptPubKeyMans`, and the final state of the batched migration process can utilize this overload in a follow-up.",
      "commit_id" : "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-08T21:35:49Z",
      "diff_hunk" : "@@ -1337,6 +1336,12 @@ bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, con\n     return true;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483617478",
      "id" : 1483617478,
      "in_reply_to_id" : 1483515740,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YbjTG",
      "original_commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "original_line" : 1339,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1871240281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483617478/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T12:12:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483617478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483619574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483619574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> This could be done in the commit introducing `RunWithinTxn()` rather than changing it in a later commit.\r\n\r\nThis is merely an organizational discussion, but.. I'm not a big fan of introducing a function overload in a commit that does not utilizes it. Yet, if you have a strong opinion about it, I could move this to the first commit. np.",
      "commit_id" : "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-08T21:37:16Z",
      "diff_hunk" : "@@ -1314,9 +1314,8 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n-bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)\n+static bool RunWithinTxn(WalletBatch& batch, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483619574",
      "id" : 1483619574,
      "in_reply_to_id" : 1483516605,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Ybjz2",
      "original_commit_id" : "757d6516db56e2732ea77624e66025446cb816a4",
      "original_line" : 1317,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1871240281,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483619574/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T12:12:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483619574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484242585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242585"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure!, done.",
      "commit_id" : "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-09T12:13:19Z",
      "diff_hunk" : "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484242585",
      "id" : 1484242585,
      "in_reply_to_id" : 1483588570,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Yd76Z",
      "original_commit_id" : "a8a24cb20974cb8eaec8cb438f6b22489719d605",
      "original_line" : 1317,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 1872247633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242585/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T12:13:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484242772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242772"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure",
      "commit_id" : "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-09T12:13:33Z",
      "diff_hunk" : "@@ -447,7 +447,9 @@ BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n             BOOST_CHECK_EQUAL_COLLECTIONS(requests.begin(), requests.end(), std::begin(erequests), std::end(erequests));\n             WalletBatch batch{wallet->GetDatabase()};\n             BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), false));\n+            BOOST_CHECK(batch.TxnBegin()); // bdb requirement (more info at BerkeleyBatch::ErasePrefix)\n             BOOST_CHECK(batch.EraseAddressData(ScriptHash()));\n+            BOOST_CHECK(batch.TxnCommit());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484242772",
      "id" : 1484242772,
      "in_reply_to_id" : 1483514234,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Yd79U",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 452,
      "original_position" : 6,
      "original_start_line" : 450,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1872247969,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T12:13:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "created_at" : "2024-02-09T18:41:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1936428779",
      "id" : 1936428779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
      "node_id" : "IC_kwDOABII585za47r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936428779/reactions"
      },
      "updated_at" : "2024-02-09T18:41:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936428779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484707431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484707431"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: db, introduce 'RunWithinTxn()' helper function\" (b6dcfca8f77f32cb1f41230fb71bab6666252041)\r\n\r\nI think it's bad for debugging that this function inconsistently logs errors when an operation fails. For example it seems like there is no error if the new eraserecords function fails? It would be better to add `LogPrint(BCLog::WALLETDB, \"Error: %s failed\\n\", process_desc);` here.\r\n\r\nI understand that in the future there may be cases where we may want to abort without logging errors but I think a better way to handle those cases would be to accept `kernel::Interrupted` return values here and use the `kernel::IsInterrupted()` helper. (We can move these from `kernel` to `util` without breaking compatibility.)\r\n\r\nThe comment above on line 1325 \"errors are logged internally\" is also not accurate and impossible to enforce with an anonymous callback, so would suggest dropping that and logging unconditionally here. (Without logging, the most the comment could say would be \"errors need to be logged by func callback\" or \"errors should be logged by func callback\")",
      "commit_id" : "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "created_at" : "2024-02-09T19:10:32Z",
      "diff_hunk" : "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, std::string_view process_desc, const std::function<bool(WalletBatch&)>& func)\n+{\n+    WalletBatch batch(database);\n+    if (!batch.TxnBegin()) {\n+        LogPrint(BCLog::WALLETDB, \"Error: cannot create db txn for %s\\n\", process_desc);\n+        return false;\n+    }\n+\n+    // Run procedure, errors are logged internally\n+    if (!func(batch)) {\n+        batch.TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484707431",
      "id" : 1484707431,
      "line" : 1327,
      "node_id" : "PRRC_kwDOABII585YftZn",
      "original_commit_id" : "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "original_line" : 1327,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 14,
      "pull_request_review_id" : 1873039395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484707431/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T19:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484707431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484711516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484711516"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"wallet: db, introduce 'RunWithinTxn()' helper function\" (b6dcfca8f77f32cb1f41230fb71bab6666252041)\r\n\r\nWould be useful to add this is determines whether to commit or roll back the txn",
      "commit_id" : "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "created_at" : "2024-02-09T19:15:33Z",
      "diff_hunk" : "@@ -296,6 +296,20 @@ class WalletBatch\n     WalletDatabase& m_database;\n };\n \n+/**\n+ * Executes the provided function 'func' within a database transaction context.\n+ *\n+ * This function ensures that all db modifications performed within 'func()' are\n+ * atomically committed to the db at the end of the process. And, in case of a\n+ * failure during execution, all performed changes are rolled back.\n+ *\n+ * @param database The db connection instance to perform the transaction on.\n+ * @param process_desc A description of the process being executed, used for logging purposes in the event of a failure.\n+ * @param func The function to be executed within the db txn context. Returns a boolean indicating success or failure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484711516",
      "id" : 1484711516,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YfuZc",
      "original_commit_id" : "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "original_line" : 308,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 1873039395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484711516/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T19:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484711516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484725360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484725360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809\r\n\r\nIn commit \"wallet: bdb batch 'ErasePrefix', do not create txn internally\" (96eb527fad0effe082b087c0898843feccc2e213)\r\n\r\nThe new comment \"Additionally, read-write operations performed outside a db txn context are disallowed by current BDB configurations\" seems vague to me and I don't think would be comprehensible without reading this review thread. Would suggest just using achow's comment or combining both comments with something like \"The Dbc::del() cursor delete call below would fail without an active transaction.\".\r\n",
      "commit_id" : "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "created_at" : "2024-02-09T19:31:25Z",
      "diff_hunk" : "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484725360",
      "id" : 1484725360,
      "in_reply_to_id" : 1483514809,
      "line" : 892,
      "node_id" : "PRRC_kwDOABII585Yfxxw",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 892,
      "original_position" : 7,
      "original_start_line" : 890,
      "path" : "src/wallet/bdb.cpp",
      "position" : 7,
      "pull_request_review_id" : 1873039395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484725360/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 890,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T19:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484725360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484764886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484764886"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> re: [#29403 (comment)](https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809)\r\n> \r\n> In commit \"wallet: bdb batch 'ErasePrefix', do not create txn internally\" ([96eb527](https://github.com/bitcoin/bitcoin/commit/96eb527fad0effe082b087c0898843feccc2e213))\r\n> \r\n> The new comment \"Additionally, read-write operations performed outside a db txn context are disallowed by current BDB configurations\" seems vague to me and I don't think would be comprehensible without reading this review thread. Would suggest just using achow's comment or combining both comments with something like \"The Dbc::del() cursor delete call below would fail without an active transaction.\".\r\n\r\nI wrote it in this way to (try to) inform readers about current bdb config limitations in case anyone changes this code and doesn't understand why it fails. But, I agree that it is not immediately clear. Will change it for you line.\r\nHopefully no one else will change this again.",
      "commit_id" : "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "created_at" : "2024-02-09T20:16:22Z",
      "diff_hunk" : "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484764886",
      "id" : 1484764886,
      "in_reply_to_id" : 1483514809,
      "line" : 892,
      "node_id" : "PRRC_kwDOABII585Yf7bW",
      "original_commit_id" : "523525707742fc620039cd67e8f1437f7f613a01",
      "original_line" : 892,
      "original_position" : 7,
      "original_start_line" : 890,
      "path" : "src/wallet/bdb.cpp",
      "position" : 7,
      "pull_request_review_id" : 1873134759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484764886/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 890,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-09T20:21:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484764886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484771368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771368"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, using `util::Interrupted` to skip the failure logging in the future sounds great. Error logging added.",
      "commit_id" : "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "created_at" : "2024-02-09T20:24:27Z",
      "diff_hunk" : "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, std::string_view process_desc, const std::function<bool(WalletBatch&)>& func)\n+{\n+    WalletBatch batch(database);\n+    if (!batch.TxnBegin()) {\n+        LogPrint(BCLog::WALLETDB, \"Error: cannot create db txn for %s\\n\", process_desc);\n+        return false;\n+    }\n+\n+    // Run procedure, errors are logged internally\n+    if (!func(batch)) {\n+        batch.TxnAbort();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484771368",
      "id" : 1484771368,
      "in_reply_to_id" : 1484707431,
      "line" : 1327,
      "node_id" : "PRRC_kwDOABII585Yf9Ao",
      "original_commit_id" : "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "original_line" : 1327,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 14,
      "pull_request_review_id" : 1873145061,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T20:24:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484771531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "created_at" : "2024-02-09T20:24:37Z",
      "diff_hunk" : "@@ -296,6 +296,20 @@ class WalletBatch\n     WalletDatabase& m_database;\n };\n \n+/**\n+ * Executes the provided function 'func' within a database transaction context.\n+ *\n+ * This function ensures that all db modifications performed within 'func()' are\n+ * atomically committed to the db at the end of the process. And, in case of a\n+ * failure during execution, all performed changes are rolled back.\n+ *\n+ * @param database The db connection instance to perform the transaction on.\n+ * @param process_desc A description of the process being executed, used for logging purposes in the event of a failure.\n+ * @param func The function to be executed within the db txn context. Returns a boolean indicating success or failure.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484771531",
      "id" : 1484771531,
      "in_reply_to_id" : 1484711516,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Yf9DL",
      "original_commit_id" : "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "original_line" : 308,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 1873145293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-09T20:24:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
