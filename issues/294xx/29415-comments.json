[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29415).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [pinheadmz](https://github.com/bitcoin/bitcoin/pull/29415#pullrequestreview-1928558982) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29642](https://github.com/bitcoin/bitcoin/pull/29642) (kernel: Handle fatal errors through return values by TheCharlatan)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n* [#29625](https://github.com/bitcoin/bitcoin/pull/29625) (Several randomness improvements by sipa)\n* [#29623](https://github.com/bitcoin/bitcoin/pull/29623) (Simplify network-adjusted time warning logic by stickies-v)\n* [#29619](https://github.com/bitcoin/bitcoin/pull/29619) (refactor: consolidate MempoolAcceptResult processing by glozow)\n* [#29605](https://github.com/bitcoin/bitcoin/pull/29605) (net: Favor peers from addrman over fetching seednodes by sr-gi)\n* [#29575](https://github.com/bitcoin/bitcoin/pull/29575) (net_processing: make any misbehavior trigger immediate discouragement by sipa)\n* [#29432](https://github.com/bitcoin/bitcoin/pull/29432) (Stratum v2 Template Provider (take 3) by Sjors)\n* [#29431](https://github.com/bitcoin/bitcoin/pull/29431) (test/BIP324: disconnection scenarios during v2 handshake by stratospher)\n* [#29419](https://github.com/bitcoin/bitcoin/pull/29419) (log: deduplicate category names and improve logging.cpp by vasild)\n* [#29346](https://github.com/bitcoin/bitcoin/pull/29346) (Stratum v2 Noise Protocol by Sjors)\n* [#29278](https://github.com/bitcoin/bitcoin/pull/29278) (Wallet:  Add `maxfeerate` wallet startup option by ismaelsadeeq)\n* [#28970](https://github.com/bitcoin/bitcoin/pull/28970) (p2p: opportunistically accept 1-parent-1-child packages by glozow)\n* [#28834](https://github.com/bitcoin/bitcoin/pull/28834) (net: attempts to connect to all resolved addresses when connecting to a node by sr-gi)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n* [#28488](https://github.com/bitcoin/bitcoin/pull/28488) (p2p: Evict outbound peers with high minFeeRate by naumenkogs)\n* [#28463](https://github.com/bitcoin/bitcoin/pull/28463) (p2p: Increase inbound capacity for block-relay only connections by mzumsande)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27826](https://github.com/bitcoin/bitcoin/pull/27826) (validation: log which peer sent us a header by Sjors)\n* [#27539](https://github.com/bitcoin/bitcoin/pull/27539) (init: Fixes for file descriptor accounting by Empact)\n* [#26697](https://github.com/bitcoin/bitcoin/pull/26697) (logging: use bitset for categories by LarryRuane)\n* [#25832](https://github.com/bitcoin/bitcoin/pull/25832) (tracing: network connection tracepoints by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-02-09T13:39:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1935952116",
      "id" : 1935952116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII585zZEj0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935952116/reactions"
      },
      "updated_at" : "2024-03-13T09:34:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1935952116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I am not sure about this approach to improve privacy. Is it necessary to open new short lived tor/i2p connections for broadcasting the transaction? What are the trade-offs in this implementation vs a simple implementation to relay tx to one or more peers that our node is already connected to?\r\n\r\nRelated issues:\r\n\r\nhttps://github.com/bitcoin/bitcoin/issues/21876\r\nhttps://github.com/bitcoin/bitcoin/issues/28636",
      "created_at" : "2024-02-09T14:12:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1936003083",
      "id" : 1936003083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII585zZRAL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936003083/reactions"
      },
      "updated_at" : "2024-02-09T14:12:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936003083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/147166694?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 147166694,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOCMWV5g",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I think I forgot mentioned:\r\n\r\n- You have been working since last year\r\n- Lot of years reviewed \r\n\r\nStill I would NACK if it does not work for BITCOIN",
      "created_at" : "2024-02-09T20:42:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1936576857",
      "id" : 1936576857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII585zbdFZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936576857/reactions"
      },
      "updated_at" : "2024-02-09T20:42:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936576857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/147166694?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 147166694,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOCMWV5g",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@1440000bytes, thanks for asking! There is some discussion at https://github.com/bitcoin/bitcoin/pull/27509 (the previous attempt on this).\r\n\r\n> Is it necessary to open new short lived tor/i2p connections for broadcasting the transaction?\r\n\r\nYes, it is. See below.\r\n\r\n> What are the trade-offs in this implementation vs a simple implementation to relay tx to one or more peers that our node is already connected to?\r\n\r\nSending the transaction over clearnet reveals the IP address/geolocation of the sender. A spy with many connections to the network could try to guess who was the originator. So, why not send it to our Tor peers only? Because it is relatively easy for a spy to fingerprint and link clearnet and Tor connections to the same peer. That is, a long running connection over Tor could be linked to a long running clearnet connection. This is why the proposed changes open a short-lived connection that does not reveal any of the identity of the sender.\r\n\r\nWould this benefit nodes that don't have clearnet connections, e.g. Tor/I2P-only nodes? Yes! In the case where the sender sends two otherwise unrelated transactions over the same long-running Tor connection, the recipient will know that they have the same origin, even though they are not related on-chain. Using single shot connections fixes that too.\r\n\r\n> Related issues:\r\n\r\nLinked in the OP, thanks!",
      "created_at" : "2024-02-10T12:16:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1936992757",
      "id" : 1936992757,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII585zdCn1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936992757/reactions"
      },
      "updated_at" : "2024-02-10T12:17:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936992757",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1485310634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1485310634"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "While touching this, maybe `BCLog::UTIL` which is not used since https://github.com/bitcoin/bitcoin/pull/27896 should be dropped?",
      "commit_id" : "74ba7c7fb58e3a77eef7d69739145d22bb937f1c",
      "created_at" : "2024-02-10T21:48:08Z",
      "diff_hunk" : "@@ -142,49 +141,58 @@ bool BCLog::Logger::DefaultShrinkDebugFile() const\n     return m_categories == BCLog::NONE;\n }\n \n-struct CLogCategoryDesc {\n-    BCLog::LogFlags flag;\n-    std::string category;\n-};\n-\n-const CLogCategoryDesc LogCategories[] =\n-{\n-    {BCLog::NONE, \"0\"},\n-    {BCLog::NONE, \"\"},\n-    {BCLog::NET, \"net\"},\n-    {BCLog::TOR, \"tor\"},\n-    {BCLog::MEMPOOL, \"mempool\"},\n-    {BCLog::HTTP, \"http\"},\n-    {BCLog::BENCH, \"bench\"},\n-    {BCLog::ZMQ, \"zmq\"},\n-    {BCLog::WALLETDB, \"walletdb\"},\n-    {BCLog::RPC, \"rpc\"},\n-    {BCLog::ESTIMATEFEE, \"estimatefee\"},\n-    {BCLog::ADDRMAN, \"addrman\"},\n-    {BCLog::SELECTCOINS, \"selectcoins\"},\n-    {BCLog::REINDEX, \"reindex\"},\n-    {BCLog::CMPCTBLOCK, \"cmpctblock\"},\n-    {BCLog::RAND, \"rand\"},\n-    {BCLog::PRUNE, \"prune\"},\n-    {BCLog::PROXY, \"proxy\"},\n-    {BCLog::MEMPOOLREJ, \"mempoolrej\"},\n-    {BCLog::LIBEVENT, \"libevent\"},\n-    {BCLog::COINDB, \"coindb\"},\n-    {BCLog::QT, \"qt\"},\n-    {BCLog::LEVELDB, \"leveldb\"},\n-    {BCLog::VALIDATION, \"validation\"},\n-    {BCLog::I2P, \"i2p\"},\n-    {BCLog::IPC, \"ipc\"},\n+static const std::map<std::string, BCLog::LogFlags> LOG_CATEGORIES_BY_STR{\n+    {\"0\", BCLog::NONE},\n+    {\"\", BCLog::NONE},\n+    {\"net\", BCLog::NET},\n+    {\"tor\", BCLog::TOR},\n+    {\"mempool\", BCLog::MEMPOOL},\n+    {\"http\", BCLog::HTTP},\n+    {\"bench\", BCLog::BENCH},\n+    {\"zmq\", BCLog::ZMQ},\n+    {\"walletdb\", BCLog::WALLETDB},\n+    {\"rpc\", BCLog::RPC},\n+    {\"estimatefee\", BCLog::ESTIMATEFEE},\n+    {\"addrman\", BCLog::ADDRMAN},\n+    {\"selectcoins\", BCLog::SELECTCOINS},\n+    {\"reindex\", BCLog::REINDEX},\n+    {\"cmpctblock\", BCLog::CMPCTBLOCK},\n+    {\"rand\", BCLog::RAND},\n+    {\"prune\", BCLog::PRUNE},\n+    {\"proxy\", BCLog::PROXY},\n+    {\"mempoolrej\", BCLog::MEMPOOLREJ},\n+    {\"libevent\", BCLog::LIBEVENT},\n+    {\"coindb\", BCLog::COINDB},\n+    {\"qt\", BCLog::QT},\n+    {\"leveldb\", BCLog::LEVELDB},\n+    {\"validation\", BCLog::VALIDATION},\n+    {\"i2p\", BCLog::I2P},\n+    {\"ipc\", BCLog::IPC},\n #ifdef DEBUG_LOCKCONTENTION\n-    {BCLog::LOCK, \"lock\"},\n+    {\"lock\", BCLog::LOCK},\n #endif\n-    {BCLog::UTIL, \"util\"},\n-    {BCLog::BLOCKSTORAGE, \"blockstorage\"},\n-    {BCLog::TXRECONCILIATION, \"txreconciliation\"},\n-    {BCLog::SCAN, \"scan\"},\n-    {BCLog::TXPACKAGES, \"txpackages\"},\n-    {BCLog::ALL, \"1\"},\n-    {BCLog::ALL, \"all\"},\n+    {\"util\", BCLog::UTIL},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1485310634",
      "id" : 1485310634,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII585YiAqq",
      "original_commit_id" : "2b05af27608f9e4e9a1b5f5c83c7870a8e6c9425",
      "original_line" : 174,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 86,
      "pull_request_review_id" : 1874263137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1485310634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-10T21:50:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1485310634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2257631?v=4",
         "events_url" : "https://api.github.com/users/davidgumberg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/davidgumberg/followers",
         "following_url" : "https://api.github.com/users/davidgumberg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/davidgumberg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/davidgumberg",
         "id" : 2257631,
         "login" : "davidgumberg",
         "node_id" : "MDQ6VXNlcjIyNTc2MzE=",
         "organizations_url" : "https://api.github.com/users/davidgumberg/orgs",
         "received_events_url" : "https://api.github.com/users/davidgumberg/received_events",
         "repos_url" : "https://api.github.com/users/davidgumberg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/davidgumberg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/davidgumberg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/davidgumberg"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "v2 Transport will be enabled by default in the next release (https://github.com/bitcoin/bitcoin/pull/29347).\r\n\r\nIf there were eventually a change to _force_ clearnet transactions over v2 transport (so the details of the communications were encrypted), would that solve the same problem that this PR is aiming to solve?",
      "created_at" : "2024-02-10T21:56:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1937228496",
      "id" : 1937228496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII585zd8LQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1937228496/reactions"
      },
      "updated_at" : "2024-02-10T21:56:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1937228496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/109078515?v=4",
         "events_url" : "https://api.github.com/users/epiccurious/events{/privacy}",
         "followers_url" : "https://api.github.com/users/epiccurious/followers",
         "following_url" : "https://api.github.com/users/epiccurious/following{/other_user}",
         "gists_url" : "https://api.github.com/users/epiccurious/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/epiccurious",
         "id" : 109078515,
         "login" : "epiccurious",
         "node_id" : "U_kgDOBoBn8w",
         "organizations_url" : "https://api.github.com/users/epiccurious/orgs",
         "received_events_url" : "https://api.github.com/users/epiccurious/received_events",
         "repos_url" : "https://api.github.com/users/epiccurious/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/epiccurious/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/epiccurious/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/epiccurious"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@epiccurious, p2p encryption \"solves\" the spying from intermediate routers on clearnet (aka man-in-the-middle). Tor, I2P and CJDNS solve that too. While this PR uses only Tor and I2P it would solve that problem. But there is more - it will as well solve issues with spying bitcoin nodes.",
      "created_at" : "2024-02-11T14:13:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1937766372",
      "id" : 1937766372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII585zf_fk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1937766372/reactions"
      },
      "updated_at" : "2024-02-11T14:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1937766372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1485605463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1485605463"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in https://github.com/bitcoin/bitcoin/pull/29419, thanks for the suggestion!",
      "commit_id" : "74ba7c7fb58e3a77eef7d69739145d22bb937f1c",
      "created_at" : "2024-02-11T14:28:49Z",
      "diff_hunk" : "@@ -142,49 +141,58 @@ bool BCLog::Logger::DefaultShrinkDebugFile() const\n     return m_categories == BCLog::NONE;\n }\n \n-struct CLogCategoryDesc {\n-    BCLog::LogFlags flag;\n-    std::string category;\n-};\n-\n-const CLogCategoryDesc LogCategories[] =\n-{\n-    {BCLog::NONE, \"0\"},\n-    {BCLog::NONE, \"\"},\n-    {BCLog::NET, \"net\"},\n-    {BCLog::TOR, \"tor\"},\n-    {BCLog::MEMPOOL, \"mempool\"},\n-    {BCLog::HTTP, \"http\"},\n-    {BCLog::BENCH, \"bench\"},\n-    {BCLog::ZMQ, \"zmq\"},\n-    {BCLog::WALLETDB, \"walletdb\"},\n-    {BCLog::RPC, \"rpc\"},\n-    {BCLog::ESTIMATEFEE, \"estimatefee\"},\n-    {BCLog::ADDRMAN, \"addrman\"},\n-    {BCLog::SELECTCOINS, \"selectcoins\"},\n-    {BCLog::REINDEX, \"reindex\"},\n-    {BCLog::CMPCTBLOCK, \"cmpctblock\"},\n-    {BCLog::RAND, \"rand\"},\n-    {BCLog::PRUNE, \"prune\"},\n-    {BCLog::PROXY, \"proxy\"},\n-    {BCLog::MEMPOOLREJ, \"mempoolrej\"},\n-    {BCLog::LIBEVENT, \"libevent\"},\n-    {BCLog::COINDB, \"coindb\"},\n-    {BCLog::QT, \"qt\"},\n-    {BCLog::LEVELDB, \"leveldb\"},\n-    {BCLog::VALIDATION, \"validation\"},\n-    {BCLog::I2P, \"i2p\"},\n-    {BCLog::IPC, \"ipc\"},\n+static const std::map<std::string, BCLog::LogFlags> LOG_CATEGORIES_BY_STR{\n+    {\"0\", BCLog::NONE},\n+    {\"\", BCLog::NONE},\n+    {\"net\", BCLog::NET},\n+    {\"tor\", BCLog::TOR},\n+    {\"mempool\", BCLog::MEMPOOL},\n+    {\"http\", BCLog::HTTP},\n+    {\"bench\", BCLog::BENCH},\n+    {\"zmq\", BCLog::ZMQ},\n+    {\"walletdb\", BCLog::WALLETDB},\n+    {\"rpc\", BCLog::RPC},\n+    {\"estimatefee\", BCLog::ESTIMATEFEE},\n+    {\"addrman\", BCLog::ADDRMAN},\n+    {\"selectcoins\", BCLog::SELECTCOINS},\n+    {\"reindex\", BCLog::REINDEX},\n+    {\"cmpctblock\", BCLog::CMPCTBLOCK},\n+    {\"rand\", BCLog::RAND},\n+    {\"prune\", BCLog::PRUNE},\n+    {\"proxy\", BCLog::PROXY},\n+    {\"mempoolrej\", BCLog::MEMPOOLREJ},\n+    {\"libevent\", BCLog::LIBEVENT},\n+    {\"coindb\", BCLog::COINDB},\n+    {\"qt\", BCLog::QT},\n+    {\"leveldb\", BCLog::LEVELDB},\n+    {\"validation\", BCLog::VALIDATION},\n+    {\"i2p\", BCLog::I2P},\n+    {\"ipc\", BCLog::IPC},\n #ifdef DEBUG_LOCKCONTENTION\n-    {BCLog::LOCK, \"lock\"},\n+    {\"lock\", BCLog::LOCK},\n #endif\n-    {BCLog::UTIL, \"util\"},\n-    {BCLog::BLOCKSTORAGE, \"blockstorage\"},\n-    {BCLog::TXRECONCILIATION, \"txreconciliation\"},\n-    {BCLog::SCAN, \"scan\"},\n-    {BCLog::TXPACKAGES, \"txpackages\"},\n-    {BCLog::ALL, \"1\"},\n-    {BCLog::ALL, \"all\"},\n+    {\"util\", BCLog::UTIL},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1485605463",
      "id" : 1485605463,
      "in_reply_to_id" : 1485310634,
      "line" : 174,
      "node_id" : "PRRC_kwDOABII585YjIpX",
      "original_commit_id" : "2b05af27608f9e4e9a1b5f5c83c7870a8e6c9425",
      "original_line" : 174,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/logging.cpp",
      "position" : 86,
      "pull_request_review_id" : 1874379420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1485605463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-11T14:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1485605463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`74ba7c7fb5...6fad02cf03`: rebase due to conflicts",
      "created_at" : "2024-02-29T13:18:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1971120973",
      "id" : 1971120973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5851fOtN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1971120973/reactions"
      },
      "updated_at" : "2024-02-29T13:18:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1971120973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "concept ACK 6fad02cf03 \r\n\r\n(code review in progress)\r\n\r\nI am also testing this feature in Warnet, which deploys a regtest network and even has an internal Tor DA so I can simulate onion routing locally. Currently using a 20-node [graph](https://github.com/pinheadmz/warnet/blob/priv-broadcast/test/data/onion.graphml) and a [scenario](https://github.com/pinheadmz/warnet/blob/priv-broadcast/src/scenarios/onion_init.py) which connects the graph, adds onion addresses to the test node, and then sends a raw transaction from the node running this branch.\r\n\r\nThe private broadcast succeeds frequently but not always. In Warnet anyway I had better luck when the test node had `-listenonion=0`, I tried that after suspecting that inbound onion connections were removing potential peers from the private broadcast list, but I'm not sure.\r\n\r\nI think I noticed this in the original PR as well, if multiple transactions are sent, the count keeps going up without a limit: \r\n\r\n```\r\n [privatebroadcast] Requested to open 60 connection(s), trying to open one\r\n```\r\n\r\nScreenshot below, I managed to capture a private broadcast connection! I'll mention when i get to that commit in review as well, but the connection type `\"privbcast\"` is breaking the very nice `-netinfo` table :-)\r\n\r\n\r\nSo far I have a few questions about the strategy:\r\n\r\n1. How do we pick the onion peers to relay to? If we avoid reusing peers then (especially in my miniature network) we can run out quickly, and nothing ever gets broadcast.\r\n\r\n2. Are we using fresh Tor identities for these connections? I think [Wasabi does something like this:](https://docs.wasabiwallet.app/why-wasabi/NetworkLevelPrivacy.html)\r\n\r\n> Wasabi connects to each peer through a different Tor stream. \r\n\r\n3. Do you think we need any RPC to get the status of private tx sends or provide the option to abandon (or revert to clearnet?)\r\n\r\n4. I assume you are restricting the feature to sendraw so the wallet doesn't get involved and try something silly like rebroadcasting over clearnet or inserting in to our own mempool? Do you think future work will integrate the wallet?\r\n\r\n\r\n![privbroadcast](https://github.com/bitcoin/bitcoin/assets/2084648/ec172be1-e5d8-4c00-94fc-e219dccacdec)\r\n\r\n\r\n",
      "created_at" : "2024-03-08T16:32:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1986011938",
      "id" : 1986011938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852YCMi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986011938/reactions"
      },
      "updated_at" : "2024-03-08T16:32:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986011938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1517972760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1517972760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e672e55ddb49378bd5c8e4f03fadae5774310c70 does this mean there is only one bit left in `LogFlags : uint32_t` ?!",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T16:42:11Z",
      "diff_hunk" : "@@ -70,6 +70,7 @@ namespace BCLog {\n         TXRECONCILIATION = (1 << 27),\n         SCAN        = (1 << 28),\n         TXPACKAGES  = (1 << 29),\n+        PRIVATE_BROADCAST = (1 << 30),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1517972760",
      "id" : 1517972760,
      "line" : 73,
      "node_id" : "PRRC_kwDOABII585aem0Y",
      "original_commit_id" : "e672e55ddb49378bd5c8e4f03fadae5774310c70",
      "original_line" : 73,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 4,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1517972760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1517972760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1517981961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1517981961"
         }
      },
      "author_association" : "MEMBER",
      "body" : "72f0dbc99e6eed26bef21965dabc5f0bebf01b33 if user sets `-onlynet=onion` do we require (by the time we get to this line) that NET_ONION is reachable? Or couldn't it come up later, similar to the `-listenonion` configuration?",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T16:50:30Z",
      "diff_hunk" : "@@ -1900,6 +1911,23 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-privatebroadcast\", DEFAULT_PRIVATE_BROADCAST)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!g_reachable_nets.Contains(NET_I2P) && !g_reachable_nets.Contains(NET_ONION) &&\n+            (!listenonion || args.IsArgSet(\"-onlynet\"))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1517981961",
      "id" : 1517981961,
      "line" : 1936,
      "node_id" : "PRRC_kwDOABII585aepEJ",
      "original_commit_id" : "72f0dbc99e6eed26bef21965dabc5f0bebf01b33",
      "original_line" : 1919,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 100,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1517981961/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1517981961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518063388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518063388"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7a0f492104c1621b7089a64fa330c72b06d30574 `\"privbcast\"` needs to be <= 6 characters to fit nicely in the table layout, or you could extend the column width:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/1cd2e29870e4ad3b7c57b1d567df0e6df56572b0/src/bitcoin-cli.cpp#L549-L552",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T17:51:51Z",
      "diff_hunk" : "@@ -452,6 +452,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         if (conn_type == \"block-relay-only\") return \"block\";\n         if (conn_type == \"manual\" || conn_type == \"feeler\") return conn_type;\n         if (conn_type == \"addr-fetch\") return \"addr\";\n+        if (conn_type == \"private-broadcast\") return \"privbcast\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518063388",
      "id" : 1518063388,
      "line" : 455,
      "node_id" : "PRRC_kwDOABII585ae88c",
      "original_commit_id" : "7a0f492104c1621b7089a64fa330c72b06d30574",
      "original_line" : 455,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 4,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518063388/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518063388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518080397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518080397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "7a0f492104c1621b7089a64fa330c72b06d30574 I noticed this wasn't added to the fuzzer, dunno if it needs to be:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/1cd2e29870e4ad3b7c57b1d567df0e6df56572b0/src/test/util/net.h#L112-L119",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T18:06:46Z",
      "diff_hunk" : "@@ -75,6 +75,13 @@ enum class ConnectionType {\n      * AddrMan is empty.\n      */\n     ADDR_FETCH,\n+\n+    /**\n+     * Private broadcast connections are short-lived and only opened to\n+     * privacy networks (Tor, I2P) for relaying privacy-sensitive data (like\n+     * our own transactions) and closed afterwards.\n+     */\n+    PRIVATE_BROADCAST,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518080397",
      "id" : 1518080397,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII585afBGN",
      "original_commit_id" : "7a0f492104c1621b7089a64fa330c72b06d30574",
      "original_line" : 84,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/node/connection_types.h",
      "position" : 10,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518080397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518080397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@pinheadmz, excellent! Thank you for looking into this! Replies inline:\r\n\r\n> The private broadcast succeeds frequently but not always\r\n\r\nLets debug this in a sub-thread in order not to overwhelm the PR main thread: [here](https://github.com/bitcoin/bitcoin/pull/29415/files#r1519402830).\r\n\r\n> suspecting that inbound onion connections were removing potential peers from the private broadcast list\r\n\r\nNo, this cannot be the case. Inbound onion connections appear as IPv4 connections coming from the Tor daemon. They do not have any source address associated with them, other than the one of the Tor daemon itself (usually `127.0.0.1`).\r\n\r\n> I think I noticed this in the original PR as well, if multiple transactions are sent, the count keeps going up without a limit\r\n\r\nThat is now capped at `size_t MAX_PRIVATE_BROADCAST_CONNECTIONS{64}`.\r\n\r\n> the connection type `\"privbcast\"` is breaking the very nice `-netinfo` table\r\n\r\nThis better be addressed in the visualization engine, e.g. by using `%5.5s`\r\n\r\n> How do we pick the onion peers to relay to? If we avoid reusing peers then...\r\n\r\nWe pick a random Tor (or I2P) peer. In the same way we choose the address when we want to have an outbound connection to a peer from a particular network. No attempt to avoid reuse. But we don't connect to already connected peers. This is the logic as in `master`.\r\n\r\n> Are we using fresh Tor identities for these connections?\r\n\r\nYes, if `-proxyrandomize=1` (the default). This is the same in `master` - separate Tor circuit per connection. This PR does the same as Wasabi: https://docs.wasabiwallet.app/why-wasabi/NetworkLevelPrivacy.html#wasabi-wallet-light-node\r\n\r\n> Do you think we need any RPC to get the status of private tx sends or provide the option to abandon (or revert to clearnet?)\r\n\r\nYes, both would be useful, but as a followup PR. I am afraid putting those here would bloat this PR too much. I could however implement that and publish it under Draft PR that depends on this one, so people can use it during testing.\r\n\r\n> I assume you are restricting the feature to sendraw so the wallet doesn't get involved and try something silly like rebroadcasting over clearnet or inserting in to our own mempool?\r\n\r\nThe reason to omit the wallet is that it currently does not count non-mempool change. For example, if we have 1 BTC and send 0.6 to somebody and 0.4 as change, the wallet will show a balance of 0 (or 1, unchanged? somebody correct me if I am wrong) until the transaction enters the mempool (or gets mined in a block). This would be quite rough user experience. Note that this is already the case in `master` if `-walletbroadcast=0`.\r\n\r\n> Do you think future work will integrate the wallet?\r\n\r\nYes, but I left that for another PR. Omitting it here reduces the size of this PR and allows to deal with the wallet in isolation, after all the distracting infrastructure is in (e.g. log category, new type of connection, the \"net\" code, etc).\r\n",
      "created_at" : "2024-03-08T18:21:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1986188327",
      "id" : 1986188327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852YtQn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986188327/reactions"
      },
      "updated_at" : "2024-03-11T09:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986188327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518132032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518132032"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9 Just to clarify: if a i2p sam session already exists, normally we would re-use it. But in the case of private broadcast we force a new transient session? Comment might be nice here.",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T18:38:29Z",
      "diff_hunk" : "@@ -456,7 +456,7 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n         if (addrConnect.IsI2P() && use_proxy) {\n             i2p::Connection conn;\n \n-            if (m_i2p_sam_session) {\n+            if (m_i2p_sam_session && conn_type != ConnectionType::PRIVATE_BROADCAST) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518132032",
      "id" : 1518132032,
      "line" : 468,
      "node_id" : "PRRC_kwDOABII585afNtA",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 459,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518132032/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518132032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518175963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518175963"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9 Feels like this log message is not in the right place since this function does not try to open a connection.",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T19:01:46Z",
      "diff_hunk" : "@@ -2413,6 +2413,63 @@ bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n     return false;\n }\n \n+/**\n+ * Decide whether to open a private broadcast connection and if yes, to which network.\n+ * @param[in,out] net If the previous attempt to open a connection was an attempt to\n+ * open a private broadcast connection (successful or not), then this should have a\n+ * value. When the function ends if this has value then it will contain the network\n+ * to which to open the connection.\n+ * @param[in] num_needed Number of private broadcast connections that need to be opened.\n+ * @param[in] num_opened Number of private broadcast connections that are currently opened.\n+ */\n+static void MaybePickPrivateBroadcastNetwork(std::optional<Network>& net, size_t num_needed, size_t num_opened)\n+{\n+    if (net.has_value()) {\n+        // Yield to other connection types.\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_needed == 0) {\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_opened >= MAX_PRIVATE_BROADCAST_CONNECTIONS) {\n+        LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                      BCLog::Level::Debug,\n+                      \"Requested to open %d connection(s), but there are already %d \"\n+                      \"connections opened. Will wait for some of them to be closed \"\n+                      \"before opening a new one\\n\",\n+                      num_needed,\n+                      num_opened);\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    const bool tor_reachable{g_reachable_nets.Contains(NET_ONION)};\n+    const bool i2p_reachable{g_reachable_nets.Contains(NET_I2P)};\n+    if (tor_reachable && i2p_reachable) {\n+        net = FastRandomContext{}.randbool() ? NET_ONION : NET_I2P;\n+    } else if (tor_reachable) {\n+        net = NET_ONION;\n+    } else if (i2p_reachable) {\n+        net = NET_I2P;\n+    } else {\n+        LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                      BCLog::Level::Warning,\n+                      \"Requested to open %d connection(s) but none of the Tor or I2P networks is reachable.\\n\",\n+                      num_needed);\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                  BCLog::Level::Debug,\n+                  \"Requested to open %d connection(s), trying to open one\\n\",\n+                  num_needed);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518175963",
      "id" : 1518175963,
      "line" : 2479,
      "node_id" : "PRRC_kwDOABII585afYbb",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 2470,
      "original_position" : 67,
      "original_start_line" : 2467,
      "path" : "src/net.cpp",
      "position" : 93,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518175963/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2476,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518175963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518178949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518178949"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9 does this need underflow protection? Just like an `Assume()` even?",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T19:04:52Z",
      "diff_hunk" : "@@ -2886,6 +2964,16 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n         return;\n     pnode->grantOutbound = std::move(grant_outbound);\n \n+    if (conn_type == ConnectionType::PRIVATE_BROADCAST) {\n+        const size_t before_sub{m_private_broadcast_connections_to_open.fetch_sub(1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518178949",
      "id" : 1518178949,
      "line" : 2977,
      "node_id" : "PRRC_kwDOABII585afZKF",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 2968,
      "original_position" : 170,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 274,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518178949/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518178949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518194970"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518194970"
         }
      },
      "author_association" : "MEMBER",
      "body" : "532e63279a3c04fef8da2c1bb95e5280c94abc4e consider rephrasing the comment on the previous line since `relay=true` isn't a thing any more?",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T19:22:32Z",
      "diff_hunk" : "@@ -2051,7 +2065,7 @@ NodeClock::time_point CWallet::GetDefaultNextResend() { return FastRandomContext\n // that depends on the `relay` option. Periodic rebroadcast uses the pattern\n // relay=true force=false, while loading into the mempool\n // (on start, or after import) uses relay=false force=true.\n-void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n+void CWallet::ResubmitWalletTransactions(TxBroadcastMethod broadcast_method, bool force)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518194970",
      "id" : 1518194970,
      "line" : 2068,
      "node_id" : "PRRC_kwDOABII585afdEa",
      "original_commit_id" : "532e63279a3c04fef8da2c1bb95e5280c94abc4e",
      "original_line" : 2068,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 46,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518194970/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518194970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518225842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518225842"
         }
      },
      "author_association" : "MEMBER",
      "body" : "eb9d7386ca82319ab682fc20ab35c13340d108a4 Hashing a hash? Does this just make the `std::unordered_map` lookups faster because the keys are smaller (looks like 64 bits?)",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T19:47:41Z",
      "diff_hunk" : "@@ -1083,6 +1087,62 @@ class PeerManagerImpl final : public PeerManager\n \n     void AddAddressKnown(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n     void PushAddress(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n+\n+    /**\n+     * Store a list of transactions to be broadcast privately. Supports the following operations:\n+     * - Add a new transaction\n+     * - Remove a transaction, after it has been seen by the network\n+     * - Mark a broadcast of a transaction (remember when and how many times)\n+     * - Get a transaction for broadcast, the one that has been broadcast less times and least recently\n+     */\n+    class PrivateBroadcast\n+    {\n+    public:\n+        void Add(const CTransactionRef& tx) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+        {\n+            const Txid& txid = tx->GetHash();\n+            LOCK(m_mutex);\n+            auto [pos, inserted] = m_by_txid.emplace(txid, TxWithPriority{.tx = tx, .priority = Priority{}});\n+            if (inserted) {\n+                m_by_priority.emplace(Priority{}, txid);\n+            }\n+        }\n+\n+    private:\n+        struct Priority {\n+            size_t num_broadcasted{0};\n+            std::chrono::microseconds last_broadcasted{0};\n+\n+            bool operator<(const Priority& other) const\n+            {\n+                if (num_broadcasted < other.num_broadcasted) {\n+                    return true;\n+                }\n+                return last_broadcasted < other.last_broadcasted;\n+            }\n+        };\n+\n+        struct TxWithPriority {\n+            CTransactionRef tx;\n+            Priority priority;\n+        };\n+\n+        struct TxidHasher {\n+            size_t operator()(const Txid& txid) const { return SipHashUint256(0, 0, txid.ToUint256()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518225842",
      "id" : 1518225842,
      "line" : 1236,
      "node_id" : "PRRC_kwDOABII585afkmy",
      "original_commit_id" : "eb9d7386ca82319ab682fc20ab35c13340d108a4",
      "original_line" : 1131,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 195,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518225842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518225842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518256562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518256562"
         }
      },
      "author_association" : "MEMBER",
      "body" : "07dee91112189be02c6694385de261570725b56b this would be unexpected if we had the txid in the priority list but not in the actual txid list, right? Maybe we should at least remove the txid from the priority list if this ever happens, or log something, or like, call the police or something?",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T20:23:23Z",
      "diff_hunk" : "@@ -1108,6 +1116,71 @@ class PeerManagerImpl final : public PeerManager\n             }\n         }\n \n+        /**\n+         * Get the transaction that has been broadcast less times and least recently.\n+         */\n+        std::optional<CTransactionRef> GetTxForBroadcast() const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+        {\n+            LOCK(m_mutex);\n+            if (m_by_priority.empty()) {\n+                return std::nullopt;\n+            }\n+            const Txid& txid = m_by_priority.begin()->second;\n+            auto it = m_by_txid.find(txid);\n+            if (it == m_by_txid.end()) {\n+                return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518256562",
      "id" : 1518256562,
      "line" : 1150,
      "node_id" : "PRRC_kwDOABII585afsGy",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 1131,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 109,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518256562/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518256562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518263617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518263617"
         }
      },
      "author_association" : "MEMBER",
      "body" : "07dee91112189be02c6694385de261570725b56b could this just be blank?",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T20:32:24Z",
      "diff_hunk" : "@@ -1566,26 +1665,53 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    MakeAndPushMessage(pnode, NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, CNetAddr::V1(addr_you), // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CNetAddr::V1(CService{}), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay);\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsPrivateBroadcastConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518263617",
      "id" : 1518263617,
      "line" : 1712,
      "node_id" : "PRRC_kwDOABII585aft1B",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 1680,
      "original_position" : 172,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 271,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518263617/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518263617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518279844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518279844"
         }
      },
      "author_association" : "MEMBER",
      "body" : "07dee91112189be02c6694385de261570725b56b do you need this here? I thought you had filtered out all the unnecessary messages already in `CConnman::PushMessage()`",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T20:52:20Z",
      "diff_hunk" : "@@ -3706,7 +3885,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                       (mapped_as ? strprintf(\", mapped_as=%d\", mapped_as) : \"\"));\n         }\n \n-        if (pfrom.GetCommonVersion() >= SHORT_IDS_BLOCKS_VERSION) {\n+        if (pfrom.GetCommonVersion() >= SHORT_IDS_BLOCKS_VERSION && !pfrom.IsPrivateBroadcastConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518279844",
      "id" : 1518279844,
      "line" : 3973,
      "node_id" : "PRRC_kwDOABII585afxyk",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 3888,
      "original_position" : 291,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 618,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518279844/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518279844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518282738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518282738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "07dee91112189be02c6694385de261570725b56b `BroadcastEnd()` returns a `bool`, seems like you could include that in the log message where you have the word \"probably\"",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-08T20:55:54Z",
      "diff_hunk" : "@@ -4929,6 +5133,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsPrivateBroadcastConn()) {\n+                            m_tx_for_private_broadcast.BroadcastEnd(pfrom.GetId(), /*confirmed_by_node=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1518282738",
      "id" : 1518282738,
      "line" : 5232,
      "node_id" : "PRRC_kwDOABII585afyfy",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 5137,
      "original_position" : 339,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 701,
      "pull_request_review_id" : 1925311361,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518282738/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-08T20:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1518282738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-09T02:12:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1986694091",
      "id" : 1986694091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852aovL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986694091/reactions"
      },
      "updated_at" : "2024-03-09T02:12:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986694091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1519402830"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519402830"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "From the PR main thread https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1986011938:\r\n\r\n> The private broadcast succeeds frequently but not always\r\n\r\nIn the originator's log you can check to whom is the transaction being sent. Then in the recipient's logs you can check if it was accepted and further broadcast to everybody. Enable `-debug=net -debug=privatebroadcast`.",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-11T09:35:14Z",
      "diff_hunk" : "@@ -452,6 +452,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         if (conn_type == \"block-relay-only\") return \"block\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1519402830",
      "id" : 1519402830,
      "line" : 452,
      "node_id" : "PRRC_kwDOABII585akD9O",
      "original_commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "original_line" : 452,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 1,
      "pull_request_review_id" : 1927346768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519402830/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T09:35:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519402830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1519831611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519831611"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes. `LogFlags` is not stored on disk (I hope!) or participate in some permanent on-disk format. It is memory only and can be flipped to `uint64_t` when needed.",
      "commit_id" : "6fad02cf03d6b37d0a22443a411ec92649b1d39d",
      "created_at" : "2024-03-11T14:37:03Z",
      "diff_hunk" : "@@ -70,6 +70,7 @@ namespace BCLog {\n         TXRECONCILIATION = (1 << 27),\n         SCAN        = (1 << 28),\n         TXPACKAGES  = (1 << 29),\n+        PRIVATE_BROADCAST = (1 << 30),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1519831611",
      "id" : 1519831611,
      "in_reply_to_id" : 1517972760,
      "line" : 73,
      "node_id" : "PRRC_kwDOABII585also7",
      "original_commit_id" : "e672e55ddb49378bd5c8e4f03fadae5774310c70",
      "original_line" : 73,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/logging.h",
      "position" : 4,
      "pull_request_review_id" : 1928014516,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519831611/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T14:37:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1519831611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520116658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520116658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> if user sets `-onlynet=onion` do we require (by the time we get to this line) that NET_ONION is reachable?\r\n\r\nNo. `-listen=1 -listenonion=1 -torcontrol=... -torpassword=... -onlynet=onion` would get us here with `NET_ONION` being unreachable.\r\n\r\n> Or couldn't it come up later, similar to the `-listenonion` configuration?\r\n\r\nYes, if `-listenonion=1 -torcontrol=... -torpassword=...` is given then we will later, after startup, connect to the Tor daemon and possibly make `NET_ONION` reachable.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:15:17Z",
      "diff_hunk" : "@@ -1900,6 +1911,23 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-privatebroadcast\", DEFAULT_PRIVATE_BROADCAST)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!g_reachable_nets.Contains(NET_I2P) && !g_reachable_nets.Contains(NET_ONION) &&\n+            (!listenonion || args.IsArgSet(\"-onlynet\"))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520116658",
      "id" : 1520116658,
      "in_reply_to_id" : 1517981961,
      "line" : 1961,
      "node_id" : "PRRC_kwDOABII585amyOy",
      "original_commit_id" : "72f0dbc99e6eed26bef21965dabc5f0bebf01b33",
      "original_line" : 1961,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 100,
      "pull_request_review_id" : 1928519119,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520116658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T17:15:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520116658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520122930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520122930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "bc05ddc7b9369cf263bf88d0a773ca853d3c9af5 maybe I'm missing something, but should we not also adjust `m_private_broadcast_connections_to_open` when we get our privately broadcast tx back over regular relay? In my first local test, all 5 onion connections were completed before I got the tx back. But if the very first private connection relays the tx around and we get it back, do we still need to bother with the next 4?",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:19:46Z",
      "diff_hunk" : "@@ -4499,6 +4515,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         const uint256& hash = peer->m_wtxid_relay ? wtxid : txid;\n         AddKnownTx(*peer, hash);\n \n+        if (m_tx_for_private_broadcast.Remove(ptx)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520122930",
      "id" : 1520122930,
      "line" : 4604,
      "node_id" : "PRRC_kwDOABII585amzwy",
      "original_commit_id" : "bc05ddc7b9369cf263bf88d0a773ca853d3c9af5",
      "original_line" : 4604,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 665,
      "pull_request_review_id" : 1928530676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520122930/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T17:19:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520122930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520128211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520128211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok so then isn't it possible for a user to start with `-privatebroadcast` but i2p and onion aren't reachable *yet*? They would get an init error but the Tor daemon could become reachable later, by the time we need it.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:23:32Z",
      "diff_hunk" : "@@ -1900,6 +1911,23 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-privatebroadcast\", DEFAULT_PRIVATE_BROADCAST)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!g_reachable_nets.Contains(NET_I2P) && !g_reachable_nets.Contains(NET_ONION) &&\n+            (!listenonion || args.IsArgSet(\"-onlynet\"))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520128211",
      "id" : 1520128211,
      "in_reply_to_id" : 1517981961,
      "line" : 1961,
      "node_id" : "PRRC_kwDOABII585am1DT",
      "original_commit_id" : "72f0dbc99e6eed26bef21965dabc5f0bebf01b33",
      "original_line" : 1961,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 100,
      "pull_request_review_id" : 1928539673,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520128211/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T17:23:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520128211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520139562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520139562"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9 what if `MaybePickPrivateBroadcastNetwork()` chooses i2p but we don't have any addrs for that network? I think the `while` loop below may try forever until addrman finally has something for i2p? But we *could* call `MaybePickPrivateBroadcastNetwork()` again or just switch to Tor if we know we have addrs there.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:31:42Z",
      "diff_hunk" : "@@ -2657,7 +2733,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             CAddress addr;\n             NodeSeconds addr_last_try{0s};\n \n-            if (fFeeler) {\n+            if (open_private_broadcast_to.has_value()) {\n+                std::tie(addr, addr_last_try) = addrman.Select(/*new_only=*/false, open_private_broadcast_to.value());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520139562",
      "id" : 1520139562,
      "line" : 2744,
      "node_id" : "PRRC_kwDOABII585am30q",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 2744,
      "original_position" : 160,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 267,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520139562/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520139562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520152548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520152548"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c09d6409c957af7c449a60778689d6715d9a6628 `num_stale` is a count of transactions but the other two numbers here count p2p connections, are we still going to use `NUM_PRIVATE_BROADCAST_PER_TX` here?",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:40:18Z",
      "diff_hunk" : "@@ -1797,10 +1820,56 @@ void PeerManagerImpl::ReattemptInitialBroadcast(CScheduler& scheduler)\n         }\n     }\n \n-    // Schedule next run for 10-15 minutes in the future.\n-    // We add randomness on every cycle to avoid the possibility of P2P fingerprinting.\n-    const std::chrono::milliseconds delta = 10min + GetRandMillis(5min);\n-    scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n+    scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, NextTxBroadcast());\n+}\n+\n+void PeerManagerImpl::ReattemptPrivateBroadcast(CScheduler& scheduler)\n+{\n+    // The following heuristic is subject to races, but that is ok: if it overshoots,\n+    // we will open some private connections in vain, if it undershoots, the stale\n+    // transactions will be picked on the next run.\n+\n+    size_t num_active{0};\n+    m_connman.ForEachNode([&num_active](const CNode* node) {\n+        if (node->IsPrivateBroadcastConn()) {\n+            ++num_active;\n+        }\n+    });\n+\n+    const size_t num_to_open{m_connman.NumPrivateBroadcastToOpen()};\n+\n+    // Remove stale transactions that are no longer relevant (e.g. already in\n+    // the mempool or mined) and count the remaining ones.\n+    size_t num_stale{0};\n+    const auto stale_txs = m_tx_for_private_broadcast.GetStale();\n+    {\n+        LOCK(cs_main);\n+        for (const auto& stale_tx : stale_txs) {\n+            auto mempool_acceptable = m_chainman.ProcessTransaction(stale_tx, /*test_accept=*/true);\n+            if (mempool_acceptable.m_result_type == MempoolAcceptResult::ResultType::VALID) {\n+                LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                              BCLog::Level::Debug,\n+                              \"Reattempting broadcast of stale txid=%s wtxid=%s\\n\",\n+                              stale_tx->GetHash().ToString(),\n+                              stale_tx->GetWitnessHash().ToString());\n+                ++num_stale;\n+            } else {\n+                LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                              BCLog::Level::Info,\n+                              \"Giving up broadcast attempts for txid=%s wtxid=%s: %s\\n\",\n+                              stale_tx->GetHash().ToString(),\n+                              stale_tx->GetWitnessHash().ToString(),\n+                              mempool_acceptable.m_state.ToString());\n+                m_tx_for_private_broadcast.Remove(stale_tx);\n+            }\n+        }\n+    }\n+\n+    if (num_stale > num_active + num_to_open) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520152548",
      "id" : 1520152548,
      "line" : 1885,
      "node_id" : "PRRC_kwDOABII585am6_k",
      "original_commit_id" : "c09d6409c957af7c449a60778689d6715d9a6628",
      "original_line" : 1885,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 385,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520152548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520152548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520180548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520180548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed to `privat`. Feel free to suggest another name.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:54:41Z",
      "diff_hunk" : "@@ -452,6 +452,7 @@ class NetinfoRequestHandler : public BaseRequestHandler\n         if (conn_type == \"block-relay-only\") return \"block\";\n         if (conn_type == \"manual\" || conn_type == \"feeler\") return conn_type;\n         if (conn_type == \"addr-fetch\") return \"addr\";\n+        if (conn_type == \"private-broadcast\") return \"privbcast\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520180548",
      "id" : 1520180548,
      "in_reply_to_id" : 1518063388,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585anB1E",
      "original_commit_id" : "7a0f492104c1621b7089a64fa330c72b06d30574",
      "original_line" : 455,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : null,
      "pull_request_review_id" : 1928640468,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520180548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T17:54:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520180548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520182217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520182217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, added!",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:55:04Z",
      "diff_hunk" : "@@ -75,6 +75,13 @@ enum class ConnectionType {\n      * AddrMan is empty.\n      */\n     ADDR_FETCH,\n+\n+    /**\n+     * Private broadcast connections are short-lived and only opened to\n+     * privacy networks (Tor, I2P) for relaying privacy-sensitive data (like\n+     * our own transactions) and closed afterwards.\n+     */\n+    PRIVATE_BROADCAST,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520182217",
      "id" : 1520182217,
      "in_reply_to_id" : 1518080397,
      "line" : 84,
      "node_id" : "PRRC_kwDOABII585anCPJ",
      "original_commit_id" : "7a0f492104c1621b7089a64fa330c72b06d30574",
      "original_line" : 84,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/node/connection_types.h",
      "position" : 10,
      "pull_request_review_id" : 1928643867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520182217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T17:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520182217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520183380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520183380"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes. Added a comment.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:55:22Z",
      "diff_hunk" : "@@ -456,7 +456,7 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n         if (addrConnect.IsI2P() && use_proxy) {\n             i2p::Connection conn;\n \n-            if (m_i2p_sam_session) {\n+            if (m_i2p_sam_session && conn_type != ConnectionType::PRIVATE_BROADCAST) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520183380",
      "id" : 1520183380,
      "in_reply_to_id" : 1518132032,
      "line" : 466,
      "node_id" : "PRRC_kwDOABII585anChU",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 466,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 1928646551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520183380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T17:55:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520183380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`6fad02cf03...d10a0649b0`: rebase due to conflicts and address some suggestions",
      "created_at" : "2024-03-11T17:56:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1989094391",
      "id" : 1989094391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852jyv3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989094391/reactions"
      },
      "updated_at" : "2024-03-11T17:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989094391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520191910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520191910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e36a1b4848f8f762b550a9469993211d41bd6cb9 heh, makes the placement of this function in `mempool.cpp` a bit arbitrary now!",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T17:59:08Z",
      "diff_hunk" : "@@ -89,11 +91,14 @@ static RPCHelpMan sendrawtransaction()\n             std::string err_string;\n             AssertLockNotHeld(cs_main);\n             NodeContext& node = EnsureAnyNodeContext(request.context);\n+            const auto method = gArgs.GetBoolArg(\"-privatebroadcast\", DEFAULT_PRIVATE_BROADCAST) ?\n+                                    NO_MEMPOOL_PRIVATE_BROADCAST :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520191910",
      "id" : 1520191910,
      "line" : 95,
      "node_id" : "PRRC_kwDOABII585anEmm",
      "original_commit_id" : "e36a1b4848f8f762b550a9469993211d41bd6cb9",
      "original_line" : 95,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 17,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520191910/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520191910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520210992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520210992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "2b2e747455699236200fa3cddddfff7005f6a44a Could be overkill, but you could actually adjust the \"dummy response\" a few lines up to actually respond accurately, in particular the `REPLY` field could be used to report a connection failure back to bitcoind.\r\n\r\nFrom https://www.rfc-editor.org/rfc/rfc1928\r\n\r\n```diff\r\ndiff --git a/test/functional/test_framework/socks5.py b/test/functional/test_framework/socks5.py\r\nindex 48ad8bbeea..568e9fa64c 100644\r\n--- a/test/functional/test_framework/socks5.py\r\n+++ b/test/functional/test_framework/socks5.py\r\n@@ -123,7 +123,14 @@ class Socks5Connection():\r\n             port = (port_hi << 8) | port_lo\r\n \r\n             # Send dummy response\r\n-            self.conn.sendall(bytearray([0x05, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]))\r\n+            self.conn.sendall(bytearray([\r\n+                0x05, # Protocol version\r\n+                0x00, # Reply (0x00 = success)\r\n+                0x00, # Reserved (must be 0x00)\r\n+                0x01, # Server bound address type (0x01 = ipv4)\r\n+                0x00, 0x00, 0x00, 0x00, # Server bound ipv4 address\r\n+                0x00, 0x00 # Server bound port\r\n+            ]))\r\n \r\n             cmdin = Socks5Command(cmd, atyp, addr, port, username, password)\r\n             self.serv.queue.put(cmdin)\r\n\r\n```",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T18:13:52Z",
      "diff_hunk" : "@@ -117,6 +128,33 @@ def handle(self):\n             cmdin = Socks5Command(cmd, atyp, addr, port, username, password)\n             self.serv.queue.put(cmdin)\n             logger.debug('Proxy: %s', cmdin)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520210992",
      "id" : 1520210992,
      "line" : 131,
      "node_id" : "PRRC_kwDOABII585anJQw",
      "original_commit_id" : "2b2e747455699236200fa3cddddfff7005f6a44a",
      "original_line" : 131,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/socks5.py",
      "position" : 29,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520210992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520210992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520232425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520232425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d10a0649b018638574fa7dc316b3e783bf6cee69 just a guess, would this work?\r\n1. start the node with `-addnode=<ipv4>` x10\r\n2. wait for 10 outbounds to connect\r\n3. `addpeeraddress` with all the onion and i2p addrs\r\n4. send raw, etc...",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T18:21:54Z",
      "diff_hunk" : "@@ -0,0 +1,311 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when private broadcast is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (tx_originator)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The private broadcast TX recipients\n+               |   |       (NUM_PRIVATE_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> Bitcoin Core (node1) (self.socks5_server.conf.destinations[i][\"node\"] is None)\n+               |   |                          ^\n+               |   |                          *----< P2PInterface (far_observer) (to check Bitcoin Core relays the tx)\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< P2PDataStore (observer_inbound)\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_inv,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+NUM_INITIAL_CONNECTIONS = MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS\n+NUM_PRIVATE_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520232425",
      "id" : 1520232425,
      "line" : 66,
      "node_id" : "PRRC_kwDOABII585anOfp",
      "original_commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "original_line" : 66,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/p2p_private_broadcast.py",
      "position" : 66,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520232425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520232425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520245249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520245249"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d10a0649b018638574fa7dc316b3e783bf6cee69 nit: slightly confusing to prefix these with `listen_` I would expect, like:\r\n`to_addr` `to_port` `requested_to_addr`",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T18:26:52Z",
      "diff_hunk" : "@@ -0,0 +1,311 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when private broadcast is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (tx_originator)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The private broadcast TX recipients\n+               |   |       (NUM_PRIVATE_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> Bitcoin Core (node1) (self.socks5_server.conf.destinations[i][\"node\"] is None)\n+               |   |                          ^\n+               |   |                          *----< P2PInterface (far_observer) (to check Bitcoin Core relays the tx)\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< P2PDataStore (observer_inbound)\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_inv,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+NUM_INITIAL_CONNECTIONS = MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS\n+NUM_PRIVATE_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for private broadcast.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",\n+]\n+\n+class P2PPrivateBroadcast(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.disable_autoconnect = False\n+        self.num_nodes = 2\n+\n+    def setup_nodes(self):\n+        # Start a SOCKS5 proxy server.\n+        socks5_server_config = Socks5Configuration()\n+        # self.nodes[0] listens on p2p_port(0),\n+        # self.nodes[1] listens on p2p_port(1),\n+        # thus we tell the SOCKS5 server to listen on p2p_port(self.num_nodes (which is 2))\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\n+        socks5_server_config.unauth = True\n+        socks5_server_config.auth = True\n+\n+        self.socks5_server = Socks5Server(socks5_server_config)\n+        self.socks5_server.start()\n+\n+        ports_base = p2p_port(MAX_NODES) + 15000\n+\n+        # Add 2 because one feeler and one extra block relay connections may\n+        # sneak in between the private broadcast connections.\n+        for i in range(NUM_INITIAL_CONNECTIONS + NUM_PRIVATE_BROADCAST_PER_TX + 2):\n+            if i == NUM_INITIAL_CONNECTIONS:\n+                # Instruct the SOCKS5 server to redirect the first private\n+                # broadcast connection from nodes[0] to nodes[1]\n+                self.socks5_server.conf.destinations.append({\n+                    \"listen_addr\": \"127.0.0.1\", # nodes[1] listen address\n+                    \"listen_port\": p2p_port(1), # nodes[1] listen port",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520245249",
      "id" : 1520245249,
      "line" : 182,
      "node_id" : "PRRC_kwDOABII585anRoB",
      "original_commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "original_line" : 182,
      "original_position" : 182,
      "original_start_line" : 181,
      "path" : "test/functional/p2p_private_broadcast.py",
      "position" : 182,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520245249/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 181,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520245249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520261754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520261754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "d10a0649b018638574fa7dc316b3e783bf6cee69 sanity check: you can assert this because none of the private-broadcast peers are connected back to the `tx_originator`?",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-11T18:40:21Z",
      "diff_hunk" : "@@ -0,0 +1,311 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when private broadcast is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (tx_originator)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The private broadcast TX recipients\n+               |   |       (NUM_PRIVATE_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> Bitcoin Core (node1) (self.socks5_server.conf.destinations[i][\"node\"] is None)\n+               |   |                          ^\n+               |   |                          *----< P2PInterface (far_observer) (to check Bitcoin Core relays the tx)\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< P2PDataStore (observer_inbound)\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_inv,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+NUM_INITIAL_CONNECTIONS = MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS\n+NUM_PRIVATE_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for private broadcast.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",\n+]\n+\n+class P2PPrivateBroadcast(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.disable_autoconnect = False\n+        self.num_nodes = 2\n+\n+    def setup_nodes(self):\n+        # Start a SOCKS5 proxy server.\n+        socks5_server_config = Socks5Configuration()\n+        # self.nodes[0] listens on p2p_port(0),\n+        # self.nodes[1] listens on p2p_port(1),\n+        # thus we tell the SOCKS5 server to listen on p2p_port(self.num_nodes (which is 2))\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\n+        socks5_server_config.unauth = True\n+        socks5_server_config.auth = True\n+\n+        self.socks5_server = Socks5Server(socks5_server_config)\n+        self.socks5_server.start()\n+\n+        ports_base = p2p_port(MAX_NODES) + 15000\n+\n+        # Add 2 because one feeler and one extra block relay connections may\n+        # sneak in between the private broadcast connections.\n+        for i in range(NUM_INITIAL_CONNECTIONS + NUM_PRIVATE_BROADCAST_PER_TX + 2):\n+            if i == NUM_INITIAL_CONNECTIONS:\n+                # Instruct the SOCKS5 server to redirect the first private\n+                # broadcast connection from nodes[0] to nodes[1]\n+                self.socks5_server.conf.destinations.append({\n+                    \"listen_addr\": \"127.0.0.1\", # nodes[1] listen address\n+                    \"listen_port\": p2p_port(1), # nodes[1] listen port\n+                    \"node\": None,\n+                    \"requested_to_addr\": None,\n+                })\n+            else:\n+                # Create a Python P2P listening node and add it to self.socks5_server.conf.destinations[]\n+                listener = P2PInterface()\n+                listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+                listener.peer_connect_send_version(services=P2P_SERVICES)\n+                self.network_thread.listen(\n+                    p2p=listener,\n+                    # Instruct the SOCKS5 server to redirect a connection to this Python P2P listener.\n+                    callback=lambda addr, port: self.socks5_server.conf.destinations.append({\n+                        \"listen_addr\": addr,\n+                        \"listen_port\": port,\n+                        \"node\": None,\n+                        \"requested_to_addr\": None,\n+                    }),\n+                    addr=\"127.0.0.1\",\n+                    port=ports_base + i)\n+                # Wait until the callback has been called and it has done append().\n+                self.wait_until(lambda: len(self.socks5_server.conf.destinations) == i + 1)\n+\n+                self.socks5_server.conf.destinations[i][\"node\"] = listener\n+\n+        self.extra_args = [\n+            [\n+                \"-peerbloomfilters\", # needed to test replies to MEMPOOL\n+                \"-cjdnsreachable\", # needed to be able to add CJDNS addresses to addrman (otherwise they are unroutable).\n+                \"-privatebroadcast\",\n+                f\"-proxy={socks5_server_config.addr[0]}:{socks5_server_config.addr[1]}\",\n+            ],\n+            [\n+                \"-connect=0\",\n+                f\"-bind=127.0.0.1:{p2p_port(1)}=onion\", # consider all incoming as coming from Tor\n+            ],\n+        ]\n+        super().setup_nodes()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        tx_originator = self.nodes[0]\n+\n+        observer_inbound = tx_originator.add_p2p_connection(P2PDataStore())\n+\n+        # Fill tx_originator's addrman.\n+        for addr in addresses:\n+            res = tx_originator.addpeeraddress(address=addr, port=8333, tried=False)\n+            if res[\"success\"]:\n+                self.log.debug(f\"Added {addr} to tx_originator's addrman\")\n+            else:\n+                self.log.debug(f\"Could not add {addr} to tx_originator's addrman (collision?)\")\n+\n+        self.wait_until(lambda: self.socks5_server.conf.destinations_used == NUM_INITIAL_CONNECTIONS)\n+\n+        node1 = self.nodes[1]\n+        far_observer = node1.add_p2p_connection(P2PInterface())\n+\n+        # The next opened connections should be \"private broadcast\" for sending the transaction.\n+\n+        miniwallet = MiniWallet(tx_originator)\n+        tx = miniwallet.send_self_transfer(from_node=tx_originator)\n+        self.log.info(f\"Created transaction txid={tx['txid']}\")\n+\n+        self.log.debug(f\"Inspecting outbound connection i={NUM_INITIAL_CONNECTIONS}, must be the first private broadcast connection\")\n+        self.wait_until(lambda: len(node1.getrawmempool()) > 0)\n+        far_observer.wait_for_tx(tx[\"txid\"])\n+        self.log.debug(f\"Outbound connection i={NUM_INITIAL_CONNECTIONS}: the private broadcast target received and further relayed the transaction\")\n+\n+        num_private_broadcast_opened = 1 # already 1 connection to node1, confirmed by far_observer getting the tx\n+        for i in range(NUM_INITIAL_CONNECTIONS + 1, len(self.socks5_server.conf.destinations)):\n+            self.log.debug(f\"Inspecting outbound connection i={i}\")\n+            # At this point the connection may not yet have been established (A),\n+            # may be active (B), or may have already been closed (C).\n+            peer = self.socks5_server.conf.destinations[i][\"node\"]\n+            peer.wait_until(lambda: peer.message_count[\"version\"] == 1, check_connected=False)\n+            # Now it is either (B) or (C).\n+            requested_to_addr = self.socks5_server.conf.destinations[i][\"requested_to_addr\"]\n+            if peer.last_message[\"version\"].nServices != 0:\n+                self.log.debug(f\"Outbound connection i={i} to {requested_to_addr} not a private broadcast, ignoring it (maybe feeler or extra block only)\")\n+                continue\n+            self.log.debug(f\"Outbound connection i={i} to {requested_to_addr} must be a private broadcast, checking it\")\n+            assert requested_to_addr.endswith(\".onion\")\n+            peer.wait_for_disconnect()\n+            # Now it is (C).\n+            assert_equal(peer.message_count, {\n+                \"version\": 1,\n+                \"verack\": 1,\n+                \"tx\": 1,\n+                \"ping\": 1\n+            })\n+            dummy_address = CAddress()\n+            dummy_address.nServices = 0\n+            assert_equal(peer.last_message[\"version\"].nVersion, P2P_VERSION)\n+            assert_equal(peer.last_message[\"version\"].nServices, 0)\n+            assert_equal(peer.last_message[\"version\"].nTime, 0)\n+            assert_equal(peer.last_message[\"version\"].addrTo, dummy_address)\n+            assert_equal(peer.last_message[\"version\"].addrFrom, dummy_address)\n+            assert_equal(peer.last_message[\"version\"].strSubVer, \"/pynode:0.0.1/\")\n+            assert_equal(peer.last_message[\"version\"].nStartingHeight, 0)\n+            assert_equal(peer.last_message[\"version\"].relay, 0)\n+            assert_equal(peer.last_message[\"tx\"].tx.rehash(), tx[\"txid\"])\n+            self.log.debug(f\"Outbound connection i={i} is proper private broadcast, test ok\")\n+            num_private_broadcast_opened += 1\n+            if num_private_broadcast_opened == NUM_PRIVATE_BROADCAST_PER_TX:\n+                break\n+        assert_equal(num_private_broadcast_opened, NUM_PRIVATE_BROADCAST_PER_TX)\n+\n+        wtxid_int = int(tx[\"wtxid\"], 16)\n+        inv = CInv(MSG_WTX, wtxid_int)\n+\n+        self.log.info(\"Checking that the transaction is not in the originator node's mempool\")\n+        assert len(tx_originator.getrawmempool()) == 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1520261754",
      "id" : 1520261754,
      "line" : 296,
      "node_id" : "PRRC_kwDOABII585anVp6",
      "original_commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "original_line" : 296,
      "original_position" : 296,
      "original_start_line" : 295,
      "path" : "test/functional/p2p_private_broadcast.py",
      "position" : 296,
      "pull_request_review_id" : 1928558982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520261754/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 295,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-11T18:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520261754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521442428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521442428"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It would be possible.\r\n`-privatebroadcast=1 -listenonion=1 -torcontrol=... -torpassword=...` would do exactly that and allow the startup to proceed. However, `args.IsArgSet(\"-onlynet\")` was misplaced. It was intended to give error on things like\r\n`-privatebroadcast=1 -listenonion=1 -torcontrol=... -torpassword=... -onlynet=ipv4` but it was too strong and would mistakenly forbid\r\n`-privatebroadcast=1 -listenonion=1 -torcontrol=... -torpassword=... -onlynet=onion` as well.\r\n\r\nChanged.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-12T13:12:59Z",
      "diff_hunk" : "@@ -1900,6 +1911,23 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n \n     connOptions.m_i2p_accept_incoming = args.GetBoolArg(\"-i2pacceptincoming\", DEFAULT_I2P_ACCEPT_INCOMING);\n \n+    if (args.GetBoolArg(\"-privatebroadcast\", DEFAULT_PRIVATE_BROADCAST)) {\n+        // If -listenonion is set, then NET_ONION may not be reachable now\n+        // but may become reachable later, thus only error here if it is not\n+        // reachable and will not become reachable for sure.\n+        if (!g_reachable_nets.Contains(NET_I2P) && !g_reachable_nets.Contains(NET_ONION) &&\n+            (!listenonion || args.IsArgSet(\"-onlynet\"))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521442428",
      "id" : 1521442428,
      "in_reply_to_id" : 1517981961,
      "line" : 1961,
      "node_id" : "PRRC_kwDOABII585ar158",
      "original_commit_id" : "72f0dbc99e6eed26bef21965dabc5f0bebf01b33",
      "original_line" : 1961,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 100,
      "pull_request_review_id" : 1931025116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521442428/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T13:12:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521442428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521449066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521449066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it is ok. This function is a helper of the caller which opens the connection. The doc of the function reads: `Decide whether to open a private broadcast connection and if yes, to which network.`",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-12T13:16:53Z",
      "diff_hunk" : "@@ -2413,6 +2413,63 @@ bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n     return false;\n }\n \n+/**\n+ * Decide whether to open a private broadcast connection and if yes, to which network.\n+ * @param[in,out] net If the previous attempt to open a connection was an attempt to\n+ * open a private broadcast connection (successful or not), then this should have a\n+ * value. When the function ends if this has value then it will contain the network\n+ * to which to open the connection.\n+ * @param[in] num_needed Number of private broadcast connections that need to be opened.\n+ * @param[in] num_opened Number of private broadcast connections that are currently opened.\n+ */\n+static void MaybePickPrivateBroadcastNetwork(std::optional<Network>& net, size_t num_needed, size_t num_opened)\n+{\n+    if (net.has_value()) {\n+        // Yield to other connection types.\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_needed == 0) {\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    if (num_opened >= MAX_PRIVATE_BROADCAST_CONNECTIONS) {\n+        LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                      BCLog::Level::Debug,\n+                      \"Requested to open %d connection(s), but there are already %d \"\n+                      \"connections opened. Will wait for some of them to be closed \"\n+                      \"before opening a new one\\n\",\n+                      num_needed,\n+                      num_opened);\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    const bool tor_reachable{g_reachable_nets.Contains(NET_ONION)};\n+    const bool i2p_reachable{g_reachable_nets.Contains(NET_I2P)};\n+    if (tor_reachable && i2p_reachable) {\n+        net = FastRandomContext{}.randbool() ? NET_ONION : NET_I2P;\n+    } else if (tor_reachable) {\n+        net = NET_ONION;\n+    } else if (i2p_reachable) {\n+        net = NET_I2P;\n+    } else {\n+        LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                      BCLog::Level::Warning,\n+                      \"Requested to open %d connection(s) but none of the Tor or I2P networks is reachable.\\n\",\n+                      num_needed);\n+        net = std::nullopt;\n+        return;\n+    }\n+\n+    LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                  BCLog::Level::Debug,\n+                  \"Requested to open %d connection(s), trying to open one\\n\",\n+                  num_needed);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521449066",
      "id" : 1521449066,
      "in_reply_to_id" : 1518175963,
      "line" : 2477,
      "node_id" : "PRRC_kwDOABII585ar3hq",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 2477,
      "original_position" : 67,
      "original_start_line" : 2467,
      "path" : "src/net.cpp",
      "position" : 96,
      "pull_request_review_id" : 1931037458,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521449066/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2474,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-12T13:16:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521449066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521573338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521573338"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added `Assume()`",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-12T14:29:17Z",
      "diff_hunk" : "@@ -2886,6 +2964,16 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n         return;\n     pnode->grantOutbound = std::move(grant_outbound);\n \n+    if (conn_type == ConnectionType::PRIVATE_BROADCAST) {\n+        const size_t before_sub{m_private_broadcast_connections_to_open.fetch_sub(1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521573338",
      "id" : 1521573338,
      "in_reply_to_id" : 1518178949,
      "line" : 2975,
      "node_id" : "PRRC_kwDOABII585asV3a",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 2975,
      "original_position" : 170,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 277,
      "pull_request_review_id" : 1931240276,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521573338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T14:29:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521573338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521584926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521584926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, changed.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-12T14:36:08Z",
      "diff_hunk" : "@@ -2051,7 +2065,7 @@ NodeClock::time_point CWallet::GetDefaultNextResend() { return FastRandomContext\n // that depends on the `relay` option. Periodic rebroadcast uses the pattern\n // relay=true force=false, while loading into the mempool\n // (on start, or after import) uses relay=false force=true.\n-void CWallet::ResubmitWalletTransactions(bool relay, bool force)\n+void CWallet::ResubmitWalletTransactions(TxBroadcastMethod broadcast_method, bool force)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521584926",
      "id" : 1521584926,
      "in_reply_to_id" : 1518194970,
      "line" : 2068,
      "node_id" : "PRRC_kwDOABII585asYse",
      "original_commit_id" : "532e63279a3c04fef8da2c1bb95e5280c94abc4e",
      "original_line" : 2068,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 46,
      "pull_request_review_id" : 1931259359,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521584926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T14:36:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521584926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521812693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521812693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://www.erisian.com.au/bitcoin-core-dev/log-2024-03-12.html#l-136 switched to `SaltedTxidHasher`.",
      "commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "created_at" : "2024-03-12T16:49:32Z",
      "diff_hunk" : "@@ -1083,6 +1087,62 @@ class PeerManagerImpl final : public PeerManager\n \n     void AddAddressKnown(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n     void PushAddress(Peer& peer, const CAddress& addr) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);\n+\n+    /**\n+     * Store a list of transactions to be broadcast privately. Supports the following operations:\n+     * - Add a new transaction\n+     * - Remove a transaction, after it has been seen by the network\n+     * - Mark a broadcast of a transaction (remember when and how many times)\n+     * - Get a transaction for broadcast, the one that has been broadcast less times and least recently\n+     */\n+    class PrivateBroadcast\n+    {\n+    public:\n+        void Add(const CTransactionRef& tx) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+        {\n+            const Txid& txid = tx->GetHash();\n+            LOCK(m_mutex);\n+            auto [pos, inserted] = m_by_txid.emplace(txid, TxWithPriority{.tx = tx, .priority = Priority{}});\n+            if (inserted) {\n+                m_by_priority.emplace(Priority{}, txid);\n+            }\n+        }\n+\n+    private:\n+        struct Priority {\n+            size_t num_broadcasted{0};\n+            std::chrono::microseconds last_broadcasted{0};\n+\n+            bool operator<(const Priority& other) const\n+            {\n+                if (num_broadcasted < other.num_broadcasted) {\n+                    return true;\n+                }\n+                return last_broadcasted < other.last_broadcasted;\n+            }\n+        };\n+\n+        struct TxWithPriority {\n+            CTransactionRef tx;\n+            Priority priority;\n+        };\n+\n+        struct TxidHasher {\n+            size_t operator()(const Txid& txid) const { return SipHashUint256(0, 0, txid.ToUint256()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521812693",
      "id" : 1521812693,
      "in_reply_to_id" : 1518225842,
      "line" : 1236,
      "node_id" : "PRRC_kwDOABII585atQTV",
      "original_commit_id" : "eb9d7386ca82319ab682fc20ab35c13340d108a4",
      "original_line" : 1236,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 195,
      "pull_request_review_id" : 1931643945,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521812693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T16:49:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521812693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521854424"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521854424"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added `Assume()` that the entry is found.",
      "commit_id" : "b6dce67064de0f55ea108e6fdcf7eae2e3c2c462",
      "created_at" : "2024-03-12T17:20:01Z",
      "diff_hunk" : "@@ -1108,6 +1116,71 @@ class PeerManagerImpl final : public PeerManager\n             }\n         }\n \n+        /**\n+         * Get the transaction that has been broadcast less times and least recently.\n+         */\n+        std::optional<CTransactionRef> GetTxForBroadcast() const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+        {\n+            LOCK(m_mutex);\n+            if (m_by_priority.empty()) {\n+                return std::nullopt;\n+            }\n+            const Txid& txid = m_by_priority.begin()->second;\n+            auto it = m_by_txid.find(txid);\n+            if (it == m_by_txid.end()) {\n+                return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521854424",
      "id" : 1521854424,
      "in_reply_to_id" : 1518256562,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585atafY",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 1150,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1931752158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521854424/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T17:20:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521854424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521863661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521863661"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See this: https://github.com/bitcoin/bitcoin/pull/27509#discussion_r1214671917",
      "commit_id" : "b6dce67064de0f55ea108e6fdcf7eae2e3c2c462",
      "created_at" : "2024-03-12T17:27:09Z",
      "diff_hunk" : "@@ -1566,26 +1665,53 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n \n void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n {\n-    uint64_t my_services{peer.m_our_services};\n-    const int64_t nTime{count_seconds(GetTime<std::chrono::seconds>())};\n-    uint64_t nonce = pnode.GetLocalNonce();\n-    const int nNodeStartingHeight{m_best_height};\n-    NodeId nodeid = pnode.GetId();\n-    CAddress addr = pnode.addr;\n-\n-    CService addr_you = addr.IsRoutable() && !IsProxy(addr) && addr.IsAddrV1Compatible() ? addr : CService();\n-    uint64_t your_services{addr.nServices};\n-\n-    const bool tx_relay{!RejectIncomingTxs(pnode)};\n-    MakeAndPushMessage(pnode, NetMsgType::VERSION, PROTOCOL_VERSION, my_services, nTime,\n-            your_services, CNetAddr::V1(addr_you), // Together the pre-version-31402 serialization of CAddress \"addrYou\" (without nTime)\n-            my_services, CNetAddr::V1(CService{}), // Together the pre-version-31402 serialization of CAddress \"addrMe\" (without nTime)\n-            nonce, strSubVersion, nNodeStartingHeight, tx_relay);\n-\n+    uint64_t my_services;\n+    int64_t my_time;\n+    uint64_t your_services;\n+    CService your_addr;\n+    std::string my_user_agent;\n+    int my_height;\n+    bool my_tx_relay;\n+    if (pnode.IsPrivateBroadcastConn()) {\n+        my_services = NODE_NONE;\n+        my_time = 0;\n+        your_services = NODE_NONE;\n+        your_addr = CService{};\n+        my_user_agent = \"/pynode:0.0.1/\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521863661",
      "id" : 1521863661,
      "in_reply_to_id" : 1518263617,
      "line" : 1726,
      "node_id" : "PRRC_kwDOABII585atcvt",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 1726,
      "original_position" : 172,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 268,
      "pull_request_review_id" : 1931777320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521863661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T17:27:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521863661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521865397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521865397"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Somehow I find this more clear. Some redundancy doesn't hurt.",
      "commit_id" : "b6dce67064de0f55ea108e6fdcf7eae2e3c2c462",
      "created_at" : "2024-03-12T17:28:08Z",
      "diff_hunk" : "@@ -3706,7 +3885,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                       (mapped_as ? strprintf(\", mapped_as=%d\", mapped_as) : \"\"));\n         }\n \n-        if (pfrom.GetCommonVersion() >= SHORT_IDS_BLOCKS_VERSION) {\n+        if (pfrom.GetCommonVersion() >= SHORT_IDS_BLOCKS_VERSION && !pfrom.IsPrivateBroadcastConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521865397",
      "id" : 1521865397,
      "in_reply_to_id" : 1518279844,
      "line" : 3993,
      "node_id" : "PRRC_kwDOABII585atdK1",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 3993,
      "original_position" : 291,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 616,
      "pull_request_review_id" : 1931781298,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521865397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T17:28:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521865397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521879812"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521879812"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "By \"probably successful private broadcast\" I meant that probably the transaction will successfully reach the network, not that we successfully gave it to one peer. Reworded.\r\n\r\n~Also the return value of `BroadcastEnd()` was not used by the callers. Changed it to `void`.~ ignore this nonsense",
      "commit_id" : "b6dce67064de0f55ea108e6fdcf7eae2e3c2c462",
      "created_at" : "2024-03-12T17:37:14Z",
      "diff_hunk" : "@@ -4929,6 +5133,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     if (ping_time.count() >= 0) {\n                         // Let connman know about this successful ping-pong\n                         pfrom.PongReceived(ping_time);\n+                        if (pfrom.IsPrivateBroadcastConn()) {\n+                            m_tx_for_private_broadcast.BroadcastEnd(pfrom.GetId(), /*confirmed_by_node=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521879812",
      "id" : 1521879812,
      "in_reply_to_id" : 1518282738,
      "line" : 5253,
      "node_id" : "PRRC_kwDOABII585atgsE",
      "original_commit_id" : "07dee91112189be02c6694385de261570725b56b",
      "original_line" : 5253,
      "original_position" : 339,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 699,
      "pull_request_review_id" : 1931815592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521879812/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T18:01:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521879812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521896483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521896483"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, in that case `Select()` will return an invalid address and we will `break;` from the inside loop. Then the outside loop will call `MaybePickPrivateBroadcastNetwork()` again.",
      "commit_id" : "b6dce67064de0f55ea108e6fdcf7eae2e3c2c462",
      "created_at" : "2024-03-12T17:50:14Z",
      "diff_hunk" : "@@ -2657,7 +2733,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             CAddress addr;\n             NodeSeconds addr_last_try{0s};\n \n-            if (fFeeler) {\n+            if (open_private_broadcast_to.has_value()) {\n+                std::tie(addr, addr_last_try) = addrman.Select(/*new_only=*/false, open_private_broadcast_to.value());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521896483",
      "id" : 1521896483,
      "in_reply_to_id" : 1520139562,
      "line" : 2746,
      "node_id" : "PRRC_kwDOABII585atkwj",
      "original_commit_id" : "4e19f9cc9834c0b76a2d03fea0921879de46fea9",
      "original_line" : 2746,
      "original_position" : 160,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 267,
      "pull_request_review_id" : 1931861170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521896483/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T17:50:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521896483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521900121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521900121"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`NUM_PRIVATE_BROADCAST_PER_TX` is just for the initial broadcast. Then if a transaction gets stale, we retry one shot at a time. There is no special reason for this. Could be either way.",
      "commit_id" : "b6dce67064de0f55ea108e6fdcf7eae2e3c2c462",
      "created_at" : "2024-03-12T17:53:17Z",
      "diff_hunk" : "@@ -1797,10 +1820,56 @@ void PeerManagerImpl::ReattemptInitialBroadcast(CScheduler& scheduler)\n         }\n     }\n \n-    // Schedule next run for 10-15 minutes in the future.\n-    // We add randomness on every cycle to avoid the possibility of P2P fingerprinting.\n-    const std::chrono::milliseconds delta = 10min + GetRandMillis(5min);\n-    scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n+    scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, NextTxBroadcast());\n+}\n+\n+void PeerManagerImpl::ReattemptPrivateBroadcast(CScheduler& scheduler)\n+{\n+    // The following heuristic is subject to races, but that is ok: if it overshoots,\n+    // we will open some private connections in vain, if it undershoots, the stale\n+    // transactions will be picked on the next run.\n+\n+    size_t num_active{0};\n+    m_connman.ForEachNode([&num_active](const CNode* node) {\n+        if (node->IsPrivateBroadcastConn()) {\n+            ++num_active;\n+        }\n+    });\n+\n+    const size_t num_to_open{m_connman.NumPrivateBroadcastToOpen()};\n+\n+    // Remove stale transactions that are no longer relevant (e.g. already in\n+    // the mempool or mined) and count the remaining ones.\n+    size_t num_stale{0};\n+    const auto stale_txs = m_tx_for_private_broadcast.GetStale();\n+    {\n+        LOCK(cs_main);\n+        for (const auto& stale_tx : stale_txs) {\n+            auto mempool_acceptable = m_chainman.ProcessTransaction(stale_tx, /*test_accept=*/true);\n+            if (mempool_acceptable.m_result_type == MempoolAcceptResult::ResultType::VALID) {\n+                LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                              BCLog::Level::Debug,\n+                              \"Reattempting broadcast of stale txid=%s wtxid=%s\\n\",\n+                              stale_tx->GetHash().ToString(),\n+                              stale_tx->GetWitnessHash().ToString());\n+                ++num_stale;\n+            } else {\n+                LogPrintLevel(BCLog::PRIVATE_BROADCAST,\n+                              BCLog::Level::Info,\n+                              \"Giving up broadcast attempts for txid=%s wtxid=%s: %s\\n\",\n+                              stale_tx->GetHash().ToString(),\n+                              stale_tx->GetWitnessHash().ToString(),\n+                              mempool_acceptable.m_state.ToString());\n+                m_tx_for_private_broadcast.Remove(stale_tx);\n+            }\n+        }\n+    }\n+\n+    if (num_stale > num_active + num_to_open) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1521900121",
      "id" : 1521900121,
      "in_reply_to_id" : 1520152548,
      "line" : 1887,
      "node_id" : "PRRC_kwDOABII585atlpZ",
      "original_commit_id" : "c09d6409c957af7c449a60778689d6715d9a6628",
      "original_line" : 1887,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 382,
      "pull_request_review_id" : 1931871701,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521900121/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T17:53:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521900121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`d10a0649b0...5ca891f4e0`: address some suggestions",
      "created_at" : "2024-03-12T18:03:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1992254693",
      "id" : 1992254693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852v2Tl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992254693/reactions"
      },
      "updated_at" : "2024-03-12T18:03:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992254693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-12T18:04:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1992257289",
      "id" : 1992257289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852v28J",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992257289/reactions"
      },
      "updated_at" : "2024-03-12T18:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992257289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`5ca891f4e0...b6dce67064`: rebase due to conflicts",
      "created_at" : "2024-03-12T18:06:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1992260133",
      "id" : 1992260133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII5852v3ol",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992260133/reactions"
      },
      "updated_at" : "2024-03-12T18:06:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992260133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1523138657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523138657"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, it was before as well. Somehow the code and the comments around this say that \"the transaction is sent to the mempool for broadcast\" which is not quite accurate (in `master`). I don't think that the mempool is broadcasting the transaction. Will leave it as it is for now.",
      "commit_id" : "cc867ebd6253deb0905be9547f915ab6d04aea8a",
      "created_at" : "2024-03-13T12:27:09Z",
      "diff_hunk" : "@@ -89,11 +91,14 @@ static RPCHelpMan sendrawtransaction()\n             std::string err_string;\n             AssertLockNotHeld(cs_main);\n             NodeContext& node = EnsureAnyNodeContext(request.context);\n+            const auto method = gArgs.GetBoolArg(\"-privatebroadcast\", DEFAULT_PRIVATE_BROADCAST) ?\n+                                    NO_MEMPOOL_PRIVATE_BROADCAST :",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1523138657",
      "id" : 1523138657,
      "in_reply_to_id" : 1520191910,
      "line" : 95,
      "node_id" : "PRRC_kwDOABII585ayUBh",
      "original_commit_id" : "e36a1b4848f8f762b550a9469993211d41bd6cb9",
      "original_line" : 95,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/mempool.cpp",
      "position" : 17,
      "pull_request_review_id" : 1933992798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523138657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-13T12:27:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523138657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1523162366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523162366"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, exactly.",
      "commit_id" : "cc867ebd6253deb0905be9547f915ab6d04aea8a",
      "created_at" : "2024-03-13T12:40:40Z",
      "diff_hunk" : "@@ -0,0 +1,311 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test how locally submitted transactions are sent to the network when private broadcast is used.\n+\n+The topology in the test is:\n+\n+Bitcoin Core (tx_originator)\n+               ^   v       The default full-outbound + block-only connections\n+               |   |       (MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS):\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[0][\"node\"])\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[1][\"node\"])\n+               |   ...\n+               |   |       The private broadcast TX recipients\n+               |   |       (NUM_PRIVATE_BROADCAST_PER_TX)\n+               |   |       plus maybe some feeler or extra block only connections:\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> Bitcoin Core (node1) (self.socks5_server.conf.destinations[i][\"node\"] is None)\n+               |   |                          ^\n+               |   |                          *----< P2PInterface (far_observer) (to check Bitcoin Core relays the tx)\n+               |   |\n+               |   *-----> SOCKS5 Proxy ---> P2PInterface (self.socks5_server.conf.destinations[i + 1][\"node\"])\n+               |   ...\n+               |\n+               *---------< P2PDataStore (observer_inbound)\n+\"\"\"\n+\n+from test_framework.p2p import (\n+    P2PDataStore,\n+    P2PInterface,\n+    P2P_SERVICES,\n+    P2P_VERSION,\n+)\n+from test_framework.messages import (\n+    CAddress,\n+    CInv,\n+    MSG_WTX,\n+    msg_inv,\n+)\n+from test_framework.socks5 import (\n+    Socks5Configuration,\n+    Socks5Server,\n+)\n+from test_framework.test_framework import (\n+    BitcoinTestFramework,\n+)\n+from test_framework.util import (\n+    MAX_NODES,\n+    assert_equal,\n+    p2p_port,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+)\n+\n+MAX_OUTBOUND_FULL_RELAY_CONNECTIONS = 8\n+MAX_BLOCK_RELAY_ONLY_CONNECTIONS = 2\n+NUM_INITIAL_CONNECTIONS = MAX_OUTBOUND_FULL_RELAY_CONNECTIONS + MAX_BLOCK_RELAY_ONLY_CONNECTIONS\n+NUM_PRIVATE_BROADCAST_PER_TX = 5\n+\n+# Fill addrman with these addresses. Must have enough Tor addresses, so that even\n+# if all 10 default connections are opened to a Tor address (!?) there must be more\n+# for private broadcast.\n+addresses = [\n+    \"1.65.195.98\",\n+    \"2.59.236.56\",\n+    \"2.83.114.20\",\n+    \"2.248.194.16\",\n+    \"5.2.154.6\",\n+    \"5.101.140.30\",\n+    \"5.128.87.126\",\n+    \"5.144.21.49\",\n+    \"5.172.132.104\",\n+    \"5.188.62.18\",\n+    \"5.200.2.180\",\n+    \"8.129.184.255\",\n+    \"8.209.105.138\",\n+    \"12.34.98.148\",\n+    \"14.199.102.151\",\n+    \"18.27.79.17\",\n+    \"18.27.124.231\",\n+    \"18.216.249.151\",\n+    \"23.88.155.58\",\n+    \"23.93.101.158\",\n+    \"[2001:19f0:1000:1db3:5400:4ff:fe56:5a8d]\",\n+    \"[2001:19f0:5:24da:3eec:efff:feb9:f36e]\",\n+    \"[2001:19f0:5:24da::]\",\n+    \"[2001:19f0:5:4535:3eec:efff:feb9:87e4]\",\n+    \"[2001:19f0:5:4535::]\",\n+    \"[2001:1bc0:c1::2000]\",\n+    \"[2001:1c04:4008:6300:8a5f:2678:114b:a660]\",\n+    \"[2001:41d0:203:3739::]\",\n+    \"[2001:41d0:203:8f49::]\",\n+    \"[2001:41d0:203:bb0a::]\",\n+    \"[2001:41d0:2:bf8f::]\",\n+    \"[2001:41d0:303:de8b::]\",\n+    \"[2001:41d0:403:3d61::]\",\n+    \"[2001:41d0:405:9600::]\",\n+    \"[2001:41d0:8:ed7f::1]\",\n+    \"[2001:41d0:a:69a2::1]\",\n+    \"[2001:41f0::62:6974:636f:696e]\",\n+    \"[2001:470:1b62::]\",\n+    \"[2001:470:1f05:43b:2831:8530:7179:5864]\",\n+    \"[2001:470:1f09:b14::11]\",\n+    \"2bqghnldu6mcug4pikzprwhtjjnsyederctvci6klcwzepnjd46ikjyd.onion\",\n+    \"4lr3w2iyyl5u5l6tosizclykf5v3smqroqdn2i4h3kq6pfbbjb2xytad.onion\",\n+    \"5g72ppm3krkorsfopcm2bi7wlv4ohhs4u4mlseymasn7g7zhdcyjpfid.onion\",\n+    \"5sbmcl4m5api5tqafi4gcckrn3y52sz5mskxf3t6iw4bp7erwiptrgqd.onion\",\n+    \"776aegl7tfhg6oiqqy76jnwrwbvcytsx2qegcgh2mjqujll4376ohlid.onion\",\n+    \"77mdte42srl42shdh2mhtjr7nf7dmedqrw6bkcdekhdvmnld6ojyyiad.onion\",\n+    \"azbpsh4arqlm6442wfimy7qr65bmha2zhgjg7wbaji6vvaug53hur2qd.onion\",\n+    \"b64xcbleqmwgq2u46bh4hegnlrzzvxntyzbmucn3zt7cssm7y4ubv3id.onion\",\n+    \"bsqbtcparrfihlwolt4xgjbf4cgqckvrvsfyvy6vhiqrnh4w6ghixoid.onion\",\n+    \"bsqbtctulf2g4jtjsdfgl2ed7qs6zz5wqx27qnyiik7laockryvszqqd.onion\",\n+    \"cwi3ekrwhig47dhhzfenr5hbvckj7fzaojygvazi2lucsenwbzwoyiqd.onion\",\n+    \"devinbtcmwkuitvxl3tfi5of4zau46ymeannkjv6fpnylkgf3q5fa3id.onion\",\n+    \"devinbtctu7uctl7hly2juu3thbgeivfnvw3ckj3phy6nyvpnx66yeyd.onion\",\n+    \"devinbtcyk643iruzfpaxw3on2jket7rbjmwygm42dmdyub3ietrbmid.onion\",\n+    \"dtql5vci4iaml4anmueftqr7bfgzqlauzfy4rc2tfgulldd3ekyijjyd.onion\",\n+    \"emzybtc25oddoa2prol2znpz2axnrg6k77xwgirmhv7igoiucddsxiad.onion\",\n+    \"emzybtc3ewh7zihpkdvuwlgxrhzcxy2p5fvjggp7ngjbxcytxvt4rjid.onion\",\n+    \"emzybtc454ewbviqnmgtgx3rgublsgkk23r4onbhidcv36wremue4kqd.onion\",\n+    \"emzybtc5bnpb2o6gh54oquiox54o4r7yn4a2wiiwzrjonlouaibm2zid.onion\",\n+    \"fpz6r5ppsakkwypjcglz6gcnwt7ytfhxskkfhzu62tnylcknh3eq6pad.onion\",\n+    \"255fhcp6ajvftnyo7bwz3an3t4a4brhopm3bamyh2iu5r3gnr2rq.b32.i2p\",\n+    \"27yrtht5b5bzom2w5ajb27najuqvuydtzb7bavlak25wkufec5mq.b32.i2p\",\n+    \"3gocb7wc4zvbmmebktet7gujccuux4ifk3kqilnxnj5wpdpqx2hq.b32.i2p\",\n+    \"4fcc23wt3hyjk3csfzcdyjz5pcwg5dzhdqgma6bch2qyiakcbboa.b32.i2p\",\n+    \"4osyqeknhx5qf3a73jeimexwclmt42cju6xdp7icja4ixxguu2hq.b32.i2p\",\n+    \"4umsi4nlmgyp4rckosg4vegd2ysljvid47zu7pqsollkaszcbpqq.b32.i2p\",\n+    \"6j2ezegd3e2e2x3o3pox335f5vxfthrrigkdrbgfbdjchm5h4awa.b32.i2p\",\n+    \"6n36ljyr55szci5ygidmxqer64qr24f4qmnymnbvgehz7qinxnla.b32.i2p\",\n+    \"72yjs6mvlby3ky6mgpvvlemmwq5pfcznrzd34jkhclgrishqdxva.b32.i2p\",\n+    \"a5qsnv3maw77mlmmzlcglu6twje6ttctd3fhpbfwcbpmewx6fczq.b32.i2p\",\n+    \"aovep2pco7v2k4rheofrgytbgk23eg22dczpsjqgqtxcqqvmxk6a.b32.i2p\",\n+    \"bitcoi656nll5hu6u7ddzrmzysdtwtnzcnrjd4rfdqbeey7dmn5a.b32.i2p\",\n+    \"brifkruhlkgrj65hffybrjrjqcgdgqs2r7siizb5b2232nruik3a.b32.i2p\",\n+    \"c4gfnttsuwqomiygupdqqqyy5y5emnk5c73hrfvatri67prd7vyq.b32.i2p\",\n+    \"day3hgxyrtwjslt54sikevbhxxs4qzo7d6vi72ipmscqtq3qmijq.b32.i2p\",\n+    \"du5kydummi23bjfp6bd7owsvrijgt7zhvxmz5h5f5spcioeoetwq.b32.i2p\",\n+    \"e55k6wu46rzp4pg5pk5npgbr3zz45bc3ihtzu2xcye5vwnzdy7pq.b32.i2p\",\n+    \"eciohu5nq7vsvwjjc52epskuk75d24iccgzmhbzrwonw6lx4gdva.b32.i2p\",\n+    \"ejlnngarmhqvune74ko7kk55xtgbz5i5ncs4vmnvjpy3l7y63xaa.b32.i2p\",\n+    \"fhzlp3xroabohnmjonu5iqazwhlbbwh5cpujvw2azcu3srqdceja.b32.i2p\",\n+    \"[fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa]\",\n+    \"[fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce]\",\n+    \"[fcdc:73ae:b1a9:1bf8:d4c2:811:a4c7:c34e]\",\n+]\n+\n+class P2PPrivateBroadcast(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.disable_autoconnect = False\n+        self.num_nodes = 2\n+\n+    def setup_nodes(self):\n+        # Start a SOCKS5 proxy server.\n+        socks5_server_config = Socks5Configuration()\n+        # self.nodes[0] listens on p2p_port(0),\n+        # self.nodes[1] listens on p2p_port(1),\n+        # thus we tell the SOCKS5 server to listen on p2p_port(self.num_nodes (which is 2))\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\n+        socks5_server_config.unauth = True\n+        socks5_server_config.auth = True\n+\n+        self.socks5_server = Socks5Server(socks5_server_config)\n+        self.socks5_server.start()\n+\n+        ports_base = p2p_port(MAX_NODES) + 15000\n+\n+        # Add 2 because one feeler and one extra block relay connections may\n+        # sneak in between the private broadcast connections.\n+        for i in range(NUM_INITIAL_CONNECTIONS + NUM_PRIVATE_BROADCAST_PER_TX + 2):\n+            if i == NUM_INITIAL_CONNECTIONS:\n+                # Instruct the SOCKS5 server to redirect the first private\n+                # broadcast connection from nodes[0] to nodes[1]\n+                self.socks5_server.conf.destinations.append({\n+                    \"listen_addr\": \"127.0.0.1\", # nodes[1] listen address\n+                    \"listen_port\": p2p_port(1), # nodes[1] listen port\n+                    \"node\": None,\n+                    \"requested_to_addr\": None,\n+                })\n+            else:\n+                # Create a Python P2P listening node and add it to self.socks5_server.conf.destinations[]\n+                listener = P2PInterface()\n+                listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+                listener.peer_connect_send_version(services=P2P_SERVICES)\n+                self.network_thread.listen(\n+                    p2p=listener,\n+                    # Instruct the SOCKS5 server to redirect a connection to this Python P2P listener.\n+                    callback=lambda addr, port: self.socks5_server.conf.destinations.append({\n+                        \"listen_addr\": addr,\n+                        \"listen_port\": port,\n+                        \"node\": None,\n+                        \"requested_to_addr\": None,\n+                    }),\n+                    addr=\"127.0.0.1\",\n+                    port=ports_base + i)\n+                # Wait until the callback has been called and it has done append().\n+                self.wait_until(lambda: len(self.socks5_server.conf.destinations) == i + 1)\n+\n+                self.socks5_server.conf.destinations[i][\"node\"] = listener\n+\n+        self.extra_args = [\n+            [\n+                \"-peerbloomfilters\", # needed to test replies to MEMPOOL\n+                \"-cjdnsreachable\", # needed to be able to add CJDNS addresses to addrman (otherwise they are unroutable).\n+                \"-privatebroadcast\",\n+                f\"-proxy={socks5_server_config.addr[0]}:{socks5_server_config.addr[1]}\",\n+            ],\n+            [\n+                \"-connect=0\",\n+                f\"-bind=127.0.0.1:{p2p_port(1)}=onion\", # consider all incoming as coming from Tor\n+            ],\n+        ]\n+        super().setup_nodes()\n+\n+    def setup_network(self):\n+        self.setup_nodes()\n+\n+    def run_test(self):\n+        tx_originator = self.nodes[0]\n+\n+        observer_inbound = tx_originator.add_p2p_connection(P2PDataStore())\n+\n+        # Fill tx_originator's addrman.\n+        for addr in addresses:\n+            res = tx_originator.addpeeraddress(address=addr, port=8333, tried=False)\n+            if res[\"success\"]:\n+                self.log.debug(f\"Added {addr} to tx_originator's addrman\")\n+            else:\n+                self.log.debug(f\"Could not add {addr} to tx_originator's addrman (collision?)\")\n+\n+        self.wait_until(lambda: self.socks5_server.conf.destinations_used == NUM_INITIAL_CONNECTIONS)\n+\n+        node1 = self.nodes[1]\n+        far_observer = node1.add_p2p_connection(P2PInterface())\n+\n+        # The next opened connections should be \"private broadcast\" for sending the transaction.\n+\n+        miniwallet = MiniWallet(tx_originator)\n+        tx = miniwallet.send_self_transfer(from_node=tx_originator)\n+        self.log.info(f\"Created transaction txid={tx['txid']}\")\n+\n+        self.log.debug(f\"Inspecting outbound connection i={NUM_INITIAL_CONNECTIONS}, must be the first private broadcast connection\")\n+        self.wait_until(lambda: len(node1.getrawmempool()) > 0)\n+        far_observer.wait_for_tx(tx[\"txid\"])\n+        self.log.debug(f\"Outbound connection i={NUM_INITIAL_CONNECTIONS}: the private broadcast target received and further relayed the transaction\")\n+\n+        num_private_broadcast_opened = 1 # already 1 connection to node1, confirmed by far_observer getting the tx\n+        for i in range(NUM_INITIAL_CONNECTIONS + 1, len(self.socks5_server.conf.destinations)):\n+            self.log.debug(f\"Inspecting outbound connection i={i}\")\n+            # At this point the connection may not yet have been established (A),\n+            # may be active (B), or may have already been closed (C).\n+            peer = self.socks5_server.conf.destinations[i][\"node\"]\n+            peer.wait_until(lambda: peer.message_count[\"version\"] == 1, check_connected=False)\n+            # Now it is either (B) or (C).\n+            requested_to_addr = self.socks5_server.conf.destinations[i][\"requested_to_addr\"]\n+            if peer.last_message[\"version\"].nServices != 0:\n+                self.log.debug(f\"Outbound connection i={i} to {requested_to_addr} not a private broadcast, ignoring it (maybe feeler or extra block only)\")\n+                continue\n+            self.log.debug(f\"Outbound connection i={i} to {requested_to_addr} must be a private broadcast, checking it\")\n+            assert requested_to_addr.endswith(\".onion\")\n+            peer.wait_for_disconnect()\n+            # Now it is (C).\n+            assert_equal(peer.message_count, {\n+                \"version\": 1,\n+                \"verack\": 1,\n+                \"tx\": 1,\n+                \"ping\": 1\n+            })\n+            dummy_address = CAddress()\n+            dummy_address.nServices = 0\n+            assert_equal(peer.last_message[\"version\"].nVersion, P2P_VERSION)\n+            assert_equal(peer.last_message[\"version\"].nServices, 0)\n+            assert_equal(peer.last_message[\"version\"].nTime, 0)\n+            assert_equal(peer.last_message[\"version\"].addrTo, dummy_address)\n+            assert_equal(peer.last_message[\"version\"].addrFrom, dummy_address)\n+            assert_equal(peer.last_message[\"version\"].strSubVer, \"/pynode:0.0.1/\")\n+            assert_equal(peer.last_message[\"version\"].nStartingHeight, 0)\n+            assert_equal(peer.last_message[\"version\"].relay, 0)\n+            assert_equal(peer.last_message[\"tx\"].tx.rehash(), tx[\"txid\"])\n+            self.log.debug(f\"Outbound connection i={i} is proper private broadcast, test ok\")\n+            num_private_broadcast_opened += 1\n+            if num_private_broadcast_opened == NUM_PRIVATE_BROADCAST_PER_TX:\n+                break\n+        assert_equal(num_private_broadcast_opened, NUM_PRIVATE_BROADCAST_PER_TX)\n+\n+        wtxid_int = int(tx[\"wtxid\"], 16)\n+        inv = CInv(MSG_WTX, wtxid_int)\n+\n+        self.log.info(\"Checking that the transaction is not in the originator node's mempool\")\n+        assert len(tx_originator.getrawmempool()) == 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#discussion_r1523162366",
      "id" : 1523162366,
      "in_reply_to_id" : 1520261754,
      "line" : 296,
      "node_id" : "PRRC_kwDOABII585ayZz-",
      "original_commit_id" : "d10a0649b018638574fa7dc316b3e783bf6cee69",
      "original_line" : 296,
      "original_position" : 296,
      "original_start_line" : 295,
      "path" : "test/functional/p2p_private_broadcast.py",
      "position" : 296,
      "pull_request_review_id" : 1934036115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523162366/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 295,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-13T12:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1523162366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`b6dce67064...cc867ebd62`: rebase due to conflicts",
      "created_at" : "2024-03-13T12:44:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29415#issuecomment-1994313253",
      "id" : 1994313253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
      "node_id" : "IC_kwDOABII58523s4l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994313253/reactions"
      },
      "updated_at" : "2024-03-13T12:44:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1994313253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
