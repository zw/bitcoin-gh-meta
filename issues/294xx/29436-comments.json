[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29436).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/29436#pullrequestreview-1885261790), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1953718864) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29043](https://github.com/bitcoin/bitcoin/pull/29043) (fuzz: make FuzzedDataProvider usage deterministic by martinus)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-02-14T18:49:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1944404918",
      "id" : 1944404918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII585z5UO2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1944404918/reactions"
      },
      "updated_at" : "2024-02-26T10:58:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1944404918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "cc: @vasild @naumenkogs @amitiuttarwar @mzumsande ",
      "created_at" : "2024-02-14T18:52:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1944409727",
      "id" : 1944409727,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII585z5VZ_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1944409727/reactions"
      },
      "updated_at" : "2024-02-14T18:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1944409727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490381331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490381331"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "instead of an optional of a vector, you could have the default value explicitly be all networks, or an empty vector be interpreted as all networks. probably the first one is clearer. ",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T05:04:26Z",
      "diff_hunk" : "@@ -154,12 +154,12 @@ class AddrMan\n      *                     an address from the new table or an empty pair. Passing `false` will return an\n      *                     empty pair or an address from either the new or tried table (it does not\n      *                     guarantee a tried entry).\n-     * @param[in] network  Select only addresses of this network (nullopt = all). Passing a network may\n+     * @param[in] networks Select only addresses of these networks (nullopt = all). Passing networks may\n      *                     slow down the search.\n      * @return    CAddress The record for the selected peer.\n      *            seconds  The last time we attempted to connect to that peer.\n      */\n-    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<Network> network = std::nullopt) const;\n+    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<std::vector<Network>> networks = std::nullopt) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490381331",
      "id" : 1490381331,
      "line" : 162,
      "node_id" : "PRRC_kwDOABII585Y1WoT",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 162,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 11,
      "pull_request_review_id" : 1881775768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490381331/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T05:04:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490381331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490757436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490757436"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should be `continue;`? If addrman has 0 addresses from some of the requested networks, it can still return an address from another requested network.\r\n\r\n```suggestion\r\n            if (it == m_network_counts.end()) {\r\n                continue;\r\n            }\r\n```",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T10:11:26Z",
      "diff_hunk" : "@@ -717,13 +717,17 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n     size_t new_count = nNew;\n     size_t tried_count = nTried;\n \n-    if (network.has_value()) {\n-        auto it = m_network_counts.find(*network);\n-        if (it == m_network_counts.end()) return {};\n+    if (networks.has_value()) {\n+        new_count = 0;\n+        tried_count = 0;\n+        for (auto& network : *networks) {\n+            auto it = m_network_counts.find(network);\n+            if (it == m_network_counts.end()) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490757436",
      "id" : 1490757436,
      "line" : 725,
      "node_id" : "PRRC_kwDOABII585Y2yc8",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 725,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 21,
      "pull_request_review_id" : 1882354205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490757436/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T10:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490757436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490766626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490766626"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This code is correct, but is doing linear search in the list of networks. For values of up to 6 that is irrelevant, but if it is changed from `vector` to `unordered_set` then lookup is also shorter to write, in addition to being `O(1)`:\r\n\r\n```suggestion\r\n                    if (Assume(it != mapInfo.end()) && networks->contains(it->second.GetNetwork())) break;\r\n```",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T10:18:41Z",
      "diff_hunk" : "@@ -756,9 +760,10 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n             position = (initial_position + i) % ADDRMAN_BUCKET_SIZE;\n             node_id = GetEntry(search_tried, bucket, position);\n             if (node_id != -1) {\n-                if (network.has_value()) {\n+                if (networks.has_value()) {\n                     const auto it{mapInfo.find(node_id)};\n-                    if (Assume(it != mapInfo.end()) && it->second.GetNetwork() == *network) break;\n+                    auto& nets = *networks;\n+                    if (Assume(it != mapInfo.end()) && std::find(nets.begin(), nets.end(), it->second.GetNetwork()) != nets.end()) break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490766626",
      "id" : 1490766626,
      "line" : 766,
      "node_id" : "PRRC_kwDOABII585Y20si",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 766,
      "original_position" : 42,
      "original_start_line" : 765,
      "path" : "src/addrman.cpp",
      "position" : 42,
      "pull_request_review_id" : 1882354205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490766626/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 765,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T10:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490766626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490770478"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490770478"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should work as well (untested):\r\n\r\n```cpp\r\n(void)addrman.Select(/*new_only=*/false, {NET_I2P});\r\n```\r\n\r\nSame in `src/test/addrman_tests.cpp`.",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T10:21:32Z",
      "diff_hunk" : "@@ -126,8 +126,10 @@ static void AddrManSelectByNetwork(benchmark::Bench& bench)\n \n     FillAddrMan(addrman);\n \n+    std::vector<Network> net_i2p = {NET_I2P};\n+\n     bench.run([&] {\n-        (void)addrman.Select(/*new_only=*/false, NET_I2P);\n+        (void)addrman.Select(/*new_only=*/false, net_i2p);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490770478",
      "id" : 1490770478,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII585Y21ou",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 132,
      "original_position" : 8,
      "original_start_line" : 129,
      "path" : "src/bench/addrman.cpp",
      "position" : 8,
      "pull_request_review_id" : 1882354205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490770478/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 129,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T10:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490770478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490780583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490780583"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could be shorter (untested):\r\n\r\n```cpp\r\nstd::tie(addr, addr_last_try) = preferred_net.has_value()\r\n    ? addrman.Select(false, {*preferred_net})\r\n    : addrman.Select(false, g_reachable_nets.All());\r\n```",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T10:29:15Z",
      "diff_hunk" : "@@ -2672,14 +2680,17 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                     // a currently-connected peer.\n                     addrman.Good(addr);\n                     // Select a new table address for our feeler instead.\n-                    std::tie(addr, addr_last_try) = addrman.Select(true);\n+                    std::tie(addr, addr_last_try) = addrman.Select(true, networks);\n                 }\n             } else {\n                 // Not a feeler\n                 // If preferred_net has a value set, pick an extra outbound\n                 // peer from that network. The eviction logic in net_processing\n                 // ensures that a peer from another network will be evicted.\n-                std::tie(addr, addr_last_try) = addrman.Select(false, preferred_net);\n+                if (preferred_net.has_value()) {\n+                    networks = {*preferred_net};\n+                }\n+                std::tie(addr, addr_last_try) = addrman.Select(false, networks);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490780583",
      "id" : 1490780583,
      "line" : 2693,
      "node_id" : "PRRC_kwDOABII585Y24Gn",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 2693,
      "original_position" : 40,
      "original_start_line" : 2682,
      "path" : "src/net.cpp",
      "position" : 40,
      "pull_request_review_id" : 1882354205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490780583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2682,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T10:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490780583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490794321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490794321"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could end up passing an empty container (`vector` or `unordered_set` if you decide to change it). Maybe this:\r\n\r\n```cpp\r\nif (nets.empty()) {\r\n    (void)const_addr_man.Select(fuzzed_data_provider.ConsumeBool());\r\n} else {\r\n    (void)const_addr_man.Select(fuzzed_data_provider.ConsumeBool(), nets);\r\n}",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T10:39:13Z",
      "diff_hunk" : "@@ -275,7 +275,16 @@ FUZZ_TARGET(addrman, .init = initialize_addrman)\n         /*max_pct=*/fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, 4096),\n         network,\n         /*filtered=*/fuzzed_data_provider.ConsumeBool());\n-    (void)const_addr_man.Select(fuzzed_data_provider.ConsumeBool(), network);\n+\n+    auto all_networks = ALL_NETWORKS;\n+    FastRandomContext fast_random_context{ConsumeUInt256(fuzzed_data_provider)};\n+    Shuffle(all_networks.begin(), all_networks.end(), fast_random_context);\n+    std::vector<Network> nets;\n+    for (size_t i = 0; i < all_networks.size() && fuzzed_data_provider.ConsumeBool(); i++) {\n+        nets.push_back(all_networks[i]);\n+    }\n+    (void)const_addr_man.Select(fuzzed_data_provider.ConsumeBool(), nets);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490794321",
      "id" : 1490794321,
      "line" : 286,
      "node_id" : "PRRC_kwDOABII585Y27dR",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 286,
      "original_position" : 13,
      "original_start_line" : 282,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : 13,
      "pull_request_review_id" : 1882354205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490794321/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 282,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T10:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490794321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490807334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490807334"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you extend the `ReachableNets` class like this:\r\n\r\n```diff\r\n--- i/src/netbase.h\r\n+++ w/src/netbase.h\r\n@@ -102,12 +102,18 @@ public:\r\n     [[nodiscard]] bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\r\n     {   \r\n         AssertLockNotHeld(m_mutex);\r\n         return Contains(addr.GetNetwork());\r\n     }\r\n\r\n+    [[nodiscard]] std::unordered_set<Network> All() const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\r\n+    {\r\n+        LOCK(m_mutex);\r\n+        return m_reachable;\r\n+    }\r\n+\r\n private:\r\n     mutable Mutex m_mutex;\r\n\r\n     std::unordered_set<Network> m_reachable GUARDED_BY(m_mutex){\r\n```\r\n\r\nThen you can pass directly `g_reachable_nets.All()` to `Select()` without an intermediate variable.",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T10:46:54Z",
      "diff_hunk" : "@@ -2564,6 +2564,14 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         bool fFeeler = false;\n         std::optional<Network> preferred_net;\n \n+        std::vector<Network> networks;\n+        for (int i = 0; i != NET_MAX; i++) {\n+            Network net = static_cast<Network>(i);\n+            if (g_reachable_nets.Contains(net)) {\n+                networks.push_back(net);\n+            }\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490807334",
      "id" : 1490807334,
      "line" : 2573,
      "node_id" : "PRRC_kwDOABII585Y2-om",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 2573,
      "original_position" : 10,
      "original_start_line" : 2567,
      "path" : "src/net.cpp",
      "position" : 10,
      "pull_request_review_id" : 1882354205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490807334/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2567,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T10:52:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490807334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490857252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490857252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "With this PR all production code passes both arguments. No need anymore for defaults. This compiles:\r\n\r\n```diff\r\n-    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<std::vector<Network>> networks = std::nullopt) const;\r\n+    std::pair<CAddress, NodeSeconds> Select(bool new_only, std::vector<Network> networks) const;\r\n```\r\n\r\nSome tests use `Select()` and I adjusted them to do `Select(false, {})` just to check that the compilation will succeed. They can be adjusted to\r\n`Select(false, g_reachable_nets.All())`\r\nor\r\n`Select(false, {NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS})`\r\nif you decide to drop the defaults.",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T11:22:18Z",
      "diff_hunk" : "@@ -154,12 +154,12 @@ class AddrMan\n      *                     an address from the new table or an empty pair. Passing `false` will return an\n      *                     empty pair or an address from either the new or tried table (it does not\n      *                     guarantee a tried entry).\n-     * @param[in] network  Select only addresses of this network (nullopt = all). Passing a network may\n+     * @param[in] networks Select only addresses of these networks (nullopt = all). Passing networks may\n      *                     slow down the search.\n      * @return    CAddress The record for the selected peer.\n      *            seconds  The last time we attempted to connect to that peer.\n      */\n-    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<Network> network = std::nullopt) const;\n+    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<std::vector<Network>> networks = std::nullopt) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490857252",
      "id" : 1490857252,
      "in_reply_to_id" : 1490381331,
      "line" : 162,
      "node_id" : "PRRC_kwDOABII585Y3K0k",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 162,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 11,
      "pull_request_review_id" : 1882520607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490857252/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T11:22:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490857252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490912711"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490912711"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, nice catch. I'll address it.",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T12:06:54Z",
      "diff_hunk" : "@@ -717,13 +717,17 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n     size_t new_count = nNew;\n     size_t tried_count = nTried;\n \n-    if (network.has_value()) {\n-        auto it = m_network_counts.find(*network);\n-        if (it == m_network_counts.end()) return {};\n+    if (networks.has_value()) {\n+        new_count = 0;\n+        tried_count = 0;\n+        for (auto& network : *networks) {\n+            auto it = m_network_counts.find(network);\n+            if (it == m_network_counts.end()) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490912711",
      "id" : 1490912711,
      "in_reply_to_id" : 1490757436,
      "line" : 725,
      "node_id" : "PRRC_kwDOABII585Y3YXH",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 725,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 21,
      "pull_request_review_id" : 1882608433,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490912711/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-15T12:06:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490912711",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490938595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490938595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It doesn't work with vector I guess. But since I'll change it to `unordered_set`, it will work.",
      "commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "created_at" : "2024-02-15T12:30:17Z",
      "diff_hunk" : "@@ -126,8 +126,10 @@ static void AddrManSelectByNetwork(benchmark::Bench& bench)\n \n     FillAddrMan(addrman);\n \n+    std::vector<Network> net_i2p = {NET_I2P};\n+\n     bench.run([&] {\n-        (void)addrman.Select(/*new_only=*/false, NET_I2P);\n+        (void)addrman.Select(/*new_only=*/false, net_i2p);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490938595",
      "id" : 1490938595,
      "in_reply_to_id" : 1490770478,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII585Y3erj",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 132,
      "original_position" : 8,
      "original_start_line" : 129,
      "path" : "src/bench/addrman.cpp",
      "position" : 8,
      "pull_request_review_id" : 1882650103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490938595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 129,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T12:30:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1490938595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1491007792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491007792"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Empty container and nothing means the same, all networks.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-15T13:26:52Z",
      "diff_hunk" : "@@ -275,7 +275,16 @@ FUZZ_TARGET(addrman, .init = initialize_addrman)\n         /*max_pct=*/fuzzed_data_provider.ConsumeIntegralInRange<size_t>(0, 4096),\n         network,\n         /*filtered=*/fuzzed_data_provider.ConsumeBool());\n-    (void)const_addr_man.Select(fuzzed_data_provider.ConsumeBool(), network);\n+\n+    auto all_networks = ALL_NETWORKS;\n+    FastRandomContext fast_random_context{ConsumeUInt256(fuzzed_data_provider)};\n+    Shuffle(all_networks.begin(), all_networks.end(), fast_random_context);\n+    std::vector<Network> nets;\n+    for (size_t i = 0; i < all_networks.size() && fuzzed_data_provider.ConsumeBool(); i++) {\n+        nets.push_back(all_networks[i]);\n+    }\n+    (void)const_addr_man.Select(fuzzed_data_provider.ConsumeBool(), nets);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1491007792",
      "id" : 1491007792,
      "in_reply_to_id" : 1490794321,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y3vkw",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 286,
      "original_position" : 13,
      "original_start_line" : 282,
      "path" : "src/test/fuzz/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1882761408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491007792/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T13:45:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491007792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1491008021"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491008021"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice idea! I'll address it.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-15T13:27:02Z",
      "diff_hunk" : "@@ -2564,6 +2564,14 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n         bool fFeeler = false;\n         std::optional<Network> preferred_net;\n \n+        std::vector<Network> networks;\n+        for (int i = 0; i != NET_MAX; i++) {\n+            Network net = static_cast<Network>(i);\n+            if (g_reachable_nets.Contains(net)) {\n+                networks.push_back(net);\n+            }\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1491008021",
      "id" : 1491008021,
      "in_reply_to_id" : 1490807334,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y3voV",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 2573,
      "original_position" : 10,
      "original_start_line" : 2567,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1882761728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491008021/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T13:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491008021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1491008584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491008584"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nice, I'll address it.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-15T13:27:28Z",
      "diff_hunk" : "@@ -756,9 +760,10 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n             position = (initial_position + i) % ADDRMAN_BUCKET_SIZE;\n             node_id = GetEntry(search_tried, bucket, position);\n             if (node_id != -1) {\n-                if (network.has_value()) {\n+                if (networks.has_value()) {\n                     const auto it{mapInfo.find(node_id)};\n-                    if (Assume(it != mapInfo.end()) && it->second.GetNetwork() == *network) break;\n+                    auto& nets = *networks;\n+                    if (Assume(it != mapInfo.end()) && std::find(nets.begin(), nets.end(), it->second.GetNetwork()) != nets.end()) break;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1491008584",
      "id" : 1491008584,
      "in_reply_to_id" : 1490766626,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y3vxI",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 766,
      "original_position" : 42,
      "original_start_line" : 765,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1882762615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491008584/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-15T13:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1491008584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force-pushed addressing:\r\nhttps://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490381331\r\nhttps://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490757436\r\nhttps://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490780583\r\nhttps://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490807334\r\nhttps://github.com/bitcoin/bitcoin/pull/29436#discussion_r1490770478\r\n\r\nThanks @vasild and @amitiuttarwar for reviewing!\r\n",
      "created_at" : "2024-02-15T13:45:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1946127103",
      "id" : 1946127103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII585z_4r_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1946127103/reactions"
      },
      "updated_at" : "2024-02-15T13:45:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1946127103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1492529744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1492529744"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Does not matter now, but it should work with vector as well.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-16T14:18:45Z",
      "diff_hunk" : "@@ -126,8 +126,10 @@ static void AddrManSelectByNetwork(benchmark::Bench& bench)\n \n     FillAddrMan(addrman);\n \n+    std::vector<Network> net_i2p = {NET_I2P};\n+\n     bench.run([&] {\n-        (void)addrman.Select(/*new_only=*/false, NET_I2P);\n+        (void)addrman.Select(/*new_only=*/false, net_i2p);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1492529744",
      "id" : 1492529744,
      "in_reply_to_id" : 1490770478,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Y9jJQ",
      "original_commit_id" : "2096aeabec288bd2852593f0c965a2a9d22ad0c8",
      "original_line" : 132,
      "original_position" : 8,
      "original_start_line" : 129,
      "path" : "src/bench/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 1885264596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1492529744/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-16T14:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1492529744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> About the graph in the OP: \"... until it finds an address from a network that compose 20% ...\". The chance of not getting the result after N tries is (8/10)^N. For example for N=25 that is less than 0.004. What is the explanation of having so many dots so high? Uneven distribution within addrman?\r\n\r\nThat was what I was expecting too. I'll investigate but yes I think it might be an uneven distribution. Btw, this is not deterministic.",
      "created_at" : "2024-02-16T19:45:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1949222350",
      "id" : 1949222350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII5850LsXO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1949222350/reactions"
      },
      "updated_at" : "2024-02-16T19:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1949222350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1494214557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494214557"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3f99f5a6e58fae4981228929045ed7be32463381\r\n\r\nMight be worth making this overflow-safe?",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-19T09:02:54Z",
      "diff_hunk" : "@@ -717,13 +717,18 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n     size_t new_count = nNew;\n     size_t tried_count = nTried;\n \n-    if (network.has_value()) {\n-        auto it = m_network_counts.find(*network);\n-        if (it == m_network_counts.end()) return {};\n-\n-        auto counts = it->second;\n-        new_count = counts.n_new;\n-        tried_count = counts.n_tried;\n+    if (!networks.empty()) {\n+        new_count = 0;\n+        tried_count = 0;\n+        for (auto& network : networks) {\n+            auto it = m_network_counts.find(network);\n+            if (it == m_network_counts.end()) {\n+                continue;\n+            }\n+            auto counts = it->second;\n+            new_count += counts.n_new;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1494214557",
      "id" : 1494214557,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII585ZD-ed",
      "original_commit_id" : "3f99f5a6e58fae4981228929045ed7be32463381",
      "original_line" : 729,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 1887888527,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494214557/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T10:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494214557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1494332423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494332423"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might as well fix `    if (new_count + tried_count == 0) return {};` above. While it seems like a bug in the existing code, it's really hard to trigger.... feeding addrman with that much garbage would be a failure probably before the size_t limit is hit :)",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-19T10:25:14Z",
      "diff_hunk" : "@@ -717,13 +717,18 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n     size_t new_count = nNew;\n     size_t tried_count = nTried;\n \n-    if (network.has_value()) {\n-        auto it = m_network_counts.find(*network);\n-        if (it == m_network_counts.end()) return {};\n-\n-        auto counts = it->second;\n-        new_count = counts.n_new;\n-        tried_count = counts.n_tried;\n+    if (!networks.empty()) {\n+        new_count = 0;\n+        tried_count = 0;\n+        for (auto& network : networks) {\n+            auto it = m_network_counts.find(network);\n+            if (it == m_network_counts.end()) {\n+                continue;\n+            }\n+            auto counts = it->second;\n+            new_count += counts.n_new;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1494332423",
      "id" : 1494332423,
      "in_reply_to_id" : 1494214557,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII585ZEbQH",
      "original_commit_id" : "3f99f5a6e58fae4981228929045ed7be32463381",
      "original_line" : 729,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 1887888527,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494332423/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T10:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494332423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1494903447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494903447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Might be worth making this overflow-safe?\r\n\r\nI don't know, I don't see a viable way of reaching that.\r\n\r\n> it's really hard to trigger.... feeding addrman with that much garbage would be a failure probably before the size_t limit is hit :)\r\n\r\nI believe that's impractical due to the limited size of addrman.\r\n",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-19T18:10:34Z",
      "diff_hunk" : "@@ -717,13 +717,18 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n     size_t new_count = nNew;\n     size_t tried_count = nTried;\n \n-    if (network.has_value()) {\n-        auto it = m_network_counts.find(*network);\n-        if (it == m_network_counts.end()) return {};\n-\n-        auto counts = it->second;\n-        new_count = counts.n_new;\n-        tried_count = counts.n_tried;\n+    if (!networks.empty()) {\n+        new_count = 0;\n+        tried_count = 0;\n+        for (auto& network : networks) {\n+            auto it = m_network_counts.find(network);\n+            if (it == m_network_counts.end()) {\n+                continue;\n+            }\n+            auto counts = it->second;\n+            new_count += counts.n_new;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1494903447",
      "id" : 1494903447,
      "in_reply_to_id" : 1494214557,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII585ZGmqX",
      "original_commit_id" : "3f99f5a6e58fae4981228929045ed7be32463381",
      "original_line" : 729,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 1888979988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494903447/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T18:10:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494903447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1495427464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1495427464"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">I believe that's impractical due to the limited size of addrman.\r\n\r\nRight, probably fine to keep it this way for both cases.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-20T08:38:55Z",
      "diff_hunk" : "@@ -717,13 +717,18 @@ std::pair<CAddress, NodeSeconds> AddrManImpl::Select_(bool new_only, std::option\n     size_t new_count = nNew;\n     size_t tried_count = nTried;\n \n-    if (network.has_value()) {\n-        auto it = m_network_counts.find(*network);\n-        if (it == m_network_counts.end()) return {};\n-\n-        auto counts = it->second;\n-        new_count = counts.n_new;\n-        tried_count = counts.n_tried;\n+    if (!networks.empty()) {\n+        new_count = 0;\n+        tried_count = 0;\n+        for (auto& network : networks) {\n+            auto it = m_network_counts.find(network);\n+            if (it == m_network_counts.end()) {\n+                continue;\n+            }\n+            auto counts = it->second;\n+            new_count += counts.n_new;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1495427464",
      "id" : 1495427464,
      "in_reply_to_id" : 1494214557,
      "line" : 729,
      "node_id" : "PRRC_kwDOABII585ZImmI",
      "original_commit_id" : "3f99f5a6e58fae4981228929045ed7be32463381",
      "original_line" : 729,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/addrman.cpp",
      "position" : 29,
      "pull_request_review_id" : 1889779417,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1495427464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-20T08:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1495427464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-20T08:39:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1953718864",
      "id" : 1953718864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII5850c2JQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1953718864/reactions"
      },
      "updated_at" : "2024-02-20T08:39:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1953718864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1496276836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1496276836"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like the case of empty networks is no longer used outside of tests after this PR. In that case, should we drop the default args and simplify the implementation?",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-20T18:07:12Z",
      "diff_hunk" : "@@ -154,12 +155,12 @@ class AddrMan\n      *                     an address from the new table or an empty pair. Passing `false` will return an\n      *                     empty pair or an address from either the new or tried table (it does not\n      *                     guarantee a tried entry).\n-     * @param[in] network  Select only addresses of this network (nullopt = all). Passing a network may\n+     * @param[in] networks Select only addresses of these networks (empty = all). Passing networks may\n      *                     slow down the search.\n      * @return    CAddress The record for the selected peer.\n      *            seconds  The last time we attempted to connect to that peer.\n      */\n-    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<Network> network = std::nullopt) const;\n+    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::unordered_set<Network> networks = {}) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1496276836",
      "id" : 1496276836,
      "line" : 163,
      "node_id" : "PRRC_kwDOABII585ZL19k",
      "original_commit_id" : "3f99f5a6e58fae4981228929045ed7be32463381",
      "original_line" : 163,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 19,
      "pull_request_review_id" : 1891133220,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1496276836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-20T18:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1496276836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1497744510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497744510"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is this supposed to do? :/",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-21T15:02:52Z",
      "diff_hunk" : "@@ -275,7 +279,8 @@ BOOST_AUTO_TEST_CASE(addrman_select_special)\n     // since the only ipv4 address is on the new table, ensure that the new\n     // table gets selected even if new_only is false. if the table was being\n     // selected at random, this test will sporadically fail\n-    BOOST_CHECK(addrman->Select(/*new_only=*/false, NET_IPV4).first == addr1);\n+    std::unordered_set<Network> {NET_IPV4} = {NET_IPV4};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1497744510",
      "id" : 1497744510,
      "line" : 282,
      "node_id" : "PRRC_kwDOABII585ZRcR-",
      "original_commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "original_line" : 282,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 84,
      "pull_request_review_id" : 1893454940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497744510/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-21T15:02:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497744510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1499270150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1499270150"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Leftover from previous changes, thanks, I'll remove it.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-22T13:48:38Z",
      "diff_hunk" : "@@ -275,7 +279,8 @@ BOOST_AUTO_TEST_CASE(addrman_select_special)\n     // since the only ipv4 address is on the new table, ensure that the new\n     // table gets selected even if new_only is false. if the table was being\n     // selected at random, this test will sporadically fail\n-    BOOST_CHECK(addrman->Select(/*new_only=*/false, NET_IPV4).first == addr1);\n+    std::unordered_set<Network> {NET_IPV4} = {NET_IPV4};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1499270150",
      "id" : 1499270150,
      "in_reply_to_id" : 1497744510,
      "line" : 282,
      "node_id" : "PRRC_kwDOABII585ZXQwG",
      "original_commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "original_line" : 282,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/test/addrman_tests.cpp",
      "position" : 84,
      "pull_request_review_id" : 1895900755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1499270150/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T13:48:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1499270150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1499286213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1499286213"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, sure! I'll address it.",
      "commit_id" : "7edb07ca800991f7c88d582b880a392efe17f31d",
      "created_at" : "2024-02-22T13:59:38Z",
      "diff_hunk" : "@@ -154,12 +155,12 @@ class AddrMan\n      *                     an address from the new table or an empty pair. Passing `false` will return an\n      *                     empty pair or an address from either the new or tried table (it does not\n      *                     guarantee a tried entry).\n-     * @param[in] network  Select only addresses of this network (nullopt = all). Passing a network may\n+     * @param[in] networks Select only addresses of these networks (empty = all). Passing networks may\n      *                     slow down the search.\n      * @return    CAddress The record for the selected peer.\n      *            seconds  The last time we attempted to connect to that peer.\n      */\n-    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::optional<Network> network = std::nullopt) const;\n+    std::pair<CAddress, NodeSeconds> Select(bool new_only = false, std::unordered_set<Network> networks = {}) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#discussion_r1499286213",
      "id" : 1499286213,
      "in_reply_to_id" : 1496276836,
      "line" : 163,
      "node_id" : "PRRC_kwDOABII585ZXUrF",
      "original_commit_id" : "3f99f5a6e58fae4981228929045ed7be32463381",
      "original_line" : 163,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/addrman.h",
      "position" : 19,
      "pull_request_review_id" : 1895926041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29436",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1499286213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-22T13:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1499286213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> the performance goes down by a factor of ~5 for me\r\n\r\nIf this is correct and can be reproduced by others, I think that something should be done about it. If this PR would increase performance for a  rare and transient case (right after the users switched their onlynet parameters) but decrease performance for each `Select()` call in the typical scenario (addrman has mostly addrs from reachable networks), the overall impact on performance of this PR would be clearly negative.\r\nOne possibility might be to track the percentage of non-reachable addrs while loading AddrMan (we can't get more unreachable addrs afterwards) and only execute the slower logic if that is larger than some threshold (for example, 50%).",
      "created_at" : "2024-02-22T16:09:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1959775549",
      "id" : 1959775549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII5850z809",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1959775549/reactions"
      },
      "updated_at" : "2024-02-22T16:09:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1959775549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> If this is correct and can be reproduced by others, I think that something should be done about it. If this PR would increase performance for a rare and transient case (right after the users switched their onlynet parameters) but decrease performance for each Select() call in the typical scenario (addrman has mostly addrs from reachable networks), the overall impact on performance of this PR would be clearly negative.\r\nOne possibility might be to track the percentage of non-reachable addrs while loading AddrMan (we can't get more unreachable addrs afterwards) and only execute the slower logic if that is larger than some threshold (for example, 50%).\r\n\r\nI'm reproducing it to check it.",
      "created_at" : "2024-02-22T16:46:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1959849246",
      "id" : 1959849246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII58500O0e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1959849246/reactions"
      },
      "updated_at" : "2024-02-22T16:46:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1959849246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21977629586</sub>",
      "created_at" : "2024-02-26T11:02:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1963866552",
      "id" : 1963866552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII5851Djm4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1963866552/reactions"
      },
      "updated_at" : "2024-02-26T11:02:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1963866552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande you're right! \r\n\r\nI checked the performance goes down when calling `Select` when addrman only has addrs for reachable nets. So, I changed the approach to call `Select` with networks only whether the number of addresses from reachable networks in the addrman is less than 50%. This should be enough to cover the cases where this is an issue.\r\n\r\nSo, when initializing `CConnman`, we check whether the number of addresses from reachable networks in the addrman is less than 50%, if so, we call `Select` passing the networks.\r\n\r\ncc: @vasild @naumenkogs (due previous ACK)",
      "created_at" : "2024-02-26T11:06:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29436#issuecomment-1963873765",
      "id" : 1963873765,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29436",
      "node_id" : "IC_kwDOABII5851DlXl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1963873765/reactions"
      },
      "updated_at" : "2024-02-26T11:06:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1963873765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   }
]
