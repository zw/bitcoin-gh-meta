[
   {
      "author_association" : "MEMBER",
      "body" : "I think removing entries from `mapBlockSource` once the corresponding peers disconnect would make the most sense because we want to be able to punish the source in case the block turns out to be invalid. If we expire or otherwise prematurely remove from the map we lose that ability.\r\n\r\nSomething like the following in `FinalizeNode`:\r\n```c++\r\n    for (auto it = mapBlockSource.begin(); it != mapBlockSource.end();) {\r\n        auto& [hash, entry] = *it;\r\n        if (entry.first == node.GetId()) {\r\n            it = mapBlockSource.erase(it);\r\n        } else {\r\n            ++it;\r\n        }\r\n    }\r\n```",
      "created_at" : "2024-02-08T16:47:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29410#issuecomment-1934529375",
      "id" : 1934529375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29410",
      "node_id" : "IC_kwDOABII585zTpNf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934529375/reactions"
      },
      "updated_at" : "2024-02-08T16:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934529375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   }
]
