{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "As mentioned in https://github.com/bitcoin/bitcoin/pull/26924#issuecomment-1403449932 and https://github.com/bitcoin/bitcoin/pull/29263#issuecomment-1922334399, it is currently not safe to remove `bitcoin-config.h` includes from headers because some unrelated file might be depending on it.\r\n\r\nSee also #26972 for discussion.\r\n\r\nSolve this by including the file directly everywhere it's required, regardless of whether or not it's already included by another header.\r\n\r\nI'm afraid it's a bit tedious to reproduce these commits, but it's reasonably straightforward:\r\n\r\n```bash\r\n# All commands executed from the src/ subdir.\r\n\r\n# Collect all tokens from bitcoin-config.h.in\r\n# Isolate the tokens and remove blank lines\r\n# Replace newlines with | and remove the last trailing one\r\n# Collect all files which use these tokens\r\n# Filter out subprojects (proper forwarding can be verified from Makefiles)\r\n# Filter out .rc files\r\n# Save to a text file\r\ngit grep -E -l `grep undef config/bitcoin-config.h.in | cut -d\" \" -f2 | grep -v '^$' | tr '\\n' '|' | sed 's/|$//'` | grep -v -e \"^leveldb/\" -e \"^secp256k1/\" -e \"^crc32c/\" -e \"^minisketch/\" -e \"^Makefile\" -e \"\\.rc$\" > files-with-config-include.txt\r\n\r\n# Find all files from the above list which don't include bitcoin-config.h\r\ngit grep -L -E \"config/bitcoin-config.h\" -- `cat files-with-config-include.txt`\r\n\r\n# Include them manually with the exception of some files in crypto:\r\n# crypto/sha256_arm_shani.cpp crypto/sha256_avx2.cpp crypto/sha256_sse41.cpp crypto/sha256_x86_shani.cpp\r\n# These are exceptions which don't use bitcoin-config.h, rather the Makefile.am adds these cppflags manually.\r\n\r\n# Commit changes. This should match the first commit of this PR.\r\n\r\n# Use the same search as above to find all files which DON'T use any config tokens\r\ngit grep -E -L `grep undef config/bitcoin-config.h.in | cut -d\" \" -f2 | grep -v '^$' | tr '\\n' '|' | sed 's/|$//'` | grep -v -e \"^leveldb/\" -e \"^secp256k1/\" -e \"^crc32c/\" -e \"^minisketch/\" -e \"^Makefile\" -e \"\\.rc$\" > files-without-config-include.txt\r\n\r\n# Manually remove the includes and commit changes. This should match the second commit of this PR.\r\n```",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29404/comments",
   "created_at" : "2024-02-07T18:19:24Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29404/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29404",
   "id" : 2123614855,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29404/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585mSxJG",
   "number" : 29404,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29404.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29404",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29404.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29404"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29404/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29404/timeline",
   "title" : "bitcoin-config.h includes cleanup",
   "updated_at" : "2024-02-07T18:22:42Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29404",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
      "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
      "followers_url" : "https://api.github.com/users/theuni/followers",
      "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/theuni",
      "id" : 417043,
      "login" : "theuni",
      "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
      "organizations_url" : "https://api.github.com/users/theuni/orgs",
      "received_events_url" : "https://api.github.com/users/theuni/received_events",
      "repos_url" : "https://api.github.com/users/theuni/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/theuni"
   }
}
