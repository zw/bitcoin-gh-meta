[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38882806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38882806"
         }
      },
      "body" : "Use GetBoolArg, so it enables the -no prefix etc.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T00:02:52Z",
      "diff_hunk" : "@@ -40,7 +40,7 @@ void static BatchWriteHashBestChain(CLevelDBBatch &batch, const uint256 &hash) {\n     batch.Write(DB_BEST_BLOCK, hash);\n }\n \n-CCoinsViewDB::CCoinsViewDB(size_t nCacheSize, bool fMemory, bool fWipe) : db(GetDataDir() / \"chainstate\", nCacheSize, fMemory, fWipe) {\n+CCoinsViewDB::CCoinsViewDB(size_t nCacheSize, bool fMemory, bool fWipe) : db(GetDataDir() / \"chainstate\", nCacheSize, fMemory, fWipe, GetArg(\"-obfuscatechainstate\", 0)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38882806",
      "id" : 38882806,
      "original_commit_id" : "7eb45a3e5ac2810642cddcd112dc8d4c93c7088b",
      "original_position" : 5,
      "path" : "src/txdb.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38882806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Concept ACK, this looks pretty good already.",
      "created_at" : "2015-09-08T00:10:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138394775",
      "id" : 138394775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T00:10:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138394775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Concept and approach ACK.  Obviously this will need a fair amount of testing. (In particular we should get an AV afflicted system and confirm this fixes it).\r\n\r\nI think it should be on by default. The people who need this won't know they need it, anyone who doesn't need it will quickly figure it out.  (Do other people have opinions?)\r\n\r\nI'm not even sure if we should support turning it off?  It's easy enough to support (as your code shows) that maybe we just should; but I'd like to hear an argument for it.\r\n\r\nThank you for working on this.",
      "created_at" : "2015-09-08T00:17:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138395911",
      "id" : 138395911,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T00:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138395911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell The only argument against supporting unobfuscated is 1) it would need upgrading code (but I think that's pretty simple, though supporting stop/restart in the middle is not trivial) 2) it would break backward compatibility.",
      "created_at" : "2015-09-08T00:20:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138396050",
      "id" : 138396050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T00:20:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138396050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@gmaxwell I agree that having the obfuscation enabled is a sane (and safe) default, but is it acceptable for that `runtime_error` to be thrown on upgrade for everyone with an existing chainstate? Seems harsh. Is it desirable to find a more gentle way of doing the migration?",
      "created_at" : "2015-09-08T00:22:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138396152",
      "id" : 138396152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T00:22:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138396152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "This is why supporting mixed obfuscated/unobfuscated is nice: no slow upgrade process. :)",
      "created_at" : "2015-09-08T00:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138396647",
      "id" : 138396647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T00:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138396647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr I do think the mixed migration is a better option if we're going to enforce this (or even make it the default behavior). Will implement if @gmaxwell, @laanwj agree.",
      "created_at" : "2015-09-08T01:23:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138402569",
      "id" : 138402569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T01:23:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138402569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "As noted in https://github.com/bitcoin/bitcoin/issues/6613#issuecomment-138409602 a mix of cleartext and obfu-text does not actually fix the problem seem in the field for active users.\r\n\r\nUsers reporting this problem will still see the problem after upgrading to a release with this feature.\r\n",
      "created_at" : "2015-09-08T02:30:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138412438",
      "id" : 138412438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T02:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138412438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38889104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38889104"
         }
      },
      "body" : "This should be std::string(&buff[0], &buff[8]);",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T04:02:11Z",
      "diff_hunk" : "@@ -87,3 +102,16 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Prefixed with null character to avoid collisions with other keys\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY = \"\\000obfuscate_key\";\n+\n+/**\n+ * Returns a string (consisting of 8 random bytes) suitable for use as an \n+ * obfuscating XOR key. \n+ */\n+std::string CLevelDBWrapper::CreateObfuscateKey() const {\n+    unsigned char buff[8];\n+    GetRandBytes(buff, 8);\n+    return std::string((const char *)buff);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38889104",
      "id" : 38889104,
      "original_commit_id" : "8e3b71d3038872c53900af8667397740860e1dcf",
      "original_position" : 60,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38889104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "I've integrated @gmaxwell's suggestion and I think it's looking much better.",
      "created_at" : "2015-09-08T04:27:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138426908",
      "id" : 138426908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T04:28:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138426908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38890603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38890603"
         }
      },
      "body" : "Does this have to be allocated?",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T05:00:32Z",
      "diff_hunk" : "@@ -168,6 +190,19 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38890603",
      "id" : 38890603,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 74,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38890603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891096"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891096"
         }
      },
      "body" : "Is there an alternative? apologies, I'm a C++ beginner :)",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T05:19:13Z",
      "diff_hunk" : "@@ -168,6 +190,19 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891096",
      "id" : 38891096,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 74,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891258"
         }
      },
      "body" : "You can drop the conditional.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T05:25:54Z",
      "diff_hunk" : "@@ -44,6 +44,8 @@ class CLevelDBBatch\n         CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n         ssValue.reserve(ssValue.GetSerializeSize(value));\n         ssValue << value;\n+        if (!obfuscate_key.empty())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891258",
      "id" : 38891258,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 13,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891279"
         }
      },
      "body" : "And the default.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T05:26:21Z",
      "diff_hunk" : "@@ -34,7 +34,7 @@ class CLevelDBBatch\n \n public:\n     template <typename K, typename V>\n-    void Write(const K& key, const V& value)\n+    void Write(const K& key, const V& value, const std::string& obfuscate_key = std::string())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891279",
      "id" : 38891279,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 5,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891798"
         }
      },
      "body" : "I initially did that, but this is called from contexts where `obfuscate_key` isn't in scope and hasn't been defined, namely `CBlockTreeDB::WriteTxIndex`. Now that I'm looking at it, there're some missing parameterizations of `obfuscate_key` (e.g. [here](https://github.com/jamesob/bitcoin/blob/obfuscate_chainstate/src/txdb.cpp#L36)). \r\n\r\nIt isn't immediately obvious to me how to convey `db.obfuscate_key` to that context... might need some refactoring.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T05:45:09Z",
      "diff_hunk" : "@@ -34,7 +34,7 @@ class CLevelDBBatch\n \n public:\n     template <typename K, typename V>\n-    void Write(const K& key, const V& value)\n+    void Write(const K& key, const V& value, const std::string& obfuscate_key = std::string())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38891798",
      "id" : 38891798,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 5,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38891798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "`CLevelDBBatch` needs a good refactoring at some point... unless there's something I'm not seeing, it should probably be absorbed into `CLevelDBWrapper`.That may be out of scope for this PR, though.",
      "created_at" : "2015-09-08T07:06:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138457038",
      "id" : 138457038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T07:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138457038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "Now that I think about it, the `Batch` refactoring may be more contained than I thought. Anyone have qualms with me doing it in this PR?",
      "created_at" : "2015-09-08T07:08:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138457334",
      "id" : 138457334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-08T07:08:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138457334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38974893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38974893"
         }
      },
      "body" : "Hmm.. `obfuscate_key` is not necessarily printable. Maybe it would be better to log a hexified version of the key?",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T20:22:13Z",
      "diff_hunk" : "@@ -67,6 +69,23 @@ CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path& path, size_t nCa\n     leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n     HandleError(status);\n     LogPrintf(\"Opened LevelDB successfully\\n\");\n+\n+    bool got_key = Read(OBFUSCATE_KEY_KEY, obfuscate_key);\n+\n+    if (!got_key) {\n+        if (obfuscate && IsEmpty()) {\n+            // Initialize non-degenerate obfuscation if it won't upset \n+            // existing, non-obfuscated data.\n+            obfuscate_key = CreateObfuscateKey();\n+        } else {\n+            // Our base-case for an obfuscation key is a zero'd byte array -- \n+            // this won't disrupt existing data.\n+            obfuscate_key = std::string(OBFUSCATE_KEY_NUM_BYTES, '\\000');\n+        }\n+\n+        Write(OBFUSCATE_KEY_KEY, obfuscate_key);\n+        LogPrintf(\"Wrote new obfuscate key '%s'\\n\", obfuscate_key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38974893",
      "id" : 38974893,
      "original_commit_id" : "957feedc250cbc8558a71f19341570606137429f",
      "original_position" : 44,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38974893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38976840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38976840"
         }
      },
      "body" : "As far as I can see it's not guaranteed that `batch` is deleted, namely if `WriteBatch -> HandleError -> throw`.\r\n\r\nHow about using something like [boost::scoped_ptr](http://www.boost.org/doc/libs/1_55_0/libs/smart_ptr/scoped_ptr.htm) to avoid the manual cleanup altogether?",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T20:37:42Z",
      "diff_hunk" : "@@ -117,9 +145,11 @@ class CLevelDBWrapper\n     template <typename K, typename V>\n     bool Write(const K& key, const V& value, bool fSync = false) throw(leveldb_error)\n     {\n-        CLevelDBBatch batch;\n-        batch.Write(key, value);\n-        return WriteBatch(batch, fSync);\n+        CLevelDBBatch* batch = GetBatch();\n+        batch->Write(key, value);\n+        bool written = WriteBatch(batch, fSync);\n+        delete batch;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38976840",
      "id" : 38976840,
      "original_commit_id" : "957feedc250cbc8558a71f19341570606137429f",
      "original_position" : 71,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38976840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38977135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38977135"
         }
      },
      "body" : "Sounds good to me, though honestly I'm hoping to obviate the heap allocations entirely by absorbing `CLevelDBBatch` into `CLevelDBWrapper`... this is pending an okay from @sipa @gmaxwell. ",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-08T20:40:08Z",
      "diff_hunk" : "@@ -117,9 +145,11 @@ class CLevelDBWrapper\n     template <typename K, typename V>\n     bool Write(const K& key, const V& value, bool fSync = false) throw(leveldb_error)\n     {\n-        CLevelDBBatch batch;\n-        batch.Write(key, value);\n-        return WriteBatch(batch, fSync);\n+        CLevelDBBatch* batch = GetBatch();\n+        batch->Write(key, value);\n+        bool written = WriteBatch(batch, fSync);\n+        delete batch;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38977135",
      "id" : 38977135,
      "original_commit_id" : "957feedc250cbc8558a71f19341570606137429f",
      "original_position" : 71,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38977135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39005763"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39005763"
         }
      },
      "body" : "Yeah, looks like this [only comes allocated](https://github.com/google/leveldb/blob/master/include/leveldb/table.h#L48).",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-09T04:11:00Z",
      "diff_hunk" : "@@ -168,6 +190,19 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39005763",
      "id" : 39005763,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 74,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39005763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "Okay, I think this is in a good place. Obfuscation now happens automatically whenever the chainstate is initialized (either via `-reindex` or otherwise). The degenerate key that we use (`\"\\000\\000...\"`) *isn't* persisted, but it's specified during class construction in the case that we can't do real obfuscate due to existing data.\r\n\r\nIMO this is ready to go, modulo the addition of a few unittests.",
      "created_at" : "2015-09-09T04:16:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-138775813",
      "id" : 138775813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-09T04:16:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138775813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39010572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39010572"
         }
      },
      "body" : "Thanks for clearing that up @jamesob ",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-09T06:23:10Z",
      "diff_hunk" : "@@ -168,6 +190,19 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39010572",
      "id" : 39010572,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 74,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39010572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39104776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39104776"
         }
      },
      "body" : "Is there any other case where `unobfuscate == false`, except in the [constructor](https://github.com/bitcoin/bitcoin/pull/6650/files#diff-77251d49f77d3e19d7d7ca887cd65e07R76)? If not, you might get away without it (and the condition in [L140](https://github.com/bitcoin/bitcoin/pull/6650/files#diff-0785f0fd15c21eecd3eee494a531d37fR140)), because `obfuscate_key` is still blank during the [read of the actual key](https://github.com/bitcoin/bitcoin/pull/6650/files#diff-77251d49f77d3e19d7d7ca887cd65e07R76), if I'm not mistaken.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-09T22:24:18Z",
      "diff_hunk" : "@@ -85,12 +92,35 @@ class CLevelDBWrapper\n     //! the database itself\n     leveldb::DB* pdb;\n \n+    //! a key used for optional XOR-obfuscation of the database\n+    std::string obfuscate_key;\n+\n+    //! the key under which the obfuscation key is stored\n+    static const std::string OBFUSCATE_KEY_KEY;\n+    \n+    //! the length of the obfuscate key in number of bytes\n+    static const unsigned int OBFUSCATE_KEY_NUM_BYTES;\n+    \n+    std::string CreateObfuscateKey() const;\n+\n public:\n-    CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n+    /**\n+     * @param[in] path        Location in the filesystem where leveldb data will be stored.\n+     * @param[in] nCacheSize  Configures various leveldb cache settings.\n+     * @param[in] fMemory     If true, use leveldb's memory environment.\n+     * @param[in] fWipe       If true, remove all existing data.\n+     * @param[in] obfuscate   If true, store data obfuscated via simple XOR. If false, XOR\n+     *                        with a zero'd byte array.\n+     */\n+    CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool fMemory = false, bool fWipe = false, bool obfuscate = false);\n     ~CLevelDBWrapper();\n \n+    /**\n+     * @param[in] unobfuscate   This should always be true unless we're reading\n+     *                          OBFUSCATE_KEY_KEY.\n+     */\n     template <typename K, typename V>\n-    bool Read(const K& key, V& value) const throw(leveldb_error)\n+    bool Read(const K& key, V& value, bool unobfuscate = true) const throw(leveldb_error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39104776",
      "id" : 39104776,
      "original_commit_id" : "1f6cb12a080ae431703de69eebca95da68fed46d",
      "original_position" : 57,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39104776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39108601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39108601"
         }
      },
      "body" : "Ah yep, you're totally right. Initially I rationalized this by telling myself this param would be convenient for tests, but looks like there's no real need for it now. Will push a fix.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-09T23:12:37Z",
      "diff_hunk" : "@@ -85,12 +92,35 @@ class CLevelDBWrapper\n     //! the database itself\n     leveldb::DB* pdb;\n \n+    //! a key used for optional XOR-obfuscation of the database\n+    std::string obfuscate_key;\n+\n+    //! the key under which the obfuscation key is stored\n+    static const std::string OBFUSCATE_KEY_KEY;\n+    \n+    //! the length of the obfuscate key in number of bytes\n+    static const unsigned int OBFUSCATE_KEY_NUM_BYTES;\n+    \n+    std::string CreateObfuscateKey() const;\n+\n public:\n-    CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool fMemory = false, bool fWipe = false);\n+    /**\n+     * @param[in] path        Location in the filesystem where leveldb data will be stored.\n+     * @param[in] nCacheSize  Configures various leveldb cache settings.\n+     * @param[in] fMemory     If true, use leveldb's memory environment.\n+     * @param[in] fWipe       If true, remove all existing data.\n+     * @param[in] obfuscate   If true, store data obfuscated via simple XOR. If false, XOR\n+     *                        with a zero'd byte array.\n+     */\n+    CLevelDBWrapper(const boost::filesystem::path& path, size_t nCacheSize, bool fMemory = false, bool fWipe = false, bool obfuscate = false);\n     ~CLevelDBWrapper();\n \n+    /**\n+     * @param[in] unobfuscate   This should always be true unless we're reading\n+     *                          OBFUSCATE_KEY_KEY.\n+     */\n     template <typename K, typename V>\n-    bool Read(const K& key, V& value) const throw(leveldb_error)\n+    bool Read(const K& key, V& value, bool unobfuscate = true) const throw(leveldb_error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r39108601",
      "id" : 39108601,
      "original_commit_id" : "1f6cb12a080ae431703de69eebca95da68fed46d",
      "original_position" : 57,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39108601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "OK, unittests here are done. If anyone would like to see additional testcases, let me know, but I think I've covered the two important cases: \r\n\r\n0. No existing `chainstate/` data (obfuscation)\r\n0. Existing data (no-op obfuscation)\r\n\r\nIt'd be great if we could get some testers who are affected by anti-virus software (@KyrosKrane ?) trying out this changeset.",
      "created_at" : "2015-09-10T08:02:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139157253",
      "id" : 139157253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-10T08:11:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139157253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "I'd be more than happy to test, but I'm new to testing with Bitcoin off Github. Do I need to download and compile from source?",
      "created_at" : "2015-09-12T08:27:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139740150",
      "id" : 139740150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T08:27:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139740150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "@KyrosKrane if your comfortable with, and are able to compile from source then the github-merge script in /contrib/devtools is an easy way to test pull requests. Once you've cloned the repo, cd in to the directory and run\r\n```\r\ncontrib/devtools/github-merge.sh 6650\r\n```\r\nThat will pull in the code changes from this pull request, and you can then compile as normal.\r\n\r\nOtherwise, @jonasschnelli has gitian buillt binaries for certain pull requests available from https://builds.jonasschnelli.ch/pulls/. He can probably spin up a build for this pull once he gets a chance.",
      "created_at" : "2015-09-12T08:55:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139741331",
      "id" : 139741331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T08:55:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139741331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "https://builds.jonasschnelli.ch/pulls/6650/",
      "created_at" : "2015-09-12T10:31:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139747611",
      "id" : 139747611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T10:31:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139747611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Thanks for the build; that will make this much faster for me. :)\r\n\r\nHere's what I've done so far.\r\n\r\n1) Backed up my existing bitcoin config directory.\r\n2) Backed up my existing bitcoin exe files.\r\n3) Downloaded the test build from @jonasschnelli 's site\r\n4) Deleted everything in my config dir other than the basic config file (just has my connection info and settings)\r\n5) Replaced the exes in my Program Files directory with the exes from the test build.\r\n6) Removed the antivirus exclusion from the bitcoin config directory.\r\n7) Started the test exe.\r\n\r\nI'm now waiting for it to download the blockchain (I have a second node on my local network, so it shouldn't be too slow) and rebuild the chainstate and index files. Once that completes, I'll do a manual scan of the config dir and see if Norton yells at me.",
      "created_at" : "2015-09-12T12:49:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139757965",
      "id" : 139757965,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T12:49:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139757965",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "@KyrosKrane that sounds great, thanks for your help.",
      "created_at" : "2015-09-12T18:48:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139809267",
      "id" : 139809267,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T18:48:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139809267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "@KyrosKrane If you have the time, could you also test with the \"infected\" data directory, verify that by just running the current bitcoin core version does not fix the AV alert?\r\nAfterward, you could check if a ``-reindex`` fixes the AV problem on the \"infected\" data directory.",
      "created_at" : "2015-09-12T18:59:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139809783",
      "id" : 139809783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T18:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139809783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "You read my mind. :)  That's exactly what I'm going to do when this current run ends. It will probably be tomorrow, though; the re-download is taking longer than I thought, even though my other node is locally connected.",
      "created_at" : "2015-09-12T19:32:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139811565",
      "id" : 139811565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-12T19:32:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139811565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "OK, update for today. The re-download completed overnight. No antivirus alerts.  I manually scanned the bitcoin data dir. No alerts. This is as expected.\r\n\r\nNext, I stopped bitcoin-qt.exe and renamed the data directory.  I copied my original (unobfuscated) blocks and chainstate folders, and the bitcoin.conf file from my backup into the now-empty data directory. I tested it by scanning that freshly-copied directory - no antivirus alert. This isn't good. It should be alerting at this point.\r\n\r\nI tried renaming the files from *.ldb to *.sst, but that didn't help. I even tried renaming them to *.exe, which got Norton to actually scan the files in depth, but still no alerts.\r\n\r\nI'm going to continue testing the debug build to see if it behaves as expected.",
      "created_at" : "2015-09-13T17:08:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139896123",
      "id" : 139896123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-13T17:08:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139896123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "Do you know if your AV \"fixed\" the \"infected\" data directory back when it originally happened?",
      "created_at" : "2015-09-13T17:12:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139896280",
      "id" : 139896280,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-13T17:12:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139896280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Well, it certainly broke bitcoin-qt and caused it to crash. It wouldn't restart afterwards until I did a -reindex, which promptly broke a second time. Then I wised up and added the exclusion to my antivirus, and a second -reindex worked.  I'll try doing a reindex in a bit; I want to start bitcoin-qt normally first and see if it will read the (unobfuscated) files correctly.",
      "created_at" : "2015-09-13T17:19:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139896791",
      "id" : 139896791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-13T17:19:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139896791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "bitcoin-qt happily opened with the unobfuscated files. I tested with an old wallet file I had, and it quickly rescanned the blockchain and updated the balance. (I now have three satoshis more than this morning, yay me!)  Next, I exited bitcoin-qt, opened a command prompt, and ran bitcoin-qt.exe -reindex. This errored out. I repeated, in case this was a one time thing, and it gave me the same error. The message is \"Error opening block database\". I attached a screenshot.\r\n\r\n![block database error](https://cloud.githubusercontent.com/assets/458727/9837936/b6329116-5a60-11e5-9e59-4e0369f36dc2.png)\r\n",
      "created_at" : "2015-09-13T17:45:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139899108",
      "id" : 139899108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-13T17:45:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139899108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "@KyrosKrane can you check your log file for anything that might indicate\nwhat went wrong, e.g. a stacktrace?\n\nOn Sunday, September 13, 2015, KyrosKrane <notifications@github.com> wrote:\n\n> bitcoin-qt happily opened with the unobfuscated files. I tested with an\n> old wallet file I had, and it quickly rescanned the blockchain and updated\n> the balance. (I now have three satoshis more than this morning, yay me!)\n> Next, I exited bitcoin-qt, opened a command prompt, and ran bitcoin-qt.exe\n> -reindex. This errored out. I repeated, in case this was a one time thing,\n> and it gave me the same error. The message is \"Error opening block\n> database\". I attached a screenshot.\n>\n> [image: block database error]\n> <https://cloud.githubusercontent.com/assets/458727/9837936/b6329116-5a60-11e5-9e59-4e0369f36dc2.png>\n>\n> \n> Reply to this email directly or view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139899108>.\n>\n",
      "created_at" : "2015-09-13T18:09:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139900590",
      "id" : 139900590,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-13T18:09:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139900590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "I'm slowing down in my old age ... I should have thought of that.  Debug.log file below.\r\n\r\n```\r\n2015-09-13 17:36:27 Bitcoin version v0.11.99.0-f1803c1 (2015-09-12 12:01:31 +0200)\r\n2015-09-13 17:36:27 AppInit2: parameter interaction: -connect set -> setting -dnsseed=0\r\n2015-09-13 17:36:27 GUI: \"registerShutdownBlockReason: Successfully registered: Bitcoin Core didn't yet exit safely...\"\r\n2015-09-13 17:36:27 Using OpenSSL version OpenSSL 1.0.1k 8 Jan 2015\r\n2015-09-13 17:36:27 Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2015-09-13 17:36:27 Default data directory D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n2015-09-13 17:36:27 Using data directory D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n2015-09-13 17:36:27 Using config file D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\bitcoin.conf\r\n2015-09-13 17:36:27 Using at most 125 connections (2048 file descriptors available)\r\n2015-09-13 17:36:27 Using 4 threads for script verification\r\n2015-09-13 17:36:27 Using wallet wallet.dat\r\n2015-09-13 17:36:27 scheduler thread start\r\n2015-09-13 17:36:27 init message: Verifying wallet...\r\n2015-09-13 17:36:27 CDBEnv::Open: LogDir=D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\database ErrorFile=D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\db.log\r\n2015-09-13 17:36:27 Bound to [::]:8333\r\n2015-09-13 17:36:27 Bound to 0.0.0.0:8333\r\n2015-09-13 17:36:27 Cache configuration:\r\n2015-09-13 17:36:27 * Using 2.0MiB for block index database\r\n2015-09-13 17:36:27 * Using 32.5MiB for chain state database\r\n2015-09-13 17:36:27 * Using 65.5MiB for in-memory UTXO set\r\n2015-09-13 17:36:27 init message: Loading block index...\r\n2015-09-13 17:36:27 Wiping LevelDB in D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\blocks\\index\r\n2015-09-13 17:36:29 scheduler thread interrupt\r\n2015-09-13 17:36:29 Shutdown: In progress...\r\n2015-09-13 17:36:29 StopNode()\r\n2015-09-13 17:36:29 Shutdown: done\r\n2015-09-13 17:37:14 \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n2015-09-13 17:37:14 Bitcoin version v0.11.99.0-f1803c1 (2015-09-12 12:01:31 +0200)\r\n2015-09-13 17:37:14 AppInit2: parameter interaction: -connect set -> setting -dnsseed=0\r\n2015-09-13 17:37:14 GUI: \"registerShutdownBlockReason: Successfully registered: Bitcoin Core didn't yet exit safely...\"\r\n2015-09-13 17:37:14 Using OpenSSL version OpenSSL 1.0.1k 8 Jan 2015\r\n2015-09-13 17:37:14 Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2015-09-13 17:37:14 Default data directory D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n2015-09-13 17:37:14 Using data directory D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n2015-09-13 17:37:14 Using config file D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\bitcoin.conf\r\n2015-09-13 17:37:14 Using at most 125 connections (2048 file descriptors available)\r\n2015-09-13 17:37:14 Using 4 threads for script verification\r\n2015-09-13 17:37:14 Using wallet wallet.dat\r\n2015-09-13 17:37:14 scheduler thread start\r\n2015-09-13 17:37:14 init message: Verifying wallet...\r\n2015-09-13 17:37:14 CDBEnv::Open: LogDir=D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\database ErrorFile=D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\db.log\r\n2015-09-13 17:37:14 Bound to [::]:8333\r\n2015-09-13 17:37:14 Bound to 0.0.0.0:8333\r\n2015-09-13 17:37:14 Cache configuration:\r\n2015-09-13 17:37:14 * Using 2.0MiB for block index database\r\n2015-09-13 17:37:14 * Using 32.5MiB for chain state database\r\n2015-09-13 17:37:14 * Using 65.5MiB for in-memory UTXO set\r\n2015-09-13 17:37:14 init message: Loading block index...\r\n2015-09-13 17:37:14 Wiping LevelDB in D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\blocks\\index\r\n2015-09-13 17:37:14 Opening LevelDB in D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\blocks\\index\r\n2015-09-13 17:37:14 Opened LevelDB successfully\r\n2015-09-13 17:37:14 Wiping LevelDB in D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\chainstate\r\n2015-09-13 17:37:19 scheduler thread interrupt\r\n2015-09-13 17:37:19 Shutdown: In progress...\r\n2015-09-13 17:37:19 StopNode()\r\n2015-09-13 17:37:19 Shutdown: done\r\n2015-09-13 17:37:38 \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n2015-09-13 17:37:38 Bitcoin version v0.11.99.0-f1803c1 (2015-09-12 12:01:31 +0200)\r\n2015-09-13 17:37:38 AppInit2: parameter interaction: -connect set -> setting -dnsseed=0\r\n2015-09-13 17:37:38 GUI: \"registerShutdownBlockReason: Successfully registered: Bitcoin Core didn't yet exit safely...\"\r\n2015-09-13 17:37:38 Using OpenSSL version OpenSSL 1.0.1k 8 Jan 2015\r\n2015-09-13 17:37:38 Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2015-09-13 17:37:38 Default data directory D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n2015-09-13 17:37:38 Using data directory D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\r\n2015-09-13 17:37:38 Using config file D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\bitcoin.conf\r\n2015-09-13 17:37:38 Using at most 125 connections (2048 file descriptors available)\r\n2015-09-13 17:37:38 Using 4 threads for script verification\r\n2015-09-13 17:37:38 Using wallet wallet.dat\r\n2015-09-13 17:37:38 scheduler thread start\r\n2015-09-13 17:37:38 init message: Verifying wallet...\r\n2015-09-13 17:37:38 CDBEnv::Open: LogDir=D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\database ErrorFile=D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\db.log\r\n2015-09-13 17:37:38 Bound to [::]:8333\r\n2015-09-13 17:37:38 Bound to 0.0.0.0:8333\r\n2015-09-13 17:37:38 Cache configuration:\r\n2015-09-13 17:37:38 * Using 2.0MiB for block index database\r\n2015-09-13 17:37:38 * Using 32.5MiB for chain state database\r\n2015-09-13 17:37:38 * Using 65.5MiB for in-memory UTXO set\r\n2015-09-13 17:37:38 init message: Loading block index...\r\n2015-09-13 17:37:38 Wiping LevelDB in D:\\Users\\USERNAME\\AppData\\Roaming\\Bitcoin\\blocks\\index\r\n2015-09-13 17:42:00 scheduler thread interrupt\r\n2015-09-13 17:42:00 Shutdown: In progress...\r\n2015-09-13 17:42:00 StopNode()\r\n2015-09-13 17:42:00 Shutdown: done\r\n```\r\n\r\nThe chainstate directory was deleted, as was the index directory under the blocks directory. Under my main bitcoin data dir, there was a new directory named \"database\" with a single file in it named log.0000000001. The contents appear binary.",
      "created_at" : "2015-09-13T18:22:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-139901256",
      "id" : 139901256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-13T18:22:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/139901256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "@KyrosKrane sorry it's taken me a bit to respond; I finally have some time to sit down and take a look. I'm going to add a testcase that simulates a `-reindex` at the `CLevelDBWrapper` layer to see if that will reproduce this failure for me locally.\r\n\r\nThanks again for putting in the work to test this.",
      "created_at" : "2015-09-15T01:23:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-140247024",
      "id" : 140247024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-15T01:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140247024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "@KyrosKrane dang, can't reproduce with a unittest. Any chance that running with the `-debug` flag yields any more information? e.g. `bitcoind -reindex -debug`? If not, I'll have to try to reproduce on my end with a full dataset. As a side-note, I wonder why the behavior you're seeing isn't reflected in `qa/rpc-tests/reindex.py`...",
      "created_at" : "2015-09-17T04:39:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-140968821",
      "id" : 140968821,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-17T04:39:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140968821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "body" : "OK, now this is weird. I ran ``bitcoin-qt.exe -reindex -debug``, and it worked like a champ. It took almost as long as re-downloading the entire blockchain again; I had to leave it running overnight. But it didn't give any errors and it seems to have completed successfully.  The debug.log file is a whopping 335MB uncompressed, so I'm not going to post that unless someone really needs it.\r\n\r\nI'm going to restore my original, unobfuscated data directory, then try running -reindex -debug on it to see if it causes the error.  If that works, I'll restore once again, then do just -reindex to see whether I get the error once more.",
      "created_at" : "2015-09-18T09:13:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-141389319",
      "id" : 141389319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-18T09:13:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141389319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "OK, I've tested this twice now. With my original, unobfuscated data directory, if I do ``bitcoin-qt.exe -reindex -debug``, it will work successfully.  If I only do ``bitcoin-qt.exe -reindex``, it fails with the error I posted above.",
      "created_at" : "2015-09-18T10:52:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-141416946",
      "id" : 141416946,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-18T10:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141416946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "body" : "@KyrosKrane very odd... the presence of the `-debug` flag doesn't materially affect the reindexing one way or the other on my platform (ubuntu 14.04). Wondering if there's anything in this changeset that would explain `-debug` showing different behavior on a windows system.",
      "created_at" : "2015-09-21T02:34:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-141862233",
      "id" : 141862233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-21T02:34:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141862233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40018273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40018273"
         }
      },
      "body" : "Sorry, I'm a C++ beginner here, but I have a question about the second parameter on this string constructor call. I think (based on constuctor 5 in [this link](http://www.cplusplus.com/reference/string/string/string/)) it should just be OBFUSCATE_KEY_NUM_BYTES. Right now, you're passing in the address of the first and last bytes of the buffer you created, rather than the address of the buffer and the number of bytes. (In fact, the second parameter would be the address of the first byte _after_ the buffer!) Or are you using a different constructor? If this is the right constructor, wouldn't this lead to a buffer overflow issue? (Fair warning, I probably totally misunderstood what you're doing here, so please double check my logic!)",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-21T20:01:30Z",
      "diff_hunk" : "@@ -87,3 +106,18 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Prefixed with null character to avoid collisions with other keys\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY = \"\\000obfuscate_key\";\n+\n+const unsigned int CLevelDBWrapper::OBFUSCATE_KEY_NUM_BYTES = 8;\n+\n+/**\n+ * Returns a string (consisting of 8 random bytes) suitable for use as an \n+ * obfuscating XOR key. \n+ */\n+std::string CLevelDBWrapper::CreateObfuscateKey() const {\n+    unsigned char buff[OBFUSCATE_KEY_NUM_BYTES];\n+    GetRandBytes(buff, OBFUSCATE_KEY_NUM_BYTES);\n+    return std::string(&buff[0], &buff[OBFUSCATE_KEY_NUM_BYTES]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40018273",
      "id" : 40018273,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 66,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40018273",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40024293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40024293"
         }
      },
      "body" : "@KyrosKrane being a C++ newbie myself, I screwed this up the first time around; @pstratem [gave me some guidance](https://github.com/bitcoin/bitcoin/pull/6650#discussion_r38889104) on the proper incantation... though upon reading the docs again, I very much agree that what you're saying *looks* correct, so I gave it a shot. Unfortunately, the compiler spat back a\r\n```\r\nleveldbwrapper.cpp:122:57: error: call of overloaded basic_string(unsigned char*, const unsigned int&) is ambiguous\r\n     return std::string(&buff[0], OBFUSCATE_KEY_NUM_BYTES);\r\n```\r\nOn further investigation, I realized this is because `buff` is an `unsigned char` array, not a `char` array -- the two types are \"unrelated\" types in C++, meaning (apparently) one can't easily be substituted for another. I believe this invocation of the constructor falls into the (7) range invocation with `unsigned char*` being the templated type.\r\n\r\nI think you might be onto something here though -- could be that windows is treating the implicit conversion from unsigned char * to string oddly (anyone else think that's plausible?). I'm going to look for a simpler, less confusing way to do this. Maybe we just keep `obfuscate_key` as an unsigned char array instead of a string.\r\n\r\nThanks again for helping to dig into this problem.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-21T20:52:49Z",
      "diff_hunk" : "@@ -87,3 +106,18 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Prefixed with null character to avoid collisions with other keys\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY = \"\\000obfuscate_key\";\n+\n+const unsigned int CLevelDBWrapper::OBFUSCATE_KEY_NUM_BYTES = 8;\n+\n+/**\n+ * Returns a string (consisting of 8 random bytes) suitable for use as an \n+ * obfuscating XOR key. \n+ */\n+std::string CLevelDBWrapper::CreateObfuscateKey() const {\n+    unsigned char buff[OBFUSCATE_KEY_NUM_BYTES];\n+    GetRandBytes(buff, OBFUSCATE_KEY_NUM_BYTES);\n+    return std::string(&buff[0], &buff[OBFUSCATE_KEY_NUM_BYTES]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40024293",
      "id" : 40024293,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 66,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40024293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40026212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40026212"
         }
      },
      "body" : "It's 7, a range constructor. Note that the second argument points to the position after the last element in the range. Pointers can be used like iterators, and it should be fine.\r\n\r\nhttps://ideone.com/tBWxwM",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-21T21:08:08Z",
      "diff_hunk" : "@@ -87,3 +106,18 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Prefixed with null character to avoid collisions with other keys\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY = \"\\000obfuscate_key\";\n+\n+const unsigned int CLevelDBWrapper::OBFUSCATE_KEY_NUM_BYTES = 8;\n+\n+/**\n+ * Returns a string (consisting of 8 random bytes) suitable for use as an \n+ * obfuscating XOR key. \n+ */\n+std::string CLevelDBWrapper::CreateObfuscateKey() const {\n+    unsigned char buff[OBFUSCATE_KEY_NUM_BYTES];\n+    GetRandBytes(buff, OBFUSCATE_KEY_NUM_BYTES);\n+    return std::string(&buff[0], &buff[OBFUSCATE_KEY_NUM_BYTES]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40026212",
      "id" : 40026212,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 66,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40026212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "body" : "Thanks both for the clarifications!",
      "created_at" : "2015-09-21T21:31:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-142114448",
      "id" : 142114448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-21T21:31:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/142114448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/458727?v=3",
         "events_url" : "https://api.github.com/users/KyrosKrane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/KyrosKrane/followers",
         "following_url" : "https://api.github.com/users/KyrosKrane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/KyrosKrane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/KyrosKrane",
         "id" : 458727,
         "login" : "KyrosKrane",
         "organizations_url" : "https://api.github.com/users/KyrosKrane/orgs",
         "received_events_url" : "https://api.github.com/users/KyrosKrane/received_events",
         "repos_url" : "https://api.github.com/users/KyrosKrane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/KyrosKrane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/KyrosKrane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/KyrosKrane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40669844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40669844"
         }
      },
      "body" : "This message is too vague. `\"Wrote new database obfuscation key for %s: %s\", path.string(), ObfuscateKeyHex()` maybe?",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:23:42Z",
      "diff_hunk" : "@@ -67,6 +69,23 @@ CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path& path, size_t nCa\n     leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n     HandleError(status);\n     LogPrintf(\"Opened LevelDB successfully\\n\");\n+\n+    // The base-case obfuscation key, which is a noop.\n+    obfuscate_key = std::string(OBFUSCATE_KEY_NUM_BYTES, '\\000');\n+\n+    bool key_exists = Read(OBFUSCATE_KEY_KEY, obfuscate_key);\n+\n+    if (!key_exists && obfuscate && IsEmpty()) {\n+        // Initialize non-degenerate obfuscation if it won't upset \n+        // existing, non-obfuscated data.\n+        std::string new_key = CreateObfuscateKey();\n+\n+        // Write `new_key` so we don't obfuscate the key with itself\n+        Write(OBFUSCATE_KEY_KEY, new_key);\n+        obfuscate_key = new_key;\n+\n+        LogPrintf(\"Wrote new obfuscate key '%s'\\n\", ObfuscateKeyHex());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40669844",
      "id" : 40669844,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 44,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40669844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40669968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40669968"
         }
      },
      "body" : "Code style nit: { on next line for function declaration\r\n(also for the other new functions)",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:24:44Z",
      "diff_hunk" : "@@ -87,3 +106,18 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Prefixed with null character to avoid collisions with other keys\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY = \"\\000obfuscate_key\";\n+\n+const unsigned int CLevelDBWrapper::OBFUSCATE_KEY_NUM_BYTES = 8;\n+\n+/**\n+ * Returns a string (consisting of 8 random bytes) suitable for use as an \n+ * obfuscating XOR key. \n+ */\n+std::string CLevelDBWrapper::CreateObfuscateKey() const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40669968",
      "id" : 40669968,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 63,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40669968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40669996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40669996"
         }
      },
      "body" : "Looks fine to me.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:25:00Z",
      "diff_hunk" : "@@ -87,3 +106,18 @@ bool CLevelDBWrapper::WriteBatch(CLevelDBBatch& batch, bool fSync) throw(leveldb\n     HandleError(status);\n     return true;\n }\n+\n+// Prefixed with null character to avoid collisions with other keys\n+const std::string CLevelDBWrapper::OBFUSCATE_KEY_KEY = \"\\000obfuscate_key\";\n+\n+const unsigned int CLevelDBWrapper::OBFUSCATE_KEY_NUM_BYTES = 8;\n+\n+/**\n+ * Returns a string (consisting of 8 random bytes) suitable for use as an \n+ * obfuscating XOR key. \n+ */\n+std::string CLevelDBWrapper::CreateObfuscateKey() const {\n+    unsigned char buff[OBFUSCATE_KEY_NUM_BYTES];\n+    GetRandBytes(buff, OBFUSCATE_KEY_NUM_BYTES);\n+    return std::string(&buff[0], &buff[OBFUSCATE_KEY_NUM_BYTES]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40669996",
      "id" : 40669996,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 66,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40669996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40670186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40670186"
         }
      },
      "body" : "Please use a `boost::scoped_ptr<leveldb::Iterator>` here, like in `txdb.cpp`, to automatically free the iterator when it goes out of scope.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:26:56Z",
      "diff_hunk" : "@@ -168,6 +190,19 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40670186",
      "id" : 40670186,
      "original_commit_id" : "3bdc38b7ede69d76758c393398b975323bc61dd6",
      "original_position" : 74,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40670186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40670466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40670466"
         }
      },
      "body" : "I'd make this signature `const std::string& GetObfuscateKey() const`\r\n\r\n- Otherwise it looks like an action: Obfuscate the key!\r\n- As this returns a field of the object, we can avoid a copy by returning a const reference\r\n\r\nEdit: oops, const-correctness",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:29:24Z",
      "diff_hunk" : "@@ -168,6 +199,44 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();\n+        it->SeekToFirst();\n+        bool empty = !(it->Valid());\n+        delete it;\n+        return empty;\n+    }\n+\n+    /**\n+     * Accessor for obfuscate_key.\n+     */\n+    std::string ObfuscateKey() const { return obfuscate_key; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40670466",
      "id" : 40670466,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 113,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40670466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40670720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40670720"
         }
      },
      "body" : "Same here: make it GetObfuscateKeyHex(). Also don't re-implement the hex logic here, but use `HexStr(...)`.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:31:22Z",
      "diff_hunk" : "@@ -168,6 +199,44 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();\n+        it->SeekToFirst();\n+        bool empty = !(it->Valid());\n+        delete it;\n+        return empty;\n+    }\n+\n+    /**\n+     * Accessor for obfuscate_key.\n+     */\n+    std::string ObfuscateKey() const { return obfuscate_key; }\n+\n+    /**\n+     * Return the obfuscate_key as a hex-formatted string.\n+     */\n+    std::string ObfuscateKeyHex()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40670720",
      "id" : 40670720,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 118,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40670720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40671196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40671196"
         }
      },
      "body" : "Please also log the obfuscation key if it did exist yet, or is all-zeros: this will help troubleshooting, for example when people have problems with their virusscanner and block database files we can see if obfuscation is being used.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T13:35:19Z",
      "diff_hunk" : "@@ -67,6 +69,23 @@ CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path& path, size_t nCa\n     leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);\n     HandleError(status);\n     LogPrintf(\"Opened LevelDB successfully\\n\");\n+\n+    // The base-case obfuscation key, which is a noop.\n+    obfuscate_key = std::string(OBFUSCATE_KEY_NUM_BYTES, '\\000');\n+\n+    bool key_exists = Read(OBFUSCATE_KEY_KEY, obfuscate_key);\n+\n+    if (!key_exists && obfuscate && IsEmpty()) {\n+        // Initialize non-degenerate obfuscation if it won't upset \n+        // existing, non-obfuscated data.\n+        std::string new_key = CreateObfuscateKey();\n+\n+        // Write `new_key` so we don't obfuscate the key with itself\n+        Write(OBFUSCATE_KEY_KEY, new_key);\n+        obfuscate_key = new_key;\n+\n+        LogPrintf(\"Wrote new obfuscate key '%s'\\n\", ObfuscateKeyHex());\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40671196",
      "id" : 40671196,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 45,
      "path" : "src/leveldbwrapper.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40671196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Looks good to me apart from the mentioned small things. Will start testing this.",
      "created_at" : "2015-09-29T13:36:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#issuecomment-144060415",
      "id" : 144060415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6650",
      "updated_at" : "2015-09-29T13:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/144060415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40675384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40675384"
         }
      },
      "body" : "I'd put the implementation of these functions in leveldbwrapper.cpp instead of the header file (unless there's a reason I'm overlooking)",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T14:09:35Z",
      "diff_hunk" : "@@ -168,6 +199,44 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40675384",
      "id" : 40675384,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 98,
      "path" : "src/leveldbwrapper.h",
      "position" : 106,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40675384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40691462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40691462"
         }
      },
      "body" : "I implemented these in the header to maintain consistency with much of the rest of `CLevelDBWrapper`, which is also defined here. I'll move what's below over to the `.cpp` file, but we should probably think about moving the rest of it out of the header at some point.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T16:02:10Z",
      "diff_hunk" : "@@ -168,6 +199,44 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40691462",
      "id" : 40691462,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 98,
      "path" : "src/leveldbwrapper.h",
      "position" : 106,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40691462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40691568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40691568"
         }
      },
      "body" : "Ah, thanks. I was looking for an existing implementation of that... :)",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T16:03:08Z",
      "diff_hunk" : "@@ -168,6 +199,44 @@ class CLevelDBWrapper\n     {\n         return pdb->NewIterator(iteroptions);\n     }\n+\n+    /**\n+     * Return true if the database managed by this class contains no entries.\n+     */\n+    bool IsEmpty()\n+    {\n+        leveldb::Iterator* it = NewIterator();\n+        it->SeekToFirst();\n+        bool empty = !(it->Valid());\n+        delete it;\n+        return empty;\n+    }\n+\n+    /**\n+     * Accessor for obfuscate_key.\n+     */\n+    std::string ObfuscateKey() const { return obfuscate_key; }\n+\n+    /**\n+     * Return the obfuscate_key as a hex-formatted string.\n+     */\n+    std::string ObfuscateKeyHex()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40691568",
      "id" : 40691568,
      "original_commit_id" : "b1101f86937db4b2f3e254f7de8ec7b42354324b",
      "original_position" : 118,
      "path" : "src/leveldbwrapper.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T16:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40691568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=3",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40706110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40706110"
         }
      },
      "body" : "To save a `%` operation for every byte (which is essentially a division!) and add a sanity check for empty key, I suggest:\r\n```c++\r\n    void Xor(const std::string& key)\r\n    {\r\n        assert(key.size() > 0);\r\n        for (size_type i = 0, j = 0; i != size(); i++) {\r\n            vch[i] ^= key[j++];\r\n            if (j == key.size())\r\n                j = 0;\r\n        }\r\n    }\r\n```",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T18:04:26Z",
      "diff_hunk" : "@@ -296,6 +296,16 @@ class CDataStream\n         data.insert(data.end(), begin(), end());\n         clear();\n     }\n+\n+    /**\n+     * XOR the contents of this stream with a certain key.\n+     *\n+     * @param[in] key    The key used to XOR the data in this stream.\n+     */\n+    void Xor(const std::string& key) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40706110",
      "id" : 40706110,
      "original_commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "original_position" : 10,
      "path" : "src/streams.h",
      "position" : 10,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T18:08:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40706110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40706362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40706362"
         }
      },
      "body" : "As this is task-specific ideally we wouldn't have this operation on `CDataStream` itself, but as a function that manipulates a CDataStream.",
      "commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "created_at" : "2015-09-29T18:06:27Z",
      "diff_hunk" : "@@ -296,6 +296,16 @@ class CDataStream\n         data.insert(data.end(), begin(), end());\n         clear();\n     }\n+\n+    /**\n+     * XOR the contents of this stream with a certain key.\n+     *\n+     * @param[in] key    The key used to XOR the data in this stream.\n+     */\n+    void Xor(const std::string& key) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6650#discussion_r40706362",
      "id" : 40706362,
      "original_commit_id" : "dbbb3ff64d28d99b2b43e172204ac61e4bb5b298",
      "original_position" : 10,
      "path" : "src/streams.h",
      "position" : 10,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6650",
      "updated_at" : "2015-09-29T18:06:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/40706362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
