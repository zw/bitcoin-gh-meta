[
   {
      "body" : "`-maxuploadtarget` is in MB (1000000), not MiB (1048576), not currently documented, but just in case it does get documented.\r\n\r\nIf a user wants to control the total amount transferred, then I don't think MB per day is a good unit to use. If they have a transfer cap, then it is most likely tied to a monthly billing cycle, so MB/month is likely better. (For example, I think Comcast in the US has a 250GB/month cap, so a Comcast customer might like to allow 100GB/month, or something like that.)",
      "created_at" : "2015-09-03T14:47:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137473807",
      "id" : 137473807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-03T14:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137473807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=3",
         "events_url" : "https://api.github.com/users/casey/events{/privacy}",
         "followers_url" : "https://api.github.com/users/casey/followers",
         "following_url" : "https://api.github.com/users/casey/following{/other_user}",
         "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/casey",
         "id" : 1945,
         "login" : "casey",
         "organizations_url" : "https://api.github.com/users/casey/orgs",
         "received_events_url" : "https://api.github.com/users/casey/received_events",
         "repos_url" : "https://api.github.com/users/casey/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/casey"
      }
   },
   {
      "body" : "> MB/month is likely better\r\n\r\nWhich could result in all of the 100GB being eaten up on the first few days of the timeframe. Maybe the owner restarts the server mid-month and then serves 200GB of historic blocks that month.",
      "created_at" : "2015-09-03T14:54:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137475865",
      "id" : 137475865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-03T14:54:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137475865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> Which could result in all of the 100GB being eaten up on the first few days of the timeframe. Maybe the owner restarts the server mid-month and then serves 200GB of historic blocks that month.\r\n\r\nOnce combined with connection throttling, which would make the speed that the 100GB can be 'eaten up' configurable, (which @cfields is working on ) it's less of an issue. ",
      "created_at" : "2015-09-03T14:57:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137476598",
      "id" : 137476598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-03T14:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137476598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> -maxuploadtarget is in MB (1000000), not MiB (1048576), not currently documented, but just in case it does get documented.\r\n\r\n@casey Thanks. Will fix it.\r\n\r\nNot sure about limit per month or per day.\r\nPer month can be difficult because not every month has the same amount of days (30/31/27/28). Also it's unclear how one could get \"in sync\" with providers month rhythm (must not be first to last day of month). Though, it still would allow to use a daily measurement cycle (break down the month limit to days, keep focus on a day limit).\r\n\r\nFor now i think keep the day-limit does make things more easy and controllable.",
      "created_at" : "2015-09-03T15:09:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137479693",
      "id" : 137479693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-03T15:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137479693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I need some kind of goal set in kB/second, as I am often forced to shutdown my node for reliable phone calls. :(",
      "created_at" : "2015-09-03T15:48:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137490859",
      "id" : 137490859,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-03T15:48:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137490859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Agree with @luke-jr here, we think about available bandwidth in terms of kB/sec rather than MB/day because that's how it's always reported to us - adverts from ISPs, speed checking websites, P2P torrenting apps etc.",
      "created_at" : "2015-09-04T00:02:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137605028",
      "id" : 137605028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T00:02:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137605028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6762681?v=3",
         "events_url" : "https://api.github.com/users/NanoAkron/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NanoAkron/followers",
         "following_url" : "https://api.github.com/users/NanoAkron/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NanoAkron/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NanoAkron",
         "id" : 6762681,
         "login" : "NanoAkron",
         "organizations_url" : "https://api.github.com/users/NanoAkron/orgs",
         "received_events_url" : "https://api.github.com/users/NanoAkron/received_events",
         "repos_url" : "https://api.github.com/users/NanoAkron/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NanoAkron/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NanoAkron/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NanoAkron"
      }
   },
   {
      "body" : "@NanoAkron: not sure if @luke-jr is for a bandwidth kB/sec limit.\r\nWhat is the most annoying thing that can happen when you download something over torrent? Probably if you connected and download from a throttled peer.\r\n\r\nBandwidth throttled peers is not something we should *not* encourage within bitcoin-core. If a node-operator likes to limit the bandwidth, he can use different tools. What we really should do is reducing bandwidth without impair the network quality and speed. My stats showed me that most traffic is done outbound and most of the outbound traffic is consumed by serving historical blocks (help other nodes to initial sync a new chain).\r\n\r\n**This PR can reduce bandwidth significant while not impair the network quality.**\r\n**An initial sync for a new peer is not something that is very time critical.**\r\n\r\nThere was a discussion on #bitcoin-dev about the -maxuploadtarget (gmaxwell, wumpus, me) http://bitcoinstats.com/irc/bitcoin-dev/logs/2015/09/02#l1441180902.0)",
      "created_at" : "2015-09-04T07:20:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137663963",
      "id" : 137663963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T07:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137663963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> download from a throttled [torrent] peer\r\n\r\nI don't think you can compare torrent to bitcoin-core serving blocks... Using torrent you are happy to get any transmission speed because it is parallel download anyway.\r\n\r\nOn the contrary, bitcoin-core is doing moving-window download (c.f. #4468). So you always want to fetch the blocks from peers which can upload to you not much slower than your download speed?\r\n\r\nThis PR makes the full node to disconnect from initial-download-peers instead of serving them at lower speed, which sounds like the better solution to me.",
      "created_at" : "2015-09-04T08:47:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137681449",
      "id" : 137681449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T08:47:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137681449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> This PR makes the full node to disconnect from initial-download-peers instead of serving them at lower speed, which sounds like the better solution to me.\r\n\r\nTwo questions:\r\n\r\n* What is the benefit for a peer in initial sync-state when it gets served with throttled bandwidth (lets assume 10kb/s) in comparison to a disconnect?\r\n* What is the benefit for a bandwidth limited peer to serve historical blocks with limited bandwidth rather then do a disconnect?",
      "created_at" : "2015-09-04T09:05:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137684346",
      "id" : 137684346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T09:05:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137684346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Since 0.10 it does not really hurt much anymore to be served by a throttled\npeer, as the download algorithm will download in parallel from many, and if\none is significantly slower than others, disconnect it itself.\n",
      "created_at" : "2015-09-04T09:12:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137685349",
      "id" : 137685349,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T09:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137685349",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@jonasschnelli To answer your two questions: No, I don't see a benefit. My wording was confusing, so to be clear: I am *supporting* this PR/commit. (Just as @sipa said, throttling won't help as it results in disconnect anyway)",
      "created_at" : "2015-09-04T09:20:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137686528",
      "id" : 137686528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T09:20:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137686528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Having an \"instant\" bandwidth limit to work with can enable Core to make intelligent-ish decisions, like not inv'ing/uploading new blocks to more than one peer at a time unless the current-upload peer is downloading at a slow rate.",
      "created_at" : "2015-09-04T12:30:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137723150",
      "id" : 137723150,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-04T12:30:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137723150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Surely we need some sort of scaling to our bandwidth limitations/throttling here - serving historic blocks to unsynced peers could 'trickle-feed' in the background at a few 10s of kB/sec, and anything within the last 60 blocks or so could then be served with greater priority. \r\n\r\nThis would need the unsynced peer to know with certainty the true current block height so that it didn't drop slow inbound connections, because this could be a new attack vector.",
      "created_at" : "2015-09-05T14:27:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-137960225",
      "id" : 137960225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-05T14:27:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137960225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6762681?v=3",
         "events_url" : "https://api.github.com/users/NanoAkron/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NanoAkron/followers",
         "following_url" : "https://api.github.com/users/NanoAkron/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NanoAkron/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NanoAkron",
         "id" : 6762681,
         "login" : "NanoAkron",
         "organizations_url" : "https://api.github.com/users/NanoAkron/orgs",
         "received_events_url" : "https://api.github.com/users/NanoAkron/received_events",
         "repos_url" : "https://api.github.com/users/NanoAkron/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NanoAkron/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NanoAkron/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NanoAkron"
      }
   },
   {
      "body" : "@casey  of course, any longer window cap can be divided down.   Breaking it up into smaller groups has a side effect of allowing us more freedom to ignore the resource scheduling issue.\r\n\r\nImagine that a low monthly cap were widely deployed on the network.  Then the whole network might blow through its cap in a few days at the start of the month, and be unwilling to serve blocks for the rest of the month!   The daily limit (especially with the arbitrary start point) is less of an issue.\r\n\r\n@luke-jr Your phone call issue is largely orthogonal to what this is addressing.   Good behavior with respect to buffer bloat and general rate restriction are another matter from overall usage.  Those need to be address too, but in other PRs. :)\r\n\r\n\r\n\r\n",
      "created_at" : "2015-09-06T07:25:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138049630",
      "id" : 138049630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-06T07:25:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138049630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "With the above mentioned comparison bug fixed, I can confirm that the basic functionality works once the limit is crossed: new blocks are relayed without issue, old blocks result in disconnect.",
      "created_at" : "2015-09-07T08:10:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138227127",
      "id" : 138227127,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-07T08:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138227127",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell: Thanks for the review!\r\nUpdated the time check (block older than a week) and did some testing. Seems to work like this.",
      "created_at" : "2015-09-07T15:47:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138328237",
      "id" : 138328237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-07T15:47:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138328237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r38875088"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38875088"
         }
      },
      "body" : "Specify units (bytes? megabytes?) and window size (seconds, days?)",
      "commit_id" : "30922c33bfc04ce12ebb5b53363a5321fe906a17",
      "created_at" : "2015-09-07T17:36:04Z",
      "diff_hunk" : "@@ -335,6 +335,7 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += HelpMessageOpt(\"-whitebind=<addr>\", _(\"Bind to given address and whitelist peers connecting to it. Use [host]:port notation for IPv6\"));\n     strUsage += HelpMessageOpt(\"-whitelist=<netmask>\", _(\"Whitelist peers connecting from the given netmask or IP address. Can be specified multiple times.\") +\n         \" \" + _(\"Whitelisted peers cannot be DoS banned and their transactions are always relayed, even if they are already in the mempool, useful e.g. for a gateway\"));\n+    strUsage += HelpMessageOpt(\"-maxuploadtarget=<n>\", strprintf(_(\"Tries to keep outbound traffic under the given target, 0 = no limit (default: %d)\"), 0));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r38875088",
      "id" : 38875088,
      "original_commit_id" : "32f685b7d54b11ec44f8ffd9bef42229f8441a53",
      "original_position" : 4,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622",
      "updated_at" : "2015-09-18T14:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/38875088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "might want to add a test so that it won't drop the last connection? I'm not sure but if you imagine e.g. someone using -connect and having several peers down already? -- then again is the peer really useful if its fetching old blocks?",
      "created_at" : "2015-09-07T18:40:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138354611",
      "id" : 138354611,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-07T18:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138354611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Not sure how useful a peer with height < now-1week is. But it could catch up and then be helpful. Thought, I think we should respect the uploadtarget in the first place.\r\n\r\nExcluding -whitebind looks more important to me (could be implemented in a follow up PR).",
      "created_at" : "2015-09-07T20:26:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138371110",
      "id" : 138371110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-07T20:26:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138371110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "With respect to forcing a minimum on the argument. Perhaps it should just whine in the logs if you've asked for a value that is too small?    One consequence of the current setup is that every restart forces another 144MB of history transfer.   (I removed that code in my own copy because it makes the software much easier to test.)\r\n\r\n",
      "created_at" : "2015-09-07T23:15:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138391943",
      "id" : 138391943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-07T23:15:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138391943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "* Fixed @sipa nit (mention MiB as unit per 24h cycle).\r\n* Dropped forcing of a minimum target of 24 hours of blocks * MAX_BLOCKSIZE, only warn in a such case.",
      "created_at" : "2015-09-08T12:42:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-138548472",
      "id" : 138548472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-08T12:42:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/138548472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r39578205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39578205"
         }
      },
      "body" : "Univalue nit:  I wonder if we should add new code with Pair()   Ideal is to eliminate Pair() usage, and simply use object.pushKV()\r\n\r\nMaybe yes (don't use an obsolete interface), maybe no (stay consistent with surrounding code).\r\n",
      "commit_id" : "30922c33bfc04ce12ebb5b53363a5321fe906a17",
      "created_at" : "2015-09-15T23:21:10Z",
      "diff_hunk" : "@@ -378,6 +378,15 @@ UniValue getnettotals(const UniValue& params, bool fHelp)\n     obj.push_back(Pair(\"totalbytesrecv\", CNode::GetTotalBytesRecv()));\n     obj.push_back(Pair(\"totalbytessent\", CNode::GetTotalBytesSent()));\n     obj.push_back(Pair(\"timemillis\", GetTimeMillis()));\n+\n+    UniValue outboundLimit(UniValue::VOBJ);\n+    outboundLimit.push_back(Pair(\"timeframe\", CNode::GetMaxOutboundTimeframe()));\n+    outboundLimit.push_back(Pair(\"target\", CNode::GetMaxOutboundTarget()));\n+    outboundLimit.push_back(Pair(\"target_reached\", CNode::OutboundTargetReached(false)));\n+    outboundLimit.push_back(Pair(\"serve_historical_blocks\", !CNode::OutboundTargetReached(true)));\n+    outboundLimit.push_back(Pair(\"bytes_left_in_cycle\", CNode::GetOutboundTargetBytesLeft()));\n+    outboundLimit.push_back(Pair(\"time_left_in_cycle\", CNode::GetMaxOutboundTimeLeftInCycle()));\n+    obj.push_back(Pair(\"uploadtarget\", outboundLimit));\n     return obj;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r39578205",
      "id" : 39578205,
      "original_commit_id" : "93f3de19530dd1179c5c612df4ec159f29514bc4",
      "original_position" : 13,
      "path" : "src/rpcnet.cpp",
      "position" : 13,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622",
      "updated_at" : "2015-09-18T14:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39578205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "concept and quick code review ACK\r\n",
      "created_at" : "2015-09-15T23:21:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-140579009",
      "id" : 140579009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-15T23:21:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140579009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "utACK and ACK if tests are added",
      "created_at" : "2015-09-16T08:28:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-140668317",
      "id" : 140668317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-16T08:28:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140668317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r39738710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39738710"
         }
      },
      "body" : "Agreed. A KV push method for `UniValue` would be nice. Out of scope for this PR and probably a relatively big changeset if all current `push_back(Pair())` will be converted.",
      "commit_id" : "30922c33bfc04ce12ebb5b53363a5321fe906a17",
      "created_at" : "2015-09-17T12:22:16Z",
      "diff_hunk" : "@@ -378,6 +378,15 @@ UniValue getnettotals(const UniValue& params, bool fHelp)\n     obj.push_back(Pair(\"totalbytesrecv\", CNode::GetTotalBytesRecv()));\n     obj.push_back(Pair(\"totalbytessent\", CNode::GetTotalBytesSent()));\n     obj.push_back(Pair(\"timemillis\", GetTimeMillis()));\n+\n+    UniValue outboundLimit(UniValue::VOBJ);\n+    outboundLimit.push_back(Pair(\"timeframe\", CNode::GetMaxOutboundTimeframe()));\n+    outboundLimit.push_back(Pair(\"target\", CNode::GetMaxOutboundTarget()));\n+    outboundLimit.push_back(Pair(\"target_reached\", CNode::OutboundTargetReached(false)));\n+    outboundLimit.push_back(Pair(\"serve_historical_blocks\", !CNode::OutboundTargetReached(true)));\n+    outboundLimit.push_back(Pair(\"bytes_left_in_cycle\", CNode::GetOutboundTargetBytesLeft()));\n+    outboundLimit.push_back(Pair(\"time_left_in_cycle\", CNode::GetMaxOutboundTimeLeftInCycle()));\n+    obj.push_back(Pair(\"uploadtarget\", outboundLimit));\n     return obj;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r39738710",
      "id" : 39738710,
      "original_commit_id" : "93f3de19530dd1179c5c612df4ec159f29514bc4",
      "original_position" : 13,
      "path" : "src/rpcnet.cpp",
      "position" : 13,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622",
      "updated_at" : "2015-09-18T14:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39738710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r39740313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39740313"
         }
      },
      "body" : "pushKV method already exists.\r\n\r\nAgreed it is out of scope for this PR, and a huge cleanup in terms of LOC to remove Pair() usage tree-wide.\r\n",
      "commit_id" : "30922c33bfc04ce12ebb5b53363a5321fe906a17",
      "created_at" : "2015-09-17T12:44:42Z",
      "diff_hunk" : "@@ -378,6 +378,15 @@ UniValue getnettotals(const UniValue& params, bool fHelp)\n     obj.push_back(Pair(\"totalbytesrecv\", CNode::GetTotalBytesRecv()));\n     obj.push_back(Pair(\"totalbytessent\", CNode::GetTotalBytesSent()));\n     obj.push_back(Pair(\"timemillis\", GetTimeMillis()));\n+\n+    UniValue outboundLimit(UniValue::VOBJ);\n+    outboundLimit.push_back(Pair(\"timeframe\", CNode::GetMaxOutboundTimeframe()));\n+    outboundLimit.push_back(Pair(\"target\", CNode::GetMaxOutboundTarget()));\n+    outboundLimit.push_back(Pair(\"target_reached\", CNode::OutboundTargetReached(false)));\n+    outboundLimit.push_back(Pair(\"serve_historical_blocks\", !CNode::OutboundTargetReached(true)));\n+    outboundLimit.push_back(Pair(\"bytes_left_in_cycle\", CNode::GetOutboundTargetBytesLeft()));\n+    outboundLimit.push_back(Pair(\"time_left_in_cycle\", CNode::GetMaxOutboundTimeLeftInCycle()));\n+    obj.push_back(Pair(\"uploadtarget\", outboundLimit));\n     return obj;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r39740313",
      "id" : 39740313,
      "original_commit_id" : "93f3de19530dd1179c5c612df4ec159f29514bc4",
      "original_position" : 13,
      "path" : "src/rpcnet.cpp",
      "position" : 13,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622",
      "updated_at" : "2015-09-18T14:06:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/39740313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Rebased.\r\nI have tried (serval hours) to write a rpc test that could test this feature; but didn't succeed. A solution would be to make the time-frame (currently static 24h) and move the static timeframe that determines if a block is historical (static 1 week) to chainparams. But somehow this looks after a bad solution.\r\nPlaying around with `setmocktime` also didn't help (seems not to affect the getBlockTime()).\r\n\r\nIf anyone has a approach how to test this automatically: speak up.",
      "created_at" : "2015-09-18T13:49:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141456496",
      "id" : 141456496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-18T13:49:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141456496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli I haven't reviewed this code carefully but from a quick glance, I think I can write up a test in the python p2p framework -- it looks to me like we can use setmocktime to trigger clearing the 24 hour measurement windows and we can send getdata messages over and over to test what happens when the limit is hit (and we can construct blocks with varying timestamps to exercise the 1 week limit).  I'll see if I can put something together and report back...",
      "created_at" : "2015-09-18T14:01:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141459145",
      "id" : 141459145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-18T14:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141459145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar: Great! Thanks for having a look at the tests.",
      "created_at" : "2015-09-18T15:02:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141477182",
      "id" : 141477182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-18T15:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141477182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli: i think i've got a working test -- https://github.com/sdaftuar/bitcoin/commit/67ffe80e373368242e3975046078cb9e8ac7b453\r\n",
      "created_at" : "2015-09-18T20:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141555012",
      "id" : 141555012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-18T20:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141555012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar Nice! Looks good. I did ran into some errors.\r\nWill extend the test and add some `getnettotals` calls (during the next week).",
      "created_at" : "2015-09-19T15:01:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141677904",
      "id" : 141677904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-19T15:01:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141677904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> If the target-in-bytes - (time-left-in-24-cycle) / 600 * MAX_BLOCK_SIZE is reached, stop serve blocks older than one week, stop serve filtered blocks (SPV) immediately.\r\n\r\nWhat?\r\n\r\nYou start out by saying nearly all bandwidth usage is serving historical blocks to full nodes. You then write code that limits SPV clients, which don't request full blocks. In fact the whole point of this mode is to NOT download full blocks.\r\n\r\nHow does this PR make any sense at all?",
      "created_at" : "2015-09-19T20:24:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141703121",
      "id" : 141703121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-19T20:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141703121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "I agree that limiting filtered blocks has not much of a importance to the upload bandwidth limiting. My thought where, if one sets a `-maxuploadtarget`, what commands can be dropped without harming the p2p network? Uploading historical blocks and disconnecting SPV nodes.\r\nIt could make sense to remove the part where maxuploadtarget also affects filtered blocks limiting.\r\n\r\nI hope i can generate some statistics that could show the bandwidth consumptions of SPV soon.",
      "created_at" : "2015-09-20T08:01:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141757005",
      "id" : 141757005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T08:01:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141757005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "When a node has exhausted its capacity it should stop doing anything to use more capacity beyond keeping itself minimally participating. I don't think there is anything unreasonable about that.\r\n\r\nI think a case could be made for _non-historic_ filtered results-- as at least no worse than serving to other peers, though really if a node is out of outbound capacity it probably shouldn't have any clients at all, and should instead be shunting them off onto hosts that do have capacity left.\r\n",
      "created_at" : "2015-09-20T08:15:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141757602",
      "id" : 141757602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T08:15:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141757602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Agree with @gmaxwell. I think we should reconsider that people shutting down nodes because nodes do create uncontrollable heigh amount of outbound traffic. If we could keep nodes alive  even if they don't server historical and filtered blocks for a limited timeframe  it's much better than seeing nodes get shut down because of missing traffic limiting options.\r\n\r\nNot saying that this is the ultimative solution. But i think it's effective and can be merge without taking high risks.",
      "created_at" : "2015-09-20T08:20:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141757973",
      "id" : 141757973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T08:20:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141757973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I'd think you want the opposite - if a node literally exhausted a transfer quota, it needs to stop serving any data at all, stop listening and start using SPV mode itself.\r\n\r\nAs is, you will continue to upload at least 288mb of data per day even if you stop serving historical blocks entirely.\r\n\r\nBut if quota caps are the issue (as opposed to steady state limiting) then you should just make the node shut itself down and stop serving RPCs if it runs out of bandwidth. Otherwise the cap doesn't mean much.... people will set it expecting it to work and then be surprised when Core continues using up their (now presumably very expensive) over-quota.",
      "created_at" : "2015-09-20T09:40:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141765564",
      "id" : 141765564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T09:40:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141765564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "Oh, and by the way, the idea that disconnecting SPV wallets doesn't harm the P2P network is a pretty dangerous one. Those clients make up the bulk of all connects and users. Protecting them is very important!",
      "created_at" : "2015-09-20T09:43:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141766424",
      "id" : 141766424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T09:43:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141766424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "It goes into limp mode early enough that it shouldn't need to shut down completely but will still usually avoid going over; this is obviously a very early first step and isn't perfect yet. But it is already very useful and can be incrementally improved.",
      "created_at" : "2015-09-20T09:46:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141767443",
      "id" : 141767443,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T09:47:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141767443",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "> [...] As is, you will continue to upload at least 288mb of data per day even if you stop serving historical blocks entirely.\r\n\r\nNot exactly. After each cycle of 24h your counter will be reset. The minimum buffer for serving blocks is 144 blocks * MAX_BLOCKSIZE. But if a node starts requesting blocks after 12h in you 24h cycle, only a min of 72MB are left. Also: not all blocks are full.\r\n\r\nAs said. It's an easy and effective solution that allows progressive improvements.\r\n\r\nWe should not mix SPV with BF. Only because most SPV clients are using a low BF FPR we see low traffic in SPV. Also SPV clients do not participate in the P2P network health.\r\n\r\nI agree that SPV clients are important!\r\nThat's why I'd like to see bandwidth limiting without throttling instead of operators shutting down valuable nodes.\r\n",
      "created_at" : "2015-09-20T15:44:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141797439",
      "id" : 141797439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-20T15:44:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141797439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "OK, so firstly, do we agree on this statement\r\n\r\n_This patch solves the problem of users with capped transfer quotas, probably measured in gigabytes per month. The other patch we're discussing on the XT repository solves the problem of inference with consumer services at home due to saturating the limited uplink bandwidth._\r\n\r\nBecause it seems to me that these are two independent problems that are both being called 'throttling', and the two approaches can actually be combined, or rather, would not interfere if both were implemented as-is.\r\n\r\nTor has a hibernate mode that this sounds very similar to. The way it works is essentially shutting down your node when you go over the transfer quota. Similarly, this patch is equivalent to shutting down part of the node when quota is exhausted, i.e. the part that provides useful services to other peers.\r\n\r\nIt might be worth separating the two terms. We could call this one hibernation, and the other patch throttling, as that'd align terminology with Tor and \"throttling\" in network engineering normally means restricting the instantaneous bandwidth usage rather than disconnecting after reaching a daily quota.",
      "created_at" : "2015-09-21T10:35:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141936613",
      "id" : 141936613,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-21T10:35:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141936613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "Real \"throttling\" (reducing the bandwidth to a static value) regardless of which node and which command/service being called, is bad and ineffective IMO.\r\nIf you are connected to a throttled tor node or a throttled node in a bittorent net, it will just result in a bad overall user experience.\r\n\r\nBitcoin p2p is different to tor and bittorrent. It does not serve or consume uncontrollable and ungroupable/hidden data-streams (tor), neither it serves high bandwidth data streams over a longer period of time (torrent).\r\n\r\nCareful and logically rejecting services if a certain level of consumption is reached, is a way better approach than just trottle the overall network activity of bitcoin.\r\nThe later can be done already with some network wrappers/tools and i strongly recommend against adding a overall \"dumb\" network bandwidth limiter to core (or XT).\r\n\r\nBecause SPV clients can produce uncontrollable amount of traffic (BF FPR) without any usage for the p2p network (they don't pass data to other nodes, they just consume), it makes sense to stop that service if network capacity gets critical.\r\n\r\nIMO: the \"throttling\"/\"capping\"/\"limiting\" topic is very important in terms of \"scaling bitcoin\" and it should get the required attention.",
      "created_at" : "2015-09-21T11:34:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141947660",
      "id" : 141947660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-21T11:34:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141947660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Hm, so we don't agree on that statement then?\r\n\r\nWhen a peer is uploading the block chain to freshly installed nodes/nodes that were offline for a long time, it does look quite a bit like BitTorrent ..... heavy upload traffic that goes as fast as possible for a long period of time. \r\n\r\nThe goal of the bandwidth throttler is *not* to have huge swings in available serving bandwidth, but rather to avoid delaying/blocking the TCP ACKs being used by other services like Netflix and causing user visible disruption. Ideally, a user would contribute most of their uplink if they aren't actually using it (which is most people most of the time), so the difference between unthrottled and throttled wouldn't actually be very large.\r\n\r\nAs streaming video can be disrupted by any kind of upload, the most important criteria is that the throttle actually works. How a peer schedules bandwidth users into that limited window is a different problem entirely.",
      "created_at" : "2015-09-21T11:44:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141949588",
      "id" : 141949588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-21T11:44:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141949588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "body" : "> When a peer is uploading the block chain to freshly installed nodes/nodes that were offline for a long time, it does look quite a bit like BitTorrent ..... heavy upload traffic that goes as fast as possible for a long period of time.\r\n\r\nAgreed. That IBD serving is similar to torrent. This is the reason why this PR addresses that part if the upload target has been reached.\r\n\r\nThe rest of your points are QoS topics. IMO this is a router job (or a lower level OS net stack thing). Reducing bandwidth by a throttling feature would reduce than bandwidth regardless of what else is going on on the system. It would also reduce bandwidth  which would be available  if the User is creating a backup or writing a letter in Word.",
      "created_at" : "2015-09-21T11:53:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141950865",
      "id" : 141950865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-21T11:53:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141950865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Well, the issue is people want to configure it at the app level as many consumer wifi routers don't offer the right features, or people don't know how to use them.",
      "created_at" : "2015-09-21T13:12:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#issuecomment-141969777",
      "id" : 141969777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6622",
      "updated_at" : "2015-09-21T13:12:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/141969777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/971089?v=3",
         "events_url" : "https://api.github.com/users/mikehearn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mikehearn/followers",
         "following_url" : "https://api.github.com/users/mikehearn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mikehearn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mikehearn",
         "id" : 971089,
         "login" : "mikehearn",
         "organizations_url" : "https://api.github.com/users/mikehearn/orgs",
         "received_events_url" : "https://api.github.com/users/mikehearn/received_events",
         "repos_url" : "https://api.github.com/users/mikehearn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mikehearn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mikehearn"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r42606302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/42606302"
         }
      },
      "body" : "Braces not required.",
      "commit_id" : "30922c33bfc04ce12ebb5b53363a5321fe906a17",
      "created_at" : "2015-10-21T10:19:34Z",
      "diff_hunk" : "@@ -2071,6 +2077,96 @@ void CNode::RecordBytesSent(uint64_t bytes)\n {\n     LOCK(cs_totalBytesSent);\n     nTotalBytesSent += bytes;\n+\n+    uint64_t now = GetTime();\n+    if (nMaxOutboundCycleStartTime + nMaxOutboundTimeframe < now)\n+    {\n+        // timeframe expired, reset cycle\n+        nMaxOutboundCycleStartTime = now;\n+        nMaxOutboundTotalBytesSentInCycle = 0;\n+    }\n+\n+    // TODO, exclude whitebind peers\n+    nMaxOutboundTotalBytesSentInCycle += bytes;\n+}\n+\n+void CNode::SetMaxOutboundTarget(uint64_t limit)\n+{\n+    LOCK(cs_totalBytesSent);\n+    uint64_t recommendedMinimum = (nMaxOutboundTimeframe / 600) * MAX_BLOCK_SIZE;\n+    nMaxOutboundLimit = limit;\n+\n+    if (limit < recommendedMinimum)\n+        LogPrintf(\"Max outbound target very small (%s) and are very unlikely to be reached, recommended minimum is %s\\n\", nMaxOutboundLimit, recommendedMinimum);\n+}\n+\n+uint64_t CNode::GetMaxOutboundTarget()\n+{\n+    LOCK(cs_totalBytesSent);\n+    return nMaxOutboundLimit;\n+}\n+\n+uint64_t CNode::GetMaxOutboundTimeframe()\n+{\n+    LOCK(cs_totalBytesSent);\n+    return nMaxOutboundTimeframe;\n+}\n+\n+uint64_t CNode::GetMaxOutboundTimeLeftInCycle()\n+{\n+    LOCK(cs_totalBytesSent);\n+    if (nMaxOutboundLimit == 0)\n+        return 0;\n+\n+    if (nMaxOutboundCycleStartTime == 0)\n+        return nMaxOutboundTimeframe;\n+\n+    uint64_t cycleEndTime = nMaxOutboundCycleStartTime + nMaxOutboundTimeframe;\n+    uint64_t now = GetTime();\n+    return (cycleEndTime < now) ? 0 : cycleEndTime - GetTime();\n+}\n+\n+void CNode::SetMaxOutboundTimeframe(uint64_t timeframe)\n+{\n+    LOCK(cs_totalBytesSent);\n+    if (nMaxOutboundTimeframe != timeframe)\n+    {\n+        // reset measure-cycle in case of changing\n+        // the timeframe\n+        nMaxOutboundCycleStartTime = GetTime();\n+    }\n+    nMaxOutboundTimeframe = timeframe;\n+}\n+\n+bool CNode::OutboundTargetReached(bool historicalBlockServingLimit)\n+{\n+    LOCK(cs_totalBytesSent);\n+    if (nMaxOutboundLimit == 0)\n+        return false;\n+\n+    if (historicalBlockServingLimit)\n+    {\n+        // keep a large enought buffer to at least relay each block once\n+        uint64_t timeLeftInCycle = GetMaxOutboundTimeLeftInCycle();\n+        uint64_t buffer = timeLeftInCycle / 600 * MAX_BLOCK_SIZE;\n+        if (buffer >= nMaxOutboundLimit || nMaxOutboundTotalBytesSentInCycle >= nMaxOutboundLimit - buffer)\n+        {\n+            return true;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6622#discussion_r42606302",
      "id" : 42606302,
      "original_commit_id" : "30922c33bfc04ce12ebb5b53363a5321fe906a17",
      "original_position" : 99,
      "path" : "src/net.cpp",
      "position" : 99,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6622",
      "updated_at" : "2015-10-21T10:19:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/42606302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   }
]
