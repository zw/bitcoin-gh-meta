[
   {
      "author_association" : "MEMBER",
      "body" : "I'm wondering whether the `accurate` mode should be enabled by default. If an application or a user uses the `scanblocks` RPC, they'll need to filter out false positives anyway, so maybe Bitcoin Core should do it?\r\n\r\nAlso, is there a way to reproduce false positives? It would be nice to add a test but I haven't figured out how?",
      "created_at" : "2022-10-17T14:57:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1281001827",
      "id" : 1281001827,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MWolj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281001827/reactions"
      },
      "updated_at" : "2022-10-18T14:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281001827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997670551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997670551"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't it be optional ?",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T02:56:40Z",
      "diff_hunk" : "@@ -2244,7 +2276,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"accurate\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Enable accurate mode (requires -txindex). Inaccurate mode may result in false positives but is faster.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997670551",
      "id" : 997670551,
      "line" : 2280,
      "node_id" : "PRRC_kwDOABII5847dz6X",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 2280,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 58,
      "pull_request_review_id" : 1145024484,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997670551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T02:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997670551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94266259?v=4",
         "events_url" : "https://api.github.com/users/w0xlt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/w0xlt/followers",
         "following_url" : "https://api.github.com/users/w0xlt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/w0xlt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/w0xlt",
         "id" : 94266259,
         "login" : "w0xlt",
         "node_id" : "U_kgDOBZ5jkw",
         "organizations_url" : "https://api.github.com/users/w0xlt/orgs",
         "received_events_url" : "https://api.github.com/users/w0xlt/received_events",
         "repos_url" : "https://api.github.com/users/w0xlt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/w0xlt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/w0xlt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/w0xlt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997855026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997855026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is optional.",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T07:58:06Z",
      "diff_hunk" : "@@ -2244,7 +2276,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"accurate\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Enable accurate mode (requires -txindex). Inaccurate mode may result in false positives but is faster.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r997855026",
      "id" : 997855026,
      "in_reply_to_id" : 997670551,
      "line" : 2280,
      "node_id" : "PRRC_kwDOABII5847eg8y",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 2280,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 58,
      "pull_request_review_id" : 1145280677,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997855026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T07:58:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997855026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998217009"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998217009"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can't you read the scriptpubkey from the undo data?",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T13:24:02Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998217009",
      "id" : 998217009,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII5847f5Ux",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 4,
      "pull_request_review_id" : 1145814329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998217009/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T13:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998217009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998268335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998268335"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't undo data only kept for recent blocks in the case of reorgs? Didn't check but I can hardly imagine that we store every scriptPubKey of a spent output twice forever.",
      "commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "created_at" : "2022-10-18T13:55:27Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998268335",
      "id" : 998268335,
      "in_reply_to_id" : 998217009,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII5847gF2v",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 4,
      "pull_request_review_id" : 1145875594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998268335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T13:55:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998268335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998281609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998281609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't know about undo data, I pushed a version using it instead of `txindex`. Can revert if undo data is not reliable :/\r\nEDIT: I looked it up and undo data doesn't seem to ever be pruned so I think this is safe?",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-18T14:05:31Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998281609",
      "id" : 998281609,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847gJGJ",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1145895523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998281609/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T14:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998281609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998310945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998310945"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems my suspicion was wrong and we indeed keep undo data forever on a non-pruned node. Sorry for confusing!",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-18T14:27:36Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998310945",
      "id" : 998310945,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847gQQh",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1145938952,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998310945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T14:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998310945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998385576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998385576"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: spacing\r\n```suggestion\r\n    if (!UndoReadFromDisk(block_undo, pindex)) {\r\n```",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-18T15:20:02Z",
      "diff_hunk" : "@@ -2234,6 +2235,39 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(const CBlockIndex* pindex, const GCSFilter::ElementSet& needles, const CChainParams& chainparams)\n+{\n+    CBlock block;\n+    if (!ReadBlockFromDisk(block, pindex, chainparams.GetConsensus())) {\n+        return false;\n+    }\n+\n+    CBlockUndo block_undo;\n+    if(!UndoReadFromDisk(block_undo, pindex)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r998385576",
      "id" : 998385576,
      "line" : 2246,
      "node_id" : "PRRC_kwDOABII5847gieo",
      "original_commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "original_line" : 2246,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 20,
      "pull_request_review_id" : 1146047002,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998385576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-18T15:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998385576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the tips @theStack.\r\nI tried creating a test as well. I managed to generate false positives using the following test, but it only happens once every few runs. I'll continue to work on it later, but here's my snippet in case you have ideas.\r\n\r\n\r\n<details>\r\n<summary>Test</summary>\r\n\r\n```diff\r\ndiff --git a/test/functional/rpc_scanblocks.py b/test/functional/rpc_scanblocks.py\r\nindex 0ba5f12bd..e7d26a5ef 100755\r\n--- a/test/functional/rpc_scanblocks.py\r\n+++ b/test/functional/rpc_scanblocks.py\r\n@@ -102,6 +102,42 @@ class ScanblocksTest(BitcoinTestFramework):\r\n         # test invalid command\r\n         assert_raises_rpc_error(-8, \"Invalid command\", node.scanblocks, \"foobar\")\r\n \r\n+        # generate block with a lot of random outputs\r\n+        print(\"Generate block with random transactions\")\r\n+        for i in range(500): # should be deterministic and give false positives\r\n+            _, spk, _ = getnewdestination()\r\n+            wallet.send_to(from_node=self.nodes[1], scriptPubKey=spk, amount=400)\r\n+\r\n+        blockhash = self.generate(self.nodes[1], 1)[0]\r\n+        print(blockhash)\r\n+\r\n+        # scan the block with the ranged descriptor\r\n+        height = node.getblockheader(blockhash)['height']\r\n+        desc = f\"pkh({parent_key}/*)\"\r\n+\r\n+        # begin debug\r\n+        blocks = node.scanblocks(\r\n+            action=\"start\",\r\n+            scanobjects=[{\"desc\": desc, \"range\": [0, 200000]}],\r\n+            start_height=height,\r\n+            accurate=False)['relevant_blocks']\r\n+\r\n+        print(blocks)\r\n+        # end debug\r\n+\r\n+        for v in [False, True]:\r\n+            blocks = node.scanblocks(\r\n+                action=\"start\",\r\n+                scanobjects=[{\"desc\": desc, \"range\": [0, 200000]}],\r\n+                start_height=height,\r\n+                accurate=v)['relevant_blocks']\r\n+\r\n+            if v:\r\n+                assert_equal(len(blocks), 0)\r\n+            else:\r\n+                assert_equal(len(blocks), 1)\r\n+                assert_equal(blocks[0], blockhash)\r\n+\r\n \r\n if __name__ == '__main__':\r\n     ScanblocksTest().main()\r\n```\r\n\r\n</details>\r\n\r\nThe only part that isn't deterministic is:\r\n```python\r\nfor i in range(500): # should be deterministic and give false positives\r\n\t_, spk, _ = getnewdestination()\r\n\twallet.send_to(from_node=self.nodes[1], scriptPubKey=spk, amount=400)\r\n```\r\n\r\nMaybe we could use `i` to generate deterministic scriptPubKeys and hope a certain arrangement always gives false positives? Not sure how reliable this is.",
      "created_at" : "2022-10-18T16:54:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1282704275",
      "id" : 1282704275,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MdIOT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282704275/reactions"
      },
      "updated_at" : "2022-10-18T16:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1282704275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm able to generate false positives consistently enough with this test by increasing `nblocks` but the test is very slow and still likely to cause intermittent failures so not worth adding it to the PR.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```diff\r\ndiff --git a/test/functional/rpc_scanblocks.py b/test/functional/rpc_scanblocks.py\r\nindex 0ba5f12bd..05779973e 100755\r\n--- a/test/functional/rpc_scanblocks.py\r\n+++ b/test/functional/rpc_scanblocks.py\r\n@@ -102,6 +102,34 @@ class ScanblocksTest(BitcoinTestFramework):\r\n         # test invalid command\r\n         assert_raises_rpc_error(-8, \"Invalid command\", node.scanblocks, \"foobar\")\r\n \r\n+        # generate block with a lot of random outputs\r\n+        print(\"Generate block with random transactions\")\r\n+        height = node.getblockcount() + 1\r\n+        nblocks = 10\r\n+        for i in range(nblocks):\r\n+            for _ in range(550):\r\n+                _, spk, _ = getnewdestination()\r\n+                wallet.send_to(from_node=self.nodes[1], scriptPubKey=spk, amount=400)\r\n+\r\n+            print(f\"Generate block {i}/{nblocks}\")\r\n+            self.generate(self.nodes[1], 1)[0]\r\n+\r\n+        # scan the block with the ranged descriptor\r\n+        desc = f\"pkh({parent_key}/*)\"\r\n+        print(desc)\r\n+\r\n+        for v in [False, True]:\r\n+            blocks = node.scanblocks(\r\n+                action=\"start\",\r\n+                scanobjects=[{\"desc\": desc, \"range\": [0, 200000]}],\r\n+                start_height=height,\r\n+                accurate=v)['relevant_blocks']\r\n+\r\n+            if v:\r\n+                assert_equal(len(blocks), 0)\r\n+            else:\r\n+                assert len(blocks) > 1\r\n+\r\n \r\n if __name__ == '__main__':\r\n     ScanblocksTest().main()\r\n```\r\n\r\n</details>\r\n\r\n",
      "created_at" : "2022-10-19T11:24:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1283853813",
      "id" : 1283853813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585Mhg31",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283853813/reactions"
      },
      "updated_at" : "2022-10-19T11:24:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283853813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure `accurate` is very descriptive about what this feature does. Would `filter_false_positives` be a better name for this option?\r\n\r\n> I'm wondering whether the accurate mode should be enabled by default. If an application or a user uses the scanblocks RPC, they'll need to filter out false positives anyway, so maybe Bitcoin Core should do it?\r\n\r\nWith this feature enabled Bitcoin Core will be reading from disk and scanning both the block and undo files for each block, which would then be read again when fetched and then scanned by the user. I don't think it would be worth this extra effort unless the user's network latency or scanning code is very slow so that a single false positive block getting to them would be slower than having Bitcoin Core do it for every block. So IMO it should be disabled by default.",
      "created_at" : "2022-10-19T18:05:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1284387657",
      "id" : 1284387657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MjjNJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1284387657/reactions"
      },
      "updated_at" : "2022-10-19T18:05:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1284387657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r999834920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999834920"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Here and below when reading the undo data, if the read fails then this returns false and the block is recorded as a false positive and won't be returned by `scanblocks`. These should instead throw a `JSONRPCError` because the results will not be correct.",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-19T19:00:11Z",
      "diff_hunk" : "@@ -2234,6 +2235,39 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(const CBlockIndex* pindex, const GCSFilter::ElementSet& needles, const CChainParams& chainparams)\n+{\n+    CBlock block;\n+    if (!ReadBlockFromDisk(block, pindex, chainparams.GetConsensus())) {\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r999834920",
      "id" : 999834920,
      "line" : 2242,
      "node_id" : "PRRC_kwDOABII5847mEUo",
      "original_commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "original_line" : 2242,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 16,
      "pull_request_review_id" : 1148128501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999834920/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T19:00:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999834920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe `scanblocks` is compatible with a pruned node as long as the block filters were generated before the blocks were pruned (https://github.com/bitcoin/bitcoin/pull/15946). If so, then this mode will fail silently for the pruned blocks and just not return the hashes, even if the blocks can be retrieved by another node. But also more generally if a block read fails for any reason it should throw and not return false.\r\n\r\nAlso see https://github.com/bitcoin/bitcoin/pull/26316.",
      "created_at" : "2022-10-19T19:03:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1284449110",
      "id" : 1284449110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MjyNW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1284449110/reactions"
      },
      "updated_at" : "2022-10-19T19:23:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1284449110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'm able to generate false positives consistently enough with this test by increasing `nblocks` but the test is very slow and still likely to cause intermittent failures so not worth adding it to the PR.\r\n\r\nI digged a bit deeper into the rabbit-hole and ended up opening #26341, adding a testing for a fixed false-positive for the genesis block and also verifying it with the ranged hashes described in BIP158. Feel free to base you PR on that (though I think the PR is already in a pretty good state and it's also fine if the test is add in a follow-up). With the newly introduced helpers, it would be possible to calculate false-positives for newly created blocks at runtime, but at least in my impression that takes too much time for a functional test -- about ~800k scriptPubKeys have to be tried out on average until one of them corresponds to a scriptPubKey already on the block.",
      "created_at" : "2022-10-19T19:53:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1284501056",
      "id" : 1284501056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585Mj-5A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1284501056/reactions"
      },
      "updated_at" : "2022-10-19T19:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1284501056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r999878589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999878589"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> EDIT: I looked it up and undo data doesn't seem to ever be pruned so I think this is safe?\r\n\r\nIt does indeed get pruned at the same time as block files https://github.com/bitcoin/bitcoin/blob/master/src/node/blockstorage.cpp#L557-L565.",
      "commit_id" : "f2174f7c59c48665201f27f2753223c9f720cdd6",
      "created_at" : "2022-10-19T19:54:57Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r999878589",
      "id" : 999878589,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847mO-9",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1148192639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999878589/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-19T19:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999878589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you @andrewtoth for the review.\r\n- Rebased this PR on top of #26341 as suggested by @theStack.\r\n- Added a test case to filter false positives\r\n- Added a check to not fetch block undo data for the genesis block\r\n- Throw if `ReadBlockFromDisk` or `UndoReadFromDisk` fails instead of returning `false`\r\n- Renamed `accurate` mode to `filter_false_positives`",
      "created_at" : "2022-10-20T10:25:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1285296232",
      "id" : 1285296232,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585MnBBo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1285296232/reactions"
      },
      "updated_at" : "2022-10-20T10:28:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1285296232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1002599423"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002599423"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would be nice to use the helper functions `GetBlockChecked` and `GetUndoChecked` here to have consistent error messages and RPC return codes and avoid repetition. The only drawback right now is that `GetUndoChecked` doesn't include the exception for the genesis blocks yet, so the test would fail. Fixed by #19888 or #26369.",
      "commit_id" : "33793d67bff6519b6ebdd0b1229d03166c505672",
      "created_at" : "2022-10-22T23:33:36Z",
      "diff_hunk" : "@@ -2234,6 +2235,40 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(const CBlockIndex* pindex, const GCSFilter::ElementSet& needles, const CChainParams& chainparams)\n+{\n+    CBlock block;\n+    if (!ReadBlockFromDisk(block, pindex, chainparams.GetConsensus())) {\n+        throw JSONRPCError(RPC_DATABASE_ERROR, \"Cannot read block from disk\");\n+    }\n+\n+    CBlockUndo block_undo;\n+    // Genesis block has no undo data\n+    if (pindex->nHeight > 0 && !UndoReadFromDisk(block_undo, pindex)) {\n+        throw JSONRPCError(RPC_DATABASE_ERROR, \"Cannot read block undo data from disk\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1002599423",
      "id" : 1002599423,
      "line" : 2249,
      "node_id" : "PRRC_kwDOABII5847wnP_",
      "original_commit_id" : "33793d67bff6519b6ebdd0b1229d03166c505672",
      "original_line" : 2249,
      "original_position" : 23,
      "original_start_line" : 2240,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 23,
      "pull_request_review_id" : 1152170776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002599423/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2240,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-22T23:34:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002599423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003105666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003105666"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pushed suggestion https://github.com/bitcoin/bitcoin/compare/33793d67bff6519b6ebdd0b1229d03166c505672..f0b27d2d8bd76e329ef3b90473b14fe57e079c4e",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-24T09:41:56Z",
      "diff_hunk" : "@@ -2234,6 +2235,40 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(const CBlockIndex* pindex, const GCSFilter::ElementSet& needles, const CChainParams& chainparams)\n+{\n+    CBlock block;\n+    if (!ReadBlockFromDisk(block, pindex, chainparams.GetConsensus())) {\n+        throw JSONRPCError(RPC_DATABASE_ERROR, \"Cannot read block from disk\");\n+    }\n+\n+    CBlockUndo block_undo;\n+    // Genesis block has no undo data\n+    if (pindex->nHeight > 0 && !UndoReadFromDisk(block_undo, pindex)) {\n+        throw JSONRPCError(RPC_DATABASE_ERROR, \"Cannot read block undo data from disk\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003105666",
      "id" : 1003105666,
      "in_reply_to_id" : 1002599423,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847yi2C",
      "original_commit_id" : "33793d67bff6519b6ebdd0b1229d03166c505672",
      "original_line" : 2250,
      "original_position" : 23,
      "original_start_line" : 2240,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1152848716,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003105666/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-24T11:56:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003105666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003237867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003237867"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "These comment lines from the previous commit can be removed now.",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-24T12:09:31Z",
      "diff_hunk" : "@@ -94,6 +98,13 @@ def run_test(self):\n         assert(genesis_blockhash in node.scanblocks(\n             \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n \n+        # check that the filter_false_positives option works\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({genesis_coinbase_spk.hex()})\"}], 0, 0, \"basic\", True)['relevant_blocks'])\n+        assert(genesis_blockhash not in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0, \"basic\", True)['relevant_blocks'])\n+\n+\n         # TODO: after an \"accurate\" mode for scanblocks is implemented (e.g. PR #26325)\n         # check here that it filters out the false-positive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003237867",
      "id" : 1003237867,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847zDHr",
      "original_commit_id" : "f0b27d2d8bd76e329ef3b90473b14fe57e079c4e",
      "original_line" : 109,
      "original_position" : 27,
      "original_start_line" : 108,
      "path" : "test/functional/rpc_scanblocks.py",
      "position" : null,
      "pull_request_review_id" : 1153032231,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003237867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-24T12:10:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003237867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003304531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003304531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed thanks",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-24T13:19:33Z",
      "diff_hunk" : "@@ -94,6 +98,13 @@ def run_test(self):\n         assert(genesis_blockhash in node.scanblocks(\n             \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n \n+        # check that the filter_false_positives option works\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({genesis_coinbase_spk.hex()})\"}], 0, 0, \"basic\", True)['relevant_blocks'])\n+        assert(genesis_blockhash not in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0, \"basic\", True)['relevant_blocks'])\n+\n+\n         # TODO: after an \"accurate\" mode for scanblocks is implemented (e.g. PR #26325)\n         # check here that it filters out the false-positive",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003304531",
      "id" : 1003304531,
      "in_reply_to_id" : 1003237867,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5847zTZT",
      "original_commit_id" : "f0b27d2d8bd76e329ef3b90473b14fe57e079c4e",
      "original_line" : 109,
      "original_position" : 27,
      "original_start_line" : 108,
      "path" : "test/functional/rpc_scanblocks.py",
      "position" : null,
      "pull_request_review_id" : 1153127636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003304531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-24T13:19:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003304531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003328631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003328631"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should we document that this RPC requires `blockfilterindex=1` and that it is scanning using the block filters? It doesn't seem like this is noted in the help text above. Then we can say here that block filter scanning has a rate of false positives of 1/M, and that using this option will require Bitcoin Core to read all the blocks from disk and scan them, so it will be more expensive setting this option. Also that this option can fail on a pruned node.",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-24T13:40:54Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003328631",
      "id" : 1003328631,
      "line" : 2284,
      "node_id" : "PRRC_kwDOABII5847zZR3",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 56,
      "pull_request_review_id" : 1153162868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003328631/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T13:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003328631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003349743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003349743"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that the `scanblocks` RPC documentation right now should be improved, at least the need for blockfilters to use it should be mentioned to avoid confusion. Probably that's a good candidate for an own PR with a focus solely on polishing documentation? (I see there is also no release note yet, this one could also be included there). Happy to review those changes either here in this PR or in a follow-up.",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-24T13:58:40Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1003349743",
      "id" : 1003349743,
      "in_reply_to_id" : 1003328631,
      "line" : 2284,
      "node_id" : "PRRC_kwDOABII5847zebv",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 56,
      "pull_request_review_id" : 1153192963,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003349743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-24T13:58:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003349743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004566658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should we also include a test that breaks if the block containing the false positive gets pruned? Could be done in a follow-up.",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-25T14:29:32Z",
      "diff_hunk" : "@@ -71,6 +79,31 @@ def run_test(self):\n         assert(blockhash in node.scanblocks(\n             \"start\", [{\"desc\": f\"pkh({parent_key}/*)\", \"range\": [0, 100]}], height)['relevant_blocks'])\n \n+        # check that false-positives are included in the result now; note that\n+        # finding a false-positive at runtime would take too long, hence we simply\n+        # use a pre-calculated one that collides with the regtest genesis block's\n+        # coinbase output and verify that their BIP158 ranged hashes match\n+        genesis_blockhash = node.getblockhash(0)\n+        genesis_spks = bip158_relevant_scriptpubkeys(node, genesis_blockhash)\n+        assert_equal(len(genesis_spks), 1)\n+        genesis_coinbase_spk = list(genesis_spks)[0]\n+        false_positive_spk = bytes.fromhex(\"001400000000000000000000000000000000000cadcb\")\n+\n+        genesis_coinbase_hash = bip158_basic_element_hash(genesis_coinbase_spk, 1, genesis_blockhash)\n+        false_positive_hash = bip158_basic_element_hash(false_positive_spk, 1, genesis_blockhash)\n+        assert_equal(genesis_coinbase_hash, false_positive_hash)\n+\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({genesis_coinbase_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+\n+        # check that the filter_false_positives option works",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004566658",
      "id" : 1004566658,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII58474HiC",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 101,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/rpc_scanblocks.py",
      "position" : 49,
      "pull_request_review_id" : 1154928299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T14:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004652878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004652878"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Shouldn't be a positional argument",
      "commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "created_at" : "2022-10-25T15:37:44Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004652878",
      "id" : 1004652878,
      "line" : 2284,
      "node_id" : "PRRC_kwDOABII58474clO",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 56,
      "pull_request_review_id" : 1155053615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004652878/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T15:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004652878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004714813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004714813"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pushed, see diff https://github.com/bitcoin/bitcoin/compare/5fb8f8dc49d00b9e2eb0d6a968783a61449ac683..134caa7c25fee8ed16d0c390cf729f3033d06dc4.",
      "commit_id" : "134caa7c25fee8ed16d0c390cf729f3033d06dc4",
      "created_at" : "2022-10-25T16:35:52Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004714813",
      "id" : 1004714813,
      "in_reply_to_id" : 1003328631,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58474rs9",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1155142457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004714813/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T16:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004714813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004715774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004715774"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Considering that false positives can only be tested in the genesis block right now and that the genesis block cannot be pruned, I'm not sure how to test this. I will leave this test as a follow-up for a brave soul.",
      "commit_id" : "134caa7c25fee8ed16d0c390cf729f3033d06dc4",
      "created_at" : "2022-10-25T16:36:52Z",
      "diff_hunk" : "@@ -71,6 +79,31 @@ def run_test(self):\n         assert(blockhash in node.scanblocks(\n             \"start\", [{\"desc\": f\"pkh({parent_key}/*)\", \"range\": [0, 100]}], height)['relevant_blocks'])\n \n+        # check that false-positives are included in the result now; note that\n+        # finding a false-positive at runtime would take too long, hence we simply\n+        # use a pre-calculated one that collides with the regtest genesis block's\n+        # coinbase output and verify that their BIP158 ranged hashes match\n+        genesis_blockhash = node.getblockhash(0)\n+        genesis_spks = bip158_relevant_scriptpubkeys(node, genesis_blockhash)\n+        assert_equal(len(genesis_spks), 1)\n+        genesis_coinbase_spk = list(genesis_spks)[0]\n+        false_positive_spk = bytes.fromhex(\"001400000000000000000000000000000000000cadcb\")\n+\n+        genesis_coinbase_hash = bip158_basic_element_hash(genesis_coinbase_spk, 1, genesis_blockhash)\n+        false_positive_hash = bip158_basic_element_hash(false_positive_spk, 1, genesis_blockhash)\n+        assert_equal(genesis_coinbase_hash, false_positive_hash)\n+\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({genesis_coinbase_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+\n+        # check that the filter_false_positives option works",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004715774",
      "id" : 1004715774,
      "in_reply_to_id" : 1004566658,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII58474r7-",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 101,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/rpc_scanblocks.py",
      "position" : 49,
      "pull_request_review_id" : 1155143783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004715774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T16:40:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004715774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004716376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004716376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've made the argument `RPCArg::Optional::OMITTED_NAMED_ARG`, is this what you asked? I'm not familiar with RPC args.",
      "commit_id" : "134caa7c25fee8ed16d0c390cf729f3033d06dc4",
      "created_at" : "2022-10-25T16:37:28Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1004716376",
      "id" : 1004716376,
      "in_reply_to_id" : 1004652878,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58474sFY",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1155144631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004716376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T16:37:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004716376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1005489017"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005489017"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> It does indeed get pruned at the same time as block files [master/src/node/blockstorage.cpp#L557-L565](https://github.com/bitcoin/bitcoin/blob/master/src/node/blockstorage.cpp?rgh-link-date=2022-10-19T19%3A54%3A57Z#L557-L565).\r\n\r\nI meant that they are not pruned on non-pruned nodes but you are correct. I've added a check that throws if both pruning and filter_false_positives modes are enabled.",
      "commit_id" : "53046167c1d1803f791fc8004fad20ce32518476",
      "created_at" : "2022-10-26T10:14:06Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1005489017",
      "id" : 1005489017,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58477ot5",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1156237641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005489017/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T10:14:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005489017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "- Added release notes\r\n- Improved RPC documentation\r\n- Made RPC arg `filter_false_positives` \"OMITTED_NAMED_ARG\"\r\n- ~~Added a check that throws `Filtering false positives is not supported when running with pruning enabled` when pruning and `filter_false_positives` modes are enabled because undo data may be pruned.~~",
      "created_at" : "2022-10-26T10:16:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1291811713",
      "id" : 1291811713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585M_3uB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291811713/reactions"
      },
      "updated_at" : "2022-10-26T13:18:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291811713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1005588645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005588645"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "But you already added the `GetBlockChecked` and `GetUndoChecked` functions which check and throw if pruned. I don't think it's necessary to disable completely if pruned, since the blocks that are found might not have been pruned yet.",
      "commit_id" : "134caa7c25fee8ed16d0c390cf729f3033d06dc4",
      "created_at" : "2022-10-26T12:03:34Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1005588645",
      "id" : 1005588645,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58478BCl",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1156376857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005588645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T12:03:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005588645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1005668056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005668056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Alright, reverted to 134caa7c25fee8ed16d0c390cf729f3033d06dc4.",
      "commit_id" : "134caa7c25fee8ed16d0c390cf729f3033d06dc4",
      "created_at" : "2022-10-26T13:19:16Z",
      "diff_hunk" : "@@ -19,12 +19,14 @@\n #include <hash.h>\n #include <index/blockfilterindex.h>\n #include <index/coinstatsindex.h>\n+#include <index/txindex.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1005668056",
      "id" : 1005668056,
      "in_reply_to_id" : 998217009,
      "line" : null,
      "node_id" : "PRRC_kwDOABII58478UbY",
      "original_commit_id" : "ca139abad173b9142189f52e3dd1178684f81c0c",
      "original_line" : 22,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1156493986,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005668056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T13:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005668056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased for #26341. CI error unrelated.",
      "created_at" : "2022-10-26T16:19:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1292292681",
      "id" : 1292292681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585NBtJJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292292681/reactions"
      },
      "updated_at" : "2022-10-26T19:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292292681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/26325#pullrequestreview-1212257820), [theStack](https://github.com/bitcoin/bitcoin/pull/26325#pullrequestreview-1212633554) |\n\nIf your review is incorrectly listed, please react with  to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26700](https://github.com/bitcoin/bitcoin/pull/26700) (test: Wallet interactions with rescanning wallet by aureleoules)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-10-26T23:40:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1292778657",
      "id" : 1292778657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585NDjyh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292778657/reactions"
      },
      "updated_at" : "2022-12-15T09:00:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292778657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1009751939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009751939"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could hand-craft the first block on the python test suite side.",
      "commit_id" : "fd0ed48ecd9f0d65acc3199a50b3ca6479aa5a3e",
      "created_at" : "2022-10-31T18:48:00Z",
      "diff_hunk" : "@@ -71,6 +79,31 @@ def run_test(self):\n         assert(blockhash in node.scanblocks(\n             \"start\", [{\"desc\": f\"pkh({parent_key}/*)\", \"range\": [0, 100]}], height)['relevant_blocks'])\n \n+        # check that false-positives are included in the result now; note that\n+        # finding a false-positive at runtime would take too long, hence we simply\n+        # use a pre-calculated one that collides with the regtest genesis block's\n+        # coinbase output and verify that their BIP158 ranged hashes match\n+        genesis_blockhash = node.getblockhash(0)\n+        genesis_spks = bip158_relevant_scriptpubkeys(node, genesis_blockhash)\n+        assert_equal(len(genesis_spks), 1)\n+        genesis_coinbase_spk = list(genesis_spks)[0]\n+        false_positive_spk = bytes.fromhex(\"001400000000000000000000000000000000000cadcb\")\n+\n+        genesis_coinbase_hash = bip158_basic_element_hash(genesis_coinbase_spk, 1, genesis_blockhash)\n+        false_positive_hash = bip158_basic_element_hash(false_positive_spk, 1, genesis_blockhash)\n+        assert_equal(genesis_coinbase_hash, false_positive_hash)\n+\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({genesis_coinbase_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+\n+        # check that the filter_false_positives option works",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1009751939",
      "id" : 1009751939,
      "in_reply_to_id" : 1004566658,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII5848L5eD",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 101,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/rpc_scanblocks.py",
      "position" : 21,
      "pull_request_review_id" : 1162378538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009751939/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T18:49:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009751939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've added a test case in `feature_pruning.py` that checks the `filter_false_positives` mode fails on pruned nodes when the relevant block is pruned, as suggested by @andrewtoth. https://github.com/bitcoin/bitcoin/compare/fd0ed48ecd9f0d65acc3199a50b3ca6479aa5a3e..c39234b070a0d2102af835fda77f3a78d4a631d7",
      "created_at" : "2022-11-01T14:04:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1298559803",
      "id" : 1298559803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585NZnM7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298559803/reactions"
      },
      "updated_at" : "2022-11-01T15:46:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1298559803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1010467666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010467666"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My assumptions were wrong, I thought the genesis block could not get pruned. Added a test case for this https://github.com/bitcoin/bitcoin/compare/fd0ed48ecd9f0d65acc3199a50b3ca6479aa5a3e..c39234b070a0d2102af835fda77f3a78d4a631d7",
      "commit_id" : "c39234b070a0d2102af835fda77f3a78d4a631d7",
      "created_at" : "2022-11-01T14:04:40Z",
      "diff_hunk" : "@@ -71,6 +79,31 @@ def run_test(self):\n         assert(blockhash in node.scanblocks(\n             \"start\", [{\"desc\": f\"pkh({parent_key}/*)\", \"range\": [0, 100]}], height)['relevant_blocks'])\n \n+        # check that false-positives are included in the result now; note that\n+        # finding a false-positive at runtime would take too long, hence we simply\n+        # use a pre-calculated one that collides with the regtest genesis block's\n+        # coinbase output and verify that their BIP158 ranged hashes match\n+        genesis_blockhash = node.getblockhash(0)\n+        genesis_spks = bip158_relevant_scriptpubkeys(node, genesis_blockhash)\n+        assert_equal(len(genesis_spks), 1)\n+        genesis_coinbase_spk = list(genesis_spks)[0]\n+        false_positive_spk = bytes.fromhex(\"001400000000000000000000000000000000000cadcb\")\n+\n+        genesis_coinbase_hash = bip158_basic_element_hash(genesis_coinbase_spk, 1, genesis_blockhash)\n+        false_positive_hash = bip158_basic_element_hash(false_positive_spk, 1, genesis_blockhash)\n+        assert_equal(genesis_coinbase_hash, false_positive_hash)\n+\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({genesis_coinbase_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+        assert(genesis_blockhash in node.scanblocks(\n+            \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0)['relevant_blocks'])\n+\n+        # check that the filter_false_positives option works",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1010467666",
      "id" : 1010467666,
      "in_reply_to_id" : 1004566658,
      "line" : 101,
      "node_id" : "PRRC_kwDOABII5848OoNS",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 101,
      "original_position" : 49,
      "original_start_line" : null,
      "path" : "test/functional/rpc_scanblocks.py",
      "position" : 21,
      "pull_request_review_id" : 1163394045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010467666/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T14:04:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010467666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1013471924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013471924"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No. Listing it in order here makes it a positional argument. Look at RPCs with an \"options\" argument to see how it should be done.",
      "commit_id" : "c39234b070a0d2102af835fda77f3a78d4a631d7",
      "created_at" : "2022-11-03T23:00:42Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1013471924",
      "id" : 1013471924,
      "in_reply_to_id" : 1004652878,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848aFq0",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1167762428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013471924/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T23:00:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013471924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1013860693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013860693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah thanks, I pushed it\r\nhttps://github.com/bitcoin/bitcoin/compare/c39234b070a0d2102af835fda77f3a78d4a631d7..e94d80dd45c0610c3c40b8a6589c5f7f1d329117",
      "commit_id" : "656a62b04a9c44fb615b250cdb164454a260b02f",
      "created_at" : "2022-11-04T10:40:36Z",
      "diff_hunk" : "@@ -2244,7 +2280,8 @@ static RPCHelpMan scanblocks()\n             scan_objects_arg_desc,\n             RPCArg{\"start_height\", RPCArg::Type::NUM, RPCArg::Default{0}, \"Height to start to scan from\"},\n             RPCArg{\"stop_height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"chain tip\"}, \"Height to stop to scan\"},\n-            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"}\n+            RPCArg{\"filtertype\", RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, \"The type name of the filter\"},\n+            RPCArg{\"filter_false_positives\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Filter false positives. Otherwise they may occur at a rate of 1/M\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1013860693",
      "id" : 1013860693,
      "in_reply_to_id" : 1004652878,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848bklV",
      "original_commit_id" : "5fb8f8dc49d00b9e2eb0d6a968783a61449ac683",
      "original_line" : 2284,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1168295061,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013860693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-04T10:40:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013860693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "- Moved `filter_false_positives` RPC arg inside `options` to make it optional as suggested by @luke-jr: [diff](https://github.com/bitcoin/bitcoin/compare/c39234b070a0d2102af835fda77f3a78d4a631d7..e94d80dd45c0610c3c40b8a6589c5f7f1d329117)\r\n- Rebased to fix CI error",
      "created_at" : "2022-11-04T10:42:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1303244454",
      "id" : 1303244454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585Nre6m",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303244454/reactions"
      },
      "updated_at" : "2022-11-04T10:42:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303244454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041058448"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041058448"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "After rebasing on master, excluding the genesis block is not needed anymore, as `GetUndoChecked` takes care of this now and simply returns an empty `CBlockUndo` instance (since #19888, commit 2ca5a496c2f3cbcc63ea15fa05c1658e7f527bbc has been merged):\r\n```suggestion\r\n        block_undo = GetUndoChecked(blockman, pindex);\r\n```",
      "commit_id" : "656a62b04a9c44fb615b250cdb164454a260b02f",
      "created_at" : "2022-12-06T14:37:05Z",
      "diff_hunk" : "@@ -2240,17 +2241,57 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    CBlock block;\n+    CBlockUndo block_undo;\n+\n+    {\n+        LOCK(cs_main);\n+        block = GetBlockChecked(blockman, pindex);\n+        if (pindex->nHeight > 0) {\n+            block_undo = GetUndoChecked(blockman, pindex);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041058448",
      "id" : 1041058448,
      "line" : 2255,
      "node_id" : "PRRC_kwDOABII584-DUqQ",
      "original_commit_id" : "d20b0196989af5466110e160b39893061d00afd3",
      "original_line" : 2255,
      "original_position" : 23,
      "original_start_line" : 2253,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 23,
      "pull_request_review_id" : 1206717662,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041058448/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2253,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-06T14:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041058448",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041098997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041098997"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done. Dropped fd0ed48ecd9f0d65acc3199a50b3ca6479aa5a3e and added your suggestion.",
      "commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "created_at" : "2022-12-06T15:09:48Z",
      "diff_hunk" : "@@ -2240,17 +2241,57 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    CBlock block;\n+    CBlockUndo block_undo;\n+\n+    {\n+        LOCK(cs_main);\n+        block = GetBlockChecked(blockman, pindex);\n+        if (pindex->nHeight > 0) {\n+            block_undo = GetUndoChecked(blockman, pindex);\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041098997",
      "id" : 1041098997,
      "in_reply_to_id" : 1041058448,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-Dej1",
      "original_commit_id" : "d20b0196989af5466110e160b39893061d00afd3",
      "original_line" : 2255,
      "original_position" : 23,
      "original_start_line" : 2253,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1206777824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041098997/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-06T15:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041098997",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041182276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041182276"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason for this lock, given that there are other places without the lock?",
      "commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "created_at" : "2022-12-06T16:19:01Z",
      "diff_hunk" : "@@ -2265,17 +2266,55 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    CBlock block;\n+    CBlockUndo block_undo;\n+\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041182276",
      "id" : 1041182276,
      "line" : 2276,
      "node_id" : "PRRC_kwDOABII584-Dy5E",
      "original_commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "original_line" : 2276,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 19,
      "pull_request_review_id" : 1206902663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041182276/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T16:19:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041182276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041187372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041187372"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`GetBlockChecked` and `GetUndoChecked` both require a lock. https://github.com/bitcoin/bitcoin/pull/26308 removes the lock requirement for these functions. Calling `ReadBlockFromDisk` or `UndoReadFromDisk` directly doesn't require the lock.",
      "commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "created_at" : "2022-12-06T16:23:21Z",
      "diff_hunk" : "@@ -2265,17 +2266,55 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    CBlock block;\n+    CBlockUndo block_undo;\n+\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041187372",
      "id" : 1041187372,
      "in_reply_to_id" : 1041182276,
      "line" : 2276,
      "node_id" : "PRRC_kwDOABII584-D0Is",
      "original_commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "original_line" : 2276,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 19,
      "pull_request_review_id" : 1206910072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041187372/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T16:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041187372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/237213?v=4",
         "events_url" : "https://api.github.com/users/andrewtoth/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrewtoth/followers",
         "following_url" : "https://api.github.com/users/andrewtoth/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrewtoth/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrewtoth",
         "id" : 237213,
         "login" : "andrewtoth",
         "node_id" : "MDQ6VXNlcjIzNzIxMw==",
         "organizations_url" : "https://api.github.com/users/andrewtoth/orgs",
         "received_events_url" : "https://api.github.com/users/andrewtoth/received_events",
         "repos_url" : "https://api.github.com/users/andrewtoth/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrewtoth/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrewtoth/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrewtoth"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041191174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041191174"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ugh, thanks. Didn't fully grasp the function name",
      "commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "created_at" : "2022-12-06T16:26:37Z",
      "diff_hunk" : "@@ -2265,17 +2266,55 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    CBlock block;\n+    CBlockUndo block_undo;\n+\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1041191174",
      "id" : 1041191174,
      "in_reply_to_id" : 1041182276,
      "line" : 2276,
      "node_id" : "PRRC_kwDOABII584-D1EG",
      "original_commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "original_line" : 2276,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 19,
      "pull_request_review_id" : 1206915763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041191174/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-06T16:26:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1041191174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1043148360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043148360"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/26308 is merged",
      "commit_id" : "1a0a2ede28a3fd348f6b6da196cc5526d01e5cc0",
      "created_at" : "2022-12-08T09:54:12Z",
      "diff_hunk" : "@@ -2265,17 +2266,55 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    CBlock block;\n+    CBlockUndo block_undo;\n+\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1043148360",
      "id" : 1043148360,
      "in_reply_to_id" : 1041182276,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-LS5I",
      "original_commit_id" : "8da8bee0746a58dae77f790d2695a23f07639830",
      "original_line" : 2276,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1209775651,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043148360/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T09:54:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043148360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased to remove the LOCK on `cs_main` in `CheckBlockFilterMatches`.",
      "created_at" : "2022-12-08T10:25:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1342483013",
      "id" : 1342483013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585QBKpF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342483013/reactions"
      },
      "updated_at" : "2022-12-08T10:25:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342483013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1043196880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043196880"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nstatic bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex& block, const GCSFilter::ElementSet& needles)\r\n```\r\n\r\nShouldn't this be `&`? (Passing in `nullptr` would be UB)",
      "commit_id" : "1a0a2ede28a3fd348f6b6da196cc5526d01e5cc0",
      "created_at" : "2022-12-08T10:30:37Z",
      "diff_hunk" : "@@ -2268,17 +2269,49 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1043196880",
      "id" : 1043196880,
      "line" : 2272,
      "node_id" : "PRRC_kwDOABII584-LevQ",
      "original_commit_id" : "1a0a2ede28a3fd348f6b6da196cc5526d01e5cc0",
      "original_line" : 2272,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 12,
      "pull_request_review_id" : 1209845238,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043196880/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T10:30:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043196880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1043235014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043235014"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done.",
      "commit_id" : "c8d5ee3f3f60d50968c7d48f8fdfd678ea2a1fbc",
      "created_at" : "2022-12-08T11:10:17Z",
      "diff_hunk" : "@@ -2268,17 +2269,49 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex* pindex, const GCSFilter::ElementSet& needles)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1043235014",
      "id" : 1043235014,
      "in_reply_to_id" : 1043196880,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-LoDG",
      "original_commit_id" : "1a0a2ede28a3fd348f6b6da196cc5526d01e5cc0",
      "original_line" : 2272,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1209902208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043235014/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T11:10:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043235014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1048927397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048927397"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ISTM this outer loop isn't necessary and could potentially be quite slow. `GCSFilter::ElementSet` is a `std::unordered_set` which has constant time lookup. But with this loop, the lookup becomes linear. It should be much faster to see if each scriptPubKey is contained in `needles`.\r\n\r\n```suggestion\r\n// Check if any of the outputs match the scriptPubKey\r\n    for (const auto& tx : block.vtx) {\r\n        if (std::any_of(tx->vout.cbegin(), tx->vout.cend(), [&](const auto& txout) { return needles.count(std::vector<unsigned char>(txout.scriptPubKey.begin(), txout.scriptPubKey.end())) != 0; })) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    // Check if any of the inputs match the scriptPubKey\r\n    for (const auto& txundo : block_undo.vtxundo) {\r\n        if (std::any_of(txundo.vprevout.cbegin(), txundo.vprevout.cend(), [&](const auto& coin) { return needles.count(std::vector<unsigned char>(coin.out.scriptPubKey.begin(), coin.out.scriptPubKey.end())) != 0; })) {\r\n            return true;\r\n        }\r\n    }\r\n```",
      "commit_id" : "c8d5ee3f3f60d50968c7d48f8fdfd678ea2a1fbc",
      "created_at" : "2022-12-14T20:07:19Z",
      "diff_hunk" : "@@ -2268,17 +2269,49 @@ class BlockFiltersScanReserver\n     }\n };\n \n+static bool CheckBlockFilterMatches(BlockManager& blockman, const CBlockIndex& blockindex, const GCSFilter::ElementSet& needles)\n+{\n+\n+    const CBlock block{GetBlockChecked(blockman, &blockindex)};\n+    const CBlockUndo block_undo{GetUndoChecked(blockman, &blockindex)};\n+\n+    for (const auto& needle : needles) {\n+        const auto script{CScript(needle.begin(), needle.end())};\n+\n+        // Check if any of the outputs match the scriptPubKey\n+        for (const auto& tx : block.vtx) {\n+            if (std::any_of(tx->vout.cbegin(), tx->vout.cend(), [&](const auto& txout) { return txout.scriptPubKey == script; })) {\n+                return true;\n+            }\n+        }\n+\n+        // Check if any of the inputs match the scriptPubKey\n+        for (const auto& txundo : block_undo.vtxundo) {\n+            if (std::any_of(txundo.vprevout.cbegin(), txundo.vprevout.cend(), [&](const auto& coin) { return coin.out.scriptPubKey == script; })) {\n+                return true;\n+            }\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#discussion_r1048927397",
      "id" : 1048927397,
      "line" : 2294,
      "node_id" : "PRRC_kwDOABII584-hVyl",
      "original_commit_id" : "c8d5ee3f3f60d50968c7d48f8fdfd678ea2a1fbc",
      "original_line" : 2294,
      "original_position" : 34,
      "original_start_line" : 2278,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 34,
      "pull_request_review_id" : 1218178205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26325",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048927397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2278,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-14T20:07:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1048927397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @achow101 I added your suggestion.",
      "created_at" : "2022-12-15T09:02:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26325#issuecomment-1352749499",
      "id" : 1352749499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26325",
      "node_id" : "IC_kwDOABII585QoVG7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1352749499/reactions"
      },
      "updated_at" : "2022-12-15T09:02:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1352749499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   }
]
