[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001578644"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001578644"
         }
      },
      "author_association" : "MEMBER",
      "body" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f:\r\n\r\nThere are several unrelated things:\r\n\r\n* If this feeler check isn't dead code here, it should probably be moved to the previous section that initializes the TxRelay struct. (And maybe in a separate pull request, as it would change non-erlay code?) This would mean that the tx relay struct isn't initialized and also m_relays_txs isn't set, which is then checked in this line here.\r\n* Unrelated, I wonder if `RejectIncomingTxs` should be used here. The difference is that the `Relay` permission will be carved out. I don't know the answer, I just wanted to raise the point.",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T09:30:08Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001578644",
      "id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847suCU",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1150648334,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001578644/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T09:30:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001578644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26448](https://github.com/bitcoin/bitcoin/pull/26448) (test: fix intermittent failure in p2p_sendtxrcncl.py by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-10-21T10:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#issuecomment-1286753334",
      "id" : 1286753334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26359",
      "node_id" : "IC_kwDOABII585Mskw2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286753334/reactions"
      },
      "updated_at" : "2022-11-04T14:14:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1286753334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001625212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001625212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "good point, i'll look closer.",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T10:20:13Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001625212",
      "id" : 1001625212,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847s5Z8",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1150717088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001625212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T10:20:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001625212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001842102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001842102"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1. From my understanding, this code isn't dead. The feeler check could indeed be moved above. Not sure what's the best way to attack this w.r.t. this PR (surely, a separate PR is the best option, but is that gonna get merged sooner...)\r\n2. Yeah checking for tx relay support is kinda ugly in general. `RejectIncomingTxs` is of course relevant, but not 100% match, if you just look at the name. I'd better keep the code as-is now, and refactor this separately (dunno how yet)",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T14:14:38Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1001842102",
      "id" : 1001842102,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847tuW2",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1151036674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001842102/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T14:14:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001842102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1002071153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002071153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "By the latter I mean that even `RejectIncomingTxs`-ing (whatever that could mean) doesn't necessarily mean we should reject reconciling. Might be useful to reconcile even if we \"should reject\". Not 100% sure (certainly not how Erlay intends to work in the default case).\r\n\r\nAnyway, not changing the code until further consideration.",
      "commit_id" : "15962a8eea8cbadb302453ae0960132c1a3cfc4d",
      "created_at" : "2022-10-21T18:20:16Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1002071153",
      "id" : 1002071153,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5847umRx",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1151382479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002071153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-21T18:31:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002071153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004664239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004664239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Not sure what's the best way to attack this w.r.t. this PR \r\n\r\nHappy to work on this, unless you want to",
      "commit_id" : "0ba8bd18bf0473b8a8239954310919e1a33ab671",
      "created_at" : "2022-10-25T15:47:47Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004664239",
      "id" : 1004664239,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII58474fWv",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1155070256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004664239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T15:47:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004664239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004919267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004919267"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was waiting for another opinion to show up here :)\r\nFeel free to open a separate PR with that stuff, I will ack. Or, if you think it makes more sense here,, then I can just add a commit here, that i can do.",
      "commit_id" : "0ba8bd18bf0473b8a8239954310919e1a33ab671",
      "created_at" : "2022-10-25T20:08:48Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1004919267",
      "id" : 1004919267,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII58475dnj",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1155432194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004919267/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-25T20:08:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004919267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1005876083"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005876083"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Heh, maybe it should be left as-is here. We also send a lot of other messages, such as `GETADDR`, so the `SENDTXRCNCL` message seems to be consistent. Changing the tx-relay allocation could still be done, though. See https://github.com/bitcoin/bitcoin/pull/26396",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-26T15:59:48Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1005876083",
      "id" : 1005876083,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII58479HNz",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1156842842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005876083/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:59:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005876083",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007907629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007907629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 2269d91d2a `p2p: Drop roles from sendtxrcncl` there is this change:\r\n\r\n```diff\r\n     // Reconciliation version is higher than ours, should be able to register.\r\n     BOOST_REQUIRE(!tracker.IsPeerRegistered(1));\r\n     tracker.PreRegisterPeer(1);\r\n-    BOOST_REQUIRE(tracker.RegisterPeer(1, true, true, false, 2, salt) == ReconciliationRegisterResult::SUCCESS);\r\n+    BOOST_REQUIRE(tracker.RegisterPeer(1, false, 1, salt) == ReconciliationRegisterResult::SUCCESS);\r\n     BOOST_CHECK(tracker.IsPeerRegistered(1));\r\n```\r\n\r\nI think that should be\r\n\r\n```diff\r\n+    BOOST_REQUIRE(tracker.RegisterPeer(1, true, 2, salt) == ReconciliationRegisterResult::SUCCESS);\r\n```\r\n\r\n(it is further modified by subsequent commits and I think that the cumulative diff is ok, but still each commit should make sense on its own)",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T10:22:23Z",
      "diff_hunk" : "@@ -12,71 +12,65 @@ BOOST_FIXTURE_TEST_SUITE(txreconciliation_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(RegisterPeerTest)\n {\n-    TxReconciliationTracker tracker(1);\n+    TxReconciliationTracker tracker(TXRECONCILIATION_VERSION);\n     const uint64_t salt = 0;\n \n     // Prepare a peer for reconciliation.\n     tracker.PreRegisterPeer(0);\n \n-    // Both roles are false, don't register.\n-    BOOST_CHECK(tracker.RegisterPeer(/*peer_id=*/0, /*is_peer_inbound=*/true,\n-                                      /*is_peer_recon_initiator=*/false,\n-                                      /*is_peer_recon_responder=*/false,\n-                                      /*peer_recon_version=*/1, salt) ==\n-                    ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n-\n-    // Invalid roles for the given connection direction.\n-    BOOST_CHECK(tracker.RegisterPeer(0, true, false, true, 1, salt) == ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n-    BOOST_CHECK(tracker.RegisterPeer(0, false, true, false, 1, salt) == ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n-\n     // Invalid version.\n-    BOOST_CHECK(tracker.RegisterPeer(0, true, true, false, 0, salt) == ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n+    BOOST_CHECK_EQUAL(tracker.RegisterPeer(/*peer_id=*/0, /*is_peer_inbound=*/true,\n+                                        /*peer_recon_version=*/0, salt), ReconciliationRegisterResult::PROTOCOL_VIOLATION);\n \n-    // Valid registration.\n+    // Valid registration (inbound and outbound peers).\n     BOOST_REQUIRE(!tracker.IsPeerRegistered(0));\n-    BOOST_REQUIRE(tracker.RegisterPeer(0, true, true, false, 1, salt) == ReconciliationRegisterResult::SUCCESS);\n+    BOOST_REQUIRE_EQUAL(tracker.RegisterPeer(0, true, 1, salt), ReconciliationRegisterResult::SUCCESS);\n     BOOST_CHECK(tracker.IsPeerRegistered(0));\n-\n-    // Reconciliation version is higher than ours, should be able to register.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007907629",
      "id" : 1007907629,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII5848E3Mt",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 40,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/test/txreconciliation_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007907629/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007907629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007934092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007934092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 60a066da70 `p2p: Disconnect peer after sendtxrcncl if we are in blocksonly`\r\n\r\nIt could happen that `m_ignore_incoming_txs` is `true` (thus we disconnect the peer), but we did _not_ indicate no tx relay to that peer as mentioned in the log message. That is - we sent `relay=true` in the `VERSION` message.\r\n\r\nThis could happen if the peer has `NetPermissionFlags::Relay` permission.\r\n\r\nOr the other way around - we may send `relay=false` in the `VERSION` message, but not disconnect the peer here (block-only or feeler connections).\r\n\r\nWould it be better to use `PeerManagerImpl::RejectIncomingTxs()` here instead of `m_ignore_incoming_txs`? The relay flag in the `VERSION` message is set based on it in `PeerManagerImpl::PushNodeVersion()`.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T10:55:26Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007934092",
      "id" : 1007934092,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848E9qM",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : 3502,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007934092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3502,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-28T11:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007934092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It may also happen that we disconnect the peer because `peer->GetTxRelay()` is not set because the peer did not sent us relay=true in their `VERSION` message and we don't provide bloom filter to them. I think this warrants a separate log message, something like:\r\n\r\n\"sendtxrcncl received from peer=%d that indicated no tx relay; disconnecting\\n\"",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:15:10Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948789",
      "id" : 1007948789,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FBP1",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about peers that send us relay=false in the VERSION message but we provide bloom filters to them. The code in this PR would not disconnect such a peer, but I think it should, right?",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:15:24Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007948957",
      "id" : 1007948957,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FBSd",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948957/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T11:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007948957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007975709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007975709"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: the `return` inside the `if` is unnecessary",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:46:55Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n         if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n+                                                                                peer_txreconcl_version, remote_salt);\n \n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n         if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n+\n+        if (result == ReconciliationRegisterResult::NOT_FOUND) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+            return;\n+        }\n+\n         return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007975709",
      "id" : 1007975709,
      "line" : 3532,
      "node_id" : "PRRC_kwDOABII5848FH0d",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3532,
      "original_position" : 73,
      "original_start_line" : 3527,
      "path" : "src/net_processing.cpp",
      "position" : 73,
      "pull_request_review_id" : 1159830143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007975709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3527,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-28T11:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007975709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007983022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007983022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "i thought this improves readability somehow... good to drop.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T11:56:07Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n         if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n+                                                                                peer_txreconcl_version, remote_salt);\n \n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n         if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n+\n+        if (result == ReconciliationRegisterResult::NOT_FOUND) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+            return;\n+        }\n+\n         return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007983022",
      "id" : 1007983022,
      "in_reply_to_id" : 1007975709,
      "line" : 3532,
      "node_id" : "PRRC_kwDOABII5848FJmu",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3532,
      "original_position" : 73,
      "original_start_line" : 3527,
      "path" : "src/net_processing.cpp",
      "position" : 73,
      "pull_request_review_id" : 1159940931,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007983022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3527,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-28T11:56:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007983022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007989670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007989670"
         }
      },
      "author_association" : "MEMBER",
      "body" : "These flags are confusing :(\r\nIndeed, having `fRelay=false` I think is not currently compatible with reconciliations.\r\n\r\nSo, instead of `GetTxRelay()`, we better look at `pfrom.m_relays_txs`, right?",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T12:04:12Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1007989670",
      "id" : 1007989670,
      "in_reply_to_id" : 1007948957,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FLOm",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1159951251,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007989670/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:04:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007989670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008028799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008028799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> These flags are confusing :(\r\n\r\nYes! :frowning_face:\r\n\r\n> Indeed, having `fRelay=false` I think is not currently compatible with reconciliations.\r\n\r\nI guess you mean the relay flag in the either VERSION message - sent or received, right?\r\n\r\nWhat about clarifying the BIP:\r\n\r\n```diff\r\n-sendtxrcncl ... Must not be sent if peer specified no support for transaction relay (fRelay=0) in \"version\". Otherwise, the sender should be disconnected.\r\n+sendtxrcncl ... Must not be sent if either peer specified no support for transaction relay (fRelay=0) in \"version\". Otherwise, the sender should be disconnected.\r\n```\r\n\r\n> So, instead of `GetTxRelay()`, we better look at `pfrom.m_relays_txs`, right?\r\n\r\nYes, this is closer to checking whether the peer sent us `relay=false` in `VERSION`. However it is not identical - `fRelay` may be `true`, but `pfrom.m_relays_txs` be `false` if `pfrom.IsBlockOnlyConn()`. It is ok to accept this discrepancy because for block-only connections we sent `relay=false` in our `VERSION` message.\r\n\r\nThat said, maybe the condition should be:\r\n\r\n```diff\r\n-if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\r\n+if (!pfrom.m_relays_txs /* they sent relay=false */ ||\r\n+    RejectIncomingTxs(pfrom) /* we sent relay=false */) {\r\n```",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-28T12:49:25Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008028799",
      "id" : 1008028799,
      "in_reply_to_id" : 1007948957,
      "line" : 3506,
      "node_id" : "PRRC_kwDOABII5848FUx_",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3506,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 35,
      "pull_request_review_id" : 1160010089,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008028799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T12:49:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008028799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008948272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008948272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you should update `SENDTXRCNCL` , this still mentioning the role assignment based on booleans. I would also suggest to document somewhere, in `protocol.h` or `txreconciliation.cpp`, near to `m_we_initiate` how the role assignment is made. ",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-30T23:52:14Z",
      "diff_hunk" : "@@ -116,24 +115,11 @@ class TxReconciliationTracker::Impl\n         // v1 is the lowest version, so suggesting something below must be a protocol violation.\n         if (recon_version < 1) return PROTOCOL_VIOLATION;\n \n-        // Must match SENDTXRCNCL logic.\n-        const bool they_initiate = is_peer_recon_initiator && is_peer_inbound;\n-        const bool we_initiate = !is_peer_inbound && is_peer_recon_responder;\n-\n-        // If we ever announce support for both requesting and responding, this will need\n-        // tie-breaking. For now, this is mutually exclusive because both are based on the\n-        // inbound flag.\n-        assert(!(they_initiate && we_initiate));\n-\n-        // The peer set both flags to false, we treat it as a protocol violation.\n-        if (!(they_initiate || we_initiate)) return PROTOCOL_VIOLATION;\n-\n-        LogPrintLevel(BCLog::TXRECONCILIATION, BCLog::Level::Debug, \"Register peer=%d with the following params: \" /* Continued */\n-                                                                    \"we_initiate=%i, they_initiate=%i.\\n\",\n-                      peer_id, we_initiate, they_initiate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008948272",
      "id" : 1008948272,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII5848I1Qw",
      "original_commit_id" : "2269d91d2a5653116e0b2a4937d1c2e85413e92f",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/node/txreconciliation.cpp",
      "position" : 28,
      "pull_request_review_id" : 1161214019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008948272/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-30T23:59:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008948272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008949154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008949154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about `IsAddrFetchConn()` ? I think we should restrain ourselves to send `ConnectionType::ADDR_FETCH`. ",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-30T23:57:34Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1008949154",
      "id" : 1008949154,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5848I1ei",
      "original_commit_id" : "d2b402ca64375e65d15fb6d9ee871012f6eeb68b",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1161214019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008949154/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-30T23:59:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008949154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009134521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009134521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I decided to keep it unless there are strong objections.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-31T08:16:20Z",
      "diff_hunk" : "@@ -3497,45 +3494,41 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        if (!peer->GetTxRelay() || m_ignore_incoming_txs) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n         if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n+                                                                                peer_txreconcl_version, remote_salt);\n \n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n         if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n+\n+        if (result == ReconciliationRegisterResult::NOT_FOUND) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+            return;\n+        }\n+\n         return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009134521",
      "id" : 1009134521,
      "in_reply_to_id" : 1007975709,
      "line" : 3532,
      "node_id" : "PRRC_kwDOABII5848Jiu5",
      "original_commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "original_line" : 3532,
      "original_position" : 73,
      "original_start_line" : 3527,
      "path" : "src/net_processing.cpp",
      "position" : 73,
      "pull_request_review_id" : 1161474759,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009134521/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3527,
      "start_side" : "RIGHT",
      "updated_at" : "2022-10-31T08:16:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009134521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009168380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009168380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Similarly to #26396, i think this should be fixed above (`m_relays_tx`), and done in a separate PR :)\r\nLet's hope Marco updates that one for now.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-10-31T08:57:27Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1009168380",
      "id" : 1009168380,
      "in_reply_to_id" : 1008949154,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5848Jq_8",
      "original_commit_id" : "d2b402ca64375e65d15fb6d9ee871012f6eeb68b",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1161522905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009168380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-31T08:57:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1009168380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1010993852"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010993852"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "#26396 seems likely to be accepted, so I agree that the commit can be removed here.",
      "commit_id" : "2b9cd5f7b6c0cba03da7b234eb638296eeb05cfa",
      "created_at" : "2022-11-01T23:30:46Z",
      "diff_hunk" : "@@ -3273,8 +3273,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // - protocol version per the VERSION message supports WTXID_RELAY;\n             // - we intended to exchange transactions over this connection while establishing it\n             //   and the peer indicated support for transaction relay in the VERSION message;\n-            // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            // - we are not in -blocksonly mode;\n+            // - this is not a feeler.\n+            if (pfrom.m_relays_txs && !m_ignore_incoming_txs && !pfrom.IsFeelerConn()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1010993852",
      "id" : 1010993852,
      "in_reply_to_id" : 1001578644,
      "line" : 3278,
      "node_id" : "PRRC_kwDOABII5848Qoq8",
      "original_commit_id" : "cfd5c27dcdc39cf7a65c56c3dbf3bf60ea0c475f",
      "original_line" : 3278,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1164181319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010993852/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T23:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010993852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-04T16:28:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#issuecomment-1303839749",
      "id" : 1303839749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26359",
      "node_id" : "IC_kwDOABII585NtwQF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303839749/reactions"
      },
      "updated_at" : "2022-11-04T16:28:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303839749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1015725959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015725959"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There is some inconsistency between handling these edge cases. This `assert()` also looks a bit dangerous to me wrt to future changes - it seems that if the peer sends us two times `SENDTXRCNCL` that could trigger a remote crash by tripping this `assert()`. The only thing that is stopping this now is the `IsPeerRegistered()` in the caller, but it is not obvious there that if it is removed, grave things will ensue. I can imagine it getting wiped away by a future \"refactor\".\r\n\r\nIf the caller has checked `IsPeerRegistered()` before this, then we will never return `NOT_FOUND` from here either. So that may as well be an assert too :fire: \r\n\r\nWhat about not having such an assert at all and returning `ReconciliationRegisterResult::NOT_FOUND` if the peer is not pre-registered (like now) and `ReconciliationRegisterResult::ALREADY_REGISTERED` if the peer is already registered? Then the caller need not to check `IsPeerRegistered()` before calling this method.",
      "commit_id" : "1597210a6d244927651b6a4b573b884cc6f9236c",
      "created_at" : "2022-11-07T17:48:16Z",
      "diff_hunk" : "@@ -81,31 +82,28 @@ class TxReconciliationTracker::Impl\n     {\n         AssertLockNotHeld(m_txreconciliation_mutex);\n         LOCK(m_txreconciliation_mutex);\n-        // We do not support txreconciliation salt/version updates.\n-        assert(m_states.find(peer_id) == m_states.end());\n \n         LogPrintLevel(BCLog::TXRECONCILIATION, BCLog::Level::Debug, \"Pre-register peer=%d\\n\", peer_id);\n         const uint64_t local_salt{GetRand(UINT64_MAX)};\n \n         // We do this exactly once per peer (which are unique by NodeId, see GetNewNodeId) so it's\n         // safe to assume we don't have this record yet.\n-        Assert(m_states.emplace(peer_id, local_salt).second);\n+        Assume(m_states.emplace(peer_id, local_salt).second);\n         return local_salt;\n     }\n \n-    ReconciliationRegisterResult RegisterPeer(NodeId peer_id, bool is_peer_inbound, bool is_peer_recon_initiator,\n-                                     bool is_peer_recon_responder, uint32_t peer_recon_version,\n+    ReconciliationRegisterResult RegisterPeer(NodeId peer_id, bool is_peer_inbound, uint32_t peer_recon_version,\n                                      uint64_t remote_salt) EXCLUSIVE_LOCKS_REQUIRED(!m_txreconciliation_mutex)\n     {\n         AssertLockNotHeld(m_txreconciliation_mutex);\n         LOCK(m_txreconciliation_mutex);\n         auto recon_state = m_states.find(peer_id);\n \n         // A peer should be in the pre-registered state to proceed here.\n-        if (recon_state == m_states.end()) return NOT_FOUND;\n+        if (recon_state == m_states.end()) return ReconciliationRegisterResult::NOT_FOUND;\n         uint64_t* local_salt = std::get_if<uint64_t>(&recon_state->second);\n         // A peer is already registered. This should be checked by the caller.\n-        Assume(local_salt);\n+        assert(local_salt);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1015725959",
      "id" : 1015725959,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848ir-H",
      "original_commit_id" : "2193344280c53cfd2145d5c5e60f774b5a73b1ea",
      "original_line" : 106,
      "original_position" : 42,
      "original_start_line" : 102,
      "path" : "src/node/txreconciliation.cpp",
      "position" : null,
      "pull_request_review_id" : 1170841389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015725959/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-08T08:40:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015725959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1015731735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015731735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure if that is better, just an idea, feel free to ignore:\r\n\r\n```diff\r\ndiff --git i/src/net_processing.cpp w/src/net_processing.cpp\r\nindex 376a263183..0ed7781b2c 100644\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -3265,26 +3265,27 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n             (fRelay || (peer->m_our_services & NODE_BLOOM))) {\r\n             auto* const tx_relay = peer->SetTxRelay();\r\n             {\r\n                 LOCK(tx_relay->m_bloom_filter_mutex);\r\n                 tx_relay->m_relay_txs = fRelay; // set to true after we get the first filter* message\r\n             }\r\n-            if (fRelay) pfrom.m_relays_txs = true;\r\n-        }\r\n-\r\n-        if (greatest_common_version >= WTXID_RELAY_VERSION && m_txreconciliation) {\r\n-            // Per BIP-330, we announce txreconciliation support if:\r\n-            // - protocol version per the peer's VERSION message supports WTXID_RELAY;\r\n-            // - transaction relay is supported per the peer's VERSION message (see m_relays_txs);\r\n-            // - this is not a block-relay-only connection and not a feeler (see m_relays_txs);\r\n-            // - this is not an addr fetch connection;\r\n-            // - we are not in -blocksonly mode.\r\n-            if (pfrom.m_relays_txs && !pfrom.IsAddrFetchConn() && !m_ignore_incoming_txs) {\r\n-                const uint64_t recon_salt = m_txreconciliation->PreRegisterPeer(pfrom.GetId());\r\n-                m_connman.PushMessage(&pfrom, msg_maker.Make(NetMsgType::SENDTXRCNCL,\r\n-                                                             TXRECONCILIATION_VERSION, recon_salt));\r\n+            if (fRelay) {\r\n+                pfrom.m_relays_txs = true;\r\n+\r\n+                if (greatest_common_version >= WTXID_RELAY_VERSION &&\r\n+                    m_txreconciliation &&\r\n+                    !pfrom.IsAddrFetchConn() && !m_ignore_incoming_txs) {\r\n+                    // Per BIP-330, we announce txreconciliation support if:\r\n+                    // - protocol version per the peer's VERSION message supports WTXID_RELAY;\r\n+                    // - transaction relay is supported per the peer's VERSION message (see m_relays_txs);\r\n+                    // - this is not a block-relay-only connection and not a feeler (see m_relays_txs);\r\n+                    // - this is not an addr fetch connection;\r\n+                    // - we are not in -blocksonly mode.\r\n+                    const uint64_t recon_salt = m_txreconciliation->PreRegisterPeer(pfrom.GetId());\r\n+                    m_connman.PushMessage(&pfrom, msg_maker.Make(NetMsgType::SENDTXRCNCL, TXRECONCILIATION_VERSION, recon_salt));\r\n+                }\r\n             }\r\n         }\r\n \r\n         m_connman.PushMessage(&pfrom, msg_maker.Make(NetMsgType::VERACK));\r\n \r\n         // Potentially mark this peer as a preferred download peer.\r\n```\r\n",
      "commit_id" : "2193344280c53cfd2145d5c5e60f774b5a73b1ea",
      "created_at" : "2022-11-07T17:54:36Z",
      "diff_hunk" : "@@ -3273,17 +3273,14 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (greatest_common_version >= WTXID_RELAY_VERSION && m_txreconciliation) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1015731735",
      "id" : 1015731735,
      "line" : 3274,
      "node_id" : "PRRC_kwDOABII5848itYX",
      "original_commit_id" : "2193344280c53cfd2145d5c5e60f774b5a73b1ea",
      "original_line" : 3274,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 2,
      "pull_request_review_id" : 1170841389,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015731735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-07T17:56:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015731735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1016401382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016401382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure about this it's kinda difficult either way :) Will see what others say.",
      "commit_id" : "1597210a6d244927651b6a4b573b884cc6f9236c",
      "created_at" : "2022-11-08T10:04:21Z",
      "diff_hunk" : "@@ -3273,17 +3273,14 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (greatest_common_version >= WTXID_RELAY_VERSION && m_txreconciliation) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1016401382",
      "id" : 1016401382,
      "in_reply_to_id" : 1015731735,
      "line" : 3274,
      "node_id" : "PRRC_kwDOABII5848lQ3m",
      "original_commit_id" : "2193344280c53cfd2145d5c5e60f774b5a73b1ea",
      "original_line" : 3274,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 2,
      "pull_request_review_id" : 1171805065,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016401382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-08T10:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016401382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1016688474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016688474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: the `{` `}` brackets shouldn't be necessary.\r\n",
      "commit_id" : "1597210a6d244927651b6a4b573b884cc6f9236c",
      "created_at" : "2022-11-08T14:16:00Z",
      "diff_hunk" : "@@ -3500,45 +3497,52 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        // Peer must not offer us reconciliations if we specified no tx relay support in VERSION.\n+        if (RejectIncomingTxs(pfrom)) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n-        if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n-            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n+        // Peer must not offer us reconciliations if they specified no tx relay support in VERSION.\n+        // This flag might also be false in other cases, but the RejectIncomingTxs check above\n+        // eliminates them, so that this flag fully represents what we are looking for.\n+        if (!pfrom.m_relays_txs) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d which indicated no tx relay to us; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n-                                                                                is_peer_initiator, is_peer_responder,\n-                                                                                peer_txreconcl_version,\n-                                                                                remote_salt);\n-\n-        // If it's a protocol violation, disconnect.\n-        // If the peer was not found (but something unexpected happened) or it was registered,\n-        // nothing to be done.\n-        if (result == ReconciliationRegisterResult::PROTOCOL_VIOLATION) {\n+                                                                                peer_txreconcl_version, remote_salt);\n+        switch (result) {\n+            case ReconciliationRegisterResult::NOT_FOUND: {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+                break;\n+            }\n+            case ReconciliationRegisterResult::SUCCESS:\n+                break;\n+            case ReconciliationRegisterResult::ALREADY_REGISTERED: {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n+                pfrom.fDisconnect = true;\n+                return;\n+            };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1016688474",
      "id" : 1016688474,
      "line" : 3538,
      "node_id" : "PRRC_kwDOABII5848mW9a",
      "original_commit_id" : "1597210a6d244927651b6a4b573b884cc6f9236c",
      "original_line" : 3538,
      "original_position" : 85,
      "original_start_line" : 3534,
      "path" : "src/net_processing.cpp",
      "position" : 85,
      "pull_request_review_id" : 1172205606,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016688474/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 3534,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-08T14:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016688474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1016699981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016699981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The commit bd1563f72962bb888153d9a6bf804a64a72ff66e `refactor: Switch to enum class for ReconciliationRegisterResult` now contains also the behavioral change of `RegisterPeer()` wrt its return value and the removal of the assert.",
      "commit_id" : "1597210a6d244927651b6a4b573b884cc6f9236c",
      "created_at" : "2022-11-08T14:25:10Z",
      "diff_hunk" : "@@ -3500,45 +3497,52 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send a SENDTXRCNCL message after VERACK.\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        if (!peer->GetTxRelay()) {\n-            // Disconnect peers that send a SENDTXRCNCL message even though we indicated we don't\n-            // support transaction relay.\n+        // Peer must not offer us reconciliations if we specified no tx relay support in VERSION.\n+        if (RejectIncomingTxs(pfrom)) {\n             LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d to which we indicated no tx relay; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n-        bool is_peer_initiator, is_peer_responder;\n-        uint32_t peer_txreconcl_version;\n-        uint64_t remote_salt;\n-        vRecv >> is_peer_initiator >> is_peer_responder >> peer_txreconcl_version >> remote_salt;\n-\n-        if (m_txreconciliation->IsPeerRegistered(pfrom.GetId())) {\n-            // A peer is already registered, meaning we already received SENDTXRCNCL from them.\n-            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n+        // Peer must not offer us reconciliations if they specified no tx relay support in VERSION.\n+        // This flag might also be false in other cases, but the RejectIncomingTxs check above\n+        // eliminates them, so that this flag fully represents what we are looking for.\n+        if (!pfrom.m_relays_txs) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"sendtxrcncl received from peer=%d which indicated no tx relay to us; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n         }\n \n+        uint32_t peer_txreconcl_version;\n+        uint64_t remote_salt;\n+        vRecv >> peer_txreconcl_version >> remote_salt;\n+\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1016699981",
      "id" : 1016699981,
      "line" : 3525,
      "node_id" : "PRRC_kwDOABII5848mZxN",
      "original_commit_id" : "1597210a6d244927651b6a4b573b884cc6f9236c",
      "original_line" : 3525,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 64,
      "pull_request_review_id" : 1172205606,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016699981/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-08T14:25:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016699981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1018382417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1018382417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, if you touch again: indentation changes for the worse here.  Also, usually while case block is indented, the `case` lines aren't indented wrt the `switch` line, see other examples or apply clang-format script.",
      "commit_id" : "58786a102ae716332c2d56a00a10726fb7e305f1",
      "created_at" : "2022-11-09T20:26:32Z",
      "diff_hunk" : "@@ -3525,15 +3525,18 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         const ReconciliationRegisterResult result = m_txreconciliation->RegisterPeer(pfrom.GetId(), pfrom.IsInboundConn(),\n                                                                                 peer_txreconcl_version, remote_salt);\n         switch (result) {\n-            case ReconciliationRegisterResult::NOT_FOUND:\n+            case ReconciliationRegisterResult::NOT_FOUND: {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"Ignore unexpected txreconciliation signal from peer=%d\\n\", pfrom.GetId());\n+                break;\n+            }\n             case ReconciliationRegisterResult::SUCCESS:\n                 break;\n             case ReconciliationRegisterResult::ALREADY_REGISTERED:\n                 LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d (sendtxrcncl received from already registered peer); disconnecting\\n\", pfrom.GetId());\n                 pfrom.fDisconnect = true;\n                 return;\n             case ReconciliationRegisterResult::PROTOCOL_VIOLATION:\n-                LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"txreconciliation protocol violation from peer=%d; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1018382417",
      "id" : 1018382417,
      "line" : 3539,
      "node_id" : "PRRC_kwDOABII5848s0hR",
      "original_commit_id" : "5c8c99b128a985e34a8e8244b94efdd972c9dcee",
      "original_line" : 3539,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 17,
      "pull_request_review_id" : 1174704107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1018382417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-09T20:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1018382417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1018391241"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1018391241"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not a big fan of special casing behavior for `AddrFetch` without any tangible benefits (or are there any?) - I'd like to think of them as normal outbound connections, where we just happen to disconnect after we get the GETADDR answer, and while I admit that concerns such as https://github.com/bitcoin/bitcoin/pull/26396#issuecomment-1302421314 aren't super strong, I think it's also easier mental model and less complicated code not to special-case for each message whether AddrFetch connections need it.",
      "commit_id" : "58786a102ae716332c2d56a00a10726fb7e305f1",
      "created_at" : "2022-11-09T20:37:24Z",
      "diff_hunk" : "@@ -3273,11 +3273,12 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (greatest_common_version >= WTXID_RELAY_VERSION && m_txreconciliation) {\n             // Per BIP-330, we announce txreconciliation support if:\n-            // - protocol version per the VERSION message supports WTXID_RELAY;\n-            // - we intended to exchange transactions over this connection while establishing it\n-            //   and the peer indicated support for transaction relay in the VERSION message;\n+            // - protocol version per the peer's VERSION message supports WTXID_RELAY;\n+            // - transaction relay is supported per the peer's VERSION message (see m_relays_txs);\n+            // - this is not a block-relay-only connection and not a feeler (see m_relays_txs);\n+            // - this is not an addr fetch connection;\n             // - we are not in -blocksonly mode.\n-            if (pfrom.m_relays_txs && !m_ignore_incoming_txs) {\n+            if (pfrom.m_relays_txs && !pfrom.IsAddrFetchConn() && !m_ignore_incoming_txs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26359#discussion_r1018391241",
      "id" : 1018391241,
      "line" : 3281,
      "node_id" : "PRRC_kwDOABII5848s2rJ",
      "original_commit_id" : "1aa164574d4b163b73849309e497b316fd1c2ea6",
      "original_line" : 3281,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1174704107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26359",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1018391241/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-09T20:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1018391241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
