[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2022-12-08T14:38:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#issuecomment-1342835167",
      "id" : 1342835167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26662",
      "node_id" : "IC_kwDOABII585QCgnf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342835167/reactions"
      },
      "updated_at" : "2022-12-08T14:38:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342835167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043439610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043439610"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sort :ghost: ?",
      "commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "created_at" : "2022-12-08T14:49:02Z",
      "diff_hunk" : "@@ -336,6 +336,7 @@ test_fuzz_fuzz_SOURCES = \\\n  test/fuzz/tx_pool.cpp \\\n  test/fuzz/txorphan.cpp \\\n  test/fuzz/txrequest.cpp \\\n+ test/fuzz/headerssync.cpp \\",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043439610",
      "id" : 1043439610,
      "line" : 339,
      "node_id" : "PRRC_kwDOABII584-MZ_6",
      "original_commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "original_line" : 339,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/Makefile.test.include",
      "position" : 4,
      "pull_request_review_id" : 1210208938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043439610/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T14:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043439610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043440769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043440769"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could use the string constant? ",
      "commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "created_at" : "2022-12-08T14:50:07Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#include <arith_uint256.h>\n+#include <chain.h>\n+#include <chainparams.h>\n+#include <headerssync.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <util/time.h>\n+#include <validation.h>\n+\n+#include <vector>\n+\n+static void initialize_headers_sync_state_fuzz()\n+{\n+    SelectParams(\"main\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043440769",
      "id" : 1043440769,
      "line" : 14,
      "node_id" : "PRRC_kwDOABII584-MaSB",
      "original_commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "original_line" : 14,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/headerssync.cpp",
      "position" : 14,
      "pull_request_review_id" : 1210208938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043440769/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T14:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043440769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043446492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043446492"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems impossible that this produces even a single valid header, because the engine can't guess the prevblock hash, no?",
      "commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "created_at" : "2022-12-08T14:55:17Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#include <arith_uint256.h>\n+#include <chain.h>\n+#include <chainparams.h>\n+#include <headerssync.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <util/time.h>\n+#include <validation.h>\n+\n+#include <vector>\n+\n+static void initialize_headers_sync_state_fuzz()\n+{\n+    SelectParams(\"main\");\n+}\n+\n+FUZZ_TARGET_INIT(headers_sync_state, initialize_headers_sync_state_fuzz)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+    SetMockTime(ConsumeTime(fuzzed_data_provider));\n+\n+    CBlockHeader genesis_header{Params().GenesisBlock()};\n+    CBlockIndex start_index(genesis_header);\n+    const uint256 block_hash = genesis_header.GetHash();\n+    start_index.phashBlock = &block_hash;\n+\n+    arith_uint256 min_work{UintToArith256(ConsumeUInt256(fuzzed_data_provider))};\n+    HeadersSyncState headers_sync(\n+        /*id=*/0,\n+        /*consensus_params=*/Params().GetConsensus(),\n+        /*chain_start=*/&start_index,\n+        /*minimum_required_work=*/min_work);\n+\n+    // Store headers for potential redownload phase.\n+    std::vector<CBlockHeader> all_headers;\n+    std::vector<CBlockHeader>::const_iterator redownloaded_it;\n+    bool presync{true};\n+    bool requested_more{true};\n+\n+    while (requested_more) {\n+        std::vector<CBlockHeader> headers;\n+\n+        // Consume headers from fuzzer or maybe replay headers if we got to the\n+        // redownload phase.\n+        if (presync || fuzzed_data_provider.ConsumeBool()) {\n+            auto deser_headers = ConsumeDeserializable<std::vector<CBlockHeader>>(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043446492",
      "id" : 1043446492,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII584-Mbrc",
      "original_commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "original_line" : 46,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/test/fuzz/headerssync.cpp",
      "position" : 46,
      "pull_request_review_id" : 1210208938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043446492/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T14:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043446492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043499109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043499109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point, fixed it up to be able to create continuous headers.",
      "commit_id" : "274671b033f94637711dfd520cfd64d4369ea866",
      "created_at" : "2022-12-08T15:36:56Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#include <arith_uint256.h>\n+#include <chain.h>\n+#include <chainparams.h>\n+#include <headerssync.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <util/time.h>\n+#include <validation.h>\n+\n+#include <vector>\n+\n+static void initialize_headers_sync_state_fuzz()\n+{\n+    SelectParams(\"main\");\n+}\n+\n+FUZZ_TARGET_INIT(headers_sync_state, initialize_headers_sync_state_fuzz)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+    SetMockTime(ConsumeTime(fuzzed_data_provider));\n+\n+    CBlockHeader genesis_header{Params().GenesisBlock()};\n+    CBlockIndex start_index(genesis_header);\n+    const uint256 block_hash = genesis_header.GetHash();\n+    start_index.phashBlock = &block_hash;\n+\n+    arith_uint256 min_work{UintToArith256(ConsumeUInt256(fuzzed_data_provider))};\n+    HeadersSyncState headers_sync(\n+        /*id=*/0,\n+        /*consensus_params=*/Params().GetConsensus(),\n+        /*chain_start=*/&start_index,\n+        /*minimum_required_work=*/min_work);\n+\n+    // Store headers for potential redownload phase.\n+    std::vector<CBlockHeader> all_headers;\n+    std::vector<CBlockHeader>::const_iterator redownloaded_it;\n+    bool presync{true};\n+    bool requested_more{true};\n+\n+    while (requested_more) {\n+        std::vector<CBlockHeader> headers;\n+\n+        // Consume headers from fuzzer or maybe replay headers if we got to the\n+        // redownload phase.\n+        if (presync || fuzzed_data_provider.ConsumeBool()) {\n+            auto deser_headers = ConsumeDeserializable<std::vector<CBlockHeader>>(fuzzed_data_provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1043499109",
      "id" : 1043499109,
      "in_reply_to_id" : 1043446492,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII584-Mohl",
      "original_commit_id" : "707d60d9b4c45511d3ffb9d108302cbaa397deca",
      "original_line" : 64,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/test/fuzz/headerssync.cpp",
      "position" : 64,
      "pull_request_review_id" : 1210300292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043499109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T15:36:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043499109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Note: If you create a pull request with inputs against qa-assets, Drahty can create a coverage report ",
      "created_at" : "2022-12-08T15:54:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#issuecomment-1342938536",
      "id" : 1342938536,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26662",
      "node_id" : "IC_kwDOABII585QC52o",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342938536/reactions"
      },
      "updated_at" : "2022-12-08T15:54:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1342938536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "https://drahtbot.space/host_reports/DrahtBot/reports/coverage_fuzz/monotree/229d5c201b5528fd/fuzz.coverage/index.html",
      "created_at" : "2022-12-09T08:10:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#issuecomment-1343984302",
      "id" : 1343984302,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26662",
      "node_id" : "IC_kwDOABII585QG5Ku",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1343984302/reactions"
      },
      "updated_at" : "2022-12-09T08:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1343984302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1044189975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044189975"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not use a no-log context?",
      "commit_id" : "229d5c201b5528fd7098339c96c38547a2658087",
      "created_at" : "2022-12-09T08:13:12Z",
      "diff_hunk" : "@@ -0,0 +1,103 @@\n+#include <arith_uint256.h>\n+#include <chain.h>\n+#include <chainparams.h>\n+#include <headerssync.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <uint256.h>\n+#include <util/time.h>\n+#include <validation.h>\n+\n+#include <vector>\n+\n+static void initialize_headers_sync_state_fuzz()\n+{\n+    SelectParams(CBaseChainParams::MAIN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1044189975",
      "id" : 1044189975,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII584-PRMX",
      "original_commit_id" : "229d5c201b5528fd7098339c96c38547a2658087",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/test/fuzz/headerssync.cpp",
      "position" : 15,
      "pull_request_review_id" : 1211273728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044189975/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-09T08:13:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1044189975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the reviews @MarcoFalke and coverage report @DrahtBot !\r\n\r\nI think the coverage this is achieving looks decent, considering the corpus in https://github.com/bitcoin-core/qa-assets/pull/99 is the result of only ~20min of fuzzing.",
      "created_at" : "2022-12-09T11:28:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#issuecomment-1344191233",
      "id" : 1344191233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26662",
      "node_id" : "IC_kwDOABII585QHrsB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1344191233/reactions"
      },
      "updated_at" : "2022-12-09T11:28:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1344191233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1045080041"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045080041"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@sipa Thanks for the crash input! Luckily, this crash is caused by a bug in the fuzz target, not `HeadersSyncState`.\r\n\r\nThere is a buffer overflow happening here because this might attempt to copy to much from `all_headers` (i.e. `end_it` points past the actual end of `all_headers`). ",
      "commit_id" : "0b733a05c37b7911267241de788a4c36cc9445ad",
      "created_at" : "2022-12-10T12:29:51Z",
      "diff_hunk" : "@@ -0,0 +1,105 @@\n+#include <arith_uint256.h>\n+#include <chain.h>\n+#include <chainparams.h>\n+#include <headerssync.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <uint256.h>\n+#include <util/time.h>\n+#include <validation.h>\n+\n+#include <vector>\n+\n+static void initialize_headers_sync_state_fuzz()\n+{\n+    static const auto testing_setup = MakeNoLogFileContext<>(\n+        /*chain_name=*/CBaseChainParams::MAIN);\n+}\n+\n+void MakeHeadersContinuous(\n+    const CBlockHeader& genesis_header,\n+    const std::vector<CBlockHeader>& all_headers,\n+    std::vector<CBlockHeader>& new_headers)\n+{\n+    Assume(!new_headers.empty());\n+\n+    const CBlockHeader* prev_header{\n+        all_headers.empty() ? &genesis_header : &all_headers.back()};\n+\n+    for (auto& header : new_headers) {\n+        header.hashPrevBlock = prev_header->GetHash();\n+\n+        prev_header = &header;\n+    }\n+}\n+\n+FUZZ_TARGET_INIT(headers_sync_state, initialize_headers_sync_state_fuzz)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+    auto mock_time{ConsumeTime(fuzzed_data_provider)};\n+\n+    CBlockHeader genesis_header{Params().GenesisBlock()};\n+    CBlockIndex start_index(genesis_header);\n+\n+    if (mock_time < start_index.GetMedianTimePast()) return;\n+    SetMockTime(mock_time);\n+\n+    const uint256 genesis_hash = genesis_header.GetHash();\n+    start_index.phashBlock = &genesis_hash;\n+\n+    arith_uint256 min_work{UintToArith256(ConsumeUInt256(fuzzed_data_provider))};\n+    HeadersSyncState headers_sync(\n+        /*id=*/0,\n+        /*consensus_params=*/Params().GetConsensus(),\n+        /*chain_start=*/&start_index,\n+        /*minimum_required_work=*/min_work);\n+\n+    // Store headers for potential redownload phase.\n+    std::vector<CBlockHeader> all_headers;\n+    std::vector<CBlockHeader>::const_iterator redownloaded_it;\n+    bool presync{true};\n+    bool requested_more{true};\n+\n+    while (requested_more) {\n+        std::vector<CBlockHeader> headers;\n+\n+        // Consume headers from fuzzer or maybe replay headers if we got to the\n+        // redownload phase.\n+        if (presync || fuzzed_data_provider.ConsumeBool()) {\n+            auto deser_headers = ConsumeDeserializable<std::vector<CBlockHeader>>(fuzzed_data_provider);\n+            if (!deser_headers || deser_headers->empty()) return;\n+\n+            if (fuzzed_data_provider.ConsumeBool()) {\n+                MakeHeadersContinuous(genesis_header, all_headers, *deser_headers);\n+            }\n+\n+            headers.swap(*deser_headers);\n+        } else {\n+            auto end_it{redownloaded_it + fuzzed_data_provider.ConsumeIntegralInRange<int>(0, all_headers.size())};\n+            headers.insert(headers.cend(), redownloaded_it, end_it);\n+            redownloaded_it = end_it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26662#discussion_r1045080041",
      "id" : 1045080041,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-Sqfp",
      "original_commit_id" : "1f70ea02783fd08fa4375ab068ff92aff3858e99",
      "original_line" : 81,
      "original_position" : 81,
      "original_start_line" : 79,
      "path" : "src/test/fuzz/headerssync.cpp",
      "position" : null,
      "pull_request_review_id" : 1212563660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26662",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045080041/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-12-10T12:29:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1045080041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   }
]
