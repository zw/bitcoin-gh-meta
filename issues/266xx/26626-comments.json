[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [apoelstra](https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1336181669) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24149](https://github.com/bitcoin/bitcoin/pull/24149) (Signing support for Miniscript Descriptors by darosior)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-12-02T20:09:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1335791803",
      "id" : 1335791803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585PnpC7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1335791803/reactions"
      },
      "updated_at" : "2022-12-03T15:20:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1335791803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "concept ACK from me. I understand that the use is primarily in expressing pre-descriptor wallet patterns in descriptors.\r\n\r\nThis concept feels like it could be used (or is related to) multipath descriptors, like if it were possible to use multiple wildcards, one for \"set indexing\" and the other for \"range indexing\".",
      "created_at" : "2022-12-03T15:20:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1336181669",
      "id" : 1336181669,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585PpIOl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336181669/reactions"
      },
      "updated_at" : "2022-12-03T15:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336181669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1351933?v=4",
         "events_url" : "https://api.github.com/users/apoelstra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/apoelstra/followers",
         "following_url" : "https://api.github.com/users/apoelstra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/apoelstra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/apoelstra",
         "id" : 1351933,
         "login" : "apoelstra",
         "node_id" : "MDQ6VXNlcjEzNTE5MzM=",
         "organizations_url" : "https://api.github.com/users/apoelstra/orgs",
         "received_events_url" : "https://api.github.com/users/apoelstra/received_events",
         "repos_url" : "https://api.github.com/users/apoelstra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/apoelstra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/apoelstra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This concept feels like it could be used (or is related to) multipath descriptors, like if it were possible to use multiple wildcards, one for \"set indexing\" and the other for \"range indexing\".\r\n\r\nIt does, but they're slightly different. I had a discussion with @sipa about that and we concluded that it wasn't useful at least for the purpose that this PR targets.\r\n\r\nMultipath descriptors expands into multiple descriptors. In #22838, this is implemented as `Parse` returning multiple `Descriptor` objects. However in this PR, `{KEY,KEY,KEY...}` is interpreted as a single ranged `PubkeyProvider` like we do for xpubs. Doing it this way allows us to get the intended performance benefit for migrated non-HD wallets as interpreting it like multipath descriptors would just result in the same issue of having thousands of descriptors.",
      "created_at" : "2022-12-03T16:35:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1336194525",
      "id" : 1336194525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585PpLXd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336194525/reactions"
      },
      "updated_at" : "2022-12-03T16:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336194525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "That makes sense. We may want to revisit, from a conceptual point of view (vs the concrete needs of the Core wallet), later on.",
      "created_at" : "2022-12-04T17:20:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1336471599",
      "id" : 1336471599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585PqPAv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336471599/reactions"
      },
      "updated_at" : "2022-12-04T17:20:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1336471599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1351933?v=4",
         "events_url" : "https://api.github.com/users/apoelstra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/apoelstra/followers",
         "following_url" : "https://api.github.com/users/apoelstra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/apoelstra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/apoelstra",
         "id" : 1351933,
         "login" : "apoelstra",
         "node_id" : "MDQ6VXNlcjEzNTE5MzM=",
         "organizations_url" : "https://api.github.com/users/apoelstra/orgs",
         "received_events_url" : "https://api.github.com/users/apoelstra/received_events",
         "repos_url" : "https://api.github.com/users/apoelstra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/apoelstra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/apoelstra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/apoelstra"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This seems a rather ad-hoc extension that doesn't match the usage of descriptors outside of bitcoin-core.\r\nTherefore, it might imho be detrimental to the adoption of descriptors, as it adds complexity to every other implementation, even if they don't benefit of the additional feature.\r\n\r\nPerhaps core could consider having some \"extensions\" to descriptors for these special use cases, while keeping the standardized descriptor language as lean as possible?",
      "created_at" : "2022-12-05T14:52:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1337518293",
      "id" : 1337518293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585PuOjV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337518293/reactions"
      },
      "updated_at" : "2022-12-05T14:52:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337518293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@bigspider I think that's how we've been thinking about descriptors in the first place, a base language, with a set of extensions. There is no requirement that everyone implements all of them, as long as supported keywords have the same meaning across implementations. For example, new software might not care about pre-segwit `pk`/`pkh`/`sh`; that would mean implementing BIP380 (base language) and BIP382 (`wpkh`/`wsh`), but not BIP381 (`pk`/`pkh`/`sh`). But if they don't implement those, they can't give a different meaning to the same keywords.\r\n\r\nThings like BIP384 (`combo`) and BIP385 (`addr`/`raw`) are probably already fairly Bitcoin Core specific.",
      "created_at" : "2022-12-05T14:57:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1337525398",
      "id" : 1337525398,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585PuQSW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337525398/reactions"
      },
      "updated_at" : "2022-12-07T16:40:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337525398",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Would this scale well to migrating large pre-HD wallets?",
      "created_at" : "2022-12-07T08:58:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1340609352",
      "id" : 1340609352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585P6BNI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1340609352/reactions"
      },
      "updated_at" : "2022-12-07T08:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1340609352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Would this scale well to migrating large pre-HD wallets?\r\n\r\nI believe it will. It's the intended use of this syntax.",
      "created_at" : "2022-12-07T16:38:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#issuecomment-1341250662",
      "id" : 1341250662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26626",
      "node_id" : "IC_kwDOABII585P8dxm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341250662/reactions"
      },
      "updated_at" : "2022-12-07T16:38:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1341250662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047510000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047510000"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8f4ee670b34d984a7d20d2e44d1d80bb8f683a25: could make this a `uint` or check that it's positive (though `at(pos)` would catch a negative value too).",
      "commit_id" : "e8a4225fc235f93224215bd182a5f00e25527e3d",
      "created_at" : "2022-12-13T17:42:31Z",
      "diff_hunk" : "@@ -297,6 +299,69 @@ class ConstPubkeyProvider final : public PubkeyProvider\n     }\n };\n \n+/** An object representing a parsed list of pubkeys in a descriptor. */\n+class ListPubkeyProvider final : public PubkeyProvider\n+{\n+    std::vector<std::unique_ptr<PubkeyProvider>> m_pubkeys;\n+\n+public:\n+    ListPubkeyProvider(uint32_t exp_index, std::vector<std::unique_ptr<PubkeyProvider>> pubkeys) : PubkeyProvider(exp_index), m_pubkeys(std::move(pubkeys)) {}\n+    bool GetPubKey(int pos, const SigningProvider& arg, CPubKey& key, KeyOriginInfo& info, const DescriptorCache* read_cache = nullptr, DescriptorCache* write_cache = nullptr) const override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047510000",
      "id" : 1047510000,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-b7vw",
      "original_commit_id" : "8f4ee670b34d984a7d20d2e44d1d80bb8f683a25",
      "original_line" : 309,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1216068665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047510000/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T20:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047510000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047532624"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047532624"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8f4ee670b34d984a7d20d2e44d1d80bb8f683a25: Is this going to cause problems if compressed and uncompressed keys end up in a single descriptor? Maybe we should enforce keeping those separate (including when migrating from legacy)?",
      "commit_id" : "e8a4225fc235f93224215bd182a5f00e25527e3d",
      "created_at" : "2022-12-13T17:58:55Z",
      "diff_hunk" : "@@ -297,6 +299,69 @@ class ConstPubkeyProvider final : public PubkeyProvider\n     }\n };\n \n+/** An object representing a parsed list of pubkeys in a descriptor. */\n+class ListPubkeyProvider final : public PubkeyProvider\n+{\n+    std::vector<std::unique_ptr<PubkeyProvider>> m_pubkeys;\n+\n+public:\n+    ListPubkeyProvider(uint32_t exp_index, std::vector<std::unique_ptr<PubkeyProvider>> pubkeys) : PubkeyProvider(exp_index), m_pubkeys(std::move(pubkeys)) {}\n+    bool GetPubKey(int pos, const SigningProvider& arg, CPubKey& key, KeyOriginInfo& info, const DescriptorCache* read_cache = nullptr, DescriptorCache* write_cache = nullptr) const override\n+    {\n+        if ((size_t)pos >= m_pubkeys.size()) {\n+            return false;\n+        }\n+        return m_pubkeys.at(pos)->GetPubKey(0, arg, key, info, read_cache, write_cache);\n+    }\n+    bool IsRange() const override { return true; }\n+    size_t GetSize() const override\n+    {\n+        return std::accumulate(\n+            m_pubkeys.begin(), m_pubkeys.end(),\n+            0,\n+            [](const size_t acc, const std::unique_ptr<PubkeyProvider>& pubkey) {\n+                return std::max(acc, pubkey->GetSize());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047532624",
      "id" : 1047532624,
      "line" : 323,
      "node_id" : "PRRC_kwDOABII584-cBRQ",
      "original_commit_id" : "8f4ee670b34d984a7d20d2e44d1d80bb8f683a25",
      "original_line" : 323,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 62,
      "pull_request_review_id" : 1216068665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047532624/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T20:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047532624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047730810"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047730810"
         }
      },
      "author_association" : "MEMBER",
      "body" : "70189d9eee477c823ced260b746ef95e4093a4fa Why are `RANGE | DERIVE_HARDENED` set?",
      "commit_id" : "e8a4225fc235f93224215bd182a5f00e25527e3d",
      "created_at" : "2022-12-13T20:49:06Z",
      "diff_hunk" : "@@ -450,6 +458,11 @@ BOOST_AUTO_TEST_CASE(descriptor_test)\n     CheckUnparsable(\"sh(sh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))\", \"sh(sh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))\", \"Can only have sh() at top level\"); // Cannot embed P2SH inside P2SH\n     CheckUnparsable(\"wsh(wsh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))\", \"wsh(wsh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))\", \"Can only have wsh() at top level or inside sh()\"); // Cannot embed P2WSH inside P2WSH\n \n+    // Using list of keys expression\n+    Check(\"pkh({L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGNz6YCCQtYvFzMtrC6D3tKTKdBBboMrLTsjr2NYVBwapCkn7Mr})\", \"pkh({03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600})\", \"pkh({03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600})\", RANGE | DERIVE_HARDENED | SIGNABLE, {{\"76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac\"}, {\"76a914a48e80ddd68b1a9ac7b3bdf028b00a1dbf5e450388ac\"}}, OutputType::LEGACY, {{}, {}});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047730810",
      "id" : 1047730810,
      "line" : 462,
      "node_id" : "PRRC_kwDOABII584-cxp6",
      "original_commit_id" : "70189d9eee477c823ced260b746ef95e4093a4fa",
      "original_line" : 462,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 73,
      "pull_request_review_id" : 1216068665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047730810/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T20:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047730810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047748783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047748783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If there are mixed compressed and uncompressed keys in the list, then this will always use the uncompressed size, which may result in overestimating the size. I think this will only be used by miniscript though.",
      "commit_id" : "e8a4225fc235f93224215bd182a5f00e25527e3d",
      "created_at" : "2022-12-13T21:05:19Z",
      "diff_hunk" : "@@ -297,6 +299,69 @@ class ConstPubkeyProvider final : public PubkeyProvider\n     }\n };\n \n+/** An object representing a parsed list of pubkeys in a descriptor. */\n+class ListPubkeyProvider final : public PubkeyProvider\n+{\n+    std::vector<std::unique_ptr<PubkeyProvider>> m_pubkeys;\n+\n+public:\n+    ListPubkeyProvider(uint32_t exp_index, std::vector<std::unique_ptr<PubkeyProvider>> pubkeys) : PubkeyProvider(exp_index), m_pubkeys(std::move(pubkeys)) {}\n+    bool GetPubKey(int pos, const SigningProvider& arg, CPubKey& key, KeyOriginInfo& info, const DescriptorCache* read_cache = nullptr, DescriptorCache* write_cache = nullptr) const override\n+    {\n+        if ((size_t)pos >= m_pubkeys.size()) {\n+            return false;\n+        }\n+        return m_pubkeys.at(pos)->GetPubKey(0, arg, key, info, read_cache, write_cache);\n+    }\n+    bool IsRange() const override { return true; }\n+    size_t GetSize() const override\n+    {\n+        return std::accumulate(\n+            m_pubkeys.begin(), m_pubkeys.end(),\n+            0,\n+            [](const size_t acc, const std::unique_ptr<PubkeyProvider>& pubkey) {\n+                return std::max(acc, pubkey->GetSize());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047748783",
      "id" : 1047748783,
      "in_reply_to_id" : 1047532624,
      "line" : 323,
      "node_id" : "PRRC_kwDOABII584-c2Cv",
      "original_commit_id" : "8f4ee670b34d984a7d20d2e44d1d80bb8f683a25",
      "original_line" : 323,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 62,
      "pull_request_review_id" : 1216420758,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047748783/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T21:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047748783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047750293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047750293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`RANGE` to do the range tests, `DERIVE_HARDENED` to avoid the xpub cache checks.",
      "commit_id" : "e8a4225fc235f93224215bd182a5f00e25527e3d",
      "created_at" : "2022-12-13T21:06:42Z",
      "diff_hunk" : "@@ -450,6 +458,11 @@ BOOST_AUTO_TEST_CASE(descriptor_test)\n     CheckUnparsable(\"sh(sh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))\", \"sh(sh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))\", \"Can only have sh() at top level\"); // Cannot embed P2SH inside P2SH\n     CheckUnparsable(\"wsh(wsh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)))\", \"wsh(wsh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))\", \"Can only have wsh() at top level or inside sh()\"); // Cannot embed P2WSH inside P2WSH\n \n+    // Using list of keys expression\n+    Check(\"pkh({L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1,KzoAz5CanayRKex3fSLQ2BwJpN7U52gZvxMyk78nDMHuqrUxuSJy,KwGNz6YCCQtYvFzMtrC6D3tKTKdBBboMrLTsjr2NYVBwapCkn7Mr})\", \"pkh({03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600})\", \"pkh({03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd,03669b8afcec803a0d323e9a17f3ea8e68e8abe5a278020a929adbec52421adbd0,0260b2003c386519fc9eadf2b5cf124dd8eea4c4e68d5e154050a9346ea98ce600})\", RANGE | DERIVE_HARDENED | SIGNABLE, {{\"76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac\"}, {\"76a914a48e80ddd68b1a9ac7b3bdf028b00a1dbf5e450388ac\"}}, OutputType::LEGACY, {{}, {}});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047750293",
      "id" : 1047750293,
      "in_reply_to_id" : 1047730810,
      "line" : 462,
      "node_id" : "PRRC_kwDOABII584-c2aV",
      "original_commit_id" : "70189d9eee477c823ced260b746ef95e4093a4fa",
      "original_line" : 462,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 73,
      "pull_request_review_id" : 1216422320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047750293/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T21:06:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047750293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047761622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047761622"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a commit that does that.",
      "commit_id" : "e8a4225fc235f93224215bd182a5f00e25527e3d",
      "created_at" : "2022-12-13T21:19:01Z",
      "diff_hunk" : "@@ -297,6 +299,69 @@ class ConstPubkeyProvider final : public PubkeyProvider\n     }\n };\n \n+/** An object representing a parsed list of pubkeys in a descriptor. */\n+class ListPubkeyProvider final : public PubkeyProvider\n+{\n+    std::vector<std::unique_ptr<PubkeyProvider>> m_pubkeys;\n+\n+public:\n+    ListPubkeyProvider(uint32_t exp_index, std::vector<std::unique_ptr<PubkeyProvider>> pubkeys) : PubkeyProvider(exp_index), m_pubkeys(std::move(pubkeys)) {}\n+    bool GetPubKey(int pos, const SigningProvider& arg, CPubKey& key, KeyOriginInfo& info, const DescriptorCache* read_cache = nullptr, DescriptorCache* write_cache = nullptr) const override",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26626#discussion_r1047761622",
      "id" : 1047761622,
      "in_reply_to_id" : 1047510000,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584-c5LW",
      "original_commit_id" : "8f4ee670b34d984a7d20d2e44d1d80bb8f683a25",
      "original_line" : 309,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1216438071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26626",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047761622/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-13T21:19:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1047761622",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
