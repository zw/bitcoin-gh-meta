[
   {
      "body" : "tentative concept ACK, once-over utACK (not in depth)\r\n\r\nAs discussed on IRC, the trade offs [currently] are API compatibility (how invasive the change is) and the complexity of the change to achieve the desired memory/performance characteristics.",
      "created_at" : "2015-10-30T02:56:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152396846",
      "id" : 152396846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T02:58:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152396846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Concept ACK.\r\n23% less memory and 13% faster seems after a reason for doing a such change. Hows the performance boost biased through disabled verification, what performance benefit would be expected \"in normal operation\"?",
      "created_at" : "2015-10-30T08:03:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152454323",
      "id" : 152454323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T08:03:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152454323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@sipa Not sure why you'd consider this controversial. Seems like a big win to me.",
      "created_at" : "2015-10-30T08:17:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152457379",
      "id" : 152457379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T08:17:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152457379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   },
   {
      "body" : "@jonasschnelli well, disabled should (eventually) be representative of initial sync impact... runtime impact is a bit harder to measure, I expect, because it will depend greatly on the signature cache. When the hitrate is high I expect it to be closer to these figures, and when it's low... the signature validation would dwarf this improvement.\r\n\r\n@btcdrak because it's hard to review, if it weren't such a big improvement in speed/memory it wouldn't be worth considering.",
      "created_at" : "2015-10-30T09:21:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152467955",
      "id" : 152467955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T09:21:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152467955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "This is a standard technique for vectors.  I don't find it controversial.  concept ACK\r\n",
      "created_at" : "2015-10-30T12:59:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152516643",
      "id" : 152516643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T12:59:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152516643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@gmaxwell Understood, but I was meaning, if there is clearly such a benefit, it makes it uncontroversial to me.\r\n\r\nAnyway, Concept ACK, will try to review this weekend.",
      "created_at" : "2015-10-30T13:43:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152529431",
      "id" : 152529431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T13:43:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152529431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   },
   {
      "body" : "@jgarzik Controversial to go change such a widely used consensus data\nstructure.\n",
      "created_at" : "2015-10-30T16:07:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152567528",
      "id" : 152567528,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-10-30T16:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152567528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I like the speedup. I do think it introduces a lot of somewhat hard to review code, and by sake of being part of CScript it becomes part of the consensus code.\r\n\r\nAt some point we should separate how scripts are allocated/stored, which is not consensus critical, from the code used to evaluate them, which is consensus critical, but could act on any slice of memory.\r\n",
      "created_at" : "2015-11-02T03:11:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152899693",
      "id" : 152899693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-02T03:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152899693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Yes, absolutely! That would also help building types that use arena\nstorage for scripts (like one single allocation arena for a CCoins, a\nCTransaction, or even a whole CBlock).\n\nI would of course like to see this change in before that time, but feel\nfree to demand better comments and/or tests if not considered sufficient.\n",
      "created_at" : "2015-11-02T03:21:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-152901902",
      "id" : 152901902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-02T03:21:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152901902",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Not sure if you were aware and/or based your work on this, but the \"dynarray\"  was proposed for c++14, but didn't make it.\r\n\r\nhttp://en.cppreference.com/w/cpp/container/dynarray\r\n\r\nI only mention because using a reference implementation of that may ease the minds of reviewers.",
      "created_at" : "2015-11-04T05:51:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-153585385",
      "id" : 153585385,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-04T05:51:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/153585385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "@cfields: dynarray is very different\n* It still allocates everything on the heap\n* Its size is fixed, so it doesn't behave like a vector, but like an array\n",
      "created_at" : "2015-11-04T06:03:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-153587530",
      "id" : 153587530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-04T06:03:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/153587530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa ah sorry, I see. That's what i get for skimming.",
      "created_at" : "2015-11-04T06:46:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-153603072",
      "id" : 153603072,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-04T06:46:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/153603072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "This is a huge speedup, and tests clean in valgrind.  For reindex w/ libsecp256k1 this takes the time down from 3 hours 16 minutes to 2 hours 7 minutes.  (With signature tests disabled completely this gets it down to 1h 17m.).  Size of the UTXO set in memory is reduced from 5486MB to 4012MB. \r\n\r\nI intend to test this further, but I support this, and it looks generally okay to me. I'm surprised we got this much improvement just for cscript, I was expecting we'd have to make the entire cached transaction a single allocation to see this kind of benefit.\r\n",
      "created_at" : "2015-11-06T23:34:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-154577119",
      "id" : 154577119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-06T23:34:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154577119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "> I was expecting we'd have to make the entire cached transaction a single allocation to see this kind of benefit. \r\n\r\nWhy isn't that the case OOI?  I feel like CScript could just be 2 pointers, `begin` and `end`?\r\n\r\n**edit**: Is `CScript` really mutated that often?",
      "created_at" : "2015-11-07T01:19:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-154594512",
      "id" : 154594512,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-07T01:19:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154594512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Inside the coins cache the whole entry gets mutated, e.g. to delete outputs when they're spent... but never in a way which needs to increase their size. The cscripts themselves in these entries are never mutated at all.\r\n\r\nThe mutation that decreases the entry size could be addressed by flagging their deletion, and a separate operation which compacts the coins cache (e.g. takes txouts which many deleted entries and packs then reallocs them to a smaller size)-- e.g. it could be run on flush (which scans for modified entries) as well as periodically when flusing is infrequent (e.g. db cache set to infinity), perhaps triggered by an overhead counter (which would be cheap to maintain).  This would eliminate quite a few more malloc operations and further reduce fragmentation; but I suspect it would be a much bigger change than just changing the type of cscripts.\r\n\r\n",
      "created_at" : "2015-11-07T01:30:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-154595510",
      "id" : 154595510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-07T01:30:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154595510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "> This would eliminate quite a few more malloc operations and further reduce fragmentation; but I suspect it would be a much bigger change than just changing the type of cscripts.\r\n\r\nIndeed, as discussed with @sipa originally, the biggest benefit about this change is how isolated it is,  it just hot swaps an existing interface,  while netting a huge performance increase.",
      "created_at" : "2015-11-07T01:44:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-154596535",
      "id" : 154596535,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-07T01:44:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154596535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Added some comments.",
      "created_at" : "2015-11-07T02:39:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-154601897",
      "id" : 154601897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-07T02:39:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154601897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@dcousens CScript is hardly ever mutated. But CCoins which contains a vector of CTxouts, which contain a CScript is mutated often. The proposal is to make CCoins allocate its entire memory (including several CScripts) at once.",
      "created_at" : "2015-11-08T00:14:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-154766808",
      "id" : 154766808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-08T00:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154766808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Added a few more iterator tests (which caught (compile-time) errors), and removed the [WIP] marker.",
      "created_at" : "2015-11-13T17:24:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-156493636",
      "id" : 156493636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-13T17:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156493636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Do we want this for 0.12?",
      "created_at" : "2015-11-28T13:16:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-160295224",
      "id" : 160295224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-28T13:16:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160295224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I think so, it's a large performance improvement and memory usage reduction.",
      "created_at" : "2015-11-28T14:09:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-160300274",
      "id" : 160300274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-28T14:09:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160300274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "ACK for 0.12",
      "created_at" : "2015-11-30T03:49:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-160509135",
      "id" : 160509135,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-30T03:49:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160509135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "I'd prefer to merge a large, reasonably risky change like this after 0.12 branch, but if you are confident enough about this, I'm ok with it.\r\n",
      "created_at" : "2015-11-30T11:30:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6914#issuecomment-160605463",
      "id" : 160605463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6914",
      "updated_at" : "2015-11-30T11:30:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160605463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
