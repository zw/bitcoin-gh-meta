[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this should use the same script.",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T14:50:14Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022808",
      "id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMjgwOA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022808",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add braces here and throughout.",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T14:50:31Z",
      "diff_hunk" : "@@ -343,6 +343,89 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    if (::IsMine(*pwallet, script) == ISMINE_SPENDABLE)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022912",
      "id" : 246022912,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMjkxMg==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 7,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022912",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246023468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246023468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe submit this change in a separate PR.",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T14:52:08Z",
      "diff_hunk" : "@@ -947,7 +971,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246023468",
      "id" : 246023468,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMzQ2OA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 39,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246023468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246052520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246052520"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, that makes a lot of sense now that you point that out, however, I have no idea what I'd name that. Any ideas?",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T16:01:56Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246052520",
      "id" : 246052520,
      "in_reply_to_id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA1MjUyMA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190314269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246052520",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Split into 2 PRs, check #15130",
      "created_at" : "2019-01-08T16:31:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452362966",
      "id" : 452362966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjM2Mjk2Ng==",
      "updated_at" : "2019-01-08T16:31:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452362966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246065849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246065849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe remove notification? This is only happens after the RPC so the client doesn't need a notification.",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T16:36:36Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246065849",
      "id" : 246065849,
      "in_reply_to_id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA2NTg0OQ==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190331916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246065849",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246073751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246073751"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah that's true",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T16:57:07Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246073751",
      "id" : 246073751,
      "in_reply_to_id" : 246022808,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA3Mzc1MQ==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_position" : 17,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190342176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246073751",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246204244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246204244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This looks a bit invasive.\r\nI haven't looked closer at it, but would it not be possible to remove transaction with the removed addresses during `LoadToWallet()` rather then an expansive rescan?",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-08T23:35:58Z",
      "diff_hunk" : "@@ -947,7 +963,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246204244",
      "id" : 246204244,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjIwNDI0NA==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190507249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246204244",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not opposed against removing scripts. But maybe combining with `importmulti` for more advanced script removing and batches would eventually make sense.",
      "created_at" : "2019-01-08T23:36:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452491378",
      "id" : 452491378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjQ5MTM3OA==",
      "updated_at" : "2019-01-08T23:36:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452491378",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246537640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246537640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Drop this line :-)",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-09T20:49:19Z",
      "diff_hunk" : "@@ -343,6 +343,102 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = ::IsMine(*pwallet, script);\n+    if (ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address\");\n+    }\n+\n+    pwallet->MarkDirty();\n+\n+    if (pwallet->HaveWatchOnly(script) && !pwallet->RemoveWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address from wallet\");\n+    }\n+    \n+    CTxDestination destination;\n+    if (ExtractDestination(script, destination)) {\n+        pwallet->DelAddressBook(destination);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    CWallet* const pwallet = wallet.get();\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n+        throw std::runtime_error(\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, /* opt */ false, /* default_val */ \"\", \"The Bitcoin address\"},\n+                    {\"rescan\", RPCArg::Type::BOOL, /* opt */ true, /* default_val */ \"true\", \"Rescan the wallet for transactions\"},\n+                }}\n+                .ToString() +\n+            \"\\nNote: This call can take over an hour to complete if rescan is true, during that time, other rpc calls\\n\"\n+            \"may report that the removed address exists but related transactions are still missing, leading to temporarily incorrect/bogus balances and unspent outputs until rescan completes.\\n\"\n+            \"\\nExamples:\\n\"\n+            \"\\nRemove an address with rescan\\n\"\n+            + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nRemove an address without rescan\\n\"\n+            + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\" false\") +\n+            \"\\nAs a JSON-RPC call\\n\"\n+            + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\", false\")\n+        );\n+\n+    // Whether to perform rescan after import\n+    bool fRescan = true;\n+    if (!request.params[1].isNull()) {\n+        fRescan = request.params[1].get_bool();\n+    }\n+\n+    if (fRescan && fPruneMode) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+    }\n+\n+    WalletRescanReserver reserver(pwallet);\n+    if (fRescan && !reserver.reserve()) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Wallet is currently rescanning. Abort existing rescan or wait.\");\n+    }\n+\n+    {\n+        auto locked_chain = pwallet->chain().lock();\n+        LOCK(pwallet->cs_wallet);\n+\n+        CTxDestination dest = DecodeDestination(request.params[0].get_str());\n+        if (IsValidDestination(dest)) {\n+            RemoveAddress(pwallet, dest);\n+        }\n+        else {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Bitcoin address\");\n+        }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246537640",
      "id" : 246537640,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjUzNzY0MA==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_position" : 90,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 190931771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246537640",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#9381](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/9381.html) (Remove CWalletTx merging logic from AddToWallet by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-09T22:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452898412",
      "id" : 452898412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1Mjg5ODQxMg==",
      "updated_at" : "2019-01-15T18:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452898412",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246623943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246623943"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Without this, it will remove the balance and addresses from the wallets but it will leave all the transactions with their ids in the wallet so with this function it will remove them from the wallet during the rescan.  I am not sure if there is a faster way to do it.",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-10T03:04:49Z",
      "diff_hunk" : "@@ -947,7 +963,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246623943",
      "id" : 246623943,
      "in_reply_to_id" : 246204244,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjYyMzk0Mw==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 191034643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246623943",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246645536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246645536"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see the reason why a rescan would be required. IMO it's only required after adding a script where its creation-timestamp lies in the past (expected historical transactions). You don't need to go through the whole (or part of) the blockchain history just to know that a transaction in your wallet doesn't belong to you anymore. Also, don't forget that rescans are incompatible for pruned peers.\r\n\r\nIt should be sufficient to loop though `mapWallet` and remove transactions that are no longer `IsMine(tx) || IsFromMe(tx)` (after the deletion of one or many scripts/addresses).",
      "commit_id" : "f49c5232016bc6dfd48fbb24d236c2ec8cb860d4",
      "created_at" : "2019-01-10T06:15:00Z",
      "diff_hunk" : "@@ -947,7 +963,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246645536",
      "id" : 246645536,
      "in_reply_to_id" : 246204244,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjY0NTUzNg==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_position" : 31,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 191060664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-01-12T00:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246645536",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added functionality to remove scripts as well",
      "created_at" : "2019-01-12T00:08:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-453696884",
      "id" : 453696884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MzY5Njg4NA==",
      "updated_at" : "2019-01-12T00:08:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/453696884",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks much better!\r\nWill test soon.",
      "created_at" : "2019-01-12T00:15:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-453698299",
      "id" : 453698299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MzY5ODI5OQ==",
      "updated_at" : "2019-01-12T00:15:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/453698299",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
