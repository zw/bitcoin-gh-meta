[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022808"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this should use the same script.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T14:50:14Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022808",
      "id" : 246022808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMjgwOA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_line" : 892,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022912"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add braces here and throughout.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T14:50:31Z",
      "diff_hunk" : "@@ -343,6 +343,89 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    if (::IsMine(*pwallet, script) == ISMINE_SPENDABLE)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246022912",
      "id" : 246022912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMjkxMg==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_line" : 349,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246022912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246023468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246023468"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe submit this change in a separate PR.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T14:52:08Z",
      "diff_hunk" : "@@ -947,7 +971,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246023468",
      "id" : 246023468,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjAyMzQ2OA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_line" : 969,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190275992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246023468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246052520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246052520"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, that makes a lot of sense now that you point that out, however, I have no idea what I'd name that. Any ideas?",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T16:01:56Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246052520",
      "id" : 246052520,
      "in_reply_to_id" : 246022808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA1MjUyMA==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_line" : 892,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190314269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246052520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Split into 2 PRs, check #15130",
      "created_at" : "2019-01-08T16:31:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452362966",
      "id" : 452362966,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjM2Mjk2Ng==",
      "updated_at" : "2019-01-08T16:31:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452362966",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246065849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246065849"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe remove notification? This is only happens after the RPC so the client doesn't need a notification.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T16:36:36Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246065849",
      "id" : 246065849,
      "in_reply_to_id" : 246022808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA2NTg0OQ==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_line" : 892,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190331916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246065849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246073751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246073751"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah that's true",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T16:57:07Z",
      "diff_hunk" : "@@ -875,6 +875,30 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n     return true;\n }\n \n+bool CWallet::RemoveFromWallet(const CTransaction& tx)\n+{\n+    LOCK(cs_wallet);\n+\n+    if (!WalletBatch(*database).EraseTx(tx.GetHash()))\n+        return false;\n+\n+    WalletLogPrintf(\"RemoveFromWallet %s\\n\", tx.GetHash().ToString());\n+\n+    // Notify UI of new or updated transaction\n+    NotifyTransactionChanged(this, tx.GetHash(), CT_DELETED);\n+\n+    // Notify an external script when a wallet transaction comes in or is updated\n+    std::string strCmd = gArgs.GetArg(\"-walletnotify\", \"\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246073751",
      "id" : 246073751,
      "in_reply_to_id" : 246022808,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjA3Mzc1MQ==",
      "original_commit_id" : "c6e9bca890bcfbe25bacec17a5cebb10dc677519",
      "original_line" : 892,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190342176,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246073751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246204244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246204244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This looks a bit invasive.\r\nI haven't looked closer at it, but would it not be possible to remove transaction with the removed addresses during `LoadToWallet()` rather then an expansive rescan?",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-08T23:35:58Z",
      "diff_hunk" : "@@ -947,7 +963,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246204244",
      "id" : 246204244,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjIwNDI0NA==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_line" : 969,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 190507249,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246204244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not opposed against removing scripts. But maybe combining with `importmulti` for more advanced script removing and batches would eventually make sense.",
      "created_at" : "2019-01-08T23:36:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452491378",
      "id" : 452491378,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjQ5MTM3OA==",
      "updated_at" : "2019-01-08T23:36:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452491378",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246537640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246537640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Drop this line :-)",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-09T20:49:19Z",
      "diff_hunk" : "@@ -343,6 +343,102 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = ::IsMine(*pwallet, script);\n+    if (ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address\");\n+    }\n+\n+    pwallet->MarkDirty();\n+\n+    if (pwallet->HaveWatchOnly(script) && !pwallet->RemoveWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address from wallet\");\n+    }\n+    \n+    CTxDestination destination;\n+    if (ExtractDestination(script, destination)) {\n+        pwallet->DelAddressBook(destination);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    CWallet* const pwallet = wallet.get();\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() < 1 || request.params.size() > 2)\n+        throw std::runtime_error(\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, /* opt */ false, /* default_val */ \"\", \"The Bitcoin address\"},\n+                    {\"rescan\", RPCArg::Type::BOOL, /* opt */ true, /* default_val */ \"true\", \"Rescan the wallet for transactions\"},\n+                }}\n+                .ToString() +\n+            \"\\nNote: This call can take over an hour to complete if rescan is true, during that time, other rpc calls\\n\"\n+            \"may report that the removed address exists but related transactions are still missing, leading to temporarily incorrect/bogus balances and unspent outputs until rescan completes.\\n\"\n+            \"\\nExamples:\\n\"\n+            \"\\nRemove an address with rescan\\n\"\n+            + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nRemove an address without rescan\\n\"\n+            + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\" false\") +\n+            \"\\nAs a JSON-RPC call\\n\"\n+            + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\", false\")\n+        );\n+\n+    // Whether to perform rescan after import\n+    bool fRescan = true;\n+    if (!request.params[1].isNull()) {\n+        fRescan = request.params[1].get_bool();\n+    }\n+\n+    if (fRescan && fPruneMode) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan is disabled in pruned mode\");\n+    }\n+\n+    WalletRescanReserver reserver(pwallet);\n+    if (fRescan && !reserver.reserve()) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Wallet is currently rescanning. Abort existing rescan or wait.\");\n+    }\n+\n+    {\n+        auto locked_chain = pwallet->chain().lock();\n+        LOCK(pwallet->cs_wallet);\n+\n+        CTxDestination dest = DecodeDestination(request.params[0].get_str());\n+        if (IsValidDestination(dest)) {\n+            RemoveAddress(pwallet, dest);\n+        }\n+        else {\n+            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Bitcoin address\");\n+        }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246537640",
      "id" : 246537640,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjUzNzY0MA==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_line" : 432,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 190931771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246537640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22788](https://github.com/bitcoin/bitcoin/pull/22788) (scripted-diff: Use generate* from TestFramework by MarcoFalke)\n* [#21206](https://github.com/bitcoin/bitcoin/pull/21206) (refactor: Make CWalletTx sync state type-safe by ryanofsky)\n* [#20591](https://github.com/bitcoin/bitcoin/pull/20591) (wallet, bugfix: fix ComputeTimeSmart function during rescanning process. by BitcoinTsunami)\n* [#20096](https://github.com/bitcoin/bitcoin/pull/20096) (wallet: Remove WalletDatabase refcounting and enforce only one Batch access the database at a time by achow101)\n* [#17526](https://github.com/bitcoin/bitcoin/pull/17526) (Add Single Random Draw as an additional coin selection algorithm by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-01-09T22:47:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-452898412",
      "id" : 452898412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1Mjg5ODQxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-04T23:54:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452898412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246623943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246623943"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Without this, it will remove the balance and addresses from the wallets but it will leave all the transactions with their ids in the wallet so with this function it will remove them from the wallet during the rescan.  I am not sure if there is a faster way to do it.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-10T03:04:49Z",
      "diff_hunk" : "@@ -947,7 +963,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246623943",
      "id" : 246623943,
      "in_reply_to_id" : 246204244,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjYyMzk0Mw==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_line" : 969,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 191034643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246623943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246645536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246645536"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't see the reason why a rescan would be required. IMO it's only required after adding a script where its creation-timestamp lies in the past (expected historical transactions). You don't need to go through the whole (or part of) the blockchain history just to know that a transaction in your wallet doesn't belong to you anymore. Also, don't forget that rescans are incompatible for pruned peers.\r\n\r\nIt should be sufficient to loop though `mapWallet` and remove transactions that are no longer `IsMine(tx) || IsFromMe(tx)` (after the deletion of one or many scripts/addresses).",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-01-10T06:15:00Z",
      "diff_hunk" : "@@ -947,7 +963,10 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n             if (pIndex != nullptr)\n                 wtx.SetMerkleBranch(pIndex, posInBlock);\n \n-            return AddToWallet(wtx, false);\n+            if (IsMine(tx) || IsFromMe(tx))\n+                return AddToWallet(wtx, false);\n+\n+            return RemoveFromWallet(tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r246645536",
      "id" : 246645536,
      "in_reply_to_id" : 246204244,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NjY0NTUzNg==",
      "original_commit_id" : "a3a12335264d88ec2d6ccfe41ad93c0a26c62eea",
      "original_line" : 969,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 191060664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/246645536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added functionality to remove scripts as well",
      "created_at" : "2019-01-12T00:08:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-453696884",
      "id" : 453696884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MzY5Njg4NA==",
      "updated_at" : "2019-01-12T00:08:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/453696884",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks much better!\r\nWill test soon.",
      "created_at" : "2019-01-12T00:15:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-453698299",
      "id" : 453698299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MzY5ODI5OQ==",
      "updated_at" : "2019-01-12T00:15:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/453698299",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@benthecarman could you address [Travis linter failure](https://travis-ci.org/bitcoin/bitcoin/jobs/478599787)?",
      "created_at" : "2019-01-16T20:48:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-454934756",
      "id" : 454934756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDkzNDc1Ng==",
      "updated_at" : "2019-01-16T20:48:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454934756",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Added release notes",
      "created_at" : "2019-01-17T19:52:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-455309384",
      "id" : 455309384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NTMwOTM4NA==",
      "updated_at" : "2019-01-17T19:52:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455309384",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and fixed release notes",
      "created_at" : "2019-02-04T11:42:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-460218860",
      "id" : 460218860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDIxODg2MA==",
      "updated_at" : "2019-02-04T11:42:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460218860",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could trailing whitespaces be removed?\r\nSee Travis log: https://travis-ci.org/bitcoin/bitcoin/jobs/488455534",
      "created_at" : "2019-02-04T11:55:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-460222103",
      "id" : 460222103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDIyMjEwMw==",
      "updated_at" : "2019-02-04T11:56:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460222103",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@hebasto Sorry about that, fixed",
      "created_at" : "2019-02-04T12:15:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-460228459",
      "id" : 460228459,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDIyODQ1OQ==",
      "updated_at" : "2019-02-04T12:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460228459",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314394732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314394732"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did you mean \"Remove\" instead of \"Add\"?",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-08-15T16:35:26Z",
      "diff_hunk" : "@@ -350,6 +350,98 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = ::IsMine(*pwallet, script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    assert(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    if (pwallet->HaveWatchOnly(script) && !pwallet->RemoveWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript){\n+        const CScriptID id(script);\n+        if (!pwallet->HaveCScript(id)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, id);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+    pwallet->RemoveOldTransactions();\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    CWallet* const pwallet = wallet.get();\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1)\n+        throw std::runtime_error(\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, /* opt */ false, /* default_val */ \"\", \"The Bitcoin address (or hex-encoded script)\"},\n+                    {\"p2sh\", RPCArg::Type::BOOL, /* opt */ true, /* default_val */ \"false\", \"Add the P2SH version of the script as well\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314394732",
      "id" : 314394732,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM5NDczMg==",
      "original_commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "original_line" : 406,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 275537287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314394732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314395873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314395873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is too broad. Suggest adding an additional condition that the to be deleted transaction is to or from the specific watch-only address we're removing.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-08-15T16:38:31Z",
      "diff_hunk" : "@@ -938,6 +938,25 @@ void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n     }\n }\n \n+void CWallet::RemoveOldTransactions()\n+{\n+    AssertLockHeld(cs_wallet);\n+\n+    std::vector<CWalletTx> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        CWalletTx tx = it->second;\n+        if (!IsFromMe(*tx.tx) && !IsMine(*tx.tx)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314395873",
      "id" : 314395873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM5NTg3Mw==",
      "original_commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "original_line" : 948,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 275537287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314395873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314396254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314396254"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Suggest adding a third argument `purge_transactions` (default true) about removing existing transactions from the wallet. ",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2019-08-15T16:39:37Z",
      "diff_hunk" : "@@ -350,6 +350,98 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = ::IsMine(*pwallet, script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    assert(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    if (pwallet->HaveWatchOnly(script) && !pwallet->RemoveWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript){\n+        const CScriptID id(script);\n+        if (!pwallet->HaveCScript(id)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, id);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+    pwallet->RemoveOldTransactions();\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    CWallet* const pwallet = wallet.get();\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() != 1)\n+        throw std::runtime_error(\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, /* opt */ false, /* default_val */ \"\", \"The Bitcoin address (or hex-encoded script)\"},\n+                    {\"p2sh\", RPCArg::Type::BOOL, /* opt */ true, /* default_val */ \"false\", \"Add the P2SH version of the script as well\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314396254",
      "id" : 314396254,
      "in_reply_to_id" : 314394732,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDM5NjI1NA==",
      "original_commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "original_line" : 406,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 275537287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314396254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314983574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314983574"
         }
      },
      "author_association" : "NONE",
      "body" : "Hi",
      "commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "created_at" : "2019-08-18T12:36:30Z",
      "diff_hunk" : "@@ -938,6 +938,25 @@ void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n     }\n }\n \n+void CWallet::RemoveOldTransactions()\n+{\n+    AssertLockHeld(cs_wallet);\n+\n+    std::vector<CWalletTx> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        CWalletTx tx = it->second;\n+        if (!IsFromMe(*tx.tx) && !IsMine(*tx.tx)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314983574",
      "id" : 314983574,
      "in_reply_to_id" : 314395873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDk4MzU3NA==",
      "original_commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "original_position" : 11,
      "path" : "src/wallet/wallet.cpp",
      "position" : 11,
      "pull_request_review_id" : 276276429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-08-18T12:36:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314983574",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/52591039?v=4",
         "events_url" : "https://api.github.com/users/Mine8801/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Mine8801/followers",
         "following_url" : "https://api.github.com/users/Mine8801/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Mine8801/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Mine8801",
         "id" : 52591039,
         "login" : "Mine8801",
         "node_id" : "MDQ6VXNlcjUyNTkxMDM5",
         "organizations_url" : "https://api.github.com/users/Mine8801/orgs",
         "received_events_url" : "https://api.github.com/users/Mine8801/received_events",
         "repos_url" : "https://api.github.com/users/Mine8801/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Mine8801/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Mine8801/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Mine8801"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314983677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314983677"
         }
      },
      "author_association" : "NONE",
      "body" : "purge_transactions",
      "commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "created_at" : "2019-08-18T12:38:23Z",
      "diff_hunk" : "@@ -938,6 +938,25 @@ void CWallet::LoadToWallet(const CWalletTx& wtxIn)\n     }\n }\n \n+void CWallet::RemoveOldTransactions()\n+{\n+    AssertLockHeld(cs_wallet);\n+\n+    std::vector<CWalletTx> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        CWalletTx tx = it->second;\n+        if (!IsFromMe(*tx.tx) && !IsMine(*tx.tx)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r314983677",
      "id" : 314983677,
      "in_reply_to_id" : 314395873,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDk4MzY3Nw==",
      "original_commit_id" : "4c7d2b68b3d76de34b98f9c2dabc8a8fa678b09f",
      "original_position" : 11,
      "path" : "src/wallet/wallet.cpp",
      "position" : 11,
      "pull_request_review_id" : 276276522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "updated_at" : "2019-08-18T12:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314983677",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/52591039?v=4",
         "events_url" : "https://api.github.com/users/Mine8801/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Mine8801/followers",
         "following_url" : "https://api.github.com/users/Mine8801/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Mine8801/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Mine8801",
         "id" : 52591039,
         "login" : "Mine8801",
         "node_id" : "MDQ6VXNlcjUyNTkxMDM5",
         "organizations_url" : "https://api.github.com/users/Mine8801/orgs",
         "received_events_url" : "https://api.github.com/users/Mine8801/received_events",
         "repos_url" : "https://api.github.com/users/Mine8801/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Mine8801/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Mine8801/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Mine8801"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This has a silent merge conflict with master because RPCHelpMan syntax changed a bit.",
      "created_at" : "2019-09-03T17:54:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-527568402",
      "id" : 527568402,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyNzU2ODQwMg==",
      "updated_at" : "2019-09-03T17:54:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/527568402",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-09-05T14:10:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-528383087",
      "id" : 528383087,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyODM4MzA4Nw==",
      "updated_at" : "2019-09-05T14:10:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/528383087",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@benthecarman - it looks like Sjor's comments are still unaddressed and a rebase is needed. Is this still something you intend to continue with?",
      "created_at" : "2020-05-01T00:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-622196838",
      "id" : 622196838,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjE5NjgzOA==",
      "updated_at" : "2020-05-01T00:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622196838",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed for @Sjors's comments and rebased",
      "created_at" : "2020-05-04T03:23:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-623239713",
      "id" : 623239713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzIzOTcxMw==",
      "updated_at" : "2020-05-04T03:24:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623239713",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r419315899"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419315899"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this entire function commented out?",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-04T09:33:58Z",
      "diff_hunk" : "@@ -924,6 +924,42 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n     }\n }\n \n+void CWallet::RemoveOldTransactions(const CScript& script)\n+{\n+    // AssertLockHeld(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r419315899",
      "id" : 419315899,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxNTg5OQ==",
      "original_commit_id" : "c7e72e88b40f97a7c3a4c5c07a978bc2f54e6db9",
      "original_line" : 929,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 404834823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419315899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r419469301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419469301"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "woops, pushed wrong commit. Should be good now",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-04T14:15:39Z",
      "diff_hunk" : "@@ -924,6 +924,42 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n     }\n }\n \n+void CWallet::RemoveOldTransactions(const CScript& script)\n+{\n+    // AssertLockHeld(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r419469301",
      "id" : 419469301,
      "in_reply_to_id" : 419315899,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2OTMwMQ==",
      "original_commit_id" : "c7e72e88b40f97a7c3a4c5c07a978bc2f54e6db9",
      "original_line" : 929,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 405028616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419469301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425282738"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425282738"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is getting caught in the linter. Be sure the position of the argument is consistent with the dispatch table in rpcwallet.cpp (it isn't -- the index starts at 0).",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-14T16:45:28Z",
      "diff_hunk" : "@@ -128,6 +128,7 @@ static const CRPCConvertParam vRPCConvertParams[] =\n     { \"importprivkey\", 2, \"rescan\" },\n     { \"importaddress\", 2, \"rescan\" },\n     { \"importaddress\", 3, \"p2sh\" },\n+    { \"removeaddress\", 2, \"p2sh\" },",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425282738",
      "id" : 425282738,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI4MjczOA==",
      "original_commit_id" : "c91732604e33f25eb9b41e9a995a5d660974f7fc",
      "original_line" : 131,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/client.cpp",
      "position" : null,
      "pull_request_review_id" : 411993539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425282738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425290384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425290384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will be caught too as `CHECK_NONFATAL` is recommended instead of `assert` for rpc code.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-14T16:57:24Z",
      "diff_hunk" : "@@ -323,6 +323,110 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest, bool purgeTxs);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    assert(ismine == ISMINE_WATCH_ONLY || isRedeemScript);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425290384",
      "id" : 425290384,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI5MDM4NA==",
      "original_commit_id" : "c91732604e33f25eb9b41e9a995a5d660974f7fc",
      "original_line" : 335,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 411993539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425290384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425733491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425733491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `RemoveTransactions()` would be a better name, as this can remove any transactions, being \"old\" is not a requirement.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-15T11:16:19Z",
      "diff_hunk" : "@@ -924,6 +924,45 @@ void CWallet::LoadToWallet(CWalletTx& wtxIn)\n     }\n }\n \n+void CWallet::RemoveOldTransactions(const CScript& script)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425733491",
      "id" : 425733491,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTczMzQ5MQ==",
      "original_commit_id" : "c91732604e33f25eb9b41e9a995a5d660974f7fc",
      "original_line" : 927,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 412558175,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425733491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This would be a very usefull addition for me, I have a wallet with watch-only addresses imported that I would like to remove.",
      "created_at" : "2020-05-15T11:20:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-629180221",
      "id" : 629180221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTE4MDIyMQ==",
      "updated_at" : "2020-05-15T11:20:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629180221",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`RemoveOldTransactions()` got renamed to `RemoveTransactions()` but calling plance didn't get changed, so it doesn't build now.\r\n```\r\nwallet/rpcdump.cpp: In function void RemoveScript(CWallet*, const CScript&, bool, bool):\r\nwallet/rpcdump.cpp:356:18: error: class CWallet has no member named RemoveOldTransactions; did you mean RemoveTransactions?\r\n  356 |         pwallet->RemoveOldTransactions(script);\r\n      |                  ^~~~~~~~~~~~~~~~~~~~~\r\n      |                  RemoveTransactions\r\n```",
      "created_at" : "2020-05-15T15:19:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-629300605",
      "id" : 629300605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTMwMDYwNQ==",
      "updated_at" : "2020-05-15T15:19:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629300605",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> `RemoveOldTransactions()` got renamed to `RemoveTransactions()` but calling plance didn't get changed, so it doesn't build now.\r\n> \r\n> ```\r\n> wallet/rpcdump.cpp: In function void RemoveScript(CWallet*, const CScript&, bool, bool):\r\n> wallet/rpcdump.cpp:356:18: error: class CWallet has no member named RemoveOldTransactions; did you mean RemoveTransactions?\r\n>   356 |         pwallet->RemoveOldTransactions(script);\r\n>       |                  ^~~~~~~~~~~~~~~~~~~~~\r\n>       |                  RemoveTransactions\r\n> ```\r\n\r\nwoops, fixed now :) ",
      "created_at" : "2020-05-15T15:22:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-629303367",
      "id" : 629303367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTMwMzM2Nw==",
      "updated_at" : "2020-05-15T15:22:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629303367",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425910682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425910682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This line is not needed, results in a duplicate \"Examples:\" in help output.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-15T16:22:06Z",
      "diff_hunk" : "@@ -323,6 +323,110 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest, bool purgeTxs);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    auto spk_man = pwallet->GetLegacyScriptPubKeyMan();\n+\n+    if (spk_man->HaveWatchOnly(script) && !spk_man->RemoveWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man->HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    CWallet* const pwallet = wallet.get();\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+                    {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+                    {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+            \"\\nExamples:\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r425910682",
      "id" : 425910682,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkxMDY4Mg==",
      "original_commit_id" : "15ee30111042f24a0c11732d5a821289d12ff7b0",
      "original_line" : 387,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 412790288,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/425910682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@benthecarman CIs are still red since ad0de4c.",
      "created_at" : "2020-05-19T15:33:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-630900848",
      "id" : 630900848,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMDkwMDg0OA==",
      "updated_at" : "2020-05-19T15:33:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/630900848",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> @benthecarman CIs are still red since [ad0de4c](https://github.com/bitcoin/bitcoin/commit/ad0de4c639c215e334bc076c4bc2f6340f8f3a67).\r\n\r\nSorry, everything was passing locally, looks like it had silent merge conflicts with `master` again",
      "created_at" : "2020-05-20T01:23:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-631177933",
      "id" : 631177933,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMTE3NzkzMw==",
      "updated_at" : "2020-05-20T01:23:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631177933",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r431687314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431687314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Try this instead, to guarantee it only works for legacy wallets:\r\n```cpp\r\n    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\r\n```",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-05-28T09:01:03Z",
      "diff_hunk" : "@@ -323,6 +323,109 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination& dest, bool purgeTxs);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    auto spk_man = pwallet->GetLegacyScriptPubKeyMan();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r431687314",
      "id" : 431687314,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4NzMxNA==",
      "original_commit_id" : "8af899113f58b219c38f7f8eeeb13aad4ac3d6a5",
      "original_line" : 337,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 419913263,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431687314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are a few import scenarios where some scripts and pubkeys get left behind and that could cause `IsMine` issues. There will also be leftover `CKeyMetadata` entries. I think these will all need to be cleaned up.\r\n\r\nImporting any P2SH or P2WSH address with a redeemScript will add that redeemScript to `mapScripts`. If pubkeys were imported to the keypool, then those pubkeys are still in the keypool after `removeaddress`. Those need to be removed otherwise users could be sending money to an address that the wallet is no longer watching.",
      "created_at" : "2020-06-11T15:59:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-642769639",
      "id" : 642769639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Mjc2OTYzOQ==",
      "updated_at" : "2020-06-11T15:59:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642769639",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> There are a few import scenarios where some scripts and pubkeys get left behind and that could cause `IsMine` issues. There will also be leftover `CKeyMetadata` entries. I think these will all need to be cleaned up.\r\n> \r\n> Importing any P2SH or P2WSH address with a redeemScript will add that redeemScript to `mapScripts`. If pubkeys were imported to the keypool, then those pubkeys are still in the keypool after `removeaddress`. Those need to be removed otherwise users could be sending money to an address that the wallet is no longer watching.\r\n\r\nSounds like most of this needs to be fixed, however, do note this is only for watch only addresses. So, I don't believe we need to worry about the key pool.",
      "created_at" : "2020-06-12T00:02:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-642989241",
      "id" : 642989241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Mjk4OTI0MQ==",
      "updated_at" : "2020-06-12T00:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/642989241",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> however, do note this is only for watch only addresses. So, I don't believe we need to worry about the key pool.\r\n\r\n`importmulti` allows people to import address with their pubkeys and add the pubkeys into the keypool. The scriptPubKeys still end up in `setWatchOnly` and the pubkeys in `mapWatchKeys`, but also those pubkeys go in the keypool so that `getnewaddress` can work. Anything imported with those and then used with `removeaddress` would still have the pubkey in the keypool.",
      "created_at" : "2020-06-12T01:25:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-643013777",
      "id" : 643013777,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzAxMzc3Nw==",
      "updated_at" : "2020-06-12T01:25:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643013777",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> There are a few import scenarios where some scripts and pubkeys get left behind and that could cause `IsMine` issues. There will also be leftover `CKeyMetadata` entries. I think these will all need to be cleaned up.\r\n> \r\n> Importing any P2SH or P2WSH address with a redeemScript will add that redeemScript to `mapScripts`. If pubkeys were imported to the keypool, then those pubkeys are still in the keypool after `removeaddress`. Those need to be removed otherwise users could be sending money to an address that the wallet is no longer watching.\r\n\r\nI believe this is addressed now",
      "created_at" : "2020-06-14T21:57:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-643827543",
      "id" : 643827543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzgyNzU0Mw==",
      "updated_at" : "2020-06-14T21:57:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643827543",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed rebase issues",
      "created_at" : "2020-06-19T00:28:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-646370706",
      "id" : 646370706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjM3MDcwNg==",
      "updated_at" : "2020-06-19T00:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646370706",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased",
      "created_at" : "2020-08-01T00:30:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-667437781",
      "id" : 667437781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NzQzNzc4MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-01T00:30:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667437781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470587212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470587212"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might be good to use the non-deprecated constructor (see #19528) ",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-08-14T12:13:58Z",
      "diff_hunk" : "@@ -317,6 +317,107 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470587212",
      "id" : 470587212,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDU4NzIxMg==",
      "original_commit_id" : "b3b9d8fafb86a4e67188eda19cc3d75de423c797",
      "original_line" : 364,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 467526813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470587212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470587943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470587943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    const CWallet& wallet = *pwallet.get();\r\n```\r\n\r\nAs the previous line checks for nullptr, might be good to just take a reference instead of keeping to treat it as pointer that can be nullptr.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-08-14T12:15:36Z",
      "diff_hunk" : "@@ -317,6 +317,107 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+                    {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+                    {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+            \"\\nRemove an address\\n\"\n+            + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\"\n+            + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")\n+                },\n+            }.Check(request);\n+\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470587943",
      "id" : 470587943,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDU4Nzk0Mw==",
      "original_commit_id" : "b3b9d8fafb86a4e67188eda19cc3d75de423c797",
      "original_line" : 384,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 467526813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470587943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470915233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470915233"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-08-15T00:36:14Z",
      "diff_hunk" : "@@ -317,6 +317,107 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470915233",
      "id" : 470915233,
      "in_reply_to_id" : 470587212,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxNTIzMw==",
      "original_commit_id" : "b3b9d8fafb86a4e67188eda19cc3d75de423c797",
      "original_line" : 364,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 467931607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470915233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470915242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470915242"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2020-08-15T00:36:21Z",
      "diff_hunk" : "@@ -317,6 +317,107 @@ UniValue importaddress(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+UniValue removeaddress(const JSONRPCRequest& request)\n+{\n+            RPCHelpMan{\"removeaddress\",\n+                \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+                {\n+                    {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+                    {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+                    {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+                },\n+                RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+                RPCExamples{\n+            \"\\nRemove an address\\n\"\n+            + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\"\n+            + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")\n+                },\n+            }.Check(request);\n+\n+    std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+    if (!wallet) return NullUniValue;\n+    CWallet* const pwallet = wallet.get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r470915242",
      "id" : 470915242,
      "in_reply_to_id" : 470587943,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxNTI0Mg==",
      "original_commit_id" : "b3b9d8fafb86a4e67188eda19cc3d75de423c797",
      "original_line" : 384,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 467931624,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/470915242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Applied @MarcoFalke's suggestions ",
      "created_at" : "2020-08-15T00:36:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-674322163",
      "id" : 674322163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDMyMjE2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-15T00:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674322163",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-31T16:41:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-683894363",
      "id" : 683894363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4Mzg5NDM2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T16:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/683894363",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased",
      "created_at" : "2020-08-31T20:48:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-684031009",
      "id" : 684031009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4NDAzMTAwOQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-31T20:48:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/684031009",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased with latest master, fixed issues that came up from that",
      "created_at" : "2021-01-27T11:05:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-768210117",
      "id" : 768210117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2ODIxMDExNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-27T11:05:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/768210117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r565414578"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565414578"
         }
      },
      "author_association" : "MEMBER",
      "body" : "After the rebase, I'm getting compile warnings for this line consistent with the CI:\r\n```\r\nwallet/wallet.cpp:986:5: warning: calling function 'AssertLockHeldInternal<AnnotatedMixin<std::__1::recursive_mutex> >' requires holding mutex 'cs_wallet' exclusively [-Wthread-safety-analysis]\r\n    AssertLockHeld(cs_wallet);\r\n    ^\r\n./sync.h:81:28: note: expanded from macro 'AssertLockHeld'\r\n#define AssertLockHeld(cs) AssertLockHeldInternal(#cs, __FILE__, __LINE__, &cs)\r\n                           ^\r\nwallet/wallet.cpp:989:54: warning: reading variable 'mapWallet' requires holding mutex 'cs_wallet' [-Wthread-safety-analysis]\r\n    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\r\n                                                     ^\r\nwallet/wallet.cpp:989:79: warning: reading variable 'mapWallet' requires holding mutex 'cs_wallet' [-Wthread-safety-analysis]\r\n    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\r\n                                                                              ^\r\nwallet/wallet.cpp:1001:67: warning: reading variable 'mapWallet' requires holding mutex 'cs_wallet' [-Wthread-safety-analysis]\r\n                std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(txin.prevout.hash);\r\n                                                                  ^\r\nwallet/wallet.cpp:1002:27: warning: reading variable 'mapWallet' requires holding mutex 'cs_wallet' [-Wthread-safety-analysis]\r\n                if (mi != mapWallet.end()) {\r\n                          ^\r\nwallet/wallet.cpp:1011:56: warning: calling function 'IsMine' requires holding mutex 'cs_wallet' exclusively [-Wthread-safety-analysis]\r\n        if (txContainsScript && !IsFromMe(*wTx.tx) && !IsMine(*wTx.tx)) {\r\n                                                       ^\r\nwallet/wallet.cpp:1017:9: warning: reading variable 'mapWallet' requires holding mutex 'cs_wallet' [-Wthread-safety-analysis]\r\n        mapWallet.erase(wtx->GetHash());\r\n        ^\r\n7 warnings generated.\r\n```",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-27T15:43:24Z",
      "diff_hunk" : "@@ -981,6 +981,45 @@ bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx\n     return true;\n }\n \n+void CWallet::RemoveTransactions(const CScript& script)\n+{\n+    AssertLockHeld(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r565414578",
      "id" : 565414578,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTQxNDU3OA==",
      "original_commit_id" : "06a33cc47e0cb7bdc883e43c7ece58d38d50f342",
      "original_line" : 986,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 577475837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565414578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/755825?v=4",
         "events_url" : "https://api.github.com/users/adamjonas/events{/privacy}",
         "followers_url" : "https://api.github.com/users/adamjonas/followers",
         "following_url" : "https://api.github.com/users/adamjonas/following{/other_user}",
         "gists_url" : "https://api.github.com/users/adamjonas/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/adamjonas",
         "id" : 755825,
         "login" : "adamjonas",
         "node_id" : "MDQ6VXNlcjc1NTgyNQ==",
         "organizations_url" : "https://api.github.com/users/adamjonas/orgs",
         "received_events_url" : "https://api.github.com/users/adamjonas/received_events",
         "repos_url" : "https://api.github.com/users/adamjonas/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/adamjonas/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/adamjonas/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/adamjonas"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r565536602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565536602"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wasn't able to reproduce myself but seems I was able to fix it",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-27T18:26:08Z",
      "diff_hunk" : "@@ -981,6 +981,45 @@ bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx\n     return true;\n }\n \n+void CWallet::RemoveTransactions(const CScript& script)\n+{\n+    AssertLockHeld(cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r565536602",
      "id" : 565536602,
      "in_reply_to_id" : 565414578,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTUzNjYwMg==",
      "original_commit_id" : "06a33cc47e0cb7bdc883e43c7ece58d38d50f342",
      "original_line" : 986,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 577635397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/565536602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-01-28T19:01:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-769303835",
      "id" : 769303835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTMwMzgzNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-28T19:01:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769303835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased",
      "created_at" : "2021-01-29T10:05:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-769708588",
      "id" : 769708588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc2OTcwODU4OA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-01-29T10:05:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/769708588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566781451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566781451"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n  from the current wallet. (#15129)\r\n```",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:15:48Z",
      "diff_hunk" : "@@ -0,0 +1,4 @@\n+New RPCs\n+--------\n+- A new `removeaddress` RPC will remove a watch only address or script\n+  from the current wallet.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566781451",
      "id" : 566781451,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc4MTQ1MQ==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 4,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes-15129.md",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566781451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566784496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566784496"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ISTM current practice is to use snake case for the field name\r\n```suggestion\r\n            {\"purge_transactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Whether to remove existing transactions from the wallet\"},\r\n```",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:21:51Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566784496",
      "id" : 566784496,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc4NDQ5Ng==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 378,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566784496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566785007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566785007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether to remove the P2SH version of the script as well\"},\r\n```",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:22:52Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566785007",
      "id" : 566785007,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc4NTAwNw==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 377,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566785007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566786394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566786394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe a JSON object is currently preferred for the output (see other wallet rpcs, e.g. upgradewallet, for examples) ",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:25:38Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566786394",
      "id" : 566786394,
      "line" : 380,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc4NjM5NA==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 380,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 58,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566786394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566789162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566789162"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can replace these lines (and have constness and follow variable naming style per doc/developer-notes.md) with\r\n```c++\r\nconst bool is_p2sh{request.params[1].isNull() ? false : request.params[1].get_bool()};\r\n```\r\n",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:30:55Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\" + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")},\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+            std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+            if (!wallet) return NullUniValue;\n+            CWallet& pwallet = *wallet.get();\n+\n+            EnsureLegacyScriptPubKeyMan(pwallet, true);\n+\n+            // Whether to remove the p2sh version too\n+            bool fP2SH = false;\n+            if (!request.params[1].isNull()) {\n+                fP2SH = request.params[1].get_bool();\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566789162",
      "id" : 566789162,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc4OTE2Mg==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 395,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566789162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566790941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566790941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "idem\r\n```c++\r\nconst bool purge_txns{request.params[2].isNull() ? false : request.params[2].get_bool()};\r\n```\r\n",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:34:39Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\" + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")},\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+            std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+            if (!wallet) return NullUniValue;\n+            CWallet& pwallet = *wallet.get();\n+\n+            EnsureLegacyScriptPubKeyMan(pwallet, true);\n+\n+            // Whether to remove the p2sh version too\n+            bool fP2SH = false;\n+            if (!request.params[1].isNull()) {\n+                fP2SH = request.params[1].get_bool();\n+            }\n+\n+            // Whether to remove the wallet transactions too\n+            bool fPurgeTxs = false;\n+            if (!request.params[2].isNull()) {\n+                fPurgeTxs = request.params[2].get_bool();\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566790941",
      "id" : 566790941,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc5MDk0MQ==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 401,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566790941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566792358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566792358"
         }
      },
      "author_association" : "MEMBER",
      "body" : "consider using the current naming conventions in `doc/developer-notes.md`\r\n```suggestion\r\nstatic void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\r\n```",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:37:22Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566792358",
      "id" : 566792358,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc5MjM1OA==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 327,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566792358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566794473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566794473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please see doc/developer-notes.md about formatting conditionals\r\n```\r\n  - If an `if` only has a single-statement `then`-clause, it can appear\r\n    on the same line as the `if`, without braces. In every other case,\r\n    braces are required, and the `then` and `else` clauses must appear\r\n    correctly indented on a new line.\r\n```\r\n",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:41:25Z",
      "diff_hunk" : "@@ -867,6 +867,33 @@ bool LegacyScriptPubKeyMan::RemoveWatchOnly(const CScript &dest)\n     return true;\n }\n \n+bool LegacyScriptPubKeyMan::PurgeWatchOnly(const CScript& dest)\n+{\n+    {\n+        LOCK(cs_KeyStore);\n+        setWatchOnly.erase(dest);\n+        CPubKey pubKey;\n+        if (ExtractPubKey(dest, pubKey)) {\n+            CKeyID key_id = pubKey.GetID();\n+            mapWatchKeys.erase(key_id);\n+            mapKeyMetadata.erase(key_id);\n+            if (pubKey.IsCompressed()) {\n+                CScript script = GetScriptForDestination(WitnessV0KeyHash(key_id));\n+                CScriptID id(script);\n+                mapScripts.erase(id);\n+                m_script_metadata.erase(id);\n+            }\n+        }\n+    }\n+\n+    if (!HaveWatchOnly())\n+        NotifyWatchonlyChanged(false);\n+    if (!WalletBatch(m_storage.GetDatabase()).EraseWatchOnly(dest))\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566794473",
      "id" : 566794473,
      "line" : 893,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc5NDQ3Mw==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 893,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 27,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566794473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566796750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566796750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit, `assert` and `assert not` without parens seems to be the most-used style in the functional tests\r\n",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:45:41Z",
      "diff_hunk" : "@@ -471,15 +471,48 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import)\n+\n+            # 6. Validate that the address is no longer in the wallet\n+            assert(not self.nodes[1].getaddressinfo(address_to_import)[\"iswatchonly\"])\n+\n+            # 7. Attempt to remove address again\n+            assert_raises_rpc_error(-4, \"The wallet does not contain this address or script\", self.nodes[1].removeaddress, address_to_import)\n+\n+            # 8. Re-import the address\n+            self.nodes[1].importaddress(address_to_import)\n+\n+            # 9. Import private key of the previously imported address on node1\n             priv_key = self.nodes[2].dumpprivkey(address_to_import)\n             self.nodes[1].importprivkey(priv_key)\n \n-            # 6. Check that the unspents are now spendable on node1\n+            # 10. Check that the unspents are now spendable on node1\n             assert_array_result(self.nodes[1].listunspent(),\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": True})\n \n+            # 11. Attempt to remove address after owning private key\n+            assert_raises_rpc_error(-4, \"The wallet contains the private key for this address\", self.nodes[1].removeaddress, address_to_import)\n+\n+            # Check for removeaddress affecting other addresses\n+            # Send some coins to generate new UTXO\n+            address_to_import2 = self.nodes[2].getnewaddress()\n+            txid = self.nodes[0].sendtoaddress(address_to_import2, 1)\n+            self.nodes[0].generate(1)\n+            self.sync_all(self.nodes[0:3])\n+\n+            # Import the new address from node2 to node1\n+            self.nodes[1].importaddress(address_to_import2)\n+            assert(self.nodes[1].getaddressinfo(address_to_import2)[\"iswatchonly\"])\n+\n+            # Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import2)\n+\n+            # Check the address was removed and other address is unaffected\n+            assert(not self.nodes[1].getaddressinfo(address_to_import2)[\"iswatchonly\"])\n+            assert(self.nodes[1].getaddressinfo(address_to_import)[\"ismine\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566796750",
      "id" : 566796750,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc5Njc1MA==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 514,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : null,
      "pull_request_review_id" : 579201928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566796750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566799319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566799319"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps add an example for removing a script as well",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:50:28Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566799319",
      "id" : 566799319,
      "line" : 382,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njc5OTMxOQ==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 382,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 60,
      "pull_request_review_id" : 579225978,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566799319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566800155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566800155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this RPC can remove an address or a script, is there a better name than `removeaddress`? (I don't have an immediate suggestion.)",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-01-29T12:52:07Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r566800155",
      "id" : 566800155,
      "line" : 374,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjgwMDE1NQ==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 374,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 52,
      "pull_request_review_id" : 579227121,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/566800155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r571320203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571320203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`importaddress` can import a script as well, I think this name works.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-02-06T00:22:47Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r571320203",
      "id" : 571320203,
      "in_reply_to_id" : 566800155,
      "line" : 374,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTMyMDIwMw==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 374,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 52,
      "pull_request_review_id" : 584791748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571320203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r571327956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571327956"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What should be returned?",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-02-06T01:01:05Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r571327956",
      "id" : 571327956,
      "in_reply_to_id" : 566786394,
      "line" : 380,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTMyNzk1Ng==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 380,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 58,
      "pull_request_review_id" : 584799601,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-02-06T01:10:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/571327956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Responded to @jonatack's review",
      "created_at" : "2021-02-07T14:16:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-774681490",
      "id" : 774681490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc3NDY4MTQ5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-02-07T14:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/774681490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r592827648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592827648"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please [use `std::make_unique` in new code](https://github.com/bitcoin/bitcoin/blob/master/src/util/memory.h#L13).",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-03-12T00:33:06Z",
      "diff_hunk" : "@@ -981,6 +981,45 @@ bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx\n     return true;\n }\n \n+void CWallet::RemoveTransactions(const CScript& script)\n+{\n+    LOCK(cs_wallet);\n+\n+    std::vector<std::unique_ptr<CWalletTx>> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        const CWalletTx& wTx = it->second;\n+        bool txContainsScript = false;\n+\n+        // if the tx sends to this script\n+        for (const CTxOut& txout : wTx.tx->vout) {\n+            txContainsScript |= script == txout.scriptPubKey;\n+        }\n+\n+        // if the tx spends from this script\n+        if (!txContainsScript) {\n+            for (const CTxIn& txin : wTx.tx->vin) {\n+                std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(txin.prevout.hash);\n+                if (mi != mapWallet.end()) {\n+                    const CWalletTx& prev = (*mi).second;\n+                    if (txin.prevout.n < prev.tx->vout.size()) {\n+                        txContainsScript |= script == prev.tx->vout[txin.prevout.n].scriptPubKey;\n+                    }\n+                }\n+            }\n+        }\n+\n+        if (txContainsScript && !IsFromMe(*wTx.tx) && !IsMine(*wTx.tx)) {\n+            vWtx.push_back(MakeUnique<CWalletTx>(this, MakeTransactionRef(std::move(*wTx.tx))));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r592827648",
      "id" : 592827648,
      "line" : 1012,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjgyNzY0OA==",
      "original_commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "original_line" : 1012,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 32,
      "pull_request_review_id" : 610357077,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-03-12T00:33:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592827648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Compiled successfully on Ubuntu. Tests passed.\r\n\r\nTried experimenting:\r\n\r\nAdding address with `importaddress` and removing with `removeaddress` worked fine\r\n\r\n~~Adding address with `importmulti` gave checksum error maybe because of new checksum used for bech32 addresses but I am not sure.~~\r\n\r\n`importmulti` works fine I was using different public keys in both commands earlier.\r\n\r\n~~Will try experimenting with `addmultisigaddress` as well. It gave error (_The wallet contains the private key for this address_) if the multisig was created using addresses from wallet. Maybe addresses/keys that do not belong to wallet will work fine and will be removed with `removeaddress`.~~\r\n\r\n> This functionality is only intended for use with non-watchonly addresses. https://bitcoincore.org/en/doc/0.21.0/rpc/wallet/addmultisigaddress/\r\n\r\nSo maybe `removeaddress` will only work for addresses added by `importaddress` or `importmulti`. I was assuming `addmultisigaddress` is a combination of `createmultisig` and `importmulti`.",
      "created_at" : "2021-03-12T02:51:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-797197738",
      "id" : 797197738,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc5NzE5NzczOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-03-15T10:55:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/797197738",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r656528507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/656528507"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think these should be positional parameters.",
      "commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "created_at" : "2021-06-22T19:43:47Z",
      "diff_hunk" : "@@ -323,6 +323,98 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purge_txns) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purge_txns);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether to remove the P2SH version of the script as well\"},\n+            {\"purge_transactions\", RPCArg::Type::BOOL, /* default */ \"false\", \"Whether to remove existing transactions from the wallet\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r656528507",
      "id" : 656528507,
      "line" : 378,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NjUyODUwNw==",
      "original_commit_id" : "fdbd01b50e0e5ff55f543d917edfda1eebc4cc15",
      "original_line" : 378,
      "original_position" : 56,
      "original_start_line" : 377,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 56,
      "pull_request_review_id" : 689930092,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : 377,
      "start_side" : "RIGHT",
      "updated_at" : "2021-06-22T19:43:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/656528507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and fixed silent merge conflicts\r\n\r\nAddressed @fanquake's comment",
      "created_at" : "2021-08-23T18:56:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-904027066",
      "id" : 904027066,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII58414lu6",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-23T18:56:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904027066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks to me there is no test for `purge_transactions` argument of `removeaddress`, that should be added.",
      "created_at" : "2021-08-24T11:57:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-904573396",
      "id" : 904573396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII58416rHU",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T11:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904573396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It looks to me there is no test for `purge_transactions` argument of `removeaddress`, that should be added.\r\n\r\nAdded",
      "created_at" : "2021-08-24T15:20:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-904737667",
      "id" : 904737667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII58417TOD",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T15:20:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904737667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "reACK https://github.com/bitcoin/bitcoin/commit/2eb5021e5045c06784244bd92de53b328d9f0b18",
      "created_at" : "2021-08-24T16:51:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-904811788",
      "id" : 904811788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII58417lUM",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-24T16:51:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/904811788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13405205?v=4",
         "events_url" : "https://api.github.com/users/prayank23/events{/privacy}",
         "followers_url" : "https://api.github.com/users/prayank23/followers",
         "following_url" : "https://api.github.com/users/prayank23/following{/other_user}",
         "gists_url" : "https://api.github.com/users/prayank23/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/prayank23",
         "id" : 13405205,
         "login" : "prayank23",
         "node_id" : "MDQ6VXNlcjEzNDA1MjA1",
         "organizations_url" : "https://api.github.com/users/prayank23/orgs",
         "received_events_url" : "https://api.github.com/users/prayank23/received_events",
         "repos_url" : "https://api.github.com/users/prayank23/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/prayank23/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/prayank23"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695364297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695364297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the body of RPC functions shouldn't be indented for the RPCHelpMan",
      "commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "created_at" : "2021-08-25T03:30:02Z",
      "diff_hunk" : "@@ -324,6 +324,99 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purge_txns) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purge_txns);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove the P2SH version of the script as well\"},\n+            {\"purge_transactions\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nRemove a script\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myscript\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\" + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")},\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+            std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695364297",
      "id" : 695364297,
      "line" : 387,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTM2NDI5Nw==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 387,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 64,
      "pull_request_review_id" : 737862656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T04:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695364297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695367929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695367929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why not just use the shared_ptr everywhere? ",
      "commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "created_at" : "2021-08-25T03:41:19Z",
      "diff_hunk" : "@@ -324,6 +324,99 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purge_txns) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purge_txns);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove the P2SH version of the script as well\"},\n+            {\"purge_transactions\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nRemove a script\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myscript\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\" + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")},\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+            std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+            if (!wallet) return NullUniValue;\n+            CWallet& pwallet = *wallet.get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695367929",
      "id" : 695367929,
      "line" : 389,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTM2NzkyOQ==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 389,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 66,
      "pull_request_review_id" : 737862656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T04:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695367929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695379025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695379025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I don't think we need the numbering (makes it annoying to add more cases later)",
      "commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "created_at" : "2021-08-25T04:17:38Z",
      "diff_hunk" : "@@ -504,15 +504,58 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695379025",
      "id" : 695379025,
      "line" : 507,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTM3OTAyNQ==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 507,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 14,
      "pull_request_review_id" : 737862656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T04:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695379025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695379827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695379827"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be good to validate here that the address is not in the wallet (like below)",
      "commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "created_at" : "2021-08-25T04:20:12Z",
      "diff_hunk" : "@@ -504,15 +504,58 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import, False, False)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695379827",
      "id" : 695379827,
      "line" : 509,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTM3OTgyNw==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 509,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 16,
      "pull_request_review_id" : 737862656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T04:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695379827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695380429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695380429"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be good to test the `p2sh` flag as well, all these examples only touch addresses not scripts",
      "commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "created_at" : "2021-08-25T04:22:05Z",
      "diff_hunk" : "@@ -504,15 +504,58 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import, False, False)\n+\n+            # 6. Validate tx is still in wallet\n+            self.nodes[1].gettransaction(addr_txid)\n+\n+            # 7. Re-import address then purge transactions\n+            self.nodes[1].importaddress(address_to_import)\n+            self.nodes[1].removeaddress(address_to_import, False, True)\n+\n+            # 8. Validate transaction is removed\n+            assert_raises_rpc_error(-5, \"Invalid or non-wallet transaction id\", self.nodes[1].gettransaction, addr_txid)\n+\n+            # 9. Validate that the address is no longer in the wallet\n+            assert not self.nodes[1].getaddressinfo(address_to_import)[\"iswatchonly\"]\n+\n+            # 10. Attempt to remove address again\n+            assert_raises_rpc_error(-4, \"The wallet does not contain this address or script\", self.nodes[1].removeaddress, address_to_import)\n+\n+            # 11. Re-import the address\n+            self.nodes[1].importaddress(address_to_import)\n+\n+            # 12. Import private key of the previously imported address on node1\n             priv_key = self.nodes[2].dumpprivkey(address_to_import)\n             self.nodes[1].importprivkey(priv_key)\n \n-            # 6. Check that the unspents are now spendable on node1\n+            # 13. Check that the unspents are now spendable on node1\n             assert_array_result(self.nodes[1].listunspent(),\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": True})\n \n+            # 14. Attempt to remove address after owning private key\n+            assert_raises_rpc_error(-4, \"The wallet contains the private key for this address\", self.nodes[1].removeaddress, address_to_import)\n+\n+            # Check for removeaddress affecting other addresses\n+            # Send some coins to generate new UTXO\n+            address_to_import2 = self.nodes[2].getnewaddress()\n+            txid = self.nodes[0].sendtoaddress(address_to_import2, 1)\n+            self.nodes[0].generate(1)\n+            self.sync_all(self.nodes[0:3])\n+\n+            # Import the new address from node2 to node1\n+            self.nodes[1].importaddress(address_to_import2)\n+            assert self.nodes[1].getaddressinfo(address_to_import2)[\"iswatchonly\"]\n+\n+            # Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import2)\n+\n+            # Check the address was removed and other address is unaffected\n+            assert not self.nodes[1].getaddressinfo(address_to_import2)[\"iswatchonly\"]\n+            assert self.nodes[1].getaddressinfo(address_to_import)[\"ismine\"]\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695380429",
      "id" : 695380429,
      "line" : 558,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTM4MDQyOQ==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 558,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 66,
      "pull_request_review_id" : 737862656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T04:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695380429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thank you for maintaining this PR @benthecarman, it is definitely getting close!",
      "created_at" : "2021-08-25T04:23:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-905171612",
      "id" : 905171612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII584189Kc",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-25T04:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/905171612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/meshcollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/meshcollider/followers",
         "following_url" : "https://api.github.com/users/meshcollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/meshcollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/meshcollider",
         "id" : 3211283,
         "login" : "meshcollider",
         "node_id" : "MDQ6VXNlcjMyMTEyODM=",
         "organizations_url" : "https://api.github.com/users/meshcollider/orgs",
         "received_events_url" : "https://api.github.com/users/meshcollider/received_events",
         "repos_url" : "https://api.github.com/users/meshcollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/meshcollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/meshcollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/meshcollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695898393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695898393"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd say it is allowed for new code to use the right whitespace",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-08-25T16:03:29Z",
      "diff_hunk" : "@@ -324,6 +324,99 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purge_txns) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purge_txns);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove the P2SH version of the script as well\"},\n+            {\"purge_transactions\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nRemove a script\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myscript\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\" + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")},\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+            std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r695898393",
      "id" : 695898393,
      "in_reply_to_id" : 695364297,
      "line" : 387,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NTg5ODM5Mw==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 387,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 64,
      "pull_request_review_id" : 738548034,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-25T16:03:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/695898393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914389"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added.",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-08-31T01:23:40Z",
      "diff_hunk" : "@@ -504,15 +504,58 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import, False, False)\n+\n+            # 6. Validate tx is still in wallet\n+            self.nodes[1].gettransaction(addr_txid)\n+\n+            # 7. Re-import address then purge transactions\n+            self.nodes[1].importaddress(address_to_import)\n+            self.nodes[1].removeaddress(address_to_import, False, True)\n+\n+            # 8. Validate transaction is removed\n+            assert_raises_rpc_error(-5, \"Invalid or non-wallet transaction id\", self.nodes[1].gettransaction, addr_txid)\n+\n+            # 9. Validate that the address is no longer in the wallet\n+            assert not self.nodes[1].getaddressinfo(address_to_import)[\"iswatchonly\"]\n+\n+            # 10. Attempt to remove address again\n+            assert_raises_rpc_error(-4, \"The wallet does not contain this address or script\", self.nodes[1].removeaddress, address_to_import)\n+\n+            # 11. Re-import the address\n+            self.nodes[1].importaddress(address_to_import)\n+\n+            # 12. Import private key of the previously imported address on node1\n             priv_key = self.nodes[2].dumpprivkey(address_to_import)\n             self.nodes[1].importprivkey(priv_key)\n \n-            # 6. Check that the unspents are now spendable on node1\n+            # 13. Check that the unspents are now spendable on node1\n             assert_array_result(self.nodes[1].listunspent(),\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": True})\n \n+            # 14. Attempt to remove address after owning private key\n+            assert_raises_rpc_error(-4, \"The wallet contains the private key for this address\", self.nodes[1].removeaddress, address_to_import)\n+\n+            # Check for removeaddress affecting other addresses\n+            # Send some coins to generate new UTXO\n+            address_to_import2 = self.nodes[2].getnewaddress()\n+            txid = self.nodes[0].sendtoaddress(address_to_import2, 1)\n+            self.nodes[0].generate(1)\n+            self.sync_all(self.nodes[0:3])\n+\n+            # Import the new address from node2 to node1\n+            self.nodes[1].importaddress(address_to_import2)\n+            assert self.nodes[1].getaddressinfo(address_to_import2)[\"iswatchonly\"]\n+\n+            # Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import2)\n+\n+            # Check the address was removed and other address is unaffected\n+            assert not self.nodes[1].getaddressinfo(address_to_import2)[\"iswatchonly\"]\n+            assert self.nodes[1].getaddressinfo(address_to_import)[\"ismine\"]\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914389",
      "id" : 698914389,
      "in_reply_to_id" : 695380429,
      "line" : 579,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODkxNDM4OQ==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 579,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 101,
      "pull_request_review_id" : 742196537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T01:23:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-08-31T01:23:46Z",
      "diff_hunk" : "@@ -504,15 +504,58 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1\n+            self.nodes[1].removeaddress(address_to_import, False, False)\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914429",
      "id" : 698914429,
      "in_reply_to_id" : 695379827,
      "line" : 509,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODkxNDQyOQ==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 509,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 30,
      "pull_request_review_id" : 742196579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T01:23:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914505"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removed (this was very annoying)",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-08-31T01:24:01Z",
      "diff_hunk" : "@@ -504,15 +504,58 @@ def run_test(self):\n                                 {\"address\": address_to_import},\n                                 {\"spendable\": False})\n \n-            # 5. Import private key of the previously imported address on node1\n+            # 5. Remove the address from node1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914505",
      "id" : 698914505,
      "in_reply_to_id" : 695379025,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODkxNDUwNQ==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 507,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : null,
      "pull_request_review_id" : 742196671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T01:24:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914584"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I fixed this",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-08-31T01:24:16Z",
      "diff_hunk" : "@@ -324,6 +324,99 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purge_txns) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purge_txns);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove the P2SH version of the script as well\"},\n+            {\"purge_transactions\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},\n+        RPCExamples{\n+            \"\\nRemove an address\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myaddress\\\"\") +\n+            \"\\nRemove a script\\n\" + HelpExampleCli(\"removeaddress\", \"\\\"myscript\\\"\") +\n+            \"\\nAs a JSON-RPC call\\n\" + HelpExampleRpc(\"removeaddress\", \"\\\"myaddress\\\"\")},\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue {\n+            std::shared_ptr<CWallet> const wallet = GetWalletForJSONRPCRequest(request);\n+            if (!wallet) return NullUniValue;\n+            CWallet& pwallet = *wallet.get();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r698914584",
      "id" : 698914584,
      "in_reply_to_id" : 695367929,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5ODkxNDU4NA==",
      "original_commit_id" : "2eb5021e5045c06784244bd92de53b328d9f0b18",
      "original_line" : 389,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 742196761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-08-31T01:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/698914584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Responded to @meshcollider's review",
      "created_at" : "2021-08-31T01:24:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-908822603",
      "id" : 908822603,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII5842K4hL",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T01:24:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/908822603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15256660?v=4",
         "events_url" : "https://api.github.com/users/benthecarman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/benthecarman/followers",
         "following_url" : "https://api.github.com/users/benthecarman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/benthecarman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/benthecarman",
         "id" : 15256660,
         "login" : "benthecarman",
         "node_id" : "MDQ6VXNlcjE1MjU2NjYw",
         "organizations_url" : "https://api.github.com/users/benthecarman/orgs",
         "received_events_url" : "https://api.github.com/users/benthecarman/received_events",
         "repos_url" : "https://api.github.com/users/benthecarman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/benthecarman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/benthecarman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/benthecarman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700391121"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700391121"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Added ability to remove watch only addresses\" (b8eb5880693358951229512987beffcff51e0ecf)\r\n\r\nNote (no changes requested): Check for isfromme / ismine mirrors existing logic in AddToWalletIfInvolvingMe and seems sufficient. I was initially thinking the IsFromMe check might fail to remove all relevant transactions because the for loop here ignores dependencies between transactions, so if IsFromMe was called on a child transaction and the parent was only removed later, the child might fail to be removed. But I think this not a problem because the PR only supports moving watch-only addresses, not spendable addresses, so no IsFromMe result on any transaction will be changed by watch only address removal. ",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T16:46:44Z",
      "diff_hunk" : "@@ -1026,6 +1026,45 @@ bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx\n     return true;\n }\n \n+void CWallet::RemoveTransactions(const CScript& script)\n+{\n+    LOCK(cs_wallet);\n+\n+    std::vector<std::unique_ptr<CWalletTx>> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        const CWalletTx& wTx = it->second;\n+        bool txContainsScript = false;\n+\n+        // if the tx sends to this script\n+        for (const CTxOut& txout : wTx.tx->vout) {\n+            txContainsScript |= script == txout.scriptPubKey;\n+        }\n+\n+        // if the tx spends from this script\n+        if (!txContainsScript) {\n+            for (const CTxIn& txin : wTx.tx->vin) {\n+                std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(txin.prevout.hash);\n+                if (mi != mapWallet.end()) {\n+                    const CWalletTx& prev = (*mi).second;\n+                    if (txin.prevout.n < prev.tx->vout.size()) {\n+                        txContainsScript |= script == prev.tx->vout[txin.prevout.n].scriptPubKey;\n+                    }\n+                }\n+            }\n+        }\n+\n+        if (txContainsScript && !IsFromMe(*wTx.tx) && !IsMine(*wTx.tx)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700391121",
      "id" : 700391121,
      "line" : 1056,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDM5MTEyMQ==",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 1056,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 31,
      "pull_request_review_id" : 744168886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T17:56:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700391121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700407194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700407194"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Added ability to remove watch only addresses\" (b8eb5880693358951229512987beffcff51e0ecf)\r\n\r\nThis documentation is mirrored from the `importaddress` documentation and it is good that you are keeping it consistent, but I think it is actually a little confusing and would be nice to clarify both places. I would maybe change the help string here to something like `\"If this is true and a script is being removed (not an address, if an address is being removed this is required to be false), then treat the script as a P2SH redeem script and remove the associated P2SH address from the wallet as well.\"` For `importaddress` you could just use the same help text just replacing \"remove[d]\" with \"add[ed]\".\r\n\r\nIt might be also be helpful to add a general note about the limitations of this RPC like \"This RPC method does not currently support removing P2WSH or P2SH-P2WSH witness scripts at the same time as their associated addresses, the same way it does support this P2SH redeem scripts, so separate calls must be made to do this, first removing the addresses, and then removing the witness scripts.\"",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T17:08:38Z",
      "diff_hunk" : "@@ -324,6 +324,98 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purge_txns) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purge_txns);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, RPCArg::Default{false}, \"Whether to remove the P2SH version of the script as well\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700407194",
      "id" : 700407194,
      "line" : 378,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDQwNzE5NA==",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 378,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 55,
      "pull_request_review_id" : 744168886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T17:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700407194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700415511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700415511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> What should be returned?\r\n\r\nIt does seem ok to me to return null like this PR is currently doing. But if you wanted to extend it you could return lists of scripts and addresses removed by the recursive removescript/removeaddress implementation (maybe in a similar format similar to the importmulti requests parameter). There could also be a \"warnings\" field for example if you remove a known P2SH redeem script without removing the associated address.",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T17:20:23Z",
      "diff_hunk" : "@@ -323,6 +323,103 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool isRedeemScript, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!isRedeemScript && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!isRedeemScript && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || isRedeemScript);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (isRedeemScript) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purgeTxs);\n+    } else {\n+        CTxDestination destination;\n+        if (ExtractDestination(script, destination)) {\n+            pwallet->DelAddressBook(destination);\n+        }\n+    }\n+\n+    if (purgeTxs) {\n+        pwallet->RemoveTransactions(script);\n+    }\n+}\n+\n+static void RemoveAddress(CWallet* const pwallet, const CTxDestination& dest, bool purgeTxs) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    CScript script = GetScriptForDestination(dest);\n+    RemoveScript(pwallet, script, false, purgeTxs);\n+    // remove from address book\n+    if (IsValidDestination(dest)) {\n+        pwallet->DelAddressBook(dest);\n+    }\n+}\n+\n+RPCHelpMan removeaddress()\n+{\n+    return RPCHelpMan{\n+        \"removeaddress\",\n+        \"\\nRemoves an address or script (in hex) that was being watched as if it were in your wallet but was not being used to spend. Requires a new wallet backup.\\n\",\n+        {\n+            {\"address\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The Bitcoin address (or hex-encoded script)\"},\n+            {\"p2sh\", RPCArg::Type::BOOL, /* default */ \"false\", \"Remove the P2SH version of the script as well\"},\n+            {\"purgetransactions\", RPCArg::Type::BOOL, /* default_val */ \"false\", \"Remove existing transactions from the wallet\"},\n+        },\n+        RPCResult{RPCResult::Type::NONE, \"\", \"\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700415511",
      "id" : 700415511,
      "in_reply_to_id" : 566786394,
      "line" : 381,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDQxNTUxMQ==",
      "original_commit_id" : "d3a1077c851e13bb57a31a51684c1cde45a4c8c6",
      "original_line" : 381,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 58,
      "pull_request_review_id" : 744168886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T17:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700415511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700418470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700418470"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Added ability to remove watch only addresses\" (b8eb5880693358951229512987beffcff51e0ecf)\r\n\r\nImportant: It seems dangerous to do this error check and raise an error after calling PurgeWatchOnly above. It would be better to check for this error condition early so the remove either fully fails or fully succeeds instead of half removing the redeem script.",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T17:24:36Z",
      "diff_hunk" : "@@ -324,6 +324,98 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700418470",
      "id" : 700418470,
      "line" : 346,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDQxODQ3MA==",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 346,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 23,
      "pull_request_review_id" : 744168886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T17:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700418470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700431854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700431854"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Added ability to remove watch only addresses\" (b8eb5880693358951229512987beffcff51e0ecf)\r\n\r\nImportant: Because there is no RemoveCScript function being called here to undo the effect of AddCScript/AddCScriptWithDB, the `removeaddress` call does not fully undo the effects of the equivalent `importaddress` call when the `p2sh` argument is true, and a copy of the script is still left behind in `mapScripts` and in the database file. It would be good to either note this as a limitation of the RPC in the documentation, or to fix it by actually removing the script and scriptid from the database.",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T17:43:51Z",
      "diff_hunk" : "@@ -324,6 +324,98 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700431854",
      "id" : 700431854,
      "line" : 345,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDQzMTg1NA==",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 345,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 22,
      "pull_request_review_id" : 744168886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T17:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700431854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700433000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700433000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Added ability to remove watch only addresses\" (b8eb5880693358951229512987beffcff51e0ecf)\r\n\r\nImportant: Again because this can throw it seems dangerous to call this here after PurgeWatchOnly has run and succeeded. Would be better to call PurgeWatchOnly after this so the RPC either completely fails or completely succeeds instead of partially succeeding.",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T17:45:25Z",
      "diff_hunk" : "@@ -324,6 +324,98 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {\n+            throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing p2sh redeemScript from wallet\");\n+        }\n+        RemoveAddress(pwallet, ScriptHash(scriptID), purge_txns);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700433000",
      "id" : 700433000,
      "line" : 348,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDQzMzAwMA==",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 348,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 25,
      "pull_request_review_id" : 744168886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T17:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700433000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700448658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700448658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700431854\r\n\r\n> a copy of the script is still left behind in `mapScripts` and in the database file\r\n\r\nMight be good follow up with @achow101 about his earlier comment here https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-642769639 since I'm assuming leaving data behind in mapscripts is wasteful but doesn't cause real problems, but his comment seems to imply otherwise.\r\n\r\nAlso on Andrew's other comment about the keypool, https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-643013777, I think you could address it again with documentation just saying `removeaddress` only undoes the effects of `importaddress`, it doesn't fully undo the effects of `importmulti` if the address was imported with other data like public keys.",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-09-01T18:06:59Z",
      "diff_hunk" : "@@ -324,6 +324,98 @@ RPCHelpMan importaddress()\n     };\n }\n \n+static void RemoveAddress(CWallet*, const CTxDestination&, bool);\n+static void RemoveScript(CWallet* const pwallet, const CScript& script, bool is_redeem_script, bool purge_txns) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+{\n+    isminetype ismine = pwallet->IsMine(script);\n+    if (!is_redeem_script && ismine == ISMINE_SPENDABLE) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet contains the private key for this address\");\n+    } else if (!is_redeem_script && ismine == ISMINE_NO) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"The wallet does not contain this address or script\");\n+    }\n+    CHECK_NONFATAL(ismine == ISMINE_WATCH_ONLY || is_redeem_script);\n+\n+    LegacyScriptPubKeyMan& spk_man = EnsureLegacyScriptPubKeyMan(*pwallet);\n+\n+    if (spk_man.HaveWatchOnly(script) && !spk_man.PurgeWatchOnly(script)) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Error removing address/script from wallet\");\n+    }\n+    if (is_redeem_script) {\n+        CScriptID scriptID = CScriptID(script);\n+        if (!spk_man.HaveCScript(scriptID)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r700448658",
      "id" : 700448658,
      "in_reply_to_id" : 700431854,
      "line" : 345,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMDQ0ODY1OA==",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 345,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : 22,
      "pull_request_review_id" : 744245518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-09-01T18:06:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/700448658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-09T13:06:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-916074499",
      "id" : 916074499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII5842mjAD",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-09T13:06:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/916074499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Request\n\nOn Fri, Mar 12, 2021, 10:58 AM chewy917 ***@***.***> wrote:\n\n> ***@***.**** approved this pull request.\n>\n> whsec_rRcYoDqdsjG07rkv4MpPlth1fSwoRys\n>\n> \n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/15129#pullrequestreview-610413410>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AKZC267FIF22CVVRXR727RTTDFYMBANCNFSM4GOWN2OA>\n> .\n>\n",
      "created_at" : "2021-09-27T21:59:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-928333525",
      "id" : 928333525,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII5843VT7V",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-27T21:59:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/928333525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/45231483?v=4",
         "events_url" : "https://api.github.com/users/ladykevs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ladykevs/followers",
         "following_url" : "https://api.github.com/users/ladykevs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ladykevs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ladykevs",
         "id" : 45231483,
         "login" : "ladykevs",
         "node_id" : "MDQ6VXNlcjQ1MjMxNDgz",
         "organizations_url" : "https://api.github.com/users/ladykevs/orgs",
         "received_events_url" : "https://api.github.com/users/ladykevs/received_events",
         "repos_url" : "https://api.github.com/users/ladykevs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ladykevs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ladykevs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ladykevs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r733008829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733008829"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    for (auto& [txid, wTx] : mapWallet) {\r\n```",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-10-20T17:42:40Z",
      "diff_hunk" : "@@ -1026,6 +1026,45 @@ bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx\n     return true;\n }\n \n+void CWallet::RemoveTransactions(const CScript& script)\n+{\n+    LOCK(cs_wallet);\n+\n+    std::vector<std::unique_ptr<CWalletTx>> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        const CWalletTx& wTx = it->second;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r733008829",
      "id" : 733008829,
      "line" : 1035,
      "node_id" : "PRRC_kwDOABII584rsNO9",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 1035,
      "original_position" : 10,
      "original_start_line" : 1034,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 784807632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733008829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1034,
      "start_side" : "RIGHT",
      "updated_at" : "2021-10-20T17:54:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733008829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r733010724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733010724"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At the very least, we need to delete it from `wtxOrdered` too - and probably `mapTxSpends` (see `CWallet::ZapSelectTx` - maybe we should abstract this to a new method). Ubuntu hirsute (newer libc?) crashes in the tests due to a use-after-free trying to iterate wtxOrdered after removeaddress; I'm not sure if there's a good way to generalise this test to detect the problem on older systems.\r\n\r\nNot sure why, but simply doing `wtxOrdered.erase(wtx->m_it_wtxOrdered);` doesn't appear to fix it :/",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-10-20T17:45:16Z",
      "diff_hunk" : "@@ -1026,6 +1026,45 @@ bool CWallet::LoadToWallet(const uint256& hash, const UpdateWalletTxFn& fill_wtx\n     return true;\n }\n \n+void CWallet::RemoveTransactions(const CScript& script)\n+{\n+    LOCK(cs_wallet);\n+\n+    std::vector<std::unique_ptr<CWalletTx>> vWtx;\n+    for (std::map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it) {\n+        const CWalletTx& wTx = it->second;\n+        bool txContainsScript = false;\n+\n+        // if the tx sends to this script\n+        for (const CTxOut& txout : wTx.tx->vout) {\n+            txContainsScript |= script == txout.scriptPubKey;\n+        }\n+\n+        // if the tx spends from this script\n+        if (!txContainsScript) {\n+            for (const CTxIn& txin : wTx.tx->vin) {\n+                std::map<uint256, CWalletTx>::const_iterator mi = mapWallet.find(txin.prevout.hash);\n+                if (mi != mapWallet.end()) {\n+                    const CWalletTx& prev = (*mi).second;\n+                    if (txin.prevout.n < prev.tx->vout.size()) {\n+                        txContainsScript |= script == prev.tx->vout[txin.prevout.n].scriptPubKey;\n+                    }\n+                }\n+            }\n+        }\n+\n+        if (txContainsScript && !IsFromMe(*wTx.tx) && !IsMine(*wTx.tx)) {\n+            vWtx.push_back(std::make_unique<CWalletTx>(this, MakeTransactionRef(std::move(*wTx.tx))));\n+        }\n+    }\n+\n+    for (const auto& wtx : vWtx) {\n+        mapWallet.erase(wtx->GetHash());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r733010724",
      "id" : 733010724,
      "line" : 1062,
      "node_id" : "PRRC_kwDOABII584rsNsk",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 1062,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 37,
      "pull_request_review_id" : 784807632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733010724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T17:45:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733010724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r733040956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733040956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This feels like we should have more `self.log.info` calls - is it still really about \"sendtoaddress raises if an invalid fee_rate is passed\" here?",
      "commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "created_at" : "2021-10-20T18:27:38Z",
      "diff_hunk" : "@@ -493,26 +493,90 @@ def run_test(self):\n                 assert_raises_rpc_error(-8, 'Invalid estimate_mode parameter, must be one of: \"unset\", \"economical\", \"conservative\"',\n                     self.nodes[2].sendtoaddress, address=address, amount=1, conf_target=target, estimate_mode=mode)\n \n-            # 2. Import address from node2 to node1\n+            # Import address from node2 to node1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#discussion_r733040956",
      "id" : 733040956,
      "line" : 496,
      "node_id" : "PRRC_kwDOABII584rsVE8",
      "original_commit_id" : "b8eb5880693358951229512987beffcff51e0ecf",
      "original_line" : 496,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/wallet_basic.py",
      "position" : 14,
      "pull_request_review_id" : 784854641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/15129",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733040956/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-10-20T18:27:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/733040956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can this be extended to descriptors?",
      "created_at" : "2021-12-15T09:25:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-994566247",
      "id" : 994566247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII5847R-Bn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/994566247/reactions"
      },
      "updated_at" : "2021-12-15T09:25:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/994566247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant?  Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant?  Please close.\n* Did the author lose interest or time to work on this?  Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2022-03-21T13:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-1073873526",
      "id" : 1073873526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII585AAgJ2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073873526/reactions"
      },
      "updated_at" : "2022-03-21T13:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1073873526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing as this has needed rebase for more than 1 year. Feel free to reopen if you get a chance to work on this again in the future, thanks!",
      "created_at" : "2022-09-26T10:01:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-1257793550",
      "id" : 1257793550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII585K-GgO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1257793550/reactions"
      },
      "updated_at" : "2022-09-26T10:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1257793550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@benthecarman You don't plan to continue work on this? If not, I could take over.",
      "created_at" : "2022-09-26T13:46:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/15129#issuecomment-1258068630",
      "id" : 1258068630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/15129",
      "node_id" : "IC_kwDOABII585K_JqW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1258068630/reactions"
      },
      "updated_at" : "2022-09-26T13:46:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1258068630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   }
]
