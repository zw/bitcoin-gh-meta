[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16551](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16551.html) (test: Test that low difficulty chain fork is rejected by MarcoFalke)\n* [#16548](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16548.html) (Make the global flag *fDiscover* an instance variable of CConnman by mmachicao)\n* [#16324](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16324.html) (Get cs_main out of the critical path in ProcessMessages by TheBlueMatt)\n* [#16273](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16273.html) (refactor: Remove unused includes by practicalswift)\n* [#16224](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16224.html) (gui: Bilingual GUI error messages by hebasto)\n* [#15759](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15759.html) ([p2p] Add 2 outbound blocks-only connections by sdaftuar)\n* [#14046](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14046.html) (net: Refactor message parsing (CNetMessage), adds flexibility by jonasschnelli)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2019-06-20T09:47:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-503959202",
      "id" : 503959202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMzk1OTIwMg==",
      "updated_at" : "2019-08-06T03:04:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/503959202",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR is ready to be reviewed/merged.",
      "created_at" : "2019-06-21T16:57:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-504496948",
      "id" : 504496948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNDQ5Njk0OA==",
      "updated_at" : "2019-06-21T16:57:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/504496948",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296515972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296515972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: This 2 lines can be written as ```self.stop_node(1)``` .",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-24T01:51:36Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test p2p permission message.\n+\n+Test that permissions are correctly calculated and applied\n+\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+)\n+\n+class P2PPermissionsTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        self.checkpermission(\n+        # relay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistrelay\"],\n+        [\"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # forcerelay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"forcerelay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # legacy whitelistrelay should be ignored\n+        [\"-whitelist=noban,mempool@127.0.0.1\", \"-whitelistrelay\"],\n+        [\"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # legacy whitelistforcerelay should be ignored\n+        [\"-whitelist=noban,mempool@127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # missing mempool permission to be considered legacy whitelisted\n+        [\"-whitelist=noban@127.0.0.1\"],\n+        [\"noban\"],\n+        False)\n+\n+        self.checkpermission(\n+        # all permission added\n+        [\"-whitelist=all@127.0.0.1\"],\n+        [\"forcerelay\", \"noban\", \"mempool\", \"bloomfilter\", \"relay\"],\n+        True)\n+\n+        self.nodes[1].stop()\n+        self.nodes[1].wait_until_stopped()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296515972",
      "id" : 296515972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NjUxNTk3Mg==",
      "original_commit_id" : "5e899913bb81958e7d313d5e7def8164b4c6c6b7",
      "original_position" : 61,
      "path" : "test/functional/p2p_permissions.py",
      "position" : null,
      "pull_request_review_id" : 253173054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296515972",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/24285095?v=4",
         "events_url" : "https://api.github.com/users/AkioNak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AkioNak/followers",
         "following_url" : "https://api.github.com/users/AkioNak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AkioNak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AkioNak",
         "id" : 24285095,
         "login" : "AkioNak",
         "node_id" : "MDQ6VXNlcjI0Mjg1MDk1",
         "organizations_url" : "https://api.github.com/users/AkioNak/orgs",
         "received_events_url" : "https://api.github.com/users/AkioNak/received_events",
         "repos_url" : "https://api.github.com/users/AkioNak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AkioNak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AkioNak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AkioNak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296552372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296552372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks! fixed.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-24T04:58:12Z",
      "diff_hunk" : "@@ -0,0 +1,76 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test p2p permission message.\n+\n+Test that permissions are correctly calculated and applied\n+\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+)\n+\n+class P2PPermissionsTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        self.checkpermission(\n+        # relay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistrelay\"],\n+        [\"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # forcerelay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"forcerelay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # legacy whitelistrelay should be ignored\n+        [\"-whitelist=noban,mempool@127.0.0.1\", \"-whitelistrelay\"],\n+        [\"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # legacy whitelistforcerelay should be ignored\n+        [\"-whitelist=noban,mempool@127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # missing mempool permission to be considered legacy whitelisted\n+        [\"-whitelist=noban@127.0.0.1\"],\n+        [\"noban\"],\n+        False)\n+\n+        self.checkpermission(\n+        # all permission added\n+        [\"-whitelist=all@127.0.0.1\"],\n+        [\"forcerelay\", \"noban\", \"mempool\", \"bloomfilter\", \"relay\"],\n+        True)\n+\n+        self.nodes[1].stop()\n+        self.nodes[1].wait_until_stopped()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296552372",
      "id" : 296552372,
      "in_reply_to_id" : 296515972,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NjU1MjM3Mg==",
      "original_commit_id" : "5e899913bb81958e7d313d5e7def8164b4c6c6b7",
      "original_position" : 61,
      "path" : "test/functional/p2p_permissions.py",
      "position" : null,
      "pull_request_review_id" : 253199745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296552372",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296992349"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296992349"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missing copyright headers?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T03:26:36Z",
      "diff_hunk" : "@@ -0,0 +1,144 @@\n+#include <net_permissions.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296992349",
      "id" : 296992349,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njk5MjM0OQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 1,
      "path" : "src/net_permissions.cpp",
      "position" : 5,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296992349",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296992962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296992962"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"relay transactions from this peer\" ? (as opposed to relay them to the peer)",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T03:31:01Z",
      "diff_hunk" : "@@ -0,0 +1,46 @@\n+#include <string>\n+#include <vector>\n+#include <netaddress.h>\n+\n+#ifndef BITCOIN_NET_PERMISSIONS_H\n+#define BITCOIN_NET_PERMISSIONS_H\n+enum CNetPermissionFlags\n+{\n+    PF_NONE = 0,\n+    // Can query bloomfilter even if -peerbloomfilters is false\n+    PF_BLOOMFILTER = (1U << 1),\n+    // Always relay transactions, even if already in mempool or rejected from policy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296992962",
      "id" : 296992962,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njk5Mjk2Mg==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 12,
      "path" : "src/net_permissions.h",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296992962",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296997399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296997399"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should `CNode::permissionFlags` be private instead of public?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T04:00:12Z",
      "diff_hunk" : "@@ -657,6 +659,10 @@ class CNode\n      */\n     std::string cleanSubVer GUARDED_BY(cs_SubVer){};\n     bool m_prefer_evict{false}; // This peer is preferred for eviction.\n+    CNetPermissionFlags permissionFlags{PF_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296997399",
      "id" : 296997399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njk5NzM5OQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 78,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296997399",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296997572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296997572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No need to remove the trailing comma, it's not javascript :)",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T04:01:21Z",
      "diff_hunk" : "@@ -62,8 +63,7 @@ static constexpr int DUMP_PEERS_INTERVAL = 15 * 60;\n enum BindFlags {\n     BF_NONE         = 0,\n     BF_EXPLICIT     = (1U << 0),\n-    BF_REPORT_ERROR = (1U << 1),\n-    BF_WHITELIST    = (1U << 2),\n+    BF_REPORT_ERROR = (1U << 1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r296997572",
      "id" : 296997572,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5Njk5NzU3Mg==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/296997572",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297000948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297000948"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could drop `fWhiltelisted` from `CNode` and replace it in `CNodeStats` with \r\n\r\n    bool IsWhitelisted() const { return (permissionFlags & PF_DEFAULT) == PF_DEFAULT; }\r\n\r\n",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T04:24:53Z",
      "diff_hunk" : "@@ -958,9 +976,17 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if ((permissionFlags & PF_BLOOMFILTER) != 0)\n+    {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);\n+    }\n+    CNode* pnode = new CNode(id, nodeServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n     pnode->AddRef();\n-    pnode->fWhitelisted = whitelisted;\n+    pnode->permissionFlags = permissionFlags;\n+    // If the permission flags are a superset of the default flags, then we have the expected\n+    // behavior of the old fWhitelisted\n+    pnode->fWhitelisted = pnode->HasPermission(PF_DEFAULT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297000948",
      "id" : 297000948,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAwMDk0OA==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 95,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297000948",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297002511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297002511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should be `const auto&` (or `const std::string&`) I think",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T04:34:30Z",
      "diff_hunk" : "@@ -184,6 +185,11 @@ static UniValue getpeerinfo(const JSONRPCRequest& request)\n             obj.pushKV(\"inflight\", heights);\n         }\n         obj.pushKV(\"whitelisted\", stats.fWhitelisted);\n+        UniValue permissions(UniValue::VARR);\n+        for (const auto permission : CNetPermissions::ToStrings(stats.permissionFlags)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297002511",
      "id" : 297002511,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAwMjUxMQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 13,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297002511",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297003487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297003487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is the logic there right? `allowLegacy` is true if either `hListenSocket` has default whitelist perms **or** the addr has default whitelist perms. Shouldn't it be false if `hListenSocket` has default whitelist perms (due to whitebind) but addr has whitelist perms other than default (ie, not `PF_NONE` but not `PF_ISDEFAULT` either)?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T04:41:32Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));\n+    bool noban = (permissionFlags & CNetPermissionFlags::PF_NOBAN) != 0;\n+    bool allowLegacy = (permissionFlags & CNetPermissionFlags::PF_ISDEFAULT) != 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297003487",
      "id" : 297003487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAwMzQ4Nw==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 55,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297003487",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297006775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297006775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think adding:\r\n\r\n    inline bool HasNetPermissionFlag(CNetPermissionFlags flags, CNetPermissionFlags f)\r\n    {\r\n        return (flags & f) == f;\r\n    }\r\n    inline void AddNetPermissionFlag(CNetPermissionFlags& flags, CNetPermissionFlags f)\r\n    {\r\n        flags = static_cast<CNetPermissionFlags>(flags | f);\r\n    }\r\n    inline void ClearNetPermissionFlag(CNetPermissionFlags& flags, CNetPermissionFlags f)\r\n    {\r\n        flags = static_cast<CNetPermissionFlags>(flags | ~f);\r\n    }\r\n\r\nmakes using the NetPermFlags a bit clearer fwiw.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T05:03:32Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297006775",
      "id" : 297006775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAwNjc3NQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 53,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253753946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297006775",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297012742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297012742"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So `PF_ISDEFAULT` in this case means that either `whitebind` or `whitelist` does not use `@` syntax to define specific permissions. (`PF_ISDEFAULT` does not mean that the default perm, contrary to `PF_DEFAULT`, are being used, it just mean that we want to keep legacy behavior. I think I should rename this flag, this is confusing)\r\n\r\nTo keep backward compatibility if either of them use the old syntax, you want to take into account `-whiterelay` and `-whiteforcerelay`. I think the logic is right.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T05:36:49Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));\n+    bool noban = (permissionFlags & CNetPermissionFlags::PF_NOBAN) != 0;\n+    bool allowLegacy = (permissionFlags & CNetPermissionFlags::PF_ISDEFAULT) != 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297012742",
      "id" : 297012742,
      "in_reply_to_id" : 297003487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAxMjc0Mg==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 55,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253778856,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297012742",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297014071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297014071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Actually we can't because we are affecting it from outside of the function. You think we should add the flag as a parameter to the ctor?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T05:43:24Z",
      "diff_hunk" : "@@ -657,6 +659,10 @@ class CNode\n      */\n     std::string cleanSubVer GUARDED_BY(cs_SubVer){};\n     bool m_prefer_evict{false}; // This peer is preferred for eviction.\n+    CNetPermissionFlags permissionFlags{PF_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297014071",
      "id" : 297014071,
      "in_reply_to_id" : 296997399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAxNDA3MQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 78,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 253780411,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297014071",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297016800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297016800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Will rename `PF_ISDEFAULT` to `PF_ISIMPLICIT`",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T05:56:43Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));\n+    bool noban = (permissionFlags & CNetPermissionFlags::PF_NOBAN) != 0;\n+    bool allowLegacy = (permissionFlags & CNetPermissionFlags::PF_ISDEFAULT) != 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297016800",
      "id" : 297016800,
      "in_reply_to_id" : 297003487,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAxNjgwMA==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 55,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253783777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297016800",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297018382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297018382"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think it should be replaced. I think it should be completely removed when we decide to not put the flag in getpeerinfo.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T06:03:34Z",
      "diff_hunk" : "@@ -958,9 +976,17 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if ((permissionFlags & PF_BLOOMFILTER) != 0)\n+    {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);\n+    }\n+    CNode* pnode = new CNode(id, nodeServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n     pnode->AddRef();\n-    pnode->fWhitelisted = whitelisted;\n+    pnode->permissionFlags = permissionFlags;\n+    // If the permission flags are a superset of the default flags, then we have the expected\n+    // behavior of the old fWhitelisted\n+    pnode->fWhitelisted = pnode->HasPermission(PF_DEFAULT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297018382",
      "id" : 297018382,
      "in_reply_to_id" : 297000948,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAxODM4Mg==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 95,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253785546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297018382",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297029169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297029169"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Well, could just put the logic in directly in `getpeerinfo` too -- it's also in `RPCConsole::updateNodeDetail` at present. If you're redoing all the logic to not use fWhitelist, maybe it already makes sense to drop it from the getpeerinfo though?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T06:46:25Z",
      "diff_hunk" : "@@ -958,9 +976,17 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if ((permissionFlags & PF_BLOOMFILTER) != 0)\n+    {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);\n+    }\n+    CNode* pnode = new CNode(id, nodeServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n     pnode->AddRef();\n-    pnode->fWhitelisted = whitelisted;\n+    pnode->permissionFlags = permissionFlags;\n+    // If the permission flags are a superset of the default flags, then we have the expected\n+    // behavior of the old fWhitelisted\n+    pnode->fWhitelisted = pnode->HasPermission(PF_DEFAULT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297029169",
      "id" : 297029169,
      "in_reply_to_id" : 297000948,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAyOTE2OQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 95,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253798899,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297029169",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297029958"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297029958"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I tried:\r\n\r\n         bool m_prefer_evict{false}; // This peer is preferred for eviction.\r\n    +private:\r\n         CNetPermissionFlags permissionFlags{PF_NONE};\r\n    +public:\r\n         bool HasPermission(CNetPermissionFlags permission) const {\r\n\r\nand it compiled fine for me? `CConnman` is a friend class already, so it's functions can still play with it.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T06:49:27Z",
      "diff_hunk" : "@@ -657,6 +659,10 @@ class CNode\n      */\n     std::string cleanSubVer GUARDED_BY(cs_SubVer){};\n     bool m_prefer_evict{false}; // This peer is preferred for eviction.\n+    CNetPermissionFlags permissionFlags{PF_NONE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297029958",
      "id" : 297029958,
      "in_reply_to_id" : 296997399,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAyOTk1OA==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 78,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 253799876,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297029958",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297035122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297035122"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not against it, but wouldn't it better to have a templated version somewhere else?\r\n\r\nWhere could I put such utility function?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T07:06:15Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297035122",
      "id" : 297035122,
      "in_reply_to_id" : 297006775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzAzNTEyMg==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 53,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253806323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297035122",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297043433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297043433"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Or template the bitwise ops directly, maybe -- http://blog.bitwigglers.org/using-enum-classes-as-type-safe-bitmasks/ ? Doesn't seem like there's an existing header file that would fit into to me.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T07:30:50Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297043433",
      "id" : 297043433,
      "in_reply_to_id" : 297006775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzA0MzQzMw==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 53,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253816889,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297043433",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297102028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297102028"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems to me such change should be better done globally across the project separately, this is not trivial to review.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T09:50:04Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297102028",
      "id" : 297102028,
      "in_reply_to_id" : 297006775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzEwMjAyOA==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 53,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253892626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297102028",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Because `forcerelay` should set the permission `relay` as well, I added some tests around it.\r\nI also added a test to see if the permissions get combined correctly between whitelist and whitebind.",
      "created_at" : "2019-06-25T09:52:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-505373320",
      "id" : 505373320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNTM3MzMyMA==",
      "updated_at" : "2019-06-25T09:52:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/505373320",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297106427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297106427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ajtowns good point. I don't know if it should be dropped, I expect lot's of people depending on it. But you are right, no need to pass around the fWhitelisted and I can move that in getpeerinfo.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T10:00:03Z",
      "diff_hunk" : "@@ -958,9 +976,17 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if ((permissionFlags & PF_BLOOMFILTER) != 0)\n+    {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);\n+    }\n+    CNode* pnode = new CNode(id, nodeServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n     pnode->AddRef();\n-    pnode->fWhitelisted = whitelisted;\n+    pnode->permissionFlags = permissionFlags;\n+    // If the permission flags are a superset of the default flags, then we have the expected\n+    // behavior of the old fWhitelisted\n+    pnode->fWhitelisted = pnode->HasPermission(PF_DEFAULT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297106427",
      "id" : 297106427,
      "in_reply_to_id" : 297000948,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzEwNjQyNw==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 95,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253898305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297106427",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297147319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297147319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think there's much call for it elsewhere, there's just a couple of `static_cast` for SIGHASH in core_write.cpp and one for ServiceFlags in net.cpp, and some in leveldb. Going by:\r\n\r\n    $ grep 'static_cast<[^>*&]*>[(][^)]*[|&~^]' -rI | grep -v qt.*moc | grep -v paymentrequest.pb.cc | grep -v CNetPermissionFlags\r\n",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-25T11:53:50Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297147319",
      "id" : 297147319,
      "in_reply_to_id" : 297006775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzE0NzMxOQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 53,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 253950954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297147319",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks like the gui does not compile\r\n\r\n```\r\nqt/rpcconsole.cpp:1123:51: error: const class CNodeStats has no member named fWhitelisted",
      "created_at" : "2019-06-25T16:20:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-505517875",
      "id" : 505517875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNTUxNzg3NQ==",
      "updated_at" : "2019-06-25T16:20:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/505517875",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke thanks, fixed.\r\n\r\nTravis fails on unrelated test `wallet_encryption`, a kick-in-the-box can effectively fix it. Is it possible to run travis again?",
      "created_at" : "2019-06-26T06:34:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-505740060",
      "id" : 505740060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNTc0MDA2MA==",
      "updated_at" : "2019-06-26T06:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/505740060",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297655614"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297655614"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit with regard to coding style:\r\n* Newly introduced classes don't have the `C` prefix\r\n* Members start with `m_`, `m_snake_case`\r\n* `if` statements are either in one line or the code blocks are wrapped in `{}`.\r\n\r\n```suggestion\r\n        NetPermissionFlags m_permissions;\r\n```\r\n\r\nAlso, you may use clang-format-diff and yapf-diff. https://github.com/bitcoin/bitcoin/blob/master/doc/productivity.md#writing-code",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-26T13:10:27Z",
      "diff_hunk" : "@@ -315,14 +317,14 @@ class CConnman\n private:\n     struct ListenSocket {\n         SOCKET socket;\n-        bool whitelisted;\n+        CNetPermissionFlags permissions;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r297655614",
      "id" : 297655614,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5NzY1NTYxNA==",
      "original_commit_id" : "40bdd96e2fa2f06b179f0053f58d037e7c664c31",
      "original_position" : 25,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 254599506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/297655614",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, thanks for working on this. I think un-bundling \"whitelisting\" is something long needed.",
      "created_at" : "2019-06-27T11:14:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506303964",
      "id" : 506303964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjMwMzk2NA==",
      "updated_at" : "2019-06-27T11:14:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506303964",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r298154841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298154841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fair enough, doing it for net_permissions then",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-06-27T12:40:23Z",
      "diff_hunk" : "@@ -900,7 +904,21 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    CNetPermissionFlags permissionFlags = hListenSocket.permissions;\n+    permissionFlags = static_cast<CNetPermissionFlags>(permissionFlags | GetWhitelistPermissionFlags(addr));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r298154841",
      "id" : 298154841,
      "in_reply_to_id" : 297006775,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5ODE1NDg0MQ==",
      "original_commit_id" : "f96d0524a99e3d4c7ff4220f22b20688e55c4356",
      "original_position" : 53,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 255197013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298154841",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I refactored to follow the guidelines, making things a bit more readable as @MarcoFalke suggested.\r\nI removed some bitwise magic like @ajtowns suggested.\r\n\r\nThe only point that I did not do: I use `enum` over `enum class`. \r\nThere is no easy to read way to make flags with enum class. :(",
      "created_at" : "2019-06-27T14:19:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506366145",
      "id" : 506366145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjM2NjE0NQ==",
      "updated_at" : "2019-06-27T14:19:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506366145",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Now enforcing ForceRelay => Relay at the enum level. It makes the code more obviously correct.",
      "created_at" : "2019-06-27T14:58:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506382488",
      "id" : 506382488,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjM4MjQ4OA==",
      "updated_at" : "2019-06-27T14:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506382488",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ok fully addressed all the nits.",
      "created_at" : "2019-06-28T02:45:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506579339",
      "id" : 506579339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjU3OTMzOQ==",
      "updated_at" : "2019-06-28T02:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506579339",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "btw, as a follow up PR, I may add a RPC command to change the peer's permission. I often needed that. I remember @jnewbery tried to do it a while ago for whitelisting a peer.",
      "created_at" : "2019-06-29T03:14:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506921915",
      "id" : 506921915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjkyMTkxNQ==",
      "updated_at" : "2019-06-29T03:14:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506921915",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Another idea for follow up PR: allowing the use of permissions for `connect`. (both at config and RPC level)\r\nin a backward compatible way.",
      "created_at" : "2019-06-29T03:29:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506922586",
      "id" : 506922586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjkyMjU4Ng==",
      "updated_at" : "2019-06-29T03:29:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506922586",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ajtowns I reverted the decision of having a `IsLegacyWhitelist()` method instead of passing around the old `fWhitelisted`. Instead I renamed `fWhitelisted` to `m_legacyWhitelisted` to prevent people from using it.\r\n\r\nThe previous logic was, if the permissions granted were including `noban | mempool` then `fwhitelisted` must be true, so removing `fwhitelisted` and replacing it with a single `IsLegacyWhitelist` in `NodeStats` made sense.\r\n\r\nHowever, I thought that later on, if RPC command `connect` support permission flags, and that no flags are passed, I don't want to interprete it as `noban | mempool` permissions, and even if noban and mempool are specified, I would not want the `IsLegacyWhitelist` to return `true`.\r\n\r\nReverting from `IsLegacyWhitelisted` to `m_legacyWhitelisted` means I am sure that a peer is considered whitelisted ONLY in the narrow case of:\r\n* Inbound connection\r\n* No permissions specified in either `white{list,bind}`\r\n\r\nSo now the permission parsing code does not make assumption about which permission to set if the user did not specified any flag. (`ISIMPLICIT`)\r\n",
      "created_at" : "2019-06-29T04:31:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506925516",
      "id" : 506925516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNjkyNTUxNg==",
      "updated_at" : "2019-06-29T07:36:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/506925516",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299391072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299391072"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: Use `nullptr` instead of `NULL` (see rationale in developer notes). Applies throughout PR :-)",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-07-02T09:32:15Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <netbase.h>\n+\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string* error)\n+{\n+    NetPermissionFlags flags = PF_NONE;\n+    const auto permissionSeparator = str.find('@');\n+    if (permissionSeparator == std::string::npos) {\n+        NetPermissions::AddFlag(flags, PF_ISIMPLICIT);\n+        readen = 0;\n+    }\n+    else {\n+        size_t offset = 0;\n+        const auto permissions = str.substr(0, permissionSeparator);\n+        while (offset < permissions.length()) {\n+            const int permissionSeparator = permissions.find(',', offset);\n+            int len = permissionSeparator == -1 ? permissions.length() - offset : permissionSeparator - offset;\n+            auto permission = permissions.substr(offset, len);\n+            offset += len;\n+            if (permissionSeparator != -1) offset += 1;\n+\n+            if (permission == \"bloomfilter\" || permission == \"bloom\") NetPermissions::AddFlag(flags, PF_BLOOMFILTER);\n+            else if (permission == \"noban\") NetPermissions::AddFlag(flags, PF_NOBAN);\n+            else if (permission == \"forcerelay\") NetPermissions::AddFlag(flags, PF_FORCERELAY);\n+            else if (permission == \"mempool\") NetPermissions::AddFlag(flags, PF_MEMPOOL);\n+            else if (permission == \"all\") NetPermissions::AddFlag(flags, PF_ALL);\n+            else if (permission == \"relay\") NetPermissions::AddFlag(flags, PF_RELAY);\n+            else if (permission.length() == 0); // Allow empty entries\n+            else {\n+                if (error != NULL) *error = strprintf(_(\"Invalid P2P permission: '%s'\"), permission);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299391072",
      "id" : 299391072,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTM5MTA3Mg==",
      "original_commit_id" : "a4ec0818ca1876460ac19edb9c4abc7d35d36781",
      "original_position" : 35,
      "path" : "src/net_permissions.cpp",
      "position" : null,
      "pull_request_review_id" : 256774462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299391072",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299391471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299391471"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This `permissionSeparator` shadows `permissionSeparator` in the outer context.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-07-02T09:33:13Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <netbase.h>\n+\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string* error)\n+{\n+    NetPermissionFlags flags = PF_NONE;\n+    const auto permissionSeparator = str.find('@');\n+    if (permissionSeparator == std::string::npos) {\n+        NetPermissions::AddFlag(flags, PF_ISIMPLICIT);\n+        readen = 0;\n+    }\n+    else {\n+        size_t offset = 0;\n+        const auto permissions = str.substr(0, permissionSeparator);\n+        while (offset < permissions.length()) {\n+            const int permissionSeparator = permissions.find(',', offset);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299391471",
      "id" : 299391471,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTM5MTQ3MQ==",
      "original_commit_id" : "a4ec0818ca1876460ac19edb9c4abc7d35d36781",
      "original_position" : 21,
      "path" : "src/net_permissions.cpp",
      "position" : null,
      "pull_request_review_id" : 256774462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299391471",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299393081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299393081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `std::string& error` instead of `std::string* error` (see recommendation in developer notes).\r\n\r\nNit: Use another variable name to avoid shadowing `error` included from `util/system.h`.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-07-02T09:36:55Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <netbase.h>\n+\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string* error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299393081",
      "id" : 299393081,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTM5MzA4MQ==",
      "original_commit_id" : "a4ec0818ca1876460ac19edb9c4abc7d35d36781",
      "original_position" : 9,
      "path" : "src/net_permissions.cpp",
      "position" : null,
      "pull_request_review_id" : 256774462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299393081",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299567411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299567411"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This gives me compiler warnings (\"warning: CConnman::ListenSocket::socket will be initialized after [-Wreorder] SOCKET socket;\"), suggest to change the order somewhere (in the constructor or in the struct).",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-07-02T16:13:06Z",
      "diff_hunk" : "@@ -314,15 +316,17 @@ class CConnman\n \n private:\n     struct ListenSocket {\n+    private:\n+        NetPermissionFlags m_permissions;\n+    public:\n         SOCKET socket;\n-        bool whitelisted;\n-\n-        ListenSocket(SOCKET socket_, bool whitelisted_) : socket(socket_), whitelisted(whitelisted_) {}\n+        inline void AddSocketPermissionFlags(NetPermissionFlags& flags) const { NetPermissions::AddFlag(flags, m_permissions); }\n+        ListenSocket(SOCKET socket_, NetPermissionFlags permissions_) : socket(socket_), m_permissions(permissions_) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299567411",
      "id" : 299567411,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTU2NzQxMQ==",
      "original_commit_id" : "b7d1b9f470db2b6fcb8a152538413cb07738d94a",
      "original_position" : 32,
      "path" : "src/net.h",
      "position" : 30,
      "pull_request_review_id" : 257001614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299567411",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299567894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299567894"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Suggest to use std::string::npos instead of -1 here and below (prevents \"comparison between signed and unsigned\" compiler warnings).",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-07-02T16:14:16Z",
      "diff_hunk" : "@@ -321,4 +322,85 @@ BOOST_AUTO_TEST_CASE(netbase_parsenetwork)\n     BOOST_CHECK_EQUAL(ParseNetwork(\"\"), NET_UNROUTABLE);\n }\n \n+BOOST_AUTO_TEST_CASE(netpermissions_test)\n+{\n+    std::string error;\n+    NetWhitebindPermissions whitebindPermissions;\n+    NetWhitelistPermissions whitelistPermissions;\n+\n+    // Detect invalid white bind\n+    BOOST_CHECK(!NetWhitebindPermissions::TryParse(\"\", whitebindPermissions, &error));\n+    BOOST_CHECK(error.find(\"Cannot resolve -whitebind address\") != -1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299567894",
      "id" : 299567894,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTU2Nzg5NA==",
      "original_commit_id" : "b7d1b9f470db2b6fcb8a152538413cb07738d94a",
      "original_position" : 20,
      "path" : "src/test/netbase_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 257001614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299567894",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Big concept ACK. The whitelist logic should really be unbundled and rationalized. I'm not sold on the approach though. Adding structure to the `bitcoin.conf` file for certain options requires a bunch of custom parsing code to be added and maintained, and introduces complexity for users.\r\n\r\nOne alternative approach would be to build on the work that @ryanofsky has done here: https://github.com/bitcoin/bitcoin/pull/15935 and specify the whitelist config as json, either in the settings.json file or as a separate peers.json (or similar) file. The advantages to that approach are:\r\n\r\n- no custom parsing code needs to be reviewed/maintained, since it's all contained in the univalue library that we already use.\r\n- the json format is widely used and understood, so users don't need to learn a new config format\r\n- (with #15935), bitcoind can write to json, which means very little additional code is needed for the whitelist settings to be writable at runtime and persist across restarts (as suggested here: https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-506921915)",
      "created_at" : "2019-07-02T18:50:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-507801090",
      "id" : 507801090,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNzgwMTA5MA==",
      "updated_at" : "2019-07-02T18:50:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507801090",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The parsing logic is contained, easy to review and widely tested. (100% code coverage)\r\n\r\n> Adding structure to the bitcoin.conf file for certain options requires a bunch of custom parsing code to be added and maintained, and introduces complexity for users.\r\n\r\nI disagree, I want to use this feature myself, and just extending the parsing code of whitebind and whitelist is the easiest way for me to use it. Having separate configuration file via JSON is more difficult.\r\n\r\n> the json format is widely used and understood, so users don't need to learn a new config format\r\n\r\nWith JSON they must know JSON and the flags. With my solution, they only need to know the flags and `,`.",
      "created_at" : "2019-07-03T06:22:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-507956796",
      "id" : 507956796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNzk1Njc5Ng==",
      "updated_at" : "2019-07-03T11:36:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507956796",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I haven't thought enough about the separate config file idea, and what kind of settings ought to go where to have a strong opinion.\r\n\r\nHowever, what about this: permitting individual settings (like the whitelisting ones) to have JSON values as values? (anywhere, whether specified from bitcoin.conf or the command line). That would equally avoid custom per-option parsing logic, without spreading out what gets stored where.",
      "created_at" : "2019-07-03T06:27:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-507958226",
      "id" : 507958226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNzk1ODIyNg==",
      "updated_at" : "2019-07-03T06:27:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507958226",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I personally prefer the parsing method. The code is simple and does not require lot's of maintenance.\r\nAlso I prefer reading `-whitebind=bloom,noban@127.0.0.1:2727` than `-whitebind={interface:\"127.0.0.1:2727\",bloom:\"true\", noban:\"true\"}`\r\n\r\nIt is overkill to use json for a comma separated list when a dumb split saves the day.",
      "created_at" : "2019-07-03T08:42:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-507999665",
      "id" : 507999665,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwNzk5OTY2NQ==",
      "updated_at" : "2019-07-03T09:18:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507999665",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299843060"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299843060"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was using pointer because I don't want to burden the user to retrieve the error. But meh... everywhere we use it we need the error so I will change to ref.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-07-03T08:48:00Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <netbase.h>\n+\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string* error)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r299843060",
      "id" : 299843060,
      "in_reply_to_id" : 299393081,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTg0MzA2MA==",
      "original_commit_id" : "a4ec0818ca1876460ac19edb9c4abc7d35d36781",
      "original_position" : 9,
      "path" : "src/net_permissions.cpp",
      "position" : null,
      "pull_request_review_id" : 257342980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-11T02:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299843060",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed nits of @mzumsande and @practicalswift.\r\nI added some comments on the flag parsing method.",
      "created_at" : "2019-07-03T11:32:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508055636",
      "id" : 508055636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODA1NTYzNg==",
      "updated_at" : "2019-07-03T11:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508055636",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I still think the configuration serialization should be designed with the longer-term goal of making this config updatable at runtime and persistent across restarts. For that, the bitcoin.conf file is not suitable (since bitcoind can't write to it), so we either:\r\n\r\n- come up with our own serialization format, and write custom code that can parse and write to that format, then test, review and maintain that code and fix the bugs and corner cases that come up.\r\n- use an existing and well-supported serialization format like JSON, yaml, toml, etc. We already have support for JSON in Bitcoin Core, so it seems the path of least resistance to use that.\r\n\r\nWe _are_ going to want to make this setting updatable at runtime, so I don't think we should use a format now that can't be written to by bitcoind without writing a bunch more code.",
      "created_at" : "2019-07-03T22:26:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508275442",
      "id" : 508275442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODI3NTQ0Mg==",
      "updated_at" : "2019-07-03T22:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508275442",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery I don't believe that the goal of having a new json object conflict with this PR.\r\n\r\nAs a user, I have no use for a long term json file for configuring permissions, it will cause me more trouble than anything over this solution, so I will not work on it. (I will need change to my dockerfiles to support putting permissions files in the right folder, and build the file via bash script, instead of just adding `-whitebind=noban,mempool,bloom@127.0.0.1:8333` to my config file)\r\n\r\nThis PR does not prevent you from later having a json file if you wish, it will just need to compute the union of permissions granted by the different methods.\r\n\r\nIt is also 100% backward compatible, so people not wanting to take advantage of the syntax of this PR can just simply ignore it.\r\n\r\nThe parsing code is too simple to be of any concern of maintainability.",
      "created_at" : "2019-07-04T08:57:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508401612",
      "id" : 508401612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODQwMTYxMg==",
      "updated_at" : "2019-07-04T08:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508401612",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This PR does not prevent you from later having a json file if you wish, it will just need to compute the union of permissions granted by the different methods.\r\n> \r\n> It is also 100% backward compatible, so people not wanting to take advantage of the syntax of this PR can just simply ignore it.\r\n\r\nThis seems confusing. Having multiple ways for config to be specified leads to confusing interactions. For example, if we just take the union of permissions, then I could start bitcoind with `-whitebind=noban,mempool,bloom@127.0.0.1:8333`, then decide that 127.0.0.1:8333 doesn't need bloom permissions and disable it with an RPC call. When bitcoind restarts, then the permission reappears.",
      "created_at" : "2019-07-04T12:33:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508466519",
      "id" : 508466519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODQ2NjUxOQ==",
      "updated_at" : "2019-07-04T12:33:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508466519",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery most likely people will not use both at the same time. This is concern for a corner case. \r\n\r\nThis can be solved by later in two ways: \r\n* Either no runtime permission can be changed if white{bind/list} of the peer have specific permissions set.\r\n* Either the permissions set at runtime should not be persisted, leaving to the client the responsability to override peer's permission when it detects it got connected.",
      "created_at" : "2019-07-04T13:16:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508479143",
      "id" : 508479143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODQ3OTE0Mw==",
      "updated_at" : "2019-07-04T13:16:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508479143",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It could also be resolved by having the dynamic permissions override the static config. This is something that would need to be resolved even if both bitcoin.conf and settings.json were in json format, though.",
      "created_at" : "2019-07-05T01:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508604844",
      "id" : 508604844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYwNDg0NA==",
      "updated_at" : "2019-07-05T01:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508604844",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@NicolasDorier Also consider that in the future we may want to extend whitelisting with more features like bandwidth limiting, or restricting to bip150-like authenticated peers. I think keeping things extensible may be hard with a custom format like this.",
      "created_at" : "2019-07-05T02:32:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508609870",
      "id" : 508609870,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYwOTg3MA==",
      "updated_at" : "2019-07-05T02:32:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508609870",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa I see, sadly I don't have time to work on something of this scope.\r\n\r\nI wished to do this PR because I only want one simple thing: Allow bloom filters for whitelisted peers as bloom filter will be off by default in the next release. \r\n\r\nBTCPayServer is exposing a whitebind accessible via a (confidential) Tor3 address that other wallets like Wasabi wallet, Bisq or any wallet can connect to. \r\n\r\nI need bloom filter on this interface, as bloom filter is the best way to sync your own wallet without wasting bandwidth. Without a solution in the next release, it means I need to explicitly activate bloom filter even for non whitelisted peer, and I don't want this as it exposes well known DDoS vectors.\r\n\r\n----\r\n\r\nI think that until there is a concrete proposal with the full scope of what such JSON file will cover and its format, we should not block a feature that is useful now and that is not a maintenance burden.\r\n\r\n100% of this PR is entirely compatible with any other JSON proposal. (the code verifying the permissions does not assume it comes from my custom format)\r\n\r\nIn the case later you do such proposal, it is very easy to ignore the JSON if ever my custom format is in use so we don't have non obvious interactions.\r\n\r\nThe parsing code is not a problem to maintain, look at the code, this is nothing more than a split on `@` followed by a split on `,`. The part converting flags into string is useful in any case for both proposal.\r\n\r\nIf really you are against this PR and opt for a JSON, I will close this PR as I really don't want to spend month of bike-shedding on the format of such file in the expectation it get merged in 0.21.",
      "created_at" : "2019-07-05T04:38:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508626741",
      "id" : 508626741,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYyNjc0MQ==",
      "updated_at" : "2019-07-05T04:44:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508626741",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'm not suggesting you doing anything around a separate json config file, nor around any of the other future features. I just suspect it'd be much easier to just use JSON in the existing whitebind config setting rather than a custom parser, especially if we suspect it will be extended later with additional options.",
      "created_at" : "2019-07-05T04:59:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508629480",
      "id" : 508629480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODYyOTQ4MA==",
      "updated_at" : "2019-07-05T05:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508629480",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa so basically you mean having `--whitebind=[noban,bloom]@127.0.0.1:8333` instead of `--whitebind=noban,bloom@127.0.01:8333` ?",
      "created_at" : "2019-07-05T07:41:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508664097",
      "id" : 508664097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODY2NDA5Nw==",
      "updated_at" : "2019-07-05T07:41:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508664097",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Well not against it but I don't see the point too much.\r\n\r\n1. It will not make the code simple and more compact, it just replace a couple of split by some univalue parsing. In terms of line of code this will be exactly the same.\r\n2. Later, if you want to do another format you could consider doing it by using `$` instead of `@` as separator.\r\n\r\nThough if it is really all that is needed to get ACKs, I would do.",
      "created_at" : "2019-07-05T07:51:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-508666621",
      "id" : 508666621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwODY2NjYyMQ==",
      "updated_at" : "2019-07-05T07:51:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/508666621",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa can you tell me more specifically what you want?\r\n\r\n* `--whitebind=[\"noban\",\"bloom\"]@127.0.0.1:8333`\r\n* `--whitebind={permissions: [\"noban\",\"bloom\"], address: \"127.0.0.1:8333\"}`\r\n* `--whiterules={rule: [{permissions: [\"noban\",\"bloom\"], bind: \"127.0.0.1:8333\"}]}`\r\n\r\n?",
      "created_at" : "2019-07-10T13:35:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-510063422",
      "id" : 510063422,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDA2MzQyMg==",
      "updated_at" : "2019-07-10T13:35:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510063422",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jnewbery please anything more specific than \"we want JSON based stuff\" would help me.\r\n\r\nJSON format whatever...",
      "created_at" : "2019-07-10T13:36:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-510063926",
      "id" : 510063926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDA2MzkyNg==",
      "updated_at" : "2019-07-10T13:36:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510063926",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Just to add to the list of options:\r\n\r\n* `-whitebind={\"127.0.0.1:8338\" : [\"noban\",\"bloom\"] ,  \"127.0.0.2\" : []}`",
      "created_at" : "2019-07-10T13:46:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-510067714",
      "id" : 510067714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDA2NzcxNA==",
      "updated_at" : "2019-07-10T13:46:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510067714",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@MarcoFalke you mean as an additional way to configure it, keeping the `noban,bloom@127.0.0.1:8338` format? I wish we keep the current format really because dynamically creating json files (like adding rules) is bash is a pain in the ass.\r\n\r\nI have the case where different process can modify the bitcoin config,  all being able to add their own whitebind (like is the case currently), editing such JSON will be a major pain over just adding `--whitebind=\"noban,bloom@127.0.0.1:8338\"`",
      "created_at" : "2019-07-11T08:06:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-510378193",
      "id" : 510378193,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDM3ODE5Mw==",
      "updated_at" : "2019-07-11T08:09:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510378193",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "JSON on the command line? I'm not sure. That would be a first.\r\nI feel like there's a lot of scope creep going on here. I think this PR should be focused on adding this functionality (maybe we can even have it for 0.19?), not on redefining how options are parsed. That can be discussed somewhere else.",
      "created_at" : "2019-07-11T18:50:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-510609068",
      "id" : 510609068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDYwOTA2OA==",
      "updated_at" : "2019-07-11T18:51:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510609068",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I agree, but would do anything for ACKs to get that into 0.19.0, I would clean the toilet (hell, even eat veggies) to get ACKs rather than enabling bloom filter on 0.19.0 for on btcpay installs by default.",
      "created_at" : "2019-07-12T10:06:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-510831024",
      "id" : 510831024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxMDgzMTAyNA==",
      "updated_at" : "2019-07-12T10:06:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/510831024",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-24T18:15:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-514742270",
      "id" : 514742270,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDc0MjI3MA==",
      "updated_at" : "2019-07-24T18:15:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514742270",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased",
      "created_at" : "2019-07-26T03:56:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-515299426",
      "id" : 515299426,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTI5OTQyNg==",
      "updated_at" : "2019-07-26T03:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515299426",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Test failing, but probably unrelated to this PR.\r\n```\r\n0 stderr bitcoind: validation.cpp:4526: void CChainState::CheckBlockIndex(const Consensus::Params &): Assertion `setBlockIndexCandidates.count(pindex)' failed. \u001b[0m\r\n```",
      "created_at" : "2019-07-26T08:18:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-515357489",
      "id" : 515357489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTM1NzQ4OQ==",
      "updated_at" : "2019-07-26T08:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515357489",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "yes, it happens in other branches too, see #16444.",
      "created_at" : "2019-07-26T08:36:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-515363253",
      "id" : 515363253,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNTM2MzI1Mw==",
      "updated_at" : "2019-07-26T08:36:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/515363253",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "unsigned Approach ACK 1ad7106670344735677e958c35efa81d5d04126e",
      "created_at" : "2019-08-06T13:28:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-518669324",
      "id" : 518669324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODY2OTMyNA==",
      "updated_at" : "2019-08-06T13:28:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518669324",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. Maybe tag with 0.19 given #16152?\r\n\r\nI think the simple `noban,bloom@127.0.0.1:8338` format is good enough. The ability to offer bloom filters to selected peers seems worth the extra complexity, and it reduces confusion of what `-whitelist` currently does.\r\n\r\nI suggest that we keep the `-whitelist` argument simple, and use a future RPC for more complex rules. Such an RPC call could refuse to touch entries that are in the config file, and perhaps `-whitelist` could be deprecated eventually.\r\n\r\nThe parser looks simple enough to me (and I don't write parsers for a living).\r\n\r\nI'm not a fan of an extra config file, partially because JSON is tedious to write. If you have to use some tool to produce config files, then you might as well use the RPC.\r\n\r\nGetting a bunch of compiler warnings on macOS for the tests:\r\n```\r\nIn file included from test/net_tests.cpp:13:\r\n./net.h:324:73: warning: field 'socket' will be initialized after field 'm_permissions' [-Wreorder]\r\n        ListenSocket(SOCKET socket_, NetPermissionFlags permissions_) : socket(socket_), m_permissions(permissions_) {}\r\n                                                                        ^\r\n1 warning generated.\r\n  CXX      test/test_bitcoin-txindex_tests.o\r\n  CXX      test/test_bitcoin-txvalidation_tests.o\r\ntest/netbase_tests.cpp:379:54: warning: comparison of integers of different signs: 'std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >::size_type' (aka 'unsigned long') and 'int' [-Wsign-compare]\r\n    BOOST_CHECK(error.find(\"Invalid P2P permission\") != -1);\r\n                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^  ~~\r\n```\r\n\r\nIn QT too:\r\n\r\n```\r\nIn file included from ./qt/bantablemodel.h:8:\r\n./net.h:324:73: warning: field 'socket' will be initialized after field 'm_permissions' [-Wreorder]\r\n        ListenSocket(SOCKET socket_, NetPermissionFlags permissions_) : socket(socket_), m_permissions(permissions_) {}\r\n                                                                        ^\r\n```\r\n\r\nI get a `Mempool sync timed out` for `wallet_listtransactions.py` line 179, which suggests something did change in the default behavior. `p2p_sendheaders.py` also failed for me during the first run at Part 5. ",
      "created_at" : "2019-08-06T14:38:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-518698424",
      "id" : 518698424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxODY5ODQyNA==",
      "updated_at" : "2019-08-06T14:38:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/518698424",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors I will rebase, this was based on a commit where test has been broken for some reason. Will fix the warnings as well.",
      "created_at" : "2019-08-07T09:52:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-519027403",
      "id" : 519027403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTAyNzQwMw==",
      "updated_at" : "2019-08-07T09:52:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519027403",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, tests passing @Sjors (Warnings should be fixed)",
      "created_at" : "2019-08-07T15:29:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-519148694",
      "id" : 519148694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTE0ODY5NA==",
      "updated_at" : "2019-08-07T15:31:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519148694",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Almost, still get this one:\r\n\r\n```\r\nnet_permissions.cpp:28:38: warning: comparison of integers of different signs: 'const int' and 'const typename basic_string<char, char_traits<char>, allocator<char> >::size_type' (aka 'const unsigned long') [-Wsign-compare]\r\n            int len = commaSeparator == std::string::npos ? permissions.length() - readen : commaSeparator - readen;\r\n                      ~~~~~~~~~~~~~~ ^  ~~~~~~~~~~~~~~~~~\r\nnet_permissions.cpp:32:32: warning: comparison of integers of different signs: 'const int' and 'const typename basic_string<char, char_traits<char>, allocator<char> >::size_type' (aka 'const unsigned long') [-Wsign-compare]\r\n            if (commaSeparator != std::string::npos) readen++; // We read \",\"\r\n                ~~~~~~~~~~~~~~ ^  ~~~~~~~~~~~~~~~~~\r\n2 warnings generated.\r\n```\r\n\r\nThe first commit is rather large. Consider introducing `TryParsePermissionFlags` in a separate commit, and testing it directly instead of, or in addition to, indirectly via NetWhite[list/bind]Permissions. And another commit where you switch to using `NetWhite[list/bind]Permissions::TryParse`, but don't process the flags yet.\r\n\r\nThere are a bunch of existing functional tests that use `-whitelist=`, exploiting various features. Maybe add a commit that switches these tests to use the minimum set of flags they need? That provides some additional assurance that these flags work as expected. In `p2p_relay.py` where `-whitelistrelay` and `-whitelistforcerelay` are tested, those tests could be duplicated to check that equivalent flag works (with global `-whitelistrelay=0`).",
      "created_at" : "2019-08-08T08:59:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-519433070",
      "id" : 519433070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTQzMzA3MA==",
      "updated_at" : "2019-08-08T09:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519433070",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "IMO improving the tests can be done in a follow-up PR\r\nlet's get rid of the warning though",
      "created_at" : "2019-08-08T11:29:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-519479963",
      "id" : 519479963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTQ3OTk2Mw==",
      "updated_at" : "2019-08-08T11:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519479963",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @laanwj. Lets switch to the new logic in tests in a follow up. I am happy to do that, but I'd rather not have this pull grow even more.",
      "created_at" : "2019-08-08T18:11:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-519629194",
      "id" : 519629194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxOTYyOTE5NA==",
      "updated_at" : "2019-08-08T18:11:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/519629194",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors if you look the C++ tests I am testing it very strongly with all kind of edge cases. It does not make sense to test the parse flag in isolation as it is not used in the code that way.\r\n\r\nI should have fixed the warnings now. I am unsure though because I am developing on windows and msvc says it is good.",
      "created_at" : "2019-08-11T02:34:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-520194945",
      "id" : 520194945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMDE5NDk0NQ==",
      "updated_at" : "2019-08-11T02:34:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/520194945",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T15:06:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-521286681",
      "id" : 521286681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTI4NjY4MQ==",
      "updated_at" : "2019-08-14T15:06:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521286681",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314025297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314025297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why are the fallbacks set to `false` and not the `DEFAULT_` value?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T18:39:46Z",
      "diff_hunk" : "@@ -904,7 +903,20 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n+    hListenSocket.AddSocketPermissionFlags(permissionFlags);\n+    AddWhitelistPermissionFlags(permissionFlags, addr);\n+    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);\n+    bool legacyWhitelisted = false;\n+    if (NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_ISIMPLICIT)) {\n+        NetPermissions::ClearFlag(permissionFlags, PF_ISIMPLICIT);\n+        if (gArgs.GetBoolArg(\"-whitelistforcerelay\", false)) NetPermissions::AddFlag(permissionFlags, PF_FORCERELAY);\n+        if (gArgs.GetBoolArg(\"-whitelistrelay\", false)) NetPermissions::AddFlag(permissionFlags, PF_RELAY);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314025297",
      "id" : 314025297,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDAyNTI5Nw==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 64,
      "path" : "src/net.cpp",
      "position" : 64,
      "pull_request_review_id" : 275076872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-14T18:39:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314025297",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314026195"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314026195"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this checked before the flag is set in line 916?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T18:41:46Z",
      "diff_hunk" : "@@ -904,7 +903,20 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n+    hListenSocket.AddSocketPermissionFlags(permissionFlags);\n+    AddWhitelistPermissionFlags(permissionFlags, addr);\n+    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314026195",
      "id" : 314026195,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDAyNjE5NQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 59,
      "path" : "src/net.cpp",
      "position" : 59,
      "pull_request_review_id" : 275077973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-14T19:28:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314026195",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314035862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314035862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this not using `ResolveErrMsg` like before?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T19:04:15Z",
      "diff_hunk" : "@@ -0,0 +1,106 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <util/translation.h>\n+#include <netbase.h>\n+\n+// The parse the following format \"perm1,perm2@xxxxxx\"\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string& error)\n+{\n+    NetPermissionFlags flags = PF_NONE;\n+    const auto atSeparator = str.find('@');\n+\n+    // if '@' is not found (ie, \"xxxxx\"), the caller should apply implicit permissions\n+    if (atSeparator == std::string::npos) {\n+        NetPermissions::AddFlag(flags, PF_ISIMPLICIT);\n+        readen = 0;\n+    }\n+    // else (ie, \"perm1,perm2@xxxxx\"), let's enumerate the permissions by splitting by ',' and calculate the flags\n+    else {\n+        readen = 0;\n+        // permissions == perm1,perm2\n+        const auto permissions = str.substr(0, atSeparator);\n+        while (readen < permissions.length()) {\n+            const auto commaSeparator = permissions.find(',', readen);\n+            const auto len = commaSeparator == std::string::npos ? permissions.length() - readen : commaSeparator - readen;\n+            // permission == perm1\n+            const auto permission = permissions.substr(readen, len);\n+            readen += len; // We read \"perm1\"\n+            if (commaSeparator != std::string::npos) readen++; // We read \",\"\n+\n+            if (permission == \"bloomfilter\" || permission == \"bloom\") NetPermissions::AddFlag(flags, PF_BLOOMFILTER);\n+            else if (permission == \"noban\") NetPermissions::AddFlag(flags, PF_NOBAN);\n+            else if (permission == \"forcerelay\") NetPermissions::AddFlag(flags, PF_FORCERELAY);\n+            else if (permission == \"mempool\") NetPermissions::AddFlag(flags, PF_MEMPOOL);\n+            else if (permission == \"all\") NetPermissions::AddFlag(flags, PF_ALL);\n+            else if (permission == \"relay\") NetPermissions::AddFlag(flags, PF_RELAY);\n+            else if (permission.length() == 0); // Allow empty entries\n+            else {\n+                error = strprintf(_(\"Invalid P2P permission: '%s'\").translated, permission);\n+                return false;\n+            }\n+        }\n+        readen++;\n+    }\n+\n+    output = flags;\n+    error = \"\";\n+    return true;\n+}\n+\n+std::vector<std::string> NetPermissions::ToStrings(NetPermissionFlags flags)\n+{\n+    std::vector<std::string> strings;\n+    if (NetPermissions::HasFlag(flags, PF_BLOOMFILTER)) strings.push_back(\"bloomfilter\");\n+    if (NetPermissions::HasFlag(flags, PF_NOBAN)) strings.push_back(\"noban\");\n+    if (NetPermissions::HasFlag(flags, PF_FORCERELAY)) strings.push_back(\"forcerelay\");\n+    if (NetPermissions::HasFlag(flags, PF_RELAY)) strings.push_back(\"relay\");\n+    if (NetPermissions::HasFlag(flags, PF_MEMPOOL)) strings.push_back(\"mempool\");\n+    return strings;\n+}\n+\n+bool NetWhitebindPermissions::TryParse(const std::string str, NetWhitebindPermissions& output, std::string& error)\n+{\n+    NetPermissionFlags flags;\n+    size_t offset;\n+    if (!TryParsePermissionFlags(str, flags, offset, error)) return false;\n+\n+    const std::string strBind = str.substr(offset);\n+    CService addrBind;\n+    if (!Lookup(strBind.c_str(), addrBind, 0, false)) {\n+        error = strprintf(_(\"Cannot resolve -%s address: '%s'\").translated, \"whitebind\", strBind);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314035862",
      "id" : 314035862,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDAzNTg2Mg==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 74,
      "path" : "src/net_permissions.cpp",
      "position" : 74,
      "pull_request_review_id" : 275077973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-14T19:28:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314035862",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314040941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314040941"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why is this `noban` and not `relay`?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T19:17:24Z",
      "diff_hunk" : "@@ -3786,7 +3792,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             pto->vInventoryBlockToSend.clear();\n \n             // Check whether periodic sends should happen\n-            bool fSendTrickle = pto->fWhitelisted;\n+            bool fSendTrickle = pto->HasPermission(PF_NOBAN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314040941",
      "id" : 314040941,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDA0MDk0MQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 107,
      "path" : "src/net_processing.cpp",
      "position" : 107,
      "pull_request_review_id" : 275077973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-14T19:28:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314040941",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314041751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314041751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Where is this from and why is it needed? I couldn't find it in previous code",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T19:19:45Z",
      "diff_hunk" : "@@ -962,9 +974,15 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if (NetPermissions::HasFlag(permissionFlags, PF_BLOOMFILTER)) {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314041751",
      "id" : 314041751,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDA0MTc1MQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 89,
      "path" : "src/net.cpp",
      "position" : 89,
      "pull_request_review_id" : 275077973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-14T19:28:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314041751",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314044640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314044640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Doesn't p2p_port(1) return the port of node 1, so in the config of node 1 you are whitelisting itself? Dumb question, but I can't see how this test passes.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-14T19:27:32Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test p2p permission message.\n+\n+Test that permissions are correctly calculated and applied\n+\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    p2p_port,\n+)\n+\n+class P2PPermissionsTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        self.checkpermission(\n+        # relay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistrelay\"],\n+        [\"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # forcerelay and relay permission added\n+        # Legacy parameter interaction which set whitelistrelay to true\n+        # if whitelistforcerelay is true\n+        [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"forcerelay\", \"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        # Let's make sure permissions are merged correctly\n+        # For this, we need to use whitebind instead of bind\n+        # by modifying the configuration file.\n+        ip_port = \"127.0.0.1:{}\".format(p2p_port(1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314044640",
      "id" : 314044640,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDA0NDY0MA==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 42,
      "path" : "test/functional/p2p_permissions.py",
      "position" : 42,
      "pull_request_review_id" : 275077973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-14T19:28:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314044640",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314197312"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314197312"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because the constant is in a different file which is not in imported into the scope of this file.\r\n\r\nLooking at other `GetBoolArg` references in this file, you can notice that all of them have the same issue, none of them reference `DEFAULT_`",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:14:30Z",
      "diff_hunk" : "@@ -904,7 +903,20 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n+    hListenSocket.AddSocketPermissionFlags(permissionFlags);\n+    AddWhitelistPermissionFlags(permissionFlags, addr);\n+    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);\n+    bool legacyWhitelisted = false;\n+    if (NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_ISIMPLICIT)) {\n+        NetPermissions::ClearFlag(permissionFlags, PF_ISIMPLICIT);\n+        if (gArgs.GetBoolArg(\"-whitelistforcerelay\", false)) NetPermissions::AddFlag(permissionFlags, PF_FORCERELAY);\n+        if (gArgs.GetBoolArg(\"-whitelistrelay\", false)) NetPermissions::AddFlag(permissionFlags, PF_RELAY);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314197312",
      "id" : 314197312,
      "in_reply_to_id" : 314025297,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDE5NzMxMg==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 64,
      "path" : "src/net.cpp",
      "position" : 64,
      "pull_request_review_id" : 275288999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314197312",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314198250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314198250"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks to report this, I will make a PR fixing it.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:18:04Z",
      "diff_hunk" : "@@ -904,7 +903,20 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n+    hListenSocket.AddSocketPermissionFlags(permissionFlags);\n+    AddWhitelistPermissionFlags(permissionFlags, addr);\n+    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314198250",
      "id" : 314198250,
      "in_reply_to_id" : 314026195,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDE5ODI1MA==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 59,
      "path" : "src/net.cpp",
      "position" : 59,
      "pull_request_review_id" : 275290125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:18:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314198250",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314198817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314198817"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The initial problem I wanted to solve is that, because in 0.19 we remove BLOOM_FILTER by default, I wanted the ability to keep it only for whitelisted peer.  Because this was a simple change, I decided to add it here instead of separate PR.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:20:38Z",
      "diff_hunk" : "@@ -962,9 +974,15 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if (NetPermissions::HasFlag(permissionFlags, PF_BLOOMFILTER)) {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314198817",
      "id" : 314198817,
      "in_reply_to_id" : 314041751,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDE5ODgxNw==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 89,
      "path" : "src/net.cpp",
      "position" : 89,
      "pull_request_review_id" : 275290827,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:20:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314198817",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314198985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314198985"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because it is defined in `init.cpp`",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:21:24Z",
      "diff_hunk" : "@@ -0,0 +1,106 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <util/translation.h>\n+#include <netbase.h>\n+\n+// The parse the following format \"perm1,perm2@xxxxxx\"\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string& error)\n+{\n+    NetPermissionFlags flags = PF_NONE;\n+    const auto atSeparator = str.find('@');\n+\n+    // if '@' is not found (ie, \"xxxxx\"), the caller should apply implicit permissions\n+    if (atSeparator == std::string::npos) {\n+        NetPermissions::AddFlag(flags, PF_ISIMPLICIT);\n+        readen = 0;\n+    }\n+    // else (ie, \"perm1,perm2@xxxxx\"), let's enumerate the permissions by splitting by ',' and calculate the flags\n+    else {\n+        readen = 0;\n+        // permissions == perm1,perm2\n+        const auto permissions = str.substr(0, atSeparator);\n+        while (readen < permissions.length()) {\n+            const auto commaSeparator = permissions.find(',', readen);\n+            const auto len = commaSeparator == std::string::npos ? permissions.length() - readen : commaSeparator - readen;\n+            // permission == perm1\n+            const auto permission = permissions.substr(readen, len);\n+            readen += len; // We read \"perm1\"\n+            if (commaSeparator != std::string::npos) readen++; // We read \",\"\n+\n+            if (permission == \"bloomfilter\" || permission == \"bloom\") NetPermissions::AddFlag(flags, PF_BLOOMFILTER);\n+            else if (permission == \"noban\") NetPermissions::AddFlag(flags, PF_NOBAN);\n+            else if (permission == \"forcerelay\") NetPermissions::AddFlag(flags, PF_FORCERELAY);\n+            else if (permission == \"mempool\") NetPermissions::AddFlag(flags, PF_MEMPOOL);\n+            else if (permission == \"all\") NetPermissions::AddFlag(flags, PF_ALL);\n+            else if (permission == \"relay\") NetPermissions::AddFlag(flags, PF_RELAY);\n+            else if (permission.length() == 0); // Allow empty entries\n+            else {\n+                error = strprintf(_(\"Invalid P2P permission: '%s'\").translated, permission);\n+                return false;\n+            }\n+        }\n+        readen++;\n+    }\n+\n+    output = flags;\n+    error = \"\";\n+    return true;\n+}\n+\n+std::vector<std::string> NetPermissions::ToStrings(NetPermissionFlags flags)\n+{\n+    std::vector<std::string> strings;\n+    if (NetPermissions::HasFlag(flags, PF_BLOOMFILTER)) strings.push_back(\"bloomfilter\");\n+    if (NetPermissions::HasFlag(flags, PF_NOBAN)) strings.push_back(\"noban\");\n+    if (NetPermissions::HasFlag(flags, PF_FORCERELAY)) strings.push_back(\"forcerelay\");\n+    if (NetPermissions::HasFlag(flags, PF_RELAY)) strings.push_back(\"relay\");\n+    if (NetPermissions::HasFlag(flags, PF_MEMPOOL)) strings.push_back(\"mempool\");\n+    return strings;\n+}\n+\n+bool NetWhitebindPermissions::TryParse(const std::string str, NetWhitebindPermissions& output, std::string& error)\n+{\n+    NetPermissionFlags flags;\n+    size_t offset;\n+    if (!TryParsePermissionFlags(str, flags, offset, error)) return false;\n+\n+    const std::string strBind = str.substr(offset);\n+    CService addrBind;\n+    if (!Lookup(strBind.c_str(), addrBind, 0, false)) {\n+        error = strprintf(_(\"Cannot resolve -%s address: '%s'\").translated, \"whitebind\", strBind);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314198985",
      "id" : 314198985,
      "in_reply_to_id" : 314035862,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDE5ODk4NQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 74,
      "path" : "src/net_permissions.cpp",
      "position" : 74,
      "pull_request_review_id" : 275291054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:21:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314198985",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314199540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314199540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To keep backward compatibility. \r\n\r\nBefore, if the peer was whitelisted, it did not matter whether he was also in `whitelistrelay`, this would be still be `true` in all cases.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:23:48Z",
      "diff_hunk" : "@@ -3786,7 +3792,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             pto->vInventoryBlockToSend.clear();\n \n             // Check whether periodic sends should happen\n-            bool fSendTrickle = pto->fWhitelisted;\n+            bool fSendTrickle = pto->HasPermission(PF_NOBAN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314199540",
      "id" : 314199540,
      "in_reply_to_id" : 314040941,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDE5OTU0MA==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 107,
      "path" : "src/net_processing.cpp",
      "position" : 107,
      "pull_request_review_id" : 275291717,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:24:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314199540",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314200996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314200996"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because we are using `whitebind`. This basically mean: Consider anybody connecting to this port as \"whitelisted\".\r\n\r\nBecause node 0 connect to node 1, this is the right port.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:29:46Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test p2p permission message.\n+\n+Test that permissions are correctly calculated and applied\n+\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    p2p_port,\n+)\n+\n+class P2PPermissionsTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        self.checkpermission(\n+        # relay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistrelay\"],\n+        [\"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # forcerelay and relay permission added\n+        # Legacy parameter interaction which set whitelistrelay to true\n+        # if whitelistforcerelay is true\n+        [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"forcerelay\", \"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        # Let's make sure permissions are merged correctly\n+        # For this, we need to use whitebind instead of bind\n+        # by modifying the configuration file.\n+        ip_port = \"127.0.0.1:{}\".format(p2p_port(1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314200996",
      "id" : 314200996,
      "in_reply_to_id" : 314044640,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDIwMDk5Ng==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 42,
      "path" : "test/functional/p2p_permissions.py",
      "position" : 42,
      "pull_request_review_id" : 275293466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:29:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314200996",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314202951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314202951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/16618",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T07:37:56Z",
      "diff_hunk" : "@@ -904,7 +903,20 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n+    hListenSocket.AddSocketPermissionFlags(permissionFlags);\n+    AddWhitelistPermissionFlags(permissionFlags, addr);\n+    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314202951",
      "id" : 314202951,
      "in_reply_to_id" : 314026195,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDIwMjk1MQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 59,
      "path" : "src/net.cpp",
      "position" : 59,
      "pull_request_review_id" : 275295975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T07:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314202951",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There should be a followup to document the new syntax in `bitcoind` help (`gArgs.AddArg(\"whitelist=<IP address or network>`).",
      "created_at" : "2019-08-15T11:53:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-521615630",
      "id" : 521615630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTYxNTYzMA==",
      "updated_at" : "2019-08-15T11:53:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521615630",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors I can do that, though I am unsure where is the best place for me to document properly this. I think the full description might be too long for the command line?",
      "created_at" : "2019-08-15T13:07:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-521634206",
      "id" : 521634206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTYzNDIwNg==",
      "updated_at" : "2019-08-15T13:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521634206",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There are other command line arguments with multi-line explanations, so I don't think that's a huge issue:\r\n<img width=\"564\" alt=\"Schermafbeelding 2019-08-15 om 15 53 49\" src=\"https://user-images.githubusercontent.com/10217/63099195-e3c59880-bf74-11e9-8996-41ddf37dd8e9.png\">\r\n",
      "created_at" : "2019-08-15T13:54:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#issuecomment-521649350",
      "id" : 521649350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUyMTY0OTM1MA==",
      "updated_at" : "2019-08-15T13:54:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/521649350",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314317824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314317824"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, makes sense.",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T13:55:04Z",
      "diff_hunk" : "@@ -0,0 +1,97 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2018 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test p2p permission message.\n+\n+Test that permissions are correctly calculated and applied\n+\"\"\"\n+\n+from test_framework.test_node import ErrorMatch\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    connect_nodes,\n+    p2p_port,\n+)\n+\n+class P2PPermissionsTests(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 2\n+        self.setup_clean_chain = True\n+        self.extra_args = [[],[]]\n+\n+    def run_test(self):\n+        self.checkpermission(\n+        # relay permission added\n+        [\"-whitelist=127.0.0.1\", \"-whitelistrelay\"],\n+        [\"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        self.checkpermission(\n+        # forcerelay and relay permission added\n+        # Legacy parameter interaction which set whitelistrelay to true\n+        # if whitelistforcerelay is true\n+        [\"-whitelist=127.0.0.1\", \"-whitelistforcerelay\"],\n+        [\"forcerelay\", \"relay\", \"noban\", \"mempool\"],\n+        True)\n+\n+        # Let's make sure permissions are merged correctly\n+        # For this, we need to use whitebind instead of bind\n+        # by modifying the configuration file.\n+        ip_port = \"127.0.0.1:{}\".format(p2p_port(1))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314317824",
      "id" : 314317824,
      "in_reply_to_id" : 314044640,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMxNzgyNA==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 42,
      "path" : "test/functional/p2p_permissions.py",
      "position" : 42,
      "pull_request_review_id" : 275441183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T13:55:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314317824",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314318229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314318229"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, I figured. Was a bit weird to see this behavior change in a \"refactoring\" commit",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T13:55:54Z",
      "diff_hunk" : "@@ -962,9 +974,15 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n     uint64_t nonce = GetDeterministicRandomizer(RANDOMIZER_ID_LOCALHOSTNONCE).Write(id).Finalize();\n     CAddress addr_bind = GetBindAddress(hSocket);\n \n-    CNode* pnode = new CNode(id, nLocalServices, GetBestHeight(), hSocket, addr, CalculateKeyedNetGroup(addr), nonce, addr_bind, \"\", true);\n+    ServiceFlags nodeServices = nLocalServices;\n+    if (NetPermissions::HasFlag(permissionFlags, PF_BLOOMFILTER)) {\n+        nodeServices = static_cast<ServiceFlags>(nodeServices | NODE_BLOOM);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314318229",
      "id" : 314318229,
      "in_reply_to_id" : 314041751,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMxODIyOQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 89,
      "path" : "src/net.cpp",
      "position" : 89,
      "pull_request_review_id" : 275441698,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T13:55:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314318229",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314318524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314318524"
         }
      },
      "author_association" : "MEMBER",
      "body" : "But `relay` is also set to true for backward compatibility, no?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T13:56:30Z",
      "diff_hunk" : "@@ -3786,7 +3792,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             pto->vInventoryBlockToSend.clear();\n \n             // Check whether periodic sends should happen\n-            bool fSendTrickle = pto->fWhitelisted;\n+            bool fSendTrickle = pto->HasPermission(PF_NOBAN);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314318524",
      "id" : 314318524,
      "in_reply_to_id" : 314040941,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMxODUyNA==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 107,
      "path" : "src/net_processing.cpp",
      "position" : 107,
      "pull_request_review_id" : 275442069,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T13:56:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314318524",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314324939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314324939"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed in #16620",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T14:10:26Z",
      "diff_hunk" : "@@ -0,0 +1,106 @@\n+// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <net_permissions.h>\n+#include <util/system.h>\n+#include <util/translation.h>\n+#include <netbase.h>\n+\n+// The parse the following format \"perm1,perm2@xxxxxx\"\n+bool TryParsePermissionFlags(const std::string str, NetPermissionFlags& output, size_t& readen, std::string& error)\n+{\n+    NetPermissionFlags flags = PF_NONE;\n+    const auto atSeparator = str.find('@');\n+\n+    // if '@' is not found (ie, \"xxxxx\"), the caller should apply implicit permissions\n+    if (atSeparator == std::string::npos) {\n+        NetPermissions::AddFlag(flags, PF_ISIMPLICIT);\n+        readen = 0;\n+    }\n+    // else (ie, \"perm1,perm2@xxxxx\"), let's enumerate the permissions by splitting by ',' and calculate the flags\n+    else {\n+        readen = 0;\n+        // permissions == perm1,perm2\n+        const auto permissions = str.substr(0, atSeparator);\n+        while (readen < permissions.length()) {\n+            const auto commaSeparator = permissions.find(',', readen);\n+            const auto len = commaSeparator == std::string::npos ? permissions.length() - readen : commaSeparator - readen;\n+            // permission == perm1\n+            const auto permission = permissions.substr(readen, len);\n+            readen += len; // We read \"perm1\"\n+            if (commaSeparator != std::string::npos) readen++; // We read \",\"\n+\n+            if (permission == \"bloomfilter\" || permission == \"bloom\") NetPermissions::AddFlag(flags, PF_BLOOMFILTER);\n+            else if (permission == \"noban\") NetPermissions::AddFlag(flags, PF_NOBAN);\n+            else if (permission == \"forcerelay\") NetPermissions::AddFlag(flags, PF_FORCERELAY);\n+            else if (permission == \"mempool\") NetPermissions::AddFlag(flags, PF_MEMPOOL);\n+            else if (permission == \"all\") NetPermissions::AddFlag(flags, PF_ALL);\n+            else if (permission == \"relay\") NetPermissions::AddFlag(flags, PF_RELAY);\n+            else if (permission.length() == 0); // Allow empty entries\n+            else {\n+                error = strprintf(_(\"Invalid P2P permission: '%s'\").translated, permission);\n+                return false;\n+            }\n+        }\n+        readen++;\n+    }\n+\n+    output = flags;\n+    error = \"\";\n+    return true;\n+}\n+\n+std::vector<std::string> NetPermissions::ToStrings(NetPermissionFlags flags)\n+{\n+    std::vector<std::string> strings;\n+    if (NetPermissions::HasFlag(flags, PF_BLOOMFILTER)) strings.push_back(\"bloomfilter\");\n+    if (NetPermissions::HasFlag(flags, PF_NOBAN)) strings.push_back(\"noban\");\n+    if (NetPermissions::HasFlag(flags, PF_FORCERELAY)) strings.push_back(\"forcerelay\");\n+    if (NetPermissions::HasFlag(flags, PF_RELAY)) strings.push_back(\"relay\");\n+    if (NetPermissions::HasFlag(flags, PF_MEMPOOL)) strings.push_back(\"mempool\");\n+    return strings;\n+}\n+\n+bool NetWhitebindPermissions::TryParse(const std::string str, NetWhitebindPermissions& output, std::string& error)\n+{\n+    NetPermissionFlags flags;\n+    size_t offset;\n+    if (!TryParsePermissionFlags(str, flags, offset, error)) return false;\n+\n+    const std::string strBind = str.substr(offset);\n+    CService addrBind;\n+    if (!Lookup(strBind.c_str(), addrBind, 0, false)) {\n+        error = strprintf(_(\"Cannot resolve -%s address: '%s'\").translated, \"whitebind\", strBind);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314324939",
      "id" : 314324939,
      "in_reply_to_id" : 314035862,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMyNDkzOQ==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 74,
      "path" : "src/net_permissions.cpp",
      "position" : 74,
      "pull_request_review_id" : 275450253,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T14:10:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314324939",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314327596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314327596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So is it safe to do that? Under what circumstances would it lead to bugs?",
      "commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "created_at" : "2019-08-15T14:16:23Z",
      "diff_hunk" : "@@ -904,7 +903,20 @@ void CConnman::AcceptConnection(const ListenSocket& hListenSocket) {\n         }\n     }\n \n-    bool whitelisted = hListenSocket.whitelisted || IsWhitelistedRange(addr);\n+    NetPermissionFlags permissionFlags = NetPermissionFlags::PF_NONE;\n+    hListenSocket.AddSocketPermissionFlags(permissionFlags);\n+    AddWhitelistPermissionFlags(permissionFlags, addr);\n+    const bool noban = NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_NOBAN);\n+    bool legacyWhitelisted = false;\n+    if (NetPermissions::HasFlag(permissionFlags, NetPermissionFlags::PF_ISIMPLICIT)) {\n+        NetPermissions::ClearFlag(permissionFlags, PF_ISIMPLICIT);\n+        if (gArgs.GetBoolArg(\"-whitelistforcerelay\", false)) NetPermissions::AddFlag(permissionFlags, PF_FORCERELAY);\n+        if (gArgs.GetBoolArg(\"-whitelistrelay\", false)) NetPermissions::AddFlag(permissionFlags, PF_RELAY);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248#discussion_r314327596",
      "id" : 314327596,
      "in_reply_to_id" : 314025297,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMxNDMyNzU5Ng==",
      "original_commit_id" : "c5b404e8f1973afe071a07c63ba1038eefe13f0f",
      "original_position" : 64,
      "path" : "src/net.cpp",
      "position" : 64,
      "pull_request_review_id" : 275453712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248",
      "updated_at" : "2019-08-15T14:16:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/314327596",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
