{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "# Motivation\r\n\r\nIn 0.19, bloom filter will be disabled by default. I tried to make [a PR](https://github.com/bitcoin/bitcoin/pull/16176) to enable bloom filter for whitelisted peers regardless of `-peerbloomfilters`.\r\n\r\nBloom filter have non existent privacy and server can omit filter's matches. However, both problems are completely irrelevant when you connect to your own node. If you connect to your own node, bloom filters are the most bandwidth efficient way to synchronize your light client without the need of some middleware like Electrum.\r\n\r\nIt is also a superior alternative to BIP157 as it does not require to maintain an additional index and it would work well on pruned nodes.\r\n\r\nWhen I attempted to allow bloom filters for whitelisted peer, my proposal has been NACKed in favor of [a more flexible approach](https://github.com/bitcoin/bitcoin/pull/16176#issuecomment-500762907) which should allow node operator to set fine grained permissions instead of a global `whitelisted` attribute.\r\n\r\nDoing so will also make follow up idea very easy to implement in a backward compatible way.\r\n\r\n# Implementation details\r\n\r\nThe PR propose a new format for `--white{list,bind}`. I added a way to specify permissions granted to inbound connection matching `white{list,bind}`.\r\n\r\nThe following permissions exists:\r\n* ForceRelay\r\n* Relay\r\n* NoBan\r\n* BloomFilter\r\n* Mempool\r\n\r\nExample: \r\n* `-whitelist=bloomfilter@127.0.0.1/32`.\r\n* `-whitebind=bloomfilter,relay,noban@127.0.0.1:10020`.\r\n\r\nIf no permissions are specified, `NoBan | Mempool` is assumed. (making this PR backward compatible)\r\n\r\nWhen we receive an inbound connection, we calculate the effective permissions for this peer by fetching the permissions granted from `whitelist`  and add to it the permissions granted from `whitebind`.\r\n\r\nTo keep backward compatibility, if no permissions are specified in `white{list,bind}` (e.g. `--whitelist=127.0.0.1`) then parameters `-whitelistforcerelay` and `-whiterelay` will add the permissions `ForceRelay` and `Relay` to the inbound node.\r\n\r\n`-whitelistforcerelay` and `-whiterelay` are ignored if the permissions flags are explicitly set in `white{bind,list}`.\r\n\r\n# Follow up idea\r\n\r\nBased on this PR, other changes become quite easy to code in a trivially review-able, backward compatible way:\r\n\r\n* Changing `connect` at rpc and config file level to understand the permissions flags.\r\n* Changing the permissions of a peer at RPC level.\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 37,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248/comments",
   "created_at" : "2019-06-20T09:44:14Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248",
   "id" : 458551457,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "node_id" : "MDU6TGFiZWw5ODI5ODAwNw==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 64,
      "created_at" : "2018-05-31T19:40:07Z",
      "creator" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      },
      "description" : null,
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/37",
      "id" : 3391434,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/37/labels",
      "node_id" : "MDk6TWlsZXN0b25lMzM5MTQzNA==",
      "number" : 37,
      "open_issues" : 23,
      "state" : "open",
      "title" : "0.19.0",
      "updated_at" : "2019-07-29T13:46:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/37"
   },
   "node_id" : "MDExOlB1bGxSZXF1ZXN0MjkwMTM2NDY3",
   "number" : 16248,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/16248.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/16248",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/16248.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/16248"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Make whitebind/whitelist permissions more flexible",
   "updated_at" : "2019-07-29T22:23:12Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/16248",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/3020646?v=4",
      "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
      "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/NicolasDorier",
      "id" : 3020646,
      "login" : "NicolasDorier",
      "node_id" : "MDQ6VXNlcjMwMjA2NDY=",
      "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
      "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
      "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/NicolasDorier"
   }
}
