[
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\n\r\nIn 606622195fdf6a1fb6adc41d1091ce2ae7501125 commit message:\r\n> \"Remove circular dependencies between wallet translation units\"\r\n\r\nWhat are those dependencies?",
      "created_at" : "2020-10-30T21:34:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-719810438",
      "id" : 719810438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxOTgxMDQzOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-30T21:34:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/719810438",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What are those dependencies?\r\n\r\nOh, I think I need to drop that comment. The dependency I was thinking of was `walletutil.cpp` depending on `bdb.cpp` for `ExistsBerkeleyDatabase`, and `bdb.cpp` depending on `walletutil.cpp` for `SplitWalletPath`. And I thought there were others. But actually `SplitWalletPath` is in `db.cpp` not `walletutil.cpp`, and now I don't think there are other dependencies.",
      "created_at" : "2020-10-30T21:47:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-719815071",
      "id" : 719815071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxOTgxNTA3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-30T21:47:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/719815071",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20206 (wallet, refactor: Include headers instead of function declarations by hebasto)\n* #19245 ([WIP DONOTMERGE] Replace boost::filesystem with std::filesystem (in c++17) by kiminuo)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-10-30T23:58:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-719849943",
      "id" : 719849943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcxOTg0OTk0Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-05T00:18:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/719849943",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515641690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515641690"
         }
      },
      "author_association" : "MEMBER",
      "body" : "9d1fd52952cb6a944e7de4dd7fca241e3341894b\r\n\r\nAs a next step it would be nice to refactor this and `MakeWalletDatabase` to avoid duplicate code. Something like:\r\n```cpp\r\nDatabaseStatus CheckWalletDatabase(const fs::path& path);\r\nDatabaseStatus CheckWalletDatabase(const std::string& name)\r\n{\r\n    return CheckWalletDatabase(fs::absolute(name, GetWalletDir()));\r\n}\r\n```\r\nWhich would be called in both places.",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-01T16:23:34Z",
      "diff_hunk" : "@@ -34,10 +27,10 @@ std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n         const fs::path path = it->path().string().substr(offset);\n \n         if (it->status().type() == fs::directory_file &&\n-            (ExistsBerkeleyDatabase(it->path()) || ExistsSQLiteDatabase(it->path()))) {\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515641690",
      "id" : 515641690,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY0MTY5MA==",
      "original_commit_id" : "9d1fd52952cb6a944e7de4dd7fca241e3341894b",
      "original_line" : 30,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 521239205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515641690",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515672776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515672776"
         }
      },
      "author_association" : "NONE",
      "body" : "Is it worth breaking this into a function so `IsSQLiteFile` can re-use this as well? With `minSize` is as parameter",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-01T21:13:44Z",
      "diff_hunk" : "@@ -3,23 +3,125 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <chainparams.h>\n #include <fs.h>\n+#include <logging.h>\n #include <wallet/db.h>\n \n #include <string>\n \n-void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)\n+std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n {\n-    if (fs::is_regular_file(wallet_path)) {\n+    const size_t offset = wallet_dir.string().size() + 1;\n+    std::vector<fs::path> paths;\n+    boost::system::error_code ec;\n+\n+    for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n+        if (ec) {\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n+            continue;\n+        }\n+\n+        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+        const fs::path path = it->path().string().substr(offset);\n+\n+        if (it->status().type() == fs::directory_file &&\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {\n+            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+            paths.emplace_back(path);\n+        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBDBFile(it->path())) {\n+            if (it->path().filename() == \"wallet.dat\") {\n+                // Found top-level wallet.dat btree file, add top level directory \"\"\n+                // as a wallet.\n+                paths.emplace_back();\n+            } else {\n+                // Found top-level btree file not called wallet.dat. Current bitcoin\n+                // software will never create these files but will allow them to be\n+                // opened in a shared database environment for backwards compatibility.\n+                // Add it to the list of available wallets.\n+                paths.emplace_back(path);\n+            }\n+        }\n+    }\n+\n+    return paths;\n+}\n+\n+fs::path BDBDataFile(const fs::path& path)\n+{\n+    if (fs::is_regular_file(path)) {\n         // Special case for backwards compatibility: if wallet path points to an\n         // existing file, treat it as the path to a BDB data file in a parent\n         // directory that also contains BDB log files.\n-        env_directory = wallet_path.parent_path();\n-        database_filename = wallet_path.filename().string();\n+        return path;\n     } else {\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n-        env_directory = wallet_path;\n-        database_filename = \"wallet.dat\";\n+        return path / \"wallet.dat\";\n     }\n }\n+\n+fs::path SQLiteDataFile(const fs::path& path)\n+{\n+    return path / \"wallet.dat\";\n+}\n+\n+bool IsBDBFile(const fs::path& path)\n+{\n+    if (!fs::exists(path)) return false;\n+\n+    // A Berkeley DB Btree file has at least 4K.\n+    // This check also prevents opening lock files.\n+    boost::system::error_code ec;\n+    auto size = fs::file_size(path, ec);\n+    if (ec) LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), path.string());\n+    if (size < 4096) return false;\n+\n+    fsbridge::ifstream file(path, std::ios::binary);\n+    if (!file.is_open()) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515672776",
      "id" : 515672776,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3Mjc3Ng==",
      "original_commit_id" : "e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : 72,
      "path" : "src/wallet/db.cpp",
      "position" : 91,
      "pull_request_review_id" : 521261730,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : 77,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515672776",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515673173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515673173"
         }
      },
      "author_association" : "NONE",
      "body" : "Is this check necessary?",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-01T21:17:40Z",
      "diff_hunk" : "@@ -3,23 +3,125 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <chainparams.h>\n #include <fs.h>\n+#include <logging.h>\n #include <wallet/db.h>\n \n #include <string>\n \n-void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)\n+std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n {\n-    if (fs::is_regular_file(wallet_path)) {\n+    const size_t offset = wallet_dir.string().size() + 1;\n+    std::vector<fs::path> paths;\n+    boost::system::error_code ec;\n+\n+    for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n+        if (ec) {\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n+            continue;\n+        }\n+\n+        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+        const fs::path path = it->path().string().substr(offset);\n+\n+        if (it->status().type() == fs::directory_file &&\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {\n+            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+            paths.emplace_back(path);\n+        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBDBFile(it->path())) {\n+            if (it->path().filename() == \"wallet.dat\") {\n+                // Found top-level wallet.dat btree file, add top level directory \"\"\n+                // as a wallet.\n+                paths.emplace_back();\n+            } else {\n+                // Found top-level btree file not called wallet.dat. Current bitcoin\n+                // software will never create these files but will allow them to be\n+                // opened in a shared database environment for backwards compatibility.\n+                // Add it to the list of available wallets.\n+                paths.emplace_back(path);\n+            }\n+        }\n+    }\n+\n+    return paths;\n+}\n+\n+fs::path BDBDataFile(const fs::path& path)\n+{\n+    if (fs::is_regular_file(path)) {\n         // Special case for backwards compatibility: if wallet path points to an\n         // existing file, treat it as the path to a BDB data file in a parent\n         // directory that also contains BDB log files.\n-        env_directory = wallet_path.parent_path();\n-        database_filename = wallet_path.filename().string();\n+        return path;\n     } else {\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n-        env_directory = wallet_path;\n-        database_filename = \"wallet.dat\";\n+        return path / \"wallet.dat\";\n     }\n }\n+\n+fs::path SQLiteDataFile(const fs::path& path)\n+{\n+    return path / \"wallet.dat\";\n+}\n+\n+bool IsBDBFile(const fs::path& path)\n+{\n+    if (!fs::exists(path)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515673173",
      "id" : 515673173,
      "line" : 77,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3MzE3Mw==",
      "original_commit_id" : "e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "original_line" : 77,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 81,
      "pull_request_review_id" : 521262102,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515673173",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515673267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515673267"
         }
      },
      "author_association" : "NONE",
      "body" : "Do you need to close the file?",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-01T21:18:49Z",
      "diff_hunk" : "@@ -3,23 +3,125 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <chainparams.h>\n #include <fs.h>\n+#include <logging.h>\n #include <wallet/db.h>\n \n #include <string>\n \n-void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)\n+std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n {\n-    if (fs::is_regular_file(wallet_path)) {\n+    const size_t offset = wallet_dir.string().size() + 1;\n+    std::vector<fs::path> paths;\n+    boost::system::error_code ec;\n+\n+    for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n+        if (ec) {\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n+            continue;\n+        }\n+\n+        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+        const fs::path path = it->path().string().substr(offset);\n+\n+        if (it->status().type() == fs::directory_file &&\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {\n+            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+            paths.emplace_back(path);\n+        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBDBFile(it->path())) {\n+            if (it->path().filename() == \"wallet.dat\") {\n+                // Found top-level wallet.dat btree file, add top level directory \"\"\n+                // as a wallet.\n+                paths.emplace_back();\n+            } else {\n+                // Found top-level btree file not called wallet.dat. Current bitcoin\n+                // software will never create these files but will allow them to be\n+                // opened in a shared database environment for backwards compatibility.\n+                // Add it to the list of available wallets.\n+                paths.emplace_back(path);\n+            }\n+        }\n+    }\n+\n+    return paths;\n+}\n+\n+fs::path BDBDataFile(const fs::path& path)\n+{\n+    if (fs::is_regular_file(path)) {\n         // Special case for backwards compatibility: if wallet path points to an\n         // existing file, treat it as the path to a BDB data file in a parent\n         // directory that also contains BDB log files.\n-        env_directory = wallet_path.parent_path();\n-        database_filename = wallet_path.filename().string();\n+        return path;\n     } else {\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n-        env_directory = wallet_path;\n-        database_filename = \"wallet.dat\";\n+        return path / \"wallet.dat\";\n     }\n }\n+\n+fs::path SQLiteDataFile(const fs::path& path)\n+{\n+    return path / \"wallet.dat\";\n+}\n+\n+bool IsBDBFile(const fs::path& path)\n+{\n+    if (!fs::exists(path)) return false;\n+\n+    // A Berkeley DB Btree file has at least 4K.\n+    // This check also prevents opening lock files.\n+    boost::system::error_code ec;\n+    auto size = fs::file_size(path, ec);\n+    if (ec) LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), path.string());\n+    if (size < 4096) return false;\n+\n+    fsbridge::ifstream file(path, std::ios::binary);\n+    if (!file.is_open()) return false;\n+\n+    file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+    uint32_t data = 0;\n+    file.read((char*) &data, sizeof(data)); // Read 4 bytes of file to compare against magic",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515673267",
      "id" : 515673267,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3MzI2Nw==",
      "original_commit_id" : "e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "original_line" : 91,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 95,
      "pull_request_review_id" : 521262207,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515673267",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7217256?v=4",
         "events_url" : "https://api.github.com/users/mjdietzx/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mjdietzx/followers",
         "following_url" : "https://api.github.com/users/mjdietzx/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mjdietzx/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mjdietzx",
         "id" : 7217256,
         "login" : "mjdietzx",
         "node_id" : "MDQ6VXNlcjcyMTcyNTY=",
         "organizations_url" : "https://api.github.com/users/mjdietzx/orgs",
         "received_events_url" : "https://api.github.com/users/mjdietzx/received_events",
         "repos_url" : "https://api.github.com/users/mjdietzx/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mjdietzx/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mjdietzx/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mjdietzx"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mjdietzx your questions about the IsBDBFile are good but I think not directly relevant to this PR, which is just moving the IsBDBFile function from one file to another, not changing it at all.\r\n\r\nViewing individual commits https://github.com/bitcoin/bitcoin/pull/20275/commits/ may be clearer than viewing the consolidated diff. Any case, I'll try follow up with answers soon.",
      "created_at" : "2020-11-01T22:46:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-720163756",
      "id" : 720163756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDE2Mzc1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-01T22:46:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720163756",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-11-01T22:56:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-720164864",
      "id" : 720164864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDE2NDg2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-01T22:56:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720164864",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "created_at" : "2020-11-02T16:59:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-720598128",
      "id" : 720598128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDU5ODEyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-02T16:59:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720598128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK e21dc6c05c02a0da18b9af2c0eb1d7996c378541. Tested `listwalletdir` and `loadwallet` with a wallet in `walletdir` and with an external wallet.\r\n\r\nStartup fails if any wallets `-wallet` or settings.json is sqlite.",
      "created_at" : "2020-11-02T18:23:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-720644915",
      "id" : 720644915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMDY0NDkxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-02T18:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/720644915",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517382090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517382090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515641690\r\n\r\n> [9d1fd52](https://github.com/bitcoin/bitcoin/commit/9d1fd52952cb6a944e7de4dd7fca241e3341894b)\r\n> \r\n> As a next step it would be nice to refactor this and `MakeWalletDatabase` to avoid duplicate code.\r\n\r\nDefinitely could be a next step. I'd be a little skeptical of adding another similar sounding function when it's nice to have fewer distinct functions, but would have to see what this simplifies",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-04T14:26:55Z",
      "diff_hunk" : "@@ -34,10 +27,10 @@ std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n         const fs::path path = it->path().string().substr(offset);\n \n         if (it->status().type() == fs::directory_file &&\n-            (ExistsBerkeleyDatabase(it->path()) || ExistsSQLiteDatabase(it->path()))) {\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517382090",
      "id" : 517382090,
      "in_reply_to_id" : 515641690,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM4MjA5MA==",
      "original_commit_id" : "9d1fd52952cb6a944e7de4dd7fca241e3341894b",
      "original_line" : 30,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 523411141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517382090",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517387788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517387788"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515673173\r\n\r\n> Is this check necessary?\r\n\r\nThis is preexisting code in a move-only function. If you wanted to drop this line you would need to add an error_code check below to avoid logging an error if the path is not found. That's probably the way I would do it, but I don't think the difference is significant.",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-04T14:34:47Z",
      "diff_hunk" : "@@ -3,23 +3,125 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <chainparams.h>\n #include <fs.h>\n+#include <logging.h>\n #include <wallet/db.h>\n \n #include <string>\n \n-void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)\n+std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n {\n-    if (fs::is_regular_file(wallet_path)) {\n+    const size_t offset = wallet_dir.string().size() + 1;\n+    std::vector<fs::path> paths;\n+    boost::system::error_code ec;\n+\n+    for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n+        if (ec) {\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n+            continue;\n+        }\n+\n+        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+        const fs::path path = it->path().string().substr(offset);\n+\n+        if (it->status().type() == fs::directory_file &&\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {\n+            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+            paths.emplace_back(path);\n+        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBDBFile(it->path())) {\n+            if (it->path().filename() == \"wallet.dat\") {\n+                // Found top-level wallet.dat btree file, add top level directory \"\"\n+                // as a wallet.\n+                paths.emplace_back();\n+            } else {\n+                // Found top-level btree file not called wallet.dat. Current bitcoin\n+                // software will never create these files but will allow them to be\n+                // opened in a shared database environment for backwards compatibility.\n+                // Add it to the list of available wallets.\n+                paths.emplace_back(path);\n+            }\n+        }\n+    }\n+\n+    return paths;\n+}\n+\n+fs::path BDBDataFile(const fs::path& path)\n+{\n+    if (fs::is_regular_file(path)) {\n         // Special case for backwards compatibility: if wallet path points to an\n         // existing file, treat it as the path to a BDB data file in a parent\n         // directory that also contains BDB log files.\n-        env_directory = wallet_path.parent_path();\n-        database_filename = wallet_path.filename().string();\n+        return path;\n     } else {\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n-        env_directory = wallet_path;\n-        database_filename = \"wallet.dat\";\n+        return path / \"wallet.dat\";\n     }\n }\n+\n+fs::path SQLiteDataFile(const fs::path& path)\n+{\n+    return path / \"wallet.dat\";\n+}\n+\n+bool IsBDBFile(const fs::path& path)\n+{\n+    if (!fs::exists(path)) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517387788",
      "id" : 517387788,
      "in_reply_to_id" : 515673173,
      "line" : 77,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM4Nzc4OA==",
      "original_commit_id" : "e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "original_line" : 77,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 81,
      "pull_request_review_id" : 523411141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517387788",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517388156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517388156"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515672776\r\n\r\n> Is it worth breaking this into a function so `IsSQLiteFile` can re-use this as well? With `minSize` is as parameter\r\n\r\nThis is preexisting code in a move-only function, but it seems like a reasonable thing to do. Not sure if you think this would be clearer or just minimize code or have another benefit.",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-04T14:35:17Z",
      "diff_hunk" : "@@ -3,23 +3,125 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <chainparams.h>\n #include <fs.h>\n+#include <logging.h>\n #include <wallet/db.h>\n \n #include <string>\n \n-void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)\n+std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n {\n-    if (fs::is_regular_file(wallet_path)) {\n+    const size_t offset = wallet_dir.string().size() + 1;\n+    std::vector<fs::path> paths;\n+    boost::system::error_code ec;\n+\n+    for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n+        if (ec) {\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n+            continue;\n+        }\n+\n+        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+        const fs::path path = it->path().string().substr(offset);\n+\n+        if (it->status().type() == fs::directory_file &&\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {\n+            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+            paths.emplace_back(path);\n+        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBDBFile(it->path())) {\n+            if (it->path().filename() == \"wallet.dat\") {\n+                // Found top-level wallet.dat btree file, add top level directory \"\"\n+                // as a wallet.\n+                paths.emplace_back();\n+            } else {\n+                // Found top-level btree file not called wallet.dat. Current bitcoin\n+                // software will never create these files but will allow them to be\n+                // opened in a shared database environment for backwards compatibility.\n+                // Add it to the list of available wallets.\n+                paths.emplace_back(path);\n+            }\n+        }\n+    }\n+\n+    return paths;\n+}\n+\n+fs::path BDBDataFile(const fs::path& path)\n+{\n+    if (fs::is_regular_file(path)) {\n         // Special case for backwards compatibility: if wallet path points to an\n         // existing file, treat it as the path to a BDB data file in a parent\n         // directory that also contains BDB log files.\n-        env_directory = wallet_path.parent_path();\n-        database_filename = wallet_path.filename().string();\n+        return path;\n     } else {\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n-        env_directory = wallet_path;\n-        database_filename = \"wallet.dat\";\n+        return path / \"wallet.dat\";\n     }\n }\n+\n+fs::path SQLiteDataFile(const fs::path& path)\n+{\n+    return path / \"wallet.dat\";\n+}\n+\n+bool IsBDBFile(const fs::path& path)\n+{\n+    if (!fs::exists(path)) return false;\n+\n+    // A Berkeley DB Btree file has at least 4K.\n+    // This check also prevents opening lock files.\n+    boost::system::error_code ec;\n+    auto size = fs::file_size(path, ec);\n+    if (ec) LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), path.string());\n+    if (size < 4096) return false;\n+\n+    fsbridge::ifstream file(path, std::ios::binary);\n+    if (!file.is_open()) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517388156",
      "id" : 517388156,
      "in_reply_to_id" : 515672776,
      "line" : 87,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM4ODE1Ng==",
      "original_commit_id" : "e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "original_line" : 87,
      "original_position" : 86,
      "original_start_line" : 72,
      "path" : "src/wallet/db.cpp",
      "position" : 91,
      "pull_request_review_id" : 523411141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : 77,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517388156",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517388847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517388847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/20275#discussion_r515673267\r\n\r\n> Do you need to close the file?\r\n\r\nNo need, it should be closed in the destructor. (Also this is more preexisting code in the move-only function)",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-04T14:36:13Z",
      "diff_hunk" : "@@ -3,23 +3,125 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <chainparams.h>\n #include <fs.h>\n+#include <logging.h>\n #include <wallet/db.h>\n \n #include <string>\n \n-void SplitWalletPath(const fs::path& wallet_path, fs::path& env_directory, std::string& database_filename)\n+std::vector<fs::path> ListDatabases(const fs::path& wallet_dir)\n {\n-    if (fs::is_regular_file(wallet_path)) {\n+    const size_t offset = wallet_dir.string().size() + 1;\n+    std::vector<fs::path> paths;\n+    boost::system::error_code ec;\n+\n+    for (auto it = fs::recursive_directory_iterator(wallet_dir, ec); it != fs::recursive_directory_iterator(); it.increment(ec)) {\n+        if (ec) {\n+            LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), it->path().string());\n+            continue;\n+        }\n+\n+        // Get wallet path relative to walletdir by removing walletdir from the wallet path.\n+        // This can be replaced by boost::filesystem::lexically_relative once boost is bumped to 1.60.\n+        const fs::path path = it->path().string().substr(offset);\n+\n+        if (it->status().type() == fs::directory_file &&\n+            (IsBDBFile(BDBDataFile(it->path())) || IsSQLiteFile(SQLiteDataFile(it->path())))) {\n+            // Found a directory which contains wallet.dat btree file, add it as a wallet.\n+            paths.emplace_back(path);\n+        } else if (it.level() == 0 && it->symlink_status().type() == fs::regular_file && IsBDBFile(it->path())) {\n+            if (it->path().filename() == \"wallet.dat\") {\n+                // Found top-level wallet.dat btree file, add top level directory \"\"\n+                // as a wallet.\n+                paths.emplace_back();\n+            } else {\n+                // Found top-level btree file not called wallet.dat. Current bitcoin\n+                // software will never create these files but will allow them to be\n+                // opened in a shared database environment for backwards compatibility.\n+                // Add it to the list of available wallets.\n+                paths.emplace_back(path);\n+            }\n+        }\n+    }\n+\n+    return paths;\n+}\n+\n+fs::path BDBDataFile(const fs::path& path)\n+{\n+    if (fs::is_regular_file(path)) {\n         // Special case for backwards compatibility: if wallet path points to an\n         // existing file, treat it as the path to a BDB data file in a parent\n         // directory that also contains BDB log files.\n-        env_directory = wallet_path.parent_path();\n-        database_filename = wallet_path.filename().string();\n+        return path;\n     } else {\n         // Normal case: Interpret wallet path as a directory path containing\n         // data and log files.\n-        env_directory = wallet_path;\n-        database_filename = \"wallet.dat\";\n+        return path / \"wallet.dat\";\n     }\n }\n+\n+fs::path SQLiteDataFile(const fs::path& path)\n+{\n+    return path / \"wallet.dat\";\n+}\n+\n+bool IsBDBFile(const fs::path& path)\n+{\n+    if (!fs::exists(path)) return false;\n+\n+    // A Berkeley DB Btree file has at least 4K.\n+    // This check also prevents opening lock files.\n+    boost::system::error_code ec;\n+    auto size = fs::file_size(path, ec);\n+    if (ec) LogPrintf(\"%s: %s %s\\n\", __func__, ec.message(), path.string());\n+    if (size < 4096) return false;\n+\n+    fsbridge::ifstream file(path, std::ios::binary);\n+    if (!file.is_open()) return false;\n+\n+    file.seekg(12, std::ios::beg); // Magic bytes start at offset 12\n+    uint32_t data = 0;\n+    file.read((char*) &data, sizeof(data)); // Read 4 bytes of file to compare against magic",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r517388847",
      "id" : 517388847,
      "in_reply_to_id" : 515673267,
      "line" : 91,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM4ODg0Nw==",
      "original_commit_id" : "e21dc6c05c02a0da18b9af2c0eb1d7996c378541",
      "original_line" : 91,
      "original_position" : 90,
      "original_start_line" : null,
      "path" : "src/wallet/db.cpp",
      "position" : 95,
      "pull_request_review_id" : 523411141,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-11-13T00:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/517388847",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Is this for 0.21?",
      "created_at" : "2020-11-04T15:05:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-721785786",
      "id" : 721785786,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTc4NTc4Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T15:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721785786",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Is this for 0.21?\r\n\r\nI'm not requesting it. I see this mostly as a code cleanup. For users, the only ones who would be affected would be those compiling from scratch and disabling sqlite, or maybe those using gentoo or nixos type packages with build customizations. The effect for these users at worst would be some confusion seeing incomplete wallet listings, or seeing scarier \"Data is not in recognized format\" error in place of \"Build does not support SQLite database format\"",
      "created_at" : "2020-11-04T17:01:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-721853805",
      "id" : 721853805,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMTg1MzgwNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T17:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/721853805",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> or seeing scarier \"Data is not in recognized format\"\r\n\r\nThe same error would also happen if the the user attempts to open sqlite wallet with previous versions.",
      "created_at" : "2020-11-04T22:54:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-722018320",
      "id" : 722018320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMjAxODMyMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-04T22:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/722018320",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Also, it would be hard to create a sqlite wallet with a non-sqlite build. Assigning 22.0 milestone",
      "created_at" : "2020-11-05T06:59:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-722184477",
      "id" : 722184477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyMjE4NDQ3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-05T06:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/722184477",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-12T01:50:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-725775422",
      "id" : 725775422,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNTc3NTQyMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-12T01:50:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/725775422",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased e21dc6c05c02a0da18b9af2c0eb1d7996c378541 -> 417e95a97b4e00a9add97d94ce3b9c38904a354b ([`pr/exist.1`](https://github.com/ryanofsky/bitcoin/commits/pr/exist.1) -> [`pr/exist.2`](https://github.com/ryanofsky/bitcoin/commits/pr/exist.2), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/exist.1-rebase..pr/exist.2)) due to conflict with #19502\r\nRebased 417e95a97b4e00a9add97d94ce3b9c38904a354b -> 727e0aad58b41facf55bbedfc5de45b2c41a98ae ([`pr/exist.2`](https://github.com/ryanofsky/bitcoin/commits/pr/exist.2) -> [`pr/exist.3`](https://github.com/ryanofsky/bitcoin/commits/pr/exist.3), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/exist.2-rebase..pr/exist.3)) due to conflict with #18836",
      "created_at" : "2020-11-13T15:33:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-726830756",
      "id" : 726830756,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNjgzMDc1Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T12:49:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/726830756",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r523073986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523073986"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Prefer to keep unreachable code under an `#else` here",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-13T16:47:27Z",
      "diff_hunk" : "@@ -1050,13 +1050,14 @@ std::unique_ptr<WalletDatabase> MakeDatabase(const fs::path& path, const Databas\n     // Format is not set when a db doesn't already exist, so use the format specified by the options if it is set.\n     if (!format && options.require_format) format = options.require_format;\n \n-#ifdef USE_SQLITE\n     if (format && format == DatabaseFormat::SQLITE) {\n+#ifdef USE_SQLITE\n         return MakeSQLiteDatabase(path, options, status, error);\n-    }\n-#else\n-    assert(format != DatabaseFormat::SQLITE);\n #endif\n+        error = Untranslated(strprintf(\"Failed to load database path '%s'. Build does not support SQLite database format.\", path.string()));\n+        status = DatabaseStatus::FAILED_BAD_FORMAT;\n+        return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r523073986",
      "id" : 523073986,
      "line" : 1059,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA3Mzk4Ng==",
      "original_commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "original_line" : 1059,
      "original_position" : 14,
      "original_start_line" : 1057,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 36,
      "pull_request_review_id" : 530223782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : 1057,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-13T16:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523073986",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r523093981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523093981"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Prefer to keep unreachable code under an `#else` here\r\n\r\nPrefer not to so there is less unnecessary variation between build configurations, and so code is checked by the compiler.",
      "commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "created_at" : "2020-11-13T17:09:42Z",
      "diff_hunk" : "@@ -1050,13 +1050,14 @@ std::unique_ptr<WalletDatabase> MakeDatabase(const fs::path& path, const Databas\n     // Format is not set when a db doesn't already exist, so use the format specified by the options if it is set.\n     if (!format && options.require_format) format = options.require_format;\n \n-#ifdef USE_SQLITE\n     if (format && format == DatabaseFormat::SQLITE) {\n+#ifdef USE_SQLITE\n         return MakeSQLiteDatabase(path, options, status, error);\n-    }\n-#else\n-    assert(format != DatabaseFormat::SQLITE);\n #endif\n+        error = Untranslated(strprintf(\"Failed to load database path '%s'. Build does not support SQLite database format.\", path.string()));\n+        status = DatabaseStatus::FAILED_BAD_FORMAT;\n+        return nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#discussion_r523093981",
      "id" : 523093981,
      "in_reply_to_id" : 523073986,
      "line" : 1059,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA5Mzk4MQ==",
      "original_commit_id" : "417e95a97b4e00a9add97d94ce3b9c38904a354b",
      "original_line" : 1059,
      "original_position" : 14,
      "original_start_line" : 1057,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 36,
      "pull_request_review_id" : 530246886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/20275",
      "side" : "RIGHT",
      "start_line" : 1057,
      "start_side" : "RIGHT",
      "updated_at" : "2020-11-13T17:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/523093981",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-16T10:47:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-727898977",
      "id" : 727898977,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcyNzg5ODk3Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-16T10:47:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/727898977",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-11-23T10:41:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-732076693",
      "id" : 732076693,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczMjA3NjY5Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-11-23T10:41:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/732076693",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 727e0aad58b41facf55bbedfc5de45b2c41a98ae -> f3d870fc2271bf45e0269e5ae135bced1a26f620 ([`pr/exist.3`](https://github.com/ryanofsky/bitcoin/commits/pr/exist.3) -> [`pr/exist.4`](https://github.com/ryanofsky/bitcoin/commits/pr/exist.4), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/exist.3-rebase..pr/exist.4)) due to conflict with #20202. #20202 added some new code that was originally part of this PR so this PR is a little simpler now.",
      "created_at" : "2020-12-04T21:13:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-739023926",
      "id" : 739023926,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTAyMzkyNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-04T21:13:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739023926",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-12-07T08:29:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-739760389",
      "id" : 739760389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczOTc2MDM4OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-07T08:29:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/739760389",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@achow101 @promag you ACKed this previously and might be interested to reACK. There haven't been any changes except rebasing on top of #20202 making this PR a little smaller (new `MakeDatabase` code originally added here got added in #20202 instead)",
      "created_at" : "2020-12-11T15:36:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743265207",
      "id" : 743265207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzI2NTIwNw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-11T15:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743265207",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK f3d870fc2271bf45e0269e5ae135bced1a26f620",
      "created_at" : "2020-12-11T17:50:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743335864",
      "id" : 743335864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzMzNTg2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-11T17:50:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743335864",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK f3d870fc2271bf45e0269e5ae135bced1a26f620. Tested a --without-sqlite build with sqlite wallets.\r\n\r\n > Startup fails if any wallets `-wallet` or settings.json is sqlite.\r\n\r\nThis still happens - specifying sqlite wallet on a --without-sqlite build at command line (or settings.json) leads to startup failure. Not sure if this is expected or if it should just ignore it. Note that startup succeeds if you specify a wallet that doesn't exists.\r\n\r\n",
      "created_at" : "2020-12-11T23:19:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743475959",
      "id" : 743475959,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzQ3NTk1OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-11T23:19:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743475959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> This still happens - specifying sqlite wallet on a --without-sqlite build at command line (or settings.json) leads to startup failure. Not sure if this is expected or if it should just ignore it. Note that startup succeeds if you specify a wallet that doesn't exists.\r\n\r\nDoes the PR cause this somehow? Or is this a preexisting bug not related to the PR?",
      "created_at" : "2020-12-12T00:24:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743501540",
      "id" : 743501540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzUwMTU0MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T00:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743501540",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Existing behavior is to fail startup if -wallet points to a unknown file format. In this case it's a known but unsupported file format. I'm fine with both outcomes.",
      "created_at" : "2020-12-12T00:28:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743507573",
      "id" : 743507573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzUwNzU3Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T00:28:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743507573",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't understand what's being reported still. AFAIK, before this PR this case failed at startup, and after this PR it still fails at startup. But before this PR the error message was misleading, and after this PR the error message is more accurate.\r\n\r\nIf the only thing that's changing is the error message, that's good to know and thanks for testing it. But if something else is changing here besides the message, that's not intended, and is probably something that should be fixed here or at least noted in the PR description.",
      "created_at" : "2020-12-12T00:44:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743530336",
      "id" : 743530336,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzUzMDMzNg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T00:44:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743530336",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "That's my question - If it should remain a startup error of if it should be ignored since now it's a known wallet format wallet. If the user loads a sqlite wallet, it's saved on settings, then restart with a --without-sqlite build will always fail.",
      "created_at" : "2020-12-12T00:50:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743538042",
      "id" : 743538042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzUzODA0Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T00:54:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743538042",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> That's my question - If it should remain a startup error of if it should be ignored since now it's a known wallet format wallet. If the user loads a sqlite wallet, it's saved on settings, then restart with a --without-sqlite build will always fail.\r\n\r\nThese are different questions. I'm asking what *does* happen, and you are asking what *should* happen. It sounds like in the last sentence you are confirming that the PR description here is accurate, and the PR is behaving as expected, and that only change before this PR and after this PR is that some error text is slightly improved.\r\n\r\nIf this is correct, then the answer to your question about what should happen is a matter of opinion. My opinion is that any of the 4 alternatives in https://github.com/bitcoin-core/gui/issues/95#issuecomment-694236940 would be a good solution. I like alternative 4 in that list the best, but there a lot of good options. But this issue seems only vaguely related to this PR if the only effect of this PR is tweaking and improving the error text, so it probably should be discussed separately.\r\n\r\n\r\n\r\n\r\n\r\n",
      "created_at" : "2020-12-12T01:10:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743567195",
      "id" : 743567195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzU2NzE5NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T01:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743567195",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> you are confirming that the PR description here is accurate, and the PR is behaving as expected\r\n\r\nYes, that's what I ACK'ed above.\r\n\r\nAh I keep forgetting bitcoin-core/gui#95 :weary: thanks for pointing it.",
      "created_at" : "2020-12-12T01:35:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743602790",
      "id" : 743602790,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzYwMjc5MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T01:35:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743602790",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for testing and clarifying! Sorry I didn't understand right away.",
      "created_at" : "2020-12-12T01:39:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/20275#issuecomment-743608597",
      "id" : 743608597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/20275",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDc0MzYwODU5Nw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-12T01:39:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/743608597",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
