{
   "assignee" : null,
   "body" : "If new blocks are announced while a node is currently still downloading the headers, it starts to request the same headers multiple times.  See https://github.com/bitcoin/bitcoin/issues/6755.\r\n\r\nWith this patch, the client tries to guess whether it is still in the initial headers sync and avoids starting the duplicate requests if it is.  I explained in comments in the code why this is safe.  Here's a summary:\r\n\r\nIn general, I tried to be \"conservative\" when deciding to prevent a request.  The node only thinks it is in the initial headers sync when it last received a `headers` message with full size (2,000 headers), building on top of its currently known best header, and at least 12 of the headers were previously unknown.  If an attacker wants to fake this condition to a node that is actually up-to-date (to prevent it from getting a newly announced block), he or she needs to construct 12 headers with valid PoW; this seems like a lot of effort for a not-so-critical effect.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6821/comments",
   "created_at" : "2015-10-13T17:58:25Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6821/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/6821",
   "id" : 111234818,
   "labels" : [
      {
         "color" : "006b75",
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6821/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 6821,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/6821.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6821",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/6821.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6821"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Avoid duplicate getheaders requests",
   "updated_at" : "2015-10-20T10:34:44Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6821",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4943644?v=3",
      "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
      "followers_url" : "https://api.github.com/users/domob1812/followers",
      "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
      "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/domob1812",
      "id" : 4943644,
      "login" : "domob1812",
      "organizations_url" : "https://api.github.com/users/domob1812/orgs",
      "received_events_url" : "https://api.github.com/users/domob1812/received_events",
      "repos_url" : "https://api.github.com/users/domob1812/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/domob1812"
   }
}
