[
   {
      "body" : "https://github.com/bitcoin/bitcoin/pull/6872",
      "created_at" : "2015-10-23T06:42:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-150489970",
      "id" : 150489970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-23T06:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/150489970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "#6872 is likely unrelated. The issue seems to be something stemming from getblocktemplate-related memory usage.",
      "created_at" : "2015-10-23T09:22:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-150525984",
      "id" : 150525984,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-23T09:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/150525984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Has anyone tried the Qt version to see if it has the same problem? \r\n\r\nAnd BTW, are the release versions (of the daemon & Qt) compiled in debug mode?\r\n\r\nLast question: can a unit test be cobbled up to test for this memory issue?\r\n\r\nRon",
      "created_at" : "2015-10-23T14:04:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-150581313",
      "id" : 150581313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-23T14:04:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/150581313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5530763?v=3",
         "events_url" : "https://api.github.com/users/older-c-coder/events{/privacy}",
         "followers_url" : "https://api.github.com/users/older-c-coder/followers",
         "following_url" : "https://api.github.com/users/older-c-coder/following{/other_user}",
         "gists_url" : "https://api.github.com/users/older-c-coder/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/older-c-coder",
         "id" : 5530763,
         "login" : "older-c-coder",
         "organizations_url" : "https://api.github.com/users/older-c-coder/orgs",
         "received_events_url" : "https://api.github.com/users/older-c-coder/received_events",
         "repos_url" : "https://api.github.com/users/older-c-coder/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/older-c-coder/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/older-c-coder/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/older-c-coder"
      }
   },
   {
      "body" : "#6872 may be related. CreateNewBlock() makes fairly extensive use of CCoinsViewCache. I ran a short (4 hour) test with valgrind --tool=massif, and CCoinsViewCache came up as using a lot of memory. A much longer test run is needed for this apparent memory leak issue to show up clearly. I'm about 24 hours into what I plan to be a 40- or 50-hour massif test. I'll post those results when I have them. It might take even longer than 50 hours for massif to get good results. it's taking 30 seconds for valgrind bitcoind to get through a getblocktemplate call, rather than the usual <= 1 sec. I don't know if the leak is related simply to the number of times GBT is called, or if it depends on the uniqueness of the mempool each time GBT is called.\r\n\r\n@older-c-coder I have not tested with Qt. A unit test would likely be difficult to write, since the issue is only apparent in terms of RSS usage after calling GBT frequently for around 24 hours. It's possible that this process might be accelerated (e.g. create a fake mempool from block X, run GBT/CNB, X++;, etc). Even then, such a test is likely to take a while, and we don't yet know if that approach will work at triggering the leak. ",
      "created_at" : "2015-10-23T20:09:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-150677677",
      "id" : 150677677,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-23T20:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/150677677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "There has been IRC discussion of this in bitcoin-core-dev on the [20th](https://botbot.me/freenode/bitcoin-core-dev/2015-10-20/?msg=52335129&page=1) and [21st](https://botbot.me/freenode/bitcoin-core-dev/2015-10-21/?msg=52437191&page=2).  \r\nI do not think there is an actual \"leak\".  The increased memory usage is mostly a result of the not actually limited size of CCoinsViewCache discussed in #6872 combined with poor memory allocator behavior.  \r\nThe problem is triggered by calling getblocktemplate which calls `CreateNewBlock`.  In `CreateNewBlock` every single tx in your memory pool is pulled into the in memory cache of both pcoins tip and a cache `view` on top of that.  The memory allocator also causes this memory to be allocated in a different location for every thread that calls getblocktemplate.  Although this memory is freed at the end of `CreateNewBlock`, there seems to be enough fragmentation that there is still some memory being used towards the end of the heap and the bulk of the memory can not be returned to the OS.  This can cause up to # of RPC threads (default: 4) times the memory allocation needed for 1 full memory pool worth of chainstate to remain resident.  In addition, depending on the size of your dbcache, if one of the calls to getblocktemplate causes a rehash of the unordered map in your pcoinsTip cache, then that can also take up space in another memory arena because now it has been allocated from a different thread.\r\n\r\nI'm working on a short term smaller rewrite of `CreateNewBlock` which will not require pulling the entire memory pool worth of txs into the cache, which should make the problem much better.",
      "created_at" : "2015-10-24T12:58:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-150809590",
      "id" : 150809590,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-24T12:58:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/150809590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "http://toom.im/files/massif.out.27357.log\r\nOr the raw output, if you want to run ms_print on it with your own options:\r\nhttp://toom.im/files/massif.out.27357\r\n\r\n(For best viewing, disable word wrap, like with `less -S massif.out.27357.log`.)\r\n\r\nThe highest memory usage appears to be at timestamp 47. Search for \"47 68\" to jump there. It looks like at that time, a total 46.64% of the heap (411 MB) was in use by CCoinsViewCache via HTTPReq_JSONRPC and CreateNewBlock. The two offending lines in miner.cpp appear to be 175 `if (!view.HaveCoins(txin.prevout.hash))` and 348 `if (!TestBlockValidity(state, *pblock, previndexPrev, false, false))`, the latter of which results in a HaveCoins call later.",
      "created_at" : "2015-10-24T17:05:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-150834379",
      "id" : 150834379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-25T17:39:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/150834379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "TL.DR from IRC: this seems specific to the glibc multi-thread arena memory allocator. The application deallocates the memory properly, but pages are not given back to the system after deallocation (probably due to fragmentation allocating lots of small objects). Workaround that we determined on IRC is `export MALLOC_ARENA_MAX=1`, see https://gist.github.com/laanwj/efe29c7661ce9b6620a7#linux-specific\r\n",
      "created_at" : "2015-10-26T06:59:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151045764",
      "id" : 151045764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-26T06:59:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151045764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Can confirm the work around works. ( export MALLOC_ARENA_MAX=1 )",
      "created_at" : "2015-10-26T23:46:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151315899",
      "id" : 151315899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-26T23:46:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151315899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "Seems to be working for me too. 724M RSS after 10 hours. Ten hours isn't long enough to be certain. I'll chirp in tomorrow if it's still a problem.\r\n\r\nEdit: it's a day later, and RSS is at 1020 MB. Normally, I would expect memory usage near 1500 MB by now. Seems that MALLOC_ARENA_MAX is working.",
      "created_at" : "2015-10-27T00:02:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151318394",
      "id" : 151318394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T00:20:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151318394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "2.9G RSS after restarting with export MALLOC_ARENA_MAX=1 this morning (about 14 hours ago).  Still undesirably high imo.",
      "created_at" : "2015-10-27T05:02:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151376476",
      "id" : 151376476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-27T05:03:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151376476",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3866398?v=3",
         "events_url" : "https://api.github.com/users/flound1129/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flound1129/followers",
         "following_url" : "https://api.github.com/users/flound1129/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flound1129/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flound1129",
         "id" : 3866398,
         "login" : "flound1129",
         "organizations_url" : "https://api.github.com/users/flound1129/orgs",
         "received_events_url" : "https://api.github.com/users/flound1129/received_events",
         "repos_url" : "https://api.github.com/users/flound1129/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flound1129/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flound1129/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flound1129"
      }
   },
   {
      "body" : "@flound1129 what platform are you on, and what is your -maxmempool setting and -dbcache setting?",
      "created_at" : "2015-10-28T00:20:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151682010",
      "id" : 151682010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T00:20:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151682010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "# uname -a\r\nLinux p1 3.13.0-65-generic #106-Ubuntu SMP Fri Oct 2 22:08:27 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n# lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 14.04.3 LTS\r\nRelease:        14.04\r\nCodename:       trusty\r\n\r\nhaven't changed maxmempool or dbcache setting from defaults.",
      "created_at" : "2015-10-28T05:48:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151732539",
      "id" : 151732539,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T05:48:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151732539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3866398?v=3",
         "events_url" : "https://api.github.com/users/flound1129/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flound1129/followers",
         "following_url" : "https://api.github.com/users/flound1129/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flound1129/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flound1129",
         "id" : 3866398,
         "login" : "flound1129",
         "organizations_url" : "https://api.github.com/users/flound1129/orgs",
         "received_events_url" : "https://api.github.com/users/flound1129/received_events",
         "repos_url" : "https://api.github.com/users/flound1129/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flound1129/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flound1129/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flound1129"
      }
   },
   {
      "body" : "Wait, are you running master with the mempool limiting stuff in, or a released version?\n\nOn October 27, 2015 10:49:02 PM PDT, Adam McKenna <notifications@github.com> wrote:\n># uname -a\n>Linux p1 3.13.0-65-generic #106-Ubuntu SMP Fri Oct 2 22:08:27 UTC 2015\n>x86_64 x86_64 x86_64 GNU/Linux\n># lsb_release -a\n>No LSB modules are available.\n>Distributor ID: Ubuntu\n>Description:    Ubuntu 14.04.3 LTS\n>Release:        14.04\n>Codename:       trusty\n>\n>haven't changed maxmempool or dbcache setting from defaults.\n>\n>---\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151732539\n",
      "created_at" : "2015-10-28T05:55:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151733716",
      "id" : 151733716,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T05:55:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151733716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "This is on 0.11.1",
      "created_at" : "2015-10-28T15:44:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151887759",
      "id" : 151887759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T15:44:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151887759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3866398?v=3",
         "events_url" : "https://api.github.com/users/flound1129/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flound1129/followers",
         "following_url" : "https://api.github.com/users/flound1129/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flound1129/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flound1129",
         "id" : 3866398,
         "login" : "flound1129",
         "organizations_url" : "https://api.github.com/users/flound1129/orgs",
         "received_events_url" : "https://api.github.com/users/flound1129/received_events",
         "repos_url" : "https://api.github.com/users/flound1129/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flound1129/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flound1129/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flound1129"
      }
   },
   {
      "body" : "0.11.1 doesn't have any memory limits at all for the memory pool.\n",
      "created_at" : "2015-10-28T15:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151887992",
      "id" : 151887992,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T15:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151887992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "So you're saying this issue is fixed in master?  Or you would like me to test with master?  My mempool is only around 162 megs.",
      "created_at" : "2015-10-28T15:52:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151890145",
      "id" : 151890145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T15:52:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151890145",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3866398?v=3",
         "events_url" : "https://api.github.com/users/flound1129/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flound1129/followers",
         "following_url" : "https://api.github.com/users/flound1129/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flound1129/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flound1129",
         "id" : 3866398,
         "login" : "flound1129",
         "organizations_url" : "https://api.github.com/users/flound1129/orgs",
         "received_events_url" : "https://api.github.com/users/flound1129/received_events",
         "repos_url" : "https://api.github.com/users/flound1129/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flound1129/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flound1129/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flound1129"
      }
   },
   {
      "body" : "No, sipa is saying there are two possible reasons why your memory consumption could be high. One reason is that you are running into the multi-arena allocating/fragmentation bug described here in this issue, #6876. The other is that your mempool is getting bloated from the flood of 14780 byte transactions we're seeing right now.\r\n\r\nTry sticking `minrelaytxfee=0.0002` into your `~/.bitcoin/bitcoin.conf` file, or running with the `minrelaytxfee=0.0001` command line option. That should reduce your mempool size by about 161 megs.",
      "created_at" : "2015-10-28T16:00:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151892614",
      "id" : 151892614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T16:00:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151892614",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "I'm not worried about having a large mempool, or really even worried about 3GB of total usage.  I'm only concerned if there is an actual leak.",
      "created_at" : "2015-10-28T17:03:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151910794",
      "id" : 151910794,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-28T17:03:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151910794",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3866398?v=3",
         "events_url" : "https://api.github.com/users/flound1129/events{/privacy}",
         "followers_url" : "https://api.github.com/users/flound1129/followers",
         "following_url" : "https://api.github.com/users/flound1129/following{/other_user}",
         "gists_url" : "https://api.github.com/users/flound1129/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/flound1129",
         "id" : 3866398,
         "login" : "flound1129",
         "organizations_url" : "https://api.github.com/users/flound1129/orgs",
         "received_events_url" : "https://api.github.com/users/flound1129/received_events",
         "repos_url" : "https://api.github.com/users/flound1129/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/flound1129/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/flound1129/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/flound1129"
      }
   },
   {
      "body" : "I dont think we've seen any evidence of an actual leak, just bloated mempools and poor memory allocation algorithms.",
      "created_at" : "2015-10-29T01:45:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-152049187",
      "id" : 152049187,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-10-29T01:45:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/152049187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I was seeing this as well on my pool's node, it would appear setting limitfreerelay=0 resolves it. This bug appears to cause severe GBT latency that gets worse the longer your node is up. Using my [pool block update bench-marking](http://poolbench.antminer.link/) tool my pool went from near the bottom of the list to the top by simply setting limitfreerelay=0. My guess is there is a bug or leak related to mempool handling of free transactions.",
      "created_at" : "2015-11-07T19:22:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-154741129",
      "id" : 154741129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-11-07T19:23:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154741129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "Large mempools result in slow GBT calls. This is not a memory leak as far\nas we know, just not sufficiently optimized code, and no actual limit on\nthe mempool's size.\n\nThere is a lot of active work around improving that. One is the mempool\nlimiting code (which has been merged into master already, but not yet in a\nrelease). There are also pull requests in flight to rewrite or otherwise\noptimize its performance using precomputed indexes.\n",
      "created_at" : "2015-11-07T19:27:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-154741332",
      "id" : 154741332,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-11-07T19:27:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154741332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I noticed there was a massive discrepancy between \"currentblocksize\" : 473630 from getmininginfo and \"bytes\" : 6934459 from getmempoolinfo even thought the transaction count was roughly the same between those two RPC calls, setting limitfreerelay=0 resolved that and they now match. BTW I also run minrelaytxfee=0.0001.",
      "created_at" : "2015-11-07T19:29:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-154741467",
      "id" : 154741467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-11-07T19:32:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154741467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   },
   {
      "body" : "I believe jameshillard's issue to be different from the memory fragmentation issue reported in this thread. As far as I understand it from IRC, he was getting a lot of the 14790 txns into his mempool via limitfreerelay=default, like these two (from his getrawmempool RPC):\r\n\r\nhttps://www.blocktrail.com/BTC/tx/951761082b38167ca92a94cce9f0783157434ffc66ff39715b1ac30a72cd6611\r\n\r\nhttps://www.blocktrail.com/BTC/tx/5935e25d931734e42e0fff881df79ea9e0d3f4c9d552e9ac20f8825b29049f0a\r\n\r\nThese two transactions were never getting evicted from his mempool, and were not getting incorporated into blocks by other miners. These were 2 of the 4 transactions that I checked, indicating that very roughly 50% of his mempool was filled with spam. Much more of them were in his mempool than could fit in his 5% priority block space, so his GBT block sizes were kept small even though his mempool was bloated. He was complaining of mempool size, not of RSS usage. I do not think he was encountering any bugs, just features that he did not understand and that may have not been designed optimally in terms of UX.",
      "created_at" : "2015-11-07T20:02:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-154743572",
      "id" : 154743572,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-11-07T20:05:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154743572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "\"Using my pool block update bench-marking tool my pool went from near the bottom of the list to the top by simply setting limitfreerelay=0.\" -- Actually, it's probably just that you restarted your server, which clears out the mempool. Setting limitfreerelay=0 would change the long-term slope of your GBT latency graph and mempool size to be closer or equal to zero, but the y intercept will be low in any case.",
      "created_at" : "2015-11-07T20:04:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-154743654",
      "id" : 154743654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-11-07T20:04:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154743654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "body" : "> Actually, it's probably just that you restarted your server, which clears out the mempool.\r\n\r\nI've let it run for long enough that I don't think that's the issue, before setting that flag GBT performance would degrade in a matter of hours. After changing limitfreerelay to 0, \"currentblocksize\" from getmininginfo and \"bytes\" from getmempoolinfo are now the same. The transaction counts were always roughly the same between getmininginfo and getmempoolinfo before and after this change, I guess it's possible that there were some extremely large free transactions taking up all the space.\r\n\r\n> Setting limitfreerelay=0 would change the long-term slope of your GBT latency graph and mempool size to be closer or equal to zero, but the y intercept will be low in any case.\r\n\r\nThe issue wasn't with the y intercept it was that it was sloping up over time.",
      "created_at" : "2015-11-07T20:21:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-154744891",
      "id" : 154744891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6876",
      "updated_at" : "2015-11-07T20:21:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154744891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3298484?v=3",
         "events_url" : "https://api.github.com/users/jameshilliard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jameshilliard/followers",
         "following_url" : "https://api.github.com/users/jameshilliard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jameshilliard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jameshilliard",
         "id" : 3298484,
         "login" : "jameshilliard",
         "organizations_url" : "https://api.github.com/users/jameshilliard/orgs",
         "received_events_url" : "https://api.github.com/users/jameshilliard/received_events",
         "repos_url" : "https://api.github.com/users/jameshilliard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jameshilliard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jameshilliard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jameshilliard"
      }
   }
]
