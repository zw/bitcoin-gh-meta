[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442521966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442521966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe)\r\n\r\nThink need to replace `file_path` with `(walletDir / strFile)` here not just `walletDir`",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T21:50:34Z",
      "diff_hunk" : "@@ -292,33 +292,22 @@ BerkeleyBatch::SafeDbt::operator Dbt*()\n     return &m_dbt;\n }\n \n-bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str& errorStr)\n+bool BerkeleyDatabase::Verify(bilingual_str& errorStr)\n {\n-    std::string walletFile;\n-    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n     fs::path walletDir = env->Directory();\n \n     LogPrintf(\"Using BerkeleyDB version %s\\n\", BerkeleyDatabaseVersion());\n-    LogPrintf(\"Using wallet %s\\n\", file_path.string());\n+    LogPrintf(\"Using wallet %s\\n\", walletDir.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442521966",
      "id" : 442521966,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyMTk2Ng==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 300,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433672001,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442521966",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442522858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442522858"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe)\r\n\r\nAssigning null should be redundant after calling reset",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T21:52:49Z",
      "diff_hunk" : "@@ -141,10 +141,13 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->Verify(error)) {\n             tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n             return false;\n         }\n+        database.reset();\n+        database = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442522858",
      "id" : 442522858,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyMjg1OA==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 150,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433672001,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442522858",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442523873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442523873"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe)\r\n\r\nWould be a change in behavior, but probably more useful to print `walletDir / strFile` than `strFile` here",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T21:55:30Z",
      "diff_hunk" : "@@ -292,33 +292,22 @@ BerkeleyBatch::SafeDbt::operator Dbt*()\n     return &m_dbt;\n }\n \n-bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str& errorStr)\n+bool BerkeleyDatabase::Verify(bilingual_str& errorStr)\n {\n-    std::string walletFile;\n-    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n     fs::path walletDir = env->Directory();\n \n     LogPrintf(\"Using BerkeleyDB version %s\\n\", BerkeleyDatabaseVersion());\n-    LogPrintf(\"Using wallet %s\\n\", file_path.string());\n+    LogPrintf(\"Using wallet %s\\n\", walletDir.string());\n \n     if (!env->Open(true /* retry */)) {\n         errorStr = strprintf(_(\"Error initializing wallet database environment %s!\"), walletDir);\n         return false;\n     }\n \n-    return true;\n-}\n-\n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, bilingual_str& errorStr)\n-{\n-    std::string walletFile;\n-    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n-    fs::path walletDir = env->Directory();\n-\n-    if (fs::exists(walletDir / walletFile))\n+    if (fs::exists(walletDir / strFile))\n     {\n-        if (!env->Verify(walletFile)) {\n-            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage or restoring a backup.\"), walletFile);\n+        if (!env->Verify(strFile)) {\n+            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage or restoring a backup.\"), strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442523873",
      "id" : 442523873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyMzg3Mw==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 310,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433672001,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442523873",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442527386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442527386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe)\r\n\r\nIt doesn't seem like there is a point to calling Verify here in `SalvageWallet` when `ExecuteWalletToolFunc` already called it immediately before calling this. It seems like this `SalvageWallet` function could just be dropped and `ExecuteWalletToolFunc` just call `RecoverDatabaseFile` directly.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T22:04:24Z",
      "diff_hunk" : "@@ -112,7 +112,7 @@ static bool SalvageWallet(const fs::path& path)\n     // Initialize the environment before recovery\n     bilingual_str error_string;\n     try {\n-        WalletBatch::VerifyEnvironment(path, error_string);\n+        database->Verify(error_string);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442527386",
      "id" : 442527386,
      "line" : 115,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyNzM4Ng==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 115,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 5,
      "pull_request_review_id" : 433672001,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442527386",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442532065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442532065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe)\r\n\r\nThere is a change in behavior here for the wallettool \"info\" and \"salvage\" commands. Previously these commands were just seeing if the environment could be opened here and not actually verifying anything (VerifyEnvironment method name was kind of a misnomer). Now \"info\" and \"salvage\" will be actually verifying the database before working, so they will be little slower, and maybe more useful or maybe less useful than before depending on if your database is corrupt and what you are trying to do.\r\n\r\nCould preserve previous behavior by adding a `Database::VerifyWalletNotInUse()` method that would just call env::Open and do what the previous code used to do here. Another option for preserving previous behavior would be to call the `Database::ReloadDbEnv` method here, which should be effectively be equivalent to the previous VerifyEnvironment.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T22:17:33Z",
      "diff_hunk" : "@@ -141,10 +141,13 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->Verify(error)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442532065",
      "id" : 442532065,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUzMjA2NQ==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 145,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433672001,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442532065",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442560835"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442560835"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T23:54:02Z",
      "diff_hunk" : "@@ -292,33 +292,22 @@ BerkeleyBatch::SafeDbt::operator Dbt*()\n     return &m_dbt;\n }\n \n-bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str& errorStr)\n+bool BerkeleyDatabase::Verify(bilingual_str& errorStr)\n {\n-    std::string walletFile;\n-    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n     fs::path walletDir = env->Directory();\n \n     LogPrintf(\"Using BerkeleyDB version %s\\n\", BerkeleyDatabaseVersion());\n-    LogPrintf(\"Using wallet %s\\n\", file_path.string());\n+    LogPrintf(\"Using wallet %s\\n\", walletDir.string());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442560835",
      "id" : 442560835,
      "in_reply_to_id" : 442521966,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MDgzNQ==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 300,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433719367,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442560835",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442560856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442560856"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T23:54:08Z",
      "diff_hunk" : "@@ -141,10 +141,13 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->Verify(error)) {\n             tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n             return false;\n         }\n+        database.reset();\n+        database = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442560856",
      "id" : 442560856,
      "in_reply_to_id" : 442522858,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MDg1Ng==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 150,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433719400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442560856",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442560888"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442560888"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T23:54:15Z",
      "diff_hunk" : "@@ -292,33 +292,22 @@ BerkeleyBatch::SafeDbt::operator Dbt*()\n     return &m_dbt;\n }\n \n-bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str& errorStr)\n+bool BerkeleyDatabase::Verify(bilingual_str& errorStr)\n {\n-    std::string walletFile;\n-    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n     fs::path walletDir = env->Directory();\n \n     LogPrintf(\"Using BerkeleyDB version %s\\n\", BerkeleyDatabaseVersion());\n-    LogPrintf(\"Using wallet %s\\n\", file_path.string());\n+    LogPrintf(\"Using wallet %s\\n\", walletDir.string());\n \n     if (!env->Open(true /* retry */)) {\n         errorStr = strprintf(_(\"Error initializing wallet database environment %s!\"), walletDir);\n         return false;\n     }\n \n-    return true;\n-}\n-\n-bool BerkeleyBatch::VerifyDatabaseFile(const fs::path& file_path, bilingual_str& errorStr)\n-{\n-    std::string walletFile;\n-    std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, walletFile);\n-    fs::path walletDir = env->Directory();\n-\n-    if (fs::exists(walletDir / walletFile))\n+    if (fs::exists(walletDir / strFile))\n     {\n-        if (!env->Verify(walletFile)) {\n-            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage or restoring a backup.\"), walletFile);\n+        if (!env->Verify(strFile)) {\n+            errorStr = strprintf(_(\"%s corrupt. Try using the wallet tool bitcoin-wallet to salvage or restoring a backup.\"), strFile);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442560888",
      "id" : 442560888,
      "in_reply_to_id" : 442523873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MDg4OA==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 310,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 433719439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442560888",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442561512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442561512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since the database is closed before we reach this function, we need to reopen it before doing the recovery function. We could remove this and only close the database for `info` but that seems a bit like a hack.\r\n\r\nMaybe something to think about for a followup.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T23:56:24Z",
      "diff_hunk" : "@@ -112,7 +112,7 @@ static bool SalvageWallet(const fs::path& path)\n     // Initialize the environment before recovery\n     bilingual_str error_string;\n     try {\n-        WalletBatch::VerifyEnvironment(path, error_string);\n+        database->Verify(error_string);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442561512",
      "id" : 442561512,
      "in_reply_to_id" : 442527386,
      "line" : 115,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MTUxMg==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 115,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 5,
      "pull_request_review_id" : 433720110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442561512",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442561702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442561702"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added `VerifyNotInUse`. This function is still called by `Verify` so that the behavior of other `Verify` calls here won't change.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-18T23:57:10Z",
      "diff_hunk" : "@@ -141,10 +141,13 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->Verify(error)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442561702",
      "id" : 442561702,
      "in_reply_to_id" : 442532065,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MTcwMg==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 145,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 433720329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442561702",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19335 (wallet: Cleanup and separate BerkeleyDatabase and BerkeleyBatch by achow101)\n* #19334 (wallet: Introduce WalletDatabase abstract class by achow101)\n* #19325 (wallet: Refactor BerkeleyDatabase to introduce DatabaseBatch abstract class by achow101)\n* #19137 (wallettool: Add dump and createfromdump commands by achow101)\n* #19102 (wallet: Introduce and use DummyDatabase instead of dummy BerkeleyDatabase by achow101)\n* #19085 (Refactor: clean up PeriodicFlush() by jnewbery)\n* #19077 (wallet: Add sqlite as an alternative wallet database and use it for new descriptor wallets by achow101)\n* #18608 (refactor: Remove CAddressBookData::destdata by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-06-19T02:31:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#issuecomment-646400701",
      "id" : 646400701,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19324",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjQwMDcwMQ==",
      "updated_at" : "2020-07-01T18:26:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646400701",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 4693b11a896cd6b18e61bb3cdbfec72f7e0a2d93.\r\n\r\nNo strong opinion whether wallet tool info and salvage should verify.",
      "created_at" : "2020-06-20T10:33:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#issuecomment-646974593",
      "id" : 646974593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19324",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0Njk3NDU5Mw==",
      "updated_at" : "2020-06-20T10:33:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646974593",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r443123474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443123474"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think we use `assert(false)` anywhere, unless it is to specifically silence `-Wreturn-type`. Though, that doesn't seem to be the case here.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-20T11:23:39Z",
      "diff_hunk" : "@@ -3708,15 +3708,13 @@ bool CWallet::Verify(interfaces::Chain& chain, const WalletLocation& location, b\n     std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(wallet_path);\n \n     try {\n-        if (!WalletBatch::VerifyEnvironment(wallet_path, error_string)) {\n-            return false;\n-        }\n+        return database->Verify(error_string);\n     } catch (const fs::filesystem_error& e) {\n         error_string = Untranslated(strprintf(\"Error loading wallet %s. %s\", location.GetName(), fsbridge::get_filesystem_error_message(e)));\n         return false;\n     }\n \n-    return WalletBatch::VerifyDatabaseFile(wallet_path, error_string);\n+    assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r443123474",
      "id" : 443123474,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEyMzQ3NA==",
      "original_commit_id" : "4693b11a896cd6b18e61bb3cdbfec72f7e0a2d93",
      "original_line" : 3717,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 434421866,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443123474",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444268873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444268873"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (cba81c3272405332cbb2f3b9c6b2c828c1869d16)\r\n\r\nWould call this OpenEnvironment and make it private. Earlier suggestion to add a VerifyNotInUse method https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442532065 was to add a new method wallettool could call, not rename this method in a way which I think is misleading about what it does and how it's used outside of wallettool.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-23T14:29:33Z",
      "diff_hunk" : "@@ -292,11 +292,10 @@ BerkeleyBatch::SafeDbt::operator Dbt*()\n     return &m_dbt;\n }\n \n-bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str& errorStr)\n+bool BerkeleyDatabase::VerifyNotInUse(bilingual_str& errorStr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444268873",
      "id" : 444268873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2ODg3Mw==",
      "original_commit_id" : "cba81c3272405332cbb2f3b9c6b2c828c1869d16",
      "original_line" : 295,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 435842026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444268873",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444277894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444277894"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (cba81c3272405332cbb2f3b9c6b2c828c1869d16)\r\n\r\n> I've added `VerifyNotInUse`. This function is still called by `Verify` so that the behavior of other `Verify` calls here won't change.\r\n\r\nI think this open before open code in wallet tool can be dropped entirely. It seems like the only purpose of this is to show an \"Error loading %s. Is wallet being used by other process?\" string instead of an \"Error loading wallet. %s\" string",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-23T14:40:55Z",
      "diff_hunk" : "@@ -141,10 +141,12 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->VerifyNotInUse(error)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444277894",
      "id" : 444277894,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI3Nzg5NA==",
      "original_commit_id" : "cba81c3272405332cbb2f3b9c6b2c828c1869d16",
      "original_line" : 145,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 435842026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444277894",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444338499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444338499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've dropped this check and added the `env->Open` that `SalvageWallet` needs to `SalvageWallet`.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-23T16:04:59Z",
      "diff_hunk" : "@@ -141,10 +141,12 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->VerifyNotInUse(error)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444338499",
      "id" : 444338499,
      "in_reply_to_id" : 444277894,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzODQ5OQ==",
      "original_commit_id" : "cba81c3272405332cbb2f3b9c6b2c828c1869d16",
      "original_line" : 145,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 435933735,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444338499",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444338919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444338919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've reverted this back to the single `Verify` and dropped this method entirely as its only usage has also been removed.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-23T16:05:36Z",
      "diff_hunk" : "@@ -292,11 +292,10 @@ BerkeleyBatch::SafeDbt::operator Dbt*()\n     return &m_dbt;\n }\n \n-bool BerkeleyBatch::VerifyEnvironment(const fs::path& file_path, bilingual_str& errorStr)\n+bool BerkeleyDatabase::VerifyNotInUse(bilingual_str& errorStr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444338919",
      "id" : 444338919,
      "in_reply_to_id" : 444268873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzODkxOQ==",
      "original_commit_id" : "cba81c3272405332cbb2f3b9c6b2c828c1869d16",
      "original_line" : 295,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/bdb.cpp",
      "position" : null,
      "pull_request_review_id" : 435934264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444338919",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444524619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444524619"
         }
      },
      "author_association" : "NONE",
      "body" : "15tNMnu84FEsYbsavhHKmQTsNBCZBPg5EY",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-23T21:40:49Z",
      "diff_hunk" : "@@ -141,10 +141,13 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             return false;\n         }\n         bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n+        std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(path);\n+        if (!database->Verify(error)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444524619",
      "id" : 444524619,
      "in_reply_to_id" : 442532065,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUyNDYxOQ==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 145,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : null,
      "pull_request_review_id" : 436178342,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444524619",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/65382356?v=4",
         "events_url" : "https://api.github.com/users/kkarimalami/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kkarimalami/followers",
         "following_url" : "https://api.github.com/users/kkarimalami/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kkarimalami/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kkarimalami",
         "id" : 65382356,
         "login" : "kkarimalami",
         "node_id" : "MDQ6VXNlcjY1MzgyMzU2",
         "organizations_url" : "https://api.github.com/users/kkarimalami/orgs",
         "received_events_url" : "https://api.github.com/users/kkarimalami/received_events",
         "repos_url" : "https://api.github.com/users/kkarimalami/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kkarimalami/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kkarimalami/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kkarimalami"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444985693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444985693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was a suggestion from a review: https://github.com/bitcoin/bitcoin/pull/18971#discussion_r432987494",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-24T15:34:57Z",
      "diff_hunk" : "@@ -3708,15 +3708,13 @@ bool CWallet::Verify(interfaces::Chain& chain, const WalletLocation& location, b\n     std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(wallet_path);\n \n     try {\n-        if (!WalletBatch::VerifyEnvironment(wallet_path, error_string)) {\n-            return false;\n-        }\n+        return database->Verify(error_string);\n     } catch (const fs::filesystem_error& e) {\n         error_string = Untranslated(strprintf(\"Error loading wallet %s. %s\", location.GetName(), fsbridge::get_filesystem_error_message(e)));\n         return false;\n     }\n \n-    return WalletBatch::VerifyDatabaseFile(wallet_path, error_string);\n+    assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r444985693",
      "id" : 444985693,
      "in_reply_to_id" : 443123474,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk4NTY5Mw==",
      "original_commit_id" : "4693b11a896cd6b18e61bb3cdbfec72f7e0a2d93",
      "original_line" : 3717,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 436767653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444985693",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r445049176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445049176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If a function has a return type, but doesn't return anything, then compilation will fail due to `-Wreturn-type` (assuming warnings are errors). In fact the `assert(false)` will turn off `-Wreturn-type` for this function, so this runtime assert is making the code more fragile, harder to analyse and thus review.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-24T17:16:21Z",
      "diff_hunk" : "@@ -3708,15 +3708,13 @@ bool CWallet::Verify(interfaces::Chain& chain, const WalletLocation& location, b\n     std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(wallet_path);\n \n     try {\n-        if (!WalletBatch::VerifyEnvironment(wallet_path, error_string)) {\n-            return false;\n-        }\n+        return database->Verify(error_string);\n     } catch (const fs::filesystem_error& e) {\n         error_string = Untranslated(strprintf(\"Error loading wallet %s. %s\", location.GetName(), fsbridge::get_filesystem_error_message(e)));\n         return false;\n     }\n \n-    return WalletBatch::VerifyDatabaseFile(wallet_path, error_string);\n+    assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r445049176",
      "id" : 445049176,
      "in_reply_to_id" : 443123474,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA0OTE3Ng==",
      "original_commit_id" : "4693b11a896cd6b18e61bb3cdbfec72f7e0a2d93",
      "original_line" : 3717,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 436849787,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445049176",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r445067094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445067094"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've dropped this assert.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-24T17:48:12Z",
      "diff_hunk" : "@@ -3708,15 +3708,13 @@ bool CWallet::Verify(interfaces::Chain& chain, const WalletLocation& location, b\n     std::unique_ptr<WalletDatabase> database = CreateWalletDatabase(wallet_path);\n \n     try {\n-        if (!WalletBatch::VerifyEnvironment(wallet_path, error_string)) {\n-            return false;\n-        }\n+        return database->Verify(error_string);\n     } catch (const fs::filesystem_error& e) {\n         error_string = Untranslated(strprintf(\"Error loading wallet %s. %s\", location.GetName(), fsbridge::get_filesystem_error_message(e)));\n         return false;\n     }\n \n-    return WalletBatch::VerifyDatabaseFile(wallet_path, error_string);\n+    assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r445067094",
      "id" : 445067094,
      "in_reply_to_id" : 443123474,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2NzA5NA==",
      "original_commit_id" : "4693b11a896cd6b18e61bb3cdbfec72f7e0a2d93",
      "original_line" : 3717,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 436873351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445067094",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448024869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448024869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 17924a533346618531ed2c888c6e8fe67bc3851c\r\n\r\nThis change seems unrelated. Maybe put it into a preceding commit and explain what it does? I presume it removes a redundant check that is done as part of `LoadWallet`?",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-30T22:58:56Z",
      "diff_hunk" : "@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\n             return false;\n         }\n-        bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n-            return false;\n-        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448024869",
      "id" : 448024869,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAyNDg2OQ==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 147,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 17,
      "pull_request_review_id" : 440441502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448024869",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448025146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448025146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same commit\r\n\r\nThis also seems unrelated. Is it related to the change in `ExecuteWalletToolFunc`?",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-30T22:59:47Z",
      "diff_hunk" : "@@ -20,6 +20,11 @@ bool RecoverDatabaseFile(const fs::path& file_path)\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n+    if (!env->Open(true /* retry */)) {\n+        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        return false;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448025146",
      "id" : 448025146,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAyNTE0Ng==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 26,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 7,
      "pull_request_review_id" : 440441502,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448025146",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448027237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448027237"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 17924a533346618531ed2c888c6e8fe67bc3851c:\r\n\r\nAny reason to write to stderr when all other failures are written to the debug log? Since this is a pure utility function, I'd prefer if this returned the error string to the caller in the future, so that the caller can decide how to display the error",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-06-30T23:06:08Z",
      "diff_hunk" : "@@ -20,6 +20,11 @@ bool RecoverDatabaseFile(const fs::path& file_path)\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n+    if (!env->Open(true /* retry */)) {\n+        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448027237",
      "id" : 448027237,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAyNzIzNw==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 24,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 5,
      "pull_request_review_id" : 440444278,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448027237",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448482601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448482601"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-01T16:31:50Z",
      "diff_hunk" : "@@ -20,6 +20,11 @@ bool RecoverDatabaseFile(const fs::path& file_path)\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n+    if (!env->Open(true /* retry */)) {\n+        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        return false;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448482601",
      "id" : 448482601,
      "in_reply_to_id" : 448025146,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ4MjYwMQ==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 26,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 7,
      "pull_request_review_id" : 441027151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448482601",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448482971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448482971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "How is it unrelated? This function is being removed from `WalletBatch`.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-01T16:32:33Z",
      "diff_hunk" : "@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\n             return false;\n         }\n-        bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n-            return false;\n-        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448482971",
      "id" : 448482971,
      "in_reply_to_id" : 448024869,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ4Mjk3MQ==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 147,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 17,
      "pull_request_review_id" : 441027654,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448482971",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448483978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448483978"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It was to largely retain the previous behavior of this error going to stderr. I think that cleaning up this function to return error strings and remove the LogPrintfs in a followup.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-01T16:34:28Z",
      "diff_hunk" : "@@ -20,6 +20,11 @@ bool RecoverDatabaseFile(const fs::path& file_path)\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n+    if (!env->Open(true /* retry */)) {\n+        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448483978",
      "id" : 448483978,
      "in_reply_to_id" : 448027237,
      "line" : 24,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ4Mzk3OA==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 24,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 5,
      "pull_request_review_id" : 441028966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-01T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448483978",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Apparently the python linter on master fails here, so I've pushed a change to fix that.",
      "created_at" : "2020-07-01T16:37:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#issuecomment-652526168",
      "id" : 652526168,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19324",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjUyNjE2OA==",
      "updated_at" : "2020-07-01T16:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652526168",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK d8e9ca66d1 only change is test fixup \r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK d8e9ca66d1 only change is test fixup \r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjlKwwAwqUvc8WhUv1aYY1m9LSQcs/3dHt5UFdx7DRoPH2NBB4t2uZfxn/P8rcx\r\nxqfjWlLj4i6Ia5g0HhAunAo6aU7yooL2t+ZGCtPVprwNzzcYQyZkDiRe+lRNBIzG\r\n40lMOWuVpfVcIeYiDQcWtLf2uDyVkhWoSYmQBXsd6xn3tik5sLQMEVXOm12WfVDI\r\nwxpEyH/d6FkWOJPpZjWA5Hqce7BH7IbZkDb9dbJR3qEor+++NgjBUDjr1OtHqdcQ\r\nUjUOJw3LC93EjzMd2uLnjJaJMTxEEfTBRYXAM/vQrusAJo8PR76NXz1rUa2WDnLJ\r\n484QwqBxAPUYRmszSG7UoD2lM2GpxdWoZLdjscKe8SuwWjqe1yn2CRn3rUAEiZpR\r\nm7A4rlD54pwODWKD9HRyoZ4CJ22ljG9KjIhQaDpRxIuHbpV4xBOlRQGzpThmuk57\r\nZ2jeHaILIa0ypYA0oW5ZgLtg77vOO0Qfeu9B53HuITGH6W133nGTnVkbQvGmZv2+\r\n6SU9QC9G\r\n=sVVQ\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `7e2f395c7afce74dc863a67c21bbf3c3b75edbd4fb9a35f91c5cc23e1674a2a6  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401087e2f395c7afce74dc863a67c21bbf3c3b75edbd4fb9a35f91c5cc23e1674a2a6f010dcc7c49668222db59cf576abab85882508fff01045ec5f036d345a9cb995a9be28bd91c608f1045efd2725f0089312f6c5217242dc0083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff0108c73c80b0fef164e6ee3e314a4a9a03608f1045efd2726f00844f7ee188f9648020083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6dfff010e3a5762640565b6453576ba83f8fe36108f1045efd2725f008ba32b04048059c270083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267f010e3f2047af72e377125e0f87dfb559fbc08f1045efd2725f0081b59c1d7396aa72c0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "created_at" : "2020-07-02T00:15:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#issuecomment-652707350",
      "id" : 652707350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19324",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjcwNzM1MA==",
      "updated_at" : "2020-07-02T00:15:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652707350",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448684387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448684387"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was wrong. VerifyEnvironment is called via `LoadWallet -> LoadWalletInternal -> CWallet::Verify`, which is <strike>different from</strike> (edit: this was wrong) the `LoadWallet` call below.\r\n\r\nSo why is it ok to remove this call to `VerifyEnvironment`?",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-02T00:32:22Z",
      "diff_hunk" : "@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\n             return false;\n         }\n-        bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n-            return false;\n-        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448684387",
      "id" : 448684387,
      "in_reply_to_id" : 448024869,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4NDM4Nw==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 147,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 17,
      "pull_request_review_id" : 441276131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T12:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448684387",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448687191"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448687191"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`VerifyEnvironment` would just call `BerkeleyEnvironment::Open`. A couple of other things also call that in their normal operation. In particular, `CWallet::LoadWallet` creates a `WalletBatch` which creates a `BerkeleyBatch` which calls `BerkeleyEnvironment::Open` in its constructor.\r\n\r\nIn the cases where we need to open the environment and aren't using the higher level stuff, a direct call to `BerkeleyEnvironment::Open` is needed which is why it is added to `SalvageWallet`.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-02T00:43:36Z",
      "diff_hunk" : "@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\n             return false;\n         }\n-        bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n-            return false;\n-        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448687191",
      "id" : 448687191,
      "in_reply_to_id" : 448024869,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4NzE5MQ==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 147,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 17,
      "pull_request_review_id" : 441279178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T00:43:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448687191",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448951064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448951064"
         }
      },
      "author_association" : "MEMBER",
      "body" : "With \"unrelated\" I meant \"can be split up into its own atomic and logical commit without depending on other changes in this pull request\".\r\n\r\nSee the following commit on current master, which compiles fine and runs all tests fine as well:\r\n\r\n```\r\n$ git show \r\ncommit 43d120ec8a7a999a48ba31e2621efec06ca668f6 (HEAD)\r\nAuthor: MarcoFalke <falke.marco@gmail.com>\r\nDate:   Thu Jul 2 07:53:05 2020 -0400\r\n\r\n    wallet: Remove redundant WalletBatch::VerifyEnvironment\r\n    \r\n    It is redundant because LoadWallet will call CWallet::LoadWallet ->\r\n    LoadWalletInternal -> CWallet::Verify, which calls VerifyEnvironment\r\n    \r\n    For SalvageWallet it is redundant with the newly added call to Open\r\n\r\ndiff --git a/src/wallet/salvage.cpp b/src/wallet/salvage.cpp\r\nindex d42950ee42..e6e62332c0 100644\r\n--- a/src/wallet/salvage.cpp\r\n+++ b/src/wallet/salvage.cpp\r\n@@ -20,6 +20,11 @@ bool RecoverDatabaseFile(const fs::path& file_path)\r\n     std::string filename;\r\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\r\n \r\n+    if (!env->Open(true /* retry */)) {\r\n+        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\r\n+        return false;\r\n+    }\r\n+\r\n     // Recovery procedure:\r\n     // move wallet file to walletfilename.timestamp.bak\r\n     // Call Salvage with fAggressive=true to\r\ndiff --git a/src/wallet/wallettool.cpp b/src/wallet/wallettool.cpp\r\nindex 77ed6beb5d..430a866a7c 100644\r\n--- a/src/wallet/wallettool.cpp\r\n+++ b/src/wallet/wallettool.cpp\r\n@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\r\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\r\n             return false;\r\n         }\r\n-        bilingual_str error;\r\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\r\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\r\n-            return false;\r\n-        }\r\n \r\n         if (command == \"info\") {\r\n             std::shared_ptr<CWallet> wallet_instance = LoadWallet(name, path);\r\ndiff --git a/test/functional/tool_wallet.py b/test/functional/tool_wallet.py\r\nindex 524e1593ba..18f0beb598 100755\r\n--- a/test/functional/tool_wallet.py\r\n+++ b/test/functional/tool_wallet.py\r\n@@ -71,8 +71,7 @@ class ToolWalletTest(BitcoinTestFramework):\r\n         self.assert_raises_tool_error('Error: two methods provided (info and create). Only one method should be provided.', 'info', 'create')\r\n         self.assert_raises_tool_error('Error parsing command line arguments: Invalid parameter -foo', '-foo')\r\n         self.assert_raises_tool_error(\r\n-            'Error initializing wallet database environment \"{}\"!\\nError loading wallet.dat. Is wallet being used by other process?'\r\n-            .format(os.path.join(self.nodes[0].datadir, self.chain, 'wallets')),\r\n+            'Error loading wallet.dat. Is wallet being used by another process?',\r\n             '-wallet=wallet.dat',\r\n             'info',\r\n         )\r\n",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-02T12:02:25Z",
      "diff_hunk" : "@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\n             return false;\n         }\n-        bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n-            return false;\n-        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448951064",
      "id" : 448951064,
      "in_reply_to_id" : 448024869,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MTA2NA==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 147,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 17,
      "pull_request_review_id" : 441611131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T12:02:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448951064",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448951215"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448951215"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See https://github.com/bitcoin/bitcoin/pull/19324/files#r448951064",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-02T12:02:44Z",
      "diff_hunk" : "@@ -20,6 +20,11 @@ bool RecoverDatabaseFile(const fs::path& file_path)\n     std::string filename;\n     std::shared_ptr<BerkeleyEnvironment> env = GetWalletEnv(file_path, filename);\n \n+    if (!env->Open(true /* retry */)) {\n+        tfm::format(std::cerr, \"Error initializing wallet database environment %s!\", env->Directory());\n+        return false;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r448951215",
      "id" : 448951215,
      "in_reply_to_id" : 448025146,
      "line" : 26,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MTIxNQ==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 26,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/salvage.cpp",
      "position" : 7,
      "pull_request_review_id" : 441611335,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T12:02:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448951215",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r449059785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449059785"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe if I need to push again.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-02T14:52:47Z",
      "diff_hunk" : "@@ -140,11 +140,6 @@ bool ExecuteWalletToolFunc(const std::string& command, const std::string& name)\n             tfm::format(std::cerr, \"Error: no wallet file at %s\\n\", name);\n             return false;\n         }\n-        bilingual_str error;\n-        if (!WalletBatch::VerifyEnvironment(path, error)) {\n-            tfm::format(std::cerr, \"%s\\nError loading %s. Is wallet being used by other process?\\n\", error.original, name);\n-            return false;\n-        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r449059785",
      "id" : 449059785,
      "in_reply_to_id" : 448024869,
      "line" : 147,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1OTc4NQ==",
      "original_commit_id" : "514ed7641f1df5cad04feba61a5fa12b1c5e9056",
      "original_line" : 147,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 17,
      "pull_request_review_id" : 441756050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-02T14:52:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/449059785",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag or @ryanofsky Mind to re-ACK?",
      "created_at" : "2020-07-02T16:36:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#issuecomment-653110574",
      "id" : 653110574,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19324",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MzExMDU3NA==",
      "updated_at" : "2020-07-02T16:36:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/653110574",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r450379596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450379596"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"walletdb: Combine VerifyDatabaseFile and VerifyEnvironment\" (8f1bcf8b7b6e47c05f2e43dd98ec3505b888d8b3)\r\n\r\n> Since the database is closed before we reach this function, we need to reopen it before doing the recovery function. We could remove this and only close the database for `info` but that seems a bit like a hack.\r\n> \r\n> Maybe something to think about for a followup.\r\n\r\nIt seems like the unintended change in behavior described https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442532065 is back.\r\n\r\nInstead of salvage command just recovering wallet data, now it tries to verify before recovering. Maybe this change is good because verifying before recovering is good for some reason. Maybe it is bad because it prevents salvage command from working some cases. Or maybe it is ok but slows the salvage operation down unnecessarily. I can't tell if it's good or bad but it seems unintended and not mentioned in the PR description or any commit message and ignored in reviews.\r\n\r\nIt looks like previous behavior could be restored by deleting the `SalvageWallet` function and just calling `RecoverDatabaseFile` function instead (previously suggested https://github.com/bitcoin/bitcoin/pull/19324#discussion_r442527386)",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-06T17:39:10Z",
      "diff_hunk" : "@@ -112,7 +112,7 @@ static bool SalvageWallet(const fs::path& path)\n     // Initialize the environment before recovery\n     bilingual_str error_string;\n     try {\n-        WalletBatch::VerifyEnvironment(path, error_string);\n+        database->Verify(error_string);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r450379596",
      "id" : 450379596,
      "in_reply_to_id" : 442527386,
      "line" : 115,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3OTU5Ng==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 115,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 5,
      "pull_request_review_id" : 443281966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T17:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450379596",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r450385631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450385631"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm. Seems like there was a rebase error at some point. I'll make a followup that handles this and a few other related suggestions.",
      "commit_id" : "d8e9ca66d119d80acfb2bb3c8940c386ce0fc226",
      "created_at" : "2020-07-06T17:50:59Z",
      "diff_hunk" : "@@ -112,7 +112,7 @@ static bool SalvageWallet(const fs::path& path)\n     // Initialize the environment before recovery\n     bilingual_str error_string;\n     try {\n-        WalletBatch::VerifyEnvironment(path, error_string);\n+        database->Verify(error_string);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#discussion_r450385631",
      "id" : 450385631,
      "in_reply_to_id" : 442527386,
      "line" : 115,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4NTYzMQ==",
      "original_commit_id" : "ae1a9d9ebbe1b53fd245fddd1907ca90fe3a7abe",
      "original_line" : 115,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/wallettool.cpp",
      "position" : 5,
      "pull_request_review_id" : 443289617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19324",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-07-06T17:51:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/450385631",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There's a stray `VerifyEnvironment` and `VerifyDatabaseFile` in `walletdb.h`. Maybe fix those in #19325? ",
      "created_at" : "2020-07-06T18:12:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19324#issuecomment-654389079",
      "id" : 654389079,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19324",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NDM4OTA3OQ==",
      "updated_at" : "2020-07-06T18:12:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/654389079",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
