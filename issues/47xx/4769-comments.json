[
   {
      "body" : "Good start.  Presumably needs a test that triggers a failure.\r\n",
      "created_at" : "2014-08-27T15:24:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-53589103",
      "id" : 53589103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-08-27T15:24:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53589103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Agree, and one that passes through the \"normal\" response code instead of just a buffer unit test.",
      "created_at" : "2014-08-27T16:04:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-53597199",
      "id" : 53597199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-08-27T16:04:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53597199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1420313?v=3",
         "events_url" : "https://api.github.com/users/jrick/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jrick/followers",
         "following_url" : "https://api.github.com/users/jrick/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jrick/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jrick",
         "id" : 1420313,
         "login" : "jrick",
         "organizations_url" : "https://api.github.com/users/jrick/orgs",
         "received_events_url" : "https://api.github.com/users/jrick/received_events",
         "repos_url" : "https://api.github.com/users/jrick/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jrick/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jrick/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jrick"
      }
   },
   {
      "body" : "I think we want to be much more conservative than 32 MiB for outgoing messages. I *believe* that an inv with 50000 entries is the maximum we should be constructing, so 1800000 bytes for the payload.",
      "created_at" : "2014-08-27T19:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-53628820",
      "id" : 53628820,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-08-27T19:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53628820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "A more conservative maximum would be welcome.  I also don't see any payload length checks being done in ProcessMessages, so adding a constant and using it from both places is probably best.\r\n\r\nedit: oh, it *should* be being checked from CMessageHeader::IsValid.  That compares it against MAX_SIZE, which is currently 0x02000000 (32 MB).",
      "created_at" : "2014-08-27T20:20:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-53634449",
      "id" : 53634449,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-08-27T20:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53634449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1420313?v=3",
         "events_url" : "https://api.github.com/users/jrick/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jrick/followers",
         "following_url" : "https://api.github.com/users/jrick/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jrick/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jrick",
         "id" : 1420313,
         "login" : "jrick",
         "organizations_url" : "https://api.github.com/users/jrick/orgs",
         "received_events_url" : "https://api.github.com/users/jrick/received_events",
         "repos_url" : "https://api.github.com/users/jrick/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jrick/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jrick/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jrick"
      }
   },
   {
      "body" : "@jrick  ProcessMessages() is never handed a message larger than MAX_SIZE (0x02000000).  Payload length is checked much earlier and at a lower level of processing, in CNetMessage()\r\n\r\nThe possibilities are: short message, complete message, complete message with added garbage (never read, yet reflected in message header's length member).\r\n\r\n@sipa +1 more conservative.  \"be liberal in what you accept, be conservative in what you emit\"",
      "created_at" : "2014-08-27T20:27:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-53635326",
      "id" : 53635326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-08-27T20:28:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53635326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@sipa I believe the maximum payload for a full inv is actually 1800003.  The extra 3 bytes come from the varint which must represent an integer no greater than 50000.",
      "created_at" : "2014-09-01T01:28:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-54007908",
      "id" : 54007908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-09-01T01:29:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/54007908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1420313?v=3",
         "events_url" : "https://api.github.com/users/jrick/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jrick/followers",
         "following_url" : "https://api.github.com/users/jrick/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jrick/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jrick",
         "id" : 1420313,
         "login" : "jrick",
         "organizations_url" : "https://api.github.com/users/jrick/orgs",
         "received_events_url" : "https://api.github.com/users/jrick/received_events",
         "repos_url" : "https://api.github.com/users/jrick/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jrick/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jrick/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jrick"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4769_6007fa26099682517b092e047104c44d68ad090a/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-09-01T02:04:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-54009155",
      "id" : 54009155,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-09-01T02:04:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/54009155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "Another change I'd like to see is having different maximum send buffer sizes depending on the message being serialized.  This can help catch and prevent bugs where a message is serialized to a size greater than its expected maximum, but less than the max inv.\r\n\r\nThis would also require clearly defined maximum payload sizes for each P2P message, and newly added messages would have to have a sane maximum size defined before they could be included in the protocol.",
      "created_at" : "2014-09-01T02:43:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-54010616",
      "id" : 54010616,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-09-01T04:01:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/54010616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1420313?v=3",
         "events_url" : "https://api.github.com/users/jrick/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jrick/followers",
         "following_url" : "https://api.github.com/users/jrick/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jrick/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jrick",
         "id" : 1420313,
         "login" : "jrick",
         "organizations_url" : "https://api.github.com/users/jrick/orgs",
         "received_events_url" : "https://api.github.com/users/jrick/received_events",
         "repos_url" : "https://api.github.com/users/jrick/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jrick/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jrick/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jrick"
      }
   },
   {
      "body" : "hum.  Re-reviewing, this is a bit odd in that it\r\n* Presented logic in comments implicitly assumes a single message in send buffer\r\n* Picks an arbitrary inv-related constant as maximum, yet the data we send might be entirely unrelated to inv.\r\n* Is ignorant of SendBufferSize(), in case that is larger than SEND_BUFFER_MAX_SIZE.\r\n\r\nNotably, the _response_ to a 50000-sized inv might push (50000*response) into the send buffer, before the send buffer has a chance to drain.\r\n",
      "created_at" : "2014-09-15T02:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-55547684",
      "id" : 55547684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2014-09-15T02:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/55547684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "@jrick Needs rebase.",
      "created_at" : "2015-01-23T13:31:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4769#issuecomment-71193064",
      "id" : 71193064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4769",
      "updated_at" : "2015-01-23T13:31:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/71193064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
