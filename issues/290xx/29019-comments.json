[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29019).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1845000268) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-12-07T09:25:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1844984184",
      "id" : 1844984184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29019",
      "node_id" : "IC_kwDOABII585t-Dl4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1844984184/reactions"
      },
      "updated_at" : "2023-12-07T09:35:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1844984184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "lgtm ACK 87fa444a04854a5d3a9ff283a8b6c34587e8430f\r\n\r\nThough, if the function will be removed either way, I wonder if this is worth it. Maybe wait for an OK by @sdaftuar  to avoid a merge conflict with https://github.com/bitcoin/bitcoin/pull/28676 ?",
      "created_at" : "2023-12-07T09:35:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1845000268",
      "id" : 1845000268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29019",
      "node_id" : "IC_kwDOABII585t-HhM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845000268/reactions"
      },
      "updated_at" : "2023-12-07T09:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845000268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Current call sites of entryAll do not require the entries to be sorted\r\n\r\nWill this PR not cause issues [here](https://github.com/TheCharlatan/bitcoin/blob/87fa444a04854a5d3a9ff283a8b6c34587e8430f/src/wallet/wallet.cpp#L1938)? In [`CWallet::transactionAddedToMempool`](https://github.com/TheCharlatan/bitcoin/blob/87fa444a04854a5d3a9ff283a8b6c34587e8430f/src/wallet/wallet.cpp#L1406), we eventually call `CWallet::AddToWalletIfInvolvingMe` where we have a [dependency](https://github.com/TheCharlatan/bitcoin/blob/87fa444a04854a5d3a9ff283a8b6c34587e8430f/src/wallet/wallet.cpp#L1226) on [`CWallet::GetDebit`](https://github.com/TheCharlatan/bitcoin/blob/87fa444a04854a5d3a9ff283a8b6c34587e8430f/src/wallet/wallet.cpp#L1536) which tries to find the input tx in `mapWallet`. If this happens in a random order, and not sorted by depth, I think we'd incorrectly miss transactions that are actually \"mine\" but just aren't in `mapWallet` yet?",
      "created_at" : "2023-12-07T14:57:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1845497136",
      "id" : 1845497136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29019",
      "node_id" : "IC_kwDOABII585uAA0w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845497136/reactions"
      },
      "updated_at" : "2023-12-07T14:57:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845497136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Well, if it is needed, then 453b4813ebc74859864803e9972b58e4be76a4d6 should not have been tagged \"refactor\", but \"bugfix\" and should be backported, along with a regression test?",
      "created_at" : "2023-12-07T15:01:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1845504355",
      "id" : 1845504355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29019",
      "node_id" : "IC_kwDOABII585uAClj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845504355/reactions"
      },
      "updated_at" : "2023-12-07T15:01:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845504355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "That is a good point, I'd missed that this just reverts back to the behaviour pre-`entryAll()`. It seems that when iterating over a `boost::multi_index_container` without specifying an index, we default to the insertion order, so i think that would be sufficient guarantees that the `CWallet::transactionAddedToMempool` calls happen in a safe order too.",
      "created_at" : "2023-12-07T15:27:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1845551334",
      "id" : 1845551334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29019",
      "node_id" : "IC_kwDOABII585uAODm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845551334/reactions"
      },
      "updated_at" : "2023-12-07T15:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845551334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Though, if the function will be removed either way, I wonder if this is worth it. Maybe wait for an OK by @sdaftuar to avoid a merge conflict with https://github.com/bitcoin/bitcoin/pull/28676 ?\r\n\r\nI'm not necessarily planning to remove `entryAll()`, but I am planning to replace `GetSortedDepthAndScore()` with a different function that will iterate the mempool topologically based on cluster sort (ie a valid topological order in which the mempool is sorted by descending feerate chunks).\r\n\r\nI think if the sorted order is not needed, probably best to remove it now so that we don't take the performance hit needlessly in the next release...?  I mostly just wanted to know if I needed to replace it with the new topological sort I'm implementing or if it's fine to just revert back to the mapTx order.",
      "created_at" : "2023-12-07T16:30:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#issuecomment-1845658601",
      "id" : 1845658601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29019",
      "node_id" : "IC_kwDOABII585uAoPp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845658601/reactions"
      },
      "updated_at" : "2023-12-07T16:33:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1845658601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29019#discussion_r1420051555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29019"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420051555"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: you could just write \r\n```cpp\r\nAssertLockHeld(cs);\r\nreturn {mapTx.begin(), mapTx.end()};\r\n```",
      "commit_id" : "87fa444a04854a5d3a9ff283a8b6c34587e8430f",
      "created_at" : "2023-12-08T07:42:30Z",
      "diff_hunk" : "@@ -832,8 +832,8 @@ std::vector<CTxMemPoolEntryRef> CTxMemPool::entryAll() const\n \n     std::vector<CTxMemPoolEntryRef> ret;\n     ret.reserve(mapTx.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29019#discussion_r1420051555",
      "id" : 1420051555,
      "line" : 834,
      "node_id" : "PRRC_kwDOABII585UpERj",
      "original_commit_id" : "87fa444a04854a5d3a9ff283a8b6c34587e8430f",
      "original_line" : 834,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 3,
      "pull_request_review_id" : 1771712105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29019",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420051555/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-08T08:54:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1420051555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   }
]
