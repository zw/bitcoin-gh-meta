[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29058).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stratospher](https://github.com/bitcoin/bitcoin/pull/29058#pullrequestreview-1803647850), [sipa](https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1880059347), [theStack](https://github.com/bitcoin/bitcoin/pull/29058#pullrequestreview-1807916160), [kristapsk](https://github.com/bitcoin/bitcoin/pull/29058#pullrequestreview-1807944717) |\n| Concept ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1851617327) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-12-11T22:54:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1851022676",
      "id" : 1851022676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585uVF1U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1851022676/reactions"
      },
      "updated_at" : "2024-01-08T02:00:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1851022676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1423276132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423276132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: can the comment above (\"... does not currently have a way to signal BIP324 support\") now also be removed? It's content is still true, but with the \"always attempt v2 first if we support it\"-approach, I guess it's not relevant anymore.",
      "commit_id" : "cd88bb3e8e499111068a84d29cade98bbd842156",
      "created_at" : "2023-12-12T00:46:34Z",
      "diff_hunk" : "@@ -1084,10 +1084,11 @@ class CConnman\n         vWhitelistedRange = connOptions.vWhitelistedRange;\n         {\n             LOCK(m_added_nodes_mutex);\n-\n+            // Attempt v2 connection if we support v2 - if our peer doesn't support it, we'll reconnect with v1.\n+            const bool use_v2transport(GetLocalServices() & NODE_P2P_V2);\n             for (const std::string& added_node : connOptions.m_added_nodes) {\n                 // -addnode cli arg does not currently have a way to signal BIP324 support\n-                m_added_node_params.push_back({added_node, false});\n+                m_added_node_params.push_back({added_node, use_v2transport});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1423276132",
      "id" : 1423276132,
      "line" : 1091,
      "node_id" : "PRRC_kwDOABII585U1Xhk",
      "original_commit_id" : "749cc35b5fb111ec623eb55085fd067e5812ba66",
      "original_line" : 1091,
      "original_position" : 10,
      "original_start_line" : 1090,
      "path" : "src/net.h",
      "position" : 10,
      "pull_request_review_id" : 1776407268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423276132/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1090,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-12-12T01:17:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423276132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1423278081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423278081"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: maybe '?' would also work to express the \"detecting\" state. But no hard feelings, typically users wouldn't see this a lot anyway.",
      "commit_id" : "cd88bb3e8e499111068a84d29cade98bbd842156",
      "created_at" : "2023-12-12T00:50:06Z",
      "diff_hunk" : "@@ -545,10 +547,11 @@ class NetinfoRequestHandler : public BaseRequestHandler\n             for (const Peer& peer : m_peers) {\n                 std::string version{ToString(peer.version) + peer.sub_version};\n                 result += strprintf(\n-                    \"%3s %6s %5s%7s%7s%5s%5s%5s%5s  %2s %*s%*s%*s%*i %*s %-*s%s\\n\",\n+                    \"%3s %6s %5s %2s%7s%7s%5s%5s%5s%5s  %2s %*s%*s%*s%*i %*s %-*s%s\\n\",\n                     peer.is_outbound ? \"out\" : \"in\",\n                     ConnectionTypeForNetinfo(peer.conn_type),\n                     peer.network,\n+                    peer.transport_protocol_type == \"detecting\" ? \"*\" : peer.transport_protocol_type,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1423278081",
      "id" : 1423278081,
      "line" : 554,
      "node_id" : "PRRC_kwDOABII585U1YAB",
      "original_commit_id" : "cd88bb3e8e499111068a84d29cade98bbd842156",
      "original_line" : 554,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 39,
      "pull_request_review_id" : 1776407268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423278081/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T01:17:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423278081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1423315657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423315657"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Heh, I actually changed it from ? to *  last thing before opening the PR, because * was already used in a few other places for netinfo and ? would be a new symbol. But maybe ? is more natural here, @jonatack do you have an opinion? ",
      "commit_id" : "cd88bb3e8e499111068a84d29cade98bbd842156",
      "created_at" : "2023-12-12T01:55:58Z",
      "diff_hunk" : "@@ -545,10 +547,11 @@ class NetinfoRequestHandler : public BaseRequestHandler\n             for (const Peer& peer : m_peers) {\n                 std::string version{ToString(peer.version) + peer.sub_version};\n                 result += strprintf(\n-                    \"%3s %6s %5s%7s%7s%5s%5s%5s%5s  %2s %*s%*s%*s%*i %*s %-*s%s\\n\",\n+                    \"%3s %6s %5s %2s%7s%7s%5s%5s%5s%5s  %2s %*s%*s%*s%*i %*s %-*s%s\\n\",\n                     peer.is_outbound ? \"out\" : \"in\",\n                     ConnectionTypeForNetinfo(peer.conn_type),\n                     peer.network,\n+                    peer.transport_protocol_type == \"detecting\" ? \"*\" : peer.transport_protocol_type,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1423315657",
      "id" : 1423315657,
      "in_reply_to_id" : 1423278081,
      "line" : 554,
      "node_id" : "PRRC_kwDOABII585U1hLJ",
      "original_commit_id" : "cd88bb3e8e499111068a84d29cade98bbd842156",
      "original_line" : 554,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/bitcoin-cli.cpp",
      "position" : 39,
      "pull_request_review_id" : 1776465721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423315657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-12T01:55:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1423315657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-12-12T09:23:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1851617327",
      "id" : 1851617327,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585uXXAv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1851617327/reactions"
      },
      "updated_at" : "2023-12-12T09:23:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1851617327",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1424240319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424240319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, removed the comment.",
      "commit_id" : "a30a1d9318d08ddd1007d7fe7c19e4175faa8b64",
      "created_at" : "2023-12-12T16:10:57Z",
      "diff_hunk" : "@@ -1084,10 +1084,11 @@ class CConnman\n         vWhitelistedRange = connOptions.vWhitelistedRange;\n         {\n             LOCK(m_added_nodes_mutex);\n-\n+            // Attempt v2 connection if we support v2 - if our peer doesn't support it, we'll reconnect with v1.\n+            const bool use_v2transport(GetLocalServices() & NODE_P2P_V2);\n             for (const std::string& added_node : connOptions.m_added_nodes) {\n                 // -addnode cli arg does not currently have a way to signal BIP324 support\n-                m_added_node_params.push_back({added_node, false});\n+                m_added_node_params.push_back({added_node, use_v2transport});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1424240319",
      "id" : 1424240319,
      "in_reply_to_id" : 1423276132,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585U5C6_",
      "original_commit_id" : "749cc35b5fb111ec623eb55085fd067e5812ba66",
      "original_line" : 1090,
      "original_position" : 10,
      "original_start_line" : 1090,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1777899407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424240319/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-12-12T16:10:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1424240319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Playing devil's advocate: could there be any noticeable drawbacks of always trying with v2 first? I'm thinking of destination nodes behind firewalls with deep packet inspection which block ips from further connections if they don't follow the protocol (i.e. for bitcoin v1 connections, initiating with a version message). If that's the case, the user would only have the option to disable v2transport in general, or use the `addnode` RPC instead. Not sure how realistic that \"i want to connect via v1 explicitly, as connecting via v2 first causes trouble\"-scenario is at all though.\r\n\r\nI don't know either if this scenario is realistic, and, as you point out, there is the always the workaround of using the addnode rpc. I guess in general it's less nice to add options to `-cli` args compared to rpcs: The alternative is that we could allow some construction like `-connect=1.2.3.4:8333|v1transport` (and similar to `-addnode` / `-seednode`) but then we need additional string parsing / documentation for that, and I think we should only do it if there is an actual use case for it.",
      "created_at" : "2023-12-12T16:15:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1852356884",
      "id" : 1852356884,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585uaLkU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1852356884/reactions"
      },
      "updated_at" : "2023-12-12T16:15:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1852356884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theStack I think the philosophy behind v2 was always \"prevent the firewall from discriminating authenticated connections by making them look exactly like non-authenticated (but also encrypted) connections\". From [BIP](https://github.com/bitcoin/bips/blob/master/bip-0324.mediawiki): \r\n\r\n>Encryption, even when it is unauthenticated and only used when both endpoints support v2, impedes eavesdropping by forcing the attacker to become active: either by performing a persistent man-in-the-middle (MitM) attack, by downgrading connections to v1, or by spinning up their own nodes and getting honest nodes to make connections to them. Active attacks at scale are more resource intensive in general, but in the case of manual, deliberate connections (as opposed to automatic, random ones), they are also in principle detectable: even very basic checks, e.g., operators manually comparing protocol versions and session IDs (as supported by the proposed protocol), will expose the attacker.\r\n\r\nSo along that thinking, the situation you describe should trigger the user to be angry at their firewall (unless that becomes a widely used practice due to some wide regulation, which is only a theoretical, and i think unlikely, outcome in the future). Otherwise, if we encourage bending under such firewalls, the v2 battle is kinda lost anyway...\r\n@sipa could correct me",
      "created_at" : "2023-12-13T08:41:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1853485863",
      "id" : 1853485863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585uefMn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1853485863/reactions"
      },
      "updated_at" : "2023-12-13T09:03:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1853485863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1425044177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1425044177"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c5d41370287f48c638ab87d3e02a117b1a17694a\r\n\r\nWhat if the peer is `v2`, but disconnected us due to other reason? (say a limit of inbounds, or us coming from a blocked network)? Here and in the logic below. In that case we should not attempt reconnection with `v1`, it won't help.\r\n\r\nThis is probably about `ShouldReconnectV1` behavior. I can't find where this case is handled.",
      "commit_id" : "a30a1d9318d08ddd1007d7fe7c19e4175faa8b64",
      "created_at" : "2023-12-13T08:59:17Z",
      "diff_hunk" : "@@ -2437,6 +2439,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n             if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n                 return;\n+            PerformReconnections();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1425044177",
      "id" : 1425044177,
      "line" : 2444,
      "node_id" : "PRRC_kwDOABII585U8HLR",
      "original_commit_id" : "c5d41370287f48c638ab87d3e02a117b1a17694a",
      "original_line" : 2442,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 34,
      "pull_request_review_id" : 1779144233,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1425044177/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-13T09:02:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1425044177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1425547546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1425547546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, `ShouldReconnectV1` (which is called in `DisconnectNode()`) will result in the peer only being put on the list of reconnections if it's in `RecvState::KEY`. That is impossible if they ever sent us something, in which case `PerformReconnections()` will do nothing.",
      "commit_id" : "a30a1d9318d08ddd1007d7fe7c19e4175faa8b64",
      "created_at" : "2023-12-13T15:47:34Z",
      "diff_hunk" : "@@ -2437,6 +2439,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n             if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n                 return;\n+            PerformReconnections();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1425547546",
      "id" : 1425547546,
      "in_reply_to_id" : 1425044177,
      "line" : 2444,
      "node_id" : "PRRC_kwDOABII585U-CEa",
      "original_commit_id" : "c5d41370287f48c638ab87d3e02a117b1a17694a",
      "original_line" : 2442,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 34,
      "pull_request_review_id" : 1779952455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1425547546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-13T15:47:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1425547546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Also worth noting that while this PR deals with manual connections, we absolutely depend on the reconnection mechanism for automatic connections too:\r\nThe logic that we try with v1 based on service flags is just a courtesy but cannot be relied on, since an attacker could add the v2 service flag to arbitrary v1 nodes in most addrmans by spamming the network  with the addr with an added v2 service flag, and then everyone thinks it's a v2 peer and depends on the reconnection mechanism when connecting to it. ",
      "created_at" : "2023-12-13T15:57:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1854197471",
      "id" : 1854197471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585uhM7f",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1854197471/reactions"
      },
      "updated_at" : "2023-12-13T15:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1854197471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I guess in general it's less nice to add options to `-cli` args compared to rpcs: The alternative is that we could allow some construction like `-connect=1.2.3.4:8333|v1transport` (and similar to `-addnode` / `-seednode`) but then we need additional string parsing / documentation for that, and I think we should only do it if there is an actual use case for it.\r\n\r\nI agree, this should only be done if there is a really good reason for it.\r\n\r\n@naumenkogs: Note that my concerns were not about the v2 approach in general, and I'm not worried at all about the reconnection mechanism. I was merely wondering whether connecting via v1 directly could still be demanded for some users during the next few releases until v2 is more widespread. In these rare cases (if they exist at all), they could of course always either turn off `v2transport` completely (probably unpleasant if you only need the direct-v1-connect for a single peer) or use the `addnode` RPC with the `v2transport` parameter set to false, so it shouldn't be a problem at all.\r\n\r\n\r\nI guess one could argue that it's a bit inconsistent/confusing to allow explicit v1 connections for the `addnode` RPC, but not for the `-addnode` bitcoind parameter. I think they should at least behave identical if no explicit transport version is specified for the node to add, i.e. `addnode` should IMHO by default try to connect via v2 if `-v2transport` is set to bitcoind, but the `v2transport` boolean parameter wasn't set explicitly. But this is unrelated to this PR, and probably fits better to a future \"use v2transport by default\" PR anyways.\r\n",
      "created_at" : "2023-12-13T16:55:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1854344432",
      "id" : 1854344432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585uhwzw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1854344432/reactions"
      },
      "updated_at" : "2023-12-13T16:55:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1854344432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1429854862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1429854862"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it possible that they haven't sent us anything (the state is `KEY`), but disconnected us for other reason than not supporting `v2`? I assume it's possible if an alternative client implements whatever because this is not prohibited by any bips... But even in the current client, say that `IsBanned` is triggered? (in that case there is no real use in trying v2).",
      "commit_id" : "a30a1d9318d08ddd1007d7fe7c19e4175faa8b64",
      "created_at" : "2023-12-18T10:11:17Z",
      "diff_hunk" : "@@ -2437,6 +2439,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n             if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n                 return;\n+            PerformReconnections();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1429854862",
      "id" : 1429854862,
      "in_reply_to_id" : 1425044177,
      "line" : 2444,
      "node_id" : "PRRC_kwDOABII585VOdqO",
      "original_commit_id" : "c5d41370287f48c638ab87d3e02a117b1a17694a",
      "original_line" : 2442,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 34,
      "pull_request_review_id" : 1786413197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1429854862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-18T10:11:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1429854862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1430727818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1430727818"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, you are right, and I could confirm this with two of my nodes: If we connect via v2 peer and are disconnected because they have banned us, we would try once again with v1 (and then get disconnected again). Both for automatic connections, and (with this PR) manual ones. Although for manual ones it arguably probably matters less because we'll continuously retry with `-connect` and `-addnode` cli args anyway, even when everything is v1.\r\nI don't really see a good way to avoid this, it's not like they notify us why they have disconnected us, so both situations would look the same for us.",
      "commit_id" : "a30a1d9318d08ddd1007d7fe7c19e4175faa8b64",
      "created_at" : "2023-12-18T22:52:19Z",
      "diff_hunk" : "@@ -2437,6 +2439,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n             if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n                 return;\n+            PerformReconnections();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1430727818",
      "id" : 1430727818,
      "in_reply_to_id" : 1425044177,
      "line" : 2444,
      "node_id" : "PRRC_kwDOABII585VRyyK",
      "original_commit_id" : "c5d41370287f48c638ab87d3e02a117b1a17694a",
      "original_line" : 2442,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 34,
      "pull_request_review_id" : 1787835534,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1430727818/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-18T22:52:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1430727818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a30a1d9318d08ddd1007d7fe7c19e4175faa8b64\r\n\r\nConceptually, I believe this makes sense both now and eventually:\r\n* Right now, anyone using `-v2transport` is opting into the BIP324 experiment. If this causes problems for them (e.g. because somehow addnode with default v2 causes issues), they always have the ability to just not do that.\r\n* Eventually, having V2 default for addnode/connect makes sense. There is a significant UX advantage to not needing to specify, and BIP324 qualities are most apparent when it's widely deployed. The downside is essentially doubling the number of connections made for v1 peers and peers that drop connections for unrelated reasons, but I expect *manual* connection attempts to be relatively rare, and only a fraction of all connection attempts in any case.\r\n\r\nBefore enabling `-v2transport` by default (which I'd image may happen after #24748) we could consider a way to force manual connections to be only-v1 or even only-v2 (disabling reconnect-with-v1). A possibility could be through a net permission flag, if #27114 makes it in.",
      "created_at" : "2023-12-20T21:22:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1865155764",
      "id" : 1865155764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585vLAS0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1865155764/reactions"
      },
      "updated_at" : "2023-12-20T21:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1865155764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1434855153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1434855153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Okay, so for this PR i'd just suggest clarifying the *newly added* comments like\r\n```            // Attempt v2 connection if we support v2 - if our peer doesn't support it, we'll reconnect with v1.``` \r\nRight now they are not accurate, as if the banning thing (or some other disconnection reason) don't exist.\r\n\r\nIf you feel like it, might as well touch the existing comments as well (say around `ShouldReconnectV1`) :)\r\n\r\nIn future, we might communicate the disconnection reason (Ban, v1, eviction, protocol violation, or whatever else), probably through a new p2p message. Right now I'm not 100% sure the benefits are worthy of code complexity :) Better p2p logging (on the disconnected end) may be even better goal than saving up one useless v1/v2 reconnection.\r\nCurious what you think about this idea.",
      "commit_id" : "a30a1d9318d08ddd1007d7fe7c19e4175faa8b64",
      "created_at" : "2023-12-22T08:52:22Z",
      "diff_hunk" : "@@ -2437,6 +2439,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n             if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n                 return;\n+            PerformReconnections();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1434855153",
      "id" : 1434855153,
      "in_reply_to_id" : 1425044177,
      "line" : 2444,
      "node_id" : "PRRC_kwDOABII585Vhibx",
      "original_commit_id" : "c5d41370287f48c638ab87d3e02a117b1a17694a",
      "original_line" : 2442,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 34,
      "pull_request_review_id" : 1794166686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1434855153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-22T08:52:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1434855153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1437279158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437279158"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I clarified the comments added in this PR.\r\nI think that a single connection / reconnection attempt doesn't waste a meaningful amount of resources of either side, so I'm not sure if there is an actual problem here. Also, often one might not want the other side to know that you evicted them because they are banned (after all you banned them for a reason) - that might just help them evade the ban.",
      "commit_id" : "fb5bfed26a564014b83ccfc96ff00b630930fc61",
      "created_at" : "2023-12-27T22:38:29Z",
      "diff_hunk" : "@@ -2437,6 +2439,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n             if (!interruptNet.sleep_for(std::chrono::milliseconds(500)))\n                 return;\n+            PerformReconnections();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#discussion_r1437279158",
      "id" : 1437279158,
      "in_reply_to_id" : 1425044177,
      "line" : 2446,
      "node_id" : "PRRC_kwDOABII585VqyO2",
      "original_commit_id" : "c5d41370287f48c638ab87d3e02a117b1a17694a",
      "original_line" : 2446,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 36,
      "pull_request_review_id" : 1797549370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29058",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437279158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-12-27T22:38:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1437279158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "[a30a1d9 ](https://github.com/bitcoin/bitcoin/commit/a30a1d9318d08ddd1007d7fe7c19e4175faa8b64)to [fb5bfed](https://github.com/bitcoin/bitcoin/commit/fb5bfed26a564014b83ccfc96ff00b630930fc61): small doc-only update.",
      "created_at" : "2023-12-27T22:39:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1870670097",
      "id" : 1870670097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585vgCkR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1870670097/reactions"
      },
      "updated_at" : "2023-12-27T22:39:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1870670097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> an interesting behaviour which i realised made sense was to keep retrying with v2 when latency issue failures happen on tor.\r\n\r\nYes! The connection must have been established on the TCP/IP level for a reconnection attempt to happen. It's the same reason why we don't try to reconnect with v1 if the peer is just offline.",
      "created_at" : "2024-01-05T16:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1878918062",
      "id" : 1878918062,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585v_gOu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1878918062/reactions"
      },
      "updated_at" : "2024-01-05T16:13:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1878918062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK fb5bfed26a564014b83ccfc96ff00b630930fc61",
      "created_at" : "2024-01-07T13:23:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1880059347",
      "id" : 1880059347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585wD23T",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1880059347/reactions"
      },
      "updated_at" : "2024-01-07T13:23:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1880059347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Not an objection, but this feels backwards to me: presumably the user has manually listed those peers as addnode/connect because it's important that their node be connected to those peers, but if there are any bugs in the \"v2 didn't work, retry as v1\" logic, it's exactly those peers that will be inaccessible. But if we're confident there aren't bugs in that logic, why not just apply it to all peers? The \"if you don't like it, just set -v2transport=0\" approach to avoiding bugs/risk works just as well in either case. (Doing it for addrfetch otoh seems fine)",
      "created_at" : "2024-01-08T02:32:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1880309647",
      "id" : 1880309647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585wEz-P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1880309647/reactions"
      },
      "updated_at" : "2024-01-08T02:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1880309647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">  why not just apply it to all peers\r\n\r\nDo you mean why not apply it to automatic peers as well per default (and ignore the information from the service flag)? I thought the idea was to save one disconnection / reconnection, and the time spent doing these when we probably know better. But as I wrote in https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1854197471, I think that we depend on the reconnection mechanism for automatic connection as well, because anyone can add a wrong \"v2\" service flag to a given v1 node in most people's addrman (but not vice versa!).",
      "created_at" : "2024-01-08T02:54:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29058#issuecomment-1880319951",
      "id" : 1880319951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29058",
      "node_id" : "IC_kwDOABII585wE2fP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1880319951/reactions"
      },
      "updated_at" : "2024-01-08T02:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1880319951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
