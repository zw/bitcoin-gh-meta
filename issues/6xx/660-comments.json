[
   {
      "body" : "I have the same problem. My wallet is also on an encrypted volume that is usually not mounted. Fortunately, it does not overwrite any real wallet in this case (just the symlink which can be reconstructed easily), so no data is lost. However, I am worried that if the wallet file was for some reason unreadable, that it would also overwrite it. If there is any problem in reading an existing \"wallet.dat\", the program should not touch it, complain about a \"corrupt wallet\" and either quit or continue without a wallet (if there is such a mode). To recover, the user would have to manually remove or fix the \"corrupt\" file, which I think is a reasonable thing to have him do at this point.",
      "created_at" : "2011-11-26T07:37:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-2880400",
      "id" : 2880400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-11-26T07:38:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2880400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/150349?v=3",
         "events_url" : "https://api.github.com/users/thiloplanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/thiloplanz/followers",
         "following_url" : "https://api.github.com/users/thiloplanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/thiloplanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/thiloplanz",
         "id" : 150349,
         "login" : "thiloplanz",
         "organizations_url" : "https://api.github.com/users/thiloplanz/orgs",
         "received_events_url" : "https://api.github.com/users/thiloplanz/received_events",
         "repos_url" : "https://api.github.com/users/thiloplanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/thiloplanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/thiloplanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/thiloplanz"
      }
   },
   {
      "body" : "I agree. However this logic is not build into bitcoin itself, afaik, but into berkelydb. You'll probably have to see if berkelydb supports a flag to fail in this case.\r\n",
      "created_at" : "2011-12-03T17:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3001803",
      "id" : 3001803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-03T17:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3001803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "We could still do manual testing before we open the wallet dir, though I would agree that its not an entirely supported case that we should employ extra logic to complain about - do other programs fail in similar situations?",
      "created_at" : "2011-12-04T01:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3004390",
      "id" : 3004390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-04T01:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3004390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "As I understand it he's symlinking individual files, not the directory the\nwallet is in (which AFAIK already does fail if the target doesn't\nexist). So in his case to be correct we'd have to check every file bdb\npotenialtially opens, including logs, not just the wallet.dat. It's very\nugly to tack that on on our side.",
      "created_at" : "2011-12-04T08:19:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3005419",
      "id" : 3005419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-04T08:19:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3005419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Well, the wallet.dat is the only file that you might want to symlink away individually to an encrypted and usually offline disk (the other files are not security-critical), so some special treatment for just wallet.dat would be sufficient here, I think.\r\n\r\n",
      "created_at" : "2011-12-04T08:24:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3005442",
      "id" : 3005442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-04T08:24:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3005442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/150349?v=3",
         "events_url" : "https://api.github.com/users/thiloplanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/thiloplanz/followers",
         "following_url" : "https://api.github.com/users/thiloplanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/thiloplanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/thiloplanz",
         "id" : 150349,
         "login" : "thiloplanz",
         "organizations_url" : "https://api.github.com/users/thiloplanz/orgs",
         "received_events_url" : "https://api.github.com/users/thiloplanz/received_events",
         "repos_url" : "https://api.github.com/users/thiloplanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/thiloplanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/thiloplanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/thiloplanz"
      }
   },
   {
      "body" : "It wouldn't be enough, because the bdb binary log files can also contain\nsensitive data such as private keys, so it would 'leak' into that\nfilesystem.",
      "created_at" : "2011-12-04T08:26:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3005452",
      "id" : 3005452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-04T08:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3005452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Oh, that's good to know. So the whole approach of only encrypting the wallet.dat is flawed? Is there a way to remove the logs? \r\n\r\nBut I agree that this issue has a low priority (especially if there are plans for a new wallet file format that is more portable, less binary, and less leaky, are there?). The clobbered symlink does not cause any real problems, only confusion. If you are manually symlinking you should be able to be careful enough not to run into too much trouble here. \r\n\r\n> However, I am worried that if the wallet file was for some reason unreadable, that it would also overwrite it. \r\n\r\nHow about that. What happens if wallet.dat is a broken file? Does BDB preserve it?",
      "created_at" : "2011-12-04T08:33:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3005473",
      "id" : 3005473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-04T08:33:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3005473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/150349?v=3",
         "events_url" : "https://api.github.com/users/thiloplanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/thiloplanz/followers",
         "following_url" : "https://api.github.com/users/thiloplanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/thiloplanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/thiloplanz",
         "id" : 150349,
         "login" : "thiloplanz",
         "organizations_url" : "https://api.github.com/users/thiloplanz/orgs",
         "received_events_url" : "https://api.github.com/users/thiloplanz/received_events",
         "repos_url" : "https://api.github.com/users/thiloplanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/thiloplanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/thiloplanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/thiloplanz"
      }
   },
   {
      "body" : "AFAIK the application crashes hard if the wallet.dat is broken, it won't simply overwrite it. But to test that you'll probably have to try with various levels of corruption.\r\n\r\nThe best idea I've heard with regard to re-engineering wallet files is an append-only wallet for the private keys. All the private-key action would happen there (and in mlocked main memory), keys could be referred to by number in other places. All the less sensitive mutable metadata such as labels/settings/address book would remain in the old wallet database.\r\n",
      "created_at" : "2011-12-04T08:48:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3005518",
      "id" : 3005518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-04T08:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3005518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj, I was not aware about these other sensitive files.\r\nDon't you think this deserves an issue of its own?\r\nI mean.. I never treated any other file with the same care that I treat wallet.dat, and I guess I'm not the only one. There's either a bug there (leaking sensitive data to logs) or a great need of more clarification for most users, as I don't think I'm the only one that's not aware of such thing...",
      "created_at" : "2011-12-05T22:38:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3024722",
      "id" : 3024722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-05T22:38:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3024722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1171801?v=3",
         "events_url" : "https://api.github.com/users/EhVedadoOAnonimato/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EhVedadoOAnonimato/followers",
         "following_url" : "https://api.github.com/users/EhVedadoOAnonimato/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EhVedadoOAnonimato/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EhVedadoOAnonimato",
         "id" : 1171801,
         "login" : "EhVedadoOAnonimato",
         "organizations_url" : "https://api.github.com/users/EhVedadoOAnonimato/orgs",
         "received_events_url" : "https://api.github.com/users/EhVedadoOAnonimato/received_events",
         "repos_url" : "https://api.github.com/users/EhVedadoOAnonimato/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EhVedadoOAnonimato/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EhVedadoOAnonimato/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EhVedadoOAnonimato"
      }
   },
   {
      "body" : "> I never treated any other file with the same care that I treat wallet.dat, and I guess I'm not the only one. \r\n\r\nYou are not...\r\n\r\nI have opened a thread on StackExchange about this.\r\nhttp://bitcoin.stackexchange.com/questions/2140/\r\n\r\nOne answer seems to suggest that encrypting the wallet using  new built-in encryption feature is safe, but before you turn that on, your private keys may leak. \r\n",
      "created_at" : "2011-12-06T00:49:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3026409",
      "id" : 3026409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-06T00:49:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3026409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/150349?v=3",
         "events_url" : "https://api.github.com/users/thiloplanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/thiloplanz/followers",
         "following_url" : "https://api.github.com/users/thiloplanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/thiloplanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/thiloplanz",
         "id" : 150349,
         "login" : "thiloplanz",
         "organizations_url" : "https://api.github.com/users/thiloplanz/orgs",
         "received_events_url" : "https://api.github.com/users/thiloplanz/received_events",
         "repos_url" : "https://api.github.com/users/thiloplanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/thiloplanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/thiloplanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/thiloplanz"
      }
   },
   {
      "body" : "Safe options are:\r\n\r\n1) Symlink the entire walllet directory to the encrypted fs. Bitcoin will not write any files outside this directory so this will prevent leaks. If you want to store blk*.dat and addr.dat somewhere else, symlink those.\r\n\r\n2) Use the built-in wallet encryption\r\n\r\nOr both. I did not know about the log \"leak\" until a discussion a few weeks ago on IRC either. But such behaviour comes with using an OTS database that is not geared toward secure key storage. This is not a problem restricted to bitcoin only, hackers are having a field day with all the hidden stores,caches,logs, and their interaction with journaling filesystems. Though of course, bitcoin is especially sensitive...\r\n",
      "created_at" : "2011-12-06T05:50:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-3028522",
      "id" : 3028522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2011-12-06T05:50:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3028522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "The discussion in this issue seems to have resolved several questions.  Possibly reference issue #68 here, as it is a common request.",
      "created_at" : "2012-07-05T21:55:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/660#issuecomment-6791907",
      "id" : 6791907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/660",
      "updated_at" : "2012-07-05T21:55:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/6791907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   }
]
