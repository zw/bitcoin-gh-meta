[
   {
      "author_association" : "MEMBER",
      "body" : "Generally the node is defended from block denial by the subscription to three peers in HB mode, resulting in getting up to four copies even in the face of malicious denial.  It would be interesting to see your logs to see if CB reconstruction failed or if there was some other issue.    @TheBlueMatt  would fine this issue interesting\r\n\r\nI previously saw these attacks from those nodes, and the improved CB reproduction seemed to solve them.  Their mass connecting behavior got them listed on the blacklists my nodes use, so I haven't seen them lately.\r\n\r\nThe timeout question is complicated.  Too short a timeout and when you run bitcoin on a limited bandwidth link (or one under a sustained DOS attack that otherwise would have enough bandwidth to barely keep working) you will go into congestion collapse and be unable to continue syncing because just before finishing a block you terminate the peer and start anew.  Even with the 10 minute time we've had problems with people reporting that. More correct would likely be an adaptive time which advances forward to 2x the last successful transfer and backs off exponentially on disconnection but these things are tricky to test and work out their effect network wide in the face of possible attacks, so it hasn't been done yet-- instead effort went into making better use of the redundant CB transmissions so far.\r\n\r\nSimilar applies on banning,  you having a slow connection doesn't mean the peer did anything wrong.  One wouldn't want third parties DOS attacking you to cause you to ban all honest peers.\r\n\r\nRe mining: directly exposing a mining node to inbound connections to the public is not a good configuration. Standard advice is that a mining node should connect out to a couple of remote public nodes run by the miner as well as potentially a few other seemingly reliable nodes run by others.  Its common to see miners DOS attacked and some attacks don't admit any software defense (e.g. flooding you with traffic right when a block shows up on the network), so the most general defense is to keep a low profile.    Obviously the software should be as resistant as possible too, but we need to avoid overly simple defenses turning into attack amplifiers.",
      "created_at" : "2018-02-04T09:03:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12291#issuecomment-362891770",
      "id" : 362891770,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12291",
      "updated_at" : "2018-02-04T09:03:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362891770",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/858454?v=4",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "#10984 would make us somewhat more robust to this attack, though at this point we should consider just banning anything that says \"bitpeer\" in it...",
      "created_at" : "2018-02-04T17:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12291#issuecomment-362922881",
      "id" : 362922881,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12291",
      "updated_at" : "2018-02-04T17:14:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/362922881",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> It would be interesting to see your logs to see if CB reconstruction failed or if there was some other issue.\r\n\r\nI don't see any compact block related logs in debug.log.  I can try to run again with more debugging enabled if that helps. Is there an option to increase verbosity for CB?\r\n\r\nI noticed that the bitpeer server banned itself by misbehaving from time to time, so this is why there is sometimes a period of more than 24 hours without any timeouts :).  I currently ban it manually. ",
      "created_at" : "2018-02-05T13:45:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12291#issuecomment-363088597",
      "id" : 363088597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12291",
      "updated_at" : "2018-02-05T13:45:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/363088597",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/897826?v=4",
         "events_url" : "https://api.github.com/users/jhoenicke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jhoenicke/followers",
         "following_url" : "https://api.github.com/users/jhoenicke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jhoenicke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jhoenicke",
         "id" : 897826,
         "login" : "jhoenicke",
         "organizations_url" : "https://api.github.com/users/jhoenicke/orgs",
         "received_events_url" : "https://api.github.com/users/jhoenicke/received_events",
         "repos_url" : "https://api.github.com/users/jhoenicke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jhoenicke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jhoenicke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jhoenicke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't want to hijack this issue, but I believe I just encountered a related issue. I had been offline for ~2 weeks and started my node. It was catching up nicely, but then it stalled for a very long time.\r\n\r\n```\r\n2018-04-25 03:30:30 UpdateTip: new best=0000000000000000003923691e313442f52ebbb15e9c5bd7db976c34797487a0 height=519337 version=0x20000000 log2_work=88.642567 tx=311637316 date='2018-04-22 01:20:23' progress=0.997010 cache=42.2MiB(73404txo)\r\n2018-04-25 03:30:30 UpdateTip: new best=0000000000000000001822f09f1821deb6b3b74e36ea1de4e232e5c60fa30ed9 height=519338 version=0x20000000 log2_work=88.642616 tx=311637370 date='2018-04-22 01:25:30' progress=0.997014 cache=42.2MiB(73520txo)\r\n2018-04-25 03:30:30 UpdateTip: new best=00000000000000000031189ef2542d985552b4da05eb23cc88473ebdd223c02b height=519339 version=0x20000000 log2_work=88.642665 tx=311639023 date='2018-04-22 01:38:46' progress=0.997023 cache=43.0MiB(79805txo)\r\n2018-04-25 03:30:30 UpdateTip: new best=00000000000000000027264033979f0905e40513e1c207f9779a41e749474207 height=519340 version=0x20000000 log2_work=88.642714 tx=311639037 date='2018-04-22 01:38:52' progress=0.997023 cache=43.0MiB(79831txo)\r\n2018-04-25 03:30:31 UpdateTip: new best=000000000000000000139711f1aafcba0cb1c5478cd6750e67182585b99723c8 height=519341 version=0x20000000 log2_work=88.642764 tx=311640789 date='2018-04-22 01:57:17' progress=0.997035 cache=43.8MiB(86544txo)\r\n2018-04-25 03:30:31 UpdateTip: new best=0000000000000000001290bf95e6bcbe5e2ecc4254a8eb5918bd7c83ff862eed height=519342 version=0x20000000 log2_work=88.642813 tx=311640820 date='2018-04-22 01:57:38' progress=0.997035 cache=43.8MiB(86602txo)\r\n2018-04-25 03:30:31 UpdateTip: new best=00000000000000000033f93e3b264293c478b52c316815407a9e574f5f5f9526 height=519343 version=0x20000000 log2_work=88.642862 tx=311642602 date='2018-04-22 02:18:53' progress=0.997049 cache=44.6MiB(93215txo)\r\n2018-04-25 03:30:32 UpdateTip: new best=0000000000000000001284e7b52cf2f9329d2f2cc70957e6693a6b78d7e3fb4e height=519344 version=0x20000000 log2_work=88.642911 tx=311642967 date='2018-04-22 02:21:26' progress=0.997051 cache=44.8MiB(94933txo)\r\n2018-04-25 03:30:32 UpdateTip: new best=000000000000000000092a3d5d1f401afd767f8a878d448cc7ec959ac8eb2182 height=519345 version=0x20000000 log2_work=88.642961 tx=311643052 date='2018-04-22 02:22:00' progress=0.997052 cache=44.9MiB(95094txo)\r\n2018-04-25 03:30:32 Pre-allocating up to position 0x8000000 in blk01243.dat\r\n2018-04-25 03:30:33 Leaving block file 1243: CBlockFileInfo(blocks=227, size=133602259, heights=519206...519508, time=2018-04-21...2018-04-23)\r\n2018-04-25 03:30:34 Pre-allocating up to position 0x1000000 in blk01244.dat\r\n2018-04-25 03:30:35 Pre-allocating up to position 0x2000000 in blk01244.dat\r\n2018-04-25 03:30:35 Pre-allocating up to position 0x3000000 in blk01244.dat\r\n2018-04-25 03:30:36 Pre-allocating up to position 0x4000000 in blk01244.dat\r\n2018-04-25 03:30:37 Pre-allocating up to position 0x5000000 in blk01244.dat\r\n2018-04-25 03:30:39 Pre-allocating up to position 0x6000000 in blk01244.dat\r\n2018-04-25 03:30:40 Pre-allocating up to position 0x7000000 in blk01244.dat\r\n2018-04-25 03:30:42 Pre-allocating up to position 0x8000000 in blk01244.dat\r\n2018-04-25 03:30:44 Leaving block file 1244: CBlockFileInfo(blocks=161, size=133452832, heights=519455...519733, time=2018-04-22...2018-04-24)\r\n2018-04-25 03:30:45 Pre-allocating up to position 0x1000000 in blk01245.dat\r\n2018-04-25 03:30:45 Pre-allocating up to position 0x2000000 in blk01245.dat\r\n2018-04-25 03:30:47 Pre-allocating up to position 0x3000000 in blk01245.dat\r\n2018-04-25 03:30:48 Pre-allocating up to position 0x4000000 in blk01245.dat\r\n2018-04-25 03:30:49 Pre-allocating up to position 0x5000000 in blk01245.dat\r\n2018-04-25 03:30:51 Pre-allocating up to position 0x6000000 in blk01245.dat\r\n2018-04-25 03:30:54 Pre-allocating up to position 0x7000000 in blk01245.dat\r\n2018-04-25 03:30:58 Pre-allocating up to position 0x8000000 in blk01245.dat\r\n2018-04-25 03:31:01 Leaving block file 1245: CBlockFileInfo(blocks=142, size=133160497, heights=519575...519825, time=2018-04-23...2018-04-25)\r\n2018-04-25 03:31:02 Pre-allocating up to position 0x1000000 in blk01246.dat\r\n2018-04-25 03:31:10 Pre-allocating up to position 0x2000000 in blk01246.dat\r\n2018-04-25 03:32:08 New outbound peer connected: version: 70015, blocks=519825, peer=39\r\n2018-04-25 03:32:31 socket recv error An existing connection was forcibly closed by the remote host.  (10054)\r\n2018-04-25 03:35:59 Pre-allocating up to position 0x100000 in rev01246.dat\r\n2018-04-25 03:36:00 UpdateTip: new best=00000000000000000013f1cca09ffd0858197acc2464de6431c4344590261a8c height=519346 version=0x20000000 log2_work=88.64301 tx=311643927 date='2018-04-22 02:31:50' progress=0.997054 cache=45.4MiB(99165txo)\r\n2018-04-25 03:39:20 socket recv error An existing connection was forcibly closed by the remote host.  (10054)\r\n2018-04-25 03:45:59 Timeout downloading block 00000000000000000014281bac3293465d9bf4d963e394dfa690b94cd0c8c823 from peer=33, disconnecting\r\n2018-04-25 03:46:04 UpdateTip: new best=00000000000000000014281bac3293465d9bf4d963e394dfa690b94cd0c8c823 height=519347 version=0x20000000 log2_work=88.643059 tx=311645894 date='2018-04-22 02:55:03' progress=0.997063 cache=46.1MiB(105259txo)\r\n2018-04-25 03:46:05 UpdateTip: new best=0000000000000000001e30f3d4592587aaa2f196dcec3f804f9f0d7ae8c48473 height=519348 version=0x20000000 log2_work=88.643108 tx=311646931 date='2018-04-22 03:05:58' progress=0.997071 cache=46.4MiB(107332txo)\r\n2018-04-25 03:46:05 UpdateTip: new best=00000000000000000046fcfed8a197895e183d9f7847c12bae50d8bee326d9bc height=519349 version=0x20000000 log2_work=88.643157 tx=311647294 date='2018-04-22 03:09:57' progress=0.997073 cache=46.5MiB(108154txo)\r\n2018-04-25 03:46:05 UpdateTip: new best=00000000000000000008a7be394ba2dd995937d5a34178c49ae8ea44f42370f1 height=519350 version=0x20000000 log2_work=88.643207 tx=311647536 date='2018-04-22 03:12:07' progress=0.997075 cache=46.5MiB(108266txo)\r\n```\r\n\r\nAs you can see, as soon as the block timed out, it began immediately processing blocks quickly again.",
      "created_at" : "2018-04-25T03:53:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12291#issuecomment-384153077",
      "id" : 384153077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12291",
      "updated_at" : "2018-04-25T03:53:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/384153077",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/429961?v=4",
         "events_url" : "https://api.github.com/users/PRabahy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PRabahy/followers",
         "following_url" : "https://api.github.com/users/PRabahy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PRabahy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PRabahy",
         "id" : 429961,
         "login" : "PRabahy",
         "organizations_url" : "https://api.github.com/users/PRabahy/orgs",
         "received_events_url" : "https://api.github.com/users/PRabahy/received_events",
         "repos_url" : "https://api.github.com/users/PRabahy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PRabahy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PRabahy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PRabahy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is happening to us also, causing nodes to fall several minutes behind the rest of the network.",
      "created_at" : "2019-02-02T23:50:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/12291#issuecomment-460009715",
      "id" : 460009715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12291",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ2MDAwOTcxNQ==",
      "updated_at" : "2019-02-02T23:50:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460009715",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/107096?v=4",
         "events_url" : "https://api.github.com/users/devrandom/events{/privacy}",
         "followers_url" : "https://api.github.com/users/devrandom/followers",
         "following_url" : "https://api.github.com/users/devrandom/following{/other_user}",
         "gists_url" : "https://api.github.com/users/devrandom/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/devrandom",
         "id" : 107096,
         "login" : "devrandom",
         "node_id" : "MDQ6VXNlcjEwNzA5Ng==",
         "organizations_url" : "https://api.github.com/users/devrandom/orgs",
         "received_events_url" : "https://api.github.com/users/devrandom/received_events",
         "repos_url" : "https://api.github.com/users/devrandom/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/devrandom/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/devrandom/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/devrandom"
      }
   }
]
