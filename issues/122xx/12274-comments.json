[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164062623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164062623"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should this block be wrapped in a LIBEVENT_VERSION_NUMBER macro guard so it only occurs in the affected version range?\r\n\r\nSeems like it would be easier for future cleanups to see where the version macro is checked, say in the instance that a minimum version of libevent is defined and code like this could be safely removed.",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-01-26T09:14:38Z",
      "diff_hunk" : "@@ -288,14 +376,19 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n     if (i != iend) {\n         std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(std::move(hreq), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n+        if (workQueue->Enqueue(item.get())) {\n+            // Disable reading to work around a libevent bug, fixed in 2.2.0.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164062623",
      "id" : 164062623,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 155,
      "path" : "src/httpserver.cpp",
      "position" : 155,
      "pull_request_review_id" : 91778837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-01-26T09:21:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164062623",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7519582?v=4",
         "events_url" : "https://api.github.com/users/tjps/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tjps/followers",
         "following_url" : "https://api.github.com/users/tjps/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tjps/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tjps",
         "id" : 7519582,
         "login" : "tjps",
         "organizations_url" : "https://api.github.com/users/tjps/orgs",
         "received_events_url" : "https://api.github.com/users/tjps/received_events",
         "repos_url" : "https://api.github.com/users/tjps/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tjps/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tjps/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tjps"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164063956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164063956"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not that it probably matters in most configurations where the fd limit is ~1K, but making this an unordered_set would be slightly beneficial in the high fd limit cases.",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-01-26T09:21:01Z",
      "diff_hunk" : "@@ -40,6 +41,55 @@\n /** Maximum size of http request (request line + headers) */\n static const size_t MAX_HEADERS_SIZE = 8192;\n \n+class ConnectionLimiter\n+{\n+public:\n+    ConnectionLimiter(std::vector<evconnlistener*> listeners, unsigned int limit) : m_limit(limit), m_listeners(std::move(listeners))\n+    {\n+        assert(m_limit > 0);\n+    }\n+    void AddConnection(evutil_socket_t fd)\n+    {\n+        // Disable socket accepting if adding this connection puts us equal to the limit\n+        if (!Interrupted() && m_sockets.insert(fd).second && m_sockets.size() == m_limit) {\n+            LogPrint(BCLog::HTTP, \"Suspending new connections\");\n+            for (const auto& listener : m_listeners) {\n+                evconnlistener_disable(listener);\n+            }\n+        }\n+    }\n+    void RemoveConnection(evutil_socket_t fd)\n+    {\n+        // Re-enable socket accepting if removing this connection brings us\n+        // back down under the limit\n+        if (m_sockets.erase(fd) && m_sockets.size() + 1 == m_limit && !Interrupted()) {\n+            LogPrint(BCLog::HTTP, \"Resuming new connections\\n\");\n+            for (const auto& listener : m_listeners) {\n+                evconnlistener_enable(listener);\n+            }\n+        }\n+    }\n+    bool IsReady() const\n+    {\n+        return m_sockets.size() < m_limit && !Interrupted();\n+    }\n+    void Interrupt()\n+    {\n+        m_interrupted.store(true, std::memory_order_release);\n+    }\n+private:\n+\n+    inline bool Interrupted() const\n+    {\n+        return m_interrupted.load(std::memory_order_acquire);\n+    }\n+\n+    const unsigned int m_limit;\n+    std::vector<evconnlistener*> m_listeners;\n+    std::set<evutil_socket_t> m_sockets;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164063956",
      "id" : 164063956,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 57,
      "path" : "src/httpserver.cpp",
      "position" : 57,
      "pull_request_review_id" : 91778837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-01-26T09:21:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164063956",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7519582?v=4",
         "events_url" : "https://api.github.com/users/tjps/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tjps/followers",
         "following_url" : "https://api.github.com/users/tjps/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tjps/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tjps",
         "id" : 7519582,
         "login" : "tjps",
         "organizations_url" : "https://api.github.com/users/tjps/orgs",
         "received_events_url" : "https://api.github.com/users/tjps/received_events",
         "repos_url" : "https://api.github.com/users/tjps/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tjps/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tjps/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tjps"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "This needs to be tested by those experiencing the issue: @KanoczTomas @vii",
      "created_at" : "2018-01-28T09:03:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-361048140",
      "id" : 361048140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-01-28T09:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361048140",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nWhy don't understand why you need dc53bec, seems like an unnecessary refactor.\r\n\r\n5f5099a and 3b0ebb3 could be in a separate PR, are simple and make sense even without the fd exhaustion problem.",
      "created_at" : "2018-01-29T21:32:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-361393618",
      "id" : 361393618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-01-29T21:32:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361393618",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164584840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164584840"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-01-29T22:27:01Z",
      "diff_hunk" : "@@ -40,6 +41,55 @@\n /** Maximum size of http request (request line + headers) */\n static const size_t MAX_HEADERS_SIZE = 8192;\n \n+class ConnectionLimiter\n+{\n+public:\n+    ConnectionLimiter(std::vector<evconnlistener*> listeners, unsigned int limit) : m_limit(limit), m_listeners(std::move(listeners))\n+    {\n+        assert(m_limit > 0);\n+    }\n+    void AddConnection(evutil_socket_t fd)\n+    {\n+        // Disable socket accepting if adding this connection puts us equal to the limit\n+        if (!Interrupted() && m_sockets.insert(fd).second && m_sockets.size() == m_limit) {\n+            LogPrint(BCLog::HTTP, \"Suspending new connections\");\n+            for (const auto& listener : m_listeners) {\n+                evconnlistener_disable(listener);\n+            }\n+        }\n+    }\n+    void RemoveConnection(evutil_socket_t fd)\n+    {\n+        // Re-enable socket accepting if removing this connection brings us\n+        // back down under the limit\n+        if (m_sockets.erase(fd) && m_sockets.size() + 1 == m_limit && !Interrupted()) {\n+            LogPrint(BCLog::HTTP, \"Resuming new connections\\n\");\n+            for (const auto& listener : m_listeners) {\n+                evconnlistener_enable(listener);\n+            }\n+        }\n+    }\n+    bool IsReady() const\n+    {\n+        return m_sockets.size() < m_limit && !Interrupted();\n+    }\n+    void Interrupt()\n+    {\n+        m_interrupted.store(true, std::memory_order_release);\n+    }\n+private:\n+\n+    inline bool Interrupted() const\n+    {\n+        return m_interrupted.load(std::memory_order_acquire);\n+    }\n+\n+    const unsigned int m_limit;\n+    std::vector<evconnlistener*> m_listeners;\n+    std::set<evutil_socket_t> m_sockets;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164584840",
      "id" : 164584840,
      "in_reply_to_id" : 164063956,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 57,
      "path" : "src/httpserver.cpp",
      "position" : 57,
      "pull_request_review_id" : 92380641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-01-29T22:27:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164584840",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164585509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164585509"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is just move-only from above. There's no need to guard it with an ifdef because there's no api difference, it's purely a runtime check.",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-01-29T22:29:14Z",
      "diff_hunk" : "@@ -288,14 +376,19 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n     if (i != iend) {\n         std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(std::move(hreq), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n+        if (workQueue->Enqueue(item.get())) {\n+            // Disable reading to work around a libevent bug, fixed in 2.2.0.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164585509",
      "id" : 164585509,
      "in_reply_to_id" : 164062623,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 155,
      "path" : "src/httpserver.cpp",
      "position" : 155,
      "pull_request_review_id" : 92381303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-01-29T22:29:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164585509",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag dc53bec is just a small chunk of c56cf1a that seemed reasonable on its own.",
      "created_at" : "2018-01-29T22:30:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-361409373",
      "id" : 361409373,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-01-29T22:30:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361409373",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164638877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164638877"
         }
      },
      "author_association" : "NONE",
      "body" : "awesome that you're using the callback - one way to unambiguously detect the presence of the new feature would be to add a new autoconf test maybe using AC_LINK_IFELSE for evhttp_set_newreqcb\r\n\r\n",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-01-30T04:36:15Z",
      "diff_hunk" : "@@ -300,6 +300,22 @@ static void connection_close_cb(evhttp_connection* conn, void *arg)\n     }\n }\n \n+#if LIBEVENT_VERSION_NUMBER >= 0x02020001",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r164638877",
      "id" : 164638877,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 4,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_review_id" : 92440510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-01-30T04:36:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/164638877",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Awesome! The defer accept tweak will defend against typical inadvertent denial of services\r\n\r\nNote that the original issue can still be activated depending on the file descriptor limit that is set, as the budgeting in the daemon does not account for this usage or the usage in the db code - see\r\nhttps://github.com/bitcoin/bitcoin/pull/11785\r\n\r\nTo test it, something like this slowhttptest program\r\n\r\n```\r\nslowhttptest -c 40000 -r 1000 -u 'http://127.0.0.1:8332/rest/block/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f.json'\r\n```\r\n\r\nor another tool which can simulate a slowloris (HTTP connection header trickling) attack",
      "created_at" : "2018-01-30T04:42:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-361475533",
      "id" : 361475533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-01-30T04:42:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361475533",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/37696?v=4",
         "events_url" : "https://api.github.com/users/vii/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vii/followers",
         "following_url" : "https://api.github.com/users/vii/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vii/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vii",
         "id" : 37696,
         "login" : "vii",
         "organizations_url" : "https://api.github.com/users/vii/orgs",
         "received_events_url" : "https://api.github.com/users/vii/received_events",
         "repos_url" : "https://api.github.com/users/vii/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vii/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vii/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vii"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Sorry, I'm removing the 0.16.0 milestone here. As it introduces many new concepts and work-arounds it is hard to review last-minute, the problem is hard to trigger in the first place, and it is not a regression since 0.15. Also according to @vii it doesn't solve the issue completely. I think getting the fd issue fixed properly should be a focus for 0.16.1.",
      "created_at" : "2018-01-30T11:27:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-361565094",
      "id" : 361565094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-01-30T11:27:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/361565094",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r173646080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173646080"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would like to see this defined separately as:\r\n\r\n```c++\r\n#if LIBEVENT_VERSION_NUMBER >= 0x02020001\r\n#define HAVE_EVHTTP_SET_NEWREQCB 1\r\n#endif\r\n```\r\n\r\nThat way the check here is more obvious, particularly since you do the check elsewhere. Of course, even better than this would be to use `AC_CHECK_FUNC()`...",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-03-11T07:46:36Z",
      "diff_hunk" : "@@ -426,6 +520,26 @@ bool InitHTTPServer()\n     int workQueueDepth = std::max((long)gArgs.GetArg(\"-rpcworkqueue\", DEFAULT_HTTP_WORKQUEUE), 1L);\n     LogPrintf(\"HTTP: creating work queue of depth %d\\n\", workQueueDepth);\n \n+    std::vector<evconnlistener*> listeners;\n+    for (const auto& bind_handle : boundSockets) {\n+        evconnlistener* listener = evhttp_bound_socket_get_listener(bind_handle);\n+        evutil_socket_t sock = evhttp_bound_socket_get_fd(bind_handle);\n+        SetListenSocketDeferred(sock);\n+        listeners.push_back(listener);\n+    }\n+    g_limiter = MakeUnique<ConnectionLimiter>(std::move(listeners), workQueueDepth * 2);\n+    evhttp_set_gencb(http, http_request_cb, g_limiter.get());\n+\n+#if LIBEVENT_VERSION_NUMBER >= 0x02020001",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r173646080",
      "id" : 173646080,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 229,
      "path" : "src/httpserver.cpp",
      "position" : 229,
      "pull_request_review_id" : 102873672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-03-11T07:50:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173646080",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r173646136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173646136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is the first time I've seen `static constexpr` used correctly in the Bitcoin code, congratulations.",
      "commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "created_at" : "2018-03-11T07:49:13Z",
      "diff_hunk" : "@@ -724,3 +724,13 @@ void InterruptSocks5(bool interrupt)\n {\n     interruptSocks5Recv = interrupt;\n }\n+\n+bool SetListenSocketDeferred(const SOCKET& sock)\n+{\n+    bool ret = false;\n+#ifdef TCP_DEFER_ACCEPT\n+    static constexpr int set = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#discussion_r173646136",
      "id" : 173646136,
      "original_commit_id" : "cdcc0ed01195bf88532a9afc905593833a7af43c",
      "original_position" : 9,
      "path" : "src/netbase.cpp",
      "position" : 9,
      "pull_request_review_id" : 102873672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/12274",
      "updated_at" : "2018-03-11T07:50:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/173646136",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@eklitzke I can still produce a crash with these changes on top of https://github.com/bitcoin/bitcoin/commit/2405ce1df043f778b8efb9205009500cbc17313a:\r\n\r\n<img width=\"770\" alt=\"screenshot 2018-03-22 at 12 04 52 am\" src=\"https://user-images.githubusercontent.com/863730/37721599-e5febea4-2d64-11e8-9e43-6836ab0ef507.png\">\r\n\r\n```\r\ndate='2015-09-16T16:18:02Z' progress=0.269372 cache=313.8MiB(2336744txo)\r\n2018-03-21T16:04:44Z UpdateTip: new best=00000000000000000c7112c52408963acb80e1fedc71005859d6ef9a22f84d79 height=374820 version=0x00000003 log2_work=83.354829 tx=84036580 date='2015-09-16T16:20:12Z' progress=0.269373 cache=313.8MiB(2337189txo)\r\n2018-03-21T16:04:44Z LevelDB read failure: IO error: /Users/fanquake/Library/Application Support/Bitcoin/chainstate/019338.ldb: Too many open files\r\n2018-03-21T16:04:44Z Fatal LevelDB error: IO error: /Users/fanquake/Library/Application Support/Bitcoin/chainstate/019338.ldb: Too many open files\r\n2018-03-21T16:04:44Z You can use -debug=leveldb to get more complete diagnostic messages\r\n2018-03-21T16:04:44Z libevent: Error from accept() call: Too many open files\r\n2018-03-21T16:04:44Z libevent: Error from accept() call: Too many open files\r\n2018-03-21T16:04:44Z libevent: Error from accept() call: Too many open files\r\n2018-03-21T16:04:44Z libevent: Error from accept() call: Too many open files\r\n```\r\n\r\nWhen last discussed with @theuni he was going to revamp these changes.",
      "created_at" : "2018-03-21T16:08:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-374996649",
      "id" : 374996649,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-03-21T23:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/374996649",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fanquake Interesting -- do you have a script to stress test it to induce that condition? Or does that happen during normal operation?",
      "created_at" : "2018-03-21T22:59:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/12274#issuecomment-375123557",
      "id" : 375123557,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/12274",
      "updated_at" : "2018-03-21T22:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/375123557",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/2734?v=4",
         "events_url" : "https://api.github.com/users/eklitzke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eklitzke/followers",
         "following_url" : "https://api.github.com/users/eklitzke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eklitzke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eklitzke",
         "id" : 2734,
         "login" : "eklitzke",
         "organizations_url" : "https://api.github.com/users/eklitzke/orgs",
         "received_events_url" : "https://api.github.com/users/eklitzke/received_events",
         "repos_url" : "https://api.github.com/users/eklitzke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eklitzke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eklitzke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eklitzke"
      }
   }
]
