[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The RPCs should probably be fixed to never return fake values.\r\n\r\nIt is pretty easy to tell when the `nTx` value is fake. You can just call [`IsValid()`](https://github.com/bitcoin/bitcoin/blob/478ac185be49feffd1231366c07e06068683f941/src/chain.h#L306), and if it returns true, the `nTx` value is real, and if it returns false, the value is fake.\r\n\r\nIt is less straightforward to determine when the `nChainTx` is fake, but we could introduce a helper function to do that which could be used by these RPCs and also be useful for #29299. If `nChainTx` is greater than 0, and nSequenceId is not 0 or `BLOCK_ASSUMED_VALID` is not set or the block is the snapshot block, then `nChainTx` value is real. Otherwise the `nChainTx` is probably fake. This check could falsely indicate that real `nChainTx` values were fake in the interval between blocks being downloaded and fully validated, but this should not be a big deal.\r\n\r\nIn the long run it would be better to just not set fake values. According to a comment in [`PopulateAndValidateSnapshot`](https://github.com/bitcoin/bitcoin/blob/478ac185be49feffd1231366c07e06068683f941/src/validation.cpp#L5540) these values are only faked so that [`GuessVerificationProgress`](https://github.com/bitcoin/bitcoin/blob/478ac185be49feffd1231366c07e06068683f941/src/validation.cpp#L5116) works better. I don't know if this is true, but if it is true, it seems like `GuessVerificationProgress` could just report progress based on block heights instead of transaction counts below the snapshot height, and we could get rid of the fake values, leaving nTx and nChainTx set to 0 when unknown and nonzero when known.",
      "created_at" : "2024-01-29T15:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1914922108",
      "id" : 1914922108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yI2R8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1914922108/reactions"
      },
      "updated_at" : "2024-01-29T15:22:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1914922108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't know if this is true, but if it is true, it seems like `GuessVerificationProgress` could just report progress based on block heights instead of transaction counts\r\n\r\nIf we can do that, we should get rid of nChainTx altogether. I think that its only other use is for `HaveNumChainTxs` which doesn't use its value but checks whether it is 0. That would also save some memory and eliminate problems like #29258.\r\n\r\nHowever, just using block heights would be very inaccurate because the first ~300k blocks are almost empty.\r\nMaybe we could plot the `nChainTx` for each block, use non-linear regression to fit some mathematical function (e.g. some polynomial, possibly piecewise) to approximate it, and then use that and get rid of `nChainTx`?\r\n",
      "created_at" : "2024-01-29T16:18:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1915053025",
      "id" : 1915053025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yJWPh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915053025/reactions"
      },
      "updated_at" : "2024-01-29T16:18:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915053025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> If we can do that, we should get rid of nChainTx altogether.\r\n\r\nOh, I don't think we should use block heights instead of _real_ nChainTx values, because as you say using block heights would be very inaccurate. I'm just suggesting we could use block heights instead of _fake_ nChainTx values, and we would not be worse off because currently the fake nChainTx values are set to block heights. Also probably it probably be good to estimate the number of transactions in BLOCK_ASSUMED_VALID blocks by interpolating between nChainTx in the snapshot block, and nChainTx in the last validated block, instead of assuming each block before the snapshot has 1 transaction.",
      "created_at" : "2024-01-29T16:55:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1915158550",
      "id" : 1915158550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yJwAW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915158550/reactions"
      },
      "updated_at" : "2024-01-29T16:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915158550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I see, I misunderstood. Still might also be worth thinking about getting rid of `nChainTx` in the long run (which has been discussed before in #13875), but that is off-topic here.",
      "created_at" : "2024-01-29T17:41:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1915247542",
      "id" : 1915247542,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yKFu2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915247542/reactions"
      },
      "updated_at" : "2024-01-29T17:41:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1915247542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It is pretty easy to tell when the `nTx` value is fake. You can just call [`IsValid()`](https://github.com/bitcoin/bitcoin/blob/478ac185be49feffd1231366c07e06068683f941/src/chain.h#L306), and if it returns true, the `nTx` value is real, and if it returns false, the value is fake.\r\n\r\nI don't think this is true. For example, it is possible that a block was downloaded and the `nTx` value was set, but the block later turned out to be invalid. Thus `IsValid()` will return false, but the `nTx` value is real.",
      "created_at" : "2024-01-30T17:27:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1917542993",
      "id" : 1917542993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yS2JR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1917542993/reactions"
      },
      "updated_at" : "2024-01-30T17:27:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1917542993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't think this is true. For example, it is possible that a block was downloaded and the `nTx` value was set, but the block later turned out to be invalid. Thus `IsValid()` will return false, but the `nTx` value is real.\r\n\r\nGood point. Maybe the practical consequences would not be too bad if it just causes nTx to be omitted from rpc results when in some cases it shouldn't be. But this seems like another reason to want get rid of the fake assumeutxo nTx and nChainTx values, so we can simply treat 0 values as invalid, and nonzero values as valid.\r\n\r\nEDIT: It also seems like BLOCK_VALID_TRANSACTIONS level is not removed if a block is marked invalid (a BLOCK_FAILED_VALID flag is added instead). So code could check level is >= BLOCK_VALID_TRANSACTIONS directly to see if nTx is valid.",
      "created_at" : "2024-01-30T18:37:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1917663387",
      "id" : 1917663387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yTTib",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1917663387/reactions"
      },
      "updated_at" : "2024-01-31T17:24:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1917663387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Please help me figure out why this transaction is not confirmed?8f62acf0f0ddc3e38db2e8ec2755f4e54aa5bf616d685e2f3361155fc9d44125",
      "created_at" : "2024-01-30T19:54:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1917783750",
      "id" : 1917783750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585yTw7G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1917783750/reactions"
      },
      "updated_at" : "2024-01-30T19:54:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1917783750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/158217006?v=4",
         "events_url" : "https://api.github.com/users/Wwwwwwuuuuu/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Wwwwwwuuuuu/followers",
         "following_url" : "https://api.github.com/users/Wwwwwwuuuuu/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Wwwwwwuuuuu/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Wwwwwwuuuuu",
         "id" : 158217006,
         "login" : "Wwwwwwuuuuu",
         "node_id" : "U_kgDOCW4zLg",
         "organizations_url" : "https://api.github.com/users/Wwwwwwuuuuu/orgs",
         "received_events_url" : "https://api.github.com/users/Wwwwwwuuuuu/received_events",
         "repos_url" : "https://api.github.com/users/Wwwwwwuuuuu/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Wwwwwwuuuuu/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Wwwwwwuuuuu/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Wwwwwwuuuuu"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Attempting to get rid of the fake values in #29370",
      "created_at" : "2024-02-02T16:20:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29328#issuecomment-1924198876",
      "id" : 1924198876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
      "node_id" : "IC_kwDOABII585ysPHc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924198876/reactions"
      },
      "updated_at" : "2024-02-02T16:20:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924198876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
