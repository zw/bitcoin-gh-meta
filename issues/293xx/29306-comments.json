[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29306).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29427](https://github.com/bitcoin/bitcoin/pull/29427) (Add imbued v3 based on template-matching by sdaftuar)\n* [#28984](https://github.com/bitcoin/bitcoin/pull/28984) (Cluster size 2 package rbf by instagibbs)\n* [#28886](https://github.com/bitcoin/bitcoin/pull/28886) (refactor: Replace sets of txiter with CTxMemPoolEntryRefs by TheCharlatan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-01-24T14:30:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#issuecomment-1908245452",
      "id" : 1908245452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29306",
      "node_id" : "IC_kwDOABII585xvYPM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1908245452/reactions"
      },
      "updated_at" : "2024-02-15T19:24:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1908245452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466473683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466473683"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```Suggestion\r\n                // we don't conflict inputs with it, consider evicting it under RBF rules. We rely on v3 rules\r\n```",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T14:39:52Z",
      "diff_hunk" : "@@ -180,6 +180,21 @@ std::optional<std::pair<std::string, CTransactionRef>> ApplyV3Rules(const CTrans\n                 std::any_of(children.cbegin(), children.cend(),\n                     [&direct_conflicts](const CTxMemPoolEntry& child){return direct_conflicts.count(child.GetTx().GetHash()) > 0;});\n             if (parent_entry->GetCountWithDescendants() + 1 > V3_DESCENDANT_LIMIT && !child_will_be_replaced) {\n+                // Allow sibling eviction for v3 transaction: if another child already exists, even if\n+                // we don't conflict with it, consider evicting it under RBF rules. We rely on v3 rules",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466473683",
      "id" : 1466473683,
      "line" : 184,
      "node_id" : "PRRC_kwDOABII585XaJzT",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 184,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : 184,
      "pull_request_review_id" : 1843901103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466473683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T15:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466473683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466475345"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466475345"
         }
      },
      "author_association" : "MEMBER",
      "body" : "aside: In relaxed topos we just attempt the eviction of *all* of them",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T14:41:03Z",
      "diff_hunk" : "@@ -180,6 +180,21 @@ std::optional<std::pair<std::string, CTransactionRef>> ApplyV3Rules(const CTrans\n                 std::any_of(children.cbegin(), children.cend(),\n                     [&direct_conflicts](const CTxMemPoolEntry& child){return direct_conflicts.count(child.GetTx().GetHash()) > 0;});\n             if (parent_entry->GetCountWithDescendants() + 1 > V3_DESCENDANT_LIMIT && !child_will_be_replaced) {\n+                // Allow sibling eviction for v3 transaction: if another child already exists, even if\n+                // we don't conflict with it, consider evicting it under RBF rules. We rely on v3 rules\n+                // only permitting 1 descendant, as otherwise we would need to have logic for deciding\n+                // which descendant to evict. Skip if this isn't true, e.g. if this transaction has",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466475345",
      "id" : 1466475345,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585XaKNR",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 186,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : 186,
      "pull_request_review_id" : 1843901103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466475345/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T15:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466475345",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466484490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466484490"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this return value needs to be explained very well ",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T14:47:27Z",
      "diff_hunk" : "@@ -55,11 +55,11 @@ static_assert(V3_CHILD_MAX_VSIZE + MAX_STANDARD_TX_WEIGHT / WITNESS_SCALE_FACTOR\n  * @param[in]   vsize                   The sigop-adjusted virtual size of ptx.\n  * @returns an error string if any v3 rule was violated, otherwise std::nullopt.\n  */\n-std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n-                                        const CTxMemPool::setEntries& mempool_ancestors,\n-                                        unsigned int num_in_pkg_ancestors,\n-                                        const std::set<Txid>& direct_conflicts,\n-                                        int64_t vsize);\n+std::optional<std::pair<std::string, CTransactionRef>> ApplyV3Rules(const CTransactionRef& ptx,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466484490",
      "id" : 1466484490,
      "line" : 58,
      "node_id" : "PRRC_kwDOABII585XaMcK",
      "original_commit_id" : "a28681ed1c4291d0d9cc53f0faae07815d588449",
      "original_line" : 58,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.h",
      "position" : 58,
      "pull_request_review_id" : 1843901103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466484490/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T15:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466484490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466531988"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466531988"
         }
      },
      "author_association" : "MEMBER",
      "body" : "did you consider internalizing this logic inside `ApplyV3` directly to reduce conceptual sprawl",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T15:20:20Z",
      "diff_hunk" : "@@ -967,7 +972,19 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     CTxMemPool::setEntries collective_ancestors = *ancestors;\n     collective_ancestors.merge(ws.m_ancestors_of_in_package_ancestors);\n     if (const auto err{ApplyV3Rules(ws.m_ptx, collective_ancestors, ws.m_num_in_package_ancestors, ws.m_conflicts, ws.m_vsize)}) {\n-        return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation\", err->first);\n+        // Disabled within package validation.\n+        if (err->second != nullptr && !args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466531988",
      "id" : 1466531988,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII585XaYCU",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 976,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 101,
      "pull_request_review_id" : 1843901103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466531988/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T15:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466531988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466538340"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466538340"
         }
      },
      "author_association" : "MEMBER",
      "body" : "needs test coverage",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T15:24:54Z",
      "diff_hunk" : "@@ -1007,16 +1024,28 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n         // Even though this is a fee-related failure, this result is TX_MEMPOOL_POLICY, not\n         // TX_RECONSIDERABLE, because it cannot be bypassed using package validation.\n         // This must be changed if package RBF is enabled.\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because insufficient fee\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"insufficient fee\", *err_string);\n     }\n \n     // Calculate all conflicting entries and enforce Rule #5.\n     if (const auto err_string{GetEntriesForConflicts(tx, m_pool, ws.m_iters_conflicting, ws.m_all_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because too many potential replacements\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY,\n                              \"too many potential replacements\", *err_string);\n     }\n     // Enforce Rule #2.\n     if (const auto err_string{HasNoNewUnconfirmed(tx, m_pool, ws.m_iters_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because replacement-adds-unconfirmed\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466538340",
      "id" : 1466538340,
      "line" : 1046,
      "node_id" : "PRRC_kwDOABII585XaZlk",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 1046,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 140,
      "pull_request_review_id" : 1843901103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466538340/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T15:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466538340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466648992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466648992"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do you mean all of the sibling eviction logic? That doesn't work because we'd only enforce that the tx pays enough to evict siblings OR conflicting transactions; it needs to pay for both.\r\n\r\nIf you mean the logic adding stuff to `m_conflicts`, `m_iters_conflicting`, etc., it's because I don't like in-out parameters.",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T16:41:49Z",
      "diff_hunk" : "@@ -967,7 +972,19 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     CTxMemPool::setEntries collective_ancestors = *ancestors;\n     collective_ancestors.merge(ws.m_ancestors_of_in_package_ancestors);\n     if (const auto err{ApplyV3Rules(ws.m_ptx, collective_ancestors, ws.m_num_in_package_ancestors, ws.m_conflicts, ws.m_vsize)}) {\n-        return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation\", err->first);\n+        // Disabled within package validation.\n+        if (err->second != nullptr && !args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466648992",
      "id" : 1466648992,
      "in_reply_to_id" : 1466531988,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII585Xa0mg",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 976,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 101,
      "pull_request_review_id" : 1844187891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466648992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T16:41:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466648992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466657588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466657588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the latter, but at least you gave a reason why not",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T16:45:51Z",
      "diff_hunk" : "@@ -967,7 +972,19 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     CTxMemPool::setEntries collective_ancestors = *ancestors;\n     collective_ancestors.merge(ws.m_ancestors_of_in_package_ancestors);\n     if (const auto err{ApplyV3Rules(ws.m_ptx, collective_ancestors, ws.m_num_in_package_ancestors, ws.m_conflicts, ws.m_vsize)}) {\n-        return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation\", err->first);\n+        // Disabled within package validation.\n+        if (err->second != nullptr && !args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466657588",
      "id" : 1466657588,
      "in_reply_to_id" : 1466531988,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII585Xa2s0",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 976,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 101,
      "pull_request_review_id" : 1844202854,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466657588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T16:45:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466657588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466658531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466658531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's impossible to hit, since we're v3-only and it can't have another ancestor. Maybe we just omit this case? I figured somebody would advocate for having it just in case.",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-25T16:46:25Z",
      "diff_hunk" : "@@ -1007,16 +1024,28 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n         // Even though this is a fee-related failure, this result is TX_MEMPOOL_POLICY, not\n         // TX_RECONSIDERABLE, because it cannot be bypassed using package validation.\n         // This must be changed if package RBF is enabled.\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because insufficient fee\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"insufficient fee\", *err_string);\n     }\n \n     // Calculate all conflicting entries and enforce Rule #5.\n     if (const auto err_string{GetEntriesForConflicts(tx, m_pool, ws.m_iters_conflicting, ws.m_all_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because too many potential replacements\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY,\n                              \"too many potential replacements\", *err_string);\n     }\n     // Enforce Rule #2.\n     if (const auto err_string{HasNoNewUnconfirmed(tx, m_pool, ws.m_iters_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because replacement-adds-unconfirmed\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1466658531",
      "id" : 1466658531,
      "in_reply_to_id" : 1466538340,
      "line" : 1046,
      "node_id" : "PRRC_kwDOABII585Xa27j",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 1046,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 140,
      "pull_request_review_id" : 1844204623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466658531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-25T16:46:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1466658531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1467461085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1467461085"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah I think passing those in would be a bit unhygienic. `ApplyV3Rules` would be using the contents beforehand to decide whether a child would be replaced, and then potentially modifying it in a way that looks like the child would replace it.",
      "commit_id" : "72a8433074be557cc25de3ae2396e3b8573478d1",
      "created_at" : "2024-01-26T10:18:19Z",
      "diff_hunk" : "@@ -967,7 +972,19 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n     CTxMemPool::setEntries collective_ancestors = *ancestors;\n     collective_ancestors.merge(ws.m_ancestors_of_in_package_ancestors);\n     if (const auto err{ApplyV3Rules(ws.m_ptx, collective_ancestors, ws.m_num_in_package_ancestors, ws.m_conflicts, ws.m_vsize)}) {\n-        return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation\", err->first);\n+        // Disabled within package validation.\n+        if (err->second != nullptr && !args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1467461085",
      "id" : 1467461085,
      "in_reply_to_id" : 1466531988,
      "line" : 976,
      "node_id" : "PRRC_kwDOABII585Xd63d",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 976,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 101,
      "pull_request_review_id" : 1845437541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1467461085/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-01-26T10:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1467461085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-02-10T04:43:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#issuecomment-1936861861",
      "id" : 1936861861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29306",
      "node_id" : "IC_kwDOABII585zciql",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936861861/reactions"
      },
      "updated_at" : "2024-02-10T04:43:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936861861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Currently traveling but will push a rebase soon.\r\n\r\nEl El sÃ¡b, 10 feb 2024 a las 1:43, DrahtBot ***@***.***>\r\nescribiÃ³:\r\n\r\n> ð This pull request conflicts with the target branch and needs rebase\r\n> <https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes>\r\n> .\r\n>\r\n> â\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/bitcoin/bitcoin/pull/29306#issuecomment-1936861861>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/AGAEGGOQHPRFWDNWV3DTRRTYS33INAVCNFSM6AAAAABCI3QW5WVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMYTSMZWHA3DCOBWGE>\r\n> .\r\n> You are receiving this because you authored the thread.Message ID:\r\n> ***@***.***>\r\n>\r\n",
      "created_at" : "2024-02-13T15:21:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#issuecomment-1941768684",
      "id" : 1941768684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29306",
      "node_id" : "IC_kwDOABII585zvQns",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1941768684/reactions"
      },
      "updated_at" : "2024-02-13T15:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1941768684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1493792426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493792426"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should be impossible right?  Maybe just an `Assume()` to check that there's no sibling eviction going on in this scenario?",
      "commit_id" : "96eadd132cc48a1f016beefd24e8faa71803c027",
      "created_at" : "2024-02-18T15:44:43Z",
      "diff_hunk" : "@@ -995,16 +1015,28 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n         // Even though this is a fee-related failure, this result is TX_MEMPOOL_POLICY, not\n         // TX_RECONSIDERABLE, because it cannot be bypassed using package validation.\n         // This must be changed if package RBF is enabled.\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation and cannot bypass because insufficient fee\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"insufficient fee\", *err_string);\n     }\n \n     // Calculate all conflicting entries and enforce Rule #5.\n     if (const auto err_string{GetEntriesForConflicts(tx, m_pool, ws.m_iters_conflicting, ws.m_all_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation and cannot bypass because too many potential replacements\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY,\n                              \"too many potential replacements\", *err_string);\n     }\n     // Enforce Rule #2.\n     if (const auto err_string{HasNoNewUnconfirmed(tx, m_pool, ws.m_iters_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1493792426",
      "id" : 1493792426,
      "line" : 1036,
      "node_id" : "PRRC_kwDOABII585ZCXaq",
      "original_commit_id" : "55a6b995ce938e646de5cda73891053febab53f0",
      "original_line" : 1036,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 69,
      "pull_request_review_id" : 1887268593,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493792426/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-18T15:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493792426",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1493837935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493837935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should we also exclude the case where the sibling transaction has descendants of its own, which can happen as the result of a reorg? My concern is that our RBF rules today don't enforce incentive compatibility in such a situation, so it's not clear that we should support this case for now (post-cluster-mempool, this would be fine).",
      "commit_id" : "96eadd132cc48a1f016beefd24e8faa71803c027",
      "created_at" : "2024-02-18T20:22:41Z",
      "diff_hunk" : "@@ -214,10 +213,27 @@ std::optional<std::pair<std::string, CTransactionRef>> SingleV3Checks(const CTra\n             std::any_of(children.cbegin(), children.cend(),\n                 [&direct_conflicts](const CTxMemPoolEntry& child){return direct_conflicts.count(child.GetTx().GetHash()) > 0;});\n         if (parent_entry->GetCountWithDescendants() + 1 > V3_DESCENDANT_LIMIT && !child_will_be_replaced) {\n-            return std::make_pair(strprintf(\"tx %u (wtxid=%s) would exceed descendant count limit\",\n-                             parent_entry->GetSharedTx()->GetHash().ToString(),\n-                             parent_entry->GetSharedTx()->GetWitnessHash().ToString()),\n-                nullptr);\n+            // Allow sibling eviction for v3 transaction: if another child already exists, even if\n+            // we don't conflict with it, consider evicting it under RBF rules. We rely on v3 rules\n+            // only permitting 1 descendant, as otherwise we would need to have logic for deciding\n+            // which descendant to evict. Skip if this isn't true, e.g. if this transaction has\n+            // extra descendants due to a reorg.\n+            const bool consider_sibling_eviction{children.size() == 1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1493837935",
      "id" : 1493837935,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII585ZCihv",
      "original_commit_id" : "55a6b995ce938e646de5cda73891053febab53f0",
      "original_line" : 221,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : 94,
      "pull_request_review_id" : 1887319224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493837935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-18T20:22:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493837935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> alternative log lines are a bit noisy, but understandable and I have no good suggestions that reduce that much\r\n> I'm not sure how important it is to return the v3 error messages if sibling RBF fails. \r\n\r\nI've changed it to just add \"(including sibling eviction)\" when that is what's happening. The diff is less invasive this way, but let me know if still too clunky. I just want to avoid confusing users (\"wait, why am I getting an RBF error if I didn't try to replace anything?\").",
      "created_at" : "2024-02-19T12:02:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#issuecomment-1952306161",
      "id" : 1952306161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29306",
      "node_id" : "IC_kwDOABII5850XdPx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1952306161/reactions"
      },
      "updated_at" : "2024-02-19T12:02:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1952306161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494446464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494446464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed this to be `parent_entry->GetCountWithDescendants() == 2` so no grandchildren and no other siblings.",
      "commit_id" : "8ee900fba998a3edac0da4f4632bb2a3f06cc7b1",
      "created_at" : "2024-02-19T12:03:18Z",
      "diff_hunk" : "@@ -214,10 +213,27 @@ std::optional<std::pair<std::string, CTransactionRef>> SingleV3Checks(const CTra\n             std::any_of(children.cbegin(), children.cend(),\n                 [&direct_conflicts](const CTxMemPoolEntry& child){return direct_conflicts.count(child.GetTx().GetHash()) > 0;});\n         if (parent_entry->GetCountWithDescendants() + 1 > V3_DESCENDANT_LIMIT && !child_will_be_replaced) {\n-            return std::make_pair(strprintf(\"tx %u (wtxid=%s) would exceed descendant count limit\",\n-                             parent_entry->GetSharedTx()->GetHash().ToString(),\n-                             parent_entry->GetSharedTx()->GetWitnessHash().ToString()),\n-                nullptr);\n+            // Allow sibling eviction for v3 transaction: if another child already exists, even if\n+            // we don't conflict with it, consider evicting it under RBF rules. We rely on v3 rules\n+            // only permitting 1 descendant, as otherwise we would need to have logic for deciding\n+            // which descendant to evict. Skip if this isn't true, e.g. if this transaction has\n+            // extra descendants due to a reorg.\n+            const bool consider_sibling_eviction{children.size() == 1};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494446464",
      "id" : 1494446464,
      "in_reply_to_id" : 1493837935,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZE3GA",
      "original_commit_id" : "55a6b995ce938e646de5cda73891053febab53f0",
      "original_line" : 221,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1888253362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494446464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T12:03:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494446464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447054"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added an `Assume`",
      "commit_id" : "8ee900fba998a3edac0da4f4632bb2a3f06cc7b1",
      "created_at" : "2024-02-19T12:03:51Z",
      "diff_hunk" : "@@ -995,16 +1015,28 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n         // Even though this is a fee-related failure, this result is TX_MEMPOOL_POLICY, not\n         // TX_RECONSIDERABLE, because it cannot be bypassed using package validation.\n         // This must be changed if package RBF is enabled.\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation and cannot bypass because insufficient fee\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"insufficient fee\", *err_string);\n     }\n \n     // Calculate all conflicting entries and enforce Rule #5.\n     if (const auto err_string{GetEntriesForConflicts(tx, m_pool, ws.m_iters_conflicting, ws.m_all_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-rule-violation and cannot bypass because too many potential replacements\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY,\n                              \"too many potential replacements\", *err_string);\n     }\n     // Enforce Rule #2.\n     if (const auto err_string{HasNoNewUnconfirmed(tx, m_pool, ws.m_iters_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447054",
      "id" : 1494447054,
      "in_reply_to_id" : 1493792426,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZE3PO",
      "original_commit_id" : "55a6b995ce938e646de5cda73891053febab53f0",
      "original_line" : 1036,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1888254319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447054/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T12:03:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Kept this and added an `Assume`, also see https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1493792426",
      "commit_id" : "8ee900fba998a3edac0da4f4632bb2a3f06cc7b1",
      "created_at" : "2024-02-19T12:04:12Z",
      "diff_hunk" : "@@ -1007,16 +1024,28 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n         // Even though this is a fee-related failure, this result is TX_MEMPOOL_POLICY, not\n         // TX_RECONSIDERABLE, because it cannot be bypassed using package validation.\n         // This must be changed if package RBF is enabled.\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because insufficient fee\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"insufficient fee\", *err_string);\n     }\n \n     // Calculate all conflicting entries and enforce Rule #5.\n     if (const auto err_string{GetEntriesForConflicts(tx, m_pool, ws.m_iters_conflicting, ws.m_all_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because too many potential replacements\",\n+                                 strprintf(\"%s and %s\", *ws.m_sibling_eviction_failure_string, *err_string));\n+        }\n         return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY,\n                              \"too many potential replacements\", *err_string);\n     }\n     // Enforce Rule #2.\n     if (const auto err_string{HasNoNewUnconfirmed(tx, m_pool, ws.m_iters_conflicting)}) {\n+        if (ws.m_sibling_eviction_failure_string.has_value()) {\n+            return state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"v3-violation and cannot bypass because replacement-adds-unconfirmed\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447437",
      "id" : 1494447437,
      "in_reply_to_id" : 1466538340,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZE3VN",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 1046,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1888255120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T12:04:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447595"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "8ee900fba998a3edac0da4f4632bb2a3f06cc7b1",
      "created_at" : "2024-02-19T12:04:21Z",
      "diff_hunk" : "@@ -180,6 +180,21 @@ std::optional<std::pair<std::string, CTransactionRef>> ApplyV3Rules(const CTrans\n                 std::any_of(children.cbegin(), children.cend(),\n                     [&direct_conflicts](const CTxMemPoolEntry& child){return direct_conflicts.count(child.GetTx().GetHash()) > 0;});\n             if (parent_entry->GetCountWithDescendants() + 1 > V3_DESCENDANT_LIMIT && !child_will_be_replaced) {\n+                // Allow sibling eviction for v3 transaction: if another child already exists, even if\n+                // we don't conflict with it, consider evicting it under RBF rules. We rely on v3 rules",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447595",
      "id" : 1494447595,
      "in_reply_to_id" : 1466473683,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZE3Xr",
      "original_commit_id" : "58ebc34b930abaf4911c012e94eaa6ba0c5ee01c",
      "original_line" : 184,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1888255374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T12:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "8ee900fba998a3edac0da4f4632bb2a3f06cc7b1",
      "created_at" : "2024-02-19T12:04:25Z",
      "diff_hunk" : "@@ -55,11 +55,11 @@ static_assert(V3_CHILD_MAX_VSIZE + MAX_STANDARD_TX_WEIGHT / WITNESS_SCALE_FACTOR\n  * @param[in]   vsize                   The sigop-adjusted virtual size of ptx.\n  * @returns an error string if any v3 rule was violated, otherwise std::nullopt.\n  */\n-std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n-                                        const CTxMemPool::setEntries& mempool_ancestors,\n-                                        unsigned int num_in_pkg_ancestors,\n-                                        const std::set<Txid>& direct_conflicts,\n-                                        int64_t vsize);\n+std::optional<std::pair<std::string, CTransactionRef>> ApplyV3Rules(const CTransactionRef& ptx,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29306#discussion_r1494447749",
      "id" : 1494447749,
      "in_reply_to_id" : 1466484490,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZE3aF",
      "original_commit_id" : "a28681ed1c4291d0d9cc53f0faae07815d588449",
      "original_line" : 58,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.h",
      "position" : null,
      "pull_request_review_id" : 1888255580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29306",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447749/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T12:04:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494447749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
