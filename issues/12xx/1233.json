{
   "assignee" : null,
   "body" : "This is based on cblockstore and commits blocks in a separate thread from downloading/initial checking (in CheckBlock).  It offers a nice performance gain over cblockstore alone.\r\n\r\n* pfrom->Misbehaving is now called in a callback instead of after EmitBlock as nDoS is not known until the block is committed.  This could give us a bit more work to do from a bad node's blocks, but should be pretty safe as the buffer is limited to 20 blocks by default (-blockbuffersize).\r\n\r\n* A setBlocksSeen is added which holds a set of blocks which have passed basic DOS checks (CheckBlock and the minwork computations), ie is the list of orphans + accepted blocks.  This allows us to avoid cs_main locking when doing the duplicate detection in the initial checking\r\n\r\n* FinishEmitBlock callbacks are done in series and, therefore, CBlockStore had to be changed to allow for InOrder callback threads.  Though FinishEmitBlock callbacks could be called out of order, this would result in a significant number of \"orphan\" blocks being committed before being merged into the main block tree, which is pretty ugly and inefficiency.  \r\n\r\n* GetLastCheckpoint now returns a cached value instead of scanning mapBlockIndex each time.  This is primarily to avoid a cs_main lock in the initial checking, but is also a micro-optimization.  ",
   "closed_at" : "2012-07-05T20:15:42Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
      "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
      "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/TheBlueMatt",
      "id" : 649246,
      "login" : "TheBlueMatt",
      "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
      "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
      "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/TheBlueMatt"
   },
   "comments" : 10,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1233/comments",
   "created_at" : "2012-05-09T06:28:29Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1233/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/1233",
   "id" : 4487227,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1233/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 1233,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/1233.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/1233",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/1233.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/1233"
   },
   "state" : "closed",
   "title" : "Buffer block downloading and commit/check blocks in parallel",
   "updated_at" : "2012-07-05T20:15:44Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1233",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
      "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
      "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/TheBlueMatt",
      "id" : 649246,
      "login" : "TheBlueMatt",
      "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
      "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
      "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/TheBlueMatt"
   }
}
