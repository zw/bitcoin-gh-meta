[
   {
      "body" : "Concept ACK, though might it be better to just introduce a new, trivial, P2P message for this purpose instead of overloading filterclear?",
      "created_at" : "2016-09-14T09:30:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-246957287",
      "id" : 246957287,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-14T09:30:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246957287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Maybe I'm missing something, but how is that accomplished by just this PR?  How are you starting blocksonly?\r\nIt seems reasonable to me that if you're not setting NODE_BLOOM that other nodes should respect that and not send you filter messages of any kind.\r\n \r\nI think avoiding txs during catch up could be already accomplished using the feefilter message or as @gmaxwell points out by a new mechanism specifically for that purpose if that was an optimization we really needed.  I believe it mostly only saves inv traffic though as we don't request txs if we're in IBD.\r\n",
      "created_at" : "2016-09-14T11:39:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-246986270",
      "id" : 246986270,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-14T11:39:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246986270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos This is a necessary first step prior to being able to code that - if the code mentioned was to be added to the network now without this pull merged and running on the network then the current behaviour would be to ban the nodes that start blocksonly and later request the TXs.  Am I making sense?\r\n\r\nYes, you are correct in that we are talking about savnig the bandwidth from inv messages. Feefilter is a nice idea but it would only be understood by the very latest versions of Bitcoin Core whereas filterclear is understood by most versions in the field - we just need to be careful not to send them to nodes not offering BLOOM whose protocol versions are between 70011 up to the protocol version where filterclear stops being banned - which leads me to think, should protocol version be raised as part of the pull request?\r\n\r\n@gmaxwell filterclear has always done exactly what is required, i.e. sets RelayTXs to true. I'm not sure what other functionality you are thinking about that would need a new message.",
      "created_at" : "2016-09-14T19:43:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-247130810",
      "id" : 247130810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-14T19:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247130810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Its kind of a shame that we didnt catch this at the time of the BIP, but this isnt really sufficient to use as a feature, now that there are nodes which will disconnect/ban you for sending a filterclear. A new P2P message would certainly require a new BIP and some kind of version bump/signaling capability before we could use this. Alternatively, we could update the BIP and assume no one uses -nodebloom (or its a small enough set that we'd be OK to use filterclear in the future).",
      "created_at" : "2016-09-14T21:07:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-247153908",
      "id" : 247153908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-14T21:07:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247153908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt This pull is safe but the pull that uses filterclear will need to be careful due to the ban-happy nodes you mention. As far as I know only bitcoin core nodes currently do this, and they are easy to spot as they have protocol version 70011 to 70014 and don't advertise BLOOM services. These nodes are a small minority (since BLOOM is by default on), so it might be so few as to not need to worry about them. The sooner this pull is merged the less the impact will be of the ban-happiness. The only question remaining for me is do I need to modify this pull to increase the protocol version; if it's not raised, people/nodes won't be sure whether nodes running protocol 70014 without BLOOM will ban upon receipt of a filterclear message; but as these are such a small minority, I think raising the protocol version isn't that necessary.\r\n\r\nWhat is involved in updating the BIP?",
      "created_at" : "2016-09-15T06:33:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-247247189",
      "id" : 247247189,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-15T06:40:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247247189",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Sure, but ban-happy nodes won't be identifiable unless we also bump the protocol version with this pull (which i don't think we should do), so it may be useless without thinking about it further.\nMy preference would be to just do this and update the BIP to note that you should not ban on filterclear, while pointing out that, due to a previous version of the BIP, some nodes may do this. We would then have to analyze the network to find out how many 0.13 nodes set the non-default option to disable NODE_BLOOM before we could seriously consider using filterclear for IBD blocks only mode, though since that is a minor optimization, it could easily wait six months or more.\n\nOn September 15, 2016 2:33:08 AM EDT, R E Broadley <notifications@github.com> wrote:\n>@TheBlueMatt This pull is safe but the pull that uses filterclear will\n>need to be careful due to the ban-happy nodes you mention. As far as I\n>know only bitcoin core nodes currently do this, and they are easy to\n>spot as they have protocol version 70011 to 70014 and don't advertise\n>BLOOM services. These nodes are a small minority, so it might be so few\n>as to not need to worry about them.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-247247189\n",
      "created_at" : "2016-09-15T12:47:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-247318299",
      "id" : 247318299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-15T12:47:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247318299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I misunderstood how filterclear and fRelayTxes interact, and now I think this change makes sense.\r\n\r\nutACK\r\n\r\n",
      "created_at" : "2016-09-15T13:07:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-247322810",
      "id" : 247322810,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-15T13:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247322810",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@rebroad you can achieve the effect you desire by simply reconnecting after IBD",
      "created_at" : "2016-09-20T04:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-248200651",
      "id" : 248200651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-20T04:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/248200651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "@pstratem Sorry, I don't understand what you mean - what effect are you referring to? Without this patch, my node was banning my SPV wallet. I do agree that to address the overloading of whitelist that I need to change this to require an additional command line option. Perhaps -bloomwhite ?",
      "created_at" : "2016-09-20T07:12:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8709#issuecomment-248221772",
      "id" : 248221772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8709",
      "updated_at" : "2016-09-20T07:12:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/248221772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
