[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24571](https://github.com/bitcoin/bitcoin/pull/24571) (p2p: Prevent block index fingerprinting by sending additional getheaders messages by dergoegge)\n* [#24513](https://github.com/bitcoin/bitcoin/pull/24513) (CChainState -> Chainstate by jamesob)\n* [#24232](https://github.com/bitcoin/bitcoin/pull/24232) (assumeutxo: add init and completion logic by jamesob)\n* [#24178](https://github.com/bitcoin/bitcoin/pull/24178) (p2p: Respond to getheaders if we have sufficient chainwork by sdaftuar)\n* [#24171](https://github.com/bitcoin/bitcoin/pull/24171) (p2p: Sync chain more readily from inbound peers during IBD by sdaftuar)\n* [#19888](https://github.com/bitcoin/bitcoin/pull/19888) (rpc, test: Improve getblockstats for unspendables by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-01-07T20:25:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1007716637",
      "id" : 1007716637,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII5848EIkd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007716637/reactions"
      },
      "updated_at" : "2022-05-25T10:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1007716637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Queuing this one up for review soon.",
      "created_at" : "2022-01-31T21:08:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1026211300",
      "id" : 1026211300,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII5849Kr3k",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1026211300/reactions"
      },
      "updated_at" : "2022-01-31T21:08:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1026211300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797103646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797103646"
         }
      },
      "author_association" : "MEMBER",
      "body" : "17906dd5\r\n```suggestion\r\n    // Returns nullptr if no snapshot has been loaded.\r\n```",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-01T22:38:20Z",
      "diff_hunk" : "@@ -822,6 +822,10 @@ class ChainstateManager\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     friend CChainState;\n \n+    // Returns nullptr if no snapshot ahs been loaded.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797103646",
      "id" : 797103646,
      "line" : 825,
      "node_id" : "PRRC_kwDOABII584vgtYe",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 825,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 4,
      "pull_request_review_id" : 869907044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797103646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797103646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797105983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797105983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "17906dd5 suggestions\r\n\r\n- add `AssertLockHeld(::cs_main);`\r\n- use PascalCase for the function name in new code\r\n- use const with braced initialization\r\n\r\n<details><summary>suggested diff</summary><p>\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex d81ee4fa03..5c9bf34aad 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -5091,16 +5091,18 @@ void ChainstateManager::MaybeRebalanceCaches()\r\n     }\r\n }\r\n \r\n-CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\r\n+CBlockIndex* ChainstateManager::GetSnapshotBaseBlock()\r\n {\r\n+    AssertLockHeld(::cs_main);\r\n-    auto blockhash_op = SnapshotBlockhash();\r\n+    const auto blockhash_op{SnapshotBlockhash()};\r\n     if (!blockhash_op) return nullptr;\r\n     return m_blockman.LookupBlockIndex(*blockhash_op);\r\n }\r\n \r\n-std::optional<int> ChainstateManager::getSnapshotHeight()\r\n+std::optional<int> ChainstateManager::GetSnapshotHeight()\r\n {\r\n+    AssertLockHeld(::cs_main);\r\n-    CBlockIndex* base = getSnapshotBaseBlock();\r\n+    const CBlockIndex* base{GetSnapshotBaseBlock()};\r\n     return base ? std::make_optional(base->nHeight) : std::nullopt;\r\n }\r\n \r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex ddeddbcecc..5bc249c27c 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -842,8 +842,8 @@ private:\r\n     friend CChainState;\r\n \r\n     // Returns nullptr if no snapshot ahs been loaded.\r\n-    CBlockIndex* getSnapshotBaseBlock() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n-    std::optional<int> getSnapshotHeight() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n+    CBlockIndex* GetSnapshotBaseBlock() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n+    std::optional<int> GetSnapshotHeight() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n \r\n public:\r\n     std::thread m_load_block;\r\n```\r\n</p></details>\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-01T22:40:59Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797105983",
      "id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584vgt8_",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 869907044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797105983/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T23:18:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797105983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797166061"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797166061"
         }
      },
      "author_association" : "MEMBER",
      "body" : "75912c5 suggestions\r\n\r\n- add missing `AssertLockHeld(::cs_main);`\r\n- place comment outside of conditional\r\n- const with braced init\r\n\r\n<details><summary>suggested diff</summary><p>\r\n\r\n```diff\r\n\r\n CChainState& ChainstateManager::GetChainstateForNewBlock(const uint256& blockhash)\r\n {\r\n+    AssertLockHeld(::cs_main);\r\n-    auto* pblock = m_blockman.LookupBlockIndex(blockhash);\r\n+    const auto* pblock{m_blockman.LookupBlockIndex(blockhash)};\r\n     if (m_snapshot_chainstate &&\r\n-            // If pblock is null, we haven't seen the header for this block.\r\n-            // Because we expect to have received the headers for the IBD chain\r\n-            // contents before receiving blocks, this means that any block for\r\n-            // which we don't have headers should go in the snapshot chain.\r\n-            (pblock == nullptr || !m_snapshot_chainstate->m_chain.Contains(pblock))) {\r\n+        (pblock == nullptr || !m_snapshot_chainstate->m_chain.Contains(pblock))) {\r\n+        // If pblock is null, we haven't seen the header for this block.\r\n+        // Because we expect to have received the headers for the IBD chain\r\n+        // contents before receiving blocks, this means that any block for\r\n+        // which we don't have headers should go in the snapshot chain.\r\n         return *m_snapshot_chainstate.get();\r\n```\r\n</p></details>\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-02T00:00:32Z",
      "diff_hunk" : "@@ -4921,6 +4951,21 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+CChainState& ChainstateManager::GetChainstateForNewBlock(const uint256& blockhash)\n+{\n+    auto* pblock = m_blockman.LookupBlockIndex(blockhash);\n+    if (m_snapshot_chainstate &&\n+            // If pblock is null, we haven't seen the header for this block.\n+            // Because we expect to have received the headers for the IBD chain\n+            // contents before receiving blocks, this means that any block for\n+            // which we don't have headers should go in the snapshot chain.\n+            (pblock == nullptr || !m_snapshot_chainstate->m_chain.Contains(pblock))) {\n+        return *m_snapshot_chainstate.get();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797166061",
      "id" : 797166061,
      "line" : 4964,
      "node_id" : "PRRC_kwDOABII584vg8nt",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 4964,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 80,
      "pull_request_review_id" : 869907044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797166061/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T23:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797166061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797169841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797169841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "75912c552e43e0bb43e42349164d0aa279927013 suggestions\r\n- `::cs_main` preferred over `cs_main` to clarify it is a global\r\n-  `chainstate` can use braced init and an inlined `WITH_LOCK` macro\r\n\r\n<details><summary>diff</summary><p>\r\n\r\n```diff\r\n     AssertLockNotHeld(cs_main);\r\n-\r\n-    CChainState* chainstate;\r\n-    {\r\n-        LOCK(cs_main);\r\n-        chainstate = &this->GetChainstateForNewBlock(block->GetHash());\r\n-    }\r\n+    CChainState* chainstate{\r\n+        WITH_LOCK(::cs_main, return &this->GetChainstateForNewBlock(block->GetHash()))};\r\n```\r\n</p></details>\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-02T00:06:20Z",
      "diff_hunk" : "@@ -3603,6 +3603,12 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n {\n     AssertLockNotHeld(cs_main);\n \n+    CChainState* chainstate;\n+    {\n+        LOCK(cs_main);\n+        chainstate = &this->GetChainstateForNewBlock(block->GetHash());\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r797169841",
      "id" : 797169841,
      "line" : 3610,
      "node_id" : "PRRC_kwDOABII584vg9ix",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3610,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 8,
      "pull_request_review_id" : 869907044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797169841/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-02T23:11:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/797169841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801024687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801024687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "75912c552e43e0bb43e42349164d0aa279927013 is the lock needed for `chainstate`? `ChainstateManager::ActiveChainstate()` already locks `cs_main`\r\n\r\n```suggestion\r\n    if (chainstate == &this->ActiveChainstate()) {\r\n```",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T20:18:35Z",
      "diff_hunk" : "@@ -3620,18 +3626,21 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*block, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ActiveChainstate().AcceptBlock(block, state, &pindex, force_processing, nullptr, new_block);\n+            ret = chainstate->AcceptBlock(\n+                block, state, &pindex, force_processing, nullptr, new_block);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*block, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip(ActiveChainstate());\n+    if (WITH_LOCK(::cs_main, return chainstate == &this->ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801024687",
      "id" : 801024687,
      "line" : 3638,
      "node_id" : "PRRC_kwDOABII584vvqqv",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3638,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 28,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801024687/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801024687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801030242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801030242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8cafc54 thread safety run-time assertion needed here\r\n```diff\r\n std::vector<CChainState*> ChainstateManager::GetAllForBlockDownload()\r\n {\r\n+    AssertLockHeld(::cs_main);\r\n     std::vector<CChainState*> out;\r\n```\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T20:26:31Z",
      "diff_hunk" : "@@ -4596,6 +4605,27 @@ std::vector<CChainState*> ChainstateManager::GetAll()\n     return out;\n }\n \n+std::vector<CChainState*> ChainstateManager::GetAllForBlockDownload()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801030242",
      "id" : 801030242,
      "line" : 4609,
      "node_id" : "PRRC_kwDOABII584vvsBi",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 4609,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 43,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801030242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801030242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801031354"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801031354"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8cafc54 style nit\r\n```diff\r\n-    bool snapshot_in_ibd =\r\n-        m_snapshot_chainstate && m_snapshot_chainstate->IsInitialBlockDownload();\r\n+    const bool snapshot_in_ibd{\r\n+        m_snapshot_chainstate && m_snapshot_chainstate->IsInitialBlockDownload()};\r\n```\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T20:28:02Z",
      "diff_hunk" : "@@ -4596,6 +4605,27 @@ std::vector<CChainState*> ChainstateManager::GetAll()\n     return out;\n }\n \n+std::vector<CChainState*> ChainstateManager::GetAllForBlockDownload()\n+{\n+    std::vector<CChainState*> out;\n+\n+    bool snapshot_in_ibd =\n+        m_snapshot_chainstate && m_snapshot_chainstate->IsInitialBlockDownload();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801031354",
      "id" : 801031354,
      "line" : 4613,
      "node_id" : "PRRC_kwDOABII584vvsS6",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 4613,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 47,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801031354/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801031354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801056945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801056945"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0ef00576\r\n```diff\r\n-    /** Update pindexLastCommonBlock and add not-in-flight missing successors to vBlocks, until it has\r\n-     *  at most count entries.\r\n+    /** Update `chainstate_to_last_common_block` and add not-in-flight missing\r\n+     *  successors to `vBlocks`, until it has at most `count` entries.\r\n```\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:04:47Z",
      "diff_hunk" : "@@ -538,7 +538,12 @@ class PeerManagerImpl final : public PeerManager\n     /** Update pindexLastCommonBlock and add not-in-flight missing successors to vBlocks, until it has",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801056945",
      "id" : 801056945,
      "line" : 538,
      "node_id" : "PRRC_kwDOABII584vvyix",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 538,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 1,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801056945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801056945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801058811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801058811"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0ef00576 not sure, but maybe safer on first use in this function to raise instead of failing silently/UB\r\n```suggestion\r\n        state->chainstate_to_last_common_block.at(chainstate) = our_chain[\r\n```",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:07:34Z",
      "diff_hunk" : "@@ -1014,32 +1039,45 @@ void PeerManagerImpl::FindNextBlocksToDownload(NodeId nodeid, unsigned int count\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n-    if (state->pindexBestKnownBlock == nullptr || state->pindexBestKnownBlock->nChainWork < m_chainman.ActiveChain().Tip()->nChainWork || state->pindexBestKnownBlock->nChainWork < nMinimumChainWork) {\n+    const CChain& our_chain = chainstate->m_chain;\n+    const CBlockIndex* our_tip = our_chain.Tip();\n+\n+    if (state->pindexBestKnownBlock == nullptr\n+            || state->pindexBestKnownBlock->nChainWork < our_tip->nChainWork\n+            || state->pindexBestKnownBlock->nChainWork < nMinimumChainWork) {\n         // This peer has nothing interesting.\n         return;\n     }\n \n-    if (state->pindexLastCommonBlock == nullptr) {\n+    if (!state->chainstate_to_last_common_block.count(chainstate)) {\n         // Bootstrap quickly by guessing a parent of our best tip is the forking point.\n         // Guessing wrong in either direction is not a problem.\n-        state->pindexLastCommonBlock = m_chainman.ActiveChain()[std::min(state->pindexBestKnownBlock->nHeight, m_chainman.ActiveChain().Height())];\n+        //\n+        // Namespace this by chainstate so that we can simultaneously sync two\n+        // separate chainstates at different heights.\n+        state->chainstate_to_last_common_block[chainstate] = our_chain[",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801058811",
      "id" : 801058811,
      "line" : 1058,
      "node_id" : "PRRC_kwDOABII584vvy_7",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 1058,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 84,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801058811/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:43:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801058811",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801068809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801068809"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0ef00576cc9a4aac27310b9fc29c534ad829aad9 suggestions\r\n\r\n```diff\r\n-        // during IBD, but once it hits a tip capacity will trickle into subsequent\r\n-        // chainstates.\r\n-        int requests_available = MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight;\r\n+        // during IBD, but once it hits a tip, capacity will trickle into\r\n+        // subsequent chainstates.\r\n+        int requests_available{MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight};\r\n \r\n-        // Service the snapshot chainstate first - more important to get to the\r\n-        // network's tip quickly than do the background validation on the\r\n-        // snapshot.\r\n+        // GetAllForBlockDownload() services the snapshot chainstate first.\r\n+        // It is more important to get to the network's tip quickly than do the\r\n+        // background validation on the snapshot.\r\n```\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:22:16Z",
      "diff_hunk" : "@@ -4975,21 +5026,37 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n         // Message: getdata (blocks)\n         //\n         std::vector<CInv> vGetData;\n-        if (!pto->fClient && ((fFetch && !pto->m_limited_node) || !m_chainman.ActiveChainstate().IsInitialBlockDownload()) && state.nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n-            std::vector<const CBlockIndex*> vToDownload;\n-            NodeId staller = -1;\n-            FindNextBlocksToDownload(pto->GetId(), MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight, vToDownload, staller);\n-            for (const CBlockIndex *pindex : vToDownload) {\n-                uint32_t nFetchFlags = GetFetchFlags(*pto);\n-                vGetData.push_back(CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash()));\n-                BlockRequested(pto->GetId(), *pindex);\n-                LogPrint(BCLog::NET, \"Requesting block %s (%d) peer=%d\\n\", pindex->GetBlockHash().ToString(),\n-                    pindex->nHeight, pto->GetId());\n-            }\n-            if (state.nBlocksInFlight == 0 && staller != -1) {\n-                if (State(staller)->m_stalling_since == 0us) {\n-                    State(staller)->m_stalling_since = current_time;\n-                    LogPrint(BCLog::NET, \"Stall started peer=%d\\n\", staller);\n+\n+        // The first chainstate in line for processing will likely exhaust this\n+        // during IBD, but once it hits a tip capacity will trickle into subsequent\n+        // chainstates.\n+        int requests_available = MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight;\n+\n+        // Service the snapshot chainstate first - more important to get to the\n+        // network's tip quickly than do the background validation on the\n+        // snapshot.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801068809",
      "id" : 801068809,
      "line" : 5037,
      "node_id" : "PRRC_kwDOABII584vv1cJ",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5037,
      "original_position" : 238,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 238,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801068809/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801068809",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801072282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801072282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c4d90167 see #24178 that changes this logic",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:27:14Z",
      "diff_hunk" : "@@ -3184,7 +3234,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         LOCK(cs_main);\n-        if (m_chainman.ActiveChainstate().IsInitialBlockDownload() && !pfrom.HasPermission(NetPermissionFlags::Download)) {\n+        if (m_chainman.IsAnyChainInIBD() && !pfrom.HasPermission(NetPermissionFlags::Download)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801072282",
      "id" : 801072282,
      "line" : 3237,
      "node_id" : "PRRC_kwDOABII584vv2Sa",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3237,
      "original_position" : 194,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 194,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801072282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801072282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801075886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801075886"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c4d90167 can simplify here\r\n```diff\r\n-            bool is_ibd;\r\n-            WITH_LOCK(::cs_main, is_ibd = m_chainman.IsAnyChainInIBD());\r\n+            const bool is_ibd{WITH_LOCK(::cs_main, return m_chainman.IsAnyChainInIBD())};\r\n```\r\n",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:32:14Z",
      "diff_hunk" : "@@ -2660,6 +2707,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         // Self advertisement & GETADDR logic\n         if (!pfrom.IsInboundConn() && SetupAddressRelay(pfrom, *peer)) {\n+            bool is_ibd;\n+            WITH_LOCK(::cs_main, is_ibd = m_chainman.IsAnyChainInIBD());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801075886",
      "id" : 801075886,
      "line" : 2711,
      "node_id" : "PRRC_kwDOABII584vv3Ku",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 2711,
      "original_position" : 175,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 175,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801075886/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801075886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801077582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801077582"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c4d90167f030547373715a44fc020d0da8461565\r\n```suggestion\r\n    const bool is_ibd{WITH_LOCK(::cs_main, return m_chainman.IsAnyChainInIBD())};\r\n```",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:34:48Z",
      "diff_hunk" : "@@ -4412,9 +4462,10 @@ void PeerManagerImpl::MaybeSendAddr(CNode& node, Peer& peer, std::chrono::micros\n     if (!peer.m_addr_relay_enabled) return;\n \n     LOCK(peer.m_addr_send_times_mutex);\n+    bool is_ibd = WITH_LOCK(::cs_main, return m_chainman.IsAnyChainInIBD());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801077582",
      "id" : 801077582,
      "line" : 4465,
      "node_id" : "PRRC_kwDOABII584vv3lO",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 4465,
      "original_position" : 202,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 202,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801077582/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801077582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801081962"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801081962"
         }
      },
      "author_association" : "MEMBER",
      "body" : "0ef00576cc9a4aac27310b9fc29c534ad829aad9 \r\n\r\n```diff\r\n CChainState& ChainstateManager::getChainstateForIndexing()\r\n {\r\n+    AssertLockHeld(::cs_main);\r\n     return getSnapshotBaseBlock() ? *m_ibd_chainstate : *m_active_chainstate;\r\n }\r\n \r\n@@ -5117,6 +5119,7 @@ bool ChainstateManager::hasBgChainstateInUse()\r\n \r\n bool ChainstateManager::IsAnyChainInIBD()\r\n {\r\n+    AssertLockHeld(::cs_main);\r\n     return\r\n```\r\n\r\nNaming style: PascalCase for `getChainstateForIndexing()` and `getSnapshotHeight()`?",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-07T21:41:24Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{\n+    auto blockhash_op = SnapshotBlockhash();\n+    if (!blockhash_op) return nullptr;\n+    return m_blockman.LookupBlockIndex(*blockhash_op);\n+}\n+\n+std::optional<int> ChainstateManager::getSnapshotHeight()\n+{\n+    CBlockIndex* base = getSnapshotBaseBlock();\n+    return base ? std::make_optional(base->nHeight) : std::nullopt;\n+}\n+\n+CChainState& ChainstateManager::getChainstateForIndexing()\n+{\n+    return getSnapshotBaseBlock() ? *m_ibd_chainstate : *m_active_chainstate;\n+}\n+\n+bool ChainstateManager::hasBgChainstateInUse()\n+{\n+    return this->SnapshotBlockhash() && !m_snapshot_validated;\n+}\n+\n+bool ChainstateManager::IsAnyChainInIBD()\n+{\n+    return",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r801081962",
      "id" : 801081962,
      "line" : 5058,
      "node_id" : "PRRC_kwDOABII584vv4pq",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5058,
      "original_position" : 118,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 118,
      "pull_request_review_id" : 875201275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801081962/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-07T21:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801081962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r805085789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805085789"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> use PascalCase for the function name in new code\r\n\r\n@ryanofsky has pioneered using `thisCovention` for method names (in order to distinguish methods from functions without using `this`) and so I've been using that here.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-02-12T00:29:28Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r805085789",
      "id" : 805085789,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584v_KJd",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 880788546,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805085789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-02-12T00:29:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805085789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r824590539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824590539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: it takes some effort to see it can't overflow, but perhaps we should make it uint and make according changes?",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-03-11T10:36:33Z",
      "diff_hunk" : "@@ -4980,21 +5022,37 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n         // Message: getdata (blocks)\n         //\n         std::vector<CInv> vGetData;\n-        if (!pto->fClient && ((fFetch && !pto->m_limited_node) || !m_chainman.ActiveChainstate().IsInitialBlockDownload()) && state.nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n-            std::vector<const CBlockIndex*> vToDownload;\n-            NodeId staller = -1;\n-            FindNextBlocksToDownload(pto->GetId(), MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight, vToDownload, staller);\n-            for (const CBlockIndex *pindex : vToDownload) {\n-                uint32_t nFetchFlags = GetFetchFlags(*pto);\n-                vGetData.push_back(CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash()));\n-                BlockRequested(pto->GetId(), *pindex);\n-                LogPrint(BCLog::NET, \"Requesting block %s (%d) peer=%d\\n\", pindex->GetBlockHash().ToString(),\n-                    pindex->nHeight, pto->GetId());\n-            }\n-            if (state.nBlocksInFlight == 0 && staller != -1) {\n-                if (State(staller)->m_stalling_since == 0us) {\n-                    State(staller)->m_stalling_since = current_time;\n-                    LogPrint(BCLog::NET, \"Stall started peer=%d\\n\", staller);\n+\n+        // The first chainstate in line for processing will likely exhaust this\n+        // during IBD, but once it hits a tip capacity will trickle into subsequent\n+        // chainstates.\n+        int requests_available = MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r824590539",
      "id" : 824590539,
      "line" : 5033,
      "node_id" : "PRRC_kwDOABII584xJkDL",
      "original_commit_id" : "0ef00576cc9a4aac27310b9fc29c534ad829aad9",
      "original_line" : 5029,
      "original_position" : 181,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 181,
      "pull_request_review_id" : 907044195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824590539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-11T10:36:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/824590539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK modulo nits by me and jonatack",
      "created_at" : "2022-03-11T10:41:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1064991171",
      "id" : 1064991171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII584_ennD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064991171/reactions"
      },
      "updated_at" : "2022-03-11T10:41:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1064991171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831501460"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831501460"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"add ChainstateManager.getSnapshot{Height,BaseBlock}()\" (17906dd52543fb75d2c45de884799b35ec5721f4)\r\n\r\nCan methods be const?",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-03-21T20:09:30Z",
      "diff_hunk" : "@@ -822,6 +822,10 @@ class ChainstateManager\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     friend CChainState;\n \n+    // Returns nullptr if no snapshot ahs been loaded.\n+    CBlockIndex* getSnapshotBaseBlock() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    std::optional<int> getSnapshotHeight() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831501460",
      "id" : 831501460,
      "line" : 827,
      "node_id" : "PRRC_kwDOABII584xj7SU",
      "original_commit_id" : "17906dd52543fb75d2c45de884799b35ec5721f4",
      "original_line" : 827,
      "original_position" : 6,
      "original_start_line" : 826,
      "path" : "src/validation.h",
      "position" : 6,
      "pull_request_review_id" : 916299921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831501460/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 826,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-21T21:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831501460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831511847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831511847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"validation: introduce ChainstateManager::GetChainstateForNewBlock\" (75912c552e43e0bb43e42349164d0aa279927013)\r\n\r\nNote: In my own words I'd describe the logic as: Always prefer to add blocks to the newer snapshot chainstate, not the older background chainstate, but add blocks to the background chainstate if they're already in in the snapshot chainstate.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-03-21T20:23:43Z",
      "diff_hunk" : "@@ -4921,6 +4930,21 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+CChainState& ChainstateManager::GetChainstateForNewBlock(const uint256& blockhash)\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831511847",
      "id" : 831511847,
      "line" : 4955,
      "node_id" : "PRRC_kwDOABII584xj90n",
      "original_commit_id" : "75912c552e43e0bb43e42349164d0aa279927013",
      "original_line" : 4934,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 43,
      "pull_request_review_id" : 916299921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831511847/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-21T21:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831511847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831533853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831533853"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"p2p: don't advertise until we finish all IBDs\" (c4d90167f030547373715a44fc020d0da8461565)\r\n\r\nMaybe wait to add these until they are actually used and tested",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-03-21T20:53:48Z",
      "diff_hunk" : "@@ -987,6 +987,23 @@ class ChainstateManager\n     //! ResizeCoinsCaches() as needed.\n     void MaybeRebalanceCaches() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Returns true if any chainstate in use is in initial block download.\n+    bool IsAnyChainInIBD() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n+    //! @returns the chainstate that indexers should consult when ensuring that an\n+    //!   index is synced with a chain where we can expect block index entries to have\n+    //!   BLOCK_HAVE_DATA beneath the tip.\n+    //!\n+    //!   In other words, give us the chainstate for which we can reasonably expect\n+    //!   that all blocks beneath the tip have been indexed. In practice this means\n+    //!   when using an assumed-valid chainstate based upon a snapshot, return only the\n+    //!   fully validated chain.\n+    CChainState& getChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n+    //! @returns true if we have more than one chainstate in use. This means that a\n+    //! background validation chainstate is running.\n+    bool hasBgChainstateInUse();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831533853",
      "id" : 831533853,
      "line" : 1005,
      "node_id" : "PRRC_kwDOABII584xkDMd",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 1005,
      "original_position" : 19,
      "original_start_line" : 993,
      "path" : "src/validation.h",
      "position" : 19,
      "pull_request_review_id" : 916299921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831533853/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 993,
      "start_side" : "RIGHT",
      "updated_at" : "2022-03-21T21:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831533853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831542382"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831542382"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"p2p: don't advertise until we finish all IBDs\" (c4d90167f030547373715a44fc020d0da8461565)\r\n\r\nThere are a few other `ActiveChainstate().IsInitialBlockDownload()` calls in this file that aren't replaced by `m_chainman.IsAnyChainInIBD()` calls. Will these need to be changed later to avoid changing network behavior when an assumeutxo snapshot is loaded? If not, maybe it is worth going through the calls in this PR and adding comments that could shed more light on why message processing is affected by IBD status, or why it only depends on active IBD status not full IBD status.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-03-21T21:05:33Z",
      "diff_hunk" : "@@ -3231,7 +3234,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         LOCK(cs_main);\n-        if (m_chainman.ActiveChainstate().IsInitialBlockDownload() && !pfrom.HasPermission(NetPermissionFlags::Download)) {\n+        if (m_chainman.IsAnyChainInIBD() && !pfrom.HasPermission(NetPermissionFlags::Download)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r831542382",
      "id" : 831542382,
      "line" : 3237,
      "node_id" : "PRRC_kwDOABII584xkFRu",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3237,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 24,
      "pull_request_review_id" : 916299921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831542382/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-03-21T21:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/831542382",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r847983627"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/847983627"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There isn't a function with the name `GetSnapshotHeight` or `GetSnapshotBaseBlock` -- why would you need to distinguish the method from a function that doesn't exist? I really dislike the \"let's randomly introduce new and different code style conventions\" approach, especially when combined with \"let's patch the entire codebase to update to the latest style conventions\".\r\n\r\nThe developers-notes say \"Class names, function names, and method names are UpperCamelCase\r\n(PascalCase). Do not prefix class names with `C`.\"",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T05:29:10Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r847983627",
      "id" : 847983627,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yizQL",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 938917428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/847983627/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T05:29:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/847983627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848008098"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848008098"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> There isn't a function with the name `GetSnapshotHeight` or `GetSnapshotBaseBlock` -- why would you need to distinguish the method from a function that doesn't exist?\r\n\r\nThe reason I like calling non-static member variables `m_var` instead of `var` is not to distinguish them from other variables called `var`, but to make it obvious that they are members, and make code easier to read and understand. Similarly the reason I like calling non-static member functions `fun()` instead of `Fun()` is not to distinguish from other functions call `Fun()`, but to make it obvious that they are members, so code is clearer and easier to understand. It is nice to know, when you are calling a function, if that function will have access to `*this`.\r\n\r\nI just wanted to respond to your question though, not defend or debate anything. This could easily be a garbage coding convention and I am stupid for liking it.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T06:10:42Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848008098",
      "id" : 848008098,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yi5Oi",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 938949931,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848008098/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T06:10:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848008098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848018690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848018690"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's a completely fine convention, it's just not the one this codebase has adopted. And if we keep changing conventions we'll never get the benefit of any of them.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T06:27:41Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848018690",
      "id" : 848018690,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yi70C",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 938966769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848018690/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T06:27:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848018690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848490431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848490431"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> it's just not the one this codebase has adopted\r\n\r\n@ajtowns I encourage you to take a look at the entire `src/interfaces` and `src/node` subtrees. Pretty much all of the multiprocess code (and increasingly some validation code) has been using this convention for years.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T14:14:58Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848490431",
      "id" : 848490431,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yku-_",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 939626155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848490431/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T14:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848490431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848515694"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848515694"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If there's agreement on this style, it would be helpful and save developer time to update the developer notes.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T14:36:53Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848515694",
      "id" : 848515694,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yk1Ju",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 939662822,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848515694/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T14:36:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848515694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848582465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848582465"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@jonatack agree, but previous attempts have been rejected and locked (?): https://github.com/bitcoin/bitcoin/pull/14635#issuecomment-492796314",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T15:36:08Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848582465",
      "id" : 848582465,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584ylFdB",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 939758507,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848582465/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T15:36:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848582465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848695416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848695416"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I look through the existing codebase, and model my new code on that rather than the developer notes, I'll be using hungarian notation, just as satoshi intended. Suggesting an alternative convention is fine, but if it gets rejected, you don't just keep on using it anyway.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-12T17:38:21Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r848695416",
      "id" : 848695416,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584ylhB4",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 939919431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848695416/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-12T17:38:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/848695416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r852237486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852237486"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For the sake of progress here it seems like it would be better to change these methods back to the Uppercase for now and keep that discussion seperate in #24846.",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-18T16:26:32Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r852237486",
      "id" : 852237486,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yzByu",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 944575785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852237486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-18T17:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852237486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r852240540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852240540"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Did you consider making the interface of the two methods consistent and `getSnapshotBaseBlock` return an optional as well?",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-18T16:31:19Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r852240540",
      "id" : 852240540,
      "in_reply_to_id" : 797105983,
      "line" : 5034,
      "node_id" : "PRRC_kwDOABII584yzCic",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5034,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 94,
      "pull_request_review_id" : 944575785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852240540/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-18T17:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852240540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r852263118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852263118"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "+1",
      "commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "created_at" : "2022-04-18T17:06:42Z",
      "diff_hunk" : "@@ -987,6 +987,23 @@ class ChainstateManager\n     //! ResizeCoinsCaches() as needed.\n     void MaybeRebalanceCaches() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Returns true if any chainstate in use is in initial block download.\n+    bool IsAnyChainInIBD() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n+    //! @returns the chainstate that indexers should consult when ensuring that an\n+    //!   index is synced with a chain where we can expect block index entries to have\n+    //!   BLOCK_HAVE_DATA beneath the tip.\n+    //!\n+    //!   In other words, give us the chainstate for which we can reasonably expect\n+    //!   that all blocks beneath the tip have been indexed. In practice this means\n+    //!   when using an assumed-valid chainstate based upon a snapshot, return only the\n+    //!   fully validated chain.\n+    CChainState& getChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n+    //! @returns true if we have more than one chainstate in use. This means that a\n+    //! background validation chainstate is running.\n+    bool hasBgChainstateInUse();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r852263118",
      "id" : 852263118,
      "in_reply_to_id" : 831533853,
      "line" : 1005,
      "node_id" : "PRRC_kwDOABII584yzIDO",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 1005,
      "original_position" : 19,
      "original_start_line" : 993,
      "path" : "src/validation.h",
      "position" : 19,
      "pull_request_review_id" : 944575785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852263118/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 993,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-18T17:18:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/852263118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-28T10:53:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1112062268",
      "id" : 1112062268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII585CSLk8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112062268/reactions"
      },
      "updated_at" : "2022-04-28T10:53:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112062268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for all the feedback so far; I'll get around to fixing this up in the next day or so after I get #24232 in order.",
      "created_at" : "2022-04-28T11:53:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1112111998",
      "id" : 1112111998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII585CSXt-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112111998/reactions"
      },
      "updated_at" : "2022-04-28T11:53:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112111998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862185596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862185596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point; I've added some commentary to the other uses of IsInitialBlockDownload().",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:42:27Z",
      "diff_hunk" : "@@ -3231,7 +3234,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         LOCK(cs_main);\n-        if (m_chainman.ActiveChainstate().IsInitialBlockDownload() && !pfrom.HasPermission(NetPermissionFlags::Download)) {\n+        if (m_chainman.IsAnyChainInIBD() && !pfrom.HasPermission(NetPermissionFlags::Download)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862185596",
      "id" : 862185596,
      "in_reply_to_id" : 831542382,
      "line" : 3331,
      "node_id" : "PRRC_kwDOABII584zY-h8",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3331,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 230,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862185596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862185596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862188708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862188708"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:48:28Z",
      "diff_hunk" : "@@ -822,6 +822,10 @@ class ChainstateManager\n         CBlockIndex** ppindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n     friend CChainState;\n \n+    // Returns nullptr if no snapshot ahs been loaded.\n+    CBlockIndex* getSnapshotBaseBlock() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    std::optional<int> getSnapshotHeight() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862188708",
      "id" : 862188708,
      "in_reply_to_id" : 831501460,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zY_Sk",
      "original_commit_id" : "17906dd52543fb75d2c45de884799b35ec5721f4",
      "original_line" : 827,
      "original_position" : 6,
      "original_start_line" : 826,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862188708/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862188708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862191203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862191203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Relented on all counts here.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:51:31Z",
      "diff_hunk" : "@@ -4984,3 +5029,33 @@ void ChainstateManager::MaybeRebalanceCaches()\n         }\n     }\n }\n+\n+CBlockIndex* ChainstateManager::getSnapshotBaseBlock()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862191203",
      "id" : 862191203,
      "in_reply_to_id" : 797105983,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zY_5j",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5254,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862191203/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862191203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862191338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862191338"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:51:45Z",
      "diff_hunk" : "@@ -3603,6 +3603,12 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n {\n     AssertLockNotHeld(cs_main);\n \n+    CChainState* chainstate;\n+    {\n+        LOCK(cs_main);\n+        chainstate = &this->GetChainstateForNewBlock(block->GetHash());\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862191338",
      "id" : 862191338,
      "in_reply_to_id" : 797169841,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zY_7q",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3610,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862191338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862191338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862193503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862193503"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:55:13Z",
      "diff_hunk" : "@@ -4921,6 +4951,21 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     return true;\n }\n \n+CChainState& ChainstateManager::GetChainstateForNewBlock(const uint256& blockhash)\n+{\n+    auto* pblock = m_blockman.LookupBlockIndex(blockhash);\n+    if (m_snapshot_chainstate &&\n+            // If pblock is null, we haven't seen the header for this block.\n+            // Because we expect to have received the headers for the IBD chain\n+            // contents before receiving blocks, this means that any block for\n+            // which we don't have headers should go in the snapshot chain.\n+            (pblock == nullptr || !m_snapshot_chainstate->m_chain.Contains(pblock))) {\n+        return *m_snapshot_chainstate.get();\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862193503",
      "id" : 862193503,
      "in_reply_to_id" : 797166061,
      "line" : 5204,
      "node_id" : "PRRC_kwDOABII584zZAdf",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 5204,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 78,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862193503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862193503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862193784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862193784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:55:35Z",
      "diff_hunk" : "@@ -3620,18 +3626,21 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\n         bool ret = CheckBlock(*block, state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ActiveChainstate().AcceptBlock(block, state, &pindex, force_processing, nullptr, new_block);\n+            ret = chainstate->AcceptBlock(\n+                block, state, &pindex, force_processing, nullptr, new_block);\n         }\n         if (!ret) {\n             GetMainSignals().BlockChecked(*block, state);\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n         }\n     }\n \n-    NotifyHeaderTip(ActiveChainstate());\n+    if (WITH_LOCK(::cs_main, return chainstate == &this->ActiveChainstate())) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862193784",
      "id" : 862193784,
      "in_reply_to_id" : 801024687,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zZAh4",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 3638,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862193784/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862193784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862195583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862195583"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:58:10Z",
      "diff_hunk" : "@@ -4596,6 +4605,27 @@ std::vector<CChainState*> ChainstateManager::GetAll()\n     return out;\n }\n \n+std::vector<CChainState*> ChainstateManager::GetAllForBlockDownload()\n+{\n+    std::vector<CChainState*> out;\n+\n+    bool snapshot_in_ibd =\n+        m_snapshot_chainstate && m_snapshot_chainstate->IsInitialBlockDownload();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862195583",
      "id" : 862195583,
      "in_reply_to_id" : 801031354,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zZA9_",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 4613,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862195583/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862195583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862195631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862195631"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T21:58:16Z",
      "diff_hunk" : "@@ -4596,6 +4605,27 @@ std::vector<CChainState*> ChainstateManager::GetAll()\n     return out;\n }\n \n+std::vector<CChainState*> ChainstateManager::GetAllForBlockDownload()\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862195631",
      "id" : 862195631,
      "in_reply_to_id" : 801030242,
      "line" : 4846,
      "node_id" : "PRRC_kwDOABII584zZA-v",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 4846,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 39,
      "pull_request_review_id" : 958298033,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862195631/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T21:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862195631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862196865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862196865"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch, not sure what happened here. Too many assumeutxo commits getting shuffled around.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T22:00:19Z",
      "diff_hunk" : "@@ -987,6 +987,23 @@ class ChainstateManager\n     //! ResizeCoinsCaches() as needed.\n     void MaybeRebalanceCaches() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Returns true if any chainstate in use is in initial block download.\n+    bool IsAnyChainInIBD() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n+    //! @returns the chainstate that indexers should consult when ensuring that an\n+    //!   index is synced with a chain where we can expect block index entries to have\n+    //!   BLOCK_HAVE_DATA beneath the tip.\n+    //!\n+    //!   In other words, give us the chainstate for which we can reasonably expect\n+    //!   that all blocks beneath the tip have been indexed. In practice this means\n+    //!   when using an assumed-valid chainstate based upon a snapshot, return only the\n+    //!   fully validated chain.\n+    CChainState& getChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n+    //! @returns true if we have more than one chainstate in use. This means that a\n+    //! background validation chainstate is running.\n+    bool hasBgChainstateInUse();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862196865",
      "id" : 862196865,
      "in_reply_to_id" : 831533853,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zZBSB",
      "original_commit_id" : "c4d90167f030547373715a44fc020d0da8461565",
      "original_line" : 1005,
      "original_position" : 19,
      "original_start_line" : 993,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 958313747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862196865/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-04-29T22:00:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862196865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862248090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862248090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missed an uppercase here it seems.",
      "commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "created_at" : "2022-04-29T22:55:04Z",
      "diff_hunk" : "@@ -5218,3 +5261,35 @@ ChainstateManager::~ChainstateManager()\n         i.clear();\n     }\n }\n+\n+std::optional<const CBlockIndex> ChainstateManager::GetSnapshotBaseBlock() const\n+{\n+    AssertLockHeld(::cs_main);\n+    const auto blockhash_op{this->SnapshotBlockhash()};\n+    if (!blockhash_op) return {};\n+    const CBlockIndex* found = m_blockman.LookupBlockIndex(*blockhash_op);\n+\n+    if (found) {\n+        return *found;\n+    }\n+    return {};\n+}\n+\n+std::optional<int> ChainstateManager::GetSnapshotBaseHeight() const\n+{\n+    AssertLockHeld(::cs_main);\n+    auto base{this->GetSnapshotBaseBlock()};\n+    return base ? std::make_optional(base->nHeight) : std::nullopt;\n+}\n+\n+CChainState& ChainstateManager::getChainstateForIndexing()\n+{\n+    return getSnapshotBaseBlock() ? *m_ibd_chainstate : *m_active_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r862248090",
      "id" : 862248090,
      "line" : 5287,
      "node_id" : "PRRC_kwDOABII584zZNya",
      "original_commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "original_line" : 5287,
      "original_position" : 113,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 113,
      "pull_request_review_id" : 958380230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862248090/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-04-29T22:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/862248090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-04-30T11:02:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1113968371",
      "id" : 1113968371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII585CZc7z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113968371/reactions"
      },
      "updated_at" : "2022-04-30T11:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113968371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r863006004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863006004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah, thanks.",
      "commit_id" : "bd25cf319c6710c7b772080d2a49f86ce50d829a",
      "created_at" : "2022-05-02T16:45:07Z",
      "diff_hunk" : "@@ -5218,3 +5261,35 @@ ChainstateManager::~ChainstateManager()\n         i.clear();\n     }\n }\n+\n+std::optional<const CBlockIndex> ChainstateManager::GetSnapshotBaseBlock() const\n+{\n+    AssertLockHeld(::cs_main);\n+    const auto blockhash_op{this->SnapshotBlockhash()};\n+    if (!blockhash_op) return {};\n+    const CBlockIndex* found = m_blockman.LookupBlockIndex(*blockhash_op);\n+\n+    if (found) {\n+        return *found;\n+    }\n+    return {};\n+}\n+\n+std::optional<int> ChainstateManager::GetSnapshotBaseHeight() const\n+{\n+    AssertLockHeld(::cs_main);\n+    auto base{this->GetSnapshotBaseBlock()};\n+    return base ? std::make_optional(base->nHeight) : std::nullopt;\n+}\n+\n+CChainState& ChainstateManager::getChainstateForIndexing()\n+{\n+    return getSnapshotBaseBlock() ? *m_ibd_chainstate : *m_active_chainstate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#discussion_r863006004",
      "id" : 863006004,
      "in_reply_to_id" : 862248090,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zcG00",
      "original_commit_id" : "2c7595a6f727544ce87e7caa2ef10e05232358a7",
      "original_line" : 5287,
      "original_position" : 113,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 959297850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863006004/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-02T16:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/863006004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/73197?v=4",
         "events_url" : "https://api.github.com/users/jamesob/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jamesob/followers",
         "following_url" : "https://api.github.com/users/jamesob/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jamesob/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jamesob",
         "id" : 73197,
         "login" : "jamesob",
         "node_id" : "MDQ6VXNlcjczMTk3",
         "organizations_url" : "https://api.github.com/users/jamesob/orgs",
         "received_events_url" : "https://api.github.com/users/jamesob/received_events",
         "repos_url" : "https://api.github.com/users/jamesob/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jamesob/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jamesob"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-13T07:39:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1125750498",
      "id" : 1125750498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII585DGZbi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125750498/reactions"
      },
      "updated_at" : "2022-05-13T07:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125750498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-05-31T10:21:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/24008#issuecomment-1141949598",
      "id" : 1141949598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
      "node_id" : "IC_kwDOABII585EEMSe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1141949598/reactions"
      },
      "updated_at" : "2022-05-31T10:21:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1141949598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
