[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25005](https://github.com/bitcoin/bitcoin/pull/25005) (wallet: remove extra wtx lookup in 'AvailableCoins' + several code cleanups. by furszy)\n* [#24845](https://github.com/bitcoin/bitcoin/pull/24845) (wallet: createTransaction, return proper error description for  \"too-long-mempool-chain\" + introduce generic Result classes by furszy)\n* [#24811](https://github.com/bitcoin/bitcoin/pull/24811) (refactor: Prepare for moving ArgsManager out of util/system by Empact)\n* [#24752](https://github.com/bitcoin/bitcoin/pull/24752) (wallet: increase BnB upper limit by S3RK)\n* [#24699](https://github.com/bitcoin/bitcoin/pull/24699) (wallet: Improve AvailableCoins performance by reducing duplicated operations by achow101)\n* [#24584](https://github.com/bitcoin/bitcoin/pull/24584) (wallet: avoid mixing different `OutputTypes` during coin selection by josibake)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2022-05-08T06:24:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#issuecomment-1120359040",
      "id" : 1120359040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25083",
      "node_id" : "IC_kwDOABII585Cx1KA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120359040/reactions"
      },
      "updated_at" : "2022-05-08T06:24:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120359040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867492859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867492859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nvoid AvailableCoinsListUnspent(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\r\n```\r\n\r\nThis should fix the clang error.",
      "commit_id" : "b1adf9f3d4e556fb5bc0ff3ddbbe1ea34415205d",
      "created_at" : "2022-05-08T13:36:41Z",
      "diff_hunk" : "@@ -35,7 +35,9 @@ TxSize CalculateMaximumSignedTxSize(const CTransaction& tx, const CWallet* walle\n /**\n  * populate vCoins with vector of available COutputs.\n  */\n-void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, std::optional<CFeeRate> feerate = std::nullopt, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+\n+void AvailableCoinsListUnspent(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867492859",
      "id" : 867492859,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII584ztOP7",
      "original_commit_id" : "b1adf9f3d4e556fb5bc0ff3ddbbe1ea34415205d",
      "original_line" : 40,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 7,
      "pull_request_review_id" : 965441993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867492859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-08T13:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867492859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867503596"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867503596"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There is extra whitepace on this line that the linter doesn't like.",
      "commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "created_at" : "2022-05-08T14:58:47Z",
      "diff_hunk" : "@@ -191,8 +191,12 @@ void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const C\n             bool solvable = provider ? IsSolvable(*provider, wtx.tx->vout[i].scriptPubKey) : false;\n             bool spendable = ((mine & ISMINE_SPENDABLE) != ISMINE_NO) || (((mine & ISMINE_WATCH_ONLY) != ISMINE_NO) && (coinControl && coinControl->fAllowWatchOnly && solvable));\n             int input_bytes = GetTxSpendSize(wallet, wtx, i, (coinControl && coinControl->fAllowWatchOnly));\n-\n-            vCoins.emplace_back(COutPoint(wtx.GetHash(), i), wtx.tx->vout.at(i), nDepth, input_bytes, spendable, solvable, safeTx, wtx.GetTxTime(), tx_from_me);\n+            ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867503596",
      "id" : 867503596,
      "line" : 194,
      "node_id" : "PRRC_kwDOABII584ztQ3s",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 194,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 15,
      "pull_request_review_id" : 965451165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867503596/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-08T14:58:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867503596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867503792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867503792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/fee/fees\r\n\r\nHere and elsewhere. clang-tidy is complaining about this.",
      "commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "created_at" : "2022-05-08T15:00:33Z",
      "diff_hunk" : "@@ -58,7 +58,7 @@ static void CoinSelection(benchmark::Bench& bench)\n     // Create coins\n     std::vector<COutput> coins;\n     for (const auto& wtx : wtxs) {\n-        coins.emplace_back(COutPoint(wtx->GetHash(), 0), wtx->tx->vout.at(0), /*depth=*/6 * 24, GetTxSpendSize(wallet, *wtx, 0), /*spendable=*/true, /*solvable=*/true, /*safe=*/true, wtx->GetTxTime(), /*from_me=*/true);\n+        coins.emplace_back(COutPoint(wtx->GetHash(), 0), wtx->tx->vout.at(0), /*depth=*/6 * 24, GetTxSpendSize(wallet, *wtx, 0), /*spendable=*/true, /*solvable=*/true, /*safe=*/true, wtx->GetTxTime(), /*from_me=*/true, /*fee=*/ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867503792",
      "id" : 867503792,
      "line" : 61,
      "node_id" : "PRRC_kwDOABII584ztQ6w",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 61,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/coin_selection.cpp",
      "position" : 5,
      "pull_request_review_id" : 965451339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867503792/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-08T15:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867503792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867504178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I think it would be better to put `feerate` after `coinControl` to maintain the grouping of similar kinds of parameters.",
      "commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "created_at" : "2022-05-08T15:03:01Z",
      "diff_hunk" : "@@ -35,7 +35,9 @@ TxSize CalculateMaximumSignedTxSize(const CTransaction& tx, const CWallet* walle\n /**\n  * populate vCoins with vector of available COutputs.\n  */\n-void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, std::optional<CFeeRate> feerate = std::nullopt, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867504178",
      "id" : 867504178,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII584ztRAy",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 38,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : 5,
      "pull_request_review_id" : 965451339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-08T15:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867504999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would be better to have `feerate` be a `std::optional<CFeeRate` with a default of `std::nullopt`. This would allow us to do some simplification in `AvailableCoins` where the `CFeeRate` can just be passed in without checking whether it has a value.",
      "commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "created_at" : "2022-05-08T15:09:12Z",
      "diff_hunk" : "@@ -73,16 +75,49 @@ struct COutput {\n           solvable{solvable},\n           safe{safe},\n           time{time},\n-          from_me{from_me},\n-          effective_value{txout.nValue}\n-    {}\n+          from_me{from_me}\n+    {\n+        if (fees) {\n+            // if input_bytes unknown, the fees should be 0, if input_bytes is known, then the fees should be a positive integer\n+            assert((input_bytes < 0 && fees.value() == 0) || (input_bytes > 0 && fees.value() >= 0));\n+            fee = fees;\n+            effective_value = txout.nValue - fee.value();\n+        }\n+    }\n+\n+    COutput(const COutPoint& outpoint, const CTxOut& txout, int depth, int input_bytes, bool spendable, bool solvable, bool safe, int64_t time, bool from_me, const CFeeRate feerate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867504999",
      "id" : 867504999,
      "line" : 88,
      "node_id" : "PRRC_kwDOABII584ztRNn",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 88,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 50,
      "pull_request_review_id" : 965452250,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504999/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-08T15:11:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867504999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867522903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867522903"
         }
      },
      "author_association" : "NONE",
      "body" : "Thanks, it's fixed now",
      "commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "created_at" : "2022-05-08T17:53:31Z",
      "diff_hunk" : "@@ -35,7 +35,9 @@ TxSize CalculateMaximumSignedTxSize(const CTransaction& tx, const CWallet* walle\n /**\n  * populate vCoins with vector of available COutputs.\n  */\n-void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, std::optional<CFeeRate> feerate = std::nullopt, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+\n+void AvailableCoinsListUnspent(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r867522903",
      "id" : 867522903,
      "in_reply_to_id" : 867492859,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584ztVlX",
      "original_commit_id" : "b1adf9f3d4e556fb5bc0ff3ddbbe1ea34415205d",
      "original_line" : 40,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : null,
      "pull_request_review_id" : 965466420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867522903/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-08T17:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867522903",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868018364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868018364"
         }
      },
      "author_association" : "NONE",
      "body" : "I've changed it everywhere, thanks.",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T13:32:35Z",
      "diff_hunk" : "@@ -58,7 +58,7 @@ static void CoinSelection(benchmark::Bench& bench)\n     // Create coins\n     std::vector<COutput> coins;\n     for (const auto& wtx : wtxs) {\n-        coins.emplace_back(COutPoint(wtx->GetHash(), 0), wtx->tx->vout.at(0), /*depth=*/6 * 24, GetTxSpendSize(wallet, *wtx, 0), /*spendable=*/true, /*solvable=*/true, /*safe=*/true, wtx->GetTxTime(), /*from_me=*/true);\n+        coins.emplace_back(COutPoint(wtx->GetHash(), 0), wtx->tx->vout.at(0), /*depth=*/6 * 24, GetTxSpendSize(wallet, *wtx, 0), /*spendable=*/true, /*solvable=*/true, /*safe=*/true, wtx->GetTxTime(), /*from_me=*/true, /*fee=*/ 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868018364",
      "id" : 868018364,
      "in_reply_to_id" : 867503792,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zvOi8",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 61,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/bench/coin_selection.cpp",
      "position" : null,
      "pull_request_review_id" : 966137582,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868018364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T13:32:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868018364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868020944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868020944"
         }
      },
      "author_association" : "NONE",
      "body" : "Yeah, I've changed the order.",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T13:35:09Z",
      "diff_hunk" : "@@ -35,7 +35,9 @@ TxSize CalculateMaximumSignedTxSize(const CTransaction& tx, const CWallet* walle\n /**\n  * populate vCoins with vector of available COutputs.\n  */\n-void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);\n+void AvailableCoins(const CWallet& wallet, std::vector<COutput>& vCoins, const CCoinControl* coinControl = nullptr, const CAmount& nMinimumAmount = 1, std::optional<CFeeRate> feerate = std::nullopt, const CAmount& nMaximumAmount = MAX_MONEY, const CAmount& nMinimumSumAmount = MAX_MONEY, const uint64_t nMaximumCount = 0) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868020944",
      "id" : 868020944,
      "in_reply_to_id" : 867504178,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zvPLQ",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 38,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/spend.h",
      "position" : null,
      "pull_request_review_id" : 966141310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868020944/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T13:35:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868020944",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868024136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868024136"
         }
      },
      "author_association" : "NONE",
      "body" : "I agree, it looks a lot cleaner now.",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T13:38:25Z",
      "diff_hunk" : "@@ -73,16 +75,49 @@ struct COutput {\n           solvable{solvable},\n           safe{safe},\n           time{time},\n-          from_me{from_me},\n-          effective_value{txout.nValue}\n-    {}\n+          from_me{from_me}\n+    {\n+        if (fees) {\n+            // if input_bytes unknown, the fees should be 0, if input_bytes is known, then the fees should be a positive integer\n+            assert((input_bytes < 0 && fees.value() == 0) || (input_bytes > 0 && fees.value() >= 0));\n+            fee = fees;\n+            effective_value = txout.nValue - fee.value();\n+        }\n+    }\n+\n+    COutput(const COutPoint& outpoint, const CTxOut& txout, int depth, int input_bytes, bool spendable, bool solvable, bool safe, int64_t time, bool from_me, const CFeeRate feerate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868024136",
      "id" : 868024136,
      "in_reply_to_id" : 867504999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584zvP9I",
      "original_commit_id" : "7da2200c917a6cbedf2cf6d33e0764116162eae3",
      "original_line" : 88,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : null,
      "pull_request_review_id" : 966146053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868024136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T13:38:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868024136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868136347"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868136347"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Naming-nit:\r\nSorry to disagree with previous review, but I think that we actually always use `fee` everywhere, so the plural here feels a bit odd. I notice that the parameter name would clash with the class member name, since they'd then both would be named `fee`.\r\n\r\nPerhaps we should use this PR as an opportunity to rename the class members of `COutput` to use the `m_` prefix as suggested by the [Style Guide](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c)? This would allow us to use `fee` for the parameter as the member variable would then be `COutput.m_fee`.",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T15:21:40Z",
      "diff_hunk" : "@@ -73,16 +75,49 @@ struct COutput {\n           solvable{solvable},\n           safe{safe},\n           time{time},\n-          from_me{from_me},\n-          effective_value{txout.nValue}\n-    {}\n+          from_me{from_me}\n+    {\n+        if (feerate) {\n+            fee = input_bytes < 0 ? 0 : feerate.value().GetFee(input_bytes);\n+            effective_value = txout.nValue - fee.value();\n+        }\n+    }\n+\n+    COutput(const COutPoint& outpoint, const CTxOut& txout, int depth, int input_bytes, bool spendable, bool solvable, bool safe, int64_t time, bool from_me, const CAmount fees)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868136347",
      "id" : 868136347,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII584zvrWb",
      "original_commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "original_line" : 86,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/wallet/coinselection.h",
      "position" : 48,
      "pull_request_review_id" : 966338755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868136347/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T15:37:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868136347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868139385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868139385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: `fee_rate` here, but `feerate` in all the other places I see here. Should this perhaps be made consistent?",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T15:24:41Z",
      "diff_hunk" : "@@ -1399,7 +1399,7 @@ RPCHelpMan sendall()\n                     total_input_value += tx->tx->vout[input.prevout.n].nValue;\n                 }\n             } else {\n-                AvailableCoins(*pwallet, all_the_utxos, &coin_control, /*nMinimumAmount=*/0);\n+                AvailableCoins(*pwallet, all_the_utxos, &coin_control, fee_rate, /*nMinimumAmount=*/0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868139385",
      "id" : 868139385,
      "line" : 1402,
      "node_id" : "PRRC_kwDOABII584zvsF5",
      "original_commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "original_line" : 1402,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/spend.cpp",
      "position" : 5,
      "pull_request_review_id" : 966338755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868139385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T15:37:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868139385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868151129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868151129"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would these additional testcases perhaps be interesting?:\r\nWhat happens if a non-zero fee is passed while `input_bytes` is `-1`? What happens if a fee greater than `nValue` is passed while `input_bytes` is `-1`?",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T15:36:09Z",
      "diff_hunk" : "@@ -815,5 +813,40 @@ BOOST_AUTO_TEST_CASE(waste_test)\n     BOOST_CHECK_EQUAL(0, GetSelectionWaste(selection, /* change cost */ 0, new_target));\n }\n \n+BOOST_AUTO_TEST_CASE(effective_value_test)\n+{\n+    const int input_bytes = 148;\n+    const CFeeRate feerate(1000);\n+    const CAmount nValue = 10000;\n+    const int nInput = 0;\n+\n+    CMutableTransaction tx;\n+    tx.vout.resize(1);\n+    tx.vout[nInput].nValue = nValue;\n+\n+    // standard case, pass feerate in constructor\n+    COutput output1(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, feerate);\n+    const CAmount expected_ev1 = 9852; // 10000 - 148\n+    BOOST_CHECK_EQUAL(output1.GetEffectiveValue(), expected_ev1);\n+\n+    // input bytes unknown (input_bytes = -1), pass feerate in constructor\n+    COutput output2(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, /*input_bytes=*/ -1, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, feerate);\n+    BOOST_CHECK_EQUAL(output2.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n+\n+    // negative effective value, pass feerate in constructor\n+    COutput output3(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, CFeeRate(100000));\n+    const CAmount expected_ev3 = -4800; // 10000 - 14800\n+    BOOST_CHECK_EQUAL(output3.GetEffectiveValue(), expected_ev3);\n+\n+    // standard case, pass fees in constructor\n+    const CAmount fees = 148;\n+    COutput output4(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, fees);\n+    BOOST_CHECK_EQUAL(output4.GetEffectiveValue(), expected_ev1);\n+\n+    // input bytes unknown (input_bytes = -1), pass fees in constructor\n+    COutput output5(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, /*input_bytes=*/ -1, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, /*fees=*/ 0);\n+    BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868151129",
      "id" : 868151129,
      "line" : 848,
      "node_id" : "PRRC_kwDOABII584zvu9Z",
      "original_commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "original_line" : 848,
      "original_position" : 127,
      "original_start_line" : 846,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 127,
      "pull_request_review_id" : 966338755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868151129/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 846,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-09T15:37:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868151129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868266184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868266184"
         }
      },
      "author_association" : "NONE",
      "body" : "I think that in both of these cases the assertion on src/wallet/coinselection.h:98 will just fail. `fee` must be `0` whenever `input_bytes` has a negative value.",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-09T17:49:31Z",
      "diff_hunk" : "@@ -815,5 +813,40 @@ BOOST_AUTO_TEST_CASE(waste_test)\n     BOOST_CHECK_EQUAL(0, GetSelectionWaste(selection, /* change cost */ 0, new_target));\n }\n \n+BOOST_AUTO_TEST_CASE(effective_value_test)\n+{\n+    const int input_bytes = 148;\n+    const CFeeRate feerate(1000);\n+    const CAmount nValue = 10000;\n+    const int nInput = 0;\n+\n+    CMutableTransaction tx;\n+    tx.vout.resize(1);\n+    tx.vout[nInput].nValue = nValue;\n+\n+    // standard case, pass feerate in constructor\n+    COutput output1(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, feerate);\n+    const CAmount expected_ev1 = 9852; // 10000 - 148\n+    BOOST_CHECK_EQUAL(output1.GetEffectiveValue(), expected_ev1);\n+\n+    // input bytes unknown (input_bytes = -1), pass feerate in constructor\n+    COutput output2(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, /*input_bytes=*/ -1, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, feerate);\n+    BOOST_CHECK_EQUAL(output2.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n+\n+    // negative effective value, pass feerate in constructor\n+    COutput output3(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, CFeeRate(100000));\n+    const CAmount expected_ev3 = -4800; // 10000 - 14800\n+    BOOST_CHECK_EQUAL(output3.GetEffectiveValue(), expected_ev3);\n+\n+    // standard case, pass fees in constructor\n+    const CAmount fees = 148;\n+    COutput output4(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, fees);\n+    BOOST_CHECK_EQUAL(output4.GetEffectiveValue(), expected_ev1);\n+\n+    // input bytes unknown (input_bytes = -1), pass fees in constructor\n+    COutput output5(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, /*input_bytes=*/ -1, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, /*fees=*/ 0);\n+    BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r868266184",
      "id" : 868266184,
      "in_reply_to_id" : 868151129,
      "line" : 848,
      "node_id" : "PRRC_kwDOABII584zwLDI",
      "original_commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "original_line" : 848,
      "original_position" : 127,
      "original_start_line" : 846,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 127,
      "pull_request_review_id" : 966617397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868266184/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 846,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-09T17:49:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868266184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/75942586?v=4",
         "events_url" : "https://api.github.com/users/ishaanam/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ishaanam/followers",
         "following_url" : "https://api.github.com/users/ishaanam/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ishaanam/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ishaanam",
         "id" : 75942586,
         "login" : "ishaanam",
         "node_id" : "MDQ6VXNlcjc1OTQyNTg2",
         "organizations_url" : "https://api.github.com/users/ishaanam/orgs",
         "received_events_url" : "https://api.github.com/users/ishaanam/received_events",
         "repos_url" : "https://api.github.com/users/ishaanam/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ishaanam/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ishaanam/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ishaanam"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r870792429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870792429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah good to see that you're stating your assumptions. :)",
      "commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "created_at" : "2022-05-11T22:08:51Z",
      "diff_hunk" : "@@ -815,5 +813,40 @@ BOOST_AUTO_TEST_CASE(waste_test)\n     BOOST_CHECK_EQUAL(0, GetSelectionWaste(selection, /* change cost */ 0, new_target));\n }\n \n+BOOST_AUTO_TEST_CASE(effective_value_test)\n+{\n+    const int input_bytes = 148;\n+    const CFeeRate feerate(1000);\n+    const CAmount nValue = 10000;\n+    const int nInput = 0;\n+\n+    CMutableTransaction tx;\n+    tx.vout.resize(1);\n+    tx.vout[nInput].nValue = nValue;\n+\n+    // standard case, pass feerate in constructor\n+    COutput output1(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, feerate);\n+    const CAmount expected_ev1 = 9852; // 10000 - 148\n+    BOOST_CHECK_EQUAL(output1.GetEffectiveValue(), expected_ev1);\n+\n+    // input bytes unknown (input_bytes = -1), pass feerate in constructor\n+    COutput output2(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, /*input_bytes=*/ -1, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, feerate);\n+    BOOST_CHECK_EQUAL(output2.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1\n+\n+    // negative effective value, pass feerate in constructor\n+    COutput output3(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, CFeeRate(100000));\n+    const CAmount expected_ev3 = -4800; // 10000 - 14800\n+    BOOST_CHECK_EQUAL(output3.GetEffectiveValue(), expected_ev3);\n+\n+    // standard case, pass fees in constructor\n+    const CAmount fees = 148;\n+    COutput output4(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, fees);\n+    BOOST_CHECK_EQUAL(output4.GetEffectiveValue(), expected_ev1);\n+\n+    // input bytes unknown (input_bytes = -1), pass fees in constructor\n+    COutput output5(COutPoint(tx.GetHash(), nInput), tx.vout.at(nInput), /*depth=*/ 1, /*input_bytes=*/ -1, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, /*fees=*/ 0);\n+    BOOST_CHECK_EQUAL(output5.GetEffectiveValue(), nValue); // The effective value should be equal to the absolute value if input_bytes is -1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25083#discussion_r870792429",
      "id" : 870792429,
      "in_reply_to_id" : 868151129,
      "line" : 848,
      "node_id" : "PRRC_kwDOABII584z5zzt",
      "original_commit_id" : "b07500f28cff352239a6ffbf1da9f4d2bc965838",
      "original_line" : 848,
      "original_position" : 127,
      "original_start_line" : 846,
      "path" : "src/wallet/test/coinselector_tests.cpp",
      "position" : 127,
      "pull_request_review_id" : 970052987,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25083",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870792429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 846,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-11T22:08:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/870792429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   }
]
