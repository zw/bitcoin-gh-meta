[
   {
      "author_association" : "MEMBER",
      "body" : "This test passes locally for me in 11-12 minutes (debian testing), albeit only with timeouts disabled `test/functional/feature_index_prune.py --timeout-factor=0`",
      "created_at" : "2022-04-29T15:55:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1113474365",
      "id" : 1113474365,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25031",
      "node_id" : "IC_kwDOABII585CXkU9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113474365/reactions"
      },
      "updated_at" : "2022-04-29T15:55:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113474365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I got the same at https://cirrus-ci.com/task/6464103580434432?logs=functional_tests#L3097:\r\n```\r\ntest  2022-05-10T03:08:31.456000Z TestFramework (ERROR): Assertion failed \r\n                                Traceback (most recent call last):\r\n                                    File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\test_framework.py\", line 133, in main\r\n                                    self.run_test()\r\n                                    File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_index_prune.py\", line 141, in run_test\r\n                                    self.sync_blocks(timeout=300)\r\n                                    File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\test_framework.py\", line 680, in sync_blocks\r\n                                    assert (all([len(x.getpeerinfo()) for x in rpc_connections]))\r\n                                AssertionError\r\ntest  2022-05-10T03:08:31.456000Z TestFramework (DEBUG): Closing down network thread \r\n...\r\n<lots of lines of other tests elided>\r\n...\r\ntest  2022-05-10T03:08:35.705000Z TestFramework (WARNING): Not cleaning up dir C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\test_runner_â¿_ð_20220510_024705\\feature_index_prune_242 \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR): Test failed. Test logging available at C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\test_runner_â¿_ð_20220510_024705\\feature_index_prune_242/test_framework.log \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR): \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR): Hint: Call C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\combine_logs.py 'C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\test_runner_â¿_ð_20220510_024705\\feature_index_prune_242' to consolidate all logs \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR): \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log. \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues \r\ntest  2022-05-10T03:08:35.705000Z TestFramework (ERROR):             \r\n```\r\n(I'm not sure how to do the upload of the combined log myself, but the link above should take you to the job.)\r\n",
      "created_at" : "2022-05-10T03:49:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1121861230",
      "id" : 1121861230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25031",
      "node_id" : "IC_kwDOABII585C3j5u",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121861230/reactions"
      },
      "updated_at" : "2022-05-10T03:49:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1121861230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4162948?v=4",
         "events_url" : "https://api.github.com/users/david-bakin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/david-bakin/followers",
         "following_url" : "https://api.github.com/users/david-bakin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/david-bakin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/david-bakin",
         "id" : 4162948,
         "login" : "david-bakin",
         "node_id" : "MDQ6VXNlcjQxNjI5NDg=",
         "organizations_url" : "https://api.github.com/users/david-bakin/orgs",
         "received_events_url" : "https://api.github.com/users/david-bakin/received_events",
         "repos_url" : "https://api.github.com/users/david-bakin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/david-bakin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/david-bakin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/david-bakin"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I started debugging the same error in #24230 log https://cirrus-ci.com/task/4528289543880704 wrongly thinking it was caused by the PR (which is related to indexing) after it happened twice in a row.\r\n\r\nBut it seems like there is just a race condition in the test. The test starts 4 nodes, then shut down the first 3, and restarts those three with a `-connect` option to connect them to 4th node. Then it immediately calls `sync_blocks` which fails because the `getpeerinfo` for one of the nodes is empty.\r\n\r\nMaybe a fix is to add:\r\n\r\n```python\r\nself.wait_until(lambda: all(len(n.getpeerinfo()) for n in self.nodes))\r\n```\r\n\r\nbefore the sync_blocks call, but I'm not sure.",
      "created_at" : "2022-05-12T18:36:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1125306199",
      "id" : 1125306199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25031",
      "node_id" : "IC_kwDOABII585DEs9X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125306199/reactions"
      },
      "updated_at" : "2022-05-12T18:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125306199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Note the stack trace:\r\n\r\n```\r\nTraceback (most recent call last):\r\n\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\test_framework.py\", line 133, in main\r\n\r\n    self.run_test()\r\n\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_index_prune.py\", line 141, in run_test\r\n\r\n    self.sync_blocks(timeout=300)\r\n\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\test_framework.py\", line 680, in sync_blocks\r\n\r\n    assert (all([len(x.getpeerinfo()) for x in rpc_connections]))\r\n\r\nAssertionError\r\n```",
      "created_at" : "2022-05-12T18:37:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1125307158",
      "id" : 1125307158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25031",
      "node_id" : "IC_kwDOABII585DEtMW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125307158/reactions"
      },
      "updated_at" : "2022-05-12T18:37:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125307158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@fjahr could weigh in perhaps. The `sync_blocks` call was added in de08932efa953e9a237cbf879460488ad8947411 from #21726 which was merged about 2 weeks ago",
      "created_at" : "2022-05-12T18:41:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1125310477",
      "id" : 1125310477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25031",
      "node_id" : "IC_kwDOABII585DEuAN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125310477/reactions"
      },
      "updated_at" : "2022-05-12T18:41:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125310477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the ping! I was unable to reproduce the issue locally but I agree with the analysis by @ryanofsky that there is a race going on between the establishment of the connection and that sanity check line in `sync_blocks` that fails.\r\n\r\nI think the [one-liner suggested](https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1125306199) would work I think but I think I would prefer to use the `addconnection` RPC which should have the same effect but the code is easier to read and debug. Suggested in #25123.",
      "created_at" : "2022-05-12T23:05:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/25031#issuecomment-1125495829",
      "id" : 1125495829,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25031",
      "node_id" : "IC_kwDOABII585DFbQV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125495829/reactions"
      },
      "updated_at" : "2022-05-12T23:07:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1125495829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   }
]
