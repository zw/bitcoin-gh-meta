[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/25038).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/25038#pullrequestreview-1318865644) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28972](https://github.com/bitcoin/bitcoin/pull/28972) (test: Add and use option for tx-version in MiniWallet methods by maflcko)\n* [#28960](https://github.com/bitcoin/bitcoin/pull/28960) (kernel: Remove dependency on CScheduler by TheCharlatan)\n* [#28950](https://github.com/bitcoin/bitcoin/pull/28950) (RPC: Add maxfeerate and maxburnamount args to submitpackage by instagibbs)\n* [#28948](https://github.com/bitcoin/bitcoin/pull/28948) (v3 transaction policy for anti-pinning by glozow)\n* [#28886](https://github.com/bitcoin/bitcoin/pull/28886) (refactor: Replace sets of txiter with CTxMemPoolEntryRefs by TheCharlatan)\n* [#28863](https://github.com/bitcoin/bitcoin/pull/28863) (wallet, mempool: propagete `checkChainLimits` error message to wallet by ismaelsadeeq)\n* [#28690](https://github.com/bitcoin/bitcoin/pull/28690) (build: Introduce internal kernel library by TheCharlatan)\n* [#28368](https://github.com/bitcoin/bitcoin/pull/28368) (Fee Estimator updates from Validation Interface/CScheduler thread by ismaelsadeeq)\n* [#28335](https://github.com/bitcoin/bitcoin/pull/28335) (RFC: Remove boost usage from kernel api / headers by TheCharlatan)\n* [#27432](https://github.com/bitcoin/bitcoin/pull/27432) (contrib: add tool to convert compact-serialized UTXO set to SQLite database by theStack)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-04-30T04:17:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1113911849",
      "id" : 1113911849,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585CZPIp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113911849/reactions"
      },
      "updated_at" : "2023-12-01T04:46:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113911849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\n$ ./test/lint/lint-python.py\r\ntest/functional/feature_package_rbf.py:18:1: F401 'test_framework.util.assert_equal' imported but unused\r\n```\r\n",
      "created_at" : "2022-05-03T14:21:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1116158353",
      "id" : 1116158353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585ChzmR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116158353/reactions"
      },
      "updated_at" : "2022-05-03T14:21:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1116158353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "$ ./test/lint/lint-python.py\r\ntest/functional/feature_package_rbf.py:18:1: F401 'test_framework.util.assert_equal' imported but unused",
      "created_at" : "2022-05-09T02:50:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1120581194",
      "id" : 1120581194,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585CyrZK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120581194/reactions"
      },
      "updated_at" : "2022-05-09T02:50:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120581194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/101321365?v=4",
         "events_url" : "https://api.github.com/users/ramsemune123/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ramsemune123/followers",
         "following_url" : "https://api.github.com/users/ramsemune123/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ramsemune123/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ramsemune123",
         "id" : 101321365,
         "login" : "ramsemune123",
         "node_id" : "U_kgDOBgoKlQ",
         "organizations_url" : "https://api.github.com/users/ramsemune123/orgs",
         "received_events_url" : "https://api.github.com/users/ramsemune123/received_events",
         "repos_url" : "https://api.github.com/users/ramsemune123/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ramsemune123/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ramsemune123/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ramsemune123"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868430869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868430869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reason to not turn `PackageTestAccept` as `true` too ?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T20:34:11Z",
      "diff_hunk" : "@@ -502,7 +505,7 @@ class MemPoolAccept\n                             /* m_bypass_limits */ false,\n                             /* m_coins_to_uncache */ coins_to_uncache,\n                             /* m_test_accept */ false,\n-                            /* m_allow_bip125_replacement */ false,\n+                            /* m_allow_bip125_replacement */ true,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868430869",
      "id" : 868430869,
      "line" : 508,
      "node_id" : "PRRC_kwDOABII584zwzQV",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 508,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868430869/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868430869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868495787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868495787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC given that `PackageMempoolChecks` happens after package dedup there should not be remaining already-in-mempool transactions at that stage in `txns` ? So no descendants that could be `to-be-replaced mempool entries` to subtract or are you thinking to something else ? ",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T21:42:14Z",
      "diff_hunk" : "@@ -975,13 +1006,89 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868495787",
      "id" : 868495787,
      "line" : 1022,
      "node_id" : "PRRC_kwDOABII584zxDGr",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 1022,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 221,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868495787/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868495787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868503310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868503310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not sure if this check isn't already redundant given that calling `ReplacementChecks` in `AcceptSingleTransaction` is dependent on `m_rbf=true` or unless there is another code path where it makes sense ?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T21:50:22Z",
      "diff_hunk" : "@@ -928,6 +952,9 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n     const uint256& hash = ws.m_hash;\n     TxValidationState& state = ws.m_state;\n \n+    m_rbf = ws.m_conflicts.size() > 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868503310",
      "id" : 868503310,
      "line" : 955,
      "node_id" : "PRRC_kwDOABII584zxE8O",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 955,
      "original_position" : 156,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 156,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868503310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868503310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868529657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868529657"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Depending on the design of p2p packages, we might relay the \"full-non-dedup\" version of the package as our peers might not have the same mempool composition. So the additional fees might have to be paid on the non-dedup package. I don't think we have to settle the question now though we might have to rework package-RBF in function of p2p design ?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T22:20:36Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868529657",
      "id" : 868529657,
      "line" : 137,
      "node_id" : "PRRC_kwDOABII584zxLX5",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 137,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 45,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868529657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868529657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868533379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868533379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it could be a limitation for second-layer package issuers, where a child-with-parents package aims to replace more than 5 LN commitment transactions at the same time. A counterparty could extend the 5 non-related commitment transactions descendants until reaching max in-mempool limits, thus interfering with their potential package-RBF.\r\n\r\nAm I correct ? That said, I remember we've already said that child-with-parents to replace multiple LN commitment transactions open the door to malicious interferences.",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-09T22:25:01Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth after deduplication at or\n+   above the rate set by the node's incremental relay feerate. For example, if the incremental relay\n+   feerate is 1 satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the\n+   package fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r868533379",
      "id" : 868533379,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII584zxMSD",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 143,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 51,
      "pull_request_review_id" : 966801973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868533379/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-09T22:25:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/868533379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869137839"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869137839"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This rule startled me a bit at first, it may be worth mentioning that if you want to update the package's child, you should do a normal RBF of just that child.\r\n\r\nWhat you mean is that package-rbf applies for the case where we want for example to replace `{commitTxAlice, anchorAlice}` by `{commitTxBob, anchorBob}` where `commitTxAlice` and `commitTxBob` conflict, but we cannot use package-rbf to replace `{commitTxAlice, anchorAlice1}` by `{commitTxAlice, anchorAlice2}` where `anchorAlice2` pays more fees than `anchorAlice1`. In that case we should submit `anchorAlice2` alone and it will go through the usual RBF rules. Is that correct?\r\n\r\nAlso you don't want to mix up package-rbf and normal rbf, so a child tx cannot create conflicts \"outside of the package\" IIUC.",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-10T11:46:25Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869137839",
      "id" : 869137839,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII584zzf2v",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 126,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 34,
      "pull_request_review_id" : 967623639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869137839/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T12:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869137839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869152001"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869152001"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My head hurts :laughing: \r\n\r\nI'm not 100% sure I'm understanding this rule correctly, can you let me know if the following example makes sense?\r\n\r\nLet's imagine we have `{commitTxAlice, anchorTxAlice}` in the mempool that we want to replace.\r\nWhat we really want to do is to replace `commitTxAlice` by `commitTxBob` (the child is just a tool to achieve that).\r\nWe ask `bitcoind` to `fundrawtransaction` to ensure our `anchorTxBob` adds enough funds.\r\n`bitcoind` adds an unconfirmed (but safe) wallet input:\r\n\r\n```\r\n+-------------+\r\n| commitTxBob |---------+\r\n+-------------+         |      +-------------+\r\n                        |      |             |\r\n+------------------+    +----->| anchorTxBob |\r\n| previousWalletTx |---------->|             |\r\n+------------------+           +-------------+\r\n```\r\n\r\nIf we include `previousWalletTx` in the package, this package-rbf would work, right?\r\nBut if we don't include `previousWalletTx` in the package, this would be rejected?\r\n\r\nBut what if `previousWalletTx` itself has an unconfirmed parent?\r\nWe cannot include this grand-parent in the package (since packages are only parents-with-single-child).\r\n\r\nThis isn't directly bringing an unconfirmed input, but it is indirectly bringing one. Is that ok? If that's ok, why wouldn't it be ok to just allow adding new unconfirmed inputs in the first place?",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-10T12:03:32Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869152001",
      "id" : 869152001,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII584zzjUB",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : 40,
      "pull_request_review_id" : 967623639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869152001/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 130,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-10T12:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869152001",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869160432"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869160432"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I believe this issue can unfortunately arise even when you're replacing a single LN commitment transaction.\r\nImagine that you're trying to replace `{commitTxAlice, anchorTxAlice}` but Alice has created `anchorTxAlice` to have 100 outputs and broadcast one child tx per output, you're already hitting the 100 transactions limit...\r\n\r\nI believe that the only thing that can save Bob here is to broadcast `{commitTxAlice, anchorTxBob}` by relying on the CPFP carve-out rule to get Alice's commitment to confirm. But in order to do that, Bob needs to somehow get the signed `commitTxAlice` (which never appeared in his mempool since his mempool contains `commitTxBob`).\r\n\r\nSo this rule is an issue for L2 protocols, but it is also a protection against high mempool churn, so it's hard to draw the line.",
      "commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "created_at" : "2022-05-10T12:12:45Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth after deduplication at or\n+   above the rate set by the node's incremental relay feerate. For example, if the incremental relay\n+   feerate is 1 satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the\n+   package fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r869160432",
      "id" : 869160432,
      "in_reply_to_id" : 868533379,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII584zzlXw",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 143,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 51,
      "pull_request_review_id" : 967623639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869160432/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-10T12:14:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/869160432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873782940"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873782940"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This RBF policy is essentially treating the package as \"one big transaction,\" which works because everything is in the ancestor set of the child. PackageTestAccept doesn't impose any topology restrictions - it even allows unrelated transactions to be submitted as a group. So it wouldn't make sense to use each other's fees.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:16:28Z",
      "diff_hunk" : "@@ -502,7 +505,7 @@ class MemPoolAccept\n                             /* m_bypass_limits */ false,\n                             /* m_coins_to_uncache */ coins_to_uncache,\n                             /* m_test_accept */ false,\n-                            /* m_allow_bip125_replacement */ false,\n+                            /* m_allow_bip125_replacement */ true,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873782940",
      "id" : 873782940,
      "in_reply_to_id" : 868430869,
      "line" : 515,
      "node_id" : "PRRC_kwDOABII5840FN6c",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 515,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 15,
      "pull_request_review_id" : 974037959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873782940/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:36:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873782940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873799952"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873799952"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I mean a situation like this:\r\n\r\n<img width=\"673\" alt=\"image\" src=\"https://user-images.githubusercontent.com/25183001/168615825-6251d4d6-97b6-45cf-ada7-91c6a1d9ce45.png\">\r\n\r\n\r\n{A, B, C} are in the mempool, and A is already at the descendant limit (101KvB). {X, Y, Z} is a package where X conflicts with B and will replace {B, C}. However, when we run descendant limit checks, it will look like A's descendants include {B, C, X, Z} and reject it. But actually A's descendants will only include {X, Z} after the replacement.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:31:01Z",
      "diff_hunk" : "@@ -975,13 +1006,89 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873799952",
      "id" : 873799952,
      "in_reply_to_id" : 868495787,
      "line" : 1026,
      "node_id" : "PRRC_kwDOABII5840FSEQ",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 1026,
      "original_position" : 221,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 211,
      "pull_request_review_id" : 974037959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873799952/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:36:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873799952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873809115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873809115"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah good point, I forgot I had moved this to the bottom of PreChecks.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:38:52Z",
      "diff_hunk" : "@@ -928,6 +952,9 @@ bool MemPoolAccept::ReplacementChecks(Workspace& ws)\n     const uint256& hash = ws.m_hash;\n     TxValidationState& state = ws.m_state;\n \n+    m_rbf = ws.m_conflicts.size() > 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873809115",
      "id" : 873809115,
      "in_reply_to_id" : 868503310,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840FUTb",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 955,
      "original_position" : 156,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 974075624,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873809115/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:38:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873809115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873820419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873820419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think it could be a limitation for second-layer package issuers, where a child-with-parents package aims to replace more than 5 LN commitment transactions at the same time. A counterparty could extend the 5 non-related commitment transactions descendants until reaching max in-mempool limits, thus interfering with their potential package-RBF.\r\n\r\nYeah, batching multiple commitment transaction replacements isn't very safe. That's why we have the \"Warning: Batched fee-bumping may be unsafe for some use cases. Users and application developers should take caution if utilizing multi-parent packages.\" in the [doc](https://github.com/bitcoin/bitcoin/blob/master/doc/policy/packages.md#package-mempool-acceptance-rules).\r\n\r\n> I believe this issue can unfortunately arise even when you're replacing a single LN commitment transaction.\r\n\r\nI don't think this scenario is possible with our current mempool policy. With our descendant limit at 25,  `anchorTxAlice` wouldn't be able to have 100 children.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T14:47:38Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.\n+\n+4. The package fee after deduplication pays an absolute fee of at least the sum paid by the\n+   original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth after deduplication at or\n+   above the rate set by the node's incremental relay feerate. For example, if the incremental relay\n+   feerate is 1 satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the\n+   package fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873820419",
      "id" : 873820419,
      "in_reply_to_id" : 868533379,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840FXED",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 143,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 974093538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873820419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T14:47:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873820419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873852659"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873852659"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Unfortunately, no, `previousWalletTx` cannot be used as one of the parents; all of `anchorTxBob`'s inputs need to be confirmed.\r\n\r\nThis is an extension of BIP 125 Rule 2. I currently don't know a safe way to remove that rule. #23121 was an attempt, but also unsafe. Very sorry :(\r\n\r\n",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T15:16:00Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873852659",
      "id" : 873852659,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840Fe7z",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 974140337,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873852659/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-16T15:16:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873852659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873854502"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873854502"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes you're right. Thanks for the feedback and clear explanation, adding some similar language to the doc!",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-16T15:17:45Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r873854502",
      "id" : 873854502,
      "in_reply_to_id" : 869137839,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII5840FfYm",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 126,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 34,
      "pull_request_review_id" : 974143032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873854502/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-05-16T15:17:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/873854502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r875569716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875569716"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Gotcha, thanks for the confirmation, we'll deal with that limitation then, it's already a good start. And hopefully we'll eventually figure out better RBF rules for both single txs and packages!",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-18T07:41:31Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r875569716",
      "id" : 875569716,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840MCI0",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 976493853,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875569716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-18T07:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/875569716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r878468366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878468366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Sorry for my earlier comment, I was confused)\r\n\r\n> If we include previousWalletTx in the package, this package-rbf would work, right?\r\n\r\nYes. It's fine because it's one of the direct parents of `anchorTxBob`.\r\n\r\n> But if we don't include previousWalletTx in the package, this would be rejected?\r\n\r\nIf you mean `anchorTxBob` now only has 1 unconfirmed input, `commitTxBob`, actually this would be accepted.\r\n\r\nIf you mean that `previousWalletTx` was submitted ahead of time, that should still be okay because the code will remember to exempt `previousWalletTx` from the \"no new unconfirmed\" rule.\r\n\r\n> But what if previousWalletTx itself has an unconfirmed parent?\r\n\r\nBased on this rule, if `previousWalletTx` has another unconfirmed parent, this would be rejected.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-20T19:00:15Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r878468366",
      "id" : 878468366,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840XF0O",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 980563664,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878468366/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-20T19:00:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/878468366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r880098512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/880098512"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the clarification! I'll create extensive tests of this behavior and will report back.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-05-24T06:18:49Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r880098512",
      "id" : 880098512,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5840dTzQ",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 982646813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/880098512/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-05-24T06:18:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/880098512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@t-bast \r\n\r\n> to have 100 outputs and broadcast one child tx per output, you're already hitting the 100 transactions limit...\r\n\r\nThey cannot create this chain to begin with as from any single unconfirmed transaction with confirmed parents, you can only make 25 transactions.\r\n\r\nSo if you for example had >4 commitment transactions that you want to CPFP with a single bump transaction, this is where the limit can be hit.",
      "created_at" : "2022-06-02T19:58:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145285891",
      "id" : 1145285891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585EQ60D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145285891/reactions"
      },
      "updated_at" : "2022-06-02T19:58:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145285891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> They cannot create this chain to begin with as from any single unconfirmed transaction with confirmed parents, you can only make 25 transactions.\r\n\r\nRight, I had forgotten that restriction! However, this 25 descendants chain limit is only a configuration parameter on bitcoind, not a BIP 125 requirement, right? So in theory we cannot fully rely on it, nothing prevents an attacker to inject a 100 descendants chain in miners mempools if they have configured their bitcoind differently (or even use a different implementation)?",
      "created_at" : "2022-06-02T22:26:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145404055",
      "id" : 1145404055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585ERXqX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145404055/reactions"
      },
      "updated_at" : "2022-06-02T22:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145404055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@t-bast unlikely but true, seems like something to consider scaling with other policies to be more robust?",
      "created_at" : "2022-06-02T23:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145431949",
      "id" : 1145431949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585EReeN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145431949/reactions"
      },
      "updated_at" : "2022-06-02T23:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145431949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> this 25 descendants chain limit is only a configuration parameter on bitcoind, not a BIP 125 requirement\r\n\r\nNote that BIP 125 enforcement could be considered a configuration parameter too -- eg knots nodes will allow replacement of any tx, whether they signal or not.\r\n\r\nPerhaps something we could consider is defining a service bit to correspond with a relay policy, and have nodes preferential peer with other nodes who set that bit; that way you're more likely for nodes that support a particular policy to form a fully connected graph, and thus have a path to any miners that also accept that relay policy. Knots defines an experimental service bit for full-RBF nodes https://github.com/bitcoinknots/bitcoin/blob/23.x-knots/src/init.cpp#L1103 . ",
      "created_at" : "2022-06-02T23:49:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1145451225",
      "id" : 1145451225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585ERjLZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145451225/reactions"
      },
      "updated_at" : "2022-06-02T23:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1145451225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889005663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889005663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since we are introducing a new form of RBF that doesn't currently exist, now might be the best time to at least improve the BIP 125 rules to be incentive compatible in all situations (though this comes at the cost of making replacements potentially more expensive).\r\n\r\nIn particular what I have in mind is that we require the ancestor feerate of the child transaction to be higher than the actual feerate of all transactions that would be evicted. This is conservative but I think would ensure that we don't have any situations where there are transactions being replaced that might appear in the next block, while the new transactions do not.\r\n\r\nWould this be too conservative for the use cases that we have in mind?",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T14:36:20Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889005663",
      "id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_SZf",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995003793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889005663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T14:36:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889005663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889037679"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889037679"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can you elaborate with an example? It's possible I don't have the same mental mapping to terms and do not understand the scenario.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T15:11:26Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889037679",
      "id" : 889037679,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_aNv",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995049541,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889037679/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T15:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889037679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889064935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889064935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure -- consider the case where you have a transaction A(100vb, 1sat/vb) and child B (100vb, 10sat/vb) in the mempool.  Total fees = 1100 sat.\r\n\r\nA package comes in with parent A'(100vb, 1sat/vb) and child B'(1000vb, 2.5sat/vb).  Total package fees = 2600 sat.\r\n\r\nUnder the rules described here, package (A', B') could replace (A, B) in the mempool, because total fees are paid for and there's enough left over fee to pay the incremental relay fee of the new package (1500 sat/1100 vb). Also the package feerate is higher than that of the direct conflicts[1].\r\n\r\nThe deficiency in the logic is that we're not looking at the feerates of the transactions that would be evicted -- even though their absolute fee is being paid, their feerate could be even higher than the transactions that would replace them.  Calculating the effective feerate that such a transaction would have in our mining code is tricky (because a sibling could pay for an ancestor, it's not quite right to just consider ancestor feerate), but using its feerate is a conservative check here -- any descendant that is paying for its confirmation would be caught in this logic, and its (higher) feerate considered if necessary.\r\n\r\nFor evaluating the mining suitability of the new transactions coming in, I think we can just look at the ancestor feerate of the package, which is a lower bound on the attractiveness of the new transactions.  (I think this would also allow us to relax the rule against new unconfirmed inputs.)\r\n\r\n[1] In looking at this example, I noticed that BIP 125 as drafted seems to misstate an important check we perform in our current RBF policy, namely that we compare the feerate of a new transaction coming in to the feerate of the existing transactions that it directly conflicts with.  (Without this check, a small high fee transaction could be replaced by a large low fee transaction!). From my first glance at the code in this PR, it looks like the code itself does a similar check for packages (comparing the package feerate to the feerate of the direct conflicts) so that is good at least, but the description of the logic in the documentation should point out that there is some feerate check happening as well.\r\n\r\n",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T15:44:22Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889064935",
      "id" : 889064935,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_g3n",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995088589,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889064935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T16:01:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889064935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889076418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889076418"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's ancient lore by now, but I'm not sure it's a \"mis-statement\" or just incentive incompatible stuff no one implements(becase feerate check is cheap). I agree with your reading of current texts either way and agree pulling that into the text is the right thing to do. ",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-03T15:58:32Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r889076418",
      "id" : 889076418,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5840_jrC",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 995104339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889076418/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-03T15:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/889076418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r898197226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/898197226"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> require the ancestor feerate of the child transaction to be higher than the actual feerate of all transactions that would be evicted. This is conservative but I think would ensure that we don't have any situations where there are transactions being replaced that might appear in the next block, while the new transactions do not.\r\n\r\nI think this is a sensible addition. I cannot think of any easy attacks since it's only the directly conflicting transactions and not their descendants (i.e. I don't have the concerns stated in https://github.com/bitcoin/bitcoin/pull/23121#issuecomment-1004774370).\r\n\r\nBtw, don't we want min(package feerate, child ancestor feerate)?\r\n\r\nIn pseudocode for a child-with-unconfirmed-parents package: \r\n```\r\nfor each tx in directly_conflicting_transactions:\r\n    if min(package_feerate, child.ancestor_feerate) <= tx.individual_feerate\r\n        fail\r\n```\r\n\r\nWith this, do you think it would be acceptable to remove the \"no new unconfirmed inputs\" rule in package RBF?\r\n\r\n\r\n> we compare the feerate of a new transaction coming in to the feerate of the existing transactions that it directly conflicts with\r\n\r\nRight, this wasn't in BIP 125. I also misinterpreted that part of the code to be part of the other fee-related rules and just a \"fail fast\" piece of logic, and didn't include it in # #23711 either (gah!). Just opened #25382 to add test coverage for it in isolation + add it to doc/policy/replacements.md",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-15T16:38:13Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r898197226",
      "id" : 898197226,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5841iWbq",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1007815154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/898197226/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-15T16:38:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/898197226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r901614084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901614084"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> it's only the directly conflicting transactions and not their descendants\r\n\r\nCould you clarify that? I'm not sure whether @sdaftuar's example contradicts this claim or not.\r\n\r\nLet's consider a mempool containing transaction A (1000vb, 1sat/vb), child B (1000vb, 10sat/vb) and grand-child C (100vb, 100sat/vb).\r\n\r\nIf we want to replace this with a package containing transaction A' (1000vb, 1sat/vb) and child B' (1000vb, 20sat/vb), would that work? Or would we be forced to match the 100 sat/vb of grand-child C (since @sdaftuar says the ancestor feerate of that package must be higher than the _actual_ feerate of _all_ transactions that would be evicted)? If so, that would be an issue, an attacker could always put a low-fee high-feerate descendant to make it very expensive to replace the first transaction in the chain, can't they?\r\n\r\n",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-20T12:34:46Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r901614084",
      "id" : 901614084,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5841vYoE",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1012200644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901614084/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-20T12:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901614084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I have added a first set of tests to eclair that exercise the package-rbf logic: https://github.com/ACINQ/eclair/commit/4f583b5725cba6594388d54c0b31affc1bf8cddf\r\n\r\nI extracted the transactions as test vectors here: https://gist.github.com/t-bast/7c553e61ff2bee3720ff4f7db04cc1b3\r\nI'm not sure how easy it will be to translate them to bitcoin core tests, you'll need to re-generate some of the inputs and re-sign the commit transactions. The file should have all the required data, but it may be quite painful still...\r\n\r\nThe third test vector triggers the following error: `Internal bug detected: \"it != package_result.m_tx_results.end()\"`",
      "created_at" : "2022-06-21T14:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1161852823",
      "id" : 1161852823,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585FQHeX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161852823/reactions"
      },
      "updated_at" : "2022-06-21T14:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1161852823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r902725385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902725385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's looking good with the current state of the PR, I am able to include new unconfirmed inputs that themselves have an unconfirmed parent as shown by [this test](https://gist.github.com/t-bast/7c553e61ff2bee3720ff4f7db04cc1b3#batching-commitment-fee-bump) :+1: ",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-21T14:53:12Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r902725385",
      "id" : 902725385,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5841zn8J",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1013757208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902725385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-06-21T14:53:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902725385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r902757779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902757779"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> > require the ancestor feerate of the child transaction to be higher than the actual feerate of all transactions that would be evicted. This is conservative but I think would ensure that we don't have any situations where there are transactions being replaced that might appear in the next block, while the new transactions do not.\r\n> \r\n> I think this is a sensible addition. I cannot think of any easy attacks since it's only the directly conflicting transactions and not their descendants (i.e. I don't have the concerns stated in [#23121 (comment)](https://github.com/bitcoin/bitcoin/pull/23121#issuecomment-1004774370)).\r\n\r\nAh, in writing this I overlooked what you had written up in that comment and forgot about that concern.  When I commented before I did indeed mean to suggest that we'd compare our estimated mining score of the new child transaction (`min(package feerate, ancestor feerate)` as you say) with the actual feerate of all the transactions that would be evicted, and not just the direct conflicts -- if we only compare to the feerate of direct conflicts, then I believe it is still possible for a transaction that would be included in the next block to be replaced by a transaction that will confirm much later.\r\n\r\nHowever now you have reminded me of the other concern, which is that a high actual feerate (but low ancestor feerate) transaction could be used to pin a package and make it difficult to evict.  I'm not sure what to do about this!  \r\n\r\nPerhaps a simple, good enough approach might be to require that the child transaction's score is better than the ancestor feerate of all the transactions that would be evicted, and the actual feerates of the direct conflicts?  I just think we should do something to ensure that a new transaction package isn't strictly worse than something that would be evicted.  We'd still be missing the case where something being evicted has a lower ancestor score than its actual mining score because of an unrelated transaction that is paying for a low feerate parent, but maybe that is an edge case that we can overlook (especially since the total fees in the mempool are still going up and the first order approximation of mining desirability is also going up).  \r\n\r\nI was trying to think about whether this approach might be attackable in some way to either muck with fee estimation or attack someone's mempool with low quality transactions, but I need to give it more thought.\r\n\r\nAn alternate approach to this problem might be to define some new (opt in) relay policy that limits the scope of descendant transactions in some way, and then only implement a package RBF policy that would interact with transactions that meet that limited criteria.  That might be a good direction to go if our broader attempts at this problem result in behavior that's not incentive compatible..?\r\n",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-21T15:20:47Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r902757779",
      "id" : 902757779,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5841zv2T",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1013804318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902757779/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-21T15:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/902757779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r903654520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/903654520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Perhaps a simple, good enough approach might be to require that the child transaction's score is better than the ancestor feerate of all the transactions that would be evicted, and the actual feerates of the direct conflicts?\r\n\r\nTo my understanding of this dual-criteria approach (better ancestor score than the set of evicted transactions and better feerate of the direct conflicts) I'm not sure it's robust against pinning attackers.\r\n\r\nLet's say you have a mempool containing parent A (1000vb, 1 sat/vb), parent B (1000vb, 2 sat/vb) and child C (100vb, 20 sat/vb). You would like to replace C with newer transaction C' (100vb, 10 sat/vb) spending parent A and parent D (1000vb, 20 sat/vb). While the ancestor score of C' is better than C, the feerate is far less compelling and it should be rejected by the mempool. However, the low-ancestor score child C should not be mined for a while and the pin succeeds, if this scenario is correct.\r\n\r\n> An alternate approach to this problem might be to define some new (opt in) relay policy that limits the scope of descendant transactions in some way, and then only implement a package RBF policy that would interact with transactions that meet that limited criteria.\r\n\r\nI don't know if any opt-in approach limiting the size of the package (both ancestors/descendants) is compatible with miners incentives. I think a pinning attacker would be always able to attach an ancestor beyond the limit downgrading the high-feerate replacement candidate ancestor score.\r\n\r\nI'm not sure if we have considered other scoring approach like best-ancestor-score of the latest generation of package transactions. I.e, if you have parent A, parent B and child C and grandchild D, and you would like to replace with new package parent A, parent E and child C' you evaluate ancestor score of C' against grandchild D. I think it could be a correct answer to the miner viewpoint \"Which competing chain of transactions is the most interesting to include ?\". Though I don't know if it's fully incentive compatible.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-22T12:00:25Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r903654520",
      "id" : 903654520,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII58413Kx4",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1015048923,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/903654520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-22T12:00:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/903654520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r907576864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907576864"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">  When I commented before I did indeed mean to suggest that we'd compare our estimated mining score of the new child ...\r\n> However now you have reminded me of the other concern, which is that a high actual feerate (but low ancestor feerate) transaction could be used to pin a package and make it difficult to evict. I'm not sure what to do about this!\r\n\r\nMy bad about misunderstanding your original suggestion! Yes, this is my concern with it and I'm glad you agree.\r\n\r\n> Perhaps a simple, good enough approach might be to require that the child transaction's score is better than the ancestor feerate of all the transactions that would be evicted, and the actual feerates of the direct conflicts?\r\n\r\nI think this would be fine, definitely an improvement upon our current logic. I can't really think of a strong attack, will think about it more.\r\n\r\n> Let's say you have a mempool containing parent A ...\r\n> While the ancestor score of C' is better than C, the feerate is far less compelling and it should be rejected by the mempool.\r\n\r\nIIUC since we use the minimum of ancestor feerate and individual feerate, this example doesn't break it, since we'd use `C'`'s individual feerate of 10sat/vB to compare to `C`'s individual feerate of 20sat/vB.\r\n\r\nThe natural \"attack\" scenario might be:\r\nA counterparty broadcasts their tx A (which we'll want to replace). They also broadcast an unrelated high-fee tx B (50sat/vB), and a child C which spends from A and B. Since C spends from B, it has a high ancestor feerate (even though they wouldn't be mined together), and is thus harder to replace. But since B is high feerate, it will be mined soon, so we're probably fine.\r\n\r\n> An alternate approach to this problem might be to define some new (opt in) relay policy that limits the scope of descendant transactions in some way, and then only implement a package RBF policy that would interact with transactions that meet that limited criteria. That might be a good direction to go if our broader attempts at this problem result in behavior that's not incentive compatible..?\r\n\r\nI'm now pretty convinced that opt-in shrinking ancestor/descendant limits is the way to go (ping @instagibbs who had ideas about this being necessary in the future). Maybe we start allowing nVersion=3 (or whatever signal we decide) and it doubles as a signal for package RBF and stricter limits (and BIP 125 signaling would not be used for package RBF).\r\n\r\nA few questions:\r\n\r\n- Is it possible to have single transaction limits as well (e.g. a single transaction cannot be more than 10KvB)? If so, that seems simpler than restricting descendants based on the size of the original transaction. Or would that be a bad idea, since it would also imply fewer possible in-flight HTLCs?\r\n- In this policy, I think we would want to require \"any tx spending from an unconfirmed nVersion=3 tx must also be nVersion=3?\" And if a nVersion=3 transaction has ancestors that aren't nVersion=3, we'd use the stricter limits? Following that, I guess we would also need \"any tx replacing an nVersion=3 tx must also be nVersion=3?\"\r\n- Assuming we can figure out something sensible, it seems better to have both ancestor and descendant limits? Adding descendant limits resolves the \"you must pay for all conflicts\" type of pinning. But adding an ancestor limit could be beneficial in resolving the \"create a replacement tx with a giant ancestor\" type pinning.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-27T16:30:42Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r907576864",
      "id" : 907576864,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842GIYg",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1020463621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907576864/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-27T16:30:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907576864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r907628486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907628486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've posted this privately in a few places, but here's a likely incomplete discussion of the opt-in limit reduction discussion, aimed at LN/eltoo problems, but by no means limited to them: https://gist.github.com/instagibbs/b3095752d6289ab52166c04df55c1c19\r\n\r\n\"complete package\" limits seem to be inherent to any usable solution",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-27T17:29:45Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r907628486",
      "id" : 907628486,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842GU_G",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1020539586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907628486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-27T17:29:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/907628486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r908996095"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/908996095"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Assuming we can figure out something sensible, it seems better to have both ancestor and descendant limits? Adding descendant limits resolves the \"you must pay for all conflicts\" type of pinning. But adding an ancestor limit could be beneficial in resolving the \"create a replacement tx with a giant ancestor\" type pinning.\r\n\r\nYeah I was thinking in this direction as well.  I wonder if we could find some super minimal use case, like a 2-transaction package replacing another 2-transaction package, and just implement that to start.  I think the rough idea would be:\r\n- some opt-in flag (eg nVersion=3, or anything else) indicates that a transaction can't have more than 1 in-mempool descendant with no more than X vbytes of total size.  Any descendant is also not allowed to have more than 1 ancestor.\r\n- When a 1-child, 1-parent package comes in, if it conflicts with at most 1 opt-in package, allow for RBF semantics along the lines of what we're discussing. In this case, I think we would require the package feerate to be greater than the ancestor feerates of both transactions that would be replaced (along with the total fee check, and the incremental relay fee check).\r\n\r\nWould there be value to any layer 2 projects if something this minimal were to be implemented?  ",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-28T21:37:48Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r908996095",
      "id" : 908996095,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842Li3_",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1022474615,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/908996095/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-28T21:37:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/908996095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909245000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909245000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This would be very valuable for lightning. @instagibbs has explored that space recently.\r\n\r\nA single descendant is too limiting though: in the lightning case, each participant has its own anchor output, so we need to allow 2 descendants if we apply that rule to the commitment transaction.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-29T06:30:29Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909245000",
      "id" : 909245000,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842MfpI",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1022798326,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909245000/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-29T06:30:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909245000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909507429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909507429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> [1] In looking at this example, I noticed that BIP 125 as drafted seems to misstate an important check we perform in our current RBF policy, namely that we compare the feerate of a new transaction coming in to the feerate of the existing transactions that it directly conflicts with.\r\n\r\nPerhaps we should aim for a new rbf bip that describes bitcoin core's actual policy for both rbf of single txs and packages of txs, and document that we implement the new bip, and not 125?",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-29T11:18:15Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909507429",
      "id" : 909507429,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842Nftl",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1023167805,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909507429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-29T11:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909507429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909641486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909641486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To recap my thoughts:\r\n\r\n0) I really think this direction is somewhere we need to go. The fact that in my sketches I can *get rid of carveout*, and naively support N-party contracts speaks to me that we're on the right path. The fact it makes simple systems like batched payouts potentially more robust is also a win.\r\n\r\n1) I am 99% sure we want to limit *entire* package limits to make rule#3 pinning not a kill shot for replacement replacement\r\n\r\n2) @t-bast  Ephemeral dust, or dust values that are immediately spent within the package, enable LN and other systems to switch over to a single anchor output, obviating the requirement for carveout rules, and would fit within the one-parent-one-child pattern.\r\n\r\nWe could expand this to two direct children limit, and preserve the carveout to make sure currently deployed systems get benefits, assuming it's not otherwise a DoS/incentive compatible issue\r\n\r\n3) Another nice-to-have would be forced signaling of replacability of the child tx, since the single-anchor spend is mostly freeform. We can work around this via \"0 CSV OP_1ADD\" scriptpubkey which forces RBF signaling, but something to consider. Full RBF solves this longer term as well.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-29T13:34:33Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909641486",
      "id" : 909641486,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842OAcO",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1023374053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909641486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-29T13:34:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909641486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909654053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909654053"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> @t-bast Ephemeral dust, or dust values that are immediately spent within the package, enable LN and other systems to switch over to a single anchor output, obviating the requirement for carveout rules, and would fit within the one-parent-one-child pattern.\r\n\r\n:100: \r\n\r\n> We could expand this to two direct children limit, and preserve the carveout to make sure currently deployed systems get benefits, assuming it's not otherwise a DoS/incentive compatible issue\r\n\r\nDon't bother if it's only for lightning, since we'll need a (small) change on the commitment transaction format to benefit from it, we might as well directly switch to a single anchor output.",
      "commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "created_at" : "2022-06-29T13:44:39Z",
      "diff_hunk" : "@@ -117,3 +118,36 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package only include an unconfirmed input if that input was included in\n+   one of the directly conflicting transactions or is from another transaction in the package. This\n+   rule applies to the transactions that do not directly conflict with any mempool transactions.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+\n+5. The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r909654053",
      "id" : 909654053,
      "in_reply_to_id" : 889005663,
      "line" : 148,
      "node_id" : "PRRC_kwDOABII5842ODgl",
      "original_commit_id" : "da7cc60fb59f8cd366312af7bc6f3b7fe4f5c82a",
      "original_line" : 148,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 56,
      "pull_request_review_id" : 1023391629,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909654053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-06-29T13:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/909654053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-06-30T16:47:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1171454489",
      "id" : 1171454489,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585F0voZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171454489/reactions"
      },
      "updated_at" : "2022-06-30T16:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171454489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Apologies for the delay, I am rebasing + working on the following:\r\n\r\n- Some unit tests for RBF code\r\n- Adding an ancestor feerate rule https://github.com/bitcoin/bitcoin/pull/25038#discussion_r907576864\r\n- Adding a set of rules for nVersion=3, i.e. stricter ancestor/descendant limits, inheritance, signaling for RBF, etc. https://github.com/bitcoin/bitcoin/pull/25038#discussion_r908996095 Won't be a finalized proposal, I'm hoping that having code written will help us iterate on what those rules should be.\r\n\r\nWill update soon!",
      "created_at" : "2022-07-08T09:50:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1178787330",
      "id" : 1178787330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585GQt4C",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1178787330/reactions"
      },
      "updated_at" : "2022-07-08T09:50:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1178787330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924626968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924626968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "All of the directly conflicting transactions already in mempool?",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:10:14Z",
      "diff_hunk" : "@@ -117,3 +118,63 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. The package is child-with-parents.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages.\n+\n+However, allowing replacement for all ancestor packages also might not make sense due to the\n+increased complexity.\n+\n+2. At least one of the following signaling conditions is met:\n+\n+    1a. All of the directly conflicting transactions signal BIP125 replaceability explicitly.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924626968",
      "id" : 924626968,
      "line" : 136,
      "node_id" : "PRRC_kwDOABII5843HLAY",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 136,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 44,
      "pull_request_review_id" : 1043617508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924626968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924626968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924636307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924636307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "replaced",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:15:33Z",
      "diff_hunk" : "@@ -117,3 +118,63 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. The package is child-with-parents.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages.\n+\n+However, allowing replacement for all ancestor packages also might not make sense due to the\n+increased complexity.\n+\n+2. At least one of the following signaling conditions is met:\n+\n+    1a. All of the directly conflicting transactions signal BIP125 replaceability explicitly.\n+\n+        *Rationale*: Any transaction that is replaceable without package RBF should still be\n+        replaceable.\n+\n+    1b. All directly conflicting transactions have `nVersion=3` and each package transaction that\n+        conflicts with a mempool transaction also has `nVersion=3`.\n+\n+        *Rationale*: This helps preserve the mempool policy that any transaction spending an\n+        unconfirmed `nVersion=3` transaction must also have `nVersion=3`. Otherwise, the child of a\n+        `nVersion=3` transaction could be replaced by a non-`nVersion=3` transaction, and thus there\n+        would be an `nVersion=3` transaction in the mempool with a non-`nVersion=3` child.\n+\n+        *Rationale*: Since V3 is inherited, this form of RBF signaling is implicitly inherited. That is,\n+        while a V3 transaction is unconfirmed, any descendant(s) accepted to the mempool must also be\n+        V3 and are thus also replaceable.\n+\n+3. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+4. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+5. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+   The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual\n+transactions](./mempool-replacements.md), treating the package (after deduplication) as one\n+composite transaction. This works because all of the transactions in a\n+child-with-unconfirmed-parents package are in the ancestor set of the child transaction.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924636307",
      "id" : 924636307,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII5843HNST",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 180,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 88,
      "pull_request_review_id" : 1043617508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924636307/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924636307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924649289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924649289"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe this falls short in that the parent V3 transaction can be just south of 101kvB, even in ANYONECANPAY and SIGHASH_SINGLE like scenarios where additional inputs cannot be excluded by the presigning parties.\r\n\r\nIn imprecise language, this is what I expect to be required to solve it: \"When evaluating a V3 transaction, if its total mempool package size after entry into the mempool would exceed 4000 virtual bytes, it is rejected.\"",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:24:30Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924649289",
      "id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843HQdJ",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1043617508,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924649289/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:27:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924649289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924672736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924672736"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, same as here: https://github.com/bitcoin/bitcoin/blob/master/doc/policy/mempool-replacements.md#current-replace-by-fee-policy\r\n> A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they spend one or more of the same inputs.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:43:39Z",
      "diff_hunk" : "@@ -117,3 +118,63 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. The package is child-with-parents.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages.\n+\n+However, allowing replacement for all ancestor packages also might not make sense due to the\n+increased complexity.\n+\n+2. At least one of the following signaling conditions is met:\n+\n+    1a. All of the directly conflicting transactions signal BIP125 replaceability explicitly.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924672736",
      "id" : 924672736,
      "in_reply_to_id" : 924626968,
      "line" : 136,
      "node_id" : "PRRC_kwDOABII5843HWLg",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 136,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 44,
      "pull_request_review_id" : 1043673914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924672736/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:43:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924672736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924673763"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924673763"
         }
      },
      "author_association" : "MEMBER",
      "body" : "same as here: https://github.com/bitcoin/bitcoin/blob/master/doc/policy/mempool-replacements.md#current-replace-by-fee-policy\r\n\r\nWould it be more clear if I change the terms, or repeat them in this doc?",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:44:38Z",
      "diff_hunk" : "@@ -117,3 +118,63 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. The package is child-with-parents.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages.\n+\n+However, allowing replacement for all ancestor packages also might not make sense due to the\n+increased complexity.\n+\n+2. At least one of the following signaling conditions is met:\n+\n+    1a. All of the directly conflicting transactions signal BIP125 replaceability explicitly.\n+\n+        *Rationale*: Any transaction that is replaceable without package RBF should still be\n+        replaceable.\n+\n+    1b. All directly conflicting transactions have `nVersion=3` and each package transaction that\n+        conflicts with a mempool transaction also has `nVersion=3`.\n+\n+        *Rationale*: This helps preserve the mempool policy that any transaction spending an\n+        unconfirmed `nVersion=3` transaction must also have `nVersion=3`. Otherwise, the child of a\n+        `nVersion=3` transaction could be replaced by a non-`nVersion=3` transaction, and thus there\n+        would be an `nVersion=3` transaction in the mempool with a non-`nVersion=3` child.\n+\n+        *Rationale*: Since V3 is inherited, this form of RBF signaling is implicitly inherited. That is,\n+        while a V3 transaction is unconfirmed, any descendant(s) accepted to the mempool must also be\n+        V3 and are thus also replaceable.\n+\n+3. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+4. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+5. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+   The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual\n+transactions](./mempool-replacements.md), treating the package (after deduplication) as one\n+composite transaction. This works because all of the transactions in a\n+child-with-unconfirmed-parents package are in the ancestor set of the child transaction.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924673763",
      "id" : 924673763,
      "in_reply_to_id" : 924636307,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII5843HWbj",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 180,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 88,
      "pull_request_review_id" : 1043675337,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924673763/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:44:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924673763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924683437"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924683437"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Happy to change this of course, but just want to clarify what you're suggesting.\r\n\r\n> In imprecise language, this is what I expect to be required to solve it: \"When evaluating a V3 transaction, if its total mempool package size after entry into the mempool would exceed 4000 virtual bytes, it is rejected.\"\r\n\r\nI interpret this to mean that we should change both ancestor and descendant limits to 4000vB. This also means an individual V3 tx is not allowed to be more than 4000vB by itself. So in the LN case, a commitment tx isn't allowed to be more than 4000vB. I believe this would necessitate lowering the max in-flight HTLC limit. Is that accurate and if so, is it ok?",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:53:34Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924683437",
      "id" : 924683437,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843HYyt",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1043689319,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924683437/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T15:53:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924683437",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924689587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924689587"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Your comment seems correct. Will have to think about this some more with respect to the case today.\r\n\r\nedit: Looks like that works out to ~85 HTLC outputs or so naively in the layered commitment style setting",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-19T15:59:17Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r924689587",
      "id" : 924689587,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843HaSz",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1043697896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924689587/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-19T16:17:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/924689587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925104761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925104761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I believe this falls short in that the parent V3 transaction can be just south of 101kvB,\r\n\r\nCorrect me if I'm wrong, but I think this case would be something like: you're trying to confirm tx A which pays no fees itself; your counterparty publishes a package of tx A, B and C; C spends both A and B; A and C are both small, but B is 99kvB with an ephemeral output that is spent by C. You can't replace C without also replacing B because of the ephemeral output.\r\n\r\nWhat you could do, if the ephemeral output is anyone can spend, is replace C in two steps: one that creates tx D that spends B's ephemeral output (it's anyone can spend), which costs you C's fees plus epsilon; then you create tx E that spends A with your desired feerate. So you're paying ~100kvB at the \"backlog\" rate here. \r\n\r\nWith a 4kvB \"related txs\" limit, I think the worst case setup is just A is small (100vB) and is spent by B which is large (3900vB), so you have to pay at least 3.9kvB at the backlog rate plus epsilon to replace it with something smaller, but that's clearly already 25x better. Even if the backlog rate is not much smaller than the next block rate, you're only overpaying by at most 39x rather than perhaps 1000x here.\r\n\r\n> I interpret this to mean that we should change both ancestor and descendant limits to 4000vB. \r\n\r\nHmm, I think the worst case scenario here would still be bad:\r\n\r\n * A is spent by {B1,..,B20} (descendent count = 21 so less than 25)\r\n * B1 also spends C1, B2 also spends C2, etc; all via ephemeral outputs\r\n * A, Bn are 100vB each; Cn is 3800vB each\r\n\r\nA has a descendent size of 2100vB; Bn has an ancestor size of 4000vB and a descendent size of 100vB; Cn has a descendent size of 3900vB. So the 4000vB restriction is okay.\r\n\r\nBut replacing A thus means Bn are invalid, which then means Cn are invalid due to the now unspent ephemeral outputs, which means you're replacing 78kvB in the mempool, not just 4kvB.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-20T02:24:37Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925104761",
      "id" : 925104761,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843I_p5",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1044303782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925104761/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-20T02:24:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925104761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925333875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925333875"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ajtowns Note that ephemeral outputs aren't proposed here, just the anc/desc limits.\r\n\r\nAlso note that V3 descendant count is limited to 2 (i.e. a V3 transaction can only have 1 descendant), so A can't be spent by {B1...B20}. But of course B1 could spend a bunch of things, up to {C1...C23}.\r\n\r\nGood point that with ephemeral outputs replacing a child means we need to remove the parent as well. I'm experimenting with implementing it, and my idea was to require the parent (the one with the dust output) pay 0 fee so it can't stay in the mempool by itself. We'd still want to prevent replacing a large volume of transactions (i.e. include it in the RBF 100 limit), but users/devs don't have to worry about high costs of replacement since its fee is 0?\r\n\r\nI'm thinking about ephemeral outputs but hoping to minimize the scope of this proposal. Correct me if I'm wrong, but it seems ephemeral outputs are not needed to make package relay work for LN penalty without pinning attacks. We could do ephemeral outputs as a next step - IIUC ephemeral outputs would be a \"loosening\" of policy rules so we could add it on to V3 rules later?",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-20T08:37:48Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925333875",
      "id" : 925333875,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843J3lz",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1044641067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925333875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-20T08:37:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925333875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925605697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925605697"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ephemeral outputs for ln-penalty are nice but definitely a stretch goal. I'm assuming some form exists for eltoo.\r\n\r\nKeeping inline with what is proposed here:\r\n\r\nFor eltoo purposes, there's no reason we cannot restrict each presigned transaction to having a single input only, and only the one ephemeral anchor for spending. Whenever a proper replacement for rule#3 is figured out, the one-input restriction could be relaxed for eltoo construction, and more typical ANYONECANPAY constructions likely work after this as well.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-20T13:26:36Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925605697",
      "id" : 925605697,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843K59B",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1045028017,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925605697/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-20T13:29:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925605697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925639336"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925639336"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">  But replacing A thus means Bn are invalid, which then means Cn are invalid due to the now unspent ephemeral outputs, which means you're replacing 78kvB in the mempool, not just 4kvB.\r\n\r\nTo be clear, as long as we have sane DoS limits in place, to the RBF-ing party, they don't care about these extra bytes as they wouldn't be paying for those additional bytes(by package CPFP logic already in place, the child is already paying for parent). These further-restricted limits are not about stopping network DoS, but about pinning.\r\n\r\nedit: Ok, the marginal DoS is there unless you ensure the dust-having transactions are unattractive to mine on their own, which 0-fee is definitely sufficient to do.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-20T13:55:39Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r925639336",
      "id" : 925639336,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843LCKo",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1045076631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925639336/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-20T14:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925639336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r931306607"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931306607"
         }
      },
      "author_association" : "MEMBER",
      "body" : "being explicit is always better imo",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-27T17:08:39Z",
      "diff_hunk" : "@@ -117,3 +118,63 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. The package is child-with-parents.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages.\n+\n+However, allowing replacement for all ancestor packages also might not make sense due to the\n+increased complexity.\n+\n+2. At least one of the following signaling conditions is met:\n+\n+    1a. All of the directly conflicting transactions signal BIP125 replaceability explicitly.\n+\n+        *Rationale*: Any transaction that is replaceable without package RBF should still be\n+        replaceable.\n+\n+    1b. All directly conflicting transactions have `nVersion=3` and each package transaction that\n+        conflicts with a mempool transaction also has `nVersion=3`.\n+\n+        *Rationale*: This helps preserve the mempool policy that any transaction spending an\n+        unconfirmed `nVersion=3` transaction must also have `nVersion=3`. Otherwise, the child of a\n+        `nVersion=3` transaction could be replaced by a non-`nVersion=3` transaction, and thus there\n+        would be an `nVersion=3` transaction in the mempool with a non-`nVersion=3` child.\n+\n+        *Rationale*: Since V3 is inherited, this form of RBF signaling is implicitly inherited. That is,\n+        while a V3 transaction is unconfirmed, any descendant(s) accepted to the mempool must also be\n+        V3 and are thus also replaceable.\n+\n+3. The child transaction does not conflict with any transactions in the mempool.\n+\n+*Rationale*: Reduce complexity. Package RBF is intended for scenarios in which the user cannot\n+change the parent transaction (e.g. they were presigned with an untrusted party), but has control\n+over the child. For example, Package RBF can be used to replace the commitment transaction of an LN\n+counterparty by attaching a high-fee child to an anchor output. If the user later wants to update\n+the child (e.g. a further fee-bump), that can be done using a single transaction.\n+\n+4. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+5. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+   The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: These fee-related rules are identical to the replacement [policy for individual\n+transactions](./mempool-replacements.md), treating the package (after deduplication) as one\n+composite transaction. This works because all of the transactions in a\n+child-with-unconfirmed-parents package are in the ancestor set of the child transaction.\n+\n+6. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r931306607",
      "id" : 931306607,
      "in_reply_to_id" : 924636307,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII5843gpxv",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 180,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 88,
      "pull_request_review_id" : 1052854140,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931306607/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-27T17:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931306607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r931892775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931892775"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe this is a naive question, but is there a way we can make that value configurable instead of using a protocol hard-coded value?\r\n\r\nInformally, any v3 transaction would include a _descendant_max_weight_ somewhere (handwave, handwave), covered by signatures. This lets L2 contracts decide what values are acceptable for each tx type. For example, in the anchor outputs LN-penalty case, we know that commit txs only need an anchor child that can be constrained to be quite small, so commit txs could use a low value here, that can take into account the maximum weight of a commit tx.\r\n\r\nOr would this be adding too much complexity for only a marginal improvement? If so, we should probably bikeshed the protocol hard-coded value and use the lowest value we can to minimize the harm a malicious child tx can do.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-28T07:50:43Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r931892775",
      "id" : 931892775,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843i44n",
      "original_commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1053636482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931892775/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T07:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931892775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r931897761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931897761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I believe this falls short in that the parent V3 transaction can be just south of 101kvB, even in ANYONECANPAY and SIGHASH_SINGLE like scenarios where additional inputs cannot be excluded by the presigning parties.\r\n\r\nCan't we easily fix that by relaxing the 100kvB policy limit to be 104kvB for v3 transactions?",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-28T07:55:40Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r931897761",
      "id" : 931897761,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843i6Gh",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1053636482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931897761/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T07:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/931897761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> we should probably bikeshed the protocol hard-coded value and use the lowest value we can to minimize the harm a malicious child tx can do.\r\n\r\nHere's my reasoning for the current value (4000vB), but open to feedback and I will of course add the rationale to the version3_transactions.md doc:\r\n\r\n- Upper bound: the larger we make this limit, the more vbytes we may need to replace. With default limits, if the child is e.g. 100,000vB, that might be an additional 100,000sat or more, depending on the feerate.\r\n- Lower bound: the smaller we make this limit, the fewer UTXOs we can use to fund this fee-bump. If we require all fee-bumps to only use 1 UTXO, for example, we're be requiring wallets to always maintain a pool of high-value UTXOs, one for each channel they might close.\r\n\r\nIf you're broadcasting commitment tx  `commit_a` and 4000vB is the largest output your counterparty can attach to their commitment tx `commit_b`, you can easily meet `(commit_b.fees + 4000 * minfeerate) + (incrementalfeerate * commit_a.size)` fee to replace.\r\n\r\n4000vB should give you at least 50 inputs depending on the output type, which I'm guessing is a reasonable restriction.\r\nIf you say, hey, 10 inputs is enough, then we could lower this to 1000vB.",
      "created_at" : "2022-07-28T11:52:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1198039341",
      "id" : 1198039341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585HaKEt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198039341/reactions"
      },
      "updated_at" : "2022-07-28T11:52:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198039341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r932350557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932350557"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's definitely doable under an annex field regime(input commits to total package size), but it's a question of complexity.\r\n\r\nI do think this kind of system would allow ANYONECANPAY style contracts to be secure against pinning, so it's definitely worth further exploration.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-28T15:02:44Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r932350557",
      "id" : 932350557,
      "in_reply_to_id" : 931892775,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843kopd",
      "original_commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1054281170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932350557/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T15:02:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932350557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r932352799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932352799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Can't we easily fix that by relaxing the 100kvB policy limit to be 104kvB for v3 transactions?\r\n\r\nYou would still have to replace 100kvB of griefing txns in general, so that doesn't sidestep the issue?",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-28T15:03:50Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r932352799",
      "id" : 932352799,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843kpMf",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1054284270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932352799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-28T15:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932352799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-07-28T16:43:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1198389434",
      "id" : 1198389434,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585Hbfi6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198389434/reactions"
      },
      "updated_at" : "2022-07-28T16:43:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198389434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Here's my reasoning for the current value (4000vB), but open to feedback and I will of course add the rationale to the version3_transactions.md doc\r\n\r\nThanks for the explanation!\r\n\r\n> 4000vB should give you at least 50 inputs depending on the output type, which I'm guessing is a reasonable restriction.\r\nIf you say, hey, 10 inputs is enough, then we could lower this to 1000vB.\r\n\r\nSince that child transaction is only bringing fees, it shouldn't need a big input amount, so I'd say 50 inputs is clearly too much, 10 inputs should be more than enough, shouldn't it?",
      "created_at" : "2022-07-29T07:01:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1198946822",
      "id" : 1198946822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585HdnoG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198946822/reactions"
      },
      "updated_at" : "2022-07-29T07:01:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1198946822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r932929342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932929342"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That is true, it's more important to focus on the general issue taking the parents into account, you're right, setting a limit on the whole v3 package would be useful.",
      "commit_id" : "a639f4f51fc291ab88811120241b560e9e81e823",
      "created_at" : "2022-07-29T07:02:34Z",
      "diff_hunk" : "@@ -0,0 +1,16 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The following set of policies apply to V3 transactions:\n+\n+1. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+2. A V3 transaction can be replaced by another V3 transaction, even if it does not signal BIP125\n+   replaceability. Use the (`-mempoolfullrbf`) configuration option to allow transaction\n+   replacement without enforcement of any opt-in signaling rule.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+4. A V3 transaction that has a V3 ancestor cannot be larger than 4000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r932929342",
      "id" : 932929342,
      "in_reply_to_id" : 924649289,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII5843m18-",
      "original_commit_id" : "18630747af9e5967b229fbe80f9cadf6ceb29252",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 16,
      "pull_request_review_id" : 1055095825,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932929342/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-07-29T07:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/932929342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@t-bast and I realized that under this proposal, even excluding ephemeral outputs, we can do all the anchor improvements up/to the \"ephemeral\" part for ln-penatly.\r\n\r\ni.e. Change to an OP_TRUE single anchor output for commitment transaction, but right at the relay output dust level. \r\n\r\nWouldn't be applicable to eltoo-like constructs, but these are more rare it seems. Most contract types can survive bleeding off a few sats once. e.g. batched payouts, coinjoins, ln-penalty\r\n\r\nScope creep to OP_TRUE becoming a standard output(up to 1 a tx?) to relay might be worth it? We can figure out the ephemeral part as a nice cleanup of current protocols further in future, and fix for eltoo-like stuff.\r\n\r\n",
      "created_at" : "2022-07-29T14:24:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1199383646",
      "id" : 1199383646,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585HfSRe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1199383646/reactions"
      },
      "updated_at" : "2022-07-29T14:26:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1199383646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Since that child transaction is only bringing fees, it shouldn't need a big input amount, so I'd say 50 inputs is clearly too much, 10 inputs should be more than enough, shouldn't it?\r\n\r\nOh great! Then I'll limit the v3 child to 1000vB. Very simple :ok_hand: :grinning:",
      "created_at" : "2022-08-01T10:51:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1201038111",
      "id" : 1201038111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585HlmMf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201038111/reactions"
      },
      "updated_at" : "2022-08-01T10:51:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1201038111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-03T09:24:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1203703895",
      "id" : 1203703895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585HvxBX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203703895/reactions"
      },
      "updated_at" : "2022-08-03T09:24:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203703895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-08-22T10:38:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1222171850",
      "id" : 1222171850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585I2NzK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1222171850/reactions"
      },
      "updated_at" : "2022-08-22T10:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1222171850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Ready for review! Writing a mailing list post at the moment. You can also look at doc/policy/packages.md and doc/policy/version3_transactions.md.",
      "created_at" : "2022-09-03T10:16:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1236090013",
      "id" : 1236090013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585JrTyd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1236090013/reactions"
      },
      "updated_at" : "2022-09-03T10:16:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1236090013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebase + deleted some unused code + tweak to the signaling logic. Posted to the mailing list just now https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-September/020937.html",
      "created_at" : "2022-09-23T15:38:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1256371309",
      "id" : 1256371309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585K4rRt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1256371309/reactions"
      },
      "updated_at" : "2022-09-23T15:38:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1256371309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983307823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983307823"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\ntransactions. A directly conflicting transaction and its descendants (together, \"original\r\n```",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T09:34:58Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983307823",
      "id" : 983307823,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII5846nBYv",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 126,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 34,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983307823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983307823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983325287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983325287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was wondering whether this could be a pinning vector when used with v3 transactions, but it's not :tada: \r\n\r\nPackages are by default restricted to 25 elements, so in theory we're safe, but since this value is configurable, we cannot completely rely on this protection. However, the size restriction on the v3 child ensures that it cannot be bumping 100 parent transactions, so this ensures that we're really safe (unless I'm missing something)!",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T09:51:33Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.\n+\n+3. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+   The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: Prevent network-wide DoS where replacements using the same outpoints are relayed over\n+and over again; require the replacement transactions to pay for relay using \"new\" fees. This\n+rule is taken from the [replacement policy for individual transactions](./mempool-replacements.md),\n+treating the package as one composite transaction.\n+\n+5. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983325287",
      "id" : 983325287,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII5846nFpn",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 170,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 78,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983325287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983325287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983426844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983426844"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\nA transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\r\n```\r\n\r\nOr start the sentence with \"Transactions with their\".",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T11:32:03Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983426844",
      "id" : 983426844,
      "line" : 3,
      "node_id" : "PRRC_kwDOABII5846necc",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 3,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983426844/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983426844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983433128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983433128"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe an unrelated question, but currently bitcoind doesn't let us create a transaction that has no outputs. In the context of CPFP, transactions with no outputs can be very useful: if you have inputs that let you reach the desired package feerate without creating any change, that's what you want to do. But currently we can't, so we have to overshoot the input amount and add a change output.\r\n\r\nIs there a consensus rule that disallows transactions with no outputs in blocks? If not, it would be quite useful to allow v3 transactions that have no outputs, introducing that new version is a good opportunity to do that.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T11:39:28Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983433128",
      "id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846nf-o",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983433128/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983433128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983461693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983461693"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can we relax the `replacement_ancestor_feerate` for v3 transactions? What would be ideal would be to simply ignore unconfirmed v3 ancestors from this calculation (some kind of `replacement_non_v3_ancestor_feerate`), which I believe is ok from an incentives' point of view given the other restrictions on v3 packages.\r\n\r\nOtherwise we will have the following issue:\r\n\r\n- a commitment transaction pays 0 fees and weighs 19,000 vbytes (it has many HTLCs)\r\n- an attacker publishes a CPFP v3 child that weighs 1,000 vbytes and has an individual feerate of e.g. 100 sat/byte\r\n- the package feerate ends up being 5 sat/byte, and the package doesn't confirm\r\n- if a feerate of 20 sat/byte for the package was enough to get the package confirmed, the honest participant would target that and thus create a CPFP v3 child with a feerate of 400 sat/byte\r\n- but that would be rejected under the current rules, and the honest participant is forced to make the _package feerate_ be 100 sat/byte, which is extremely expensive\r\n\r\nI'm realizing now that this is actually just another way of formulating @instagibbs's proposal to evict v3 siblings: when the direct conflict is a v3 transaction with an unconfirmed v3 parent, it would be great to only compare their individual feerates.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T12:10:57Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983461693",
      "id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5846nm89",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983461693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983461693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983462411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983462411"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n/** Maximum virtual size of a tx which spends from an unconfirmed V3 transaction, in vB. */\r\n```",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T12:11:40Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983462411",
      "id" : 983462411,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII5846nnIL",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 19,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 19,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983462411/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983462411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983469696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983469696"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like part of this comment should be on the CheckV3Inheritance overload below, the one that takes a `ptx` as argument?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T12:17:50Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983469696",
      "id" : 983469696,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII5846no6A",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : 30,
      "path" : "src/policy/contract_policy.h",
      "position" : 32,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983469696/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 30,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983469696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983472562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983472562"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Shouldn't we call `CheckV3Inheritance` here instead of letting the caller check that before? There are no cases where we want to call `ApplyV3Rules` without also checking v3 inheritance, are there?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T12:20:51Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+#include <policy/contract_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_pair(it->second, tx->GetWitnessHash());\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    const auto version{ptx->nVersion};\n+    if (version == 3) return std::nullopt;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors)\n+{\n+    CTxMemPool::setEntries v3_ancestors;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            v3_ancestors.insert(entry);\n+        }\n+    }\n+    return v3_ancestors;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983472562",
      "id" : 983472562,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII5846npmy",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.cpp",
      "position" : 64,
      "pull_request_review_id" : 1124964475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983472562/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983472562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983510957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983510957"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yep! It should basically be impossible to hit this limit in the commitment tx bumping case. Your commitment tx will only conflict with that 1 commitment tx, and it cannot have more than 1 descendant as a V3 transaction, even if the node has configured a larger `-limitdescendantcount`.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T12:58:29Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.\n+\n+3. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+   The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: Prevent network-wide DoS where replacements using the same outpoints are relayed over\n+and over again; require the replacement transactions to pay for relay using \"new\" fees. This\n+rule is taken from the [replacement policy for individual transactions](./mempool-replacements.md),\n+treating the package as one composite transaction.\n+\n+5. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983510957",
      "id" : 983510957,
      "in_reply_to_id" : 983325287,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII5846ny-t",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 170,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 78,
      "pull_request_review_id" : 1125250108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 2,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983510957/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T12:58:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983510957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983517504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983517504"
         }
      },
      "author_association" : "MEMBER",
      "body" : "To clarify, is the second v3 child (400sat/vbyte) replacing the first v3 child (100sat/vbyte) only? Assuming the commitment tx is already in the mempool. In that case, it would just be single transaction replacement so this rule isn't used. Just the individual feerates are compared, and the child is accepted. Maybe I'm misunderstanding the scenario though?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:04:40Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983517504",
      "id" : 983517504,
      "in_reply_to_id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5846n0lA",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1125260129,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983517504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:04:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983517504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983529152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983529152"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah good point, seems perfectly reasonable to me to have no payments in a CPFP transaction. I agree it seems like it would be fine to allow empty vout. But it looks like non-empty vout is indeed a consensus rule.\r\nSee `CheckTransaction`:\r\nhttps://github.com/bitcoin/bitcoin/blob/291e363ce500e492475c4ccd189ea1d031c43613/src/consensus/tx_check.cpp#L16-L17\r\nWhich is called by `CheckBlock`:\r\nhttps://github.com/bitcoin/bitcoin/blob/291e363ce500e492475c4ccd189ea1d031c43613/src/validation.cpp#L3370-L3381",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:15:25Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983529152",
      "id" : 983529152,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846n3bA",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125277737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983529152/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983529152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983535342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983535342"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Extra trivia: seems like this consensus rule has been here since the very beginning :smiling_face_with_tear: can't believe Satoshi didn't predict the need for CPFPing presigned transactions. \r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/4405b78d6059e536c36974088a8ed4d9f0f29898/main.h#L443-L448",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:20:59Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983535342",
      "id" : 983535342,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846n47u",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125277737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983535342/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983535342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983538284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983538284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah yes :+1: thanks!",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:23:31Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983538284",
      "id" : 983538284,
      "in_reply_to_id" : 983469696,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII5846n5ps",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : 30,
      "path" : "src/policy/contract_policy.h",
      "position" : 32,
      "pull_request_review_id" : 1125277737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983538284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 30,
      "start_side" : "RIGHT",
      "updated_at" : "2022-09-29T13:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983538284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983538945"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983538945"
         }
      },
      "author_association" : "MEMBER",
      "body" : "snuck in a fix for rule#5 pinning, nice. Probably should be noted somewhere.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:24:06Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.\n+\n+3. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.\n+   The additional fees (difference between absolute fee paid by the package after deduplication and the\n+   sum paid by the original transactions) pays for the package's bandwidth at or above the rate set\n+   by the node's incremental relay feerate. For example, if the incremental relay feerate is 1\n+   satoshi/vB and the package after deduplication contains 500 virtual bytes total, then the package\n+   fees after deduplication is at least 500 satoshis higher than the sum of the original transactions.\n+\n+*Rationale*: Prevent network-wide DoS where replacements using the same outpoints are relayed over\n+and over again; require the replacement transactions to pay for relay using \"new\" fees. This\n+rule is taken from the [replacement policy for individual transactions](./mempool-replacements.md),\n+treating the package as one composite transaction.\n+\n+5. The number of original transactions does not exceed 100.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983538945",
      "id" : 983538945,
      "in_reply_to_id" : 983325287,
      "line" : 170,
      "node_id" : "PRRC_kwDOABII5846n50B",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 170,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 78,
      "pull_request_review_id" : 1125292444,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983538945/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:24:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983538945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983571470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983571470"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we cannot do only individual replacement here, if the attacker publishes their commit + their child, and the honest participants wants to publish their own commit + their child (because for some reason they never receive the attacker's package in their mempool so cannot attach a CPFP to that commit).\r\n\r\nSo this is actually slightly different from the v3 sibling eviction problem, which as you point out probably just works :tm: with individual replacement rules already.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:51:07Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983571470",
      "id" : 983571470,
      "in_reply_to_id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5846oBwO",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1125341415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983571470/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983571470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983582699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983582699"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Is there a consensus rule that disallows transactions with no outputs in blocks?\r\n\r\nYes. It's a hard rule.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:57:37Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983582699",
      "id" : 983582699,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846oEfr",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125355594,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983582699/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:57:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983582699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983583700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983583700"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not yet 100% sure whether package RBF currently lets us replace `[CommitTxA (19,000 vbytes, 0 sat/byte), AnchorTxA (1,000 vbytes, 20 sat/byte)]` with `[CommitTxB (19,000 vbytes, 0 sat/byte), AnchorTxB (1,000 vbytes, 80 sat/byte)]`, where all txs are v3 (which is the issue I'm trying to describe here).\r\n\r\nI probably just need to write a test for it and see for myself, but what do you think?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:58:08Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983583700",
      "id" : 983583700,
      "in_reply_to_id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5846oEvU",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1125356533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983583700/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:58:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983583700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983585405"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983585405"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see okay so the situation is:\r\n\r\noriginal transactions = commitment_A + cpfp_A\r\nreplacement transactions (package) = commitment_B + cpfp_B\r\n- commitment_A: 19,000vB, 0sat.\r\n    - individual feerate = 0sat/vB\r\n    - ancestor feerate = 0sat/vB\r\n- cpfp_A: 1000vbytes, 100,000sat.\r\n    - individual feerate = 100sat/vB\r\n    - ancestor feerate = 5sat/vB\r\n- commitment_B: 19,000vB, 0sat.\r\n    - individual feerate = 0sat/vB\r\n    - ancestor feerate = 0sat/vB\r\n- cpfp_B: 1000vB, 400,000sat.\r\n    - individual feerate = 400sat/vB\r\n    - ancestor feerate = 20sat/vB\r\npackage feerate = 20sat/vB\r\n\r\n`replacement_miner_score` = minimum(package feerate, ancestor feerate) = 20sat/vB\r\nthe rule is that `replacement_miner_score` must be higher than\r\n- the direct conflict's (commitment_A) indivdual feerate = 0sat/vB\r\n- the original transactions' (commitment_A, cpfp_A) ancestor feerates = 0sat/vB and 5sat/vB\r\n\r\nSo this should be fine AFAICT",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T13:59:31Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983585405",
      "id" : 983585405,
      "in_reply_to_id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5846oFJ9",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1125277737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983585405/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T13:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983585405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983590391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983590391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's too bad! Damn you Satoshi, you could have thought about this...",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T14:03:35Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983590391",
      "id" : 983590391,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846oGX3",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125366791,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983590391/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T14:03:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983590391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983590484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983590484"
         }
      },
      "author_association" : "MEMBER",
      "body" : "OP_RETURN outputs can be pretty small :)",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T14:03:41Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983590484",
      "id" : 983590484,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846oGZU",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125366957,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983590484/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T14:03:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983590484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983592907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983592907"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's great! I'll write a test for this in eclair anyway, thanks for clearing that up :+1: ",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T14:05:40Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983592907",
      "id" : 983592907,
      "in_reply_to_id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5846oG_L",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1125372242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983592907/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T14:05:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983592907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/31281497?v=4",
         "events_url" : "https://api.github.com/users/t-bast/events{/privacy}",
         "followers_url" : "https://api.github.com/users/t-bast/followers",
         "following_url" : "https://api.github.com/users/t-bast/following{/other_user}",
         "gists_url" : "https://api.github.com/users/t-bast/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/t-bast",
         "id" : 31281497,
         "login" : "t-bast",
         "node_id" : "MDQ6VXNlcjMxMjgxNDk3",
         "organizations_url" : "https://api.github.com/users/t-bast/orgs",
         "received_events_url" : "https://api.github.com/users/t-bast/received_events",
         "repos_url" : "https://api.github.com/users/t-bast/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/t-bast/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/t-bast/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/t-bast"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983669489"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983669489"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mm, could have a 0-value OP_RETURN?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T15:05:10Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983669489",
      "id" : 983669489,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846oZrx",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125485823,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983669489/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T15:05:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983669489",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983671304"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983671304"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yes, you'll pay 8+1+1 bytes for the output",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-09-29T15:06:46Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r983671304",
      "id" : 983671304,
      "in_reply_to_id" : 983433128,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII5846oaII",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 43,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 43,
      "pull_request_review_id" : 1125488650,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983671304/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-09-29T15:06:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983671304",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-09T17:41:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1272592779",
      "id" : 1272592779,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585L2jmL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1272592779/reactions"
      },
      "updated_at" : "2022-10-09T17:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1272592779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004862848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004862848"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"evicted in the event of a replacement\" is a tautology, it's being replaced so obviously it's being evicted.\r\n\r\nsuggested: \"in the event of mempool entry of the new transaction\"",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:00:17Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004862848",
      "id" : 1004862848,
      "line" : 127,
      "node_id" : "PRRC_kwDOABII58475P2A",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 127,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 35,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004862848/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004862848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004866030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004866030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "... for non-V3 transactions",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:04:08Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004866030",
      "id" : 1004866030,
      "line" : 20,
      "node_id" : "PRRC_kwDOABII58475Qnu",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 20,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 20,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004866030/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004866030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004867023"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004867023"
         }
      },
      "author_association" : "MEMBER",
      "body" : "based on discussion at Coredev: Any ancestor as well!",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:05:27Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004867023",
      "id" : 1004867023,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII58475Q3P",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 22,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004867023/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004867023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004868277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004868277"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"Just like any other policy measure, it does not effect validity of data in blocks.\"",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:06:56Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004868277",
      "id" : 1004868277,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII58475RK1",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 29,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 29,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004868277/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004868277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004876143"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004876143"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The pinning \"damage\" is specifically bounded between the tx size of whatever an honest user would have needed to make to bump, and the total allowed limit. For example, if a wallet only needs half the space for an honest fee bump, an attacker is bound to a 2x fee pin attack, maximum, instead of 200x without V3 rules.\r\n\r\nMight want to mention that it bounds the economic damage by ~100x in a digestible form.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:16:32Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004876143",
      "id" : 1004876143,
      "line" : 45,
      "node_id" : "PRRC_kwDOABII58475TFv",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 45,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 45,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004876143/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004876143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004882194"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004882194"
         }
      },
      "author_association" : "MEMBER",
      "body" : "\"The duduplicated package\" just to make it abundantly clear.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:24:01Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.\n+\n+3. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004882194",
      "id" : 1004882194,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII58475UkS",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 158,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 66,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004882194/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004882194",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004884944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004884944"
         }
      },
      "author_association" : "MEMBER",
      "body" : "or wallets that want robust RBF abilities...",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:27:24Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004884944",
      "id" : 1004884944,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII58475VPQ",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 17,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004884944/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004884944",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004887453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004887453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/must also have/must also be/",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:30:31Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004887453",
      "id" : 1004887453,
      "line" : 30,
      "node_id" : "PRRC_kwDOABII58475V2d",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 30,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 30,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004887453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004887453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004893307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004893307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "suggestion: rename arg to `checked_package` ",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:37:59Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004893307",
      "id" : 1004893307,
      "line" : 38,
      "node_id" : "PRRC_kwDOABII58475XR7",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 38,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004893307/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004893307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004895010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004895010"
         }
      },
      "author_association" : "MEMBER",
      "body" : "make explicit what is returned",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:40:13Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. */\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors);\n+\n+/** Filters the ancestors, returning the ones which are nVersion=3 (\"V3 ancestors\"). */\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors);\n+\n+/** The following rules apply to V3 transactions:\n+ * 1. Tx with all of its ancestors (including non-nVersion=3) must be within V3_ANCESTOR_SIZE_LIMIT_KVB.\n+ * 2. Tx with all of its ancestors must be within V3_ANCESTOR_LIMIT.\n+ *\n+ * If a V3 tx has V3 ancestors,\n+ * 1. Each V3 ancestor and its descendants must be within V3_DESCENDANT_LIMIT.\n+ * 2. The tx must be within V3_CHILD_MAX_SIZE.\n+ */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004895010",
      "id" : 1004895010,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII58475Xsi",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 54,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 54,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004895010/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004895010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004897242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004897242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/must also have/must also be/",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:43:05Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004897242",
      "id" : 1004897242,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII58475YPa",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 40,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004897242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004897242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004899136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004899136"
         }
      },
      "author_association" : "MEMBER",
      "body" : "please make it explicit what is being returned",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T19:45:27Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004899136",
      "id" : 1004899136,
      "in_reply_to_id" : 1004897242,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII58475YtA",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : 40,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004899136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004899136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004937926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004937926"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/tx_v3_from_v2_and_v3/tx_v2_from_v2_and_v3/ ?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T20:32:04Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004937926",
      "id" : 1004937926,
      "line" : 105,
      "node_id" : "PRRC_kwDOABII58475iLG",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 105,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 67,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004937926/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004937926",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004938752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004938752"
         }
      },
      "author_association" : "MEMBER",
      "body" : "we also need positive test cases of `CheckV3Inheritance`",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T20:33:08Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 2);\n+        auto v3_ancestors = GetV3Ancestors(ancestors);\n+        BOOST_CHECK(v3_ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004938752",
      "id" : 1004938752,
      "line" : 110,
      "node_id" : "PRRC_kwDOABII58475iYA",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 110,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 72,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004938752/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004938752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004941161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004941161"
         }
      },
      "author_association" : "MEMBER",
      "body" : "why bother with the loop vs one huge tx?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T20:36:14Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 2);\n+        auto v3_ancestors = GetV3Ancestors(ancestors);\n+        BOOST_CHECK(v3_ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Tx spending v3 cannot have too many mempool ancestors\n+    // Configuration where the tx has too many direct parents.\n+    {\n+        std::vector<COutPoint> mempool_outpoints;\n+        mempool_outpoints.emplace_back(COutPoint{mempool_tx_v3->GetHash(), 0});\n+        mempool_outpoints.resize(25);\n+        for (size_t i{0}; i < 24; ++i) {\n+            auto mempool_tx = make_tx(random_outpoints(1), /*version=*/2);\n+            pool.addUnchecked(entry.FromTx(mempool_tx));\n+            mempool_outpoints.emplace_back(COutPoint{mempool_tx->GetHash(), 0});\n+        }\n+        auto tx_v3_many_parents = make_tx(mempool_outpoints, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_parents), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_parents, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Configuration where the tx is in a many-generation chain.\n+    auto last_outpoint{random_outpoints(1)[0]};\n+    for (size_t i{0}; i < 25; ++i) {\n+        auto mempool_tx = make_tx({last_outpoint}, /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(mempool_tx));\n+        last_outpoint = COutPoint{mempool_tx->GetHash(), 0};\n+    }\n+    {\n+        auto tx_v3_many_generation = make_tx({last_outpoint}, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_generation), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_generation, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // V3 tx cannot have too large ancestor size\n+    std::vector<COutPoint> large_mempool_outpoints;\n+    large_mempool_outpoints.resize(10);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004941161",
      "id" : 1004941161,
      "line" : 151,
      "node_id" : "PRRC_kwDOABII58475i9p",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 151,
      "original_position" : 113,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 113,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004941161/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004941161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004942013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004942013"
         }
      },
      "author_association" : "MEMBER",
      "body" : "let's assert up here what size this is, since I'm unsure how big 10 200-input txs are, off-hand",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T20:37:21Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 2);\n+        auto v3_ancestors = GetV3Ancestors(ancestors);\n+        BOOST_CHECK(v3_ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Tx spending v3 cannot have too many mempool ancestors\n+    // Configuration where the tx has too many direct parents.\n+    {\n+        std::vector<COutPoint> mempool_outpoints;\n+        mempool_outpoints.emplace_back(COutPoint{mempool_tx_v3->GetHash(), 0});\n+        mempool_outpoints.resize(25);\n+        for (size_t i{0}; i < 24; ++i) {\n+            auto mempool_tx = make_tx(random_outpoints(1), /*version=*/2);\n+            pool.addUnchecked(entry.FromTx(mempool_tx));\n+            mempool_outpoints.emplace_back(COutPoint{mempool_tx->GetHash(), 0});\n+        }\n+        auto tx_v3_many_parents = make_tx(mempool_outpoints, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_parents), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_parents, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Configuration where the tx is in a many-generation chain.\n+    auto last_outpoint{random_outpoints(1)[0]};\n+    for (size_t i{0}; i < 25; ++i) {\n+        auto mempool_tx = make_tx({last_outpoint}, /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(mempool_tx));\n+        last_outpoint = COutPoint{mempool_tx->GetHash(), 0};\n+    }\n+    {\n+        auto tx_v3_many_generation = make_tx({last_outpoint}, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_generation), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_generation, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // V3 tx cannot have too large ancestor size\n+    std::vector<COutPoint> large_mempool_outpoints;\n+    large_mempool_outpoints.resize(10);\n+    for (size_t i{0}; i < 10; ++i) {\n+        auto large_mempool_tx = make_tx(random_outpoints(200), /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(large_mempool_tx));\n+        large_mempool_outpoints.emplace_back(COutPoint{large_mempool_tx->GetHash(), 0});\n+    }\n+    {\n+        auto tx_v3_large_parents = make_tx(large_mempool_outpoints, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_large_parents), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 10);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_large_parents, ancestors, empty_conflicts_set).has_value());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004942013",
      "id" : 1004942013,
      "line" : 161,
      "node_id" : "PRRC_kwDOABII58475jK9",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 161,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 123,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004942013/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004942013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004955271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004955271"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thought: do we just want to make the version check a thing in `SignalsOptInRBF`?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T20:54:02Z",
      "diff_hunk" : "@@ -745,9 +746,11 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n                 // check all unconfirmed ancestors; otherwise an opt-in ancestor\n                 // might be replaced, causing removal of this descendant.\n                 //\n-                // If replaceability signaling is ignored due to node setting,\n-                // replacement is always allowed.\n-                if (!m_pool.m_full_rbf && !SignalsOptInRBF(*ptxConflicting)) {\n+                // All V3 transactions are considered replaceable.\n+                //\n+                // Replaceability signaling of the original transactions may be\n+                // ignored due to node setting.\n+                if (!m_pool.m_full_rbf && !SignalsOptInRBF(*ptxConflicting) && ptxConflicting->nVersion != 3) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004955271",
      "id" : 1004955271,
      "line" : 770,
      "node_id" : "PRRC_kwDOABII58475maH",
      "original_commit_id" : "c82f832ddd3306c84b70410b306a6a29cee87a91",
      "original_line" : 753,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 19,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004955271/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004955271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004958560"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004958560"
         }
      },
      "author_association" : "MEMBER",
      "body" : "just do a single generate of 110 if you need 10 coins",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T20:58:07Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004958560",
      "id" : 1004958560,
      "line" : 31,
      "node_id" : "PRRC_kwDOABII58475nNg",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 31,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 31,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004958560/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004958560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004960576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004960576"
         }
      },
      "author_association" : "MEMBER",
      "body" : "clear out mempool via miner, to make it clear what's in flight in test",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:00:41Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004960576",
      "id" : 1004960576,
      "line" : 48,
      "node_id" : "PRRC_kwDOABII58475ntA",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 48,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004960576/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004960576",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004963312"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004963312"
         }
      },
      "author_association" : "MEMBER",
      "body" : "change *all* these checks to `getrawmempool` for strict assertion there is a single tx, and the hash is as expected",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:04:19Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004963312",
      "id" : 1004963312,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII58475oXw",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 64,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004963312/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004963312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004964328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004964328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "mine a block for simpler reading of test",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:05:43Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004964328",
      "id" : 1004964328,
      "line" : 74,
      "node_id" : "PRRC_kwDOABII58475ono",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 74,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 74,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004964328/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004964328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004965337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004965337"
         }
      },
      "author_association" : "MEMBER",
      "body" : "repeat of https://github.com/bitcoin/bitcoin/pull/25038/commits/c11fb499f182306f635ea9457ec4574b2992e185#diff-15a1888c9151fc1d182c23e34b71d691f70df448bceb9eb78c8296f18854b6a3R67 ?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:07:04Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004965337",
      "id" : 1004965337,
      "line" : 100,
      "node_id" : "PRRC_kwDOABII58475o3Z",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 100,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 100,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004965337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004965337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004966712"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004966712"
         }
      },
      "author_association" : "MEMBER",
      "body" : "assert that `fullrbf` is false in `getmempoolinfo`... just in case",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:08:56Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 4,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions that don't signal BIP125 are replaceable\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004966712",
      "id" : 1004966712,
      "line" : 109,
      "node_id" : "PRRC_kwDOABII58475pM4",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 109,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 109,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004966712/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004966712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004968205"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004968205"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can we get a better error description?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:10:54Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 4,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions that don't signal BIP125 are replaceable\")\n+        utxo_v3_no_bip125 = self.wallet.get_utxo()\n+        tx_v3_no_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE + 1,\n+            version=3\n+        )\n+\n+        assert node.getmempoolentry(tx_v3_no_bip125[\"txid\"])\n+        assert not node.getmempoolentry(tx_v3_no_bip125[\"txid\"])[\"bip125-replaceable\"]\n+        tx_v3_no_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_no_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_no_bip125[\"txid\"])\n+\n+        self.log.info(\"Test a child of a V3 transaction cannot be more than 1000vB\")\n+        self.restart_node(0, extra_args=[\"-datacarriersize=1000\"])\n+        tx_v3_parent_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        tx_v3_child_heavy = self.wallet.create_self_transfer(\n+            utxo_to_spend=tx_v3_parent_normal[\"new_utxo\"],\n+            target_weight=4004,\n+            version=3\n+        )\n+        assert_greater_than_or_equal(tx_v3_child_heavy[\"tx\"].get_vsize(), 1000)\n+        assert_raises_rpc_error(-26, \"nonstandard\", node.sendrawtransaction, tx_v3_child_heavy[\"hex\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004968205",
      "id" : 1004968205,
      "line" : 139,
      "node_id" : "PRRC_kwDOABII58475pkN",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 139,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 139,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004968205/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004968205",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004968938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004968938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "let's also have an example that *just* makes it in",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-25T21:11:52Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 4,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions that don't signal BIP125 are replaceable\")\n+        utxo_v3_no_bip125 = self.wallet.get_utxo()\n+        tx_v3_no_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE + 1,\n+            version=3\n+        )\n+\n+        assert node.getmempoolentry(tx_v3_no_bip125[\"txid\"])\n+        assert not node.getmempoolentry(tx_v3_no_bip125[\"txid\"])[\"bip125-replaceable\"]\n+        tx_v3_no_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_no_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_no_bip125[\"txid\"])\n+\n+        self.log.info(\"Test a child of a V3 transaction cannot be more than 1000vB\")\n+        self.restart_node(0, extra_args=[\"-datacarriersize=1000\"])\n+        tx_v3_parent_normal = self.wallet.send_self_transfer(from_node=node, version=3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1004968938",
      "id" : 1004968938,
      "line" : 132,
      "node_id" : "PRRC_kwDOABII58475pvq",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 132,
      "original_position" : 132,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 132,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004968938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004968938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005720112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005720112"
         }
      },
      "author_association" : "MEMBER",
      "body" : "note: a test that this commit fixes the purported future bug would be a good idea",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T13:56:32Z",
      "diff_hunk" : "@@ -1182,7 +1197,7 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n     AssertLockHeld(cs_main);\n     LOCK(m_pool.cs); // mempool \"read lock\" (held through GetMainSignals().TransactionAddedToMempool())\n \n-    Workspace ws(ptx);\n+    Workspace ws(ptx, m_limit_descendants, m_limit_descendant_size);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005720112",
      "id" : 1005720112,
      "line" : 1290,
      "node_id" : "PRRC_kwDOABII58478hIw",
      "original_commit_id" : "dd8d0af4a27bf4c299a1af8de4dbe0c139dba730",
      "original_line" : 1200,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 68,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005720112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005720112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005728498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005728498"
         }
      },
      "author_association" : "MEMBER",
      "body" : "the idea being, carveouts are only useful in the individual tx scenario, not package context? i.e., you wouldn't need to propagate *both* anchor spends on a commit tx in a package, which busts original limits?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T14:03:21Z",
      "diff_hunk" : "@@ -1001,6 +1001,9 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n     std::string err_string;\n+    // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n+    // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n+    // PreChecks), they do not apply here.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005728498",
      "id" : 1005728498,
      "line" : 1021,
      "node_id" : "PRRC_kwDOABII58478jLy",
      "original_commit_id" : "bb1b7ee6c6843c5e0e4d991d31034e8a6ba83310",
      "original_line" : 1006,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005728498/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005728498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005731264"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005731264"
         }
      },
      "author_association" : "MEMBER",
      "body" : "to belabor the commit text:\r\n\r\n\"Transactions could conflict with the same tx\"\r\n\r\nmeaning transactions in the same package can conflict with the same original tx, so for package evaluation, we only want to count these once?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T14:05:38Z",
      "diff_hunk" : "@@ -569,18 +569,11 @@ class MemPoolAccept\n         std::set<uint256> m_conflicts;\n         /** Iterators to mempool entries that this transaction directly conflicts with. */\n         CTxMemPool::setEntries m_iters_conflicting;\n-        /** Iterators to all mempool entries that would be replaced by this transaction, including",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005731264",
      "id" : 1005731264,
      "line" : 567,
      "node_id" : "PRRC_kwDOABII58478j3A",
      "original_commit_id" : "459a82c3a1277a7d13a36be5d47bf799ece78143",
      "original_line" : 572,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005731264/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005731264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005741932"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005741932"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can we \"watermark\" the entry names with if they're low or high, or just grab a renamed copy?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T14:14:16Z",
      "diff_hunk" : "@@ -225,6 +226,60 @@ BOOST_FIXTURE_TEST_CASE(rbf_helper_functions, TestChain100Setup)\n \n     const auto spends_conflicting_confirmed = make_tx({m_coinbase_txns[0], m_coinbase_txns[1]}, {45 * CENT});\n     BOOST_CHECK(HasNoNewUnconfirmed(*spends_conflicting_confirmed.get(), pool, {entry1, entry3}) == std::nullopt);\n+\n+    // Tests for CheckMinerScores\n+    // Don't allow replacements with a low ancestor feerate.\n+    BOOST_CHECK(CheckMinerScores(/*replacement_fees=*/entry1->GetFee(),\n+                                 /*replacement_vsize=*/entry1->GetTxSize(),\n+                                 /*ancestors=*/{entry5},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005741932",
      "id" : 1005741932,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII58478mds",
      "original_commit_id" : "5cc295b8ef46c78a093f249b70304eae3ec169b9",
      "original_line" : 234,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 17,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005741932/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005741932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005748598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005748598"
         }
      },
      "author_association" : "MEMBER",
      "body" : "can you state in the comment what the practical effect(s) of not accounting for this difference is?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T14:19:43Z",
      "diff_hunk" : "@@ -1005,16 +1009,93 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n     // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n     // PreChecks), they do not apply here.\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005748598",
      "id" : 1005748598,
      "line" : 1024,
      "node_id" : "PRRC_kwDOABII58478oF2",
      "original_commit_id" : "7cbe926e13f802e372bf140594182a7a2c0d2f1e",
      "original_line" : 1024,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 54,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005748598/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005748598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005755274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005755274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Don't understand this comment",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T14:25:09Z",
      "diff_hunk" : "@@ -1005,16 +1009,93 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n     // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n     // PreChecks), they do not apply here.\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Transactions must pay for their own replacements unless they are V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005755274",
      "id" : 1005755274,
      "line" : 1037,
      "node_id" : "PRRC_kwDOABII58478puK",
      "original_commit_id" : "7cbe926e13f802e372bf140594182a7a2c0d2f1e",
      "original_line" : 1037,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 68,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005755274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005755274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005833244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005833244"
         }
      },
      "author_association" : "MEMBER",
      "body" : "to rephrase: make sure original conflicting txs are not being used by the replacement package itself?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T15:23:10Z",
      "diff_hunk" : "@@ -1005,16 +1009,93 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n     // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n     // PreChecks), they do not apply here.\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Transactions must pay for their own replacements unless they are V3.\n+    if (args.m_package_feerates) {\n+        for (const auto& ws : workspaces) {\n+            // If this transaction has a conflict, it must be V3.\n+            if (!ws.m_iters_conflicting.empty() && ws.m_ptx->nVersion != 3) {\n+                return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package RBF failed: V3 required\");\n+            }\n+        }\n+    }\n+\n+    CTxMemPool::setEntries direct_conflict_iters;\n+    for (Workspace& ws : workspaces) {\n+        // Aggregate all conflicts into one set.\n+        direct_conflict_iters.merge(ws.m_iters_conflicting);\n+    }\n+\n+    // Use the child as the transaction for attributing errors to.\n+    const auto hash = workspaces[workspaces.size() - 1].m_ptx->GetHash();\n+    const CFeeRate package_feerate(m_total_modified_fees, m_total_vsize);\n+\n+    // Calculate all conflicting entries and enforce Rules 2 and 5.\n+    for (Workspace& ws : workspaces) {\n+        // The aggregated set of conflicts cannot exceed 100.\n+        if (const auto err_string{GetEntriesForConflicts(*ws.m_ptx, m_pool, direct_conflict_iters,\n+                                                         m_all_conflicts)}) {\n+            return package_state.Invalid(PackageValidationResult::PCKG_POLICY,\n+                                         \"package RBF failed: too many potential replacements\", *err_string);\n+        }\n+    }\n+\n+    // Check that the union of all collective conflicts and ancestors is disjoint.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005833244",
      "id" : 1005833244,
      "line" : 1067,
      "node_id" : "PRRC_kwDOABII584788wc",
      "original_commit_id" : "7cbe926e13f802e372bf140594182a7a2c0d2f1e",
      "original_line" : 1067,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 98,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005833244/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005833244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005841411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005841411"
         }
      },
      "author_association" : "MEMBER",
      "body" : "prevent identical txids between different packages, I presume",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-26T15:29:34Z",
      "diff_hunk" : "@@ -0,0 +1,316 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from decimal import Decimal\n+from random import choice\n+\n+from test_framework.messages import (\n+    COIN,\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class PackageRBFTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def assert_mempool_contents(self, expected=None, unexpected=None):\n+        \"\"\"Assert that all transactions in expected are in the mempool,\n+        and all transactions in unexpected are not in the mempool.\n+        \"\"\"\n+        if not expected:\n+            expected = []\n+        if not unexpected:\n+            unexpected = []\n+        assert set(unexpected).isdisjoint(expected)\n+        mempool = self.nodes[0].getrawmempool(verbose=False)\n+        for tx in expected:\n+            assert tx.rehash() in mempool\n+        for tx in unexpected:\n+            assert tx.rehash() not in mempool\n+\n+    def create_simple_package(self, parent_coins, parent_fee=0, child_fee=DEFAULT_FEE, heavy_child=False, version=3):\n+        \"\"\"Create a child-with-parents package using the parent_coins passed in.\n+        Each coin in parent_coins will be used to fund 1 parent transaction.\n+        Each parent will have 1 output. The parents' outputs will be used to fund 1 child\n+        transaction. Thus, the package will contain len(parent_coins) + 1 transactions.\n+        All transactions signal BIP125 replaceability, but nSequence changes based on self.ctr.\n+\n+        returns tuple (hex serialized txns, CTransaction objects)\n+        \"\"\"\n+        self.ctr += 1\n+        package_hex = []\n+        package_txns = []\n+        child_inputs = []\n+        # Use fee_rate=0 because create_self_transfer will use the default fee_rate value otherwise.\n+        # Passing in fee>0 overrides fee_rate, so this still works for non-zero parent_fee.\n+        for coin in parent_coins:\n+            parent_result = self.wallet.create_self_transfer(\n+                fee_rate=0,\n+                fee=parent_fee,\n+                utxo_to_spend=coin,\n+                sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr, # prevent identical txids",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1005841411",
      "id" : 1005841411,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII58478-wD",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 63,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_package_rbf.py",
      "position" : 63,
      "pull_request_review_id" : 1155350107,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005841411/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-26T15:34:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1005841411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007373334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007373334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this is broken, it's only considering the deduplicated package, which \"blinds\" this evaluation from checking if the in-mempool parent is V3. Hence, the child as V2 would be accepted, even if parent in mempool was V3.\r\n",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-27T21:02:21Z",
      "diff_hunk" : "@@ -1206,10 +1321,21 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n \n     std::vector<Workspace> workspaces{};\n     workspaces.reserve(txns.size());\n-    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces),\n-                   [](const auto& tx) { return Workspace(tx); });\n+    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces), [this](const auto& tx) {\n+        return Workspace(tx, m_limit_descendants, m_limit_descendant_size);\n+    });\n     std::map<const uint256, const MempoolAcceptResult> results;\n \n+    if (const auto v3_violation{CheckV3Inheritance(txns)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007373334",
      "id" : 1007373334,
      "line" : 1329,
      "node_id" : "PRRC_kwDOABII5848C0wW",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 1329,
      "original_position" : 384,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 384,
      "pull_request_review_id" : 1159042215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007373334/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-27T21:02:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007373334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007390538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007390538"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also see `CheckV3Inheritance` call on L932",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-27T21:21:34Z",
      "diff_hunk" : "@@ -1206,10 +1321,21 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n \n     std::vector<Workspace> workspaces{};\n     workspaces.reserve(txns.size());\n-    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces),\n-                   [](const auto& tx) { return Workspace(tx); });\n+    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces), [this](const auto& tx) {\n+        return Workspace(tx, m_limit_descendants, m_limit_descendant_size);\n+    });\n     std::map<const uint256, const MempoolAcceptResult> results;\n \n+    if (const auto v3_violation{CheckV3Inheritance(txns)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007390538",
      "id" : 1007390538,
      "in_reply_to_id" : 1007373334,
      "line" : 1329,
      "node_id" : "PRRC_kwDOABII5848C49K",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 1329,
      "original_position" : 384,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 384,
      "pull_request_review_id" : 1159061008,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007390538/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-27T21:21:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007390538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007394116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007394116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok is this a quick check that misses these scenarios, then `PreCheck` later calls it again with all ancestors? ",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-27T21:26:01Z",
      "diff_hunk" : "@@ -1206,10 +1321,21 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n \n     std::vector<Workspace> workspaces{};\n     workspaces.reserve(txns.size());\n-    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces),\n-                   [](const auto& tx) { return Workspace(tx); });\n+    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces), [this](const auto& tx) {\n+        return Workspace(tx, m_limit_descendants, m_limit_descendant_size);\n+    });\n     std::map<const uint256, const MempoolAcceptResult> results;\n \n+    if (const auto v3_violation{CheckV3Inheritance(txns)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007394116",
      "id" : 1007394116,
      "in_reply_to_id" : 1007373334,
      "line" : 1329,
      "node_id" : "PRRC_kwDOABII5848C51E",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 1329,
      "original_position" : 384,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 384,
      "pull_request_review_id" : 1159065134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007394116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-27T21:26:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007394116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007396026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007396026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah ok, the mempool lock comment. got it!",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-27T21:28:13Z",
      "diff_hunk" : "@@ -1206,10 +1321,21 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n \n     std::vector<Workspace> workspaces{};\n     workspaces.reserve(txns.size());\n-    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces),\n-                   [](const auto& tx) { return Workspace(tx); });\n+    std::transform(txns.cbegin(), txns.cend(), std::back_inserter(workspaces), [this](const auto& tx) {\n+        return Workspace(tx, m_limit_descendants, m_limit_descendant_size);\n+    });\n     std::map<const uint256, const MempoolAcceptResult> results;\n \n+    if (const auto v3_violation{CheckV3Inheritance(txns)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1007396026",
      "id" : 1007396026,
      "in_reply_to_id" : 1007373334,
      "line" : 1329,
      "node_id" : "PRRC_kwDOABII5848C6S6",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 1329,
      "original_position" : 384,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 384,
      "pull_request_review_id" : 1159067163,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007396026/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-27T21:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1007396026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1008135966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008135966"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, working on this! Sorry for the delay!",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-28T14:33:47Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1008135966",
      "id" : 1008135966,
      "in_reply_to_id" : 1004867023,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII5848Fu8e",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 22,
      "pull_request_review_id" : 1160171084,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008135966/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-28T14:33:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008135966",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1008171877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008171877"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment should probably note that the check happens just below. As is it sounds like it's happening via caller",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-28T15:09:12Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+#include <policy/contract_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_pair(it->second, tx->GetWitnessHash());\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    const auto version{ptx->nVersion};\n+    if (version == 3) return std::nullopt;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors)\n+{\n+    CTxMemPool::setEntries v3_ancestors;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            v3_ancestors.insert(entry);\n+        }\n+    }\n+    return v3_ancestors;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;\n+\n+    const auto tx_vsize{GetVirtualTransactionSize(*ptx)};\n+    if (ancestors.size() + 1 > V3_ANCESTOR_LIMIT) {\n+        return strprintf(\"tx would have too many ancestors\");\n+    }\n+    const auto ancestor_vsize {std::accumulate(ancestors.cbegin(), ancestors.cend(), 0,\n+        [](int64_t sum, CTxMemPool::txiter it) { return sum + it->GetTxSize(); })};\n+    if (ancestor_vsize + tx_vsize > V3_ANCESTOR_SIZE_LIMIT_KVB * 1000) {\n+        return strprintf(\"total vsize of tx with ancestors would be too big: %u virtual bytes\", tx_vsize + ancestor_vsize);\n+    }\n+\n+    CTxMemPool::setEntries v3_ancestors{GetV3Ancestors(ancestors)};\n+\n+    // Note that this code assumes that any V3 transaction can only have 1 descendant.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1008171877",
      "id" : 1008171877,
      "line" : 78,
      "node_id" : "PRRC_kwDOABII5848F3tl",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 78,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.cpp",
      "position" : 78,
      "pull_request_review_id" : 1160226123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008171877/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T17:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008171877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1008172263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008172263"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Add an explicit comment here what this check is",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-10-28T15:09:35Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+#include <policy/contract_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_pair(it->second, tx->GetWitnessHash());\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    const auto version{ptx->nVersion};\n+    if (version == 3) return std::nullopt;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors)\n+{\n+    CTxMemPool::setEntries v3_ancestors;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            v3_ancestors.insert(entry);\n+        }\n+    }\n+    return v3_ancestors;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;\n+\n+    const auto tx_vsize{GetVirtualTransactionSize(*ptx)};\n+    if (ancestors.size() + 1 > V3_ANCESTOR_LIMIT) {\n+        return strprintf(\"tx would have too many ancestors\");\n+    }\n+    const auto ancestor_vsize {std::accumulate(ancestors.cbegin(), ancestors.cend(), 0,\n+        [](int64_t sum, CTxMemPool::txiter it) { return sum + it->GetTxSize(); })};\n+    if (ancestor_vsize + tx_vsize > V3_ANCESTOR_SIZE_LIMIT_KVB * 1000) {\n+        return strprintf(\"total vsize of tx with ancestors would be too big: %u virtual bytes\", tx_vsize + ancestor_vsize);\n+    }\n+\n+    CTxMemPool::setEntries v3_ancestors{GetV3Ancestors(ancestors)};\n+\n+    // Note that this code assumes that any V3 transaction can only have 1 descendant.\n+    // If there are any V3 ancestors, this is the only child allowed.\n+    if (v3_ancestors.size() > 0) {\n+        // This tx is a child of a V3 tx. To avoid RBF pinning, it can't be too large.\n+        if (tx_vsize > V3_CHILD_MAX_SIZE) {\n+            return strprintf(\"tx is too big: %u virtual bytes\", tx_vsize);\n+        }\n+    }\n+    for (const auto& entry : v3_ancestors) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1008172263",
      "id" : 1008172263,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII5848F3zn",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 86,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.cpp",
      "position" : 86,
      "pull_request_review_id" : 1160226123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008172263/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T17:07:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008172263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010259479"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010259479"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I thought about that approach, but it's used for RPC info \"bip125-replaceable\" (and somewhere in the wallet iirc).\r\nThough maybe that's a good thing (and we should move towards renaming that field to \"replaceable\" or something).",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-11-01T09:46:32Z",
      "diff_hunk" : "@@ -745,9 +746,11 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n                 // check all unconfirmed ancestors; otherwise an opt-in ancestor\n                 // might be replaced, causing removal of this descendant.\n                 //\n-                // If replaceability signaling is ignored due to node setting,\n-                // replacement is always allowed.\n-                if (!m_pool.m_full_rbf && !SignalsOptInRBF(*ptxConflicting)) {\n+                // All V3 transactions are considered replaceable.\n+                //\n+                // Replaceability signaling of the original transactions may be\n+                // ignored due to node setting.\n+                if (!m_pool.m_full_rbf && !SignalsOptInRBF(*ptxConflicting) && ptxConflicting->nVersion != 3) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010259479",
      "id" : 1010259479,
      "in_reply_to_id" : 1004955271,
      "line" : 770,
      "node_id" : "PRRC_kwDOABII5848N1YX",
      "original_commit_id" : "c82f832ddd3306c84b70410b306a6a29cee87a91",
      "original_line" : 753,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 19,
      "pull_request_review_id" : 1163083483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010259479/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T09:58:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010259479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010260726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010260726"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah exactly. And that would never happen since 2 children + 1 parent is not an accepted package topology anyway.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-11-01T09:48:11Z",
      "diff_hunk" : "@@ -1001,6 +1001,9 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n     std::string err_string;\n+    // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n+    // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n+    // PreChecks), they do not apply here.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010260726",
      "id" : 1010260726,
      "in_reply_to_id" : 1005728498,
      "line" : 1021,
      "node_id" : "PRRC_kwDOABII5848N1r2",
      "original_commit_id" : "bb1b7ee6c6843c5e0e4d991d31034e8a6ba83310",
      "original_line" : 1006,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 6,
      "pull_request_review_id" : 1163083483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010260726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T09:58:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010260726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010263457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010263457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sorry what do you mean? Like rename the variables to indicate fee e.g. `entry5_low` ?",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-11-01T09:51:43Z",
      "diff_hunk" : "@@ -225,6 +226,60 @@ BOOST_FIXTURE_TEST_CASE(rbf_helper_functions, TestChain100Setup)\n \n     const auto spends_conflicting_confirmed = make_tx({m_coinbase_txns[0], m_coinbase_txns[1]}, {45 * CENT});\n     BOOST_CHECK(HasNoNewUnconfirmed(*spends_conflicting_confirmed.get(), pool, {entry1, entry3}) == std::nullopt);\n+\n+    // Tests for CheckMinerScores\n+    // Don't allow replacements with a low ancestor feerate.\n+    BOOST_CHECK(CheckMinerScores(/*replacement_fees=*/entry1->GetFee(),\n+                                 /*replacement_vsize=*/entry1->GetTxSize(),\n+                                 /*ancestors=*/{entry5},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010263457",
      "id" : 1010263457,
      "in_reply_to_id" : 1005741932,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII5848N2Wh",
      "original_commit_id" : "5cc295b8ef46c78a093f249b70304eae3ec169b9",
      "original_line" : 234,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 17,
      "pull_request_review_id" : 1163083483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010263457/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T09:58:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010263457",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010264943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010264943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. I can elaborate in commit message",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-11-01T09:53:43Z",
      "diff_hunk" : "@@ -569,18 +569,11 @@ class MemPoolAccept\n         std::set<uint256> m_conflicts;\n         /** Iterators to mempool entries that this transaction directly conflicts with. */\n         CTxMemPool::setEntries m_iters_conflicting;\n-        /** Iterators to all mempool entries that would be replaced by this transaction, including",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010264943",
      "id" : 1010264943,
      "in_reply_to_id" : 1005731264,
      "line" : 567,
      "node_id" : "PRRC_kwDOABII5848N2tv",
      "original_commit_id" : "459a82c3a1277a7d13a36be5d47bf799ece78143",
      "original_line" : 572,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1163083483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010264943/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T09:58:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010264943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010678995"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010678995"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This rule is still sometimes problematic *if* you are doing batch fee bumping.\r\n\r\nLet's imagine the case where we have two separate channels, symmetrical commitment transactions(for clarity of argument).\r\n\r\nIf commitment_A is in the miner's mempool, and Bob wants to fee bump commitment_A as well as CPFP commitment_B(different channel!) into the miner's mempool, Bob will have to pay the replaced cpfp_A's feerate for the entire CPFP commitment_B + cpfp_B package.\r\n\r\nIn other words, batch bumping is probably not a good idea unless you know package RBF will evict the sponsored transaction directly.",
      "commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "created_at" : "2022-11-01T17:06:52Z",
      "diff_hunk" : "@@ -182,3 +182,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1010678995",
      "id" : 1010678995,
      "in_reply_to_id" : 983461693,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5848PbzT",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 206,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 25,
      "pull_request_review_id" : 1160226123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010678995/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-01T17:08:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1010678995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011915284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Deleted comment",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:12:00Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011915284",
      "id" : 1011915284,
      "in_reply_to_id" : 1004866030,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UJoU",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 20,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011915419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:12:04Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011915419",
      "id" : 1011915419,
      "in_reply_to_id" : 983426844,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UJqb",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 3,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011915747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done and documented",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:12:15Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011915747",
      "id" : 1011915747,
      "in_reply_to_id" : 1004867023,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII5848UJvj",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 21,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 21,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011915747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011924419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011924419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed, hopefully clearer now",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:17:21Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011924419",
      "id" : 1011924419,
      "in_reply_to_id" : 1004862848,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UL3D",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 127,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011924419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011924419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011925792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011925792"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:18:01Z",
      "diff_hunk" : "@@ -117,3 +118,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted in the event of a replacement.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.\n+\n+3. The minimum between package feerate and ancestor feerate of the child is not lower than the\n+   individual feerates of all directly conflicting transactions and the ancestor feerates of all\n+   original transactions.\n+\n+*Rationale*: Attempt to ensure that the replacement transactions are not less incentive-compatible\n+to mine.\n+\n+4. The package fee pays an absolute fee of at least the sum paid by the original transactions.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011925792",
      "id" : 1011925792,
      "in_reply_to_id" : 1004882194,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UMMg",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 158,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011925792/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011925792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011927231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011927231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Clarified",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:18:44Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011927231",
      "id" : 1011927231,
      "in_reply_to_id" : 1004868277,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UMi_",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 29,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011927231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011927231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011927764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011927764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a note about 1/100",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:19:01Z",
      "diff_hunk" : "@@ -0,0 +1,62 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") are allowed in mempool and\n+transaction relay.\n+\n+The policy rules set for V3 transactions is intended to aid contract or L2 protocols in which\n+transactions are signed by untrusted counterparties well before broadcast time, e.g. the Lightning\n+Network (LN). Since these contracting transactions are shared between multiple parties and mempool\n+congestion is difficult to predict, mempool policy restrictions may accidentally allow a malicious\n+party to pin a transaction.  The goal here is create a policy for V3 transactions that retains\n+DoS-resistance and accepts transactions that are incentive-compatible to mine, while also avoiding\n+specific pinning attacks.\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee]. Use the (`-mempoolfullrbf`) configuration option to\n+allow transaction replacement without enforcement of any opt-in signaling rule.\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: The descendant of a *confirmed* V3 transaction does not need to be V3.\n+\n+3. A V3 transaction cannot have more than 1 descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+4. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011927764",
      "id" : 1011927764,
      "in_reply_to_id" : 1004876143,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII5848UMrU",
      "original_commit_id" : "add1250fdabc27a94fd12bd21525da91e9e70b89",
      "original_line" : 53,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 53,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011927764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011927764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011936854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011936854"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added, thanks!",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:24:04Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+#include <policy/contract_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_pair(it->second, tx->GetWitnessHash());\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    const auto version{ptx->nVersion};\n+    if (version == 3) return std::nullopt;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors)\n+{\n+    CTxMemPool::setEntries v3_ancestors;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            v3_ancestors.insert(entry);\n+        }\n+    }\n+    return v3_ancestors;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011936854",
      "id" : 1011936854,
      "in_reply_to_id" : 983472562,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UO5W",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011936854/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011936854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011938593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011938593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Deleted, I confused myself too. Thanks",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:25:00Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+#include <policy/contract_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_pair(it->second, tx->GetWitnessHash());\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    const auto version{ptx->nVersion};\n+    if (version == 3) return std::nullopt;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors)\n+{\n+    CTxMemPool::setEntries v3_ancestors;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            v3_ancestors.insert(entry);\n+        }\n+    }\n+    return v3_ancestors;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;\n+\n+    const auto tx_vsize{GetVirtualTransactionSize(*ptx)};\n+    if (ancestors.size() + 1 > V3_ANCESTOR_LIMIT) {\n+        return strprintf(\"tx would have too many ancestors\");\n+    }\n+    const auto ancestor_vsize {std::accumulate(ancestors.cbegin(), ancestors.cend(), 0,\n+        [](int64_t sum, CTxMemPool::txiter it) { return sum + it->GetTxSize(); })};\n+    if (ancestor_vsize + tx_vsize > V3_ANCESTOR_SIZE_LIMIT_KVB * 1000) {\n+        return strprintf(\"total vsize of tx with ancestors would be too big: %u virtual bytes\", tx_vsize + ancestor_vsize);\n+    }\n+\n+    CTxMemPool::setEntries v3_ancestors{GetV3Ancestors(ancestors)};\n+\n+    // Note that this code assumes that any V3 transaction can only have 1 descendant.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011938593",
      "id" : 1011938593,
      "in_reply_to_id" : 1008171877,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UPUh",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 78,
      "original_position" : 78,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011938593/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011938593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011954857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011954857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:34:33Z",
      "diff_hunk" : "@@ -0,0 +1,99 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+#include <policy/contract_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_pair(it->second, tx->GetWitnessHash());\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    const auto version{ptx->nVersion};\n+    if (version == 3) return std::nullopt;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors)\n+{\n+    CTxMemPool::setEntries v3_ancestors;\n+    for (const auto& entry : ancestors) {\n+        if (entry->GetTx().nVersion == 3) {\n+            v3_ancestors.insert(entry);\n+        }\n+    }\n+    return v3_ancestors;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;\n+\n+    const auto tx_vsize{GetVirtualTransactionSize(*ptx)};\n+    if (ancestors.size() + 1 > V3_ANCESTOR_LIMIT) {\n+        return strprintf(\"tx would have too many ancestors\");\n+    }\n+    const auto ancestor_vsize {std::accumulate(ancestors.cbegin(), ancestors.cend(), 0,\n+        [](int64_t sum, CTxMemPool::txiter it) { return sum + it->GetTxSize(); })};\n+    if (ancestor_vsize + tx_vsize > V3_ANCESTOR_SIZE_LIMIT_KVB * 1000) {\n+        return strprintf(\"total vsize of tx with ancestors would be too big: %u virtual bytes\", tx_vsize + ancestor_vsize);\n+    }\n+\n+    CTxMemPool::setEntries v3_ancestors{GetV3Ancestors(ancestors)};\n+\n+    // Note that this code assumes that any V3 transaction can only have 1 descendant.\n+    // If there are any V3 ancestors, this is the only child allowed.\n+    if (v3_ancestors.size() > 0) {\n+        // This tx is a child of a V3 tx. To avoid RBF pinning, it can't be too large.\n+        if (tx_vsize > V3_CHILD_MAX_SIZE) {\n+            return strprintf(\"tx is too big: %u virtual bytes\", tx_vsize);\n+        }\n+    }\n+    for (const auto& entry : v3_ancestors) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011954857",
      "id" : 1011954857,
      "in_reply_to_id" : 1008172263,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UTSp",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 86,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011954857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011954857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011956687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011956687"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:36:01Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011956687",
      "id" : 1011956687,
      "in_reply_to_id" : 983462411,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UTvP",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 19,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011956687/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011956687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011956968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011956968"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed, that does sound cooler",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:36:13Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011956968",
      "id" : 1011956968,
      "in_reply_to_id" : 1004884944,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UTzo",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011956968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011956968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011957441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011957441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:36:37Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011957441",
      "id" : 1011957441,
      "in_reply_to_id" : 1004887453,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UT7B",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 30,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011957441/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011957441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011958071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011958071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed the function to take any list of transactions, so won't rename",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:37:08Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011958071",
      "id" : 1011958071,
      "in_reply_to_id" : 1004893307,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UUE3",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 38,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011958071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011958071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011959914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011959914"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:38:33Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. */\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors);\n+\n+/** Filters the ancestors, returning the ones which are nVersion=3 (\"V3 ancestors\"). */\n+CTxMemPool::setEntries GetV3Ancestors(const CTxMemPool::setEntries& ancestors);\n+\n+/** The following rules apply to V3 transactions:\n+ * 1. Tx with all of its ancestors (including non-nVersion=3) must be within V3_ANCESTOR_SIZE_LIMIT_KVB.\n+ * 2. Tx with all of its ancestors must be within V3_ANCESTOR_LIMIT.\n+ *\n+ * If a V3 tx has V3 ancestors,\n+ * 1. Each V3 ancestor and its descendants must be within V3_DESCENDANT_LIMIT.\n+ * 2. The tx must be within V3_CHILD_MAX_SIZE.\n+ */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011959914",
      "id" : 1011959914,
      "in_reply_to_id" : 1004895010,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UUhq",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 54,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011959914/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011959914",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011960079"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011960079"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done and done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:38:41Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_CONTRACT_POLICY_H\n+#define BITCOIN_POLICY_CONTRACT_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which are\n+// intended for use in contracting protocols.\n+\n+/** Maximum virtual size of a tx which spends from a V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including a tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.\n+/** Maximum number of transactions including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{DEFAULT_ANCESTOR_LIMIT};\n+/** Maximum total virtual size of transactions, in KvB, including a tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_SIZE_LIMIT_KVB{DEFAULT_ANCESTOR_SIZE_LIMIT_KVB};\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. Check this rule\n+ * for ptx and a package that may contain its unconfirmed ancestors. It's fine if ptx is one of the\n+ * transactions in the package, and it's fine if none of the transactions are ancestors of ptx.\n+ * Assumes the transactions are sorted topologically and have no conflicts, i.e.,\n+ * CheckPackage(package) passed.\n+ * @returns a pair of wtxids (parent, child) where the parent is V3 but the child is not V3, if at\n+ * least one exists. Otherwise std::nullopt.\n+ */\n+std::optional<std::pair<uint256, uint256>> CheckV3Inheritance(const Package& package);\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also have V3. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011960079",
      "id" : 1011960079,
      "in_reply_to_id" : 1004897242,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UUkP",
      "original_commit_id" : "67cc7a25d37e2d21645beda589b23222251d22d5",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/policy/contract_policy.h",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011960079/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011960079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011961178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011961178"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, unsure why I flipped the name. Fixed.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:39:32Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011961178",
      "id" : 1011961178,
      "in_reply_to_id" : 1004937926,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UU1a",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 105,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011961178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011961178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011961307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011961307"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added, thanks",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:39:38Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 2);\n+        auto v3_ancestors = GetV3Ancestors(ancestors);\n+        BOOST_CHECK(v3_ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011961307",
      "id" : 1011961307,
      "in_reply_to_id" : 1004938752,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UU3b",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 110,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011961307/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011961307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011980663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011980663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, renamed them all",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T15:54:22Z",
      "diff_hunk" : "@@ -225,6 +226,60 @@ BOOST_FIXTURE_TEST_CASE(rbf_helper_functions, TestChain100Setup)\n \n     const auto spends_conflicting_confirmed = make_tx({m_coinbase_txns[0], m_coinbase_txns[1]}, {45 * CENT});\n     BOOST_CHECK(HasNoNewUnconfirmed(*spends_conflicting_confirmed.get(), pool, {entry1, entry3}) == std::nullopt);\n+\n+    // Tests for CheckMinerScores\n+    // Don't allow replacements with a low ancestor feerate.\n+    BOOST_CHECK(CheckMinerScores(/*replacement_fees=*/entry1->GetFee(),\n+                                 /*replacement_vsize=*/entry1->GetTxSize(),\n+                                 /*ancestors=*/{entry5},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1011980663",
      "id" : 1011980663,
      "in_reply_to_id" : 1005741932,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848UZl3",
      "original_commit_id" : "5cc295b8ef46c78a093f249b70304eae3ec169b9",
      "original_line" : 235,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011980663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011980663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012013820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012013820"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because each parent needs to be below 100kvb and parent+child needs to be above 101KvB. If there's only 1 parent, then the child needs to be >1000vB to get us across 101KvB, but that is violating a different v3 rule as well.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T16:20:12Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 2);\n+        auto v3_ancestors = GetV3Ancestors(ancestors);\n+        BOOST_CHECK(v3_ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Tx spending v3 cannot have too many mempool ancestors\n+    // Configuration where the tx has too many direct parents.\n+    {\n+        std::vector<COutPoint> mempool_outpoints;\n+        mempool_outpoints.emplace_back(COutPoint{mempool_tx_v3->GetHash(), 0});\n+        mempool_outpoints.resize(25);\n+        for (size_t i{0}; i < 24; ++i) {\n+            auto mempool_tx = make_tx(random_outpoints(1), /*version=*/2);\n+            pool.addUnchecked(entry.FromTx(mempool_tx));\n+            mempool_outpoints.emplace_back(COutPoint{mempool_tx->GetHash(), 0});\n+        }\n+        auto tx_v3_many_parents = make_tx(mempool_outpoints, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_parents), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_parents, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Configuration where the tx is in a many-generation chain.\n+    auto last_outpoint{random_outpoints(1)[0]};\n+    for (size_t i{0}; i < 25; ++i) {\n+        auto mempool_tx = make_tx({last_outpoint}, /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(mempool_tx));\n+        last_outpoint = COutPoint{mempool_tx->GetHash(), 0};\n+    }\n+    {\n+        auto tx_v3_many_generation = make_tx({last_outpoint}, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_generation), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_generation, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // V3 tx cannot have too large ancestor size\n+    std::vector<COutPoint> large_mempool_outpoints;\n+    large_mempool_outpoints.resize(10);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012013820",
      "id" : 1012013820,
      "in_reply_to_id" : 1004941161,
      "line" : 184,
      "node_id" : "PRRC_kwDOABII5848Uhr8",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 184,
      "original_position" : 113,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 149,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012013820/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012013820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012036391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012036391"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T16:38:19Z",
      "diff_hunk" : "@@ -49,4 +51,159 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    uint64_t no_limit = std::numeric_limits<uint64_t>::max();\n+    std::string placeholder_str;\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    CTxMemPool::setEntries ancestors;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 2);\n+        auto v3_ancestors = GetV3Ancestors(ancestors);\n+        BOOST_CHECK(v3_ancestors.size() == 1);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, ancestors).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Tx spending v3 cannot have too many mempool ancestors\n+    // Configuration where the tx has too many direct parents.\n+    {\n+        std::vector<COutPoint> mempool_outpoints;\n+        mempool_outpoints.emplace_back(COutPoint{mempool_tx_v3->GetHash(), 0});\n+        mempool_outpoints.resize(25);\n+        for (size_t i{0}; i < 24; ++i) {\n+            auto mempool_tx = make_tx(random_outpoints(1), /*version=*/2);\n+            pool.addUnchecked(entry.FromTx(mempool_tx));\n+            mempool_outpoints.emplace_back(COutPoint{mempool_tx->GetHash(), 0});\n+        }\n+        auto tx_v3_many_parents = make_tx(mempool_outpoints, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_parents), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_parents, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // Configuration where the tx is in a many-generation chain.\n+    auto last_outpoint{random_outpoints(1)[0]};\n+    for (size_t i{0}; i < 25; ++i) {\n+        auto mempool_tx = make_tx({last_outpoint}, /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(mempool_tx));\n+        last_outpoint = COutPoint{mempool_tx->GetHash(), 0};\n+    }\n+    {\n+        auto tx_v3_many_generation = make_tx({last_outpoint}, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_many_generation), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 25);\n+        BOOST_CHECK(ancestors.size() + 1 > V3_ANCESTOR_LIMIT);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_many_generation, ancestors, empty_conflicts_set).has_value());\n+        ancestors.clear();\n+    }\n+\n+    // V3 tx cannot have too large ancestor size\n+    std::vector<COutPoint> large_mempool_outpoints;\n+    large_mempool_outpoints.resize(10);\n+    for (size_t i{0}; i < 10; ++i) {\n+        auto large_mempool_tx = make_tx(random_outpoints(200), /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(large_mempool_tx));\n+        large_mempool_outpoints.emplace_back(COutPoint{large_mempool_tx->GetHash(), 0});\n+    }\n+    {\n+        auto tx_v3_large_parents = make_tx(large_mempool_outpoints, /*version=*/3);\n+        pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_large_parents), ancestors, no_limit, no_limit, no_limit, no_limit, placeholder_str);\n+        BOOST_CHECK(ancestors.size() == 10);\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_large_parents, ancestors, empty_conflicts_set).has_value());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012036391",
      "id" : 1012036391,
      "in_reply_to_id" : 1004942013,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII5848UnMn",
      "original_commit_id" : "4b8176b96b991245ae831db8c3692b4f225df6c5",
      "original_line" : 206,
      "original_position" : 123,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 171,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012036391/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012036391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012039568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012039568"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(just noting to remember) This lets through un-paid-for RBFs for single tx packages, as well as bypasses conflict set creation, leading to internally-inconsistent mempool",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T16:40:57Z",
      "diff_hunk" : "@@ -1245,7 +1367,7 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n     // because it's unnecessary. Also, CPFP carve out can increase the limit for individual\n     // transactions, but this exemption is not extended to packages in CheckPackageLimits().\n     std::string err_string;\n-    if (txns.size() > 1 && !PackageMempoolChecks(txns, package_state)) {\n+    if (txns.size() > 1 && !PackageMempoolChecks(args, txns, workspaces, package_state)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012039568",
      "id" : 1012039568,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Un-Q",
      "original_commit_id" : "18076ccda8351b08e8c27613f3a2f92228110ede",
      "original_line" : 1370,
      "original_position" : 445,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1165637368,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012039568/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-02T17:00:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012039568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012083181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012083181"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, thank you :hugs:. Dumb size > 1 rule.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T17:20:29Z",
      "diff_hunk" : "@@ -1245,7 +1367,7 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n     // because it's unnecessary. Also, CPFP carve out can increase the limit for individual\n     // transactions, but this exemption is not extended to packages in CheckPackageLimits().\n     std::string err_string;\n-    if (txns.size() > 1 && !PackageMempoolChecks(txns, package_state)) {\n+    if (txns.size() > 1 && !PackageMempoolChecks(args, txns, workspaces, package_state)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012083181",
      "id" : 1012083181,
      "in_reply_to_id" : 1012039568,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Uynt",
      "original_commit_id" : "18076ccda8351b08e8c27613f3a2f92228110ede",
      "original_line" : 1370,
      "original_position" : 445,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012083181/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012083181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012083572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012083572"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Split into subtests and mining in between",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-02T17:20:52Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1012083572",
      "id" : 1012083572,
      "in_reply_to_id" : 1004964328,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Uyt0",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 74,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012083572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012083572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013108655"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013108655"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:03:31Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013108655",
      "id" : 1013108655,
      "in_reply_to_id" : 1004960576,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII5848Ys-v",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 94,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 94,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013108655/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013108655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013109134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013109134"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree that's better, added `check_mempool` everywhere.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:03:52Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013109134",
      "id" : 1013109134,
      "in_reply_to_id" : 1004963312,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848YtGO",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013109134/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013109134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013111919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013111919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Removed",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:06:10Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013111919",
      "id" : 1013111919,
      "in_reply_to_id" : 1004965337,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Ytxv",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 100,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013111919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013111919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013116608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013116608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Changed `tx_v3_almost_heavy` to be *just* in",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:10:09Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 4,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions that don't signal BIP125 are replaceable\")\n+        utxo_v3_no_bip125 = self.wallet.get_utxo()\n+        tx_v3_no_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE + 1,\n+            version=3\n+        )\n+\n+        assert node.getmempoolentry(tx_v3_no_bip125[\"txid\"])\n+        assert not node.getmempoolentry(tx_v3_no_bip125[\"txid\"])[\"bip125-replaceable\"]\n+        tx_v3_no_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_no_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_no_bip125[\"txid\"])\n+\n+        self.log.info(\"Test a child of a V3 transaction cannot be more than 1000vB\")\n+        self.restart_node(0, extra_args=[\"-datacarriersize=1000\"])\n+        tx_v3_parent_normal = self.wallet.send_self_transfer(from_node=node, version=3)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013116608",
      "id" : 1013116608,
      "in_reply_to_id" : 1004968938,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Yu7A",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 132,
      "original_position" : 132,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013116608/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013116608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013117124"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013117124"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, it's now \"v3-tx-nonstandard, v3 child tx is too big\"",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:10:35Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 4,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions that don't signal BIP125 are replaceable\")\n+        utxo_v3_no_bip125 = self.wallet.get_utxo()\n+        tx_v3_no_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE + 1,\n+            version=3\n+        )\n+\n+        assert node.getmempoolentry(tx_v3_no_bip125[\"txid\"])\n+        assert not node.getmempoolentry(tx_v3_no_bip125[\"txid\"])[\"bip125-replaceable\"]\n+        tx_v3_no_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_no_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_no_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_no_bip125[\"txid\"])\n+\n+        self.log.info(\"Test a child of a V3 transaction cannot be more than 1000vB\")\n+        self.restart_node(0, extra_args=[\"-datacarriersize=1000\"])\n+        tx_v3_parent_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        tx_v3_child_heavy = self.wallet.create_self_transfer(\n+            utxo_to_spend=tx_v3_parent_normal[\"new_utxo\"],\n+            target_weight=4004,\n+            version=3\n+        )\n+        assert_greater_than_or_equal(tx_v3_child_heavy[\"tx\"].get_vsize(), 1000)\n+        assert_raises_rpc_error(-26, \"nonstandard\", node.sendrawtransaction, tx_v3_child_heavy[\"hex\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013117124",
      "id" : 1013117124,
      "in_reply_to_id" : 1004968205,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848YvDE",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 139,
      "original_position" : 139,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013117124/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013117124",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013117540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013117540"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree that's better, added `check_mempool` that does this everywhere.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:10:58Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013117540",
      "id" : 1013117540,
      "in_reply_to_id" : 1004963312,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848YvJk",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013117540/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013117540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013119709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013119709"
         }
      },
      "author_association" : "MEMBER",
      "body" : "added \"between packages\"",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T16:12:31Z",
      "diff_hunk" : "@@ -0,0 +1,316 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from decimal import Decimal\n+from random import choice\n+\n+from test_framework.messages import (\n+    COIN,\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class PackageRBFTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def assert_mempool_contents(self, expected=None, unexpected=None):\n+        \"\"\"Assert that all transactions in expected are in the mempool,\n+        and all transactions in unexpected are not in the mempool.\n+        \"\"\"\n+        if not expected:\n+            expected = []\n+        if not unexpected:\n+            unexpected = []\n+        assert set(unexpected).isdisjoint(expected)\n+        mempool = self.nodes[0].getrawmempool(verbose=False)\n+        for tx in expected:\n+            assert tx.rehash() in mempool\n+        for tx in unexpected:\n+            assert tx.rehash() not in mempool\n+\n+    def create_simple_package(self, parent_coins, parent_fee=0, child_fee=DEFAULT_FEE, heavy_child=False, version=3):\n+        \"\"\"Create a child-with-parents package using the parent_coins passed in.\n+        Each coin in parent_coins will be used to fund 1 parent transaction.\n+        Each parent will have 1 output. The parents' outputs will be used to fund 1 child\n+        transaction. Thus, the package will contain len(parent_coins) + 1 transactions.\n+        All transactions signal BIP125 replaceability, but nSequence changes based on self.ctr.\n+\n+        returns tuple (hex serialized txns, CTransaction objects)\n+        \"\"\"\n+        self.ctr += 1\n+        package_hex = []\n+        package_txns = []\n+        child_inputs = []\n+        # Use fee_rate=0 because create_self_transfer will use the default fee_rate value otherwise.\n+        # Passing in fee>0 overrides fee_rate, so this still works for non-zero parent_fee.\n+        for coin in parent_coins:\n+            parent_result = self.wallet.create_self_transfer(\n+                fee_rate=0,\n+                fee=parent_fee,\n+                utxo_to_spend=coin,\n+                sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr, # prevent identical txids",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013119709",
      "id" : 1013119709,
      "in_reply_to_id" : 1005841411,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Yvrd",
      "original_commit_id" : "f48315af9c3497bd725a5a8964add802bd20cb03",
      "original_line" : 63,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_package_rbf.py",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013119709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013119709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013182523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013182523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Rewritten",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T17:01:29Z",
      "diff_hunk" : "@@ -1005,16 +1009,93 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n     // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n     // PreChecks), they do not apply here.\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Transactions must pay for their own replacements unless they are V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013182523",
      "id" : 1013182523,
      "in_reply_to_id" : 1005755274,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848Y_A7",
      "original_commit_id" : "7cbe926e13f802e372bf140594182a7a2c0d2f1e",
      "original_line" : 1033,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013182523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013182523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013188155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013188155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T17:06:08Z",
      "diff_hunk" : "@@ -0,0 +1,167 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.messages import (\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class MempoolAcceptV3(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def run_test(self):\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 10)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+\n+        self.log.info(\"Test acceptance of V3 transactions\")\n+        tx_v3_normal = self.wallet.send_self_transfer(from_node=node, version=3)\n+        assert node.getmempoolentry(tx_v3_normal[\"txid\"])\n+\n+        self.log.info(\"Test a child of V3 transaction must also be V3\")\n+        tx_child_v2 = self.wallet.create_self_transfer(utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=2)\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_child_v2[\"hex\"])\n+\n+        tx_child_v3 = self.wallet.send_self_transfer(from_node=node, utxo_to_spend=tx_v3_normal[\"new_utxo\"], version=3)\n+        assert node.getmempoolentry(tx_child_v3[\"txid\"])\n+\n+        self.log.info(\"Test a V3 transaction cannot have more than 1 descendant\")\n+        tx_grandchild_v3 = self.wallet.create_self_transfer(utxo_to_spend=tx_child_v3[\"new_utxo\"], version=3)\n+        assert_raises_rpc_error(-26, \"would exceed descendant count limit\", node.sendrawtransaction, tx_grandchild_v3[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V3 transactions\")\n+        utxo_v3_bip125 = self.wallet.get_utxo()\n+        tx_v3_bip125 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_bip125,\n+            sequence=MAX_BIP125_RBF_SEQUENCE,\n+            version=3\n+        )\n+\n+        tx_v3_bip125_rbf = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf[\"txid\"])\n+        assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, tx_v3_bip125[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 3,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test that replacements cannot cause violation of inherited V3\")\n+        utxo_v3_parent = self.wallet.get_utxo()\n+        tx_v3_parent = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=utxo_v3_parent,\n+            version=3\n+        )\n+        tx_v3_child = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=3\n+        )\n+        assert node.getmempoolentry(tx_v3_parent[\"txid\"])\n+        assert node.getmempoolentry(tx_v3_child[\"txid\"])\n+\n+        tx_v3_child_rbf_v2 = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE * 2,\n+            utxo_to_spend=tx_v3_parent[\"new_utxo\"],\n+            version=2\n+        )\n+        assert_raises_rpc_error(-26, \"non-v3-tx-spends-v3\", node.sendrawtransaction, tx_v3_child_rbf_v2[\"hex\"])\n+\n+        self.log.info(\"Test V3 transactions may be replaced by V2 transactions\")\n+        tx_v3_bip125_rbf_v2 = self.wallet.send_self_transfer(\n+            from_node=node,\n+            fee_rate=DEFAULT_FEE * 4,\n+            utxo_to_spend=utxo_v3_bip125,\n+            version=2\n+        )\n+        assert node.getmempoolentry(tx_v3_bip125_rbf_v2[\"txid\"])\n+\n+        self.log.info(\"Test V3 transactions that don't signal BIP125 are replaceable\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013188155",
      "id" : 1013188155,
      "in_reply_to_id" : 1004966712,
      "line" : 149,
      "node_id" : "PRRC_kwDOABII5848ZAY7",
      "original_commit_id" : "c11fb499f182306f635ea9457ec4574b2992e185",
      "original_line" : 149,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 149,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013188155/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013188155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013193800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013193800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Exactly. Edited the comment.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T17:11:26Z",
      "diff_hunk" : "@@ -1005,16 +1009,93 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n     // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n     // PreChecks), they do not apply here.\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the\n+        // to-be-replaced mempool entries when counting descendants. Note that this is not\n+        // necessarily as simple as subtracting the count/size from descendant limits, because\n+        // multiple transactions may conflict with the same entries, causing us to double-count them\n+        // and their descendants.\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Transactions must pay for their own replacements unless they are V3.\n+    if (args.m_package_feerates) {\n+        for (const auto& ws : workspaces) {\n+            // If this transaction has a conflict, it must be V3.\n+            if (!ws.m_iters_conflicting.empty() && ws.m_ptx->nVersion != 3) {\n+                return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package RBF failed: V3 required\");\n+            }\n+        }\n+    }\n+\n+    CTxMemPool::setEntries direct_conflict_iters;\n+    for (Workspace& ws : workspaces) {\n+        // Aggregate all conflicts into one set.\n+        direct_conflict_iters.merge(ws.m_iters_conflicting);\n+    }\n+\n+    // Use the child as the transaction for attributing errors to.\n+    const auto hash = workspaces[workspaces.size() - 1].m_ptx->GetHash();\n+    const CFeeRate package_feerate(m_total_modified_fees, m_total_vsize);\n+\n+    // Calculate all conflicting entries and enforce Rules 2 and 5.\n+    for (Workspace& ws : workspaces) {\n+        // The aggregated set of conflicts cannot exceed 100.\n+        if (const auto err_string{GetEntriesForConflicts(*ws.m_ptx, m_pool, direct_conflict_iters,\n+                                                         m_all_conflicts)}) {\n+            return package_state.Invalid(PackageValidationResult::PCKG_POLICY,\n+                                         \"package RBF failed: too many potential replacements\", *err_string);\n+        }\n+    }\n+\n+    // Check that the union of all collective conflicts and ancestors is disjoint.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013193800",
      "id" : 1013193800,
      "in_reply_to_id" : 1005833244,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848ZBxI",
      "original_commit_id" : "7cbe926e13f802e372bf140594182a7a2c0d2f1e",
      "original_line" : 1063,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1165464616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013193800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:15:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013193800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013217154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013217154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped the commit and replaced with a big comment, since the bug is not possible when package RBF requires v3.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T17:33:04Z",
      "diff_hunk" : "@@ -1182,7 +1197,7 @@ MempoolAcceptResult MemPoolAccept::AcceptSingleTransaction(const CTransactionRef\n     AssertLockHeld(cs_main);\n     LOCK(m_pool.cs); // mempool \"read lock\" (held through GetMainSignals().TransactionAddedToMempool())\n \n-    Workspace ws(ptx);\n+    Workspace ws(ptx, m_limit_descendants, m_limit_descendant_size);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013217154",
      "id" : 1013217154,
      "in_reply_to_id" : 1005720112,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848ZHeC",
      "original_commit_id" : "dd8d0af4a27bf4c299a1af8de4dbe0c139dba730",
      "original_line" : 1200,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1167401662,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013217154/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013217154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013218218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013218218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Deleted this particular comment since the TODO is no longer necessary while package RBF requires v3.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T17:34:09Z",
      "diff_hunk" : "@@ -1005,16 +1009,93 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     // Note that the MemPoolAccept::m_limit_descendants, not Workspace::m_tx_limit_descendants, are\n     // used as descendant limits. If any extra descendant carveouts were granted (see comments in\n     // PreChecks), they do not apply here.\n     if (!m_pool.CheckPackageLimits(txns, m_limit_ancestors, m_limit_ancestor_size, m_limit_descendants,\n                                    m_limit_descendant_size, err_string)) {\n+        // TODO: When replacements exist, to avoid overestimating descendant counts, deduct the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013218218",
      "id" : 1013218218,
      "in_reply_to_id" : 1005748598,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5848ZHuq",
      "original_commit_id" : "7cbe926e13f802e372bf140594182a7a2c0d2f1e",
      "original_line" : 1024,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1167403227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013218218/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013218218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013222930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013222930"
         }
      },
      "author_association" : "MEMBER",
      "body" : "errr, the same code path hits here :)\r\n",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T17:39:18Z",
      "diff_hunk" : "@@ -969,12 +1056,98 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limits, err_string)) {\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Unless the transaction is V3, its own fees must meet the requirements for replacing its conflicts.\n+    if (args.m_package_feerates) {\n+        for (const auto& ws : workspaces) {\n+            // If this transaction has a conflict, it must be V3.\n+            if (!ws.m_iters_conflicting.empty() && ws.m_ptx->nVersion != 3) {\n+                return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package RBF failed: V3 required\");\n+            }\n+        }\n+    }\n+\n+    CTxMemPool::setEntries direct_conflict_iters;\n+    for (Workspace& ws : workspaces) {\n+        // Aggregate all conflicts into one set.\n+        direct_conflict_iters.merge(ws.m_iters_conflicting);\n+    }\n+\n+    // Use the child as the transaction for attributing errors to.\n+    const auto hash = workspaces[workspaces.size() - 1].m_ptx->GetHash();\n+    const CFeeRate package_feerate(m_total_modified_fees, m_total_vsize);\n+\n+    // Calculate all conflicting entries and enforce Rules 2 and 5.\n+    for (Workspace& ws : workspaces) {\n+        // The aggregated set of conflicts cannot exceed 100.\n+        if (const auto err_string{GetEntriesForConflicts(*ws.m_ptx, m_pool, direct_conflict_iters,\n+                                                         m_all_conflicts)}) {\n+            return package_state.Invalid(PackageValidationResult::PCKG_POLICY,\n+                                         \"package RBF failed: too many potential replacements\", *err_string);\n+        }\n+    }\n+\n+    // Make sure none of the package transactions depend on a mempool transaction that is going to be replaced.\n+    std::set<uint256> all_conflicting_txids;\n+    std::transform(m_all_conflicts.cbegin(), m_all_conflicts.cend(),\n+                   std::inserter(all_conflicting_txids, all_conflicting_txids.end()),\n+                   [](const auto& entry) { return entry->GetTx().GetHash(); });\n+    if (const auto err_string{EntriesAndTxidsDisjoint(m_collective_ancestors, all_conflicting_txids, hash)}) {\n+        // Note that we handle this differently in individual transaction validation (a transaction\n+        // that conflicts with its own dependency is inconsistent, but this could just be\n+        // conflicting transactions in a package).\n+        return package_state.Invalid(PackageValidationResult::PCKG_POLICY,\n+                                     \"package RBF failed: package conflicts with dependency\", *err_string);\n+    }\n+\n+    // CheckMinerScores is very conservative and should not be used for individual transactions.\n+    // For example, the mempool contains a large, low-feerate transaction A (99,000vB, 1sat/vB feerate) is\n+    // Transaction A has a small, high-feerate child B (1,000vB, 101sat/vB). The user wants to\n+    // further bump A+B by replacing B with an even higher feerate transaction, B'. If\n+    // CheckMinerScores is enforced, then B' needs an ancestor score higher than the individual\n+    // feerate of its directly conflicting transaction, B, which is 101sat/vB, This is extremely\n+    // expensive since the ancestor feerate includes A (101sat/vB * 99,000vB).\n+    // On the other hand, CheckMinerScores is fine if A+B is to be replaced by A'+B' (where A' is a\n+    // transaction that conflicts with A) because the directly conflicting transaction A, has a low\n+    // individual feerate.\n+    // As such, it's also important to ensure that we don't apply CheckMinerScores() to individual\n+    // transactions that were submitted as a package (e.g. if it's the only transaction left after\n+    // deduplication in AcceptPackage()).\n+    Assume(txns.size() > 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013222930",
      "id" : 1013222930,
      "line" : 1131,
      "node_id" : "PRRC_kwDOABII5848ZI4S",
      "original_commit_id" : "78333c1cde5b3c71f663ff861d8464430fb1ca74",
      "original_line" : 1131,
      "original_position" : 401,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 401,
      "pull_request_review_id" : 1167410333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013222930/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T17:39:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013222930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013244365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013244365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops I lost a commit on the floor, thanks.\r\nI think this assumption should hold true now? `AcceptPackage` should now be calling `AcceptSingleTransaction`, not `AcceptMultipleTransactions` when there's only 1 tx left. Which means there should always be more than 1 tx when we get here.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T18:01:56Z",
      "diff_hunk" : "@@ -969,12 +1056,98 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limits, err_string)) {\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Unless the transaction is V3, its own fees must meet the requirements for replacing its conflicts.\n+    if (args.m_package_feerates) {\n+        for (const auto& ws : workspaces) {\n+            // If this transaction has a conflict, it must be V3.\n+            if (!ws.m_iters_conflicting.empty() && ws.m_ptx->nVersion != 3) {\n+                return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package RBF failed: V3 required\");\n+            }\n+        }\n+    }\n+\n+    CTxMemPool::setEntries direct_conflict_iters;\n+    for (Workspace& ws : workspaces) {\n+        // Aggregate all conflicts into one set.\n+        direct_conflict_iters.merge(ws.m_iters_conflicting);\n+    }\n+\n+    // Use the child as the transaction for attributing errors to.\n+    const auto hash = workspaces[workspaces.size() - 1].m_ptx->GetHash();\n+    const CFeeRate package_feerate(m_total_modified_fees, m_total_vsize);\n+\n+    // Calculate all conflicting entries and enforce Rules 2 and 5.\n+    for (Workspace& ws : workspaces) {\n+        // The aggregated set of conflicts cannot exceed 100.\n+        if (const auto err_string{GetEntriesForConflicts(*ws.m_ptx, m_pool, direct_conflict_iters,\n+                                                         m_all_conflicts)}) {\n+            return package_state.Invalid(PackageValidationResult::PCKG_POLICY,\n+                                         \"package RBF failed: too many potential replacements\", *err_string);\n+        }\n+    }\n+\n+    // Make sure none of the package transactions depend on a mempool transaction that is going to be replaced.\n+    std::set<uint256> all_conflicting_txids;\n+    std::transform(m_all_conflicts.cbegin(), m_all_conflicts.cend(),\n+                   std::inserter(all_conflicting_txids, all_conflicting_txids.end()),\n+                   [](const auto& entry) { return entry->GetTx().GetHash(); });\n+    if (const auto err_string{EntriesAndTxidsDisjoint(m_collective_ancestors, all_conflicting_txids, hash)}) {\n+        // Note that we handle this differently in individual transaction validation (a transaction\n+        // that conflicts with its own dependency is inconsistent, but this could just be\n+        // conflicting transactions in a package).\n+        return package_state.Invalid(PackageValidationResult::PCKG_POLICY,\n+                                     \"package RBF failed: package conflicts with dependency\", *err_string);\n+    }\n+\n+    // CheckMinerScores is very conservative and should not be used for individual transactions.\n+    // For example, the mempool contains a large, low-feerate transaction A (99,000vB, 1sat/vB feerate) is\n+    // Transaction A has a small, high-feerate child B (1,000vB, 101sat/vB). The user wants to\n+    // further bump A+B by replacing B with an even higher feerate transaction, B'. If\n+    // CheckMinerScores is enforced, then B' needs an ancestor score higher than the individual\n+    // feerate of its directly conflicting transaction, B, which is 101sat/vB, This is extremely\n+    // expensive since the ancestor feerate includes A (101sat/vB * 99,000vB).\n+    // On the other hand, CheckMinerScores is fine if A+B is to be replaced by A'+B' (where A' is a\n+    // transaction that conflicts with A) because the directly conflicting transaction A, has a low\n+    // individual feerate.\n+    // As such, it's also important to ensure that we don't apply CheckMinerScores() to individual\n+    // transactions that were submitted as a package (e.g. if it's the only transaction left after\n+    // deduplication in AcceptPackage()).\n+    Assume(txns.size() > 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013244365",
      "id" : 1013244365,
      "in_reply_to_id" : 1013222930,
      "line" : 1131,
      "node_id" : "PRRC_kwDOABII5848ZOHN",
      "original_commit_id" : "78333c1cde5b3c71f663ff861d8464430fb1ca74",
      "original_line" : 1131,
      "original_position" : 401,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 401,
      "pull_request_review_id" : 1167441773,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013244365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T18:01:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013244365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013293248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013293248"
         }
      },
      "author_association" : "MEMBER",
      "body" : "no results are being pushed here, which seems to mean we'll hit `NONFATAL_UNREACHABLE` in the switch statement in `submitpackage` RPC with a tx that doesn't hit the above two conditions.\r\n\r\ne.g., a non-standard script",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T18:57:02Z",
      "diff_hunk" : "@@ -1379,6 +1570,7 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013293248",
      "id" : 1013293248,
      "line" : 1573,
      "node_id" : "PRRC_kwDOABII5848ZaDA",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 1573,
      "original_position" : 589,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 589,
      "pull_request_review_id" : 1167512793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013293248/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T18:57:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013293248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013300039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013300039"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n                results.emplace(wtxid, single_res);\r\n                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\r\n```",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-03T19:05:02Z",
      "diff_hunk" : "@@ -1379,6 +1570,7 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1013300039",
      "id" : 1013300039,
      "line" : 1573,
      "node_id" : "PRRC_kwDOABII5848ZbtH",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 1573,
      "original_position" : 589,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 589,
      "pull_request_review_id" : 1167522786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013300039/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-03T19:05:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013300039",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1014124669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014124669"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes good point, I think this is correct.",
      "commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "created_at" : "2022-11-04T14:54:46Z",
      "diff_hunk" : "@@ -1379,6 +1570,7 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1014124669",
      "id" : 1014124669,
      "in_reply_to_id" : 1013300039,
      "line" : 1573,
      "node_id" : "PRRC_kwDOABII5848clB9",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 1573,
      "original_position" : 589,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 589,
      "pull_request_review_id" : 1168688530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014124669/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-04T14:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014124669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1014284608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014284608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "some related discussion on estimating mining score of the replacement: https://github.com/bitcoin/bitcoin/pull/26451#issuecomment-1303889425\r\n",
      "commit_id" : "ae47e5d5f8564f8fae7ac8d671cbb8ef20af3d16",
      "created_at" : "2022-11-04T17:19:19Z",
      "diff_hunk" : "@@ -181,3 +181,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1014284608",
      "id" : 1014284608,
      "line" : 185,
      "node_id" : "PRRC_kwDOABII5848dMFA",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 185,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 5,
      "pull_request_review_id" : 1168927850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014284608/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-04T17:19:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014284608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Adding a note here: \r\n\r\nif we're doing nVersion 3, we should also fix the lack of discouragement for uninterpreted nSequence values and arguments to CSV/CLTV. see https://github.com/bitcoin/bitcoin/pull/22871",
      "created_at" : "2022-11-04T18:26:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1303979737",
      "id" : 1303979737,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585NuSbZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303979737/reactions"
      },
      "updated_at" : "2022-11-04T18:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303979737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=4",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "node_id" : "MDQ6VXNlcjg4NjUyMw==",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This is mentioned in a few other places, but Rule 3 pinning via additional ancestor is still not resolved with the multi-parent-1-child case. Quick diagram to illustrate - this was pointed out to me by @instagibbs.\r\n\r\n![image](https://user-images.githubusercontent.com/25183001/202760386-96466fd8-659b-40fe-a943-529fcdd8dd84.png)\r\n\r\nWorking on further restricting the rules to 1-parent-1-child since that eliminates the possibility of a conflict's high fees diluted by ancestors. Will add more tests as well, and then will take out of draft when finished.\r\n\r\n> if we're doing nVersion 3, we should also fix the lack of discouragement for uninterpreted nSequence values and arguments to CSV/CLTV. see https://github.com/bitcoin/bitcoin/pull/22871\r\n\r\nWill consider adding this if people feel strongly. Wondering if others on this thread have thoughts on it?",
      "created_at" : "2022-11-18T17:07:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1320295394",
      "id" : 1320295394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585Oshvi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320295394/reactions"
      },
      "updated_at" : "2022-11-18T17:08:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320295394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1026687216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026687216"
         }
      },
      "author_association" : "NONE",
      "body" : "You will have to find the best way to go about making it understanding for you it's like c++ not everyone nos how to use it so they find the eazyist way for them selfs to move on iam Satoshi an it's been 13 years I have not work on aney thing so it's all new to me agin but we will make do an move on let other no I'm back not to change anything or not to be in the spot light but I'm am alive an people need to stop trying to break in to my address with my Bitcoin I will never make Bitcoin go under an inflashion can disrupt the hole world an I won't peace in the world.",
      "commit_id" : "ae47e5d5f8564f8fae7ac8d671cbb8ef20af3d16",
      "created_at" : "2022-11-18T17:17:20Z",
      "diff_hunk" : "@@ -117,3 +118,30 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+Child-with-unconfirmed-parents packages may replace mempool transactions under the following conditions:\n+\n+1. The child transaction does not conflict with any transactions in the mempool.\n+\n+2. The directly conflicting transactions all signal replaceability explicitly.\n+\n+3. All transactions in the package, including those that do not directly conflict with any mempool\n+   transactions, only include an unconfirmed input if that input was included in one of the directly\n+   conflicting transactions or is from another transaction in the package.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1026687216",
      "id" : 1026687216,
      "in_reply_to_id" : 869152001,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849MgDw",
      "original_commit_id" : "abef97a6945df9f98d2c3a67bc2b1cbf0225fdbf",
      "original_line" : 132,
      "original_position" : 40,
      "original_start_line" : 130,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1186490192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026687216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2022-11-18T17:17:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026687216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/52026165?v=4",
         "events_url" : "https://api.github.com/users/andrew66626/events{/privacy}",
         "followers_url" : "https://api.github.com/users/andrew66626/followers",
         "following_url" : "https://api.github.com/users/andrew66626/following{/other_user}",
         "gists_url" : "https://api.github.com/users/andrew66626/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/andrew66626",
         "id" : 52026165,
         "login" : "andrew66626",
         "node_id" : "MDQ6VXNlcjUyMDI2MTY1",
         "organizations_url" : "https://api.github.com/users/andrew66626/orgs",
         "received_events_url" : "https://api.github.com/users/andrew66626/received_events",
         "repos_url" : "https://api.github.com/users/andrew66626/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/andrew66626/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/andrew66626/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/andrew66626"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-11-28T13:23:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1329085025",
      "id" : 1329085025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585PODph",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329085025/reactions"
      },
      "updated_at" : "2022-11-28T13:23:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329085025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034177919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034177919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In the light of the discrepancy between BIP125 and our mempool code, I think this should precise if we mean explicit signaling only or explicit signaling+inherited signaling.",
      "commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "created_at" : "2022-11-29T00:17:21Z",
      "diff_hunk" : "@@ -117,3 +123,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted if the replacement transaction is accepted.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034177919",
      "id" : 1034177919,
      "line" : 154,
      "node_id" : "PRRC_kwDOABII5849pE1_",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 154,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 73,
      "pull_request_review_id" : 1196723893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034177919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T01:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034177919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034180693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034180693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This should precise if the mempool conflicts are required to be V3 themselves. From my memory of the mailing list discussions and elsewhere, I think the current state of thinking, directly conflicting transactions versions number are not considered.\r\n\r\nFor the Lightning use-case, this is a significant security advantage as the ~80k of public channels, with all pre-signed revoked commitment transactions V2 can be replaced with newer version=3 package. Revoked commitment transactions, even if the honest counterparty is in knowledge of the revocation secret, are still consensus and policy valid transactions, and as such can be leveraged as pinning means.\r\n\r\nOn the other hand, I think allowing V3 to replace V2 chain of transactions lead to the consequence than V2 users are implicitly subscribing to this new replacement regime. A receiver of a V2 transaction could apply the BIP125 rules to estimate the replacement odd of the transaction, and the application logic be broken when the actual rule 3 of minimum between package feerate and ancestor feerate is applied. I don't know if we're significantly interfering with any Bitcoin application here.",
      "commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "created_at" : "2022-11-29T00:23:16Z",
      "diff_hunk" : "@@ -117,3 +123,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted if the replacement transaction is accepted.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034180693",
      "id" : 1034180693,
      "line" : 142,
      "node_id" : "PRRC_kwDOABII5849pFhV",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 142,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 61,
      "pull_request_review_id" : 1196723893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034180693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T01:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034180693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034188179"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034188179"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If we would like to add more rational to the design of the rules, we could explain why a scorched earth approach would solve the Lightning case really imperfectly (discussed recently here: https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-November/021176.html). Indeed, Lightning implementation could just blindly replace-by-fee the pinning transactions, paying up to the channel value. This wouldn't work at all against an attacker pinning with one single malicious transaction multiple channel from different parties where the malicious transaction fee is above the value of each channel. E.g channel A 10000 sats, channel B 25000 sats and channel C 8000 sats. If the malicious pinning transactions fee equals 26000 sats, none of the honest party will rationally fee-bump more than their own channel value. \r\n\r\nFeerate-only replacement rules scales up to the maximum package size and worst historical mempool reduce consideraly the fee-bumping reserves requirement for a LN node, which is a notable advantage I think.",
      "commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "created_at" : "2022-11-29T00:39:55Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034188179",
      "id" : 1034188179,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII5849pHWT",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 33,
      "pull_request_review_id" : 1196723893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034188179/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T01:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034188179",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034196433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034196433"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it could be precised if those rules are still applied in case of reorg and a V2 ancestor transaction comes back in the mempool, if the V3 child package should be evicted or conserved. In the case it's evicted, you have to consider LN V3 package being evicted and as a LN node you should resuscitate the V2, fee-bump it again, wait for confirmation and then re-broadcast your V3 package. ",
      "commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "created_at" : "2022-11-29T00:57:32Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+See example #1 in [\"Rule 3\" Pining](#Rule-3-Pinning) section above.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+5. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be\n+replaced. With default limits, if the child is e.g. 100,000vB, that might be an additional\n+100,000sats (at 1sat/vbyte) or more, depending on the feerate. Restricting all children to 1000vB\n+bounds the potential fees by 1/100.\n+\n+*Rationale*: (lower bound) the smaller this limit, the fewer UTXOs a child may use to fund this\n+fee-bump. For example, only allowing the V3 child to have 2 inputs would require L2 protocols to\n+manage a wallet with high-value UTXOs and make batched fee-bumping impossible. However, as the\n+fee-bumping child only needs to fund fees (as opposed to payments), just a few UTXOs should suffice.\n+\n+*Rationale*: With a limit of 1000 virtual bytes, depending on the output types, the child can have\n+6-15 UTXOs, which should be enough to fund a fee-bump without requiring a carefully-managed UTXO\n+pool. With 1000 virtual bytes as the descendant limit, the cost to replace a V3 transaction has much\n+lower variance.\n+\n+*Rationale*: This makes the rule very easily \"tacked on\" to existing logic for policy and wallets.\n+A transaction may be up to 100KvB on its own (`MAX_STANDARD_TX_WEIGHT`) and 101KvB with descendants\n+(`DEFAULT_DESCENDANT_SIZE_LIMIT_KVB`). If an existing V3 transaction in the mempool is 100KvB, its\n+descendant can only be 1000vB, even if the policy is 10KvB.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed ancestor.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034196433",
      "id" : 1034196433,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5849pJXR",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 97,
      "pull_request_review_id" : 1196723893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034196433/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T01:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034196433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034208537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034208537"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this implies that any 0conf acceptance softwares should be upgraded to tread V3 transactions by default as replaecable. I would say it could be valuable to notify the operators of such services.",
      "commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "created_at" : "2022-11-29T01:23:22Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034208537",
      "id" : 1034208537,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII5849pMUZ",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 40,
      "pull_request_review_id" : 1196723893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034208537/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T01:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034208537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034211904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034211904"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, I think this could be a minor issue for LN implementation. If some of your counterparties have not upgraded their software to support V3 transactions you might have a subset of your channel transaction still under V2 during the transition period. If you have a common child for batched fee-bumping shared between a V2 commitment transaction and V3 commitment transaction, the whole operation is likely to fail. Of course, batch fee-bumping should be considered harmful for time-sensitive commitment transactions (i.e ones with HTLC outputs) though we might have further silent issues even when it's not time-sensitive. In my opinion, this is a potential issue LN devs should be aware of, processing between V2 and V3 channels should be well isolated. ",
      "commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "created_at" : "2022-11-29T01:30:20Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+See example #1 in [\"Rule 3\" Pining](#Rule-3-Pinning) section above.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+5. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be\n+replaced. With default limits, if the child is e.g. 100,000vB, that might be an additional\n+100,000sats (at 1sat/vbyte) or more, depending on the feerate. Restricting all children to 1000vB\n+bounds the potential fees by 1/100.\n+\n+*Rationale*: (lower bound) the smaller this limit, the fewer UTXOs a child may use to fund this\n+fee-bump. For example, only allowing the V3 child to have 2 inputs would require L2 protocols to\n+manage a wallet with high-value UTXOs and make batched fee-bumping impossible. However, as the\n+fee-bumping child only needs to fund fees (as opposed to payments), just a few UTXOs should suffice.\n+\n+*Rationale*: With a limit of 1000 virtual bytes, depending on the output types, the child can have\n+6-15 UTXOs, which should be enough to fund a fee-bump without requiring a carefully-managed UTXO\n+pool. With 1000 virtual bytes as the descendant limit, the cost to replace a V3 transaction has much\n+lower variance.\n+\n+*Rationale*: This makes the rule very easily \"tacked on\" to existing logic for policy and wallets.\n+A transaction may be up to 100KvB on its own (`MAX_STANDARD_TX_WEIGHT`) and 101KvB with descendants\n+(`DEFAULT_DESCENDANT_SIZE_LIMIT_KVB`). If an existing V3 transaction in the mempool is 100KvB, its\n+descendant can only be 1000vB, even if the policy is 10KvB.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed ancestor.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034211904",
      "id" : 1034211904,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5849pNJA",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 97,
      "pull_request_review_id" : 1196723893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034211904/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T01:50:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034211904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034563917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034563917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Of course, will do my best to tell people that V3 should be treated similarly to BIP125 in software/services that use replaceability signaling.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T10:22:00Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034563917",
      "id" : 1034563917,
      "in_reply_to_id" : 1034208537,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII5849qjFN",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 40,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034563917/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034563917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034565284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034565284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC an LN channel would either only use V2 or only use V3. If the channel is using V3 commitment transactions, there shouldn't be old state in V2 transactions. So there shouldn't really be cases where V3 needs to replace V2 or vice versa. Does that sound correct?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T10:23:15Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+See example #1 in [\"Rule 3\" Pining](#Rule-3-Pinning) section above.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+5. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be\n+replaced. With default limits, if the child is e.g. 100,000vB, that might be an additional\n+100,000sats (at 1sat/vbyte) or more, depending on the feerate. Restricting all children to 1000vB\n+bounds the potential fees by 1/100.\n+\n+*Rationale*: (lower bound) the smaller this limit, the fewer UTXOs a child may use to fund this\n+fee-bump. For example, only allowing the V3 child to have 2 inputs would require L2 protocols to\n+manage a wallet with high-value UTXOs and make batched fee-bumping impossible. However, as the\n+fee-bumping child only needs to fund fees (as opposed to payments), just a few UTXOs should suffice.\n+\n+*Rationale*: With a limit of 1000 virtual bytes, depending on the output types, the child can have\n+6-15 UTXOs, which should be enough to fund a fee-bump without requiring a carefully-managed UTXO\n+pool. With 1000 virtual bytes as the descendant limit, the cost to replace a V3 transaction has much\n+lower variance.\n+\n+*Rationale*: This makes the rule very easily \"tacked on\" to existing logic for policy and wallets.\n+A transaction may be up to 100KvB on its own (`MAX_STANDARD_TX_WEIGHT`) and 101KvB with descendants\n+(`DEFAULT_DESCENDANT_SIZE_LIMIT_KVB`). If an existing V3 transaction in the mempool is 100KvB, its\n+descendant can only be 1000vB, even if the policy is 10KvB.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed ancestor.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034565284",
      "id" : 1034565284,
      "in_reply_to_id" : 1034196433,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5849qjak",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 97,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034565284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034565284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034566681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034566681"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hopefully the LN wallet knows that it cannot bump a V2 and V3 together, since an unconfirmed V3 cannot spend an unconfirmed V2 and vice versa. I actually think this rule helps *prevent* risks associated with bumping multiple states, since batched bumping is not possible at all.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T10:24:34Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+See example #1 in [\"Rule 3\" Pining](#Rule-3-Pinning) section above.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+5. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be\n+replaced. With default limits, if the child is e.g. 100,000vB, that might be an additional\n+100,000sats (at 1sat/vbyte) or more, depending on the feerate. Restricting all children to 1000vB\n+bounds the potential fees by 1/100.\n+\n+*Rationale*: (lower bound) the smaller this limit, the fewer UTXOs a child may use to fund this\n+fee-bump. For example, only allowing the V3 child to have 2 inputs would require L2 protocols to\n+manage a wallet with high-value UTXOs and make batched fee-bumping impossible. However, as the\n+fee-bumping child only needs to fund fees (as opposed to payments), just a few UTXOs should suffice.\n+\n+*Rationale*: With a limit of 1000 virtual bytes, depending on the output types, the child can have\n+6-15 UTXOs, which should be enough to fund a fee-bump without requiring a carefully-managed UTXO\n+pool. With 1000 virtual bytes as the descendant limit, the cost to replace a V3 transaction has much\n+lower variance.\n+\n+*Rationale*: This makes the rule very easily \"tacked on\" to existing logic for policy and wallets.\n+A transaction may be up to 100KvB on its own (`MAX_STANDARD_TX_WEIGHT`) and 101KvB with descendants\n+(`DEFAULT_DESCENDANT_SIZE_LIMIT_KVB`). If an existing V3 transaction in the mempool is 100KvB, its\n+descendant can only be 1000vB, even if the policy is 10KvB.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed ancestor.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034566681",
      "id" : 1034566681,
      "in_reply_to_id" : 1034211904,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5849qjwZ",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 97,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034566681/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034566681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034570463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034570463"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think allowing V3 to replace V2 chain of transactions lead to the consequence than V2 users are implicitly subscribing to this new replacement regime. A receiver of a V2 transaction could apply the BIP125 rules to estimate the replacement odd of the transaction, and the application logic be broken when the actual rule 3 of minimum between package feerate and ancestor feerate is applied.\r\n\r\nI'll try to be more vocal that V2 transactions can be replaced by V3 transactions. The cost of replacing a V2 transaction being replaced is identical (or higher, given the ancestor feerate rule) - the fee must be paid, but it can be by 2 transactions instead of 1. So, while there is a \"new\" way to replace, the \"likelihood\" of a V2 transaction being replaced is the same or lower.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T10:27:55Z",
      "diff_hunk" : "@@ -117,3 +123,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted if the replacement transaction is accepted.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034570463",
      "id" : 1034570463,
      "in_reply_to_id" : 1034180693,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849qkrf",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 142,
      "original_position" : 61,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034570463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034570463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034811321"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034811321"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n     ancestors and descendants being considered at the same time. Single-transaction\r\n     submission behavior is unchanged.\r\n```",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:17:37Z",
      "diff_hunk" : "@@ -33,20 +33,20 @@ The following rules are enforced for all packages:\n * Packages cannot have conflicting transactions, i.e. no two transactions in a package can spend\n    the same inputs. Packages cannot have duplicate transactions. (#20833)\n \n-* No transaction in a package can conflict with a mempool transaction. Replace By Fee is\n-  currently disabled for packages. (#20833)\n-\n-   - Package RBF may be enabled in the future.\n-\n * When packages are evaluated against ancestor/descendant limits, the union of all transactions'\n   descendants and ancestors is considered. (#21800)\n \n    - *Rationale*: This is essentially a \"worst case\" heuristic intended for packages that are\n      heavily connected, i.e. some transaction in the package is the ancestor or descendant of all\n      the other transactions.\n \n-The following rules are only enforced for packages to be submitted to the mempool (not enforced for\n-test accepts):\n+* [CPFP Carve Out](./mempool-limits.md#CPFP-Carve-Out) is disabled. (#21800)\n+\n+   - *Rationale*: This carve out cannot be accurately applied when there are multiple transactions'\n+     ancestors and descendants being considered at the same time.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034811321",
      "id" : 1034811321,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849rfe5",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 46,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034811321/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034811321",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034811545"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034811545"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n* [CPFP Carve Out](./mempool-limits.md#CPFP-Carve-Out) is disabled in the package context. (#21800)\r\n```",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:17:48Z",
      "diff_hunk" : "@@ -33,20 +33,20 @@ The following rules are enforced for all packages:\n * Packages cannot have conflicting transactions, i.e. no two transactions in a package can spend\n    the same inputs. Packages cannot have duplicate transactions. (#20833)\n \n-* No transaction in a package can conflict with a mempool transaction. Replace By Fee is\n-  currently disabled for packages. (#20833)\n-\n-   - Package RBF may be enabled in the future.\n-\n * When packages are evaluated against ancestor/descendant limits, the union of all transactions'\n   descendants and ancestors is considered. (#21800)\n \n    - *Rationale*: This is essentially a \"worst case\" heuristic intended for packages that are\n      heavily connected, i.e. some transaction in the package is the ancestor or descendant of all\n      the other transactions.\n \n-The following rules are only enforced for packages to be submitted to the mempool (not enforced for\n-test accepts):\n+* [CPFP Carve Out](./mempool-limits.md#CPFP-Carve-Out) is disabled. (#21800)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034811545",
      "id" : 1034811545,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849rfiZ",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 43,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034811545/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034811545",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034821359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034821359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\r\n```",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:25:01Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034821359",
      "id" : 1034821359,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849rh7v",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034821359/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034821359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034830187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034830187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It would be evicted as any package-limit-breaking transaction.\r\n\r\n> In the case it's evicted, you have to consider LN V3 package being evicted and as a LN node you should resuscitate the V2, fee-bump it again, wait for confirmation and then re-broadcast your V3 package.\r\n\r\n I'm not sure application-level detail like this is helpful in the document unless it's a high-level principle.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:31:09Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+See example #1 in [\"Rule 3\" Pining](#Rule-3-Pinning) section above.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+5. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be\n+replaced. With default limits, if the child is e.g. 100,000vB, that might be an additional\n+100,000sats (at 1sat/vbyte) or more, depending on the feerate. Restricting all children to 1000vB\n+bounds the potential fees by 1/100.\n+\n+*Rationale*: (lower bound) the smaller this limit, the fewer UTXOs a child may use to fund this\n+fee-bump. For example, only allowing the V3 child to have 2 inputs would require L2 protocols to\n+manage a wallet with high-value UTXOs and make batched fee-bumping impossible. However, as the\n+fee-bumping child only needs to fund fees (as opposed to payments), just a few UTXOs should suffice.\n+\n+*Rationale*: With a limit of 1000 virtual bytes, depending on the output types, the child can have\n+6-15 UTXOs, which should be enough to fund a fee-bump without requiring a carefully-managed UTXO\n+pool. With 1000 virtual bytes as the descendant limit, the cost to replace a V3 transaction has much\n+lower variance.\n+\n+*Rationale*: This makes the rule very easily \"tacked on\" to existing logic for policy and wallets.\n+A transaction may be up to 100KvB on its own (`MAX_STANDARD_TX_WEIGHT`) and 101KvB with descendants\n+(`DEFAULT_DESCENDANT_SIZE_LIMIT_KVB`). If an existing V3 transaction in the mempool is 100KvB, its\n+descendant can only be 1000vB, even if the policy is 10KvB.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed ancestor.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034830187",
      "id" : 1034830187,
      "in_reply_to_id" : 1034196433,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII5849rkFr",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 97,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034830187/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034830187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034836333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034836333"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(this has been addressed)",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:35:31Z",
      "diff_hunk" : "@@ -1379,6 +1570,7 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n                 // future.  Continue individually validating the rest of the transactions, because\n                 // some of them may still be valid.\n                 quit_early = true;\n+                package_state.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034836333",
      "id" : 1034836333,
      "in_reply_to_id" : 1013300039,
      "line" : 1542,
      "node_id" : "PRRC_kwDOABII5849rllt",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 1542,
      "original_position" : 589,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 557,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034836333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034836333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034849684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034849684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this comment I think only applies to `V3_ANCESTOR_SIZE_LIMIT_KVB`?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:45:15Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_V3_POLICY_H\n+#define BITCOIN_POLICY_V3_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which help make\n+// RBF abilities more robust.\n+\n+/** Maximum virtual size of a tx which spends from an unconfirmed V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including an unconfirmed tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034849684",
      "id" : 1034849684,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849ro2U",
      "original_commit_id" : "000facb0460372cc320158189090e4d36862eb0e",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.h",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034849684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034849684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034859410"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034859410"
         }
      },
      "author_association" : "MEMBER",
      "body" : "After this check, we know it's a mixture(?) and therefore illicit, making hitting https://github.com/bitcoin/bitcoin/pull/25038/commits/000facb0460372cc320158189090e4d36862eb0e#diff-a19c07329799a164e1e3bd89e7cd07f1a8e5e97b88f2b24c9bef17df04479c74R51 impossible and the below loops a only useful for returning an example illicit tuple.\r\n\r\nPerhaps just grab one v3 example and one non-v3 example and return those to simplify the rest of the code?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:52:24Z",
      "diff_hunk" : "@@ -0,0 +1,113 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/v3_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::tuple<uint256, uint256, bool>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    // If all transactions are V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion == 3;})) {\n+        return std::nullopt;\n+    }\n+    // If all transactions are non-V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion != 3;})) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034859410",
      "id" : 1034859410,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII5849rrOS",
      "original_commit_id" : "000facb0460372cc320158189090e4d36862eb0e",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : 23,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034859410/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034859410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034864719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034864719"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At this point they cannot both be non-v3, due to https://github.com/bitcoin/bitcoin/pull/25038/commits/000facb0460372cc320158189090e4d36862eb0e#diff-a19c07329799a164e1e3bd89e7cd07f1a8e5e97b88f2b24c9bef17df04479c74R74\r\n",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T14:56:25Z",
      "diff_hunk" : "@@ -0,0 +1,113 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/v3_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::tuple<uint256, uint256, bool>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    // If all transactions are V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion == 3;})) {\n+        return std::nullopt;\n+    }\n+    // If all transactions are non-V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion != 3;})) {\n+        return std::nullopt;\n+    }\n+    // Look for a V3 transaction spending a non-V3 or vice versa.\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> non_v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            non_v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        }\n+    }\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = non_v3_txid_to_wtxid.find(input.prevout.hash); it != non_v3_txid_to_wtxid.end()) {\n+                    return std::make_tuple(it->second, tx->GetWitnessHash(), true);\n+                }\n+            }\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_tuple(it->second, tx->GetWitnessHash(), false);\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    for (const auto& entry : ancestors) {\n+        if (ptx->nVersion != 3 && entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        } else if (ptx->nVersion == 3 && entry->GetTx().nVersion != 3) {\n+            return strprintf(\"v3 tx cannot spend from %s which is not nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;\n+\n+    const auto tx_vsize{GetVirtualTransactionSize(*ptx)};\n+    if (ancestors.size() + 1 > V3_ANCESTOR_LIMIT) {\n+        return strprintf(\"tx would have too many ancestors\");\n+    }\n+    const auto ancestor_vsize {std::accumulate(ancestors.cbegin(), ancestors.cend(), 0,\n+        [](int64_t sum, CTxMemPool::txiter it) { return sum + it->GetTxSize(); })};\n+    if (ancestor_vsize + tx_vsize > V3_ANCESTOR_SIZE_LIMIT_KVB * 1000) {\n+        return strprintf(\"total vsize of tx with ancestors would be too big: %u virtual bytes\", tx_vsize + ancestor_vsize);\n+    }\n+\n+    // Any two unconfirmed transactions with a dependency relationship must either both be V3 or both non-V3.\n+    if (auto err_string{CheckV3Inheritance(ptx, ancestors)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034864719",
      "id" : 1034864719,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849rshP",
      "original_commit_id" : "000facb0460372cc320158189090e4d36862eb0e",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034864719/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034864719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034921065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034921065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`m_package_feerates` currently is only true when `m_allow_carveouts` is false, no? The `Assume` should be dead code.\r\n\r\nthis whole block is extremely verbose and I'm not sure what it's supposed to be doing",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T15:39:32Z",
      "diff_hunk" : "@@ -863,6 +894,47 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         // the ancestor limits should be the same for both our new transaction and any conflicts).\n         // We don't bother incrementing m_limit_descendants by the full removal count as that limit never comes\n         // into force here (as we're only adding a single transaction).\n+        //\n+        // This carve out is NOT granted in package RBF (see m_allow_carveouts in ATMPArgs ctors) because, during\n+        // package acceptance, we may call PreChecks for multiple transactions that conflict with different mempool\n+        // entries that don't share ancestry. It would be a bug to keep increasing the descendant limit each time.\n+        // The carve out also does not apply to package RBF while it is restricted to V3 transactions, since an\n+        // unconfirmed V3 transaction cannot have more than one descendant.\n+        if (args.m_package_feerates && args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034921065",
      "id" : 1034921065,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849r6Rp",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 903,
      "original_position" : 220,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034921065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034921065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034959791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034959791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "what is this switch doing?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T16:10:17Z",
      "diff_hunk" : "@@ -970,12 +1059,98 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limits, err_string)) {\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Unless the transaction is V3, its own fees must meet the requirements for replacing its conflicts.\n+    if (args.m_package_feerates) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1034959791",
      "id" : 1034959791,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sDuv",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 1079,
      "original_position" : 348,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197642959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034959791/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T16:10:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034959791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035032193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035032193"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This incentive deficiency linked above should be a non-issue for CheckMinerScores since V3 package RBF is a restricted topology which disallows an multiple ancestors entirely.\r\n\r\nThe two cases of \"adding a new unconfirmed input\" during RBF with this PR:\r\n\r\n1) Package size of two(no dedup), new CPFP child is RBF'ing another (set of) tx, goes through CheckMinerScores\r\n2) Package size of 1(deduped parent), transaction is rejected via single-tx-acceptance rules currently in master. Perhaps a constrained V3-only version of #26451 could remove the pin?\r\n\r\nThe asymmetry above is annoying and a mild pinning vector.\r\n\r\nAs of this PR, wallet authors can avoid this pinning scenario entirely by not moving fee utxos between different unconfirmed parents, but it would be nice if asymmetry was avoided to make wallet reasoning simpler.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T17:07:35Z",
      "diff_hunk" : "@@ -181,3 +181,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035032193",
      "id" : 1035032193,
      "in_reply_to_id" : 1014284608,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII5849sVaB",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 5,
      "pull_request_review_id" : 1197968262,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035032193/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-29T17:07:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035032193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035045705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035045705"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, the loops/maps are only used to return a more helpful string to the user. I don't think it's too much work? This function accepts a list of transactions that doesn't necessarily need to be an ancestor packages, so just grabbing a V3 and non-V3 could be 2 transactions that aren't parent-child.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T17:20:08Z",
      "diff_hunk" : "@@ -0,0 +1,113 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/v3_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::tuple<uint256, uint256, bool>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    // If all transactions are V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion == 3;})) {\n+        return std::nullopt;\n+    }\n+    // If all transactions are non-V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion != 3;})) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035045705",
      "id" : 1035045705,
      "in_reply_to_id" : 1034859410,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII5849sYtJ",
      "original_commit_id" : "000facb0460372cc320158189090e4d36862eb0e",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : 23,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035045705/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035045705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035046585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035046585"
         }
      },
      "author_association" : "MEMBER",
      "body" : "true, thanks",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T17:21:03Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_V3_POLICY_H\n+#define BITCOIN_POLICY_V3_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which help make\n+// RBF abilities more robust.\n+\n+/** Maximum virtual size of a tx which spends from an unconfirmed V3 transaction, in vB. */\n+static constexpr unsigned int V3_CHILD_MAX_SIZE{1000};\n+/** Maximum number of transactions including an unconfirmed tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+\n+// Define additional values in case we want V3 ancestor limits to diverge from default ancestor limits.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035046585",
      "id" : 1035046585,
      "in_reply_to_id" : 1034849684,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849sY65",
      "original_commit_id" : "000facb0460372cc320158189090e4d36862eb0e",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.h",
      "position" : null,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035046585/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035046585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035071286"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035071286"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The hope is to explain + maybe prevent a potential bug if an assumption (package RBF is v3-only) is broken. Ifsomebody in the future says \"it seems fine to relax package RBF to non-v3,\" or does a \"refactor no behavior change\" that actually does change something, the currently-dead code would not be dead anymore and the Assume would hit. Don't think it's completely useless, though I'm very happy to make it less verbose and/or move it.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-11-29T17:45:19Z",
      "diff_hunk" : "@@ -863,6 +894,47 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         // the ancestor limits should be the same for both our new transaction and any conflicts).\n         // We don't bother incrementing m_limit_descendants by the full removal count as that limit never comes\n         // into force here (as we're only adding a single transaction).\n+        //\n+        // This carve out is NOT granted in package RBF (see m_allow_carveouts in ATMPArgs ctors) because, during\n+        // package acceptance, we may call PreChecks for multiple transactions that conflict with different mempool\n+        // entries that don't share ancestry. It would be a bug to keep increasing the descendant limit each time.\n+        // The carve out also does not apply to package RBF while it is restricted to V3 transactions, since an\n+        // unconfirmed V3 transaction cannot have more than one descendant.\n+        if (args.m_package_feerates && args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1035071286",
      "id" : 1035071286,
      "in_reply_to_id" : 1034921065,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849se82",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 903,
      "original_position" : 220,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1197275980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035071286/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-11-30T11:35:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035071286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038314895"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038314895"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah removed",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:26:55Z",
      "diff_hunk" : "@@ -970,12 +1059,98 @@ bool MemPoolAccept::PackageMempoolChecks(const std::vector<CTransactionRef>& txn\n     assert(std::all_of(txns.cbegin(), txns.cend(), [this](const auto& tx)\n                        { return !m_pool.exists(GenTxid::Txid(tx->GetHash()));}));\n \n+    // Populate with the union of all transactions' ancestors.\n+    CTxMemPool::setEntries m_collective_ancestors;\n+    for (const auto& ws : workspaces) {\n+        for (const auto& it : ws.m_ancestors) m_collective_ancestors.insert(it);\n+    }\n+\n     std::string err_string;\n     if (!m_pool.CheckPackageLimits(txns, m_limits, err_string)) {\n         // This is a package-wide error, separate from an individual transaction error.\n         return package_state.Invalid(PackageValidationResult::PCKG_POLICY, \"package-mempool-limits\", err_string);\n     }\n-   return true;\n+\n+    // Further checks are all RBF-only.\n+    m_rbf = std::any_of(workspaces.cbegin(), workspaces.cend(), [](const auto& ws){return !ws.m_conflicts.empty();});\n+    if (!m_rbf) return true;\n+\n+    // Unless the transaction is V3, its own fees must meet the requirements for replacing its conflicts.\n+    if (args.m_package_feerates) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038314895",
      "id" : 1038314895,
      "in_reply_to_id" : 1034959791,
      "line" : null,
      "node_id" : "PRRC_kwDOABII5849422P",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 1079,
      "original_position" : 348,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1202666473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038314895/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038314895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok I've reduced the comment significantly and turned this into a non-dead `Assume()`.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:29:22Z",
      "diff_hunk" : "@@ -863,6 +894,47 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         // the ancestor limits should be the same for both our new transaction and any conflicts).\n         // We don't bother incrementing m_limit_descendants by the full removal count as that limit never comes\n         // into force here (as we're only adding a single transaction).\n+        //\n+        // This carve out is NOT granted in package RBF (see m_allow_carveouts in ATMPArgs ctors) because, during\n+        // package acceptance, we may call PreChecks for multiple transactions that conflict with different mempool\n+        // entries that don't share ancestry. It would be a bug to keep increasing the descendant limit each time.\n+        // The carve out also does not apply to package RBF while it is restricted to V3 transactions, since an\n+        // unconfirmed V3 transaction cannot have more than one descendant.\n+        if (args.m_package_feerates && args.m_package_submission) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317056",
      "id" : 1038317056,
      "in_reply_to_id" : 1034921065,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584943YA",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 903,
      "original_position" : 220,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1202666473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317350"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, thanks",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:29:39Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317350",
      "id" : 1038317350,
      "in_reply_to_id" : 1034821359,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584943cm",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 41,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : null,
      "pull_request_review_id" : 1202666473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317350/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317425"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, thanks",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:29:43Z",
      "diff_hunk" : "@@ -33,20 +33,20 @@ The following rules are enforced for all packages:\n * Packages cannot have conflicting transactions, i.e. no two transactions in a package can spend\n    the same inputs. Packages cannot have duplicate transactions. (#20833)\n \n-* No transaction in a package can conflict with a mempool transaction. Replace By Fee is\n-  currently disabled for packages. (#20833)\n-\n-   - Package RBF may be enabled in the future.\n-\n * When packages are evaluated against ancestor/descendant limits, the union of all transactions'\n   descendants and ancestors is considered. (#21800)\n \n    - *Rationale*: This is essentially a \"worst case\" heuristic intended for packages that are\n      heavily connected, i.e. some transaction in the package is the ancestor or descendant of all\n      the other transactions.\n \n-The following rules are only enforced for packages to be submitted to the mempool (not enforced for\n-test accepts):\n+* [CPFP Carve Out](./mempool-limits.md#CPFP-Carve-Out) is disabled. (#21800)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317425",
      "id" : 1038317425,
      "in_reply_to_id" : 1034811545,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584943dx",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 43,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1202666473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done, thanks",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:29:47Z",
      "diff_hunk" : "@@ -33,20 +33,20 @@ The following rules are enforced for all packages:\n * Packages cannot have conflicting transactions, i.e. no two transactions in a package can spend\n    the same inputs. Packages cannot have duplicate transactions. (#20833)\n \n-* No transaction in a package can conflict with a mempool transaction. Replace By Fee is\n-  currently disabled for packages. (#20833)\n-\n-   - Package RBF may be enabled in the future.\n-\n * When packages are evaluated against ancestor/descendant limits, the union of all transactions'\n   descendants and ancestors is considered. (#21800)\n \n    - *Rationale*: This is essentially a \"worst case\" heuristic intended for packages that are\n      heavily connected, i.e. some transaction in the package is the ancestor or descendant of all\n      the other transactions.\n \n-The following rules are only enforced for packages to be submitted to the mempool (not enforced for\n-test accepts):\n+* [CPFP Carve Out](./mempool-limits.md#CPFP-Carve-Out) is disabled. (#21800)\n+\n+   - *Rationale*: This carve out cannot be accurately applied when there are multiple transactions'\n+     ancestors and descendants being considered at the same time.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038317473",
      "id" : 1038317473,
      "in_reply_to_id" : 1034811321,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584943eh",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 46,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1202666473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317473/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038317473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038318473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038318473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added that they must signal *explicitly*",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:30:53Z",
      "diff_hunk" : "@@ -117,3 +123,53 @@ backward-compatible for users and applications that rely on p2p transaction rela\n package validation should not prevent the acceptance of a transaction that would otherwise be\n policy-valid on its own. By always accepting a transaction that passes individual validation before\n trying package validation, we prevent any unintentional restriction of policy.\n+\n+### Package Replace by Fee\n+\n+A transaction conflicts with an in-mempool transaction (\"directly conflicting transaction\") if they\n+spend one or more of the same inputs. A transaction may conflict with multiple in-mempool\n+transactions. A directly conflicting transaction's and its descendants (together, \"original\n+transactions\") must be evicted if the replacement transaction is accepted.\n+\n+A package may contain one or more transactions that have directly conflicting transactions but do\n+not have high enough fees to meet the [replacement policy for individual\n+transactions](./mempool-replacements.md).  Similar to other fee-related requirements, [package\n+feerate](#Package-Fees-and-Feerate) may allow these transactions to be replaced.\n+\n+A package may replace mempool transaction(s) (\"Package RBF\") under the following conditions:\n+\n+1. All package transactions with mempool conflicts must be V3. This also means the \"sponsoring\"\n+   child transaction must be V3.\n+\n+*Note*: Combined with the V3 rules, this means the package must be a child-with-parents package.\n+Since package validation is only attempted if the transactions do not pay sufficient fees to be\n+accepted on their own, this effectively means that only V3 transactions can pay to replace their\n+parents' conflicts.\n+\n+*Rationale*: The fee-related rules are economically rational for ancestor packages, but not\n+necessarily other types of packages. A child-with-parents package is a type of ancestor package. It\n+may be fine to allow any ancestor package, but it's more difficult to account for all of the\n+possibilities, e.g. descendant limits.\n+\n+2. All original transactions signal replaceability, i.e., either through BIP125 or through being V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038318473",
      "id" : 1038318473,
      "in_reply_to_id" : 1034177919,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584943uJ",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 154,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1202666473,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038318473/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038318473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038322524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038322524"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Simplified `ApplyV3Rules` since it's 1-parent-1-child and removed the V3-specific ancestor size limit which is now redundant.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:35:36Z",
      "diff_hunk" : "@@ -0,0 +1,113 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/v3_policy.h>\n+\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <logging.h>\n+#include <tinyformat.h>\n+\n+#include <numeric>\n+#include <vector>\n+\n+std::optional<std::tuple<uint256, uint256, bool>> CheckV3Inheritance(const Package& package)\n+{\n+    assert(std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx != nullptr;}));\n+    // If all transactions are V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion == 3;})) {\n+        return std::nullopt;\n+    }\n+    // If all transactions are non-V3, we can stop here.\n+    if (std::all_of(package.cbegin(), package.cend(), [](const auto& tx){return tx->nVersion != 3;})) {\n+        return std::nullopt;\n+    }\n+    // Look for a V3 transaction spending a non-V3 or vice versa.\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> v3_txid_to_wtxid;\n+    std::unordered_map<uint256, uint256, SaltedTxidHasher> non_v3_txid_to_wtxid;\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        } else {\n+            non_v3_txid_to_wtxid.emplace(tx->GetHash(), tx->GetWitnessHash());\n+        }\n+    }\n+    for (const auto& tx : package) {\n+        if (tx->nVersion == 3) {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = non_v3_txid_to_wtxid.find(input.prevout.hash); it != non_v3_txid_to_wtxid.end()) {\n+                    return std::make_tuple(it->second, tx->GetWitnessHash(), true);\n+                }\n+            }\n+        } else {\n+            for (const auto& input : tx->vin) {\n+                if (auto it = v3_txid_to_wtxid.find(input.prevout.hash); it != v3_txid_to_wtxid.end()) {\n+                    return std::make_tuple(it->second, tx->GetWitnessHash(), false);\n+                }\n+            }\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors)\n+{\n+    for (const auto& entry : ancestors) {\n+        if (ptx->nVersion != 3 && entry->GetTx().nVersion == 3) {\n+            return strprintf(\"tx that spends from %s must be nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        } else if (ptx->nVersion == 3 && entry->GetTx().nVersion != 3) {\n+            return strprintf(\"v3 tx cannot spend from %s which is not nVersion=3\",\n+                             entry->GetTx().GetWitnessHash().ToString());\n+        }\n+    }\n+    return std::nullopt;\n+}\n+\n+std::optional<std::string> ApplyV3Rules(const CTransactionRef& ptx,\n+                                        const CTxMemPool::setEntries& ancestors,\n+                                        const std::set<uint256>& direct_conflicts)\n+{\n+    // These rules only apply to transactions with nVersion=3.\n+    if (ptx->nVersion != 3) return std::nullopt;\n+\n+    const auto tx_vsize{GetVirtualTransactionSize(*ptx)};\n+    if (ancestors.size() + 1 > V3_ANCESTOR_LIMIT) {\n+        return strprintf(\"tx would have too many ancestors\");\n+    }\n+    const auto ancestor_vsize {std::accumulate(ancestors.cbegin(), ancestors.cend(), 0,\n+        [](int64_t sum, CTxMemPool::txiter it) { return sum + it->GetTxSize(); })};\n+    if (ancestor_vsize + tx_vsize > V3_ANCESTOR_SIZE_LIMIT_KVB * 1000) {\n+        return strprintf(\"total vsize of tx with ancestors would be too big: %u virtual bytes\", tx_vsize + ancestor_vsize);\n+    }\n+\n+    // Any two unconfirmed transactions with a dependency relationship must either both be V3 or both non-V3.\n+    if (auto err_string{CheckV3Inheritance(ptx, ancestors)}) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038322524",
      "id" : 1038322524,
      "in_reply_to_id" : 1034864719,
      "line" : null,
      "node_id" : "PRRC_kwDOABII584944tc",
      "original_commit_id" : "000facb0460372cc320158189090e4d36862eb0e",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.cpp",
      "position" : null,
      "pull_request_review_id" : 1202767806,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038322524/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:46:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038322524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038330942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038330942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do I understand correctly that you are pointing out that package RBF and single tx RBF have different rules? And suggesting we try to make them more symmetrical by applying something similar in the single tx rules?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:45:22Z",
      "diff_hunk" : "@@ -181,3 +181,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038330942",
      "id" : 1038330942,
      "in_reply_to_id" : 1014284608,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII584946w-",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 5,
      "pull_request_review_id" : 1202767806,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038330942/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:46:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038330942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038334153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038334153"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ideally yes. Doesn't have to be done now, it just reduces the utility of new unconfirmed inputs to randomly working sometimes, basically.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-02T16:49:12Z",
      "diff_hunk" : "@@ -181,3 +181,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1038334153",
      "id" : 1038334153,
      "in_reply_to_id" : 1014284608,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII584947jJ",
      "original_commit_id" : "ab5e5077126f9df5634a15d014b261bf6dbe8708",
      "original_line" : 186,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 5,
      "pull_request_review_id" : 1202785118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038334153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-02T16:49:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038334153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-12-05T15:56:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1337614988",
      "id" : 1337614988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585PumKM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337614988/reactions"
      },
      "updated_at" : "2022-12-05T15:56:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337614988",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR is open for review but leaving as draft, attempting to shave off the beginning commits in #26646 to make this smaller and v3-focused.",
      "created_at" : "2022-12-06T10:46:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1339129671",
      "id" : 1339129671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585P0X9H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1339129671/reactions"
      },
      "updated_at" : "2022-12-06T10:46:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1339129671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1042716735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042716735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Question about this and sorry if it's already been addressed:\r\n\r\nDoes this require extra logic for reorg handling? I'm thinking of a chain of v3 TXs:\r\n\r\ntx1 (confirmed in block 100) ->\r\ntx2 (confirmed in block 101) ->\r\ntx3 (unconfirmed, currently in mempool)\r\n\r\nif block 101 is disconnected, that potentially puts tx2 back in the mempool meaning tx3 is now invalid and should be evicted.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-07T21:49:55Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1042716735",
      "id" : 1042716735,
      "line" : 62,
      "node_id" : "PRRC_kwDOABII584-Jpg_",
      "original_commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 62,
      "pull_request_review_id" : 1209171268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042716735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-07T21:49:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1042716735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1043169748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043169748"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, v3 enforcement during reorg is implemented in `MaybeUpdateMempoolForReorg` [here](https://github.com/bitcoin/bitcoin/pull/25038/files#diff-97c3a52bc5fad452d82670a7fd291800bae20c7bc35bb82686c2c0a4ea7b5b98R364-R370) and tested in mempool_accept_v3.py [here](https://github.com/bitcoin/bitcoin/pull/25038/files#diff-15a1888c9151fc1d182c23e34b71d691f70df448bceb9eb78c8296f18854b6a3R163). Would it make sense for me to add a note in the docs?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-08T10:11:24Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1043169748",
      "id" : 1043169748,
      "in_reply_to_id" : 1042716735,
      "line" : 62,
      "node_id" : "PRRC_kwDOABII584-LYHU",
      "original_commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 62,
      "pull_request_review_id" : 1209807646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043169748/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T10:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043169748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1043467746"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043467746"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sweet ð Couldn't hurt to mention that in a bullet point here I suppose.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-08T15:14:25Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1043467746",
      "id" : 1043467746,
      "in_reply_to_id" : 1042716735,
      "line" : 62,
      "node_id" : "PRRC_kwDOABII584-Mg3i",
      "original_commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "original_line" : 62,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 62,
      "pull_request_review_id" : 1210252301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043467746/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-08T15:14:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1043467746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1055682225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055682225"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should be number \"6.\" not a second \"4.\"",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2022-12-22T17:20:46Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions rules apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.\n+\n+*Rationale*: Ensure the ancestor feerate rule does not underestimate a to-be-replaced V3 mempool\n+transaction's incentive compatibility. Imagine the original transaction, A, has a child B and\n+co-parent C (i.e. B spends from A and C). C also has another child, D. B is one of the original\n+transactions and thus its ancestor feerate must be lower than the package's. However, this may be an\n+underestimation because D can bump C without B's help. This is resolved if V3 transactions can only\n+have V3 ancestors, as then C cannot have another child.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed descendant.\n+\n+*Rationale*: (upper bound) the larger the descendant limit, the more transactions may need to be\n+replaced. This is a problematic pinning attack, i.e., a malicious counterparty prevents the\n+transaction from being replaced by adding many descendant transactions that aren't fee-bumping.\n+See example #1 in [\"Rule 3\" Pining](#Rule-3-Pinning) section above.\n+\n+*Rationale*: (lower bound) at least 1 descendant is required to allow CPFP of the presigned\n+transaction. The contract protocol can create presigned transactions paying 0 fees and 1 output for\n+attaching a CPFP at broadcast time (\"anchor output\"). Without package RBF, multiple anchor outputs\n+would be required to allow each counterparty to fee-bump any presigned transaction. With package\n+RBF, since the presigned transactions can replace each other, 1 anchor output is sufficient.\n+\n+5. A V3 transaction that has an unconfirmed V3 ancestor cannot be larger than 1000 virtual bytes.\n+\n+*Rationale*: (upper bound) the larger the descendant size limit, the more vbytes may need to be\n+replaced. With default limits, if the child is e.g. 100,000vB, that might be an additional\n+100,000sats (at 1sat/vbyte) or more, depending on the feerate. Restricting all children to 1000vB\n+bounds the potential fees by 1/100.\n+\n+*Rationale*: (lower bound) the smaller this limit, the fewer UTXOs a child may use to fund this\n+fee-bump. For example, only allowing the V3 child to have 2 inputs would require L2 protocols to\n+manage a wallet with high-value UTXOs and make batched fee-bumping impossible. However, as the\n+fee-bumping child only needs to fund fees (as opposed to payments), just a few UTXOs should suffice.\n+\n+*Rationale*: With a limit of 1000 virtual bytes, depending on the output types, the child can have\n+6-15 UTXOs, which should be enough to fund a fee-bump without requiring a carefully-managed UTXO\n+pool. With 1000 virtual bytes as the descendant limit, the cost to replace a V3 transaction has much\n+lower variance.\n+\n+*Rationale*: This makes the rule very easily \"tacked on\" to existing logic for policy and wallets.\n+A transaction may be up to 100KvB on its own (`MAX_STANDARD_TX_WEIGHT`) and 101KvB with descendants\n+(`DEFAULT_DESCENDANT_SIZE_LIMIT_KVB`). If an existing V3 transaction in the mempool is 100KvB, its\n+descendant can only be 1000vB, even if the policy is 10KvB.\n+\n+4. A V3 transaction cannot have more than 1 unconfirmed ancestor.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1055682225",
      "id" : 1055682225,
      "in_reply_to_id" : 1034196433,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII584-7G6x",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 97,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 97,
      "pull_request_review_id" : 1228000395,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055682225/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-22T17:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1055682225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063416400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063416400"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">too low to fee-bump B through CPFP\r\n\r\nI don't get this sentence. Nobody wants to fee-bump B, no? Alice would want to replace B, what does it have to do with fee-bumping?",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2023-01-06T12:59:37Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063416400",
      "id" : 1063416400,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584_YnJQ",
      "original_commit_id" : "7acf63771a33b59c24cc0d0b098a2c1a50bb0d42",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 25,
      "pull_request_review_id" : 1238807826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063416400/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T12:59:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063416400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063421778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063421778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should LN users be aware of this as well? Imagine them forwarding channel closure directly towards a service claiming to work 0-conf, but for some reason (closure being v3) the experience is not really 0-conf. (Perhaps this is already the case with rbf-by-default? Indeed more like a UX challenge.)",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2023-01-06T13:08:30Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063421778",
      "id" : 1063421778,
      "in_reply_to_id" : 1034208537,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII584_YodS",
      "original_commit_id" : "a984c34c7298a85eced0fc3eee7b33cc39493494",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 40,
      "pull_request_review_id" : 1238816148,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063421778/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T13:08:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063421778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063443677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063443677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do you ever discuss what will happen in the 2-block-reorg case? A chain of txs could end up being not-re-added to the mempool (due to rules 2/3), and then something becomes insecure.\r\n\r\nI think I should bring a concrete example here.",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2023-01-06T13:41:24Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063443677",
      "id" : 1063443677,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584_Ytzd",
      "original_commit_id" : "7acf63771a33b59c24cc0d0b098a2c1a50bb0d42",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 53,
      "pull_request_review_id" : 1238852886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063443677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T13:41:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063443677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063444515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063444515"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ahhh too bad, the next comment [asks the same question](https://github.com/bitcoin/bitcoin/pull/25038/commits/7acf63771a33b59c24cc0d0b098a2c1a50bb0d42#r1042716735). Certainly worth documenting though :)",
      "commit_id" : "0c089a327a70d16f824b1b4dfd029d260cc43f09",
      "created_at" : "2023-01-06T13:42:34Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1063444515",
      "id" : 1063444515,
      "in_reply_to_id" : 1063443677,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584_YuAj",
      "original_commit_id" : "7acf63771a33b59c24cc0d0b098a2c1a50bb0d42",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 53,
      "pull_request_review_id" : 1238854208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063444515/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-06T13:42:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1063444515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Last push is just a rebase. Still need to do:\r\n- Not allowing non-v3 below minrelayfee in package CPFP. Currently working on test util to raise mempool min feerate for this.\r\n- Removing below-minrelayfee-and-no-longer-bumped transactions after replacement.",
      "created_at" : "2023-01-11T15:02:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1378893658",
      "id" : 1378893658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585SMD9a",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378893658/reactions"
      },
      "updated_at" : "2023-01-11T15:02:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378893658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1067104570"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067104570"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mallory's goal is to *pin* the transaction in the mempool. That is, increase the fees required to replace B, but *not* make it confirm. Mallory can of course put 1BTC of fees in the descendant, thus making it extremely expensive to replace B, but then she's also CPFP'd B and it's probably going to be mined very soon.",
      "commit_id" : "58b2c8d5c3acc9cbc5f84884a1bd2b2d5413c41a",
      "created_at" : "2023-01-11T15:05:21Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1067104570",
      "id" : 1067104570,
      "in_reply_to_id" : 1063416400,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII584_mrk6",
      "original_commit_id" : "7acf63771a33b59c24cc0d0b098a2c1a50bb0d42",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 25,
      "pull_request_review_id" : 1244081680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067104570/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T15:05:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067104570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1067107639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067107639"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think a concrete example would help, yeah. For example, when you say \"something becomes insecure\" it's not really clear to me what you mean - a v3 transaction gets censored? A mempool has a chain of more than 2 v3 transactions?",
      "commit_id" : "58b2c8d5c3acc9cbc5f84884a1bd2b2d5413c41a",
      "created_at" : "2023-01-11T15:07:54Z",
      "diff_hunk" : "@@ -0,0 +1,100 @@\n+# Transactions with nVersion 3\n+\n+A transaction with its `nVersion` field set to 3 (\"V3 transactions\") is allowed in mempool and\n+transaction relay.\n+\n+The goal with V3 is to create a policy that retains DoS-resistance and accepts transactions that are\n+incentive-compatible to mine, while making fee-bumping more robust by avoiding specific pinning attacks.\n+Contract or L2 protocols in which transactions are signed by untrusted counterparties well before\n+broadcast time, e.g. the Lightning Network (LN), may benefit from using this version.\n+\n+## V3 Rationale: Pinning Attacks\n+\n+Since contracting transactions are shared between multiple parties and mempool congestion is\n+difficult to predict, mempool policy restrictions may accidentally allow a malicious party to pin a\n+transaction. For example, imagine that counterparties Alice (honest) and Mallory (malicious) have\n+conflicting transactions A and B, respectively. Mallory may be able to prevent A from being accepted\n+by first submitting B and taking advantage of some limitations and heuristics used in [RBF\n+policy](./mempool-replacements.md).\n+\n+### \"Rule 3\" Pinning\n+\n+RBF rules require the replacement transaction pay a higher absolute fee than the aggregate fees paid\n+by all original transactions. This means Mallory may increase the fees required to replace B by:\n+\n+1. Adding transaction(s) that descend from B and pay a feerate too low to fee-bump B through CPFP.\n+   For example, assuming the default descendant size limit is 101KvB and B is 1000vB paying a\n+feerate of 2sat/vB, adding a 100KvB, 2sat/vB child increases the cost to replace B by 200Ksat.\n+\n+2. Adding a high-fee descendant of B that also spends from a large, low-feerate mempool transaction,\n+   C. The child may pay a very large fee but not actually be fee-bumping B if its overall ancestor\n+feerate is still lower than B's individual feerate. For example, assuming the default ancestor size\n+limit is 101KvB, B is 1000vB paying 2sat/vB, and C is 99KvB paying 1sat/vB, adding a 1000vB child of\n+B and C increases the cost to replace B by 101Ksat.\n+\n+## Version 3 Rules\n+\n+All existing standardness rules apply to V3. The following set of additional restrictions apply to\n+V3 transactions:\n+\n+1. A V3 transaction can be replaced, even if it does not signal BIP125 replaceability. Other\n+   conditions apply, see [RBF rules](./mempool-replacements.md) and [Package RBF\n+rules][./packages.md#Package-Replace-By-Fee].\n+\n+2. Any descendant of an unconfirmed V3 transaction must also be V3.\n+\n+*Rationale*: Combined with Rule 1, this gives us the property of \"inherited signaling\" when\n+descendants of unconfirmed transactions are created. Additionally, checking whether a transaction\n+signals replaceability this way does not require mempool traversal, and does not change based on\n+what transactions are mined.\n+\n+*Note*: A V3 transaction can spend outputs from *confirmed* non-V3 transactions.\n+\n+3. A V3 transaction's unconfirmed ancestors must all be V3.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1067107639",
      "id" : 1067107639,
      "in_reply_to_id" : 1063443677,
      "line" : 53,
      "node_id" : "PRRC_kwDOABII584_msU3",
      "original_commit_id" : "7acf63771a33b59c24cc0d0b098a2c1a50bb0d42",
      "original_line" : 53,
      "original_position" : 53,
      "original_start_line" : null,
      "path" : "doc/policy/version3_transactions.md",
      "position" : 53,
      "pull_request_review_id" : 1244086434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067107639/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-01-11T15:07:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1067107639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Not allowing non-v3 below minrelayfee in package CPFP. Currently working on test util to raise mempool min feerate for this.\r\n\r\nImplication being a v1/2 transaction cannot be 0-fee and bumped by child?",
      "created_at" : "2023-01-11T15:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1378903453",
      "id" : 1378903453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585SMGWd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378903453/reactions"
      },
      "updated_at" : "2023-01-11T15:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378903453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Implication being a v1/2 transaction cannot be 0-fee and bumped by child?\r\n\r\nYes unfortunately, unless there is a better alternative... see ~08:16 in https://gnusha.org/bitcoin-core-dev/2022-12-16.log",
      "created_at" : "2023-01-11T15:11:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1378910122",
      "id" : 1378910122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585SMH-q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378910122/reactions"
      },
      "updated_at" : "2023-01-11T15:16:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1378910122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Lightning legacy channel types (before BOLT9's `option_anchors_output` / `option_anchors_zero_fee_htlc_tx`) presents the issue of counterparty's second-stage HTLC transactons malleable enough to opt-out from BIP125 replacement rules (the preimage path on the local commitment transaction offered output and the timeout path on the local commitment transaction accepted output). This path can be leveraged by a counterarty not only to do opt-out pinning but also for rule #3 style of pinning, where the second-stage HTLC transaction is malleated to a high-fee/low-feerate.\r\n\r\nThis repleaceability issue is moving away with `option_anchors_zero_fee_htlc_tx`, where all the second-stage spends must\r\nsignal replacement due to the new CSV 1 to satisfy. This anchor states are currently signed under nversion=2, assuming\r\nwe have [dynamic upgrades](https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-July/002763.html), a new channel type with states committing to nversion=3 could be deployed in-flight (i.e without confirming on-chain new funding outputs). Those channels would be safe against rule #3 style of pinning, as if old RBF opt-in nversion=2 states are used for pinning, under the proposed policy rules (\"All directly conflicting transactions signal replaceability explicitly, either through  BIP125 or V3.\", the incentive-compatible enhanced RBF rules should apply.\r\n\r\nAs of today, `option_anchors_zero_fee_htlc_tx` is enabled by default by Eclair (since [v0.7.0](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.7.0.md)) and LND (since [v.0.12.0](https://github.com/lightningnetwork/lnd/releases/tag/v0.12.0-beta)). This is not deployed by default by CLN and LDK. So we would still have probably tens of thousands of legacy channels forever exposed to pinning attacks mitigated by nversion=3. For this subset, this is a wonder if we would like to introduce some \"retro-active\" policy effect, where nversion=3 effects are granted to the legacy channel types with some at-broadcast opt-in mechanism. E.g a signature from a pubkey of the funding output committing to a package version bit. Of course, this would be more technical complexity on the Core-side, at the security and economic benefit of Lightning channels, so trade-off.\r\n\r\nLightning node operators of legacy channel types could be also just force-close all channels, and re-open new safer ones.\r\nAssuming it's done in an asynchronous fashion (to avoid accidental flood&loot situations) and mempool fees, this should\r\nbe okay. On the other hand, I can see the operators incentives to keep unsafe channel open to preserve good reputation\r\naccumulated in routing algorithms.\r\n\r\nPersonally, I think the deployment cost are low enough on the Lightning-side to not bother with dedicated \"retro-active\"\r\npolicy mechanism on the Core-side, at least in this case. Though this is only my own appreciation of the deployment cost\r\nand it's highly probable we'll have newer policy to deploy in the future and interactions with channel types, so I think\r\nit can valuable to think about it.",
      "created_at" : "2023-01-27T02:33:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1405944407",
      "id" : 1405944407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585TzQJX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405944407/reactions"
      },
      "updated_at" : "2023-01-27T02:33:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405944407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> For this subset, this is a wonder if we would like to introduce some \"retro-active\" policy effect\r\n\r\nThe alternative approach would be for early lightning adopters to update their channel on-chain to permanently invalidate any old states that might enable pinning (eg, by splicing some funds in or out)... Simple is better than complicated.",
      "created_at" : "2023-01-27T06:38:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1406087647",
      "id" : 1406087647,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585TzzHf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406087647/reactions"
      },
      "updated_at" : "2023-01-27T06:38:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406087647",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The alternative approach would be for early lightning adopters to update their channel on-chain to permanently invalidate any old states that might enable pinning (eg, by splicing some funds in or out)... Simple is better than complicated.\r\n\r\nOn this present case, this is my thinking too (\"I think the deployment cost are low enough on the Lightning-side to not bother with dedicated \"retro-active\" policy mechanism on the Core-side\"). However, deployment workaround for new channel types have already been[ proposed in the past](https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-March/003531.html), and to avoid hard synchronisation issue (i.e provoking mempool backlogs) we might have to rely on \"retro-active\" police deployment in the future. That said, we probably still have one or two orders of magnitude of the number of Lightning channels growth before this starts to be a concern.",
      "created_at" : "2023-01-27T19:14:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1406965582",
      "id" : 1406965582,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585T3JdO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406965582/reactions"
      },
      "updated_at" : "2023-01-27T19:14:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406965582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120967545"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120967545"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n * 2. The tx must be within V3_CHILD_MAX_WEIGHT\r\n```",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-03-01T00:27:20Z",
      "diff_hunk" : "@@ -0,0 +1,59 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_POLICY_V3_POLICY_H\n+#define BITCOIN_POLICY_V3_POLICY_H\n+\n+#include <consensus/amount.h>\n+#include <policy/packages.h>\n+#include <policy/policy.h>\n+#include <primitives/transaction.h>\n+#include <txmempool.h>\n+\n+#include <string>\n+\n+// This module enforces rules for transactions with nVersion=3 (\"V3 transactions\") which help make\n+// RBF abilities more robust.\n+\n+// V3 only allows 1 parent and 1 child.\n+/** Maximum number of transactions including an unconfirmed tx and its descendants. */\n+static constexpr unsigned int V3_DESCENDANT_LIMIT{2};\n+/** Maximum number of transactions including a V3 tx and all its mempool ancestors. */\n+static constexpr unsigned int V3_ANCESTOR_LIMIT{2};\n+\n+/** Maximum weight of a tx which spends from an unconfirmed V3 transaction. */\n+static constexpr unsigned int V3_CHILD_MAX_WEIGHT{4000};\n+// Since these limits are within the default ancestor/descendant limits, there is no need to\n+// additionally check ancestor/descendant limits for V3 transactions.\n+static_assert(V3_CHILD_MAX_WEIGHT + MAX_STANDARD_TX_WEIGHT <= DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000);\n+static_assert(V3_CHILD_MAX_WEIGHT + MAX_STANDARD_TX_WEIGHT <= DEFAULT_DESCENDANT_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000);\n+\n+/** Any two unconfirmed transactions with a dependency relationship must either both be V3 or both\n+ * non-V3. Check this rule for any list of unconfirmed transactions.\n+ * @returns a tuple (parent wtxid, child wtxid, bool) where one is V3 but the other is not, if at\n+ * least one such pair exists. The bool represents whether the child is v3 or not. There may be\n+ * other such pairs that are not returned.\n+ * Otherwise std::nullopt.\n+ */\n+std::optional<std::tuple<uint256, uint256, bool>> CheckV3Inheritance(const Package& package);\n+\n+/** Every transaction that spends an unconfirmed V3 transaction must also be V3. */\n+std::optional<std::string> CheckV3Inheritance(const CTransactionRef& ptx,\n+                                              const CTxMemPool::setEntries& ancestors);\n+\n+/** The following rules apply to V3 transactions:\n+ * 1. Tx with all of its ancestors (including non-nVersion=3) must be within V3_ANCESTOR_SIZE_LIMIT_KVB.\n+ * 2. Tx with all of its ancestors must be within V3_ANCESTOR_LIMIT.\n+ *\n+ * If a V3 tx has V3 ancestors,\n+ * 1. Each V3 ancestor and its descendants must be within V3_DESCENDANT_LIMIT.\n+ * 2. The tx must be within V3_CHILD_MAX_SIZE.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120967545",
      "id" : 1120967545,
      "line" : 51,
      "node_id" : "PRRC_kwDOABII585C0Jt5",
      "original_commit_id" : "44fcc4d3912e21b055c377549c8882c67dddf278",
      "original_line" : 51,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "src/policy/v3_policy.h",
      "position" : 51,
      "pull_request_review_id" : 1318865644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120967545/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-01T01:16:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120967545",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120968022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120968022"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // Parent + child with v3 in the mempool. Child is allowed as long as it is under V3_CHILD_MAX_WEIGHT.\r\n```",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-03-01T00:28:03Z",
      "diff_hunk" : "@@ -49,4 +52,154 @@ BOOST_FIXTURE_TEST_CASE(tx_mempool_reject_coinbase, TestChain100Setup)\n     BOOST_CHECK_EQUAL(result.m_state.GetRejectReason(), \"coinbase\");\n     BOOST_CHECK(result.m_state.GetResult() == TxValidationResult::TX_CONSENSUS);\n }\n+\n+// Generate a number of random, nonexistent outpoints.\n+static inline std::vector<COutPoint> random_outpoints(size_t num_outpoints) {\n+    std::vector<COutPoint> outpoints;\n+    outpoints.resize(num_outpoints);\n+    for (size_t i{0}; i < num_outpoints; ++i) {\n+        outpoints.emplace_back(COutPoint{GetRandHash(), 0});\n+    }\n+    return outpoints;\n+}\n+\n+// Creates a placeholder tx (not valid) with 25 outputs. Specify the nVersion and the inputs.\n+static inline CTransactionRef make_tx(const std::vector<COutPoint>& inputs, int32_t version)\n+{\n+    CMutableTransaction mtx = CMutableTransaction{};\n+    mtx.nVersion = version;\n+    mtx.vin.resize(inputs.size());\n+    mtx.vout.resize(25);\n+    for (size_t i{0}; i < inputs.size(); ++i) {\n+        mtx.vin[i].prevout = inputs[i];\n+    }\n+    for (auto i{0}; i < 25; ++i) {\n+        mtx.vout[i].scriptPubKey = CScript() << OP_TRUE;\n+        mtx.vout[i].nValue = 10000;\n+    }\n+    return MakeTransactionRef(mtx);\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(version3_tests, RegTestingSetup)\n+{\n+    // Test V3 policy helper functions\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    LOCK2(cs_main, pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    std::set<uint256> empty_conflicts_set;\n+\n+    auto mempool_tx_v3 = make_tx(random_outpoints(1), /*version=*/3);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v3));\n+    auto mempool_tx_v2 = make_tx(random_outpoints(1), /*version=*/2);\n+    pool.addUnchecked(entry.FromTx(mempool_tx_v2));\n+    // These two transactions are unrelated, so CheckV3Inheritance should pass.\n+    BOOST_CHECK(CheckV3Inheritance({mempool_tx_v2, mempool_tx_v3}) == std::nullopt);\n+    // Default values.\n+    CTxMemPool::Limits m_limits{};\n+\n+    // Cannot spend from an unconfirmed v3 transaction unless this tx is also v3.\n+    {\n+        auto tx_v2_from_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/2);\n+        auto ancestors_v2_from_v3{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v2_from_v3), m_limits)};\n+        BOOST_CHECK(CheckV3Inheritance(tx_v2_from_v3, *ancestors_v2_from_v3).has_value());\n+        BOOST_CHECK(CheckV3Inheritance({mempool_tx_v3, tx_v2_from_v3}).has_value());\n+        auto tx_v2_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        auto ancestors_v2_from_both{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v2_from_v2_and_v3), m_limits)};\n+        BOOST_CHECK(CheckV3Inheritance(tx_v2_from_v2_and_v3, *ancestors_v2_from_both).has_value());\n+        BOOST_CHECK(CheckV3Inheritance({mempool_tx_v2, mempool_tx_v3, tx_v2_from_v2_and_v3}).value() ==\n+                    std::make_tuple(mempool_tx_v3->GetWitnessHash(), tx_v2_from_v2_and_v3->GetWitnessHash(), false));\n+    }\n+\n+    // V3 cannot spend from an unconfirmed non-v3 transaction.\n+    {\n+        auto tx_v3_from_v2 = make_tx({COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/3);\n+        auto ancestors_v3_from_v2{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2), m_limits)};\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2, *ancestors_v3_from_v2).has_value());\n+        BOOST_CHECK(CheckV3Inheritance({mempool_tx_v2, tx_v3_from_v2}).value() ==\n+                    std::make_tuple(mempool_tx_v2->GetWitnessHash(), tx_v3_from_v2->GetWitnessHash(), true));\n+        auto tx_v3_from_v2_and_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}, COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/3);\n+        auto ancestors_v3_from_both{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v2_and_v3), m_limits)};\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v2_and_v3, *ancestors_v3_from_both).has_value());\n+        BOOST_CHECK(CheckV3Inheritance({mempool_tx_v2, mempool_tx_v3, tx_v3_from_v2_and_v3}).value() ==\n+                    std::make_tuple(mempool_tx_v2->GetWitnessHash(), tx_v3_from_v2_and_v3->GetWitnessHash(), true));\n+    }\n+    // V3 from V3 is ok, and non-V3 from non-V3 is ok.\n+    {\n+        auto tx_v3_from_v3 = make_tx({COutPoint{mempool_tx_v3->GetHash(), 0}}, /*version=*/3);\n+        auto ancestors_v3{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_from_v3), m_limits)};\n+        BOOST_CHECK(CheckV3Inheritance({tx_v3_from_v3, mempool_tx_v3}) == std::nullopt);\n+        BOOST_CHECK(CheckV3Inheritance({mempool_tx_v3, tx_v3_from_v3}) == std::nullopt);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v3_from_v3, *ancestors_v3) == std::nullopt);\n+\n+        auto tx_v2_from_v2 = make_tx({COutPoint{mempool_tx_v2->GetHash(), 0}}, /*version=*/2);\n+        auto ancestors_v2{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v2_from_v2), m_limits)};\n+        BOOST_CHECK(CheckV3Inheritance({tx_v2_from_v2, mempool_tx_v2}) == std::nullopt);\n+        BOOST_CHECK(CheckV3Inheritance({mempool_tx_v2, tx_v2_from_v2}) == std::nullopt);\n+        BOOST_CHECK(CheckV3Inheritance(tx_v2_from_v2, *ancestors_v2) == std::nullopt);\n+    }\n+\n+    // Tx spending v3 cannot have too many mempool ancestors\n+    // Configuration where the tx has multiple direct parents.\n+    {\n+        std::vector<COutPoint> mempool_outpoints;\n+        mempool_outpoints.emplace_back(COutPoint{mempool_tx_v3->GetHash(), 0});\n+        mempool_outpoints.resize(2);\n+        for (size_t i{0}; i < 2; ++i) {\n+            auto mempool_tx = make_tx(random_outpoints(1), /*version=*/2);\n+            pool.addUnchecked(entry.FromTx(mempool_tx));\n+            mempool_outpoints.emplace_back(COutPoint{mempool_tx->GetHash(), 0});\n+        }\n+        auto tx_v3_multi_parent = make_tx(mempool_outpoints, /*version=*/3);\n+        auto ancestors{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_multi_parent), m_limits)};\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_multi_parent, *ancestors, empty_conflicts_set).has_value());\n+    }\n+\n+    // Configuration where the tx is in a multi-generation chain.\n+    auto last_outpoint{random_outpoints(1)[0]};\n+    for (size_t i{0}; i < 2; ++i) {\n+        auto mempool_tx = make_tx({last_outpoint}, /*version=*/2);\n+        pool.addUnchecked(entry.FromTx(mempool_tx));\n+        last_outpoint = COutPoint{mempool_tx->GetHash(), 0};\n+    }\n+    {\n+        auto tx_v3_multi_gen = make_tx({last_outpoint}, /*version=*/3);\n+        auto ancestors{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_multi_gen), m_limits)};\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_multi_gen, *ancestors, empty_conflicts_set).has_value());\n+    }\n+\n+    // Tx spending v3 cannot be too large\n+    auto many_inputs{random_outpoints(100)};\n+    many_inputs.push_back(COutPoint{mempool_tx_v3->GetHash(), 0});\n+    {\n+        auto tx_v3_child_big = make_tx(many_inputs, /*version=*/3);\n+        BOOST_CHECK(GetTransactionWeight(*tx_v3_child_big) > V3_CHILD_MAX_WEIGHT);\n+        auto ancestors{pool.CalculateMemPoolAncestors(entry.FromTx(tx_v3_child_big), m_limits)};\n+        BOOST_CHECK(ApplyV3Rules(tx_v3_child_big, *ancestors, empty_conflicts_set).has_value());\n+    }\n+\n+    // Parent + child with v3 in the mempool. Child is allowed as long as it is under V3_CHILD_MAX_SIZE.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120968022",
      "id" : 1120968022,
      "line" : 180,
      "node_id" : "PRRC_kwDOABII585C0J1W",
      "original_commit_id" : "44fcc4d3912e21b055c377549c8882c67dddf278",
      "original_line" : 180,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/test/txvalidation_tests.cpp",
      "position" : 145,
      "pull_request_review_id" : 1318865644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120968022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-01T01:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120968022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120972484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120972484"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        coin = self.coins.pop(0)\r\n```",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-03-01T00:34:57Z",
      "diff_hunk" : "@@ -0,0 +1,233 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from decimal import Decimal\n+\n+from test_framework.messages import (\n+    COIN,\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class PackageRBFTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def assert_mempool_contents(self, expected=None, unexpected=None):\n+        \"\"\"Assert that all transactions in expected are in the mempool,\n+        and all transactions in unexpected are not in the mempool.\n+        \"\"\"\n+        if not expected:\n+            expected = []\n+        if not unexpected:\n+            unexpected = []\n+        assert set(unexpected).isdisjoint(expected)\n+        mempool = self.nodes[0].getrawmempool(verbose=False)\n+        for tx in expected:\n+            assert tx.rehash() in mempool\n+        for tx in unexpected:\n+            assert tx.rehash() not in mempool\n+\n+    def create_simple_package(self, parent_coin, parent_fee=0, child_fee=DEFAULT_FEE, heavy_child=False, version=3):\n+        \"\"\"Create a 1 parent 1 child package using the coin passed in as the parent's input. The\n+        parent has 1 output, used to fund 1 child transaction.\n+        All transactions signal BIP125 replaceability, but nSequence changes based on self.ctr. This\n+        prevents identical txids between packages when the parents spend the same coin and have the\n+        same fee (i.e. 0sat).\n+\n+        returns tuple (hex serialized txns, CTransaction objects)\n+        \"\"\"\n+        self.ctr += 1\n+        # Use fee_rate=0 because create_self_transfer will use the default fee_rate value otherwise.\n+        # Passing in fee>0 overrides fee_rate, so this still works for non-zero parent_fee.\n+        parent_result = self.wallet.create_self_transfer(\n+            fee_rate=0,\n+            fee=parent_fee,\n+            utxo_to_spend=parent_coin,\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+\n+        num_child_outputs = 10 if heavy_child else 1\n+        child_result = self.wallet.create_self_transfer_multi(\n+            utxos_to_spend=[parent_result[\"new_utxo\"]],\n+            num_outputs=num_child_outputs,\n+            fee_per_output=int(child_fee * COIN // num_child_outputs),\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+        package_hex = [parent_result[\"hex\"], child_result[\"hex\"]]\n+        package_txns = [parent_result[\"tx\"], child_result[\"tx\"]]\n+        return package_hex, package_txns\n+\n+    def run_test(self):\n+        # Counter used to count the number of times we constructed packages. Since we're constructing parent transactions with the same\n+        # coins (to create conflicts), and giving them the same fee (i.e. 0, since their respective children are paying), we might\n+        # accidentally just create the exact same transaction again. To prevent this, set nSequences to MAX_BIP125_RBF_SEQUENCE - self.ctr.\n+        self.ctr = 0\n+\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 160)\n+        self.coins = self.wallet.get_utxos(mark_as_spent=False)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+        self.address = self.wallet.get_address()\n+\n+        self.test_package_rbf_basic()\n+        self.test_package_rbf_signaling()\n+        self.test_package_rbf_additional_fees()\n+        self.test_package_rbf_max_conflicts()\n+        self.test_package_rbf_conflicting_conflicts()\n+        self.test_package_rbf_partial()\n+\n+    def test_package_rbf_basic(self):\n+        self.log.info(\"Test that a child can pay to replace its parents' conflicts\")\n+        node = self.nodes[0]\n+        # Reuse the same coins so that the transactions conflict with one another.\n+        parent_coin = self.coins.pop()\n+        package_hex1, package_txns1 = self.create_simple_package(parent_coin, DEFAULT_FEE, DEFAULT_FEE)\n+        package_hex2, package_txns2 = self.create_simple_package(parent_coin, 0, DEFAULT_FEE * 5)\n+        node.submitpackage(package_hex1)\n+        self.assert_mempool_contents(expected=package_txns1, unexpected=package_txns2)\n+\n+        submitres = node.submitpackage(package_hex2)\n+        submitres[\"replaced-transactions\"] == [tx.rehash() for tx in package_txns1]\n+        self.assert_mempool_contents(expected=package_txns2, unexpected=package_txns1)\n+        self.generate(node, 1)\n+\n+    def test_package_rbf_signaling(self):\n+        node = self.nodes[0]\n+        self.log.info(\"Test that V3 transactions not signaling BIP125 are replaceable\")\n+        # Create single transaction that doesn't signal BIP125 but has nVersion=3\n+        coin = self.coins.pop()\n+\n+        tx_v3_no_bip125 = self.wallet.create_self_transfer(\n+            fee=DEFAULT_FEE,\n+            utxo_to_spend=coin,\n+            sequence=MAX_BIP125_RBF_SEQUENCE + 1,\n+            version=3\n+        )\n+        node.sendrawtransaction(tx_v3_no_bip125[\"hex\"])\n+        self.assert_mempool_contents(expected=[tx_v3_no_bip125[\"tx\"]])\n+\n+        self.log.info(\"Test that non-V3 transactions signaling BIP125 are replaceable\")\n+        coin = self.coins[0]\n+        del self.coins[0]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120972484",
      "id" : 1120972484,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585C0K7E",
      "original_commit_id" : "c27864fbca2421eeb64f13a803f7b4393999e1cf",
      "original_line" : 128,
      "original_position" : 128,
      "original_start_line" : 127,
      "path" : "test/functional/mempool_package_rbf.py",
      "position" : 128,
      "pull_request_review_id" : 1318865644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120972484/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 127,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-01T01:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120972484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120974200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120974200"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems like this is not used anywhere:\r\n```suggestion\r\n```",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-03-01T00:37:52Z",
      "diff_hunk" : "@@ -0,0 +1,233 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from decimal import Decimal\n+\n+from test_framework.messages import (\n+    COIN,\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class PackageRBFTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def assert_mempool_contents(self, expected=None, unexpected=None):\n+        \"\"\"Assert that all transactions in expected are in the mempool,\n+        and all transactions in unexpected are not in the mempool.\n+        \"\"\"\n+        if not expected:\n+            expected = []\n+        if not unexpected:\n+            unexpected = []\n+        assert set(unexpected).isdisjoint(expected)\n+        mempool = self.nodes[0].getrawmempool(verbose=False)\n+        for tx in expected:\n+            assert tx.rehash() in mempool\n+        for tx in unexpected:\n+            assert tx.rehash() not in mempool\n+\n+    def create_simple_package(self, parent_coin, parent_fee=0, child_fee=DEFAULT_FEE, heavy_child=False, version=3):\n+        \"\"\"Create a 1 parent 1 child package using the coin passed in as the parent's input. The\n+        parent has 1 output, used to fund 1 child transaction.\n+        All transactions signal BIP125 replaceability, but nSequence changes based on self.ctr. This\n+        prevents identical txids between packages when the parents spend the same coin and have the\n+        same fee (i.e. 0sat).\n+\n+        returns tuple (hex serialized txns, CTransaction objects)\n+        \"\"\"\n+        self.ctr += 1\n+        # Use fee_rate=0 because create_self_transfer will use the default fee_rate value otherwise.\n+        # Passing in fee>0 overrides fee_rate, so this still works for non-zero parent_fee.\n+        parent_result = self.wallet.create_self_transfer(\n+            fee_rate=0,\n+            fee=parent_fee,\n+            utxo_to_spend=parent_coin,\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+\n+        num_child_outputs = 10 if heavy_child else 1\n+        child_result = self.wallet.create_self_transfer_multi(\n+            utxos_to_spend=[parent_result[\"new_utxo\"]],\n+            num_outputs=num_child_outputs,\n+            fee_per_output=int(child_fee * COIN // num_child_outputs),\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+        package_hex = [parent_result[\"hex\"], child_result[\"hex\"]]\n+        package_txns = [parent_result[\"tx\"], child_result[\"tx\"]]\n+        return package_hex, package_txns\n+\n+    def run_test(self):\n+        # Counter used to count the number of times we constructed packages. Since we're constructing parent transactions with the same\n+        # coins (to create conflicts), and giving them the same fee (i.e. 0, since their respective children are paying), we might\n+        # accidentally just create the exact same transaction again. To prevent this, set nSequences to MAX_BIP125_RBF_SEQUENCE - self.ctr.\n+        self.ctr = 0\n+\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 160)\n+        self.coins = self.wallet.get_utxos(mark_as_spent=False)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+        self.address = self.wallet.get_address()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120974200",
      "id" : 1120974200,
      "line" : 87,
      "node_id" : "PRRC_kwDOABII585C0LV4",
      "original_commit_id" : "c27864fbca2421eeb64f13a803f7b4393999e1cf",
      "original_line" : 87,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "test/functional/mempool_package_rbf.py",
      "position" : 87,
      "pull_request_review_id" : 1318865644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120974200/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-01T01:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120974200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120982825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120982825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missing assertions for the replaced-tx checks:\r\n```suggestion\r\n        assert submitres2[\"replaced-transactions\"] == [tx.rehash() for tx in package_txns1]\r\n        self.assert_mempool_contents(expected=package_txns2, unexpected=package_txns1)\r\n        submitres3 = node.submitpackage(package_hex3)\r\n        assert submitres3[\"replaced-transactions\"] == [tx.rehash() for tx in package_txns2]\r\n```",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-03-01T00:51:16Z",
      "diff_hunk" : "@@ -0,0 +1,233 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from decimal import Decimal\n+\n+from test_framework.messages import (\n+    COIN,\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class PackageRBFTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def assert_mempool_contents(self, expected=None, unexpected=None):\n+        \"\"\"Assert that all transactions in expected are in the mempool,\n+        and all transactions in unexpected are not in the mempool.\n+        \"\"\"\n+        if not expected:\n+            expected = []\n+        if not unexpected:\n+            unexpected = []\n+        assert set(unexpected).isdisjoint(expected)\n+        mempool = self.nodes[0].getrawmempool(verbose=False)\n+        for tx in expected:\n+            assert tx.rehash() in mempool\n+        for tx in unexpected:\n+            assert tx.rehash() not in mempool\n+\n+    def create_simple_package(self, parent_coin, parent_fee=0, child_fee=DEFAULT_FEE, heavy_child=False, version=3):\n+        \"\"\"Create a 1 parent 1 child package using the coin passed in as the parent's input. The\n+        parent has 1 output, used to fund 1 child transaction.\n+        All transactions signal BIP125 replaceability, but nSequence changes based on self.ctr. This\n+        prevents identical txids between packages when the parents spend the same coin and have the\n+        same fee (i.e. 0sat).\n+\n+        returns tuple (hex serialized txns, CTransaction objects)\n+        \"\"\"\n+        self.ctr += 1\n+        # Use fee_rate=0 because create_self_transfer will use the default fee_rate value otherwise.\n+        # Passing in fee>0 overrides fee_rate, so this still works for non-zero parent_fee.\n+        parent_result = self.wallet.create_self_transfer(\n+            fee_rate=0,\n+            fee=parent_fee,\n+            utxo_to_spend=parent_coin,\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+\n+        num_child_outputs = 10 if heavy_child else 1\n+        child_result = self.wallet.create_self_transfer_multi(\n+            utxos_to_spend=[parent_result[\"new_utxo\"]],\n+            num_outputs=num_child_outputs,\n+            fee_per_output=int(child_fee * COIN // num_child_outputs),\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+        package_hex = [parent_result[\"hex\"], child_result[\"hex\"]]\n+        package_txns = [parent_result[\"tx\"], child_result[\"tx\"]]\n+        return package_hex, package_txns\n+\n+    def run_test(self):\n+        # Counter used to count the number of times we constructed packages. Since we're constructing parent transactions with the same\n+        # coins (to create conflicts), and giving them the same fee (i.e. 0, since their respective children are paying), we might\n+        # accidentally just create the exact same transaction again. To prevent this, set nSequences to MAX_BIP125_RBF_SEQUENCE - self.ctr.\n+        self.ctr = 0\n+\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 160)\n+        self.coins = self.wallet.get_utxos(mark_as_spent=False)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)\n+        self.address = self.wallet.get_address()\n+\n+        self.test_package_rbf_basic()\n+        self.test_package_rbf_signaling()\n+        self.test_package_rbf_additional_fees()\n+        self.test_package_rbf_max_conflicts()\n+        self.test_package_rbf_conflicting_conflicts()\n+        self.test_package_rbf_partial()\n+\n+    def test_package_rbf_basic(self):\n+        self.log.info(\"Test that a child can pay to replace its parents' conflicts\")\n+        node = self.nodes[0]\n+        # Reuse the same coins so that the transactions conflict with one another.\n+        parent_coin = self.coins.pop()\n+        package_hex1, package_txns1 = self.create_simple_package(parent_coin, DEFAULT_FEE, DEFAULT_FEE)\n+        package_hex2, package_txns2 = self.create_simple_package(parent_coin, 0, DEFAULT_FEE * 5)\n+        node.submitpackage(package_hex1)\n+        self.assert_mempool_contents(expected=package_txns1, unexpected=package_txns2)\n+\n+        submitres = node.submitpackage(package_hex2)\n+        submitres[\"replaced-transactions\"] == [tx.rehash() for tx in package_txns1]\n+        self.assert_mempool_contents(expected=package_txns2, unexpected=package_txns1)\n+        self.generate(node, 1)\n+\n+    def test_package_rbf_signaling(self):\n+        node = self.nodes[0]\n+        self.log.info(\"Test that V3 transactions not signaling BIP125 are replaceable\")\n+        # Create single transaction that doesn't signal BIP125 but has nVersion=3\n+        coin = self.coins.pop()\n+\n+        tx_v3_no_bip125 = self.wallet.create_self_transfer(\n+            fee=DEFAULT_FEE,\n+            utxo_to_spend=coin,\n+            sequence=MAX_BIP125_RBF_SEQUENCE + 1,\n+            version=3\n+        )\n+        node.sendrawtransaction(tx_v3_no_bip125[\"hex\"])\n+        self.assert_mempool_contents(expected=[tx_v3_no_bip125[\"tx\"]])\n+\n+        self.log.info(\"Test that non-V3 transactions signaling BIP125 are replaceable\")\n+        coin = self.coins[0]\n+        del self.coins[0]\n+        # This transaction signals BIP125 but isn't V3\n+        tx_bip125_v2 = self.wallet.create_self_transfer(\n+            fee=DEFAULT_FEE,\n+            utxo_to_spend=coin,\n+            version=2\n+        )\n+        node.sendrawtransaction(tx_bip125_v2[\"hex\"])\n+\n+        self.assert_mempool_contents(expected=[tx_bip125_v2[\"tx\"]])\n+        assert node.getmempoolentry(tx_bip125_v2[\"tx\"].rehash())[\"bip125-replaceable\"]\n+        assert tx_bip125_v2[\"tx\"].nVersion == 2\n+        package_hex_v3, package_txns_v3 = self.create_simple_package(coin, parent_fee=0, child_fee=DEFAULT_FEE * 3, version=3)\n+        assert all([tx.nVersion == 3 for tx in package_txns_v3])\n+        node.submitpackage(package_hex_v3)\n+        self.assert_mempool_contents(expected=package_txns_v3, unexpected=[tx_bip125_v2[\"tx\"]])\n+        self.generate(node, 1)\n+\n+    def test_package_rbf_additional_fees(self):\n+        self.log.info(\"Check Package RBF must increase the absolute fee\")\n+        node = self.nodes[0]\n+        coin = self.coins.pop()\n+        package_hex1, package_txns1 = self.create_simple_package(coin, parent_fee=DEFAULT_FEE, child_fee=DEFAULT_FEE, heavy_child=True)\n+        assert_greater_than_or_equal(1000, package_txns1[-1].get_vsize())\n+        node.submitpackage(package_hex1)\n+        self.assert_mempool_contents(expected=package_txns1)\n+        # Package 2 has a higher feerate but lower absolute fee\n+        package_fees1 = DEFAULT_FEE * 2\n+        package_hex2, package_txns2 = self.create_simple_package(coin, parent_fee=0, child_fee=package_fees1 - Decimal(\"0.000000001\"))\n+        assert_raises_rpc_error(-25, \"package RBF failed: insufficient fee\", node.submitpackage, package_hex2)\n+        self.assert_mempool_contents(expected=package_txns1, unexpected=package_txns2)\n+        # Package 3 has a higher feerate and absolute fee\n+        package_hex3, package_txns3 = self.create_simple_package(coin, parent_fee=0, child_fee=package_fees1 * 3)\n+        node.submitpackage(package_hex3)\n+        self.assert_mempool_contents(expected=package_txns3, unexpected=package_txns1 + package_txns2)\n+        self.generate(node, 1)\n+\n+        self.log.info(\"Check Package RBF must pay for the entire package's bandwidth\")\n+        coin = self.coins.pop()\n+        package_hex1, package_txns1 = self.create_simple_package(coin, parent_fee=DEFAULT_FEE, child_fee=DEFAULT_FEE)\n+        package_fees1 = 2 * DEFAULT_FEE\n+        node.submitpackage(package_hex1)\n+        self.assert_mempool_contents(expected=package_txns1, unexpected=[])\n+        package_hex2, package_txns2 = self.create_simple_package(coin, child_fee=package_fees1 + Decimal(\"0.000000001\"))\n+        assert_raises_rpc_error(-25, \"package RBF failed: insufficient fee\", node.submitpackage, package_hex2)\n+        self.assert_mempool_contents(expected=package_txns1, unexpected=package_txns2)\n+        self.generate(node, 1)\n+\n+    def test_package_rbf_max_conflicts(self):\n+        node = self.nodes[0]\n+        self.log.info(\"Check Package RBF cannot replace more than 100 transactions\")\n+        num_coins = 5\n+        parent_coins = self.coins[:num_coins]\n+        del self.coins[:num_coins]\n+        # Original transactions: 5 transactions with 24 descendants each.\n+        for coin in parent_coins:\n+            self.wallet.send_self_transfer_chain(from_node=node, chain_length=25, utxo_to_spend=coin)\n+\n+        # Replacement package: 1 parent which conflicts with 5 * (1 + 24) = 125 mempool transactions.\n+        package_parent = self.wallet.create_self_transfer_multi(utxos_to_spend=parent_coins, version=3)\n+        package_child = self.wallet.create_self_transfer(fee_rate=50*DEFAULT_FEE, utxo_to_spend=package_parent[\"new_utxos\"][0], version=3)\n+\n+        assert_raises_rpc_error(-25, \"package RBF failed: too many potential replacements\",\n+                node.submitpackage, [package_parent[\"hex\"], package_child[\"hex\"]])\n+        self.generate(node, 1)\n+\n+    def test_package_rbf_conflicting_conflicts(self):\n+        node = self.nodes[0]\n+        self.log.info(\"Check that different package transactions cannot share the same conflicts\")\n+        coin = self.coins.pop()\n+        package_hex1, package_txns1 = self.create_simple_package(coin, DEFAULT_FEE, DEFAULT_FEE)\n+        package_hex2, package_txns2 = self.create_simple_package(coin, Decimal(\"0.00009\"), DEFAULT_FEE * 2)\n+        package_hex3, package_txns3 = self.create_simple_package(coin, 0, DEFAULT_FEE * 5)\n+        node.submitpackage(package_hex1)\n+        self.assert_mempool_contents(expected=package_txns1)\n+        # The first two transactions have the same conflicts\n+        package_duplicate_conflicts_hex = [package_hex2[0]] + package_hex3\n+        # Note that this won't actually go into the RBF logic, because static package checks will\n+        # detect that two package transactions conflict with each other. Either way, this must fail.\n+        assert_raises_rpc_error(-25, \"conflict-in-package\", node.submitpackage, package_duplicate_conflicts_hex)\n+        self.assert_mempool_contents(expected=package_txns1, unexpected=package_txns2 + package_txns3)\n+        # The RBFs should otherwise work.\n+        submitres2 = node.submitpackage(package_hex2)\n+        submitres2[\"replaced-transactions\"] == [tx.rehash() for tx in package_txns1]\n+        self.assert_mempool_contents(expected=package_txns2, unexpected=package_txns1)\n+        submitres3 = node.submitpackage(package_hex3)\n+        submitres3[\"replaced-transactions\"] == [tx.rehash() for tx in package_txns2]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120982825",
      "id" : 1120982825,
      "line" : 214,
      "node_id" : "PRRC_kwDOABII585C0Ncp",
      "original_commit_id" : "c27864fbca2421eeb64f13a803f7b4393999e1cf",
      "original_line" : 214,
      "original_position" : 214,
      "original_start_line" : 211,
      "path" : "test/functional/mempool_package_rbf.py",
      "position" : 214,
      "pull_request_review_id" : 1318865644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120982825/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 211,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-01T01:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120982825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120985992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120985992"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // For example, the mempool contains a large, low-feerate transaction A (99,000vB, 1sat/vB feerate).\r\n    // Transaction A has a small, high-feerate child B (1,000vB, 101sat/vB). The user wants to\r\n```\r\n\r\nor maybe\r\n\r\n```suggestion\r\n    // For example, the mempool contains a large, low-feerate transaction A (99,000vB, 1sat/vB feerate)\r\n    // which has a small, high-feerate child B (1,000vB, 101sat/vB). The user wants to\r\n```\r\n",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-03-01T00:56:02Z",
      "diff_hunk" : "@@ -1066,6 +1070,20 @@ bool MemPoolAccept::PackageMempoolChecks(const ATMPArgs& args,\n                                      \"package RBF failed: package conflicts with dependency\", *err_string);\n     }\n \n+    // CheckMinerScores is very conservative and should not be used for individual transactions.\n+    // For example, the mempool contains a large, low-feerate transaction A (99,000vB, 1sat/vB feerate) is\n+    // Transaction A has a small, high-feerate child B (1,000vB, 101sat/vB). The user wants to",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1120985992",
      "id" : 1120985992,
      "line" : 1105,
      "node_id" : "PRRC_kwDOABII585C0OOI",
      "original_commit_id" : "27881f0d824d4dae11e5587ae4a2511a04e30c0e",
      "original_line" : 1105,
      "original_position" : 21,
      "original_start_line" : 1074,
      "path" : "src/validation.cpp",
      "position" : 379,
      "pull_request_review_id" : 1318865644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120985992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1104,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-03-01T01:16:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1120985992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1181639284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181639284"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this is necessary. `get_utxos` already filters for mature coinbases, and you're making 60 of those above.",
      "commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "created_at" : "2023-05-01T15:05:06Z",
      "diff_hunk" : "@@ -0,0 +1,233 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2021 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from decimal import Decimal\n+\n+from test_framework.messages import (\n+    COIN,\n+    MAX_BIP125_RBF_SEQUENCE,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n+)\n+from test_framework.wallet import (\n+    DEFAULT_FEE,\n+    MiniWallet,\n+)\n+\n+class PackageRBFTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.setup_clean_chain = True\n+\n+    def assert_mempool_contents(self, expected=None, unexpected=None):\n+        \"\"\"Assert that all transactions in expected are in the mempool,\n+        and all transactions in unexpected are not in the mempool.\n+        \"\"\"\n+        if not expected:\n+            expected = []\n+        if not unexpected:\n+            unexpected = []\n+        assert set(unexpected).isdisjoint(expected)\n+        mempool = self.nodes[0].getrawmempool(verbose=False)\n+        for tx in expected:\n+            assert tx.rehash() in mempool\n+        for tx in unexpected:\n+            assert tx.rehash() not in mempool\n+\n+    def create_simple_package(self, parent_coin, parent_fee=0, child_fee=DEFAULT_FEE, heavy_child=False, version=3):\n+        \"\"\"Create a 1 parent 1 child package using the coin passed in as the parent's input. The\n+        parent has 1 output, used to fund 1 child transaction.\n+        All transactions signal BIP125 replaceability, but nSequence changes based on self.ctr. This\n+        prevents identical txids between packages when the parents spend the same coin and have the\n+        same fee (i.e. 0sat).\n+\n+        returns tuple (hex serialized txns, CTransaction objects)\n+        \"\"\"\n+        self.ctr += 1\n+        # Use fee_rate=0 because create_self_transfer will use the default fee_rate value otherwise.\n+        # Passing in fee>0 overrides fee_rate, so this still works for non-zero parent_fee.\n+        parent_result = self.wallet.create_self_transfer(\n+            fee_rate=0,\n+            fee=parent_fee,\n+            utxo_to_spend=parent_coin,\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+\n+        num_child_outputs = 10 if heavy_child else 1\n+        child_result = self.wallet.create_self_transfer_multi(\n+            utxos_to_spend=[parent_result[\"new_utxo\"]],\n+            num_outputs=num_child_outputs,\n+            fee_per_output=int(child_fee * COIN // num_child_outputs),\n+            sequence=MAX_BIP125_RBF_SEQUENCE - self.ctr,\n+            version=version\n+        )\n+        package_hex = [parent_result[\"hex\"], child_result[\"hex\"]]\n+        package_txns = [parent_result[\"tx\"], child_result[\"tx\"]]\n+        return package_hex, package_txns\n+\n+    def run_test(self):\n+        # Counter used to count the number of times we constructed packages. Since we're constructing parent transactions with the same\n+        # coins (to create conflicts), and giving them the same fee (i.e. 0, since their respective children are paying), we might\n+        # accidentally just create the exact same transaction again. To prevent this, set nSequences to MAX_BIP125_RBF_SEQUENCE - self.ctr.\n+        self.ctr = 0\n+\n+        self.log.info(\"Generate blocks to create UTXOs\")\n+        node = self.nodes[0]\n+        self.wallet = MiniWallet(node)\n+        self.generate(self.wallet, 160)\n+        self.coins = self.wallet.get_utxos(mark_as_spent=False)\n+        # Mature coinbase transactions\n+        self.generate(self.wallet, 100)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1181639284",
      "id" : 1181639284,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII585GbmJ0",
      "original_commit_id" : "c1bd1e1f8e635e2803e11e902a7d0f95c6b3ebf9",
      "original_line" : 86,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "test/functional/mempool_package_rbf.py",
      "position" : 86,
      "pull_request_review_id" : 1407698195,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181639284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-01T15:05:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181639284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-09T16:36:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1540509142",
      "id" : 1540509142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585b0k3W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540509142/reactions"
      },
      "updated_at" : "2023-05-09T16:36:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540509142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-08-07T02:00:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1667075069",
      "id" : 1667075069,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585jXYv9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667075069/reactions"
      },
      "updated_at" : "2023-08-07T02:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667075069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased",
      "created_at" : "2023-08-07T11:56:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1667718598",
      "id" : 1667718598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585jZ13G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667718598/reactions"
      },
      "updated_at" : "2023-08-07T11:56:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667718598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looks like this lost `TrimToSize` changes?\r\n\r\n```\r\ncommit ed6045a8f99f14987977e13faa1865c3bf56890f\r\nAuthor: glozow <gloriajzhao@gmail.com>\r\nDate:   Tue Jan 17 13:43:27 2023 +0000\r\n\r\n    [mempool] evict everything below min relay fee in TrimToSize()\r\n    \r\n    At this point it's not expected that there are any such transactions,\r\n    except from reorgs and possibly when loading from mempool.dat.\r\n```\r\n\r\nI rely on this for ephemeral anchors, trying to rebase.\r\n",
      "created_at" : "2023-08-08T20:50:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1670290088",
      "id" : 1670290088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585jjpqo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670290088/reactions"
      },
      "updated_at" : "2023-08-08T20:50:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670290088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1287681547"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287681547"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this case is actually covered\r\n\r\nrebased ephemeral anchor branch is failing on this test: https://github.com/bitcoin/bitcoin/pull/26403/files#diff-d18bbdec91d0f4825b512a31f34666b000c7b7e2e05a3d43570c4b971532616fR409",
      "commit_id" : "1ff90d31f5678aaa3c6e5d89dc1f1cdba885b0df",
      "created_at" : "2023-08-08T20:56:50Z",
      "diff_hunk" : "@@ -212,6 +212,23 @@ def test_nondefault_package_limits(self):\n                 tx_v3_child_large2[\"hex\"])\n         self.check_mempool([tx_v3_parent_large2[\"txid\"]])\n \n+    @cleanup\n+    def test_fee_dependency_replacements(self):\n+        \"\"\"\n+        Since v3 introduces the possibility of 0-fee (i.e. below min relay feerate) transactions in\n+        the mempool, it's possible for these transactions' sponsors to disappear due to RBF.\n+        Document that the 0-fee transaction should be evicted along with the replacements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1287681547",
      "id" : 1287681547,
      "line" : 220,
      "node_id" : "PRRC_kwDOABII585MwHYL",
      "original_commit_id" : "ba6cc7516e98bee65bf6b83b904b212cd10cc381",
      "original_line" : 220,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 220,
      "pull_request_review_id" : 1568191621,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287681547/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T20:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287681547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1288170497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1288170497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks for catching, should be fixed now",
      "commit_id" : "a8f3278f3a69ba32d4864f60c1c0d98d5b70b5c9",
      "created_at" : "2023-08-09T08:55:55Z",
      "diff_hunk" : "@@ -212,6 +212,23 @@ def test_nondefault_package_limits(self):\n                 tx_v3_child_large2[\"hex\"])\n         self.check_mempool([tx_v3_parent_large2[\"txid\"]])\n \n+    @cleanup\n+    def test_fee_dependency_replacements(self):\n+        \"\"\"\n+        Since v3 introduces the possibility of 0-fee (i.e. below min relay feerate) transactions in\n+        the mempool, it's possible for these transactions' sponsors to disappear due to RBF.\n+        Document that the 0-fee transaction should be evicted along with the replacements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1288170497",
      "id" : 1288170497,
      "in_reply_to_id" : 1287681547,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mx-wB",
      "original_commit_id" : "ba6cc7516e98bee65bf6b83b904b212cd10cc381",
      "original_line" : 220,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : null,
      "pull_request_review_id" : 1263595913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1288170497/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-09T09:03:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1288170497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed accidental drop of TrimToSize commit",
      "created_at" : "2023-08-09T11:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1671142331",
      "id" : 1671142331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585jm5u7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671142331/reactions"
      },
      "updated_at" : "2023-08-09T11:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671142331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on top of #28251 for the issue posted in #26403",
      "created_at" : "2023-08-10T14:07:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1673294258",
      "id" : 1673294258,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585jvHGy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1673294258/reactions"
      },
      "updated_at" : "2023-08-10T14:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1673294258",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-08-31T17:45:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1701492852",
      "id" : 1701492852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585larh0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1701492852/reactions"
      },
      "updated_at" : "2023-08-31T17:45:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1701492852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Looked on the proposed `doc/policy/version3_transactions.md` changes with other Lightning eyes on a whiteboard, and as far as I can tell it works well for Lightning usual flow and also upcoming dual-funding / splicing: https://github.com/lightning/bolts/pull/863 (to be checked again when the specs are finalized)\r\n\r\nThe replacement rule for signed version=3 transactions is the following as of 06e41874, it can replaces nversion=2 signaling replaceability or opt-out transactions in a node with `mempoolfullrbf=1`. It cannot replace non-signaling nversion=2 (L785 in `src/validation.cpp`). In term of types of Lightning channels:\r\n- old legacy channels: second-stage HTLC txn on counterparty commitment can be still be pinned (cf. mailing list post https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-April/002639.html)\r\n- anchor-outputs channels: commitment and second-stage HTLC are explicitly signaling RBF on both asymmetric states\r\n\r\nOnce nversion=3 is deployed, the new nversion=3 should be able to to replace all the anchor-outputs channels transactions without rejection. I think old legacy channels Lightning node operators would be advised to upgrade to anchor-outputs channels as soon as itâs ready in their Lightning implementations, and theyâve practical understanding of fee-bumping reserves management and swallow the bullet in term of on-chain fees. In the current state of things, I donât think there is a need to introduce unilateral retroactive policy rules effect as suggested [above](https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1405944407), though this can be a welcome mechanism in the far future to massively save on on-chain fees for the Lightning ecosystem.\r\n\r\nI think missing test coverage for v3 transactions not replacing not-bip125-signaling v2 transaction\r\n\r\n```\r\ncommit aec6ea3a378d532cd86f8812006e4eb42e185662\r\nAuthor: Antoine Riard <dev@ariard.me>\r\nDate:   Thu Sep 7 04:27:49 2023 +0100\r\n\r\n    Add non-v3 trasnsactions not signaling not replaceable test\r\n\r\ndiff --git a/test/functional/mempool_package_rbf.py b/test/functional/mempool_package_rbf.py\r\nindex e969b0249b..dd1c55be05 100755\r\n--- a/test/functional/mempool_package_rbf.py\r\n+++ b/test/functional/mempool_package_rbf.py\r\n@@ -143,6 +143,24 @@ class PackageRBFTest(BitcoinTestFramework):\r\n         self.assert_mempool_contents(expected=package_txns_v3, unexpected=[tx_bip125_v2[\"tx\"]])\r\n         self.generate(node, 1)\r\n \r\n+        self.log.info(\"Test that non-V3 transactions not signaling BIP125 are not replaceable\")\r\n+        coin = self.coins.pop()\r\n+\r\n+        tx_nobip125_v2 = self.wallet.create_self_transfer(\r\n+            fee=DEFAULT_FEE,\r\n+            utxo_to_spend=coin,\r\n+            sequence=MAX_BIP125_RBF_SEQUENCE +1,\r\n+            version=2\r\n+        )\r\n+        node.sendrawtransaction(tx_nobip125_v2[\"hex\"])\r\n+\r\n+        self.assert_mempool_contents(expected=[tx_nobip125_v2[\"tx\"]])\r\n+        assert not node.getmempoolentry(tx_nobip125_v2[\"tx\"].rehash())[\"bip125-replaceable\"]\r\n+        assert tx_bip125_v2[\"tx\"].nVersion == 2\r\n+        package_hex_v3, package_txns_v3 = self.create_simple_package(coin, parent_fee=0, child_fee=DEFAULT_FEE * 3, version=3)\r\n+        assert all([tx.nVersion == 3 for tx in package_txns_v3])\r\n+        assert_raises_rpc_error(-26, \"txn-mempool-conflict\", node.submitpackage, package_hex_v3)\r\n+\r\n     def test_package_rbf_additional_fees(self):\r\n         self.log.info(\"Check Package RBF must increase the absolute fee\")\r\n         node = self.nodes[0]\r\n```",
      "created_at" : "2023-09-09T00:08:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1712350787",
      "id" : 1712350787,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585mEGZD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1712350787/reactions"
      },
      "updated_at" : "2023-09-09T00:08:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1712350787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1331484501"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331484501"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note to self from Greg\r\n\r\nFor v3, where we can ask the exact miner score, use that instead of individual, otherwise absurd brutal fee when replacing child + switching sponsees. https://github.com/bitcoin/bitcoin/pull/26403/files#diff-d18bbdec91d0f4825b512a31f34666b000c7b7e2e05a3d43570c4b971532616fR415",
      "commit_id" : "06e4187468831bb65a6444e7c2c3b9edc58f3f63",
      "created_at" : "2023-09-20T11:23:43Z",
      "diff_hunk" : "@@ -180,3 +180,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);\n+        for (const auto& entry : direct_conflicts) {\n+            const CFeeRate original_individual_feerate(entry->GetModifiedFee(), entry->GetTxSize());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1331484501",
      "id" : 1331484501,
      "line" : 206,
      "node_id" : "PRRC_kwDOABII585PXNdV",
      "original_commit_id" : "06e4187468831bb65a6444e7c2c3b9edc58f3f63",
      "original_line" : 206,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : 27,
      "pull_request_review_id" : 1635406748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331484501/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T11:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331484501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-05T23:56:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1749808053",
      "id" : 1749808053,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585oS_O1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749808053/reactions"
      },
      "updated_at" : "2023-10-05T23:56:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749808053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> if we're doing nVersion 3, we should also fix the lack of discouragement for uninterpreted nSequence values and arguments to CSV/CLTV. see https://github.com/bitcoin/bitcoin/pull/22871\r\n\r\n(cc @instagibbs) decided not to do this for a few different reasons:\r\n- It's not intended for everyone to stop using v2 and switch to v3; this isn't really a \"standardness rules version bump\" so making something nonstandard here doesn't have the effect of discouraging it.\r\n- From speaking to a few folks, it doesn't seem like there are any short- or long-term plans to upgrade using these fields. So the work would likely not pay off.\r\n- It seems the branch as it's written may have the effect of making some LN transactions nonstandard.",
      "created_at" : "2023-11-27T15:26:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1828052025",
      "id" : 1828052025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585s9dw5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828052025/reactions"
      },
      "updated_at" : "2023-11-27T15:26:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828052025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@glozow I think at best you'd get ~7 bits reserved(without colliding with well-known protocols), and only for v3, which as you note isn't a general version bump",
      "created_at" : "2023-11-27T15:34:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1828066579",
      "id" : 1828066579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585s9hUT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828066579/reactions"
      },
      "updated_at" : "2023-11-27T15:34:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828066579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1406377198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1406377198"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@instagibbs I've changed this to be min(individual, ancestor) when it's v3",
      "commit_id" : "0bc637527287b40aa9c81cdebd8c90a44754b1ef",
      "created_at" : "2023-11-27T15:52:58Z",
      "diff_hunk" : "@@ -180,3 +180,43 @@ std::optional<std::string> PaysForRBF(CAmount original_fees,\n     }\n     return std::nullopt;\n }\n+\n+std::optional<std::string> CheckMinerScores(CAmount replacement_fees,\n+                                            int64_t replacement_vsize,\n+                                            const CTxMemPool::setEntries& ancestors,\n+                                            const CTxMemPool::setEntries& direct_conflicts,\n+                                            const CTxMemPool::setEntries& original_transactions)\n+{\n+        const CFeeRate replacement_individual_feerate(replacement_fees, replacement_vsize);\n+        // Ancestor feerate is the total modified fees divided by the total size. To get the\n+        // ancestor feerate, add up all the individual modified fees and sizes. Don't try to use the\n+        // cached ancestor fees and sizes because entries may have overlapping ancestors.\n+        for (CTxMemPool::txiter it : ancestors) {\n+            replacement_fees += it->GetModifiedFee();\n+            replacement_vsize += it->GetTxSize();\n+        }\n+        const CFeeRate replacement_ancestor_feerate(replacement_fees, replacement_vsize);\n+        // A package/transaction's ancestor feerate is not equivalent to the miner score; it may\n+        // overestimate. Some subset of the ancestors could be included by itself if it has other\n+        // high-feerate descendants or are themselves higher feerate than this package/transaction.\n+        // For now, as a conservative estimate, use the minimum between the transaction's individual\n+        // feerate and ancestor feerate.\n+        const CFeeRate replacement_miner_score = std::min(replacement_individual_feerate, replacement_ancestor_feerate);\n+        for (const auto& entry : direct_conflicts) {\n+            const CFeeRate original_individual_feerate(entry->GetModifiedFee(), entry->GetTxSize());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#discussion_r1406377198",
      "id" : 1406377198,
      "in_reply_to_id" : 1331484501,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585T05zu",
      "original_commit_id" : "06e4187468831bb65a6444e7c2c3b9edc58f3f63",
      "original_line" : 206,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/policy/rbf.cpp",
      "position" : null,
      "pull_request_review_id" : 1750778194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/25038",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1406377198/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-27T15:52:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1406377198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reviewers: note that the first half (7 commits) of this PR has been opened separately, in #28948. This has been rebased and current outstanding comments addressed.",
      "created_at" : "2023-11-27T16:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1828208376",
      "id" : 1828208376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585s-D74",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828208376/reactions"
      },
      "updated_at" : "2023-11-27T16:42:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828208376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-12-01T21:26:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1836799705",
      "id" : 1836799705,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585te1bZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1836799705/reactions"
      },
      "updated_at" : "2023-12-01T21:26:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1836799705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Closing this as superseded by #28948 and #28984 (v3 and package RBF PRs respectively). Note that the new package RBF has a slightly different approach than the one implemented here, permitting txns based on topology instead of v3-only. The discussion on this PR may still be helpful for context, but the volume of comments makes it pretty hard to do any review here.",
      "created_at" : "2023-12-11T15:18:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/25038#issuecomment-1850287598",
      "id" : 1850287598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/25038",
      "node_id" : "IC_kwDOABII585uSSXu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1850287598/reactions"
      },
      "updated_at" : "2023-12-11T15:18:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1850287598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
