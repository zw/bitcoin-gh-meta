[
   {
      "body" : "We ran a node with these changes between July 9th to July 13th. We attempted to connect to our node 1375078 times  (not all connections succeeded due to connection exhaustion) from 16384 district IP addresses (256 IPs per group, 64 groups using the unallocated prefix 249\\8).  Both the output file and valgrind are nominal. \r\n\r\n**Valgrind output:**\r\n```\r\ne0@ubuntu:~/bitcoin/src$ valgrind ./bitcoind -testnet -debug -printtoconsole > output.txt\r\n==53495== Memcheck, a memory error detector\r\n==53495== Copyright (C) 2002-2013, and GNU GPL'd, by Julian Seward et al.\r\n==53495== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info\r\n==53495== Command: ./bitcoind -testnet -debug -printtoconsole\r\n==53495== \r\n==53495== \r\n==53495== HEAP SUMMARY:\r\n==53495==     in use at exit: 5,976 bytes in 18 blocks\r\n==53495==   total heap usage: 1,094,555,059 allocs, 1,094,555,041 frees, 202,228,428,605 bytes allocated\r\n==53495== \r\n==53495== LEAK SUMMARY:\r\n==53495==    definitely lost: 0 bytes in 0 blocks\r\n==53495==    indirectly lost: 0 bytes in 0 blocks\r\n==53495==      possibly lost: 304 bytes in 1 blocks\r\n==53495==    still reachable: 5,672 bytes in 17 blocks\r\n==53495==         suppressed: 0 bytes in 0 blocks\r\n==53495== Rerun with --leak-check=full to see details of leaked memory\r\n==53495== \r\n==53495== For counts of detected and suppressed errors, rerun with: -v\r\n==53495== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n```\r\n\r\n**Abstracts from the output:**\r\n\r\nWe are connecting from 249\\8 and running on testnet. We can see here bitcoin swapping an offline address for a recently connected address.\r\n\r\n```\r\ntrying connection 243.7.23.180:18333 lastseen=371333.3hrs\r\nreceived: inv (37 bytes) peer=378634\r\ngot inv: tx 4fa9bb2a4f2022cca3652f1a376a28080e7dcebfc28256a13ce3f117c1deb752  have peer=378634\r\nsending: inv (37 bytes) peer=453392\r\nsending: inv (37 bytes) peer=515854\r\nsending: inv (37 bytes) peer=555025\r\n--\r\nsending: inv (73 bytes) peer=1290674\r\nsending: inv (37 bytes) peer=1288871\r\nsending: inv (37 bytes) peer=1288619\r\nreceived: ping (8 bytes) peer=515854\r\nsending: pong (8 bytes) peer=515854\r\nconnection to 243.7.23.180:18333 timeout\r\nsending: inv (37 bytes) peer=453392\r\nsending: inv (73 bytes) peer=1289172\r\nsending: inv (37 bytes) peer=1289071\r\nreceived: ping (8 bytes) peer=566065\r\nsending: pong (8 bytes) peer=566065\r\n--\r\nsending: inv (37 bytes) peer=1290273\r\nreceived: ping (8 bytes) peer=515854\r\nsending: pong (8 bytes) peer=515854\r\nsending: inv (37 bytes) peer=1288971\r\nsending: inv (37 bytes) peer=1289923\r\nSwapping 249.48.23.239:18333 for 243.7.23.180:18333 in tried table\r\nMoving 249.48.23.239:18333 to tried\r\n```",
      "created_at" : "2015-07-13T15:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-120970752",
      "id" : 120970752,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2015-07-13T15:35:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120970752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "concept ACK\r\n",
      "created_at" : "2015-09-16T13:31:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-140743461",
      "id" : 140743461,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2015-09-16T13:31:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/140743461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "What is the status here?\r\nNeeds rebase, and more review/testing.",
      "created_at" : "2016-05-05T11:30:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-217129377",
      "id" : 217129377,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2016-05-05T11:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217129377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj I've been auditing/fuzzing the existing network code and slowing adding unittests for net/addrman to establish a behavior baseline and make unittesting of this feature easier. See https://github.com/bitcoin/bitcoin/pull/7212, https://github.com/bitcoin/bitcoin/pull/7291, https://github.com/bitcoin/bitcoin/pull/7696\r\n\r\nI'm currently planning on breaking this commit into two commits (feeler connections and test-before-evict) and testing them independently. My current roadmap is:\r\n1. *Late June:* push out an cleaned up version of feeler connections, spin up some test nodes.\r\n2. *Early July:* post results from test nodes.\r\n3. *July-August:* depending on how things go, I'd like to push a cleaned up version of test-before-evict.\r\n\r\nI have found some other minor bugs in the networking code, I'm trying to figure out if I should prioritize them over this.",
      "created_at" : "2016-05-05T16:26:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-217201453",
      "id" : 217201453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2016-05-05T16:26:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217201453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6355#discussion_r73788100"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6355"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73788100"
         }
      },
      "body" : "This number seems to only effectively increase MAX_OUTBOUND_CONNECTIONS as it is not used other than adding a number to this constant.",
      "commit_id" : "caad33fb232b7d217a3f218ba50f8dd299cd41a6",
      "created_at" : "2016-08-06T16:05:44Z",
      "diff_hunk" : "@@ -55,6 +58,7 @@ using namespace std;\n \n namespace {\n     const int MAX_OUTBOUND_CONNECTIONS = 8;\n+    const int MAX_FEELER_CONNECTIONS = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#discussion_r73788100",
      "id" : 73788100,
      "original_commit_id" : "caad33fb232b7d217a3f218ba50f8dd299cd41a6",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6355",
      "updated_at" : "2016-08-06T16:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73788100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Rebase now that #8282 is merged?",
      "created_at" : "2016-08-25T11:44:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-242358078",
      "id" : 242358078,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2016-08-25T11:44:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242358078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Is this still relevant after #8282?",
      "created_at" : "2016-09-09T10:16:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-245875460",
      "id" : 245875460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2016-09-09T10:16:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245875460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Yes, #8282 only implements feeler connections, not test-before-evict.",
      "created_at" : "2016-09-09T10:39:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6355#issuecomment-245879704",
      "id" : 245879704,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6355",
      "updated_at" : "2016-09-09T10:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/245879704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
