{
   "assignee" : null,
   "body" : "Salvaging an encrypted wallet makes bitcoin quit with the following error:\r\n\r\n    bitcoin-qt: /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26: boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*): Assertion `!pthread_mutex_lock(m)' failed.\r\n    Aborted (core dumped)\r\n\r\nSteps to reproduce:\r\n\r\n1) Create new testnet wallet\r\n2) Encrypt with a passphrase\r\n3) Run with -salvagewallet\r\n\r\ndebug.log:\r\n\r\n    init message: Verifying wallet...\r\n    dbenv.open LogDir=/home/.../.bitcoin/testnet3/database ErrorFile=/home/.../.bitcoin/testnet3/db.log\r\n    Renamed wallet.dat to wallet.1365321353.bak\r\n    Salvage(aggressive) found 317 records\r\n    Bound to [::]:18333\r\n    Bound to 0.0.0.0:18333\r\n    init message: Loading block index...\r\n    Opening LevelDB in /home/.../.bitcoin/testnet3/blocks/index\r\n    Opened LevelDB successfully\r\n    Opening LevelDB in /home/.../.bitcoin/testnet3/chainstate\r\n    Opened LevelDB successfully\r\n    LoadBlockIndexDB(): last block file = 0\r\n    LoadBlockIndexDB(): last block file info: CBlockFileInfo(blocks=65142, size=47761205, heights=0...65141, time=2011-02-02...2013-04-07)\r\n    LoadBlockIndexDB(): transaction index disabled\r\n    LoadBlockIndexDB(): hashBestChain=000000000a00a2818dd027f323048e7e0b273a3cd0511b0ad129166d9d5d45a2  height=65141 date=2013-04-07 07:46:02\r\n    init message: Verifying blocks...\r\n    Verifying last 288 blocks at level 3\r\n    No coin database inconsistencies in last 289 blocks (3282 transactions)\r\n     block index            1377ms\r\n    init message: Loading wallet...\r\n    nFileVersion = 80000\r\n    Performing wallet upgrade to 60000\r\n    Cannot initialize keypool\r\n\r\nThe keypool error appears every time at startup, from then on. The wallet may be corrupted, but it from the error appears to be a bug in the code with mutexes.\r\n\r\n",
   "closed_at" : "2013-05-03T21:46:33Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 7,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2480/comments",
   "created_at" : "2013-04-07T08:04:48Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2480/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/2480",
   "id" : 12891996,
   "labels" : [
      {
         "color" : "FBBAAB",
         "name" : "Bug",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug"
      },
      {
         "color" : "e10c02",
         "name" : "Priority High",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Priority%20High"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2480/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : "2013-05-24T19:41:05Z",
      "closed_issues" : 28,
      "created_at" : "2013-04-23T22:57:25Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      },
      "description" : null,
      "due_on" : null,
      "id" : 319469,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/11/labels",
      "number" : 11,
      "open_issues" : 0,
      "state" : "closed",
      "title" : "v0.8.2",
      "updated_at" : "2013-05-24T19:41:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/11"
   },
   "number" : 2480,
   "state" : "closed",
   "title" : "Encrypted wallets and -salvagewallet",
   "updated_at" : "2013-05-07T02:46:35Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2480",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
