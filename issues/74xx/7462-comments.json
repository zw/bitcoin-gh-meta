[
   {
      "body" : "I'm just guessing here, but if this is related to RPC over SSL, then I think support for that was dropped in 0.12, see #5677. (No idea why this wouldn't affect OS X as well though, so maybe this is a bad guess.)\r\n\r\nOnly other thing I can think of is if this is somehow related to the new cookie file stuff, which would allow you to start up bitcoind without an rpcuser/password in the config (a departure from older versions), though in that case I'd expect curl to not work either unless you were using the credentials from the .cookie file.\r\n\r\nEDIT: another guess -- perhaps you're encountering some platform-specific libevent bug?",
      "created_at" : "2016-02-03T20:01:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7462#issuecomment-179432735",
      "id" : 179432735,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7462",
      "updated_at" : "2016-02-03T20:07:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179432735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "It's definitely not SSL - never used SSL for RPC. Both of the bitcoind instances I'm testing on have an rpcuser and password set, so it shouldn't be using the cookie.",
      "created_at" : "2016-02-03T20:29:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7462#issuecomment-179446281",
      "id" : 179446281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7462",
      "updated_at" : "2016-02-03T20:29:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179446281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=3",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "body" : "To diagnose it would be useful to have an intercept using tcpdump/wireshark of the HTTP session (both the request line and the headers, back and forth).",
      "created_at" : "2016-02-04T07:41:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7462#issuecomment-179693375",
      "id" : 179693375,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7462",
      "updated_at" : "2016-02-04T07:42:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/179693375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I'm not familiar with the tools so let me know if I need to change anything to get better info. Here's the output I get when running 0.12rc2:\r\n```\r\n19:26:15.615855 POST / HTTP/1.1\r\nContent-Type: application/json-rpc\r\nCache-Control: no-cache, no-store\r\nAccept: application/json-rpc\r\nPragma: no-cache\r\nUser-Agent: Java/1.8.0_72\r\nHost: 127.0.0.1:18332\r\nConnection: keep-alive\r\nContent-Length: 34\r\n\r\n{\"method\":\"getrawmempool\",\"id\":\"\"}\r\n\r\n19:26:15.615877 POST / HTTP/1.1\r\nContent-Type: application/json-rpc\r\nCache-Control: no-cache, no-store\r\nAccept: application/json-rpc\r\nPragma: no-cache\r\nUser-Agent: Java/1.8.0_72\r\nHost: 127.0.0.1:18332\r\nConnection: keep-alive\r\nContent-Length: 45\r\n\r\n{\"method\":\"estimatefee\",\"id\":\"\",\"params\":[1]}\r\n\r\n19:26:15.616042 HTTP/1.1 401 Unauthorized\r\nDate: Thu, 04 Feb 2016 19:26:15 GMT\r\nContent-Length: 0\r\nContent-Type: text/html; charset=ISO-8859-1\r\n\r\n19:26:15.616082 HTTP/1.1 401 Unauthorized\r\nDate: Thu, 04 Feb 2016 19:26:15 GMT\r\nContent-Length: 0\r\nContent-Type: text/html; charset=ISO-8859-1\r\n```\r\n\r\nOn the other hand, here's the output I see when I run my service against 0.11.2:\r\n```\r\n19:31:40.206717 POST / HTTP/1.1\r\nContent-Type: application/json-rpc\r\nCache-Control: no-cache, no-store\r\nAccept: application/json-rpc\r\nPragma: no-cache\r\nUser-Agent: Java/1.8.0_72\r\nHost: 127.0.0.1:18332\r\nConnection: keep-alive\r\nContent-Length: 45\r\n\r\n{\"method\":\"estimatefee\",\"id\":\"\",\"params\":[1]}\r\n\r\n19:31:40.206868 HTTP/1.0 401 Authorization Required\r\nDate: Thu, 04 Feb 2016 19:31:40 +0000\r\nServer: bitcoin-json-rpc/v0.11.2\r\nWWW-Authenticate: Basic realm=\"jsonrpc\"\r\nContent-Type: text/html\r\nContent-Length: 296\r\n\r\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\r\n\"http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd\">\r\n<HTML>\r\n<HEAD>\r\n<TITLE>Error</TITLE>\r\n<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=ISO-8859-1'>\r\n</HEAD>\r\n<BODY><H1>401 Unauthorized.</H1></BODY>\r\n</HTML>\r\n\r\n19:31:40.210566 POST / HTTP/1.1\r\nContent-Type: application/json-rpc\r\nCache-Control: no-cache, no-store\r\nAccept: application/json-rpc\r\nPragma: no-cache\r\nUser-Agent: Java/1.8.0_72\r\nHost: 127.0.0.1:18332\r\nConnection: keep-alive\r\nContent-Length: 45\r\nAuthorization: Basic Yml0Y29pbnJwYzphc2Rm\r\n\r\n{\"method\":\"estimatefee\",\"id\":\"\",\"params\":[1]}\r\n\r\n19:31:40.210753 HTTP/1.1 200 OK\r\nDate: Thu, 04 Feb 2016 19:31:40 +0000\r\nConnection: keep-alive\r\nContent-Length: 44\r\nContent-Type: application/json\r\nServer: bitcoin-json-rpc/v0.11.2\r\n\r\n{\"result\":-1.00000000,\"error\":null,\"id\":\"\"}\r\n\r\n19:31:40.231422 POST / HTTP/1.1\r\nContent-Type: application/json-rpc\r\nCache-Control: no-cache, no-store\r\nAccept: application/json-rpc\r\nPragma: no-cache\r\nUser-Agent: Java/1.8.0_72\r\nHost: 127.0.0.1:18332\r\nConnection: keep-alive\r\nAuthorization: Basic Yml0Y29pbnJwYzphc2Rm\r\nContent-Length: 45\r\n\r\n{\"method\":\"estimatefee\",\"id\":\"\",\"params\":[2]}\r\n\r\n19:31:40.231624 HTTP/1.1 200 OK\r\nDate: Thu, 04 Feb 2016 19:31:40 +0000\r\nConnection: keep-alive\r\nContent-Length: 43\r\nContent-Type: application/json\r\nServer: bitcoin-json-rpc/v0.11.2\r\n\r\n{\"result\":0.00022187,\"error\":null,\"id\":\"\"}\r\n```\r\n\r\nSo, offhand there is a clear difference in the response from bitcoind; it seems to be no longer returning the HTML. I'm not completely sure that this is what causes Java's Authenticator class to break, but it sounds like a distinct possibility. It /appears/ that the way Java's Authenticator class works is that it makes an initial unauthenticated request, then upon parsing a 401 response it sets the Authorization header on future requests. Still not sure why this would be a problem on Linux but not OS X.\r\n\r\nHowever, this does explain why I can upgrade my node from 0.11.2 to 0.12 while the service is still running and the RPC requests continue to work - it's only after restarting my service that the calls fail.\r\n\r\n**Edit:@laanwj** cleaned up the post a bit to manually demux the TCP streams; the transport-layer details make it hard to see the forest for the trees. I think tcpdump has an option to show TCP stream content instead of raw packets, but this will do.",
      "created_at" : "2016-02-04T19:44:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7462#issuecomment-180019559",
      "id" : 180019559,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7462",
      "updated_at" : "2016-02-05T09:35:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180019559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/288011?v=3",
         "events_url" : "https://api.github.com/users/jlopp/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jlopp/followers",
         "following_url" : "https://api.github.com/users/jlopp/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jlopp/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jlopp",
         "id" : 288011,
         "login" : "jlopp",
         "organizations_url" : "https://api.github.com/users/jlopp/orgs",
         "received_events_url" : "https://api.github.com/users/jlopp/received_events",
         "repos_url" : "https://api.github.com/users/jlopp/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jlopp/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jlopp/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jlopp"
      }
   },
   {
      "body" : "I think this is the key `WWW-Authenticate: Basic realm=\"jsonrpc\"`. No such header in the new response.\r\n",
      "created_at" : "2016-02-05T09:37:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7462#issuecomment-180272208",
      "id" : 180272208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7462",
      "updated_at" : "2016-02-05T09:37:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180272208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@jlopp Can you test if  #7472 solves your problem?",
      "created_at" : "2016-02-05T09:53:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7462#issuecomment-180277627",
      "id" : 180277627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7462",
      "updated_at" : "2016-02-05T09:53:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/180277627",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
