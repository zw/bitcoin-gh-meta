[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27071).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/27071#pullrequestreview-1680739374), [jonatack](https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1765091098), [achow101](https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1771363317) |\n| Concept ACK | [brunoerg](https://github.com/bitcoin/bitcoin/pull/27071#pullrequestreview-1371196157) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28248](https://github.com/bitcoin/bitcoin/pull/28248) (p2p: peer connection bug fixes, logic and logging improvements by jonatack)\n* [#28170](https://github.com/bitcoin/bitcoin/pull/28170) (p2p: adaptive connections services flags by furszy)\n* [#27837](https://github.com/bitcoin/bitcoin/pull/27837) (net: introduce block tracker to retry to download blocks after failure by furszy)\n* [#27557](https://github.com/bitcoin/bitcoin/pull/27557) (net: call getaddrinfo() in detachable thread to prevent stalling by pinheadmz)\n* [#27375](https://github.com/bitcoin/bitcoin/pull/27375) (net: support unix domain sockets for -proxy and -onion by pinheadmz)\n* [#25390](https://github.com/bitcoin/bitcoin/pull/25390) (sync: introduce a thread-safe generic container and use it to remove a bunch of \"GlobalMutex\"es by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-02-10T11:20:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1425658309",
      "id" : 1425658309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585U-dHF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1425658309/reactions"
      },
      "updated_at" : "2023-10-19T16:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1425658309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1103877367"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103877367"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Does this need a Mutex, considering it's being accessed from both Node and GUI?",
      "commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "created_at" : "2023-02-12T21:18:01Z",
      "diff_hunk" : "@@ -40,6 +40,8 @@ bool fNameLookup = DEFAULT_NAME_LOOKUP;\n int g_socks5_recv_timeout = 20 * 1000;\n static std::atomic<bool> interruptSocks5Recv(false);\n \n+ReachableNets g_reachable_nets;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1103877367",
      "id" : 1103877367,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII585By9T3",
      "original_commit_id" : "573117f79aebe482dccd6c91366c79663a7d5f47",
      "original_line" : 43,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 4,
      "pull_request_review_id" : 1294785408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103877367/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T15:51:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103877367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104641668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104641668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now that `MaybeFlipIPv6toCJDNS` is available in `netbase`, would it make sense (maybe in follow-ups) to also use it in the `Lookup()` functions, not just `LookupSubNet`) and reduce the number of occurrences we have to call `MaybeFlipIPv6toCJDNS` from outside it?",
      "commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "created_at" : "2023-02-13T15:38:11Z",
      "diff_hunk" : "@@ -694,6 +694,7 @@ bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out)\n     CNetAddr addr;\n \n     if (LookupHost(str_addr, addr, /*fAllowLookup=*/false)) {\n+        addr = MaybeFlipIPv6toCJDNS(CService{addr, /*port=*/0});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104641668",
      "id" : 1104641668,
      "line" : 697,
      "node_id" : "PRRC_kwDOABII585B136E",
      "original_commit_id" : "45a79d48ca70e52e12a50eed8ff73ec772519b5e",
      "original_line" : 697,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 4,
      "pull_request_review_id" : 1294785408,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104641668/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T15:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104641668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104785968"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104785968"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It has inside, `ReachableNets::m_mutex`.",
      "commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "created_at" : "2023-02-13T17:12:47Z",
      "diff_hunk" : "@@ -40,6 +40,8 @@ bool fNameLookup = DEFAULT_NAME_LOOKUP;\n int g_socks5_recv_timeout = 20 * 1000;\n static std::atomic<bool> interruptSocks5Recv(false);\n \n+ReachableNets g_reachable_nets;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104785968",
      "id" : 1104785968,
      "in_reply_to_id" : 1103877367,
      "line" : 43,
      "node_id" : "PRRC_kwDOABII585B2bIw",
      "original_commit_id" : "573117f79aebe482dccd6c91366c79663a7d5f47",
      "original_line" : 43,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 4,
      "pull_request_review_id" : 1296108363,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104785968/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T17:12:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104785968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104803546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104803546"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In d9b95cb1eedb9f165df93dcae0aba96ede40767a, I could check that all CJDNS address starts with [OxFC](https://github.com/cjdelisle/cjdns/blob/master/doc/Whitepaper.md#pulling-it-all-together), so, it switches the first byte to `0x55` to avoid generating it that look like CJDNS. But why specifically `0x55`?",
      "commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "created_at" : "2023-02-13T17:25:14Z",
      "diff_hunk" : "@@ -36,7 +36,11 @@ CNetAddr ConsumeNetAddr(FuzzedDataProvider& fuzzed_data_provider) noexcept\n     } else if (network == Network::NET_IPV6) {\n         if (fuzzed_data_provider.remaining_bytes() >= 16) {\n             in6_addr v6_addr = {};\n-            memcpy(v6_addr.s6_addr, fuzzed_data_provider.ConsumeBytes<uint8_t>(16).data(), 16);\n+            auto addr_bytes = fuzzed_data_provider.ConsumeBytes<uint8_t>(16);\n+            if (addr_bytes[0] == 0xFC) { // Avoid generating IPv6 addresses that look like CJDNS.\n+                addr_bytes[0] = 0x55;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104803546",
      "id" : 1104803546,
      "line" : 41,
      "node_id" : "PRRC_kwDOABII585B2fba",
      "original_commit_id" : "d9b95cb1eedb9f165df93dcae0aba96ede40767a",
      "original_line" : 41,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util/net.cpp",
      "position" : 7,
      "pull_request_review_id" : 1296128737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104803546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T17:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104803546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104805263"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104805263"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n            const bool reachable{g_reachable_nets.Contains(addr)};\r\n```",
      "commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "created_at" : "2023-02-13T17:26:28Z",
      "diff_hunk" : "@@ -3635,14 +3635,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 continue;\n             }\n             ++num_proc;\n-            bool fReachable = IsReachable(addr);\n+            const bool reachable = g_reachable_nets.Contains(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104805263",
      "id" : 1104805263,
      "line" : 3638,
      "node_id" : "PRRC_kwDOABII585B2f2P",
      "original_commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "original_line" : 3638,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1296130709,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104805263/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T17:26:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104805263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think of `netbase` as a module for mostly context-free basic low-level methods - this PR moves `IsReachable` to it and saves its state in a global variable,\r\n\r\nI was thinking about the same, but `netbase` is already stateful - `proxyInfo`, `nameProxy`, `nConnectTimeout`, `fNameLookup`, `g_socks5_recv_timeout`, `interruptSocks5Recv` are global variables that keep state, which influence the output of the functions defined in `netbase`, making them context-dependent.\r\n\r\n`SetProxy()`, `GetProxy()` (already defined in `netbase`) are very similar to the `SetReachable()`, `IsReachable()` functions (which this PR moves into `netbase`). Thus I think the move is appropriate.\r\n\r\n> accessing it both from different threads within the node and the GUI. Shouldn't the information flow between the Node and the GUI rather go through `node/interfaces` instead of having a shared global variable?\r\n\r\nI am not sure `IsReachable()` fits into that. It is not like that in `master` where there is the global variable `vfLimited[]`.\r\n\r\n> Did you consider the alternative approach of letting banman be agnostic of CJDNS (everything stays IPv6, CJDNS addresses get a /128 netmask just like single IPv6 addresses), and add special \"flipping\" logic to the points where we need to compare actual addresses from peers with the results from banman? I didn't try it yet so not sure if viable, but that was my first idea of how to fix the issue of not being able to ban CJDNS peers.\r\n\r\n`banman` is using `CSubNet::Match()`. This would mean in that method we should match IPv6 vs CJDNS. I did not like the idea because `CSubNet` is used also elsewhere and it could influence other parts of the code. But in general it feels wrong to \"pretend\" that an address from network X belongs to a subnet from network Y. I even coded that, but eventually decided to avoid it:\r\n\r\n<details>\r\n<summary>CSubNet::Match() mix IPv6 and CJDNS</summary>\r\n\r\n```diff\r\n--- a/src/netaddress.cpp\r\n+++ b/src/netaddress.cpp\r\n@@ -1039,24 +1039,40 @@ CSubNet::CSubNet(const CNetAddr& addr) : CSubNet()\r\n /**\r\n  * @returns True if this subnet is valid, the specified address is valid, and\r\n  *          the specified address belongs in this subnet.\r\n  */\r\n bool CSubNet::Match(const CNetAddr &addr) const\r\n {\r\n-    if (!valid || !addr.IsValid() || network.m_net != addr.m_net)\r\n+    if (!valid || !addr.IsValid()) {\r\n         return false;\r\n+    }\r\n \r\n-    switch (network.m_net) {\r\n+    Network subnet_net = network.m_net;\r\n+    Network addr_net = addr.m_net;\r\n+\r\n+    if ((subnet_net == NET_IPV6 && addr_net == NET_CJDNS) ||\r\n+        (subnet_net == NET_CJDNS && addr_net == NET_IPV6)) {\r\n+        // Treat both as CJDNS.\r\n+        subnet_net = NET_CJDNS;\r\n+        addr_net = NET_CJDNS;\r\n+    }\r\n+\r\n+    if (subnet_net != addr_net) {\r\n+        return false;\r\n+    }\r\n+\r\n+    switch (subnet_net) {\r\n     case NET_IPV4:\r\n     case NET_IPV6:\r\n         break;\r\n     case NET_ONION:\r\n     case NET_I2P:\r\n-    case NET_CJDNS:\r\n     case NET_INTERNAL:\r\n         return addr == network;\r\n+    case NET_CJDNS:\r\n+        return addr.m_addr == network.m_addr;\r\n     case NET_UNROUTABLE:\r\n     case NET_MAX:\r\n         return false;\r\n     }\r\n \r\n     assert(network.m_addr.size() == addr.m_addr.size());\r\n```\r\n</details>\r\n\r\nNote also that the current PR also resolves two other issues, in addition to the banman one - listed as items in the OP.",
      "created_at" : "2023-02-13T17:41:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1428383348",
      "id" : 1428383348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585VI2Z0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1428383348/reactions"
      },
      "updated_at" : "2023-02-13T17:41:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1428383348",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104836123"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104836123"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, well. I feel like `MaybeFlipIPv6toCJDNS()` is warranted in some of the lower level `Lookup*()` functions. But they are called from so many places, the change would be very invasive. I have to gather some bravery in order to look into that. If that is to be done, maybe it should be preceded by some simplification of the `Lookup*()` family of functions. I get a headache every time I have to deal with:\r\n\r\n```cpp\r\nbool LookupHost(const std::string& name, std::vector<CNetAddr>& vIP, unsigned int nMaxSolutions, bool fAllowLookup, DNSLookupFn dns_lookup_function = g_dns_lookup);\r\nbool LookupHost(const std::string& name, CNetAddr& addr, bool fAllowLookup, DNSLookupFn dns_lookup_function = g_dns_lookup);\r\nbool Lookup(const std::string& name, std::vector<CService>& vAddr, uint16_t portDefault, bool fAllowLookup, unsigned int nMaxSolutions, DNSLookupFn dns_lookup_function = g_dns_lookup);\r\nbool Lookup(const std::string& name, CService& addr, uint16_t portDefault, bool fAllowLookup, DNSLookupFn dns_lookup_function = g_dns_lookup);\r\nCService LookupNumeric(const std::string& name, uint16_t portDefault = 0, DNSLookupFn dns_lookup_function = g_dns_lookup);\r\nbool LookupIntern(const std::string& name, std::vector<CNetAddr>& vIP, unsigned int nMaxSolutions, bool fAllowLookup, DNSLookupFn dns_lookup_function);\r\n```",
      "commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "created_at" : "2023-02-13T17:53:16Z",
      "diff_hunk" : "@@ -694,6 +694,7 @@ bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out)\n     CNetAddr addr;\n \n     if (LookupHost(str_addr, addr, /*fAllowLookup=*/false)) {\n+        addr = MaybeFlipIPv6toCJDNS(CService{addr, /*port=*/0});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1104836123",
      "id" : 1104836123,
      "in_reply_to_id" : 1104641668,
      "line" : 697,
      "node_id" : "PRRC_kwDOABII585B2nYb",
      "original_commit_id" : "45a79d48ca70e52e12a50eed8ff73ec772519b5e",
      "original_line" : 697,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 4,
      "pull_request_review_id" : 1296173130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104836123/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-13T17:53:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1104836123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I am not sure `IsReachable()` fits into that. It is not like that in `master` where there is the global variable `vfLimited[]`.\r\n\r\nYes, within `Node` it's still one of several global variables, so this is not a change wrt master.\r\nHowever, `vfLimited` wasn't accessed by the GUI because it wasn't part of `LookupSubnet()` before, while `g_reachable_nets` is. So I'm curious if this would work well together with multiprocess (see #10102, fyi @ryanofsky ).\r\nI think most of the data in `vfLimited` is determined during `init` and does not change later (so it might be initialised at the fork point?) - but `torcontrol` calling `SetReachable()` later could be an exception? ",
      "created_at" : "2023-02-13T18:47:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1428473660",
      "id" : 1428473660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585VJMc8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1428473660/reactions"
      },
      "updated_at" : "2023-02-13T18:47:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1428473660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1105886420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105886420"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "created_at" : "2023-02-14T14:19:38Z",
      "diff_hunk" : "@@ -3635,14 +3635,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 continue;\n             }\n             ++num_proc;\n-            bool fReachable = IsReachable(addr);\n+            const bool reachable = g_reachable_nets.Contains(addr);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1105886420",
      "id" : 1105886420,
      "in_reply_to_id" : 1104805263,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585B6nzU",
      "original_commit_id" : "9b656a5eb18f3a4c2f438bb3a4899db5441adb7f",
      "original_line" : 3638,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1297697029,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105886420/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T14:19:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105886420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1105887566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105887566"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There is no reason for 0x55 specifically. I added a comment to clarify:\r\n\r\n`// Just an arbitrary number, anything != 0xFC would do.`",
      "commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "created_at" : "2023-02-14T14:20:31Z",
      "diff_hunk" : "@@ -36,7 +36,11 @@ CNetAddr ConsumeNetAddr(FuzzedDataProvider& fuzzed_data_provider) noexcept\n     } else if (network == Network::NET_IPV6) {\n         if (fuzzed_data_provider.remaining_bytes() >= 16) {\n             in6_addr v6_addr = {};\n-            memcpy(v6_addr.s6_addr, fuzzed_data_provider.ConsumeBytes<uint8_t>(16).data(), 16);\n+            auto addr_bytes = fuzzed_data_provider.ConsumeBytes<uint8_t>(16);\n+            if (addr_bytes[0] == 0xFC) { // Avoid generating IPv6 addresses that look like CJDNS.\n+                addr_bytes[0] = 0x55;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1105887566",
      "id" : 1105887566,
      "in_reply_to_id" : 1104803546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585B6oFO",
      "original_commit_id" : "d9b95cb1eedb9f165df93dcae0aba96ede40767a",
      "original_line" : 41,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1297698826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105887566/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T14:20:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105887566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106079939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106079939"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Got it, thank you!",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-14T16:41:35Z",
      "diff_hunk" : "@@ -36,7 +36,11 @@ CNetAddr ConsumeNetAddr(FuzzedDataProvider& fuzzed_data_provider) noexcept\n     } else if (network == Network::NET_IPV6) {\n         if (fuzzed_data_provider.remaining_bytes() >= 16) {\n             in6_addr v6_addr = {};\n-            memcpy(v6_addr.s6_addr, fuzzed_data_provider.ConsumeBytes<uint8_t>(16).data(), 16);\n+            auto addr_bytes = fuzzed_data_provider.ConsumeBytes<uint8_t>(16);\n+            if (addr_bytes[0] == 0xFC) { // Avoid generating IPv6 addresses that look like CJDNS.\n+                addr_bytes[0] = 0x55;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106079939",
      "id" : 1106079939,
      "in_reply_to_id" : 1104803546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585B7XDD",
      "original_commit_id" : "d9b95cb1eedb9f165df93dcae0aba96ede40767a",
      "original_line" : 41,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/fuzz/util/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1297987720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106079939/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T16:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106079939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`9b656a5...7a93d7b`: rebase and address suggestions",
      "created_at" : "2023-02-14T17:09:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1430090612",
      "id" : 1430090612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585VPXN0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1430090612/reactions"
      },
      "updated_at" : "2023-02-14T17:09:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1430090612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106360822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106360822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, while touching this it may be good to add the missing brackets to `if (net == NET_UNROUTABLE)`, feel free to ignore",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-14T20:54:32Z",
      "diff_hunk" : "@@ -1323,38 +1323,32 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n \n     if (args.IsArgSet(\"-onlynet\")) {\n-        std::set<enum Network> nets;\n+        g_reachable_nets.RemoveAll();\n         for (const std::string& snet : args.GetArgs(\"-onlynet\")) {\n             enum Network net = ParseNetwork(snet);\n             if (net == NET_UNROUTABLE)\n                 return InitError(strprintf(_(\"Unknown network specified in -onlynet: '%s'\"), snet));\n-            nets.insert(net);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106360822",
      "id" : 1106360822,
      "line" : 1331,
      "node_id" : "PRRC_kwDOABII585B8bn2",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 1331,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 10,
      "pull_request_review_id" : 1298409472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106360822/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T21:14:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106360822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106373444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106373444"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, it may be nice to hoist `0xfc` used here and in `src/test/fuzz/util/net.cpp#L40-41` to a constexpr/constant, as grepping the codebase for it returns many unrelated false positives.",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-14T21:04:20Z",
      "diff_hunk" : "@@ -810,3 +813,13 @@ bool IsBadPort(uint16_t port)\n     }\n     return false;\n }\n+\n+CService MaybeFlipIPv6toCJDNS(const CService& service)\n+{\n+    CService ret{service};\n+    if (ret.m_net == NET_IPV6 && ret.m_addr[0] == 0xfc && g_reachable_nets.Contains(NET_CJDNS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106373444",
      "id" : 1106373444,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585B8etE",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 820,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1298409472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106373444/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T21:14:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106373444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106375231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106375231"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "9e4781805b5b59dc\r\n\r\nAdd `AssertLockNotHeld(m_mutex);` to the `RemoveAll()` and to both of the `Contains()` class methods?\r\n\r\nPerhaps also add `[[nodiscard]]` to the latter two declarations.",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-14T21:05:54Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106375231",
      "id" : 1106375231,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585B8fI_",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 104,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 48,
      "pull_request_review_id" : 1298409472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106375231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-14T21:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106375231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106381226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106381226"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "9e4781805b5b59dc As BIP155 networks are added or removed over time, `m_reachable` could go out of sync with `enum Network` in `netaddress.h` ... perhaps construct it programmatically  from `enum Network` (now or in a follow-up)?",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-14T21:10:13Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        return Contains(addr.GetNetwork());\n+    }\n+\n+private:\n+    mutable Mutex m_mutex;\n+\n+    std::unordered_set<Network> m_reachable GUARDED_BY(m_mutex){\n+        NET_UNROUTABLE,\n+        NET_IPV4,\n+        NET_IPV6,\n+        NET_ONION,\n+        NET_I2P,\n+        NET_CJDNS,\n+        NET_INTERNAL",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1106381226",
      "id" : 1106381226,
      "line" : 119,
      "node_id" : "PRRC_kwDOABII585B8gmq",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 119,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 63,
      "pull_request_review_id" : 1298409472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106381226/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-15T00:52:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1106381226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`7a93d7b0f9...8991ed2c6e`: address suggestions",
      "created_at" : "2023-02-15T17:05:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1431696802",
      "id" : 1431696802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585VVfWi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431696802/reactions"
      },
      "updated_at" : "2023-02-15T17:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1431696802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107408761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107408761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ignoring to minimize the size of the diff.",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-15T17:06:28Z",
      "diff_hunk" : "@@ -1323,38 +1323,32 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n \n     if (args.IsArgSet(\"-onlynet\")) {\n-        std::set<enum Network> nets;\n+        g_reachable_nets.RemoveAll();\n         for (const std::string& snet : args.GetArgs(\"-onlynet\")) {\n             enum Network net = ParseNetwork(snet);\n             if (net == NET_UNROUTABLE)\n                 return InitError(strprintf(_(\"Unknown network specified in -onlynet: '%s'\"), snet));\n-            nets.insert(net);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107408761",
      "id" : 1107408761,
      "in_reply_to_id" : 1106360822,
      "line" : 1331,
      "node_id" : "PRRC_kwDOABII585CAbd5",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 1331,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 10,
      "pull_request_review_id" : 1299941186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107408761/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-15T17:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107408761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107409772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107409772"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-15T17:07:22Z",
      "diff_hunk" : "@@ -810,3 +813,13 @@ bool IsBadPort(uint16_t port)\n     }\n     return false;\n }\n+\n+CService MaybeFlipIPv6toCJDNS(const CService& service)\n+{\n+    CService ret{service};\n+    if (ret.m_net == NET_IPV6 && ret.m_addr[0] == 0xfc && g_reachable_nets.Contains(NET_CJDNS)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107409772",
      "id" : 1107409772,
      "in_reply_to_id" : 1106373444,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585CAbts",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 820,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1299943272,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107409772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-15T17:07:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107409772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107422252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107422252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added `[[nodiscard]]` and one `AssertLockNotHeld()` where it is not immediately followed by `LOCK()`. I do not see the point in:\r\n\r\n```cpp\r\nAssertLockNotHeld(m); // the point of this is to crash if m is held\r\nLOCK(m); // but this will crash if m is held, so what is the point?\r\n```\r\n\r\nIf it is really desirable to have `AssertLockNotHeld()` before every `LOCK()`, then `AssertLockNotHeld()` should be put inside `LOCK()`.\r\n\r\nThis is another story:\r\n\r\n```cpp\r\nAssertLockNotHeld(m);\r\nif (x) {\r\n    LOCK(m);\r\n    ...\r\n}\r\n```\r\n\r\nbecause if it gets executed with `x == false` and `AssertLockNotHeld()` is missing then it will not catch the problem (by crashing).",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-15T17:13:42Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107422252",
      "id" : 1107422252,
      "in_reply_to_id" : 1106375231,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585CAews",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 104,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 48,
      "pull_request_review_id" : 1299963130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107422252/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-15T17:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107422252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107491391"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107491391"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> LOCK(m); // but this will crash if m is held, so what is the point?\r\n\r\nAh, I see that double lock detection at runtime was added by you in 95975dd08d8f.\r\n\r\n```diff\r\n+++ b/src/netbase.h\r\n@@ -73,6 +73,7 @@ public:\r\n     void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\r\n     {\r\n         AssertLockNotHeld(m_mutex);\r\n+        LOCK(m_mutex);\r\n         if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\r\n             LOCK(m_mutex);\r\n```\r\n```\r\n2023-02-15T17:48:41Z SetNetworkActive: true\r\n2023-02-15T17:48:41Z DOUBLE LOCK DETECTED\r\n2023-02-15T17:48:41Z Lock order:\r\n2023-02-15T17:48:41Z  (*) 'm_mutex' in netbase.h:76 (in thread 'init')\r\n2023-02-15T17:48:41Z  (*) 'm_mutex' in netbase.h:78 (in thread 'init')\r\nAssertion failed: detected double lock for 'm_mutex' in netbase.h:78 (in thread 'init'), details in debug log.\r\n```\r\n",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-15T17:53:06Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107491391",
      "id" : 1107491391,
      "in_reply_to_id" : 1106375231,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585CAvo_",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 104,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 48,
      "pull_request_review_id" : 1300064718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107491391/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-15T17:53:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107491391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107505114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107505114"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> If it is really desirable to have `AssertLockNotHeld()` before every `LOCK()`\r\n\r\nI think the general idea is to have a runtime lock assertion corresponding to every thread safety annotation, where it makes sense (cf the developer notes).",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-15T18:02:42Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107505114",
      "id" : 1107505114,
      "in_reply_to_id" : 1106375231,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585CAy_a",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 104,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 48,
      "pull_request_review_id" : 1300080160,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107505114/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-15T18:02:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107505114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107561322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107561322"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "e1910f6743d73a extra newline at EOF\r\n\r\nUnrelated, would it be worth avoiding a `CService` copy in the most frequent case? (maybe returning `std::optional<CService>` if flipped to CJDNS could be a good idea too)\r\n\r\n```diff\r\n CService MaybeFlipIPv6toCJDNS(const CService& service)\r\n {\r\n+    if (service.m_net != NET_IPV6 || service.m_addr[0] != CJDNS_PREFIX || !g_reachable_nets.Contains(NET_CJDNS)) return service;\r\n     CService ret{service};\r\n-    if (ret.m_net == NET_IPV6 && ret.m_addr[0] == CJDNS_PREFIX && g_reachable_nets.Contains(NET_CJDNS)) {\r\n-        ret.m_net = NET_CJDNS;\r\n-    }\r\n+    ret.m_net = NET_CJDNS;\r\n     return ret;\r\n }\r\n-\r\n```\r\n",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-15T18:46:25Z",
      "diff_hunk" : "@@ -810,3 +813,13 @@ bool IsBadPort(uint16_t port)\n     }\n     return false;\n }\n+\n+CService MaybeFlipIPv6toCJDNS(const CService& service)\n+{\n+    CService ret{service};\n+    if (ret.m_net == NET_IPV6 && ret.m_addr[0] == CJDNS_PREFIX && g_reachable_nets.Contains(NET_CJDNS)) {\n+        ret.m_net = NET_CJDNS;\n+    }\n+    return ret;\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1107561322",
      "id" : 1107561322,
      "line" : 825,
      "node_id" : "PRRC_kwDOABII585CBAtq",
      "original_commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "original_line" : 825,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : 30,
      "pull_request_review_id" : 1300143653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107561322/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-16T17:19:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1107561322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Just thinking aloud:\r\n\r\n1. Subnetting does not make sense for tor/i2p/cjdns\r\n2. `BanMan` entries are always subnets (`CSubNet` objects), even for single host bans\r\n\r\nIt follows that banman is doing something that does not make sense (e.g. subnetting tor). This is the root of the problem. I think if that is eradicated, then the rest will untangle by itself.\r\n\r\nWhat this means - store two ban maps in `BanMan` - one for single hosts and one for subnets (only for IPv[46] subnets). This way also lookup will be faster for single hosts - if a hash table is used for the single host bans, then lookup will be `O(1)`. Right now we iterate over all ban entries and check if `CSubNet::Match()` is `true` (which is `O(number of bans)`).\r\n\r\nHmm...",
      "created_at" : "2023-02-16T08:29:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1432702025",
      "id" : 1432702025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585VZUxJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1432702025/reactions"
      },
      "updated_at" : "2023-02-16T08:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1432702025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1108164412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1108164412"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The double lock detection inside `LOCK()` is only if `DEBUG_LOCKORDER` is defined.\r\nEdit: and `AssertLockNotHeld()` is also only being done if `DEBUG_LOCKORDER` is defined.",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-16T08:38:09Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1108164412",
      "id" : 1108164412,
      "in_reply_to_id" : 1106375231,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585CDT88",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 104,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 48,
      "pull_request_review_id" : 1300980766,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1108164412/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-16T13:39:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1108164412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1109626265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109626265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Opened https://github.com/bitcoin/bitcoin/pull/27116 to amend the docs.",
      "commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "created_at" : "2023-02-17T10:55:49Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1109626265",
      "id" : 1109626265,
      "in_reply_to_id" : 1106375231,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585CI42Z",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 104,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 48,
      "pull_request_review_id" : 1303161230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109626265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-17T10:55:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1109626265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Subnetting does not make sense for tor/i2p/cjdns\r\n> It follows that banman is doing something that does not make sense (e.g. subnetting tor). This is the root of the problem. I think if that is eradicated, then the rest will untangle by itself.\r\n\r\n`CConnman::DisconnectNode` also handles addresses as subnets. Is this a problem?\r\n\r\n \r\n",
      "created_at" : "2023-02-17T18:34:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1435079192",
      "id" : 1435079192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585ViZIY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435079192/reactions"
      },
      "updated_at" : "2023-02-17T18:34:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435079192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-17T19:08:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1435115228",
      "id" : 1435115228,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585Vih7c",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435115228/reactions"
      },
      "updated_at" : "2023-02-17T19:08:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435115228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> `CConnman::DisconnectNode` also handles addresses as subnets. Is this a problem?\r\n\r\nWell, it works, but since it does something nonsensical (e.g. subnetting tor) it could be a source of confusion or ultimately, bugs. IMO it shouldn't be doing that. I think the existence and implementation of `CConnman::DisconnectNode(const CSubNet& subnet)` is ok - it will/should disconnect any IPv[46] address that matches the given IPv[46] subnet. But this one:\r\n\r\n```cpp\r\nbool CConnman::DisconnectNode(const CNetAddr& addr)\r\n{\r\n    return DisconnectNode(CSubNet(addr));\r\n}\r\n```\r\n\r\nwould better iterate `m_nodes` and check for equality between the given `addr` and `CNode::addr`.\r\n\r\nI will try to allow only IPv[46] `CSubNet`s and see if everything blows up in a spectacular way... :bomb: :confetti_ball: ",
      "created_at" : "2023-02-20T14:30:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1437113256",
      "id" : 1437113256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585VqJuo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1437113256/reactions"
      },
      "updated_at" : "2023-02-20T14:30:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1437113256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`8991ed2c6e...c2a86ba667`: rebase due to conflicts and address suggestion\r\n\r\nInvalidates ACK from @jonatack \r\n\r\n@mzumsande, actually there are two problems - I am talking about Tor subnets and you are talking about a global variable used by the GUI. I will try to mimic the proxy in order to address the latter.",
      "created_at" : "2023-02-24T15:20:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1443837012",
      "id" : 1443837012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585WDzRU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1443837012/reactions"
      },
      "updated_at" : "2023-02-24T15:29:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1443837012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1117187548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117187548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I tested this and there is one copy in either case. I guess the compiler is smart enough to avoid unnecessary copies.",
      "commit_id" : "c2a86ba6674008996552830877d66a1bf888fad1",
      "created_at" : "2023-02-24T15:28:50Z",
      "diff_hunk" : "@@ -810,3 +813,13 @@ bool IsBadPort(uint16_t port)\n     }\n     return false;\n }\n+\n+CService MaybeFlipIPv6toCJDNS(const CService& service)\n+{\n+    CService ret{service};\n+    if (ret.m_net == NET_IPV6 && ret.m_addr[0] == CJDNS_PREFIX && g_reachable_nets.Contains(NET_CJDNS)) {\n+        ret.m_net = NET_CJDNS;\n+    }\n+    return ret;\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1117187548",
      "id" : 1117187548,
      "in_reply_to_id" : 1107561322,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Clu3c",
      "original_commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "original_line" : 825,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1313734861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117187548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-24T15:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117187548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I will try to mimic the proxy in order to address the latter.\r\n\r\nIn case you plan to do that, or the Tor subnets issue, in a follow-up:\r\n\r\nre-ACK c2a86ba6674008996552830877d66a1bf888fad1 per `git range-diff be2e748 8991ed2 c2a86ba6`\r\n",
      "created_at" : "2023-02-24T16:30:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1443962823",
      "id" : 1443962823,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585WER_H",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1443962823/reactions"
      },
      "updated_at" : "2023-02-24T16:31:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1443962823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1118693568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118693568"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also ran both variants in nanobench and there is no difference.",
      "commit_id" : "c2a86ba6674008996552830877d66a1bf888fad1",
      "created_at" : "2023-02-27T12:49:13Z",
      "diff_hunk" : "@@ -810,3 +813,13 @@ bool IsBadPort(uint16_t port)\n     }\n     return false;\n }\n+\n+CService MaybeFlipIPv6toCJDNS(const CService& service)\n+{\n+    CService ret{service};\n+    if (ret.m_net == NET_IPV6 && ret.m_addr[0] == CJDNS_PREFIX && g_reachable_nets.Contains(NET_CJDNS)) {\n+        ret.m_net = NET_CJDNS;\n+    }\n+    return ret;\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1118693568",
      "id" : 1118693568,
      "in_reply_to_id" : 1107561322,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585CrejA",
      "original_commit_id" : "8991ed2c6e38a35199725b6296a615733f948f87",
      "original_line" : 825,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1315514513,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118693568/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-27T12:49:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1118693568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande, it is possible to avoid calling `LookupSubNet()` from the GUI, see https://github.com/bitcoin-core/gui/pull/717. If that gets merged then this PR will be simplified - no need to touch the GUI code from here.",
      "created_at" : "2023-03-06T13:38:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1456152963",
      "id" : 1456152963,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585WyyGD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1456152963/reactions"
      },
      "updated_at" : "2023-03-06T13:38:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1456152963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> @mzumsande, it is possible to avoid calling `LookupSubNet()` from the GUI, see [bitcoin-core/gui#717](https://github.com/bitcoin-core/gui/pull/717). If that gets merged then this PR will be simplified - no need to touch the GUI code from here.\r\n\r\nhttps://github.com/bitcoin-core/gui/pull/717 has just been merged.",
      "created_at" : "2023-03-09T13:54:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1462108897",
      "id" : 1462108897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585XJgLh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1462108897/reactions"
      },
      "updated_at" : "2023-03-09T13:54:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1462108897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`c2a86ba667...fcd4d34b96`: rebase even though it is not strictly necessary. Now (after https://github.com/bitcoin-core/gui/pull/717 is merged) the GUI does not call `LookupSubNet()`.\r\n\r\nInvalidates ACK from @jonatack\r\n\r\nI still think not using `CSubNet` for Tor, I2P and CJDNS (which are not sub-nettable) makes sense and should be done. That looks like a bigger change and can be done after this PR or independently of it. It would Introduce a class that holds a list of addresses:\r\n\r\n```cpp\r\nclass NetAddrList\r\n{\r\npublic:\r\n    bool Contains(const CNetAddr& addr) const;\r\n\r\n    void InsertAddr(const CNetAddr& addr);\r\n\r\n    void InsertSubnet(const CSubNet& subnet); // must be only IPv4 or IPv6\r\n\r\nprivate:\r\n    std::unordered_set<CSubNet> m_subnets;\r\n    std::unordered_set<CNetAddr> m_addresses;\r\n}\r\n```\r\n\r\nand use that in some (all?) places where `CSubNet` is used now. `LookupSubNet()` should be changed to check if the input contains `/`, then require it to be IP subnet - that is, return either `CSubNet` or `CNetAddr` or maybe have that as a method of the above `NetAddrList`: `void InsertString(const std::string& addr)` which would add an entry to `m_subnets` or `m_addresses`.",
      "created_at" : "2023-03-15T17:41:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1470477392",
      "id" : 1470477392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585XpbRQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1470477392/reactions"
      },
      "updated_at" : "2023-03-15T17:59:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1470477392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`fcd4d34b96...8b495486e2`: rebase due to conflicts",
      "created_at" : "2023-06-08T08:11:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1582106400",
      "id" : 1582106400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585eTQcg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1582106400/reactions"
      },
      "updated_at" : "2023-06-08T08:11:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1582106400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1249523602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1249523602"
         }
      },
      "author_association" : "NONE",
      "body" : "This will remove `NET_UNROUTABLE ` and `NET_INTERNAL`, after which they cannot be re-added. Is that intentional (the function name implies it is intentional)? I ask because the other accessors guard against their removal and insertion.",
      "commit_id" : "8b495486e2e94559f0e1099eef08182e540f82c0",
      "created_at" : "2023-07-02T13:21:29Z",
      "diff_hunk" : "@@ -64,6 +65,63 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1249523602",
      "id" : 1249523602,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585KejeS",
      "original_commit_id" : "8b495486e2e94559f0e1099eef08182e540f82c0",
      "original_line" : 94,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 38,
      "pull_request_review_id" : 1509591091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1249523602/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-02T13:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1249523602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/46171726?v=4",
         "events_url" : "https://api.github.com/users/nberlin1980/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nberlin1980/followers",
         "following_url" : "https://api.github.com/users/nberlin1980/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nberlin1980/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nberlin1980",
         "id" : 46171726,
         "login" : "nberlin1980",
         "node_id" : "MDQ6VXNlcjQ2MTcxNzI2",
         "organizations_url" : "https://api.github.com/users/nberlin1980/orgs",
         "received_events_url" : "https://api.github.com/users/nberlin1980/received_events",
         "repos_url" : "https://api.github.com/users/nberlin1980/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nberlin1980/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nberlin1980/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nberlin1980"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1249529700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1249529700"
         }
      },
      "author_association" : "NONE",
      "body" : "Perhaps add test cases for `RemoveAll` as it relates to these two.",
      "commit_id" : "8b495486e2e94559f0e1099eef08182e540f82c0",
      "created_at" : "2023-07-02T13:33:19Z",
      "diff_hunk" : "@@ -720,47 +720,47 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_Network)\n {\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, false);\n-    SetReachable(NET_IPV6, false);\n-    SetReachable(NET_ONION, false);\n-    SetReachable(NET_I2P, false);\n-    SetReachable(NET_CJDNS, false);\n-\n-    BOOST_CHECK(!IsReachable(NET_IPV4));\n-    BOOST_CHECK(!IsReachable(NET_IPV6));\n-    BOOST_CHECK(!IsReachable(NET_ONION));\n-    BOOST_CHECK(!IsReachable(NET_I2P));\n-    BOOST_CHECK(!IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, true);\n-    SetReachable(NET_IPV6, true);\n-    SetReachable(NET_ONION, true);\n-    SetReachable(NET_I2P, true);\n-    SetReachable(NET_CJDNS, true);\n-\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Remove(NET_IPV4);\n+    g_reachable_nets.Remove(NET_IPV6);\n+    g_reachable_nets.Remove(NET_ONION);\n+    g_reachable_nets.Remove(NET_I2P);\n+    g_reachable_nets.Remove(NET_CJDNS);\n+\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Add(NET_IPV4);\n+    g_reachable_nets.Add(NET_IPV6);\n+    g_reachable_nets.Add(NET_ONION);\n+    g_reachable_nets.Add(NET_I2P);\n+    g_reachable_nets.Add(NET_CJDNS);\n+\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n }\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_NetworkCaseUnroutableAndInternal)\n {\n-    BOOST_CHECK(IsReachable(NET_UNROUTABLE));\n-    BOOST_CHECK(IsReachable(NET_INTERNAL));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_UNROUTABLE));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_INTERNAL));\n \n-    SetReachable(NET_UNROUTABLE, false);\n-    SetReachable(NET_INTERNAL, false);\n+    g_reachable_nets.Remove(NET_UNROUTABLE);\n+    g_reachable_nets.Remove(NET_INTERNAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1249529700",
      "id" : 1249529700,
      "line" : 760,
      "node_id" : "PRRC_kwDOABII585Kek9k",
      "original_commit_id" : "8b495486e2e94559f0e1099eef08182e540f82c0",
      "original_line" : 760,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 74,
      "pull_request_review_id" : 1509591091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1249529700/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-02T13:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1249529700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/46171726?v=4",
         "events_url" : "https://api.github.com/users/nberlin1980/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nberlin1980/followers",
         "following_url" : "https://api.github.com/users/nberlin1980/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nberlin1980/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nberlin1980",
         "id" : 46171726,
         "login" : "nberlin1980",
         "node_id" : "MDQ6VXNlcjQ2MTcxNzI2",
         "organizations_url" : "https://api.github.com/users/nberlin1980/orgs",
         "received_events_url" : "https://api.github.com/users/nberlin1980/received_events",
         "repos_url" : "https://api.github.com/users/nberlin1980/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nberlin1980/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nberlin1980/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nberlin1980"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-13T19:25:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1634780826",
      "id" : 1634780826,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585hcMaa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1634780826/reactions"
      },
      "updated_at" : "2023-07-13T19:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1634780826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294456468"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294456468"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good question. Yes, it should be like this to preserve the behavior from `master` wrt which networks are reachable if `-onlynet` is used. The relevant snippet from this PR:\r\n\r\n```diff\r\n     if (args.IsArgSet(\"-onlynet\")) {\r\n-        std::set<enum Network> nets;\r\n+        g_reachable_nets.RemoveAll();\r\n         for (const std::string& snet : args.GetArgs(\"-onlynet\")) {\r\n             enum Network net = ParseNetwork(snet);\r\n             if (net == NET_UNROUTABLE)\r\n                 return InitError(strprintf(_(\"Unknown network specified in -onlynet: '%s'\"), snet));\r\n-            nets.insert(net);\r\n-        }\r\n-        for (int n = 0; n < NET_MAX; n++) {\r\n-            enum Network net = (enum Network)n;\r\n-            assert(IsReachable(net));\r\n-            if (!nets.count(net))\r\n-                SetReachable(net, false);\r\n+            g_reachable_nets.Add(net);\r\n         }\r\n     }\r\n```\r\n\r\nBy default all networks are reachable (in `master` and in this PR), including the dummy `NET_UNROUTABLE` and `NET_INTERNAL`. If `-onlynet=X` is used (where `X` can be `ipv4`, `ipv6`, `tor`, `i2p`, `cjdns`) then just `X` is made reachable and others unreachable (`NET_UNROUTABLE` and `NET_INTERNAL` also become unreachable).\r\n\r\nAs for the `Add()` and `Remove()` methods - I wanted to preserve the behavior of the old `SetReachable()`:\r\n\r\n```diff\r\n-void SetReachable(enum Network net, bool reachable)\r\n-{\r\n-    if (net == NET_UNROUTABLE || net == NET_INTERNAL)\r\n-        return;\r\n```\r\n\r\nbut no caller is ever calling `SetReachable()` with `NET_UNROUTABLE` or `NET_INTERNAL`, so I have removed those checks from the new `Add()` and `Remove()` methods.\r\n\r\nThanks!",
      "commit_id" : "be7ae7b1ecb01b09ce7002036c02a68b910634b6",
      "created_at" : "2023-08-15T11:04:42Z",
      "diff_hunk" : "@@ -64,6 +65,63 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294456468",
      "id" : 1294456468,
      "in_reply_to_id" : 1249523602,
      "line" : 91,
      "node_id" : "PRRC_kwDOABII585NJ9aU",
      "original_commit_id" : "8b495486e2e94559f0e1099eef08182e540f82c0",
      "original_line" : 91,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 35,
      "pull_request_review_id" : 1578351968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294456468/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-15T11:04:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294456468",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294456676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294456676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done, thanks for the suggestion!",
      "commit_id" : "be7ae7b1ecb01b09ce7002036c02a68b910634b6",
      "created_at" : "2023-08-15T11:05:00Z",
      "diff_hunk" : "@@ -720,47 +720,47 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_Network)\n {\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, false);\n-    SetReachable(NET_IPV6, false);\n-    SetReachable(NET_ONION, false);\n-    SetReachable(NET_I2P, false);\n-    SetReachable(NET_CJDNS, false);\n-\n-    BOOST_CHECK(!IsReachable(NET_IPV4));\n-    BOOST_CHECK(!IsReachable(NET_IPV6));\n-    BOOST_CHECK(!IsReachable(NET_ONION));\n-    BOOST_CHECK(!IsReachable(NET_I2P));\n-    BOOST_CHECK(!IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, true);\n-    SetReachable(NET_IPV6, true);\n-    SetReachable(NET_ONION, true);\n-    SetReachable(NET_I2P, true);\n-    SetReachable(NET_CJDNS, true);\n-\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Remove(NET_IPV4);\n+    g_reachable_nets.Remove(NET_IPV6);\n+    g_reachable_nets.Remove(NET_ONION);\n+    g_reachable_nets.Remove(NET_I2P);\n+    g_reachable_nets.Remove(NET_CJDNS);\n+\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Add(NET_IPV4);\n+    g_reachable_nets.Add(NET_IPV6);\n+    g_reachable_nets.Add(NET_ONION);\n+    g_reachable_nets.Add(NET_I2P);\n+    g_reachable_nets.Add(NET_CJDNS);\n+\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n }\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_NetworkCaseUnroutableAndInternal)\n {\n-    BOOST_CHECK(IsReachable(NET_UNROUTABLE));\n-    BOOST_CHECK(IsReachable(NET_INTERNAL));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_UNROUTABLE));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_INTERNAL));\n \n-    SetReachable(NET_UNROUTABLE, false);\n-    SetReachable(NET_INTERNAL, false);\n+    g_reachable_nets.Remove(NET_UNROUTABLE);\n+    g_reachable_nets.Remove(NET_INTERNAL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294456676",
      "id" : 1294456676,
      "in_reply_to_id" : 1249529700,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NJ9dk",
      "original_commit_id" : "8b495486e2e94559f0e1099eef08182e540f82c0",
      "original_line" : 760,
      "original_position" : 74,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1578352284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294456676/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-15T11:05:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294456676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`8b495486e2...be7ae7b1ec`: rebase due to conflicts and address suggestions",
      "created_at" : "2023-08-15T11:56:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1678810238",
      "id" : 1678810238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585kEJx-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1678810238/reactions"
      },
      "updated_at" : "2023-08-15T11:56:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1678810238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294501734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294501734"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There is no built in construct in the language to do that and I do not like `NET_MAX` which I perceive as a hack.",
      "commit_id" : "be7ae7b1ecb01b09ce7002036c02a68b910634b6",
      "created_at" : "2023-08-15T11:58:50Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        return Contains(addr.GetNetwork());\n+    }\n+\n+private:\n+    mutable Mutex m_mutex;\n+\n+    std::unordered_set<Network> m_reachable GUARDED_BY(m_mutex){\n+        NET_UNROUTABLE,\n+        NET_IPV4,\n+        NET_IPV6,\n+        NET_ONION,\n+        NET_I2P,\n+        NET_CJDNS,\n+        NET_INTERNAL",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294501734",
      "id" : 1294501734,
      "in_reply_to_id" : 1106381226,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585NKIdm",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 117,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 61,
      "pull_request_review_id" : 1578420724,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294501734/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-15T11:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294501734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294503814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294503814"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since https://github.com/bitcoin/bitcoin/pull/27116 is stalled I have added `AssertLockNotHeld()`, e.g.:\r\n\r\n```cpp\r\n        AssertLockNotHeld(m_mutex);\r\n        LOCK(m_mutex);\r\n        m_reachable.insert(net);\r\n```",
      "commit_id" : "be7ae7b1ecb01b09ce7002036c02a68b910634b6",
      "created_at" : "2023-08-15T12:00:41Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294503814",
      "id" : 1294503814,
      "in_reply_to_id" : 1106375231,
      "line" : 102,
      "node_id" : "PRRC_kwDOABII585NKI-G",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 102,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 46,
      "pull_request_review_id" : 1578422698,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294503814/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-15T12:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294503814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande, what's your take on this now that it does not touch the GUI?",
      "created_at" : "2023-08-15T12:02:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1678816243",
      "id" : 1678816243,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585kELPz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1678816243/reactions"
      },
      "updated_at" : "2023-08-15T12:02:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1678816243",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could rebase for green CI, if still relevant?",
      "created_at" : "2023-08-17T09:26:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1681940885",
      "id" : 1681940885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585kQGGV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681940885/reactions"
      },
      "updated_at" : "2023-08-17T09:26:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681940885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`be7ae7b1ec...e92b7dee6d`: rebase for CI",
      "created_at" : "2023-08-17T09:44:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1681971680",
      "id" : 1681971680,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585kQNng",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681971680/reactions"
      },
      "updated_at" : "2023-08-17T09:44:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681971680",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1305800610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305800610"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not having this in `ReachableNets` means that `SetReachable` will no longer be ignored for these two networks, which is a small change in behavior (at least in theory, it seeems impossible that this function would be called with NET_UNROUTABLE or NET_INTERNAL outside of tests). That seems fine to me, but it could be mentioned in the commit message. \r\n[Edit]: Now I see this has been discussed [above](https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1294456468). Could still be mentioned in the commit message.",
      "commit_id" : "6ff2241e4757ed2f26244f266a44982a04029815",
      "created_at" : "2023-08-25T15:20:37Z",
      "diff_hunk" : "@@ -325,25 +324,6 @@ void RemoveLocal(const CService& addr)\n     mapLocalHost.erase(addr);\n }\n \n-void SetReachable(enum Network net, bool reachable)\n-{\n-    if (net == NET_UNROUTABLE || net == NET_INTERNAL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1305800610",
      "id" : 1305800610,
      "line" : 330,
      "node_id" : "PRRC_kwDOABII585N1O-i",
      "original_commit_id" : "f935a5fd971884d95e52d8c165a7afbdeb302905",
      "original_line" : 330,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 55,
      "pull_request_review_id" : 1595950768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305800610/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T17:58:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305800610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`e92b7dee6d...6ff2241e47`: extend a commit message, see https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1305800610",
      "created_at" : "2023-08-28T14:57:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1695851392",
      "id" : 1695851392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585lFKOA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1695851392/reactions"
      },
      "updated_at" : "2023-08-28T14:57:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1695851392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1307541688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307541688"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "6ff2241e4757ed2f26244f266a44982a04029815",
      "created_at" : "2023-08-28T14:58:18Z",
      "diff_hunk" : "@@ -325,25 +324,6 @@ void RemoveLocal(const CService& addr)\n     mapLocalHost.erase(addr);\n }\n \n-void SetReachable(enum Network net, bool reachable)\n-{\n-    if (net == NET_UNROUTABLE || net == NET_INTERNAL)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1307541688",
      "id" : 1307541688,
      "in_reply_to_id" : 1305800610,
      "line" : 330,
      "node_id" : "PRRC_kwDOABII585N74C4",
      "original_commit_id" : "f935a5fd971884d95e52d8c165a7afbdeb302905",
      "original_line" : 330,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 55,
      "pull_request_review_id" : 1598478596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307541688/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:58:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307541688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1324745126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324745126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Now we could add `NET_UNROUTABLE` and `NET_INTERNAL` back at the end (so that this unit test doesn't change global state).",
      "commit_id" : "2f3f79360594d6e23c00993c2aef9edcfc3f3786",
      "created_at" : "2023-09-13T16:00:51Z",
      "diff_hunk" : "@@ -720,47 +720,53 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_Network)\n {\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, false);\n-    SetReachable(NET_IPV6, false);\n-    SetReachable(NET_ONION, false);\n-    SetReachable(NET_I2P, false);\n-    SetReachable(NET_CJDNS, false);\n-\n-    BOOST_CHECK(!IsReachable(NET_IPV4));\n-    BOOST_CHECK(!IsReachable(NET_IPV6));\n-    BOOST_CHECK(!IsReachable(NET_ONION));\n-    BOOST_CHECK(!IsReachable(NET_I2P));\n-    BOOST_CHECK(!IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, true);\n-    SetReachable(NET_IPV6, true);\n-    SetReachable(NET_ONION, true);\n-    SetReachable(NET_I2P, true);\n-    SetReachable(NET_CJDNS, true);\n-\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Remove(NET_IPV4);\n+    g_reachable_nets.Remove(NET_IPV6);\n+    g_reachable_nets.Remove(NET_ONION);\n+    g_reachable_nets.Remove(NET_I2P);\n+    g_reachable_nets.Remove(NET_CJDNS);\n+\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Add(NET_IPV4);\n+    g_reachable_nets.Add(NET_IPV6);\n+    g_reachable_nets.Add(NET_ONION);\n+    g_reachable_nets.Add(NET_I2P);\n+    g_reachable_nets.Add(NET_CJDNS);\n+\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n }\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_NetworkCaseUnroutableAndInternal)\n {\n-    BOOST_CHECK(IsReachable(NET_UNROUTABLE));\n-    BOOST_CHECK(IsReachable(NET_INTERNAL));\n+    // Should be reachable by default.\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_UNROUTABLE));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_INTERNAL));\n \n-    SetReachable(NET_UNROUTABLE, false);\n-    SetReachable(NET_INTERNAL, false);\n+    g_reachable_nets.RemoveAll();\n \n-    BOOST_CHECK(IsReachable(NET_UNROUTABLE)); // Ignored for both networks\n-    BOOST_CHECK(IsReachable(NET_INTERNAL));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_UNROUTABLE));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_INTERNAL));\n+\n+    g_reachable_nets.Add(NET_IPV4);\n+    g_reachable_nets.Add(NET_IPV6);\n+    g_reachable_nets.Add(NET_ONION);\n+    g_reachable_nets.Add(NET_I2P);\n+    g_reachable_nets.Add(NET_CJDNS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1324745126",
      "id" : 1324745126,
      "line" : 767,
      "node_id" : "PRRC_kwDOABII585O9gGm",
      "original_commit_id" : "692aa7ed246b7175fc4579281f5c79460a96bdea",
      "original_line" : 767,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 87,
      "pull_request_review_id" : 1624923302,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324745126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T20:47:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324745126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-21T17:25:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1730004454",
      "id" : 1730004454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585nHcXm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1730004454/reactions"
      },
      "updated_at" : "2023-09-21T17:25:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1730004454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`6ff2241e47...2f3f793605`: rebase due to conflicts and address [suggestion](https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1324745126)",
      "created_at" : "2023-10-05T13:15:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1748878503",
      "id" : 1748878503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585oPcSn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1748878503/reactions"
      },
      "updated_at" : "2023-10-05T13:15:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1748878503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1347405388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347405388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done, thanks!",
      "commit_id" : "2f3f79360594d6e23c00993c2aef9edcfc3f3786",
      "created_at" : "2023-10-05T13:16:18Z",
      "diff_hunk" : "@@ -720,47 +720,53 @@ BOOST_AUTO_TEST_CASE(get_local_addr_for_peer_port)\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_Network)\n {\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, false);\n-    SetReachable(NET_IPV6, false);\n-    SetReachable(NET_ONION, false);\n-    SetReachable(NET_I2P, false);\n-    SetReachable(NET_CJDNS, false);\n-\n-    BOOST_CHECK(!IsReachable(NET_IPV4));\n-    BOOST_CHECK(!IsReachable(NET_IPV6));\n-    BOOST_CHECK(!IsReachable(NET_ONION));\n-    BOOST_CHECK(!IsReachable(NET_I2P));\n-    BOOST_CHECK(!IsReachable(NET_CJDNS));\n-\n-    SetReachable(NET_IPV4, true);\n-    SetReachable(NET_IPV6, true);\n-    SetReachable(NET_ONION, true);\n-    SetReachable(NET_I2P, true);\n-    SetReachable(NET_CJDNS, true);\n-\n-    BOOST_CHECK(IsReachable(NET_IPV4));\n-    BOOST_CHECK(IsReachable(NET_IPV6));\n-    BOOST_CHECK(IsReachable(NET_ONION));\n-    BOOST_CHECK(IsReachable(NET_I2P));\n-    BOOST_CHECK(IsReachable(NET_CJDNS));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Remove(NET_IPV4);\n+    g_reachable_nets.Remove(NET_IPV6);\n+    g_reachable_nets.Remove(NET_ONION);\n+    g_reachable_nets.Remove(NET_I2P);\n+    g_reachable_nets.Remove(NET_CJDNS);\n+\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_CJDNS));\n+\n+    g_reachable_nets.Add(NET_IPV4);\n+    g_reachable_nets.Add(NET_IPV6);\n+    g_reachable_nets.Add(NET_ONION);\n+    g_reachable_nets.Add(NET_I2P);\n+    g_reachable_nets.Add(NET_CJDNS);\n+\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV4));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_IPV6));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_ONION));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_I2P));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_CJDNS));\n }\n \n BOOST_AUTO_TEST_CASE(LimitedAndReachable_NetworkCaseUnroutableAndInternal)\n {\n-    BOOST_CHECK(IsReachable(NET_UNROUTABLE));\n-    BOOST_CHECK(IsReachable(NET_INTERNAL));\n+    // Should be reachable by default.\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_UNROUTABLE));\n+    BOOST_CHECK(g_reachable_nets.Contains(NET_INTERNAL));\n \n-    SetReachable(NET_UNROUTABLE, false);\n-    SetReachable(NET_INTERNAL, false);\n+    g_reachable_nets.RemoveAll();\n \n-    BOOST_CHECK(IsReachable(NET_UNROUTABLE)); // Ignored for both networks\n-    BOOST_CHECK(IsReachable(NET_INTERNAL));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_UNROUTABLE));\n+    BOOST_CHECK(!g_reachable_nets.Contains(NET_INTERNAL));\n+\n+    g_reachable_nets.Add(NET_IPV4);\n+    g_reachable_nets.Add(NET_IPV6);\n+    g_reachable_nets.Add(NET_ONION);\n+    g_reachable_nets.Add(NET_I2P);\n+    g_reachable_nets.Add(NET_CJDNS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1347405388",
      "id" : 1347405388,
      "in_reply_to_id" : 1324745126,
      "line" : 767,
      "node_id" : "PRRC_kwDOABII585QT8ZM",
      "original_commit_id" : "692aa7ed246b7175fc4579281f5c79460a96bdea",
      "original_line" : 767,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 87,
      "pull_request_review_id" : 1659839245,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347405388/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T13:16:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347405388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1358608701"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358608701"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I agree with you about `NET_MAX` but using it to populate `m_reachable` may still be preferable to having a silent dependency where we need to keep `ReachableNets::m_reachable` in `netbase.h` manually in sync with the `Network` enumerators in `netaddress.h`.  If you prefer the latter approach, perhaps comment next to `ReachableNets::m_reachable` that it needs to be kept in sync.",
      "commit_id" : "0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-13T17:44:39Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        return Contains(addr.GetNetwork());\n+    }\n+\n+private:\n+    mutable Mutex m_mutex;\n+\n+    std::unordered_set<Network> m_reachable GUARDED_BY(m_mutex){\n+        NET_UNROUTABLE,\n+        NET_IPV4,\n+        NET_IPV6,\n+        NET_ONION,\n+        NET_I2P,\n+        NET_CJDNS,\n+        NET_INTERNAL",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1358608701",
      "id" : 1358608701,
      "in_reply_to_id" : 1106381226,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585Q-rk9",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 117,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 61,
      "pull_request_review_id" : 1677025227,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358608701/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-13T17:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358608701",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1358640537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358640537"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "0994d45 unsure, would it be clearer to be explicit about this conversion?\r\n```suggestion\r\n            netAddr = static_cast<CNetAddr>(MaybeFlipIPv6toCJDNS(CService{addr.value(), /*port=*/0}));\r\n```",
      "commit_id" : "0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-13T18:03:18Z",
      "diff_hunk" : "@@ -730,7 +730,7 @@ static RPCHelpMan setban()\n     if (!isSubnet) {\n         const std::optional<CNetAddr> addr{LookupHost(request.params[0].get_str(), false)};\n         if (addr.has_value()) {\n-            netAddr = addr.value();\n+            netAddr = MaybeFlipIPv6toCJDNS(CService{addr.value(), /*port=*/0});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1358640537",
      "id" : 1358640537,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q-zWZ",
      "original_commit_id" : "2f3f79360594d6e23c00993c2aef9edcfc3f3786",
      "original_line" : 733,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1677068515,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358640537/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-13T18:06:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358640537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1358640837"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358640837"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "0994d45 unsure, would it be clearer to be explicit about this conversion?\r\n\r\n```suggestion\r\n        addr = static_cast<CNetAddr>(MaybeFlipIPv6toCJDNS(CService{addr.value(), /*port=*/0}));\r\n```",
      "commit_id" : "0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-13T18:03:40Z",
      "diff_hunk" : "@@ -651,9 +653,10 @@ bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out)\n \n     const size_t slash_pos{subnet_str.find_last_of('/')};\n     const std::string str_addr{subnet_str.substr(0, slash_pos)};\n-    const std::optional<CNetAddr> addr{LookupHost(str_addr, /*fAllowLookup=*/false)};\n+    std::optional<CNetAddr> addr{LookupHost(str_addr, /*fAllowLookup=*/false)};\n \n     if (addr.has_value()) {\n+        addr = MaybeFlipIPv6toCJDNS(CService{addr.value(), /*port=*/0});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1358640837",
      "id" : 1358640837,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Q-zbF",
      "original_commit_id" : "2f3f79360594d6e23c00993c2aef9edcfc3f3786",
      "original_line" : 659,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1677068515,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358640837/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-13T18:06:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1358640837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1360441554"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360441554"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What about something like the following as a followup, aiming to workaround the limitation in C++ in general:\r\n\r\n<details>\r\n<summary>C++ enum + a way to list all values + ToString() method, encapsulated</summary>\r\n\r\n```cpp\r\nnamespace Nets\r\n{\r\n    enum Net : uint8_t {\r\n        UNROUTABLE,\r\n        IPV4,\r\n        IPV6,\r\n        ONION,\r\n        I2P,\r\n        CJDNS,\r\n        INTERNAL\r\n    };\r\n\r\n    static constexpr std::array<Net, 7> all{UNROUTABLE, IPV4, IPV6, ONION, I2P, CJDNS, INTERNAL};\r\n\r\n    std::string ToString(Net net)\r\n    {\r\n        switch (net) {\r\n        case UNROUTABLE: return \"UNROUTABLE\";\r\n        case IPV4: return \"IPV4\";\r\n        case IPV6: return \"IPV6\";\r\n        case ONION: return \"ONION\";\r\n        case I2P: return \"I2P\";\r\n        case CJDNS: return \"CJDNS\";\r\n        case INTERNAL: return \"INTERNAL\";\r\n        }\r\n    }\r\n};\r\n\r\n...\r\n\r\nprintf(\"IPV6 = %d\\n\", Nets::IPV6);\r\n\r\nfor (const auto& net: Nets::all) {\r\n    std::cout << Nets::ToString(net) << std::endl;\r\n}\r\n```\r\n</details>",
      "commit_id" : "0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-16T10:16:37Z",
      "diff_hunk" : "@@ -64,6 +65,62 @@ struct ProxyCredentials\n     std::string password;\n };\n \n+/**\n+ * List of reachable networks. Everything is reachable by default.\n+ */\n+class ReachableNets {\n+public:\n+    void Add(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.insert(net);\n+        }\n+    }\n+\n+    void Remove(Network net) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        if (net != NET_UNROUTABLE && net != NET_INTERNAL) {\n+            LOCK(m_mutex);\n+            m_reachable.erase(net);\n+        }\n+    }\n+\n+    void RemoveAll() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        m_reachable.clear();\n+    }\n+\n+    bool Contains(Network net) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_reachable.count(net) > 0;\n+    }\n+\n+    bool Contains(const CNetAddr& addr) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        return Contains(addr.GetNetwork());\n+    }\n+\n+private:\n+    mutable Mutex m_mutex;\n+\n+    std::unordered_set<Network> m_reachable GUARDED_BY(m_mutex){\n+        NET_UNROUTABLE,\n+        NET_IPV4,\n+        NET_IPV6,\n+        NET_ONION,\n+        NET_I2P,\n+        NET_CJDNS,\n+        NET_INTERNAL",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1360441554",
      "id" : 1360441554,
      "in_reply_to_id" : 1106381226,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585RFrDS",
      "original_commit_id" : "7a93d7b0f922458ec904c35871afdcadf7447c63",
      "original_line" : 117,
      "original_position" : 62,
      "original_start_line" : null,
      "path" : "src/netbase.h",
      "position" : 61,
      "pull_request_review_id" : 1679622332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360441554/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-16T10:16:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360441554",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`2f3f793605...0e6f6ebc06`: address suggestions, thanks!\r\n\r\n> In https://github.com/bitcoin/bitcoin/commit/0994d4573b53b2763cba83d057b38f221486a983 the commit message might be out of date...\r\n\r\nUpdated!",
      "created_at" : "2023-10-16T11:01:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1764227938",
      "id" : 1764227938,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585pJ_ti",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764227938/reactions"
      },
      "updated_at" : "2023-10-16T11:02:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764227938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1360488037"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360488037"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-16T11:01:32Z",
      "diff_hunk" : "@@ -730,7 +730,7 @@ static RPCHelpMan setban()\n     if (!isSubnet) {\n         const std::optional<CNetAddr> addr{LookupHost(request.params[0].get_str(), false)};\n         if (addr.has_value()) {\n-            netAddr = addr.value();\n+            netAddr = MaybeFlipIPv6toCJDNS(CService{addr.value(), /*port=*/0});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1360488037",
      "id" : 1360488037,
      "in_reply_to_id" : 1358640537,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RF2Zl",
      "original_commit_id" : "2f3f79360594d6e23c00993c2aef9edcfc3f3786",
      "original_line" : 733,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1679697532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360488037/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-16T11:01:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360488037",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1360488155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360488155"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-16T11:01:39Z",
      "diff_hunk" : "@@ -651,9 +653,10 @@ bool LookupSubNet(const std::string& subnet_str, CSubNet& subnet_out)\n \n     const size_t slash_pos{subnet_str.find_last_of('/')};\n     const std::string str_addr{subnet_str.substr(0, slash_pos)};\n-    const std::optional<CNetAddr> addr{LookupHost(str_addr, /*fAllowLookup=*/false)};\n+    std::optional<CNetAddr> addr{LookupHost(str_addr, /*fAllowLookup=*/false)};\n \n     if (addr.has_value()) {\n+        addr = MaybeFlipIPv6toCJDNS(CService{addr.value(), /*port=*/0});",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#discussion_r1360488155",
      "id" : 1360488155,
      "in_reply_to_id" : 1358640837,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RF2bb",
      "original_commit_id" : "2f3f79360594d6e23c00993c2aef9edcfc3f3786",
      "original_line" : 659,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/netbase.cpp",
      "position" : null,
      "pull_request_review_id" : 1679697732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27071",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360488155/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-16T11:01:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360488155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Code review ACK 0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-16T18:50:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1765091098",
      "id" : 1765091098,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585pNSca",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1765091098/reactions"
      },
      "updated_at" : "2023-10-16T18:50:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1765091098",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 0e6f6ebc064c5fb425fc3699efe760ec6cd4b6af",
      "created_at" : "2023-10-19T16:46:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27071#issuecomment-1771363317",
      "id" : 1771363317,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27071",
      "node_id" : "IC_kwDOABII585plNv1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771363317/reactions"
      },
      "updated_at" : "2023-10-19T16:46:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1771363317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
