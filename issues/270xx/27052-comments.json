[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27052).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [satsie](https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1420228791), [kristapsk](https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1680531024) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29221](https://github.com/bitcoin/bitcoin/pull/29221) (Implement 64 bit arithmetic op codes in the Script interpreter by Christewart)\n* [#28170](https://github.com/bitcoin/bitcoin/pull/28170) (p2p: adaptive connections services flags by furszy)\n* [#28031](https://github.com/bitcoin/bitcoin/pull/28031) (Package Relay 1/3: Introduce TxDownloadManager and improve orphan-handling by glozow)\n* [#15218](https://github.com/bitcoin/bitcoin/pull/15218) (validation: Flush state after initial sync by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-02-06T18:32:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1419562580",
      "id" : 1419562580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585UnM5U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419562580/reactions"
      },
      "updated_at" : "2024-01-24T04:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419562580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed to fix CI failure",
      "created_at" : "2023-02-06T21:52:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1419823612",
      "id" : 1419823612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585UoMn8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419823612/reactions"
      },
      "updated_at" : "2023-02-06T21:52:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419823612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. I spent quite a bit of time trying to test #26172 (my findings are documented [here](https://github.com/satsie/bitcoin-notez/blob/master/bitcoin-core-development/testing-pr-26172.md)) and can confirm the difficulty of testing it with the current state of the test framework. \r\n\r\nI also support the suggestion to add `last_block_announcement` to `getpeerinfo` not only because it seems to be the easiest way to test 26172, but I agree it can be useful information to have when trying to learn more about one's peers, especially when this timestamp is already available internally.\r\n\r\n",
      "created_at" : "2023-02-07T05:39:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1420228791",
      "id" : 1420228791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585Upvi3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420228791/reactions"
      },
      "updated_at" : "2023-02-07T05:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420228791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1823216?v=4",
         "events_url" : "https://api.github.com/users/satsie/events{/privacy}",
         "followers_url" : "https://api.github.com/users/satsie/followers",
         "following_url" : "https://api.github.com/users/satsie/following{/other_user}",
         "gists_url" : "https://api.github.com/users/satsie/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/satsie",
         "id" : 1823216,
         "login" : "satsie",
         "node_id" : "MDQ6VXNlcjE4MjMyMTY=",
         "organizations_url" : "https://api.github.com/users/satsie/orgs",
         "received_events_url" : "https://api.github.com/users/satsie/received_events",
         "repos_url" : "https://api.github.com/users/satsie/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/satsie/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/satsie/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/satsie"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1098396846"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098396846"
         }
      },
      "author_association" : "MEMBER",
      "body" : "If you change the type, why not use NodeSeconds (a time point)? While `std::chrono::seconds` (a duration) is used widely in the codebase, because all durations that denote a time point are since epoch, using a dedicated type such as `NodeSeconds` might be clearer.",
      "commit_id" : "becf38061b2625bcc629293fec0dce7c27292e14",
      "created_at" : "2023-02-07T09:26:04Z",
      "diff_hunk" : "@@ -505,6 +505,10 @@ class CNode\n      * peer eviction criterium in CConnman::AttemptToEvictConnection. */\n     std::atomic<std::chrono::seconds> m_last_block_time{0s};\n \n+    /** UNIX epoch time of the last block announcement from this peer that we had\n+     * not yet seen from any peer. Used for potential stale-tip eviction. */\n+    std::atomic<std::chrono::seconds> m_last_block_announcement{0s};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1098396846",
      "id" : 1098396846,
      "line" : 511,
      "node_id" : "PRRC_kwDOABII585BeDSu",
      "original_commit_id" : "cccb498e2ab86e022cdf4f6e2c071bbfb70f39b9",
      "original_line" : 510,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 1286713578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098396846/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-07T09:26:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098396846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1098506513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098506513"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think this belongs in `CNode`. It is used in our outbound eviction logic which is part of net processing and it isn't used in net at all (imo, the eviction logic should be encapsulated in its own module entirely #25268 ð).\r\n\r\nAlso afaict, there is no need to move `m_last_block_announcement`, because you can just return it in `PeerManager::GetNodeStateStats`.",
      "commit_id" : "becf38061b2625bcc629293fec0dce7c27292e14",
      "created_at" : "2023-02-07T11:00:03Z",
      "diff_hunk" : "@@ -505,6 +506,10 @@ class CNode\n      * peer eviction criterium in CConnman::AttemptToEvictConnection. */\n     std::atomic<std::chrono::seconds> m_last_block_time{0s};\n \n+    /** UNIX epoch time of the last block announcement from this peer that we had\n+     * not yet seen from any peer. Used for potential stale-tip eviction. */\n+    std::atomic<std::chrono::seconds> m_last_block_announcement{0s};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1098506513",
      "id" : 1098506513,
      "line" : 511,
      "node_id" : "PRRC_kwDOABII585BeeER",
      "original_commit_id" : "becf38061b2625bcc629293fec0dce7c27292e14",
      "original_line" : 511,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 14,
      "pull_request_review_id" : 1286873988,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098506513/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-07T11:00:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1098506513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed from becf38061b2625bcc629293fec0dce7c27292e14 to\r\n- efc2e70f1763c6bf3f6b246202adb9d5f1f798ee [diff](https://github.com/bitcoin/bitcoin/compare/becf38061b2625bcc629293fec0dce7c27292e14..efc2e70f1763c6bf3f6b246202adb9d5f1f798ee) -- needed rebase\r\n- 16d2903b8a9e6e980e24e04ab2d86c7e778f5764 [diff](https://github.com/bitcoin/bitcoin/compare/efc2e70f1763c6bf3f6b246202adb9d5f1f798ee..16d2903b8a9e6e980e24e04ab2d86c7e778f5764) -- make the suggested review changes\r\n- 2e80e3bdcd9cac7878c0d14956ba9c57626da855 [diff](https://github.com/bitcoin/bitcoin/compare/16d2903b8a9e6e980e24e04ab2d86c7e778f5764..2e80e3bdcd9cac7878c0d14956ba9c57626da855) -- fix CI failure\r\n- 6c564aafb3d5f61fffa0d6311ad688c47b14014a [diff](https://github.com/bitcoin/bitcoin/compare/2e80e3bdcd9cac7878c0d14956ba9c57626da855..6c564aafb3d5f61fffa0d6311ad688c47b14014a) -- add release notes, and small improvement to functional test\r\n\r\nI'll take this out of draft now since I think it's ready for review. ",
      "created_at" : "2023-08-15T06:55:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1678501363",
      "id" : 1678501363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585kC-Xz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1678501363/reactions"
      },
      "updated_at" : "2023-08-15T06:55:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1678501363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1295821775"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1295821775"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is fragile, because when the type of `oldest_block_announcement` changes, the log output will change, too, without a compile error. It would be better to use `Ticks` or `TicksSinceEpoch`.",
      "commit_id" : "1e11164d48de2e9e0ff844d4d92c2c6c9c28a05c",
      "created_at" : "2023-08-16T12:29:05Z",
      "diff_hunk" : "@@ -5177,7 +5178,8 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n                 // block from.\n                 CNodeState &state = *State(pnode->GetId());\n                 if (now - pnode->m_connected > MINIMUM_CONNECT_TIME && state.vBlocksInFlight.empty()) {\n-                    LogPrint(BCLog::NET, \"disconnecting extra outbound peer=%d (last block announcement received at time %d)\\n\", pnode->GetId(), oldest_block_announcement);\n+                    LogPrint(BCLog::NET, \"disconnecting extra outbound peer=%d (last block announcement received at time %d)\\n\",\n+                             pnode->GetId(), (*oldest_block_announcement).time_since_epoch().count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1295821775",
      "id" : 1295821775,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NPKvP",
      "original_commit_id" : "6c564aafb3d5f61fffa0d6311ad688c47b14014a",
      "original_line" : 5182,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1580483670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1295821775/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-16T12:29:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1295821775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1295822613"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1295822613"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It is possible to write a clang-tidy check for this, but I am not sure if people want this. cc @theuni \r\n\r\n\r\n```diff\r\ndiff --git a/contrib/devtools/bitcoin-tidy/CMakeLists.txt b/contrib/devtools/bitcoin-tidy/CMakeLists.txt\r\nindex 35e60d1d87..b523692b12 100644\r\n--- a/contrib/devtools/bitcoin-tidy/CMakeLists.txt\r\n+++ b/contrib/devtools/bitcoin-tidy/CMakeLists.txt\r\n@@ -14,7 +14,10 @@ find_program(CLANG_TIDY_EXE NAMES \"clang-tidy-${LLVM_VERSION_MAJOR}\" \"clang-tidy\r\n message(STATUS \"Found LLVM ${LLVM_PACKAGE_VERSION}\")\r\n message(STATUS \"Found clang-tidy: ${CLANG_TIDY_EXE}\")\r\n \r\n-add_library(bitcoin-tidy MODULE bitcoin-tidy.cpp logprintf.cpp)\r\n+add_library(bitcoin-tidy MODULE bitcoin-tidy.cpp\r\n+  chrono.cpp\r\n+  logprintf.cpp\r\n+)\r\n target_include_directories(bitcoin-tidy SYSTEM PRIVATE ${LLVM_INCLUDE_DIRS})\r\n \r\n # Disable RTTI and exceptions as necessary\r\n@@ -47,7 +50,10 @@ else()\r\n endif()\r\n \r\n # Create a dummy library that runs clang-tidy tests as a side-effect of building\r\n-add_library(bitcoin-tidy-tests OBJECT EXCLUDE_FROM_ALL example_logprintf.cpp)\r\n+add_library(bitcoin-tidy-tests OBJECT EXCLUDE_FROM_ALL\r\n+  example_chrono.cpp\r\n+  example_logprintf.cpp\r\n+)\r\n add_dependencies(bitcoin-tidy-tests bitcoin-tidy)\r\n \r\n set_target_properties(bitcoin-tidy-tests PROPERTIES CXX_CLANG_TIDY \"${CLANG_TIDY_COMMAND}\")\r\ndiff --git a/contrib/devtools/bitcoin-tidy/bitcoin-tidy.cpp b/contrib/devtools/bitcoin-tidy/bitcoin-tidy.cpp\r\nindex 0f34d37793..bc7c05ca45 100644\r\n--- a/contrib/devtools/bitcoin-tidy/bitcoin-tidy.cpp\r\n+++ b/contrib/devtools/bitcoin-tidy/bitcoin-tidy.cpp\r\n@@ -2,6 +2,7 @@\r\n // Distributed under the MIT software license, see the accompanying\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n \r\n+#include \"chrono.h\"\r\n #include \"logprintf.h\"\r\n \r\n #include <clang-tidy/ClangTidyModule.h>\r\n@@ -12,6 +13,7 @@ class BitcoinModule final : public clang::tidy::ClangTidyModule\r\n public:\r\n     void addCheckFactories(clang::tidy::ClangTidyCheckFactories& CheckFactories) override\r\n     {\r\n+        CheckFactories.registerCheck<bitcoin::ChronoCheck>(\"bitcoin-chrono-count\");\r\n         CheckFactories.registerCheck<bitcoin::LogPrintfCheck>(\"bitcoin-unterminated-logprintf\");\r\n     }\r\n };\r\ndiff --git a/contrib/devtools/bitcoin-tidy/chrono.cpp b/contrib/devtools/bitcoin-tidy/chrono.cpp\r\nnew file mode 100644\r\nindex 0000000000..163cf0b9e8\r\n--- /dev/null\r\n+++ b/contrib/devtools/bitcoin-tidy/chrono.cpp\r\n@@ -0,0 +1,37 @@\r\n+// Copyright (c) The Bitcoin Core developers\r\n+// Distributed under the MIT software license, see the accompanying\r\n+// file COPYING or https://opensource.org/license/mit/.\r\n+\r\n+#include \"chrono.h\"\r\n+\r\n+#include <clang/AST/ASTContext.h>\r\n+#include <clang/ASTMatchers/ASTMatchFinder.h>\r\n+\r\n+namespace bitcoin {\r\n+\r\n+void ChronoCheck::registerMatchers(clang::ast_matchers::MatchFinder* finder)\r\n+{\r\n+    using namespace clang::ast_matchers;\r\n+    \r\n+    finder->addMatcher(\r\n+        cxxMemberCallExpr(\r\n+            callee(cxxMethodDecl(hasName(\"count\"))),\r\n+            thisPointerType(qualType(hasDeclaration(cxxRecordDecl(\r\n+      hasName(\"std::chrono::duration\")\r\n+            )))),\r\n+            \r\n+            expr().bind(\"count_call\")),\r\n+        this);\r\n+}\r\n+\r\n+void ChronoCheck::check(const clang::ast_matchers::MatchFinder::MatchResult& Result)\r\n+{\r\n+    if (const auto* call = Result.Nodes.getNodeAs<clang::Expr>(\"count_call\")) {\r\n+        const clang::ASTContext& ctx = *Result.Context;\r\n+        const auto user_diag = diag(call->getEndLoc(), \"Fragile call to std::chrono::duration::count(), Use Ticks or TicksSinceEpoch\");\r\n+        //const auto& loc = call->getLocationOfByte(call->getByteLength(), *Result.SourceManager, ctx.getLangOpts(), ctx.getTargetInfo());\r\n+        user_diag ;//<< clang::FixItHint::CreateInsertion(loc, \"\\\\n\");\r\n+    }\r\n+}\r\n+\r\n+} // namespace bitcoin\r\ndiff --git a/contrib/devtools/bitcoin-tidy/chrono.h b/contrib/devtools/bitcoin-tidy/chrono.h\r\nnew file mode 100644\r\nindex 0000000000..c455d786ed\r\n--- /dev/null\r\n+++ b/contrib/devtools/bitcoin-tidy/chrono.h\r\n@@ -0,0 +1,28 @@\r\n+// Copyright (c) The Bitcoin Core developers\r\n+// Distributed under the MIT software license, see the accompanying\r\n+// file COPYING or https://opensource.org/license/mit/.\r\n+\r\n+#ifndef CHRONO_CHECK_H\r\n+#define CHRONO_CHECK_H\r\n+\r\n+#include <clang-tidy/ClangTidyCheck.h>\r\n+\r\n+namespace bitcoin {\r\n+\r\n+class ChronoCheck final : public clang::tidy::ClangTidyCheck\r\n+{\r\n+public:\r\n+    ChronoCheck(clang::StringRef Name, clang::tidy::ClangTidyContext* Context)\r\n+        : clang::tidy::ClangTidyCheck(Name, Context) {}\r\n+\r\n+    bool isLanguageVersionSupported(const clang::LangOptions& LangOpts) const override\r\n+    {\r\n+        return LangOpts.CPlusPlus;\r\n+    }\r\n+    void registerMatchers(clang::ast_matchers::MatchFinder* Finder) override;\r\n+    void check(const clang::ast_matchers::MatchFinder::MatchResult& Result) override;\r\n+};\r\n+\r\n+} // namespace bitcoin\r\n+\r\n+#endif // CHRONO_CHECK_H\r\ndiff --git a/contrib/devtools/bitcoin-tidy/example_chrono.cpp b/contrib/devtools/bitcoin-tidy/example_chrono.cpp\r\nnew file mode 100644\r\nindex 0000000000..1bf2f0a353\r\n--- /dev/null\r\n+++ b/contrib/devtools/bitcoin-tidy/example_chrono.cpp\r\n@@ -0,0 +1,18 @@\r\n+// Copyright (c) The Bitcoin Core developers\r\n+// Distributed under the MIT software license, see the accompanying\r\n+// file COPYING or https://opensource.org/license/mit/.\r\n+\r\n+#include <chrono>\r\n+\r\n+void good_func()\r\n+{\r\n+std::chrono::seconds a{1};\r\n+++a;\r\n+a.zero();\r\n+}\r\n+void bad_func()\r\n+{\r\n+std::chrono::seconds{1}.count();\r\n+std::chrono::seconds a{1};\r\n+a.count();\r\n+}\r\ndiff --git a/src/.clang-tidy b/src/.clang-tidy\r\nindex b4d50135dd..4deb5a85a5 100644\r\n--- a/src/.clang-tidy\r\n+++ b/src/.clang-tidy\r\n@@ -1,6 +1,6 @@\r\n Checks: '\r\n -*,\r\n-bitcoin-unterminated-logprintf,\r\n+bitcoin-*,\r\n bugprone-argument-comment,\r\n bugprone-use-after-move,\r\n misc-unused-using-decls,\r\n",
      "commit_id" : "1e11164d48de2e9e0ff844d4d92c2c6c9c28a05c",
      "created_at" : "2023-08-16T12:29:50Z",
      "diff_hunk" : "@@ -5177,7 +5178,8 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n                 // block from.\n                 CNodeState &state = *State(pnode->GetId());\n                 if (now - pnode->m_connected > MINIMUM_CONNECT_TIME && state.vBlocksInFlight.empty()) {\n-                    LogPrint(BCLog::NET, \"disconnecting extra outbound peer=%d (last block announcement received at time %d)\\n\", pnode->GetId(), oldest_block_announcement);\n+                    LogPrint(BCLog::NET, \"disconnecting extra outbound peer=%d (last block announcement received at time %d)\\n\",\n+                             pnode->GetId(), (*oldest_block_announcement).time_since_epoch().count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1295822613",
      "id" : 1295822613,
      "in_reply_to_id" : 1295821775,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NPK8V",
      "original_commit_id" : "6c564aafb3d5f61fffa0d6311ad688c47b14014a",
      "original_line" : 5182,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1580484980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1295822613/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-16T12:29:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1295822613",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-08-16T12:40:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1680531024",
      "id" : 1680531024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585kKt5Q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1680531024/reactions"
      },
      "updated_at" : "2023-08-16T12:40:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1680531024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force-pushed to implement review suggestion to use `TicksSinceEpoch()` (thanks!)",
      "created_at" : "2023-08-16T21:11:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1681276711",
      "id" : 1681276711,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585kNj8n",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681276711/reactions"
      },
      "updated_at" : "2023-08-16T21:11:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1681276711",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-03T10:31:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1744688550",
      "id" : 1744688550,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585n_dWm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744688550/reactions"
      },
      "updated_at" : "2023-10-03T10:31:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744688550",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed for needed rebase, then again for CI failure. @dergoegge can you take another look?",
      "created_at" : "2023-10-09T20:30:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1753744340",
      "id" : 1753744340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585oiAPU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1753744340/reactions"
      },
      "updated_at" : "2023-10-09T20:30:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1753744340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1352377372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1352377372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This looks wrong to me, i think it should be:\r\n\r\n```suggestion\r\n            if (state->m_last_block_announcement < oldest_block_announcement.value_or(NodeSeconds::max()) || (state->m_last_block_announcement == *oldest_block_announcement && pnode->GetId() > worst_peer)) {\r\n```",
      "commit_id" : "1e11164d48de2e9e0ff844d4d92c2c6c9c28a05c",
      "created_at" : "2023-10-10T12:34:25Z",
      "diff_hunk" : "@@ -5217,7 +5218,7 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             // If this is the only connection on a particular network that is\n             // OUTBOUND_FULL_RELAY or MANUAL, protect it.\n             if (!m_connman.MultipleManualOrFullOutboundConns(pnode->addr.GetNetwork())) return;\n-            if (state->m_last_block_announcement < oldest_block_announcement || (state->m_last_block_announcement == oldest_block_announcement && pnode->GetId() > worst_peer)) {\n+            if (!oldest_block_announcement.has_value() || (state->m_last_block_announcement == *oldest_block_announcement && pnode->GetId() > worst_peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1352377372",
      "id" : 1352377372,
      "line" : 5221,
      "node_id" : "PRRC_kwDOABII585Qm6Qc",
      "original_commit_id" : "1e11164d48de2e9e0ff844d4d92c2c6c9c28a05c",
      "original_line" : 5221,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 67,
      "pull_request_review_id" : 1667515643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1352377372/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T12:41:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1352377372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1353244492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353244492"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, good catch! I force-pushed to fix this in a slightly different way that seems more clear to me.",
      "commit_id" : "cbe4f67e3292bf45ea01aa94ecf798f12b6e16bc",
      "created_at" : "2023-10-10T19:42:39Z",
      "diff_hunk" : "@@ -5217,7 +5218,7 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             // If this is the only connection on a particular network that is\n             // OUTBOUND_FULL_RELAY or MANUAL, protect it.\n             if (!m_connman.MultipleManualOrFullOutboundConns(pnode->addr.GetNetwork())) return;\n-            if (state->m_last_block_announcement < oldest_block_announcement || (state->m_last_block_announcement == oldest_block_announcement && pnode->GetId() > worst_peer)) {\n+            if (!oldest_block_announcement.has_value() || (state->m_last_block_announcement == *oldest_block_announcement && pnode->GetId() > worst_peer)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#discussion_r1353244492",
      "id" : 1353244492,
      "in_reply_to_id" : 1352377372,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QqN9M",
      "original_commit_id" : "1e11164d48de2e9e0ff844d4d92c2c6c9c28a05c",
      "original_line" : 5221,
      "original_position" : 67,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1668757602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27052",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353244492/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-10T19:42:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353244492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-31T18:14:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27052#issuecomment-1919653796",
      "id" : 1919653796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27052",
      "node_id" : "IC_kwDOABII585ya5ek",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1919653796/reactions"
      },
      "updated_at" : "2024-01-31T18:14:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1919653796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
