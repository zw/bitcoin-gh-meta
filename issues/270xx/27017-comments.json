[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The output of `help signrawtransactionwithkey` states:\r\n\r\n```bash\r\n3. prevtxs                          (json array, optional) The previous dependent transaction outputs\r\n     [\r\n       {                            (json object)\r\n         \"txid\": \"hex\",             (string, required) The transaction id\r\n         \"vout\": n,                 (numeric, required) The output number\r\n         \"scriptPubKey\": \"hex\",     (string, required) script key\r\n         \"redeemScript\": \"hex\",     (string) (required for P2SH) redeem script\r\n         \"witnessScript\": \"hex\",    (string) (required for P2WSH or P2SH-P2WSH) witness script\r\n         \"amount\": amount,          (numeric or string) (required for Segwit inputs) the amount spent\r\n       },\r\n       ...\r\n     ]\r\n```\r\n\r\nYou pass as the `prevtxs` argument:\r\n\r\n```bash\r\n[\r\n  {\r\n    \"txid\": \"3152ecd0e7acc80b6f47a32276cb6137a2de7cee428c9388e6a4a1817b665711\",\r\n    \"vout\": 0,\r\n    \"scriptPubKey\": \"5120c38859777bc9c3294d3587035fc3823a146dabaab1fa250bc04e92f16887a065\",\r\n    \"amount\": 0.00004242\r\n  }\r\n]\r\n\r\n```\r\n\r\nAnd the error message states that:\r\n\r\n```bash\r\n\"error\": \"Witness program was passed an empty witness\"\r\n```\r\n\r\nAssuming that [`txid: 3152ecd0e7acc80b6f47a32276cb6137a2de7cee428c9388e6a4a1817b665711`](https://blockstream.info/testnet/tx/3152ecd0e7acc80b6f47a32276cb6137a2de7cee428c9388e6a4a1817b665711?expand=) is a V1 P2TR output, then it will need a valid `witnessScript` element to be supplied to avoid hitting the returned script [error.](https://github.com/bitcoin/bitcoin/blob/b3f866a8dfd652b6339b79124843e58bd0bf3013/src/script/interpreter.cpp#L1901).\r\n\r\nIf using the key path to spend theoutput can be spent with the secret key corresponding to the `internal_pubkey` using a witness stack consisting of a single element: a [BIP340](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) signature on the signature hash.\r\n\r\nWhat error message would you consider to be more appropriate here?\r\n\r\n<details>\r\n<summary>I could not replicate your success behaviour after importing the descriptor:</summary>\r\n\r\n\r\n\r\n```fish\r\nwill@ubuntu in â¦/src/bitcoin/src on î  master [$?â] via C v12.2.0-gcc\r\nâ¿ bitcoin-cli -regtest importdescriptors '[{\"desc\": \"tr(cUTFbLPUaBAPmTKwjcDs4rWHUSEUbUBfkPMogrbTmQFnJA3vgrLE)#tdkpah70\", \"timestamp\": \"now\"}]'\r\n[\r\n  {\r\n    \"success\": true\r\n  }\r\n]\r\n\r\nwill@ubuntu in â¦/src/bitcoin/src on î  master [$?â] via C v12.2.0-gcc\r\nâ¿ bitcoin-cli -regtest signrawtransactionwithkey \"02000000011157667b81a1a4e688938c42ee7cdea23761cb7622a3476f0bc8ace7d0ec523100000000000000000001e8030000000000002251203b82b2b2a9185315da6f80da5f06d0440d8a5e1457fa93387c2d919c86ec878600000000\" '[\"cUTFbLPUaBAPmTKwjcDs4rWHUSEUbUBfkPMogrbTmQFnJA3vgrLE\"]' '[{\"txid\": \"3152ecd0e7acc80b6f47a32276cb6137a2de7cee428c9388e6a4a1817b665711\", \"vout\": 0, \"scriptPubKey\": \"5120c38859777bc9c3294d3587035fc3823a146dabaab1fa250bc04e92f16887a065\", \"amount\": 0.00004242}]' \"DEFAULT\"\r\n{\r\n  \"hex\": \"02000000011157667b81a1a4e688938c42ee7cdea23761cb7622a3476f0bc8ace7d0ec523100000000000000000001e8030000000000002251203b82b2b2a9185315da6f80da5f06d0440d8a5e1457fa93387c2d919c86ec878600000000\",\r\n  \"complete\": false,\r\n  \"errors\": [\r\n    {\r\n      \"txid\": \"3152ecd0e7acc80b6f47a32276cb6137a2de7cee428c9388e6a4a1817b665711\",\r\n      \"vout\": 0,\r\n      \"witness\": [\r\n      ],\r\n      \"scriptSig\": \"\",\r\n      \"sequence\": 0,\r\n      \"error\": \"Witness program was passed an empty witness\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n</details>",
      "created_at" : "2023-02-20T13:16:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27017#issuecomment-1437012050",
      "id" : 1437012050,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27017",
      "node_id" : "IC_kwDOABII585VpxBS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1437012050/reactions"
      },
      "updated_at" : "2023-02-20T13:16:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1437012050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I could not replicate your success behaviour after importing the descriptor:\r\n\r\nThe success behaviour is different from the not-replicated one:\r\n\r\n> Hint: **signrawtransactionwithwallet** works fine if preceded with the importdescriptors '[{\"desc\": \"tr(cUTFbLPUaBAPmTKwjcDs4rWHUSEUbUBfkPMogrbTmQFnJA3vgrLE)#tdkpah70\", \"timestamp\": \"now\"}]'",
      "created_at" : "2023-02-21T08:54:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/27017#issuecomment-1438085755",
      "id" : 1438085755,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27017",
      "node_id" : "IC_kwDOABII585Vt3J7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1438085755/reactions"
      },
      "updated_at" : "2023-02-21T08:54:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1438085755",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/111286121?v=4",
         "events_url" : "https://api.github.com/users/GregTonoski/events{/privacy}",
         "followers_url" : "https://api.github.com/users/GregTonoski/followers",
         "following_url" : "https://api.github.com/users/GregTonoski/following{/other_user}",
         "gists_url" : "https://api.github.com/users/GregTonoski/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/GregTonoski",
         "id" : 111286121,
         "login" : "GregTonoski",
         "node_id" : "U_kgDOBqIXaQ",
         "organizations_url" : "https://api.github.com/users/GregTonoski/orgs",
         "received_events_url" : "https://api.github.com/users/GregTonoski/received_events",
         "repos_url" : "https://api.github.com/users/GregTonoski/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/GregTonoski/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/GregTonoski/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/GregTonoski"
      }
   }
]
