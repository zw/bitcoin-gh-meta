[
   {
      "body" : "This is the test-before-evict feature originally proposed in #6355.",
      "created_at" : "2016-10-28T21:54:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257038295",
      "id" : 257038295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-10-28T21:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257038295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "One issue which needs to be address in my code above is that I read from mapInfo via [ ]. This violates the very sensible coding style guide requirement that [ ] is never used for map reads. I could use an assert as is used in other code in addrman:\r\n\r\n```cpp\r\nassert(mapInfo.count(nId) == 1);\r\n```\r\n\r\nInstead I'd prefer to create a private method for accessing mapInfo elements by nId similar to CAddrMan::Find. As this is a refactor task which touches code outside of test-before-evict, I want to break it out into a separate commit to be included in this pull request.",
      "created_at" : "2016-10-28T22:04:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257040021",
      "id" : 257040021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-10-28T22:04:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257040021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620289"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Lock is held, could use Good_\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2016-10-28T22:27:57Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289",
      "id" : 85620289,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 70,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620319"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Lock held as above\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2016-10-28T22:28:22Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319",
      "id" : 85620319,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 74,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620319",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: is this cast necessary?\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2016-10-28T22:29:00Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371",
      "id" : 85620371,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 43,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620371",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85624346"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: I think std::advance would be clearer than a loop for picking one element\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2016-10-28T23:15:27Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);\n+            eraseCollision = true;\n+        }\n+\n+        if (eraseCollision){\n+            setTriedCollisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    int nRnd = GetRandInt(setTriedCollisions.size());\n+\n+    int i = 0;\n+    // Selects a random element from setTriedCollisions.\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end(); it++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346",
      "id" : 85624346,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 92,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85624346",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1047859?v=4",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651668"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good call!\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2016-10-30T02:00:06Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668",
      "id" : 85651668,
      "in_reply_to_id" : 85620319,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 74,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6357044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651668",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651671"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nope, removed it.\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2016-10-30T02:00:34Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671",
      "id" : 85651671,
      "in_reply_to_id" : 85620371,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 43,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6357047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651671",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "I added some extra checks to ensure that if setTriedCollisions points to a key which doesn't exist in mapInfo it just removes that bad key.",
      "created_at" : "2016-11-01T19:38:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257671470",
      "id" : 257671470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-11-01T19:38:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257671470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Is this good to merge? Any changes I should make?",
      "created_at" : "2016-11-21T23:36:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-262102202",
      "id" : 262102202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-11-21T23:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262102202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Fixed a merge conflict.",
      "created_at" : "2016-12-09T00:38:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-265899420",
      "id" : 265899420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-12-09T00:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265899420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sipa Any suggestions or improvements I can make to this?",
      "created_at" : "2016-12-18T20:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-267845720",
      "id" : 267845720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-12-18T20:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267845720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "utACK\r\n\r\n@EthanHeilman Sorry for the delay here. I think we should try to get this in for 0.15. Would you mind rebasing again?",
      "created_at" : "2017-04-09T15:45:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-292793699",
      "id" : 292793699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-09T15:45:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292793699",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Will rebase today or tomorrow.",
      "created_at" : "2017-04-10T17:05:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293014073",
      "id" : 293014073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-10T17:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293014073",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sipa rebased, also updated some of the log statement to follow the new format.",
      "created_at" : "2017-04-13T13:43:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293899032",
      "id" : 293899032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-13T13:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293899032",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Updated to obey new Bitcoin coding style guide",
      "created_at" : "2017-07-27T08:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-318296882",
      "id" : 318296882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-07-27T08:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318296882",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "ping @theuni ",
      "created_at" : "2017-08-10T20:48:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-321668922",
      "id" : 321668922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-08-10T20:48:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321668922",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@EthanHeilman Thanks for adapting the style. I'll review thoroughly soon.",
      "created_at" : "2017-08-16T21:51:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-322909931",
      "id" : 322909931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-08-16T21:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322909931",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199359"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: The above if case looks misleadingly like a single-no-curling-brace-block (I misread it as such) until you realize the thing below the comment (`// The position...`) is actually ending the block.\r\n\r\nMaybe move the comment inside and indented inside the else block? ",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:19:43Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199359",
      "id" : 169199359,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 77,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199359",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199460"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199460"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here, in case you address the above indentation/readability concern.\r\n\r\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:20:47Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199460",
      "id" : 169199460,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 88,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199460",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199786"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems like you can reduce the lines below by defaulting to `true` here, as several cases simply turn it on. Unless it is too complicated to swap.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:24:31Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199786",
      "id" : 169199786,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 61,
      "path" : "src/addrman.cpp",
      "position" : 45,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199786",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment mentions old name (`newId`).",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:26:23Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();\n+\n+    std::set<int>::iterator it = m_tried_collisions.begin();\n+\n+    // Selects a random element from m_tried_collisions\n+    std::advance(it, GetRandInt(m_tried_collisions.size()));\n+    int id_new = *it;\n+\n+    // If newId not found in mapInfo remove it from m_tried_collisions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199943",
      "id" : 169199943,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 119,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199943",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199994"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe just `return mapInfo[id_old];`?",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:27:00Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();\n+\n+    std::set<int>::iterator it = m_tried_collisions.begin();\n+\n+    // Selects a random element from m_tried_collisions\n+    std::advance(it, GetRandInt(m_tried_collisions.size()));\n+    int id_new = *it;\n+\n+    // If newId not found in mapInfo remove it from m_tried_collisions\n+    if (mapInfo.count(id_new) != 1) {\n+        m_tried_collisions.erase(it);\n+        return CAddrInfo();\n+    }\n+\n+    CAddrInfo& newInfo = mapInfo[id_new];\n+\n+    // which tried bucket to move the entry to\n+    int tried_bucket = newInfo.GetTriedBucket(nKey);\n+    int tried_bucket_pos = newInfo.GetBucketPosition(nKey, false, tried_bucket);\n+\n+    int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+    CAddrInfo& info_old = mapInfo[id_old];\n+\n+    return info_old;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169199994",
      "id" : 169199994,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 134,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169199994",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200154"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(Tests so maybe no biggie but) use `std::to_string()` not `boost::to_string()`",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:29:01Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200154",
      "id" : 169200154,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 35,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200154",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200207"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200207"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`std::to_string`",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T01:29:27Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));\n+        addrman.Add(CAddress(addr, NODE_NONE), source);\n+        addrman.Good(addr);\n+\n+        // No collisions yet.\n+        BOOST_CHECK(addrman.size() == i);\n+        BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+    }\n+\n+    // Ensure Good handles duplicates well.\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169200207",
      "id" : 169200207,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 46,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 97687151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169200207",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169478260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169478260"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Let me fix these and all push later tonight",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-20T22:16:03Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));\n+        addrman.Add(CAddress(addr, NODE_NONE), source);\n+        addrman.Good(addr);\n+\n+        // No collisions yet.\n+        BOOST_CHECK(addrman.size() == i);\n+        BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+    }\n+\n+    // Ensure Good handles duplicates well.\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r169478260",
      "id" : 169478260,
      "in_reply_to_id" : 169200207,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 46,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 98010989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/169478260",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I appreciate this comment, but I'm concerned it would be more confusing to read if I shortened it.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:23:26Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482138",
      "id" : 170482138,
      "in_reply_to_id" : 169199786,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 61,
      "path" : "src/addrman.cpp",
      "position" : 45,
      "pull_request_review_id" : 99171597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482138",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482224"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, thanks!",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:24:40Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();\n+\n+    std::set<int>::iterator it = m_tried_collisions.begin();\n+\n+    // Selects a random element from m_tried_collisions\n+    std::advance(it, GetRandInt(m_tried_collisions.size()));\n+    int id_new = *it;\n+\n+    // If newId not found in mapInfo remove it from m_tried_collisions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482224",
      "id" : 170482224,
      "in_reply_to_id" : 169199943,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 119,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99171693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482224",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482515"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482515"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It looked weird below the else if and in a brief search I couldn't find any other examples of that style in code. Instead I moved it to right of the if else.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:28:25Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482515",
      "id" : 170482515,
      "in_reply_to_id" : 169199359,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 77,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99172024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482515",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482524"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482524"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:28:30Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                // Has attempted to connect and failed in last X hours\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();\n+\n+    std::set<int>::iterator it = m_tried_collisions.begin();\n+\n+    // Selects a random element from m_tried_collisions\n+    std::advance(it, GetRandInt(m_tried_collisions.size()));\n+    int id_new = *it;\n+\n+    // If newId not found in mapInfo remove it from m_tried_collisions\n+    if (mapInfo.count(id_new) != 1) {\n+        m_tried_collisions.erase(it);\n+        return CAddrInfo();\n+    }\n+\n+    CAddrInfo& newInfo = mapInfo[id_new];\n+\n+    // which tried bucket to move the entry to\n+    int tried_bucket = newInfo.GetTriedBucket(nKey);\n+    int tried_bucket_pos = newInfo.GetBucketPosition(nKey, false, tried_bucket);\n+\n+    int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+    CAddrInfo& info_old = mapInfo[id_old];\n+\n+    return info_old;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170482524",
      "id" : 170482524,
      "in_reply_to_id" : 169199994,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 134,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99172036,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170482524",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:36:18Z",
      "diff_hunk" : "@@ -550,4 +557,158 @@ BOOST_AUTO_TEST_CASE(caddrinfo_get_new_bucket)\n     //  than 64 buckets.\n     BOOST_CHECK(buckets.size() > 64);\n }\n+\n+\n+BOOST_AUTO_TEST_CASE(addrman_selecttriedcollision)\n+{\n+    CAddrManTest addrman;\n+\n+    // Set addrman addr placement to be deterministic.\n+    addrman.MakeDeterministic();\n+\n+    BOOST_CHECK(addrman.size() == 0);\n+\n+    // Empty addrman should return blank addrman info.\n+    BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+\n+    // Add twenty two addresses.\n+    CNetAddr source = ResolveIP(\"252.2.2.2\");\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));\n+        addrman.Add(CAddress(addr, NODE_NONE), source);\n+        addrman.Good(addr);\n+\n+        // No collisions yet.\n+        BOOST_CHECK(addrman.size() == i);\n+        BOOST_CHECK(addrman.SelectTriedCollision().ToString() == \"[::]:0\");\n+    }\n+\n+    // Ensure Good handles duplicates well.\n+    for (unsigned int i = 1; i < 23; i++) {\n+        CService addr = ResolveService(\"250.1.1.\"+boost::to_string(i));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483181",
      "id" : 170483181,
      "in_reply_to_id" : 169200207,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 46,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 99172760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483181",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483292"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483292"
         }
      },
      "author_association" : "MEMBER",
      "body" : "There are plenty of examples of this, I think.\r\n\r\nE.g. https://github.com/bitcoin/bitcoin/blob/bf3353de90598f08a68d966c50b57ceaeb5b5d96/src/validation.cpp#L1399-L1402\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/bf3353de90598f08a68d966c50b57ceaeb5b5d96/src/validation.cpp#L2416-L2418\r\n",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:37:32Z",
      "diff_hunk" : "@@ -521,3 +533,84 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+\n+            // The position in the tried bucket is not empty\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483292",
      "id" : 170483292,
      "in_reply_to_id" : 169199359,
      "original_commit_id" : "8604020bab3963599ebfd933b91096ae1f686d69",
      "original_position" : 77,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99172867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483292",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483474"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: remove space in `=%d \\n`",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:39:36Z",
      "diff_hunk" : "@@ -233,10 +233,22 @@ void CAddrMan::Good_(const CService& addr, int64_t nTime)\n     if (nUBucket == -1)\n         return;\n \n-    LogPrint(BCLog::ADDRMAN, \"Moving %s to tried\\n\", addr.ToString());\n+    // which tried bucket to move the entry to\n+    int tried_bucket = info.GetTriedBucket(nKey);\n+    int tried_bucket_pos = info.GetBucketPosition(nKey, false, tried_bucket);\n+\n+    // Will moving this address into tried evict another entry?\n+    if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n+        LogPrint(BCLog::ADDRMAN, \"addrman\", \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d \\n\", addr.ToString(), m_tried_collisions.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483474",
      "id" : 170483474,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 36,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483474",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483534"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Always use `{}` brackets for multiline `if`s (new convention as of a while ago).",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:40:12Z",
      "diff_hunk" : "@@ -233,10 +233,22 @@ void CAddrMan::Good_(const CService& addr, int64_t nTime)\n     if (nUBucket == -1)\n         return;\n \n-    LogPrint(BCLog::ADDRMAN, \"Moving %s to tried\\n\", addr.ToString());\n+    // which tried bucket to move the entry to\n+    int tried_bucket = info.GetTriedBucket(nKey);\n+    int tried_bucket_pos = info.GetBucketPosition(nKey, false, tried_bucket);\n+\n+    // Will moving this address into tried evict another entry?\n+    if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n+        LogPrint(BCLog::ADDRMAN, \"addrman\", \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d \\n\", addr.ToString(), m_tried_collisions.size());\n+\n+        if (m_tried_collisions.size() < ADDRMAN_SET_TRIED_COLLISION_SIZE)\n+            m_tried_collisions.insert(nId);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483534",
      "id" : 170483534,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 39,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483534",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483707"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: IMO nix newline (I understand that you want to space out for readability but this isn't usually done, and some argue that more compact gives a better overview).",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:41:56Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483707",
      "id" : 170483707,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 75,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483707",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483732"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: see above (your call, of course)",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:42:12Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            \n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483732",
      "id" : 170483732,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 77,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483732",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "-'-",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:42:32Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            \n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483760",
      "id" : 170483760,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 85,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483760",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Use `{}` for multiline `if`",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:43:29Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            \n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) { // attempted to connect and failed in last X hours\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170483841",
      "id" : 170483841,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 109,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170483841",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484146"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why the extra `{}`?",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:46:58Z",
      "diff_hunk" : "@@ -537,12 +552,14 @@ class CAddrMan\n     }\n \n     //! Mark an entry as accessible.\n-    void Good(const CService &addr, int64_t nTime = GetAdjustedTime())\n+    void Good(const CService &addr, bool test_before_evict = true, int64_t time = GetAdjustedTime())\n     {\n-        LOCK(cs);\n-        Check();\n-        Good_(addr, nTime);\n-        Check();\n+        {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484146",
      "id" : 170484146,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 63,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484146",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484170"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same question here (why double `{}`?)",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:47:12Z",
      "diff_hunk" : "@@ -554,6 +571,28 @@ class CAddrMan\n         Check();\n     }\n \n+    //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n+    void ResolveCollisions(){\n+         {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484170",
      "id" : 170484170,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 78,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484170",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484201"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484201"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: space after `()` before `{`. I think functions actually put the `{` on the next line, which you did in other cases.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:47:28Z",
      "diff_hunk" : "@@ -554,6 +571,28 @@ class CAddrMan\n         Check();\n     }\n \n+    //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n+    void ResolveCollisions(){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484201",
      "id" : 170484201,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 77,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484201",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484273"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484273"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit on `(){` (add space or newline)",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:48:24Z",
      "diff_hunk" : "@@ -554,6 +571,28 @@ class CAddrMan\n         Check();\n     }\n \n+    //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n+    void ResolveCollisions(){\n+         {\n+            LOCK(cs);\n+            Check();\n+            ResolveCollisions_();\n+            Check();\n+        }\n+    }\n+\n+    //! Randomly select an address in tried that another address is attempting to evict.\n+    CAddrInfo SelectTriedCollision(){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484273",
      "id" : 170484273,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 87,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484273",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484299"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484299"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same Q on `{}`. The lock will go out of scope before `ret`, but I don't think it will matter here as the lock will go out of scope on `return` regardless.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:48:44Z",
      "diff_hunk" : "@@ -554,6 +571,28 @@ class CAddrMan\n         Check();\n     }\n \n+    //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n+    void ResolveCollisions(){\n+         {\n+            LOCK(cs);\n+            Check();\n+            ResolveCollisions_();\n+            Check();\n+        }\n+    }\n+\n+    //! Randomly select an address in tried that another address is attempting to evict.\n+    CAddrInfo SelectTriedCollision(){\n+        CAddrInfo ret;\n+        {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484299",
      "id" : 170484299,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 89,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484299",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Remove extra newline.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:50:00Z",
      "diff_hunk" : "@@ -1824,11 +1824,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n         }\n \n+        addrman.ResolveCollisions();\n+\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484378",
      "id" : 170484378,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 6,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484378",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Wrap multiline `if` in `{}`.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:50:15Z",
      "diff_hunk" : "@@ -1824,11 +1824,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n         }\n \n+        addrman.ResolveCollisions();\n+\n+\n         int64_t nANow = GetAdjustedTime();\n         int nTries = 0;\n         while (!interruptNet)\n         {\n-            CAddrInfo addr = addrman.Select(fFeeler);\n+            CAddrInfo addr = addrman.SelectTriedCollision();\n+\n+            // SelectTriedCollision returns an invalid address if it is empty.\n+            if (!fFeeler || !addr.IsValid())\n+                addr = addrman.Select(fFeeler);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484407",
      "id" : 170484407,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 16,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484407",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484420"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484420"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Space or newline before `{`",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-02-26T02:50:25Z",
      "diff_hunk" : "@@ -52,6 +52,13 @@ class CAddrManTest : public CAddrMan\n     {\n         CAddrMan::Delete(nId);\n     }\n+\n+    void SimConnFail(CService& addr){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r170484420",
      "id" : 170484420,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 5,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 99173067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/170484420",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022014"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Keeping new lines between code and comments as it more clearly distinguishes which line the comment is associated with. Removing newlines in other circumstances",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T16:51:49Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022014",
      "id" : 172022014,
      "in_reply_to_id" : 170483707,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 75,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 100980198,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022014",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022097"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "What does -'- mean?",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T16:54:50Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            \n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022097",
      "id" : 172022097,
      "in_reply_to_id" : 170483760,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 85,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 100980292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022097",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022177"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I reread the style guide more carefully and now I see what you mean",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T16:58:05Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            \n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) { // attempted to connect and failed in last X hours\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    // Replaces an existing address already in the tried table with the new address\n+                    Good_(info_new, false, GetAdjustedTime());\n+                    erase_collision = true;\n+                }\n+            } else { // Collision is not actually a collision anymore\n+                Good_(info_new, false, GetAdjustedTime());\n+                erase_collision = true;\n+            }\n+        }\n+\n+        if (erase_collision){\n+            m_tried_collisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    if (m_tried_collisions.size() == 0)\n+        return CAddrInfo();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022177",
      "id" : 172022177,
      "in_reply_to_id" : 170483841,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 109,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 100980380,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022177",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022385"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure, Bitcoin used to have a second set of braces there when this pull request was originally created. They have been removed in the latest version.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fb26bf0ea3822638b10a783f054c280fc053a2b5/src/addrman.h#L526",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T17:05:15Z",
      "diff_hunk" : "@@ -537,12 +552,14 @@ class CAddrMan\n     }\n \n     //! Mark an entry as accessible.\n-    void Good(const CService &addr, int64_t nTime = GetAdjustedTime())\n+    void Good(const CService &addr, bool test_before_evict = true, int64_t time = GetAdjustedTime())\n     {\n-        LOCK(cs);\n-        Check();\n-        Good_(addr, nTime);\n-        Check();\n+        {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022385",
      "id" : 172022385,
      "in_reply_to_id" : 170484146,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 63,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 100980596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022385",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022517"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022517"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I just double checked the style guide and you are correct current style is `{` on a new line for methods.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T17:12:27Z",
      "diff_hunk" : "@@ -554,6 +571,28 @@ class CAddrMan\n         Check();\n     }\n \n+    //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n+    void ResolveCollisions(){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022517",
      "id" : 172022517,
      "in_reply_to_id" : 170484201,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 77,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 100980774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022517",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022646"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm using the pattern from select. Since they essentially do the same thing they should look the same.\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/addrman.h#L562",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T17:17:35Z",
      "diff_hunk" : "@@ -554,6 +571,28 @@ class CAddrMan\n         Check();\n     }\n \n+    //! See if any to-be-evicted tried table entries have been tested and if so resolve the collisions.\n+    void ResolveCollisions(){\n+         {\n+            LOCK(cs);\n+            Check();\n+            ResolveCollisions_();\n+            Check();\n+        }\n+    }\n+\n+    //! Randomly select an address in tried that another address is attempting to evict.\n+    CAddrInfo SelectTriedCollision(){\n+        CAddrInfo ret;\n+        {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022646",
      "id" : 172022646,
      "in_reply_to_id" : 170484299,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 89,
      "path" : "src/addrman.h",
      "position" : null,
      "pull_request_review_id" : 100980934,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022646",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022666"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-03T17:18:39Z",
      "diff_hunk" : "@@ -1824,11 +1824,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             }\n         }\n \n+        addrman.ResolveCollisions();\n+\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172022666",
      "id" : 172022666,
      "in_reply_to_id" : 170484378,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 6,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 100980959,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172022666",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172066218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sorry, it means \"same as above\". Like \"Ditto mark\".",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-04T21:54:05Z",
      "diff_hunk" : "@@ -521,3 +533,81 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            \n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066218",
      "id" : 172066218,
      "in_reply_to_id" : 170483760,
      "original_commit_id" : "1fdbcc850ac5eaa5d6d51556f19bf0ff522b9ef9",
      "original_position" : 85,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 101021112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172066218",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172066296"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Indent `LogPrint` line? If you get a lot of indentation-only changes you can suggest people add `?w=1` to the diff page to ignore whitespace only changes.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-04T21:56:54Z",
      "diff_hunk" : "@@ -233,10 +233,22 @@ void CAddrMan::Good_(const CService& addr, int64_t nTime)\n     if (nUBucket == -1)\n         return;\n \n+    // which tried bucket to move the entry to\n+    int tried_bucket = info.GetTriedBucket(nKey);\n+    int tried_bucket_pos = info.GetBucketPosition(nKey, false, tried_bucket);\n+\n+    // Will moving this address into tried evict another entry?\n+    if (test_before_evict && (vvTried[tried_bucket][tried_bucket_pos] != -1)) {\n+        LogPrint(BCLog::ADDRMAN, \"addrman\", \"Collision inserting element into tried table, moving %s to m_tried_collisions=%d\\n\", addr.ToString(), m_tried_collisions.size());\n+        if (m_tried_collisions.size() < ADDRMAN_SET_TRIED_COLLISION_SIZE) {\n+            m_tried_collisions.insert(nId);\n+        }\n+    } else {\n     LogPrint(BCLog::ADDRMAN, \"Moving %s to tried\\n\", addr.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066296",
      "id" : 172066296,
      "original_commit_id" : "76179949e00bec982235cb538764d46efa97021f",
      "original_position" : 24,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 101021200,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172066296",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172066408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's not clear to me what this function's name is an abbreviation of. \"Simulate connection failure?\" Is it for testing/debugging?",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-04T21:59:43Z",
      "diff_hunk" : "@@ -52,6 +52,14 @@ class CAddrManTest : public CAddrMan\n     {\n         CAddrMan::Delete(nId);\n     }\n+\n+    void SimConnFail(CService& addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172066408",
      "id" : 172066408,
      "original_commit_id" : "76179949e00bec982235cb538764d46efa97021f",
      "original_position" : 5,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 101021200,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172066408",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/250224?v=4",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172265214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172265214"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Added comment",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-05T17:27:40Z",
      "diff_hunk" : "@@ -52,6 +52,14 @@ class CAddrManTest : public CAddrMan\n     {\n         CAddrMan::Delete(nId);\n     }\n+\n+    void SimConnFail(CService& addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172265214",
      "id" : 172265214,
      "in_reply_to_id" : 172066408,
      "original_commit_id" : "76179949e00bec982235cb538764d46efa97021f",
      "original_position" : 5,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 101253104,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172265214",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172267038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172267038"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "But yes, it is for testing. The test before evict logic needs connections to fail to exercise the eviction code. This allows when we test a particular addresses to force it to fail.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-05T17:34:00Z",
      "diff_hunk" : "@@ -52,6 +52,14 @@ class CAddrManTest : public CAddrMan\n     {\n         CAddrMan::Delete(nId);\n     }\n+\n+    void SimConnFail(CService& addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172267038",
      "id" : 172267038,
      "in_reply_to_id" : 172066408,
      "original_commit_id" : "76179949e00bec982235cb538764d46efa97021f",
      "original_position" : 5,
      "path" : "src/test/addrman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 101255266,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172267038",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK, though I  haven't reviewed the tests.  (Also I am new to this code, but I tried to come up with all the ways I thought this could be broken, and failed to come up with anything.)\r\n\r\nEDIT: travis error is some sort of whitespace issue:\r\n\r\n```\r\nThis diff appears to have added new lines with trailing whitespace.\r\nThe following changes were suspected:\r\ndiff --git a/src/addrman.cpp b/src/addrman.cpp\r\n@@ -523,0 +536,74 @@ int CAddrMan::RandomInt(int nMax){\r\n+\r\n^---- failure generated from contrib/devtools/lint-whitespace.sh\r\nThe command \"if [ \"$CHECK_DOC\" = 1 -a \"$TRAVIS_EVENT_TYPE\" = \"pull_request\" ]; then contrib/devtools/lint-all.sh; fi\" failed and exited with 1 during .\r\nYour build has been stopped.\r\n```",
      "created_at" : "2018-03-05T20:55:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370562158",
      "id" : 370562158,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2018-03-05T20:58:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370562158",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@sdaftuar I've been trying to find the whitespace error for a while now. I can't seem to find it. The line number identified seems to just be a carriage return. Any help?",
      "created_at" : "2018-03-05T21:48:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-370578539",
      "id" : 370578539,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2018-03-05T21:48:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/370578539",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172340917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172340917"
         }
      },
      "author_association" : "OWNER",
      "body" : "The trailing spaces are on this line.",
      "commit_id" : "06464318cfa93913e82087e1f321e92d18537fb2",
      "created_at" : "2018-03-05T21:52:03Z",
      "diff_hunk" : "@@ -521,3 +533,77 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = m_tried_collisions.begin(); it != m_tried_collisions.end();) {\n+        int id_new = *it;\n+\n+        bool erase_collision = false;\n+\n+        // If id_new not found in mapInfo remove it from m_tried_collisions\n+        if (mapInfo.count(id_new) != 1) {\n+            erase_collision = true;\n+        } else {\n+            CAddrInfo& info_new = mapInfo[id_new];\n+\n+            // Which tried bucket to move the entry to.\n+            int tried_bucket = info_new.GetTriedBucket(nKey);\n+            int tried_bucket_pos = info_new.GetBucketPosition(nKey, false, tried_bucket);\n+            if (!info_new.IsValid()) { // id_new may no longer map to a valid address\n+                erase_collision = true;\n+            } else if (vvTried[tried_bucket][tried_bucket_pos] != -1) { // The position in the tried bucket is not empty\n+\n+                // Get the to-be-evicted address that is being tested\n+                int id_old = vvTried[tried_bucket][tried_bucket_pos];\n+                CAddrInfo& info_old = mapInfo[id_old];\n+                // Has successfully connected in last X hours\n+                if (GetAdjustedTime() - info_old.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                    erase_collision = true;\n+                } else if (GetAdjustedTime() - info_old.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) { // attempted to connect and failed in last X hours\n+                    LogPrint(BCLog::ADDRMAN, \"addrman\", \"Swapping %s for %s in tried table\\n\", info_new.ToString(), info_old.ToString());\n+                    ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r172340917",
      "id" : 172340917,
      "original_commit_id" : "8989b6f1aee08e860cda864b085e8d33749dcebe",
      "original_position" : 68,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 101341956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2018-03-05T22:39:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/172340917",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
