[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-05-12T15:15:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1545905818",
      "id" : 1545905818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cJKaa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545905818/reactions"
      },
      "updated_at" : "2023-05-12T15:15:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545905818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't believe this affects the majority of users (where the two pools per core default works fine), so I don't see why we'd update the default service file like this.\n\nWe have documentation that describes what to do to reduce memory in the event that one wants to do that?",
      "created_at" : "2023-05-12T15:19:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1545912961",
      "id" : 1545912961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cJMKB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545912961/reactions"
      },
      "updated_at" : "2023-05-12T15:19:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545912961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't believe this affects the majority of users (where the two pools per core default works fine), so I don't see why we'd update the default service file like this.\r\n> \r\n> We have documentation that describes what to do to reduce memory in the event that one wants to do that?\r\n\r\nMaybe it's my fault for not digging into the docs more but I went over a year with inflated, unpredictable RAM usage and even occasional OOM crashes on a machine that I wouldn't consider particularly memory-constrained. It looks like the reason I was seeing it was due to a higher `rpcthreads` setting, but I'm sure I'm not the only one that has that sort of config and they may be dealing with the same issues.\r\n\r\nMy thinking is that if in fact the performance impact is \"small or absent\" in bitcoind then this is a sensible default for linux machines.",
      "created_at" : "2023-05-12T15:35:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1545934901",
      "id" : 1545934901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cJRg1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545934901/reactions"
      },
      "updated_at" : "2023-05-12T15:35:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545934901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "From the doc:\r\n\r\n> However, in Bitcoin Core very little parallel allocation happens, so the impact is expected to be small or absent.\r\n\r\nThe \"expected to be\" could use some benchmarks before making it a default. Does the problem only happen with high `rpcthreads` or equally with other (potentially more common) settings like a high `-dbcache` or `-maxmempool`?",
      "created_at" : "2023-05-12T18:04:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1546100497",
      "id" : 1546100497,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cJ58R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546100497/reactions"
      },
      "updated_at" : "2023-05-12T18:04:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546100497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Does the problem only happen with high `rpcthreads` or equally with other (potentially more common) settings like a high `-dbcache` or `-maxmempool`?\r\n\r\nFrom my understanding/reading of `MALLOC_ARENA_MAX` it affects memory usage where multiple threads are concerned. `rpcthreads` is the only configuration option afaict that impacts the number of threads running. Increasing `dbcache` or `maxmempool` wouldn't create new threads, only increase a set limit of RAM usage, so I don't think those alone would trigger the behavior I was seeing.",
      "created_at" : "2023-05-12T18:28:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1546123761",
      "id" : 1546123761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cJ_nx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546123761/reactions"
      },
      "updated_at" : "2023-05-12T18:28:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546123761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "More relevant discussion here: https://github.com/bitcoin/bitcoin/issues/6876#issuecomment-151045764",
      "created_at" : "2023-05-12T18:34:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1546129601",
      "id" : 1546129601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cKBDB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546129601/reactions"
      },
      "updated_at" : "2023-05-12T18:34:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546129601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sangaman maybe `-par` as well? It defaults to the number of cores - 1 and is capped at 15. ",
      "created_at" : "2023-05-12T18:48:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1546143791",
      "id" : 1546143791,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cKEgv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546143791/reactions"
      },
      "updated_at" : "2023-05-12T18:48:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546143791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Now that #25325 has been merged, this might be less of an issue. This pool allocator significantly reduces the number of allocations used for `CCoinsMap`. (by about a factor of 2000).",
      "created_at" : "2023-05-13T13:57:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1546658892",
      "id" : 1546658892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cMCRM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546658892/reactions"
      },
      "updated_at" : "2023-05-13T13:57:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546658892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Now that #25325 has been merged, this might be less of an issue. This pool allocator significantly reduces the number of allocations used for `CCoinsMap`. (by about a factor of 2000).\r\n\r\nThanks! I'll try that branch out and see if resolves the underlying issue without this env var, in which case I'd agree this PR is probably not necessary.",
      "created_at" : "2023-05-13T14:35:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1546666636",
      "id" : 1546666636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cMEKM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546666636/reactions"
      },
      "updated_at" : "2023-05-13T14:35:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546666636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Note that internally we already set [`M_ARENA_MAX` to 1](https://github.com/bitcoin/bitcoin/blob/d02df7db6b3651a725fe35be42e3489e2d6b53a1/src/util/system.cpp#L70), but that is currently restricted to 32-bit systems. I would assume everyone reporting issues (#24542) is using on 64-bit. We may be at the point where we could just drop that code entirely.",
      "created_at" : "2023-05-15T11:01:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27642#issuecomment-1547643907",
      "id" : 1547643907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27642",
      "node_id" : "IC_kwDOABII585cPywD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1547643907/reactions"
      },
      "updated_at" : "2023-05-15T11:01:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1547643907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
