[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25380](https://github.com/bitcoin/bitcoin/pull/25380) (Detect and ignore transactions that were CPFP'd in the fee estimator by darosior)\n* [#10443](https://github.com/bitcoin/bitcoin/pull/10443) (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-05-10T22:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#issuecomment-1542881490",
      "id" : 1542881490,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27622",
      "node_id" : "IC_kwDOABII585b9oDS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542881490/reactions"
      },
      "updated_at" : "2023-05-11T04:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542881490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @instagibbs @TheBlueMatt ",
      "created_at" : "2023-05-11T09:27:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#issuecomment-1543653619",
      "id" : 1543653619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27622",
      "node_id" : "IC_kwDOABII585cAkjz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1543653619/reactions"
      },
      "updated_at" : "2023-05-11T09:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1543653619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191301314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191301314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it's a bit strange for policy/fees to have a dependency on scheduler. Maybe register `FlushFeeEstimates()` with the scheduler within `AppInitMain()` instead?",
      "commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "created_at" : "2023-05-11T14:51:02Z",
      "diff_hunk" : "@@ -12,6 +12,7 @@\n #include <policy/feerate.h>\n #include <primitives/transaction.h>\n #include <random.h>\n+#include <scheduler.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191301314",
      "id" : 1191301314,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII585HAdDC",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 15,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 4,
      "pull_request_review_id" : 1422800079,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191301314/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T14:52:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191301314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191350003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191350003"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit (feel free to ignore): An alternative to adding a function here would be to call the already existing `Ticks<std::chrono::hours>(a)` over `count_hours(a)`, but either seems fine.",
      "commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "created_at" : "2023-05-11T15:24:51Z",
      "diff_hunk" : "@@ -53,6 +53,7 @@ constexpr auto TicksSinceEpoch(Timepoint t)\n {\n     return Ticks<Duration>(t.time_since_epoch());\n }\n+constexpr int64_t count_hours(std::chrono::hours t) { return t.count(); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191350003",
      "id" : 1191350003,
      "line" : 56,
      "node_id" : "PRRC_kwDOABII585HAo7z",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 56,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/util/time.h",
      "position" : 4,
      "pull_request_review_id" : 1422877741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191350003/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T15:32:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191350003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191352778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191352778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: \r\n\r\n```suggestion\r\n        fee_dat = self.nodes[0].chain_path / \"fee_estimates.dat\"\r\n```",
      "commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "created_at" : "2023-05-11T15:26:52Z",
      "diff_hunk" : "@@ -290,6 +291,38 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"feerate\"], fee_rate)\n+\n+        fee_dat = os.path.join(self.nodes[0].datadir, self.chain, \"fee_estimates.dat\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191352778",
      "id" : 1191352778,
      "line" : 303,
      "node_id" : "PRRC_kwDOABII585HApnK",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 303,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 21,
      "pull_request_review_id" : 1422877741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191352778/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T15:32:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191352778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191357213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191357213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: I am not a fan of uninterruptible sleep in tests. `assert_debug_log` can be used to wait, if you supply a timeout argument (or rely on the default timeout)",
      "commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "created_at" : "2023-05-11T15:30:12Z",
      "diff_hunk" : "@@ -290,6 +291,38 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"feerate\"], fee_rate)\n+\n+        fee_dat = os.path.join(self.nodes[0].datadir, self.chain, \"fee_estimates.dat\")\n+\n+        # Stop the node and backdate the fee_estimates.dat file for 13 hours\n+        self.stop_node(0)\n+        hour = 60 * 60\n+        last_modified_time = time.time() - 13 * hour\n+        os.utime(fee_dat, (last_modified_time, last_modified_time))\n+\n+        # Start node and ensure the fee_estimates.dat file was not read\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"errors\"], [\"Insufficient data or no feerate found\"])\n+\n+\n+    def test_estimate_dat_is_flushed_periodically(self):\n+            # Check if the string \"Flushed fee estimates to fee_estimates.dat.\" is present in the debug log file.\n+            # If it is, it indicates that fee estimates have been successfully flushed to disk.\n+            with self.nodes[0].assert_debug_log(expected_msgs=[\"Flushed fee estimates to fee_estimates.dat.\"]):\n+                # Mock the scheduler for an hour, sleep for a short period to allow the flush to finish\n+                hour = 3600\n+                self.nodes[0].mockscheduler(hour)\n+                time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191357213",
      "id" : 1191357213,
      "line" : 323,
      "node_id" : "PRRC_kwDOABII585HAqsd",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 323,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 41,
      "pull_request_review_id" : 1422877741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191357213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T15:32:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191357213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191566131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191566131"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you forgot to remove the sleep?",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-11T18:48:12Z",
      "diff_hunk" : "@@ -290,6 +291,38 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"feerate\"], fee_rate)\n+\n+        fee_dat = os.path.join(self.nodes[0].datadir, self.chain, \"fee_estimates.dat\")\n+\n+        # Stop the node and backdate the fee_estimates.dat file for 13 hours\n+        self.stop_node(0)\n+        hour = 60 * 60\n+        last_modified_time = time.time() - 13 * hour\n+        os.utime(fee_dat, (last_modified_time, last_modified_time))\n+\n+        # Start node and ensure the fee_estimates.dat file was not read\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"errors\"], [\"Insufficient data or no feerate found\"])\n+\n+\n+    def test_estimate_dat_is_flushed_periodically(self):\n+            # Check if the string \"Flushed fee estimates to fee_estimates.dat.\" is present in the debug log file.\n+            # If it is, it indicates that fee estimates have been successfully flushed to disk.\n+            with self.nodes[0].assert_debug_log(expected_msgs=[\"Flushed fee estimates to fee_estimates.dat.\"]):\n+                # Mock the scheduler for an hour, sleep for a short period to allow the flush to finish\n+                hour = 3600\n+                self.nodes[0].mockscheduler(hour)\n+                time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191566131",
      "id" : 1191566131,
      "in_reply_to_id" : 1191357213,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HBdsz",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 323,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : null,
      "pull_request_review_id" : 1423228771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191566131/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T18:48:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191566131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191573164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191573164"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My bad, thanks.",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-11T18:53:27Z",
      "diff_hunk" : "@@ -290,6 +291,38 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"feerate\"], fee_rate)\n+\n+        fee_dat = os.path.join(self.nodes[0].datadir, self.chain, \"fee_estimates.dat\")\n+\n+        # Stop the node and backdate the fee_estimates.dat file for 13 hours\n+        self.stop_node(0)\n+        hour = 60 * 60\n+        last_modified_time = time.time() - 13 * hour\n+        os.utime(fee_dat, (last_modified_time, last_modified_time))\n+\n+        # Start node and ensure the fee_estimates.dat file was not read\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"errors\"], [\"Insufficient data or no feerate found\"])\n+\n+\n+    def test_estimate_dat_is_flushed_periodically(self):\n+            # Check if the string \"Flushed fee estimates to fee_estimates.dat.\" is present in the debug log file.\n+            # If it is, it indicates that fee estimates have been successfully flushed to disk.\n+            with self.nodes[0].assert_debug_log(expected_msgs=[\"Flushed fee estimates to fee_estimates.dat.\"]):\n+                # Mock the scheduler for an hour, sleep for a short period to allow the flush to finish\n+                hour = 3600\n+                self.nodes[0].mockscheduler(hour)\n+                time.sleep(1)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191573164",
      "id" : 1191573164,
      "in_reply_to_id" : 1191357213,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HBfas",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 323,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : null,
      "pull_request_review_id" : 1423241416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191573164/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T18:53:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191573164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191578999"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191578999"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/FLUSH_INTERVAL/FEE_FLUSH_INTERVAL/ ?",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-11T18:59:16Z",
      "diff_hunk" : "@@ -14,12 +14,17 @@\n #include <util/fs.h>\n \n #include <array>\n+#include <chrono>\n #include <map>\n #include <memory>\n #include <set>\n #include <string>\n #include <vector>\n \n+\n+// How often to flush fee estimates to fee_estimates.dat.\n+static constexpr std::chrono::milliseconds FLUSH_INTERVAL{std::chrono::hours{1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191578999",
      "id" : 1191578999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HBg13",
      "original_commit_id" : "0d2329aecaa39f328fec84f63f0bebf31e49b070",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : null,
      "pull_request_review_id" : 1423253142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191578999/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T18:59:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191578999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191584552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191584552"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "FEE_FLUSH_INTERVAL is better.\r\nI think.\r\n",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-11T19:05:37Z",
      "diff_hunk" : "@@ -14,12 +14,17 @@\n #include <util/fs.h>\n \n #include <array>\n+#include <chrono>\n #include <map>\n #include <memory>\n #include <set>\n #include <string>\n #include <vector>\n \n+\n+// How often to flush fee estimates to fee_estimates.dat.\n+static constexpr std::chrono::milliseconds FLUSH_INTERVAL{std::chrono::hours{1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191584552",
      "id" : 1191584552,
      "in_reply_to_id" : 1191578999,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HBiMo",
      "original_commit_id" : "0d2329aecaa39f328fec84f63f0bebf31e49b070",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : null,
      "pull_request_review_id" : 1423262115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191584552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T19:05:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191584552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191715247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191715247"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sure :+1: , fixed. ",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-11T21:42:02Z",
      "diff_hunk" : "@@ -12,6 +12,7 @@\n #include <policy/feerate.h>\n #include <primitives/transaction.h>\n #include <random.h>\n+#include <scheduler.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1191715247",
      "id" : 1191715247,
      "in_reply_to_id" : 1191301314,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HCCGv",
      "original_commit_id" : "a2ad5e475f318552c50bcc8bb966c4841d7ef8b4",
      "original_line" : 15,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1423475651,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191715247/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-11T21:42:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191715247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1196990851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196990851"
         }
      },
      "author_association" : "MEMBER",
      "body" : "this log line fires even if it actually failed?",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-17T19:55:26Z",
      "diff_hunk" : "@@ -903,11 +904,15 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n     }\n+    LogPrintf(\"Flushed fee estimates to fee_estimates.dat.\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1196990851",
      "id" : 1196990851,
      "line" : 929,
      "node_id" : "PRRC_kwDOABII585HWKGD",
      "original_commit_id" : "bbb0750bd8bd9dcc8f169f0df7e1351c9da698c9",
      "original_line" : 929,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 46,
      "pull_request_review_id" : 1431475355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196990851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196990851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1196993686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196993686"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Seems ok, but would have to think about this more. I'd be ok with longer too, to start.",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-17T19:58:40Z",
      "diff_hunk" : "@@ -186,6 +186,10 @@ class CBlockPolicyEstimator\n     static constexpr double FEE_SPACING = 1.05;\n \n     const fs::path m_estimation_filepath;\n+\n+    /** Fee estimate.dat must not be more than 12 hours old. */\n+    static constexpr std::chrono::hours MAX_FILE_AGE{12};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1196993686",
      "id" : 1196993686,
      "line" : 191,
      "node_id" : "PRRC_kwDOABII585HWKyW",
      "original_commit_id" : "5a41661a118dc526780c006bdf09abcce92e24e5",
      "original_line" : 191,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 24,
      "pull_request_review_id" : 1431475355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196993686/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196993686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1196995104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196995104"
         }
      },
      "author_association" : "MEMBER",
      "body" : "checking for log is good, but checking it was actually written is better in case there's a bug in the logging logic",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-17T20:00:19Z",
      "diff_hunk" : "@@ -290,6 +291,37 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"feerate\"], fee_rate)\n+\n+        fee_dat = fee_dat = self.nodes[0].chain_path / \"fee_estimates.dat\"\n+\n+        # Stop the node and backdate the fee_estimates.dat file for 13 hours\n+        self.stop_node(0)\n+        hour = 60 * 60\n+        last_modified_time = time.time() - 13 * hour\n+        os.utime(fee_dat, (last_modified_time, last_modified_time))\n+\n+        # Start node and ensure the fee_estimates.dat file was not read\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"errors\"], [\"Insufficient data or no feerate found\"])\n+\n+\n+    def test_estimate_dat_is_flushed_periodically(self):\n+            # Check if the string \"Flushed fee estimates to fee_estimates.dat.\" is present in the debug log file.\n+            # If it is, it indicates that fee estimates have been successfully flushed to disk.\n+            with self.nodes[0].assert_debug_log(expected_msgs=[\"Flushed fee estimates to fee_estimates.dat.\"], timeout=1):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1196995104",
      "id" : 1196995104,
      "line" : 324,
      "node_id" : "PRRC_kwDOABII585HWLIg",
      "original_commit_id" : "aecd92e8e1ca8be8c76cc9621058614c893c47fc",
      "original_line" : 324,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 42,
      "pull_request_review_id" : 1431475355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196995104/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196995104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1197686957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197686957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, fixed thank you.",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-18T11:02:44Z",
      "diff_hunk" : "@@ -903,11 +904,15 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n     }\n+    LogPrintf(\"Flushed fee estimates to fee_estimates.dat.\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1197686957",
      "id" : 1197686957,
      "in_reply_to_id" : 1196990851,
      "line" : 929,
      "node_id" : "PRRC_kwDOABII585HY0Ct",
      "original_commit_id" : "bbb0750bd8bd9dcc8f169f0df7e1351c9da698c9",
      "original_line" : 929,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 46,
      "pull_request_review_id" : 1432491514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197686957/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T11:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197686957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1197688535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197688535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes thanks for pointing this out, I added the check.",
      "commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "created_at" : "2023-05-18T11:04:48Z",
      "diff_hunk" : "@@ -290,6 +291,37 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"feerate\"], fee_rate)\n+\n+        fee_dat = fee_dat = self.nodes[0].chain_path / \"fee_estimates.dat\"\n+\n+        # Stop the node and backdate the fee_estimates.dat file for 13 hours\n+        self.stop_node(0)\n+        hour = 60 * 60\n+        last_modified_time = time.time() - 13 * hour\n+        os.utime(fee_dat, (last_modified_time, last_modified_time))\n+\n+        # Start node and ensure the fee_estimates.dat file was not read\n+        self.start_node(0)\n+        assert_equal(self.nodes[0].estimatesmartfee(1)[\"errors\"], [\"Insufficient data or no feerate found\"])\n+\n+\n+    def test_estimate_dat_is_flushed_periodically(self):\n+            # Check if the string \"Flushed fee estimates to fee_estimates.dat.\" is present in the debug log file.\n+            # If it is, it indicates that fee estimates have been successfully flushed to disk.\n+            with self.nodes[0].assert_debug_log(expected_msgs=[\"Flushed fee estimates to fee_estimates.dat.\"], timeout=1):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1197688535",
      "id" : 1197688535,
      "in_reply_to_id" : 1196995104,
      "line" : 324,
      "node_id" : "PRRC_kwDOABII585HY0bX",
      "original_commit_id" : "aecd92e8e1ca8be8c76cc9621058614c893c47fc",
      "original_line" : 324,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 42,
      "pull_request_review_id" : 1432491514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197688535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T13:16:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197688535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1197693333"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197693333"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, to enhance flexibility, I can create a follow-up PR to introduce a configuration variable for MAX_FILE_AGE,  This way users can specify the maximum age of estimates they do not want to accept?",
      "commit_id" : "3a9fee21d261f3de560594e58de38641ace5cc34",
      "created_at" : "2023-05-18T11:10:33Z",
      "diff_hunk" : "@@ -186,6 +186,10 @@ class CBlockPolicyEstimator\n     static constexpr double FEE_SPACING = 1.05;\n \n     const fs::path m_estimation_filepath;\n+\n+    /** Fee estimate.dat must not be more than 12 hours old. */\n+    static constexpr std::chrono::hours MAX_FILE_AGE{12};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1197693333",
      "id" : 1197693333,
      "in_reply_to_id" : 1196993686,
      "line" : 191,
      "node_id" : "PRRC_kwDOABII585HY1mV",
      "original_commit_id" : "5a41661a118dc526780c006bdf09abcce92e24e5",
      "original_line" : 191,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 24,
      "pull_request_review_id" : 1432491514,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197693333/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T11:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197693333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198071636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198071636"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Mine as well use this constant here for the filename?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/6cc136bbd36f859a16e469bb5c016d06c19bcd50/src/policy/fees_args.cpp#L10",
      "commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "created_at" : "2023-05-18T17:09:37Z",
      "diff_hunk" : "@@ -903,11 +904,15 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n     }\n+    LogPrintf(\"Flushed fee estimates to fee_estimates.dat.\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198071636",
      "id" : 1198071636,
      "in_reply_to_id" : 1196990851,
      "line" : 929,
      "node_id" : "PRRC_kwDOABII585HaR9U",
      "original_commit_id" : "bbb0750bd8bd9dcc8f169f0df7e1351c9da698c9",
      "original_line" : 929,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 46,
      "pull_request_review_id" : 1433103480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198071636/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T18:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198071636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198122182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198122182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could also simplify a bit:\r\n\r\n```cpp\r\n    if (est_file.IsNull() || !Write(est_file))\r\n        LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\r\n    else\r\n        LogPrintf(\"Flushed fee estimates to fee_estimates.dat.\\n\");\r\n```",
      "commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "created_at" : "2023-05-18T17:59:26Z",
      "diff_hunk" : "@@ -903,11 +904,16 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198122182",
      "id" : 1198122182,
      "line" : 927,
      "node_id" : "PRRC_kwDOABII585HaeTG",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 914,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 44,
      "pull_request_review_id" : 1433103480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198122182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T18:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198122182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198123417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198123417"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't actually know for sure but couldn't this just be ...?\r\n\r\n```cpp\r\nstatic constexpr std::chrono::hours FEE_FLUSH_INTERVAL{1};\r\n```",
      "commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "created_at" : "2023-05-18T18:00:48Z",
      "diff_hunk" : "@@ -14,12 +14,17 @@\n #include <util/fs.h>\n \n #include <array>\n+#include <chrono>\n #include <map>\n #include <memory>\n #include <set>\n #include <string>\n #include <vector>\n \n+\n+// How often to flush fee estimates to fee_estimates.dat.\n+static constexpr std::chrono::milliseconds FEE_FLUSH_INTERVAL{std::chrono::hours{1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198123417",
      "id" : 1198123417,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII585HaemZ",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 13,
      "pull_request_review_id" : 1433103480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198123417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T18:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198123417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198131760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198131760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think you can use `self.restart_node(0)` here",
      "commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "created_at" : "2023-05-18T18:09:46Z",
      "diff_hunk" : "@@ -290,6 +291,45 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198131760",
      "id" : 1198131760,
      "line" : 300,
      "node_id" : "PRRC_kwDOABII585Hagow",
      "original_commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "original_line" : 300,
      "original_position" : 18,
      "original_start_line" : 299,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : 18,
      "pull_request_review_id" : 1433103480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198131760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 299,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-18T18:15:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198131760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198150716"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198150716"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It could also be `constexpr auto FEE_FLUSH_INTERVAL{1h};`",
      "commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "created_at" : "2023-05-18T18:26:07Z",
      "diff_hunk" : "@@ -14,12 +14,17 @@\n #include <util/fs.h>\n \n #include <array>\n+#include <chrono>\n #include <map>\n #include <memory>\n #include <set>\n #include <string>\n #include <vector>\n \n+\n+// How often to flush fee estimates to fee_estimates.dat.\n+static constexpr std::chrono::milliseconds FEE_FLUSH_INTERVAL{std::chrono::hours{1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198150716",
      "id" : 1198150716,
      "in_reply_to_id" : 1198123417,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII585HalQ8",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 13,
      "pull_request_review_id" : 1433238480,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198150716/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T18:26:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198150716",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198355535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198355535"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for your review, I have fixed it.",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-18T22:16:00Z",
      "diff_hunk" : "@@ -903,11 +904,16 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198355535",
      "id" : 1198355535,
      "in_reply_to_id" : 1198122182,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HbXRP",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 914,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1433525905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198355535/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T22:16:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198355535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198379250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198379250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Still a nub on cpp,\r\n `constexpr auto FEE_FLUSH_INTERVAL{1h};`  does not compile\r\nI added instead `static constexpr std::chrono::hours FEE_FLUSH_INTERVAL{1};`",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-18T23:02:36Z",
      "diff_hunk" : "@@ -14,12 +14,17 @@\n #include <util/fs.h>\n \n #include <array>\n+#include <chrono>\n #include <map>\n #include <memory>\n #include <set>\n #include <string>\n #include <vector>\n \n+\n+// How often to flush fee estimates to fee_estimates.dat.\n+static constexpr std::chrono::milliseconds FEE_FLUSH_INTERVAL{std::chrono::hours{1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198379250",
      "id" : 1198379250,
      "in_reply_to_id" : 1198123417,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HbdDy",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 26,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : null,
      "pull_request_review_id" : 1433560975,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198379250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T23:02:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198379250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198379499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198379499"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks fixed",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-18T23:03:07Z",
      "diff_hunk" : "@@ -290,6 +291,45 @@ def sanity_check_rbf_estimates(self, utxos):\n         est_feerate = node.estimatesmartfee(2)[\"feerate\"]\n         assert_equal(est_feerate, high_feerate_kvb)\n \n+    def test_old_fee_estimate_file(self):\n+        # Get the initial fee rate while node is running\n+        fee_rate = self.nodes[0].estimatesmartfee(1)[\"feerate\"]\n+\n+        # Restart node to ensure fee_estimate.dat file is read\n+        self.stop_node(0)\n+        self.start_node(0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198379499",
      "id" : 1198379499,
      "in_reply_to_id" : 1198131760,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HbdHr",
      "original_commit_id" : "b02e3fc91f4214c486da0ff46e187fab017e11bb",
      "original_line" : 300,
      "original_position" : 18,
      "original_start_line" : 299,
      "path" : "test/functional/feature_fee_estimation.py",
      "position" : null,
      "pull_request_review_id" : 1433561764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198379499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-18T23:03:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198379499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198388360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198388360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ">Mine as well use this constant here for the filename?\r\n\r\n:thinking: it is an anon namespace, not defined in policy/fees_args.h, \r\nI think it is okay as is,  or else\r\n\r\npolicy/fees_args.h\r\n ```\r\nconst char* GetFeeEstimatesFilename();\r\n```\r\npolicy/fees.args.cpp\r\n```\r\nconst char* GetFeeEstimatesFilename() {\r\n    return FEE_ESTIMATES_FILENAME;\r\n}\r\n```\r\npolicy/fees.cpp\r\n```\r\nLogPrintf(\"Flushed fee estimates to %s.\\n\", GetFeeEstimatesFilename());\r\n```\r\nbut if it's possible another way I will be glad to learn how.",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-18T23:22:05Z",
      "diff_hunk" : "@@ -903,11 +904,16 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1198388360",
      "id" : 1198388360,
      "in_reply_to_id" : 1198122182,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HbfSI",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 914,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1433575587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198388360/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T23:22:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198388360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1199014871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199014871"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ok good point I see, well maybe just then...\r\n\r\n\r\n```diff\r\ndiff --git a/src/policy/fees.cpp b/src/policy/fees.cpp\r\nindex 085f938f80..adb0ebc383 100644\r\n--- a/src/policy/fees.cpp\r\n+++ b/src/policy/fees.cpp\r\n@@ -925,7 +925,7 @@ void CBlockPolicyEstimator::FlushFeeEstimates() {\r\n     if (est_file.IsNull() || !Write(est_file)) {\r\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\r\n     } else {\r\n-        LogPrintf(\"Flushed fee estimates to fee_estimates.dat.\\n\");\r\n+        LogPrintf(\"Flushed fee estimates to %s.\", fs::PathToString(m_estimation_filepath));\r\n     }\r\n }\r\n \r\n\r\n```",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-19T14:15:18Z",
      "diff_hunk" : "@@ -903,11 +904,16 @@ CFeeRate CBlockPolicyEstimator::estimateSmartFee(int confTarget, FeeCalculation\n \n void CBlockPolicyEstimator::Flush() {\n     FlushUnconfirmed();\n+    FlushFeeEstimates();\n+}\n \n+void CBlockPolicyEstimator::FlushFeeEstimates() {\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"wb\")};\n     if (est_file.IsNull() || !Write(est_file)) {\n         LogPrintf(\"Failed to write fee estimates to %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));\n+        return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1199014871",
      "id" : 1199014871,
      "in_reply_to_id" : 1198122182,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hd4PX",
      "original_commit_id" : "4614a64bbffd5333cfd9fb78c6530d81c3856901",
      "original_line" : 914,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 1434514052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199014871/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-19T14:15:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199014871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1199078486"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199078486"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in accf995cf095d7ff3d10c0403e70bdbc1273e852\r\n\r\nSeems like the error message here should be something like \"there is no fee estimates file\" instead of \"failed to read\" ?",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-19T15:11:58Z",
      "diff_hunk" : "@@ -546,9 +546,22 @@ CBlockPolicyEstimator::CBlockPolicyEstimator(const fs::path& estimation_filepath\n     shortStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, SHORT_BLOCK_PERIODS, SHORT_DECAY, SHORT_SCALE));\n     longStats = std::unique_ptr<TxConfirmStats>(new TxConfirmStats(buckets, bucketMap, LONG_BLOCK_PERIODS, LONG_DECAY, LONG_SCALE));\n \n-    // If the fee estimation file is present, read recorded estimations\n     AutoFile est_file{fsbridge::fopen(m_estimation_filepath, \"rb\")};\n-    if (est_file.IsNull() || !Read(est_file)) {\n+\n+    // Whenever the fee estimation file is not present return early\n+    if (est_file.IsNull()) {\n+        LogPrintf(\"Failed to read fee estimates from %s. Continue anyway.\\n\", fs::PathToString(m_estimation_filepath));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1199078486",
      "id" : 1199078486,
      "line" : 553,
      "node_id" : "PRRC_kwDOABII585HeHxW",
      "original_commit_id" : "accf995cf095d7ff3d10c0403e70bdbc1273e852",
      "original_line" : 553,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 18,
      "pull_request_review_id" : 1434616046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199078486/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-19T15:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199078486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1199085331"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199085331"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What is the use case for being able to configure the maximum file age?",
      "commit_id" : "473946b05e911fca96a1ec077db19910819e8aed",
      "created_at" : "2023-05-19T15:18:38Z",
      "diff_hunk" : "@@ -186,6 +186,10 @@ class CBlockPolicyEstimator\n     static constexpr double FEE_SPACING = 1.05;\n \n     const fs::path m_estimation_filepath;\n+\n+    /** Fee estimate.dat must not be more than 12 hours old. */\n+    static constexpr std::chrono::hours MAX_FILE_AGE{12};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27622#discussion_r1199085331",
      "id" : 1199085331,
      "in_reply_to_id" : 1196993686,
      "line" : 191,
      "node_id" : "PRRC_kwDOABII585HeJcT",
      "original_commit_id" : "5a41661a118dc526780c006bdf09abcce92e24e5",
      "original_line" : 191,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : 24,
      "pull_request_review_id" : 1434616046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27622",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199085331/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-19T15:20:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199085331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
