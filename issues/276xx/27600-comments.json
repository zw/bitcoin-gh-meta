[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27600).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/27600#pullrequestreview-1431340479) |\n| Stale ACK | [LarryRuane](https://github.com/bitcoin/bitcoin/pull/27600#pullrequestreview-1475451194), [stickies-v](https://github.com/bitcoin/bitcoin/pull/27600#pullrequestreview-1483809327), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/27600#pullrequestreview-1642730712) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28686](https://github.com/bitcoin/bitcoin/pull/28686) (refactor: Split per-peer parts of net module into new node/connection module by ajtowns)\n* [#28464](https://github.com/bitcoin/bitcoin/pull/28464) (net: improve max-connection limits code by mzumsande)\n* [#28463](https://github.com/bitcoin/bitcoin/pull/28463) (p2p: Increase inbound capacity for block-relay only connections by mzumsande)\n* [#27581](https://github.com/bitcoin/bitcoin/pull/27581) (net: Continuous ASMap health check by fjahr)\n* [#27114](https://github.com/bitcoin/bitcoin/pull/27114) (p2p: Allow whitelisting outgoing connections by brunoerg)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-05-08T19:59:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1538963935",
      "id" : 1538963935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585burnf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538963935/reactions"
      },
      "updated_at" : "2023-10-25T10:02:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538963935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1191709646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191709646"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit\r\n```suggestion\r\n        return force ? std::make_optional(last_out.id) : std::nullopt;\r\n```",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-11T21:34:04Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect the 8 nodes with the lowest minimum ping time.\n     // An attacker cannot manipulate this metric without physically moving nodes closer to the target.\n-    EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    last = EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    if (last.has_value()) last_out = last.value();\n     // Protect 4 nodes that most recently sent us novel transactions accepted into our mempool.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect up to 8 non-tx-relay peers that have sent us novel blocks.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n-                       [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n+                              [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect 4 nodes that most recently sent us novel blocks.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect some of the remaining eviction candidates by ratios of desirable\n     // or disadvantaged characteristics.\n-    ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n-\n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    last = ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n+    if (last.has_value()) last_out = last.value();\n+\n+    if (vEvictionCandidates.empty()) {\n+        if (force) {\n+            return last_out.id;\n+        } else {\n+            return std::nullopt;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1191709646",
      "id" : 1191709646,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII585HCAvO",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 234,
      "original_position" : 125,
      "original_start_line" : 230,
      "path" : "src/node/eviction.cpp",
      "position" : 125,
      "pull_request_review_id" : 1423467785,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191709646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 230,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-11T21:58:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191709646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1191732820"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191732820"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure, but IIRC last time I looked RVO wasn't working with a ternary.",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-11T22:01:20Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect the 8 nodes with the lowest minimum ping time.\n     // An attacker cannot manipulate this metric without physically moving nodes closer to the target.\n-    EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    last = EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    if (last.has_value()) last_out = last.value();\n     // Protect 4 nodes that most recently sent us novel transactions accepted into our mempool.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect up to 8 non-tx-relay peers that have sent us novel blocks.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n-                       [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n+                              [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect 4 nodes that most recently sent us novel blocks.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect some of the remaining eviction candidates by ratios of desirable\n     // or disadvantaged characteristics.\n-    ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n-\n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    last = ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n+    if (last.has_value()) last_out = last.value();\n+\n+    if (vEvictionCandidates.empty()) {\n+        if (force) {\n+            return last_out.id;\n+        } else {\n+            return std::nullopt;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1191732820",
      "id" : 1191732820,
      "in_reply_to_id" : 1191709646,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII585HCGZU",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 234,
      "original_position" : 125,
      "original_start_line" : 230,
      "path" : "src/node/eviction.cpp",
      "position" : 125,
      "pull_request_review_id" : 1423506632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191732820/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 230,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-11T22:01:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191732820",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1193951897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193951897"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure this is correct, it ignores the checking of `predicate`?",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-15T14:46:47Z",
      "diff_hunk" : "@@ -73,15 +73,22 @@ struct CompareNodeNetworkTime {\n     };\n };\n \n-//! Sort an array by the specified comparator, then erase the last K elements where predicate is true.\n-template <typename T, typename Comparator>\n-static void EraseLastKElements(\n-    std::vector<T>& elements, Comparator comparator, size_t k,\n+//! Sort an array of NodeEvictionCandidates by the specified comparator, then erase the last K elements where predicate is true.\n+//! Return the last element removed if any.\n+static std::optional<NodeEvictionCandidate> EraseLastKElements(\n+    std::vector<NodeEvictionCandidate>& elements, std::function<bool(NodeEvictionCandidate, NodeEvictionCandidate)> comparator, size_t k,\n     std::function<bool(const NodeEvictionCandidate&)> predicate = [](const NodeEvictionCandidate& n) { return true; })\n {\n     std::sort(elements.begin(), elements.end(), comparator);\n     size_t eraseSize = std::min(k, elements.size());\n+\n+    // Return the last erased element\n+    std::optional<NodeEvictionCandidate> last_out{std::nullopt};\n+    if (eraseSize > 0) last_out = elements.at(elements.size() - eraseSize);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1193951897",
      "id" : 1193951897,
      "line" : 87,
      "node_id" : "PRRC_kwDOABII585HKkKZ",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 87,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 19,
      "pull_request_review_id" : 1426738328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193951897/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193951897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194849842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194849842"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An alternative approach to the duplication of these lines is to just store all the return values in a vector, like:\r\n\r\n```c++\r\nstd::vector<std::optional<NodeEvictionCandidate>> removed;\r\n...\r\nremoved.emplace_back(EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4));\r\n```\r\n\r\nand then just return the last one at the end?",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-16T09:01:23Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194849842",
      "id" : 1194849842,
      "line" : 205,
      "node_id" : "PRRC_kwDOABII585HN_Yy",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 205,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 88,
      "pull_request_review_id" : 1426738328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194849842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194849842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194850365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194850365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An alternative approach to the duplication of these lines is to just store all the return values in a vector, like:\r\n\r\n```c++\r\nstd::vector<std::optional<NodeEvictionCandidate>> removed;\r\n...\r\nremoved.emplace_back(EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4));\r\n```\r\n\r\nand then just return the last one at the end?",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-16T09:01:47Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194850365",
      "id" : 1194850365,
      "line" : 205,
      "node_id" : "PRRC_kwDOABII585HN_g9",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 205,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 88,
      "pull_request_review_id" : 1426738328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194850365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194850365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194857629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194857629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Returning just the last removed element feels like a very bespoke and perhaps unintuitive interface to me. I know we don't currently need it, but perhaps it's worth generalizing this a bit more and returning all the removed elements instead of just the last one? For the callsite, it's trivial to keep just the last one? Just thinking out loud, perhaps this is difficult to do without an unacceptable overhead in terms of allocations etc.",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-16T09:07:36Z",
      "diff_hunk" : "@@ -73,15 +73,22 @@ struct CompareNodeNetworkTime {\n     };\n };\n \n-//! Sort an array by the specified comparator, then erase the last K elements where predicate is true.\n-template <typename T, typename Comparator>\n-static void EraseLastKElements(\n-    std::vector<T>& elements, Comparator comparator, size_t k,\n+//! Sort an array of NodeEvictionCandidates by the specified comparator, then erase the last K elements where predicate is true.\n+//! Return the last element removed if any.\n+static std::optional<NodeEvictionCandidate> EraseLastKElements(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194857629",
      "id" : 1194857629,
      "line" : 78,
      "node_id" : "PRRC_kwDOABII585HOBSd",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 78,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 10,
      "pull_request_review_id" : 1426738328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194857629/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194857629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194860446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194860446"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit (and in quite a few other places):\r\n```suggestion\r\n    const std::optional<NodeId> node_id_to_evict{SelectNodeToEvict(std::move(vEvictionCandidates), force)};\r\n```",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-16T09:09:56Z",
      "diff_hunk" : "@@ -925,7 +925,7 @@ bool CConnman::AttemptToEvictConnection()\n             vEvictionCandidates.push_back(candidate);\n         }\n     }\n-    const std::optional<NodeId> node_id_to_evict = SelectNodeToEvict(std::move(vEvictionCandidates));\n+    const std::optional<NodeId> node_id_to_evict = SelectNodeToEvict(std::move(vEvictionCandidates), force);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194860446",
      "id" : 1194860446,
      "line" : 928,
      "node_id" : "PRRC_kwDOABII585HOB-e",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 928,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_review_id" : 1426738328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194860446/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194860446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194866624"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194866624"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "All the `last_out` assignments are behind an `if` condition, I think this theoretically can be a zero-initialized `NodeEvictionCandidate`?",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-16T09:14:49Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect the 8 nodes with the lowest minimum ping time.\n     // An attacker cannot manipulate this metric without physically moving nodes closer to the target.\n-    EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    last = EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    if (last.has_value()) last_out = last.value();\n     // Protect 4 nodes that most recently sent us novel transactions accepted into our mempool.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect up to 8 non-tx-relay peers that have sent us novel blocks.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n-                       [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n+                              [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect 4 nodes that most recently sent us novel blocks.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect some of the remaining eviction candidates by ratios of desirable\n     // or disadvantaged characteristics.\n-    ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n-\n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    last = ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n+    if (last.has_value()) last_out = last.value();\n+\n+    if (vEvictionCandidates.empty()) {\n+        if (force) {\n+            return last_out.id;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194866624",
      "id" : 1194866624,
      "line" : 231,
      "node_id" : "PRRC_kwDOABII585HODfA",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 231,
      "original_position" : 122,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 122,
      "pull_request_review_id" : 1426738328,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194866624/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194866624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194897930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194897930"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think it would be nice to document the effect of `force` both here and for `SelectNodeToEvict`",
      "commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "created_at" : "2023-05-16T09:40:06Z",
      "diff_hunk" : "@@ -982,7 +982,7 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    bool AttemptToEvictConnection(bool force);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1194897930",
      "id" : 1194897930,
      "line" : 985,
      "node_id" : "PRRC_kwDOABII585HOLIK",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 985,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_review_id" : 1428164155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194897930/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T09:40:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1194897930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1195276803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195276803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not really familiar with this stuff, but that seems to be an MSVC bug? https://stackoverflow.com/questions/55152552/visual-studio-not-performing-rvo-when-ternary-operator-is-used-and-move-copy-cto\r\n\r\nWe do ternary operators in plenty of places, don't think we need to workaround this?",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-16T14:42:16Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect the 8 nodes with the lowest minimum ping time.\n     // An attacker cannot manipulate this metric without physically moving nodes closer to the target.\n-    EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    last = EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    if (last.has_value()) last_out = last.value();\n     // Protect 4 nodes that most recently sent us novel transactions accepted into our mempool.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect up to 8 non-tx-relay peers that have sent us novel blocks.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n-                       [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n+                              [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect 4 nodes that most recently sent us novel blocks.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect some of the remaining eviction candidates by ratios of desirable\n     // or disadvantaged characteristics.\n-    ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n-\n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    last = ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n+    if (last.has_value()) last_out = last.value();\n+\n+    if (vEvictionCandidates.empty()) {\n+        if (force) {\n+            return last_out.id;\n+        } else {\n+            return std::nullopt;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1195276803",
      "id" : 1195276803,
      "in_reply_to_id" : 1191709646,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HPnoD",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 234,
      "original_position" : 125,
      "original_start_line" : 230,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1428756837,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195276803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-16T14:42:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195276803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1195757487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195757487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Does RVO even apply here? I thought it applies to complex structures, a large vector being the canonical example, where we don't want to copy every element. But here we're just returning a `NodeId` which is a `int64_t`, wrapped by `std::optional`. I don't think there's any savings by moving instead of copying one of these.",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-16T22:48:35Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect the 8 nodes with the lowest minimum ping time.\n     // An attacker cannot manipulate this metric without physically moving nodes closer to the target.\n-    EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    last = EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    if (last.has_value()) last_out = last.value();\n     // Protect 4 nodes that most recently sent us novel transactions accepted into our mempool.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect up to 8 non-tx-relay peers that have sent us novel blocks.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n-                       [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n+                              [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect 4 nodes that most recently sent us novel blocks.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect some of the remaining eviction candidates by ratios of desirable\n     // or disadvantaged characteristics.\n-    ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n-\n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    last = ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n+    if (last.has_value()) last_out = last.value();\n+\n+    if (vEvictionCandidates.empty()) {\n+        if (force) {\n+            return last_out.id;\n+        } else {\n+            return std::nullopt;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1195757487",
      "id" : 1195757487,
      "in_reply_to_id" : 1191709646,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HRc-v",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 234,
      "original_position" : 125,
      "original_start_line" : 230,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1429544123,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195757487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-16T22:48:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195757487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1196647358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196647358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    // Return the last erased (not-to-be-evicted) element\r\n```",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-17T14:52:09Z",
      "diff_hunk" : "@@ -73,15 +73,22 @@ struct CompareNodeNetworkTime {\n     };\n };\n \n-//! Sort an array by the specified comparator, then erase the last K elements where predicate is true.\n-template <typename T, typename Comparator>\n-static void EraseLastKElements(\n-    std::vector<T>& elements, Comparator comparator, size_t k,\n+//! Sort an array of NodeEvictionCandidates by the specified comparator, then erase the last K elements where predicate is true.\n+//! Return the last element removed if any.\n+static std::optional<NodeEvictionCandidate> EraseLastKElements(\n+    std::vector<NodeEvictionCandidate>& elements, std::function<bool(NodeEvictionCandidate, NodeEvictionCandidate)> comparator, size_t k,\n     std::function<bool(const NodeEvictionCandidate&)> predicate = [](const NodeEvictionCandidate& n) { return true; })\n {\n     std::sort(elements.begin(), elements.end(), comparator);\n     size_t eraseSize = std::min(k, elements.size());\n+\n+    // Return the last erased element",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1196647358",
      "id" : 1196647358,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HU2O-",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 85,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1430899133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196647358/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-10T18:20:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196647358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1196896354"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196896354"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, good point @LarryRuane. I didn't realize `NodeId` was just a typedef for `int64_t`. I think that entirely resolves it indeed.",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T18:13:40Z",
      "diff_hunk" : "@@ -172,39 +183,56 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // we want to protect based on uptime accordingly.\n     assert(num_protected == initial_size - eviction_candidates.size());\n     const size_t remaining_to_protect{total_protect_size - num_protected};\n-    EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    auto last = EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n+    if (last.has_value()) last_out = last;\n+    return last_out;\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Keep track of the last protected candidate so we can evict it if forced\n+    NodeEvictionCandidate last_out;\n+\n     // Deterministically select 4 peers to protect by netgroup.\n     // An attacker cannot predict which netgroups will be protected\n-    EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    auto last = EraseLastKElements(vEvictionCandidates, CompareNetGroupKeyed, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect the 8 nodes with the lowest minimum ping time.\n     // An attacker cannot manipulate this metric without physically moving nodes closer to the target.\n-    EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    last = EraseLastKElements(vEvictionCandidates, ReverseCompareNodeMinPingTime, 8);\n+    if (last.has_value()) last_out = last.value();\n     // Protect 4 nodes that most recently sent us novel transactions accepted into our mempool.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeTXTime, 4);\n+    if (last.has_value()) last_out = last.value();\n     // Protect up to 8 non-tx-relay peers that have sent us novel blocks.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n-                       [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockRelayOnlyTime, 8,\n+                              [](const NodeEvictionCandidate& n) { return !n.m_relay_txs && n.fRelevantServices; });\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect 4 nodes that most recently sent us novel blocks.\n     // An attacker cannot manipulate this metric without performing useful work.\n-    EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    last = EraseLastKElements(vEvictionCandidates, CompareNodeBlockTime, 4);\n+    if (last.has_value()) last_out = last.value();\n \n     // Protect some of the remaining eviction candidates by ratios of desirable\n     // or disadvantaged characteristics.\n-    ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n-\n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    last = ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n+    if (last.has_value()) last_out = last.value();\n+\n+    if (vEvictionCandidates.empty()) {\n+        if (force) {\n+            return last_out.id;\n+        } else {\n+            return std::nullopt;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1196896354",
      "id" : 1196896354,
      "in_reply_to_id" : 1191709646,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HVzBi",
      "original_commit_id" : "e71d495ffbda3bc072bbaecd7580809d5087f9e6",
      "original_line" : 234,
      "original_position" : 125,
      "original_start_line" : 230,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196896354/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196896354",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@stickies-v @mzumsande thanks for your review and feedback, I refactored the PR so we evict a random peer when forced if all other peers are protected. It is MUCH simpler ;-)\r\n",
      "created_at" : "2023-05-17T20:18:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1552010405",
      "id" : 1552010405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585cgcyl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1552010405/reactions"
      },
      "updated_at" : "2023-05-17T20:19:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1552010405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197024384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197024384"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This block can be skipped if `!force`\r\n\r\n```suggestion\r\n    if (vEvictionCandidates.size() > 0 && force) {\r\n```",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T20:34:01Z",
      "diff_hunk" : "@@ -175,14 +176,22 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Hang on to one random node to evict if forced\n+    std::optional<NodeId> force_evict;\n+    if (vEvictionCandidates.size() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197024384",
      "id" : 1197024384,
      "line" : 189,
      "node_id" : "PRRC_kwDOABII585HWSSA",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 189,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 23,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197024384/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197024384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197025555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197025555"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:\r\n```suggestion\r\n        size_t randpos{FastRandomContext().randrange(vEvictionCandidates.size())};\r\n```",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T20:35:04Z",
      "diff_hunk" : "@@ -175,14 +176,22 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Hang on to one random node to evict if forced\n+    std::optional<NodeId> force_evict;\n+    if (vEvictionCandidates.size() > 0) {\n+        FastRandomContext rng;\n+        size_t randpos = rng.randrange(vEvictionCandidates.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197025555",
      "id" : 1197025555,
      "line" : 191,
      "node_id" : "PRRC_kwDOABII585HWSkT",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 191,
      "original_position" : 25,
      "original_start_line" : 190,
      "path" : "src/node/eviction.cpp",
      "position" : 25,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197025555/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 190,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197025555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197030985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197030985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since `force_evict` is already an `optional` defaulting to `nullopt`, this can be simplified in conjunction with [my other suggestion](https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197024384).\r\n```suggestion\r\n    if (vEvictionCandidates.empty()) return force_evict;\r\n```",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T20:41:40Z",
      "diff_hunk" : "@@ -204,7 +213,8 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // or disadvantaged characteristics.\n     ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n \n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    if (vEvictionCandidates.empty())\n+        return force ? force_evict : std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197030985",
      "id" : 1197030985,
      "line" : 217,
      "node_id" : "PRRC_kwDOABII585HWT5J",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 217,
      "original_position" : 38,
      "original_start_line" : 216,
      "path" : "src/node/eviction.cpp",
      "position" : 38,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197030985/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 216,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-17T21:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197030985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197031821"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197031821"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Documenting the `force` parameter (or linking to `AttemptToEvictConnection`) would be helpful I think.",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T20:42:42Z",
      "diff_hunk" : "@@ -39,7 +39,7 @@ struct NodeEvictionCandidate {\n  * ratios of desirable or disadvantaged peers. If any eviction candidates\n  * remain, the selection logic chooses a peer to evict.\n  */\n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates);\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197031821",
      "id" : 1197031821,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII585HWUGN",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 42,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/eviction.h",
      "position" : 5,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197031821/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197031821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197037590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197037590"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Imo, \"find\" makes it sound like this has no side effects, whereas I think this actually does disconnect the node.",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T20:48:03Z",
      "diff_hunk" : "@@ -982,7 +982,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Attempt to find a connected node to disconnect.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197037590",
      "id" : 1197037590,
      "line" : 986,
      "node_id" : "PRRC_kwDOABII585HWVgW",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 986,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197037590/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197037590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197041677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197041677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "suggested rephrasing (although I'm not sure about the \"NoBan\" qualifier, maybe we have a better established term?)\r\n```suggestion\r\n     * @param[in] force     If all connections are otherwise protected, still evict a random inbound NoBan node if it exists\r\n```",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T20:50:59Z",
      "diff_hunk" : "@@ -982,7 +982,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Attempt to find a connected node to disconnect.\n+     * Used to make room for new inbound connections, returns true if successful.\n+     * @param[in] force     Try to evict a random node if all connections are otherwise protected.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197041677",
      "id" : 1197041677,
      "line" : 988,
      "node_id" : "PRRC_kwDOABII585HWWgN",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 988,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 8,
      "pull_request_review_id" : 1431107177,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197041677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T20:57:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197041677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197060760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197060760"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe just move the doc from net.cpp? That's basically what I did in a WIP [branch](https://github.com/mzumsande/bitcoin/commit/1aaa795e3f43caf8aa06331e61b14b777a04a6d9).",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-17T21:15:48Z",
      "diff_hunk" : "@@ -982,7 +982,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Attempt to find a connected node to disconnect.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197060760",
      "id" : 1197060760,
      "in_reply_to_id" : 1197037590,
      "line" : 986,
      "node_id" : "PRRC_kwDOABII585HWbKY",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 986,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 1431664477,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197060760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T21:19:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197060760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197660996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197660996"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure that's a strict improvement? Documenting the interface (i.e. pretty much just the first line of what's in `net.cpp`) seems more appropriate to be in the header indeed, but all the rest sounds more like implementation details that may best be kept close to the source code? \r\n\r\nAlso, my main issue is with (having just) the word \"find\", which to me sounds like there are no side effects.",
      "commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "created_at" : "2023-05-18T10:31:24Z",
      "diff_hunk" : "@@ -982,7 +982,13 @@ class CConnman\n      */\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n-    bool AttemptToEvictConnection();\n+    /**\n+     * Attempt to find a connected node to disconnect.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1197660996",
      "id" : 1197660996,
      "in_reply_to_id" : 1197037590,
      "line" : 986,
      "node_id" : "PRRC_kwDOABII585HYttE",
      "original_commit_id" : "c826187b5070ce89edcde0536183714a1c2e3207",
      "original_line" : 986,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 1432450720,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197660996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T10:31:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197660996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @stickies-v nits addressed! ð ",
      "created_at" : "2023-05-18T14:19:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1553133230",
      "id" : 1553133230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585cku6u",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553133230/reactions"
      },
      "updated_at" : "2023-05-18T14:19:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553133230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1200632788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200632788"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: if `vEvictionCandidates` is empty, there's no point (I think, couldn't see any side effects in `EraseLastKElements` or `ProtectEvictionCandidatesByRatio`) executing the next lines so might as well return early? Unless you think this makes the code less clear?\r\n\r\n```suggestion\r\n    if (vEvictionCandidates.empty()) return std::nullopt;\r\n    std::optional<NodeId> force_evict;\r\n    if (force) {\r\n```",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-22T14:54:27Z",
      "diff_hunk" : "@@ -175,14 +176,21 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Hang on to one random node to evict if forced\n+    std::optional<NodeId> force_evict;\n+    if (vEvictionCandidates.size() > 0 && force) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1200632788",
      "id" : 1200632788,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HkDPU",
      "original_commit_id" : "96b513f605fb2df441b66da583056b1c8acd4dbc",
      "original_line" : 189,
      "original_position" : 23,
      "original_start_line" : 188,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1436822917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200632788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-22T18:19:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200632788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1200865042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200865042"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As you [mentioned](https://bitcoincore.reviews/27600#l-165) in the review club, whitelisting just based on ports enables an attacker that discovered which port(s) are whitelisted to take over all (non-whitelisted) inbound connections slots.\r\n\r\nTherefore, I think we have to be careful not to accidentally lead people to this footgun. Binding to `127.0.0.1` seems much more prudent to not set a bad example.\r\n\r\n```suggestion\r\n        self.restart_node(0, extra_args=['-maxconnections=12', '-whitebind=127.0.0.1:30201'])\r\n```",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-22T18:09:35Z",
      "diff_hunk" : "@@ -122,6 +122,36 @@ def run_test(self):\n         self.log.debug(\"{} protected peers: {}\".format(len(protected_peers), protected_peers))\n         assert evicted_peers[0] not in protected_peers\n \n+        self.log.info(\"Test that whitebind inbounds get extra eviction power\")\n+        # Only allow 1 inbound connection, but set whitebind\n+        self.restart_node(0, extra_args=['-maxconnections=12', '-whitebind=0.0.0.0:30201'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1200865042",
      "id" : 1200865042,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hk78S",
      "original_commit_id" : "96b513f605fb2df441b66da583056b1c8acd4dbc",
      "original_line" : 127,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/p2p_eviction.py",
      "position" : null,
      "pull_request_review_id" : 1436822917,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200865042/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-22T18:19:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200865042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204269104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204269104"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point, although \"if empty, return now\" logic would make sense after each step in this function (why bother calling `EraseLastKElements()` with an empty array?) even without this PR. One thing we could do is add that logic to the beginning of `EraseLastKElements()` itself, but I dunno how much time is really wasted in there (`sort`, `min`, `erase` ... ?)",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-24T14:32:21Z",
      "diff_hunk" : "@@ -175,14 +176,21 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Hang on to one random node to evict if forced\n+    std::optional<NodeId> force_evict;\n+    if (vEvictionCandidates.size() > 0 && force) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204269104",
      "id" : 1204269104,
      "in_reply_to_id" : 1200632788,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hx7Aw",
      "original_commit_id" : "96b513f605fb2df441b66da583056b1c8acd4dbc",
      "original_line" : 189,
      "original_position" : 23,
      "original_start_line" : 188,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1442057981,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204269104/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-24T14:32:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204269104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204313559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204313559"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I had similar considerations to e.g. wrap the `EraseLastKElements` call in a lambda fn, but it's probably not worth the LoC change.\r\n\r\nI think this case is slightly different in that it better highlights that if there are no inbound NoBan peers, the result is always `std::nullopt`.",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-24T14:52:55Z",
      "diff_hunk" : "@@ -175,14 +176,21 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Hang on to one random node to evict if forced\n+    std::optional<NodeId> force_evict;\n+    if (vEvictionCandidates.size() > 0 && force) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204313559",
      "id" : 1204313559,
      "in_reply_to_id" : 1200632788,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HyF3X",
      "original_commit_id" : "96b513f605fb2df441b66da583056b1c8acd4dbc",
      "original_line" : 189,
      "original_position" : 23,
      "original_start_line" : 188,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1442107908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204313559/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-24T14:52:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204313559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204318480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204318480"
         }
      },
      "author_association" : "MEMBER",
      "body" : "good point, i'll add it. one line i think in this case will improve readability",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-24T14:55:19Z",
      "diff_hunk" : "@@ -175,14 +176,21 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // Hang on to one random node to evict if forced\n+    std::optional<NodeId> force_evict;\n+    if (vEvictionCandidates.size() > 0 && force) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204318480",
      "id" : 1204318480,
      "in_reply_to_id" : 1200632788,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HyHEQ",
      "original_commit_id" : "96b513f605fb2df441b66da583056b1c8acd4dbc",
      "original_line" : 189,
      "original_position" : 23,
      "original_start_line" : 188,
      "path" : "src/node/eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1442114071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204318480/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-05-24T14:55:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204318480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204534315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204534315"
         }
      },
      "author_association" : "MEMBER",
      "body" : "updated test and also included warning in release note",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-24T17:18:24Z",
      "diff_hunk" : "@@ -122,6 +122,36 @@ def run_test(self):\n         self.log.debug(\"{} protected peers: {}\".format(len(protected_peers), protected_peers))\n         assert evicted_peers[0] not in protected_peers\n \n+        self.log.info(\"Test that whitebind inbounds get extra eviction power\")\n+        # Only allow 1 inbound connection, but set whitebind\n+        self.restart_node(0, extra_args=['-maxconnections=12', '-whitebind=0.0.0.0:30201'])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204534315",
      "id" : 1204534315,
      "in_reply_to_id" : 1200865042,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hy7wr",
      "original_commit_id" : "96b513f605fb2df441b66da583056b1c8acd4dbc",
      "original_line" : 127,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/p2p_eviction.py",
      "position" : null,
      "pull_request_review_id" : 1442410386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204534315/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-24T17:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204534315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204795533"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204795533"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think \"on local ports\" is unnecessarily restrictive/scary. I think it's still completely fine to whitelist remote addresses, you mostly just want to avoid ranges, right?",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-24T21:52:08Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1204795533",
      "id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585Hz7iN",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1442800192,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204795533/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-24T21:52:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204795533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1205554274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205554274"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@mzumsande what's your opinion on this? Is this PR a big enough change to warrant this kind of warning?",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-25T13:51:30Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1205554274",
      "id" : 1205554274,
      "in_reply_to_id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585H20xi",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1443949800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205554274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-25T13:51:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1205554274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1210400306"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210400306"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not really sure, I've never looked into these options much and don't know about best practices - I think that if you use `-whitebind` with non-local addresses, you'd at least have to make sure that that address is not self-advertised. I guess that this applies more to `-whitebind` than `-whitelist`, so that the preferred approach in case of a non-local connection would be to use `-whitelist`?\r\nfyi @vasild, do you have an opinion on this?",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-30T14:47:41Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1210400306",
      "id" : 1210400306,
      "in_reply_to_id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585IJT4y",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1451147633,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210400306/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-30T14:47:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210400306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1210427226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210427226"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's a good point, `whitelist` is harder to attack than `whitebind` because the attacker would have to spoof their origin IP repeatedly to fill up your inbounds. If a user `whitebind`'s a port and an attacker figures out that port numnber, they can trivially evict all your other inbounds",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-05-30T15:06:41Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1210427226",
      "id" : 1210427226,
      "in_reply_to_id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585IJada",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1451196011,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210427226/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-30T15:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210427226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1213318442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213318442"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree with what you say above - `whitebind` on publicly accessible address:port with this new permission sounds bad. Similar with `whitelist` - if a range is used.\r\n\r\nThis PR currently expands the semantic of the `noban` permission. This will affect existent setups that already use it. Would it make sense to introduce a new permisson, separate from `noban`? I mean - now if somebody is running `-whitebind=noban@publicaddr:port` then a bad actor could cause harm on `master`, but even more harm with this PR.",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-06-01T15:18:06Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1213318442",
      "id" : 1213318442,
      "in_reply_to_id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585IUcUq",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1455736043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213318442/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-01T15:18:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213318442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1214589081"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214589081"
         }
      },
      "author_association" : "MEMBER",
      "body" : "interesting idea, so we could add `NetPermissionFlags::NoBanForce` or something. The danger will still be present for users of the permission, but existing users of `NoBan` wouldn't have to worry. And since `NoBan` is a default of `whitebind` it'll require more user attention anyway to use the more dangerous option.\r\n\r\nIn that case, the release note should still warn the user about using `NoBanForce` (or whatever we call it) but that warning can just be general, like, keep an eye on your netinfo if you do this. As opposed to just recommending only setting local addresses with whitebind",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-06-02T16:35:01Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1214589081",
      "id" : 1214589081,
      "in_reply_to_id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585IZSiZ",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1457982087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214589081/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T16:35:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214589081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Please consider editing the description slightly, if my understanding is correct.\r\n\r\n>With this PR, if the inbound connection is on our whitelist we start the eviction process by selecting a random unprotected peer.\r\n\r\nAt this point in the process, where we choose a random peer, we're considering _all_ (inbound, not noban) peers, is that correct? They are all (other than outbound or noban) \"unprotected\" because we haven't protected any of them yet. So maybe this should say, \"... selecting a random peer\" or \"... selecting a random inbound peer\" -- because we may randomly choose a peer that _ends up_ being protected, or not protected. That would make this PR easier for me to understand.\r\n\r\nI do think the updated algorithm is very elegant (great suggestion, @mzumsande). It chooses a random peer, which _may_ end up being erased from the eviction candidate list, _or may not_, but we don't care either way; we evict it if we need to, all the better if it actually did not get protected (but, again, we don't care).\r\n\r\nBy the way, I'm going to highlight this PR in the [Optech newsletter](https://bitcoinops.org/en/newsletters/) next week, that's why I'm particularly interested in making sure I understand it.",
      "created_at" : "2023-06-10T16:52:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1585733171",
      "id" : 1585733171,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585ehF4z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585733171/reactions"
      },
      "updated_at" : "2023-06-10T16:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585733171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1225488646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225488646"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@vasild \r\n>This PR currently expands the semantic of the `noban` permission\r\n\r\nCould you please elaborate on this point? I thought that with this PR, `noban` nodes are still [completely protected](https://github.com/bitcoin/bitcoin/pull/27600/files#diff-2404112ebf57bee5f9a16f1a6e1ecfc27a981d37a1c0ff202b4cd9bdfa3e48ccR183) (they are removed from the eviction candidates list before the random node is chosen). But it's certain that I'm missing something. Thanks.",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-06-10T17:47:19Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1225488646",
      "id" : 1225488646,
      "in_reply_to_id" : 1204795533,
      "line" : 8,
      "node_id" : "PRRC_kwDOABII585JC3kG",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : 8,
      "pull_request_review_id" : 1430899133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225488646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-10T18:20:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225488646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1225492297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225492297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps insert a comment before this line `// This may still return std::nullopt`",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-06-10T17:53:44Z",
      "diff_hunk" : "@@ -204,7 +215,7 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // or disadvantaged characteristics.\n     ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n \n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    if (vEvictionCandidates.empty()) return force_evict;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1225492297",
      "id" : 1225492297,
      "line" : 218,
      "node_id" : "PRRC_kwDOABII585JC4dJ",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 218,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 39,
      "pull_request_review_id" : 1430899133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225492297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-10T18:20:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225492297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1225502218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225502218"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not a fan of default arguments; consider making this not have a default. It makes sense if there are many existing calls to a function and you don't want to touch them all, but there's only one call to this function in production code. You would have to touch about 6 call sites in test code, but that's not too bad. The reason I'm not a fan of default arguments is that they hide something that may be helpful to see when just looking at the call site. (You might think, \"Oh, it's possible that eviction can be 'forced', what does that mean?) But this is an optional suggestion, fine if you leave it as-is, just something to consider.",
      "commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "created_at" : "2023-06-10T18:17:02Z",
      "diff_hunk" : "@@ -38,8 +38,10 @@ struct NodeEvictionCandidate {\n  * fixed numbers of desirable peers per various criteria, followed by (mostly)\n  * ratios of desirable or disadvantaged peers. If any eviction candidates\n  * remain, the selection logic chooses a peer to evict.\n+ * @param[in]   force   Attempt to evict a random peer if no candidates\n+ *                      are available. (see CConman::AttemptToEvictConnection())\n  */\n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates);\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1225502218",
      "id" : 1225502218,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585JC64K",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 44,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/eviction.h",
      "position" : 8,
      "pull_request_review_id" : 1430899133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225502218/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-10T18:20:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225502218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Even though not needed for this PR, you may want to consider adding a commit to remove the unnecessary templating. It's perfectly reasonable not to make this change in this PR, but I thought I'd document it just in case; I do think it makes the code easier to understand.\r\n```\r\n--- a/src/node/eviction.cpp\r\n+++ b/src/node/eviction.cpp\r\n@@ -74,9 +74,10 @@ struct CompareNodeNetworkTime {\r\n };\r\n \r\n //! Sort an array by the specified comparator, then erase the last K elements where predicate is true.\r\n-template <typename T, typename Comparator>\r\n static void EraseLastKElements(\r\n-    std::vector<T>& elements, Comparator comparator, size_t k,\r\n+    std::vector<NodeEvictionCandidate>& elements,\r\n+    std::function<bool(const NodeEvictionCandidate&, const NodeEvictionCandidate&)> comparator,\r\n+    size_t k,\r\n     std::function<bool(const NodeEvictionCandidate&)> predicate = [](const NodeEvictionCandidate& n) { return true; })\r\n {\r\n     std::sort(elements.begin(), elements.end(), comparator);\r\n```",
      "created_at" : "2023-06-10T20:00:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1585793347",
      "id" : 1585793347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585ehUlD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585793347/reactions"
      },
      "updated_at" : "2023-06-10T20:00:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585793347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@LarryRuane thanks for reviewing. I actually had removed the templating in the [very first version](https://github.com/bitcoin/bitcoin/compare/e71d495ffbda3bc072bbaecd7580809d5087f9e6..c826187b5070ce89edcde0536183714a1c2e3207#diff-2404112ebf57bee5f9a16f1a6e1ecfc27a981d37a1c0ff202b4cd9bdfa3e48ccL77) of this branch but after changing the approach I just left it alone. The function is written like a generic utility function, even though we don't currently use it for any other vectors. So I think the function could go as written into a util.cpp or something, in a future PR ?",
      "created_at" : "2023-06-10T20:57:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1585814637",
      "id" : 1585814637,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585ehZxt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585814637/reactions"
      },
      "updated_at" : "2023-06-10T20:57:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585814637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1226868475"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226868475"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@LarryRuane you are correct but what we are changing (in the current state of this branch) is that `noban` nodes can now force disconnection of other peers. Since many users may already have `noban` set, maybe even for a large range of IPs, this branch would introduce a new vulnerability they may not be aware of. Because of that I think it does make more sense to specify a new permission so users can narrow the attack surface",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-12T15:41:00Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- Inbound connections from hosts protected by `whitebind` or `whitelist`\n+  permissions will now be more likely to connect even if `maxconnections` is\n+  reached and the node's inbound slots are full. Because this is achieved by\n+  more aggressively finding a current connection to evict, users should take\n+  care only to set these permissions on local ports that attackers can not",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1226868475",
      "id" : 1226868475,
      "in_reply_to_id" : 1204795533,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JIIb7",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/release-notes-27600.md",
      "position" : null,
      "pull_request_review_id" : 1475235483,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226868475/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T15:41:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226868475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1226882383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226882383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure!",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-12T15:52:19Z",
      "diff_hunk" : "@@ -204,7 +215,7 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // or disadvantaged characteristics.\n     ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n \n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    if (vEvictionCandidates.empty()) return force_evict;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1226882383",
      "id" : 1226882383,
      "in_reply_to_id" : 1225492297,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII585JIL1P",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 219,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 40,
      "pull_request_review_id" : 1475255926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226882383/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T15:52:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226882383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1226883074"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226883074"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok I like this, will do",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-12T15:52:54Z",
      "diff_hunk" : "@@ -38,8 +38,10 @@ struct NodeEvictionCandidate {\n  * fixed numbers of desirable peers per various criteria, followed by (mostly)\n  * ratios of desirable or disadvantaged peers. If any eviction candidates\n  * remain, the selection logic chooses a peer to evict.\n+ * @param[in]   force   Attempt to evict a random peer if no candidates\n+ *                      are available. (see CConman::AttemptToEvictConnection())\n  */\n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates);\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1226883074",
      "id" : 1226883074,
      "in_reply_to_id" : 1225502218,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JIMAC",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 44,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/eviction.h",
      "position" : null,
      "pull_request_review_id" : 1475256980,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226883074/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T15:52:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226883074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@LarryRuane updated PR description to clarify where we get the random peer, added comment about the possible nullopt return value, and removed the default `force` value in `SelectNodeToEvict()`",
      "created_at" : "2023-06-12T16:05:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1587634263",
      "id" : 1587634263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585eoWBX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587634263/reactions"
      },
      "updated_at" : "2023-06-12T16:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587634263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@vasild @mzumsande Added a commit that restricts the aggressive eviction to new net permission `ForceInbound` which leaves `NoBan` unchanged.",
      "created_at" : "2023-06-12T17:11:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1587736907",
      "id" : 1587736907,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585eovFL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587736907/reactions"
      },
      "updated_at" : "2023-06-12T17:11:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587736907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1227005332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227005332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(I didn't test that this is okay)\r\n```suggestion\r\n    const std::optional<NodeId> node_to_evict = SelectNodeToEvict(std::move(eviction_candidates), /*force=*/fuzzed_data_provider.ConsumeBool());\r\n```",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-12T17:22:26Z",
      "diff_hunk" : "@@ -40,7 +40,7 @@ FUZZ_TARGET(node_eviction)\n     // Make a copy since eviction_candidates may be in some valid but otherwise\n     // indeterminate state after the SelectNodeToEvict(&&) call.\n     const std::vector<NodeEvictionCandidate> eviction_candidates_copy = eviction_candidates;\n-    const std::optional<NodeId> node_to_evict = SelectNodeToEvict(std::move(eviction_candidates));\n+    const std::optional<NodeId> node_to_evict = SelectNodeToEvict(std::move(eviction_candidates), /*force=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1227005332",
      "id" : 1227005332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JIp2U",
      "original_commit_id" : "2a6a981e4d892c3d7196ddce54471350950affc7",
      "original_line" : 43,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/node_eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1475451194,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227005332/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T17:22:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1227005332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1229863049"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229863049"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: the capitalized spelling is an internal implementation detail, would stick to `forceinbound` and `noban` here\r\n```suggestion\r\n- A new net permission `forceinbound` (set with `-whitelist=forceinbound@...`\r\n  or `-whitebind=forceinbound@...`) is introduced that extends `noban` permissions.\r\n  Inbound connections from hosts protected by `forceinbound` will now be more\r\n```",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-14T16:06:32Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- A new net permission `ForceInbound` (set with `-whitelist=forceinbound@...`\n+  or `-whitebind=forceinbound@...`) is introduced that extends `NoBan` permissions.\n+  Inbound connections from hosts protected by `ForceInbound` will now be more",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1229863049",
      "id" : 1229863049,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JTjiJ",
      "original_commit_id" : "2a6a981e4d892c3d7196ddce54471350950affc7",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : 4,
      "path" : "doc/release-notes-27600.md",
      "position" : null,
      "pull_request_review_id" : 1479839125,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229863049/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-14T16:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229863049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1232295901"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232295901"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done, thanks",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-16T14:02:59Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+P2P\n+---\n+\n+- A new net permission `ForceInbound` (set with `-whitelist=forceinbound@...`\n+  or `-whitebind=forceinbound@...`) is introduced that extends `NoBan` permissions.\n+  Inbound connections from hosts protected by `ForceInbound` will now be more",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1232295901",
      "id" : 1232295901,
      "in_reply_to_id" : 1229863049,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Jc1fd",
      "original_commit_id" : "2a6a981e4d892c3d7196ddce54471350950affc7",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : 4,
      "path" : "doc/release-notes-27600.md",
      "position" : null,
      "pull_request_review_id" : 1483582763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232295901/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-16T14:02:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232295901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1232391250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232391250"
         }
      },
      "author_association" : "MEMBER",
      "body" : "yeah thanks good idea",
      "commit_id" : "c8ce23745a2c314eb30ee01489deead9a281d066",
      "created_at" : "2023-06-16T15:18:20Z",
      "diff_hunk" : "@@ -40,7 +40,7 @@ FUZZ_TARGET(node_eviction)\n     // Make a copy since eviction_candidates may be in some valid but otherwise\n     // indeterminate state after the SelectNodeToEvict(&&) call.\n     const std::vector<NodeEvictionCandidate> eviction_candidates_copy = eviction_candidates;\n-    const std::optional<NodeId> node_to_evict = SelectNodeToEvict(std::move(eviction_candidates));\n+    const std::optional<NodeId> node_to_evict = SelectNodeToEvict(std::move(eviction_candidates), /*force=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1232391250",
      "id" : 1232391250,
      "in_reply_to_id" : 1227005332,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JdMxS",
      "original_commit_id" : "2a6a981e4d892c3d7196ddce54471350950affc7",
      "original_line" : 43,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/fuzz/node_eviction.cpp",
      "position" : null,
      "pull_request_review_id" : 1483748100,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232391250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-16T15:18:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232391250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@stickies-v and @LarryRuane thanks for your review. I re-ordered the commits so the history makes more sense now. Also edited the title and description of the PR since we are adding an optional feature now, not changing any existing behavior. \r\n\r\n`git diff 2a6a981e4d c8ce23745a` reflects the addressed comments, range-diff is screwed up because of commit reordering",
      "created_at" : "2023-06-16T15:37:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1594884847",
      "id" : 1594884847,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585fEALv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1594884847/reactions"
      },
      "updated_at" : "2023-06-16T15:37:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1594884847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Would be better to score the peers rather than choose one at random.",
      "created_at" : "2023-06-23T16:59:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1604556863",
      "id" : 1604556863,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585fo5g_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604556863/reactions"
      },
      "updated_at" : "2023-06-23T16:59:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604556863",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Would be better to score the peers rather than choose one at random.\r\n\r\nI had logic for this initially but preferred [this suggestion](https://github.com/bitcoin/bitcoin/pull/27600#pullrequestreview-1431340479) by @mzumsande ",
      "created_at" : "2023-06-23T17:40:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1604613277",
      "id" : 1604613277,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585fpHSd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604613277/reactions"
      },
      "updated_at" : "2023-06-23T17:40:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604613277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@mzumsande This summary looks correct to me. Point (1) is covered by the functional test. You are also right that by default most nodes will not need the flag since there will be enough open slots or evictable peers.\r\n\r\nI think the use case highlighted in the issue (as well as my own use case) is more about \"personal\" nodes or limited-resource nodes, where max connections are more limited but we still always want our light clients to be able to connect.",
      "created_at" : "2023-07-05T16:06:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1622067241",
      "id" : 1622067241,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585grsgp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622067241/reactions"
      },
      "updated_at" : "2023-07-05T16:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622067241",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Consider when a malicious Internet provider or something can request the `forceinbound` IP address. \r\n\r\nDoes this PR open any fundamentally new risk in this case? I'm thinking of disrupting the network by causing many disconnections if the `forceinbound` practice is broad.\r\n\r\nThis probably depends on whether it's possible to take multiple slots from the same `forceinbound` IP (or, rather, initiate multiple evictions), which I'm not 100% sure about.\r\n\r\nIf my suspicions are correct, this might better wait for authenticated connections...",
      "created_at" : "2023-07-25T10:02:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1649517478",
      "id" : 1649517478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585iUaOm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649517478/reactions"
      },
      "updated_at" : "2023-07-25T10:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649517478",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks so much for taking a look Gleb and for your insight, yeah I have the same concerns. That attack vector is not super trivial, the attacker needs to both learn and then spoof the protected IP range. The release notes could recommend only using ranges for local subnets, or we could enforce that in the code. We could also change it so`forceinbound` does not evict existing peers but *may* add connections beyond the maximum, or set another internal limit just for `forceinbound`\r\n",
      "created_at" : "2023-07-25T11:26:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1649649475",
      "id" : 1649649475,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585iU6dD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649649475/reactions"
      },
      "updated_at" : "2023-07-25T11:26:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649649475",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">the attacker needs to both learn and then spoof the protected IP range\r\n\r\nI think a malicious ISP gets that trivially (at least in the pre-BIP324 world) by simply monitoring the traffic.\r\n\r\nIn theory, specifying \"forceinbound=iprange;n_extra_slots\" instead of eviction is probably a good idea, but I'm not sure how ugly the code will look like. I remember max_connections stuff is already sophisticated :(",
      "created_at" : "2023-07-26T09:02:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1651285875",
      "id" : 1651285875,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585ibJ9z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1651285875/reactions"
      },
      "updated_at" : "2023-07-26T09:02:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1651285875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I guess allowing more connections beyond the max is a DoS vector, which could potentially crash a node and break all existing connections anyway... hm.",
      "created_at" : "2023-07-26T15:51:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1652089161",
      "id" : 1652089161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585ieOFJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1652089161/reactions"
      },
      "updated_at" : "2023-07-26T15:51:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1652089161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@pinheadmz In the example I had above `n_extra_slots` controls how many extra connections you allow so it should be safe.",
      "created_at" : "2023-07-27T09:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1653257672",
      "id" : 1653257672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585iirXI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653257672/reactions"
      },
      "updated_at" : "2023-07-27T09:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653257672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@naumenkogs I added one more commit that limits the number of simultaneous forced-inbound connections to 8. I didn't add it as an init option yet but we could if you like that approach. Although I think it should be set by a separate argument like `-maxforceinbound` instead of adding another syntactic element to the `whitebind` setting.\r\n\r\nA connection only counts as forced-inbound if it succeeded in evicting another peer, and that is marked by a new bool in `CNodeOptions`",
      "created_at" : "2023-07-28T20:24:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1656289233",
      "id" : 1656289233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585iuPfR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1656289233/reactions"
      },
      "updated_at" : "2023-07-28T20:30:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1656289233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@pinheadmz yeah this is probably the best attempt at minimizing the problem I mentioned. Whether it's satisfactory is still at question :) I'm looking forward to seeing what others think.",
      "created_at" : "2023-07-31T09:44:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1658035143",
      "id" : 1658035143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585i05vH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658035143/reactions"
      },
      "updated_at" : "2023-07-31T09:44:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658035143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> this might better wait for authenticated connections\r\n\r\nI2P and CJDNS connections are already authenticated. Addresses in those networks represent the node's public key and connections have a source address. Thus to spoof, one would need to steal the private key from its owner.",
      "created_at" : "2023-07-31T11:04:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1658150572",
      "id" : 1658150572,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585i1V6s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658150572/reactions"
      },
      "updated_at" : "2023-07-31T11:04:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658150572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1336226028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336226028"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was wondering if it might be nice to add a test which showed a previously-protected connection, e.g. a single Tor connection, being disconnected when a `forceinbound` connection from the `whitebind` port arrives. But as our test P2P connections already originate from `localhost` (127.0.0.1) my understanding is that these already count as a \"previously-protected\" group (as they might be an inbound Tor peer), so perhaps not necessary...",
      "commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "created_at" : "2023-09-25T18:02:50Z",
      "diff_hunk" : "@@ -122,6 +122,40 @@ def run_test(self):\n         self.log.debug(\"{} protected peers: {}\".format(len(protected_peers), protected_peers))\n         assert evicted_peers[0] not in protected_peers\n \n+        self.log.info(\"Test that whitebind inbounds get extra eviction power\")\n+        # Only allow 1 inbound connection, but set whitebind\n+        self.restart_node(0, extra_args=['-maxconnections=12', '-whitebind=127.0.0.1:30201', '-whitebind=forceinbound@127.0.0.1:30202'])\n+        self.log.debug(\"Connect 1 peer\")\n+        node.add_p2p_connection(P2PInterface())\n+\n+        # Create a peer that expects to be rejected\n+        class RejectedPeer(P2PInterface):\n+            def connection_lost(self, exc):\n+                return\n+\n+        self.log.debug(\"Generic inbound gets rejected when full\")\n+        with node.assert_debug_log([\"failed to find an eviction candidate - connection dropped (full)\"]):\n+            node.add_p2p_connection(RejectedPeer(), wait_for_verack=False)\n+\n+        self.log.debug(\"Default whitebind inbound gets rejected, even when full\")\n+        with node.assert_debug_log([\"failed to find an eviction candidate - connection dropped (full)\"]):\n+            node.add_p2p_connection(RejectedPeer(), wait_for_verack=False, dstport=30201)\n+\n+        self.log.debug(\"ForceInbound whitebind inbound gets connected, even when full\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1336226028",
      "id" : 1336226028,
      "line" : 147,
      "node_id" : "PRRC_kwDOABII585PpTDs",
      "original_commit_id" : "bd64f1fabb12c8958b140f75f89a42df1858dbc2",
      "original_line" : 144,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/p2p_eviction.py",
      "position" : 26,
      "pull_request_review_id" : 1642730712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336226028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T08:52:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336226028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1336232212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336232212"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: if you touch again you could add here that it's specifically a \"random unprotected inbound peer\", as this is what many users will see in the `--help` (vs the release notes or code comments)",
      "commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "created_at" : "2023-09-25T18:09:13Z",
      "diff_hunk" : "@@ -15,7 +15,8 @@ const std::vector<std::string> NET_PERMISSIONS_DOC{\n     \"relay (relay even in -blocksonly mode, and unlimited transaction announcements)\",\n     \"mempool (allow requesting BIP35 mempool contents)\",\n     \"download (allow getheaders during IBD, no disconnect after maxuploadtarget limit)\",\n-    \"addr (responses to GETADDR avoid hitting the cache and contain random records with the most up-to-date info)\"\n+    \"addr (responses to GETADDR avoid hitting the cache and contain random records with the most up-to-date info)\",\n+    \"forceinbound (when connections are full, attempt to evict a random unprotected peer to open a slot; implies noban)\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1336232212",
      "id" : 1336232212,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII585PpUkU",
      "original_commit_id" : "9190383b5e890e240ca1cb2a838ac1144213f156",
      "original_line" : 19,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_permissions.cpp",
      "position" : 6,
      "pull_request_review_id" : 1642730712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336232212/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T08:52:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336232212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1336788735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336788735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "style nit: it's not in our style docs but as I understand it we prefer brace initialization for new code\r\n\r\n```cpp\r\nbool forced_inbound{false};\r\n```",
      "commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "created_at" : "2023-09-26T07:57:09Z",
      "diff_hunk" : "@@ -352,6 +354,8 @@ struct CNodeOptions\n     NetPermissionFlags permission_flags = NetPermissionFlags::None;\n     std::unique_ptr<i2p::sam::Session> i2p_sam_session = nullptr;\n     bool prefer_evict = false;\n+    // True if ForceInbound connection required evicting a peer\n+    bool forced_inbound = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1336788735",
      "id" : 1336788735,
      "line" : 358,
      "node_id" : "PRRC_kwDOABII585Prcb_",
      "original_commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "original_line" : 358,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 14,
      "pull_request_review_id" : 1642730712,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336788735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T08:52:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336788735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1337286866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337286866"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah thanks, will touch this up and in one other place in the top commit",
      "commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "created_at" : "2023-09-26T14:16:03Z",
      "diff_hunk" : "@@ -352,6 +354,8 @@ struct CNodeOptions\n     NetPermissionFlags permission_flags = NetPermissionFlags::None;\n     std::unique_ptr<i2p::sam::Session> i2p_sam_session = nullptr;\n     bool prefer_evict = false;\n+    // True if ForceInbound connection required evicting a peer\n+    bool forced_inbound = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1337286866",
      "id" : 1337286866,
      "in_reply_to_id" : 1336788735,
      "line" : 358,
      "node_id" : "PRRC_kwDOABII585PtWDS",
      "original_commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "original_line" : 358,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 14,
      "pull_request_review_id" : 1644397372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337286866/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T14:16:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337286866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1337293008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337293008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "adding \"inbound\" good idea thanks",
      "commit_id" : "8585fe3f80e6caa88399f19a9db9919ef4cc4e84",
      "created_at" : "2023-09-26T14:19:22Z",
      "diff_hunk" : "@@ -15,7 +15,8 @@ const std::vector<std::string> NET_PERMISSIONS_DOC{\n     \"relay (relay even in -blocksonly mode, and unlimited transaction announcements)\",\n     \"mempool (allow requesting BIP35 mempool contents)\",\n     \"download (allow getheaders during IBD, no disconnect after maxuploadtarget limit)\",\n-    \"addr (responses to GETADDR avoid hitting the cache and contain random records with the most up-to-date info)\"\n+    \"addr (responses to GETADDR avoid hitting the cache and contain random records with the most up-to-date info)\",\n+    \"forceinbound (when connections are full, attempt to evict a random unprotected peer to open a slot; implies noban)\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1337293008",
      "id" : 1337293008,
      "in_reply_to_id" : 1336232212,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII585PtXjQ",
      "original_commit_id" : "9190383b5e890e240ca1cb2a838ac1144213f156",
      "original_line" : 19,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_permissions.cpp",
      "position" : 6,
      "pull_request_review_id" : 1644406614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337293008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T14:19:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337293008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1337546964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337546964"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm trying to figure out if\r\n1. Local peers are protected in any special way (I don't think they are?)\r\n2. Inbound onion connections are considered local (They aren't - inbound onions are identifiable because they bind to a different network port `onion_service_target_port`)\r\n\r\nAnd then, I don't think all onion peers are protected per se but their latency is compensated for in the eviction process:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/c9f288244b8d183e09a917025922b99e3368ef78/src/node/eviction.cpp#L105-L112",
      "commit_id" : "8639a4541421194243862f59a2fc4f3dc30869c6",
      "created_at" : "2023-09-26T17:13:49Z",
      "diff_hunk" : "@@ -122,6 +122,40 @@ def run_test(self):\n         self.log.debug(\"{} protected peers: {}\".format(len(protected_peers), protected_peers))\n         assert evicted_peers[0] not in protected_peers\n \n+        self.log.info(\"Test that whitebind inbounds get extra eviction power\")\n+        # Only allow 1 inbound connection, but set whitebind\n+        self.restart_node(0, extra_args=['-maxconnections=12', '-whitebind=127.0.0.1:30201', '-whitebind=forceinbound@127.0.0.1:30202'])\n+        self.log.debug(\"Connect 1 peer\")\n+        node.add_p2p_connection(P2PInterface())\n+\n+        # Create a peer that expects to be rejected\n+        class RejectedPeer(P2PInterface):\n+            def connection_lost(self, exc):\n+                return\n+\n+        self.log.debug(\"Generic inbound gets rejected when full\")\n+        with node.assert_debug_log([\"failed to find an eviction candidate - connection dropped (full)\"]):\n+            node.add_p2p_connection(RejectedPeer(), wait_for_verack=False)\n+\n+        self.log.debug(\"Default whitebind inbound gets rejected, even when full\")\n+        with node.assert_debug_log([\"failed to find an eviction candidate - connection dropped (full)\"]):\n+            node.add_p2p_connection(RejectedPeer(), wait_for_verack=False, dstport=30201)\n+\n+        self.log.debug(\"ForceInbound whitebind inbound gets connected, even when full\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1337546964",
      "id" : 1337546964,
      "in_reply_to_id" : 1336226028,
      "line" : 147,
      "node_id" : "PRRC_kwDOABII585PuVjU",
      "original_commit_id" : "bd64f1fabb12c8958b140f75f89a42df1858dbc2",
      "original_line" : 147,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/p2p_eviction.py",
      "position" : 26,
      "pull_request_review_id" : 1644807802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337546964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T17:13:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337546964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@willcl-ark thanks for reviewing, addressed your feedback except for the new test but always open to writing more tests so lemme know if you think something is uncovered there.",
      "created_at" : "2023-09-26T17:36:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1735990555",
      "id" : 1735990555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585neR0b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1735990555/reactions"
      },
      "updated_at" : "2023-09-26T17:36:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1735990555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebasing on master hopefully to fix Windows CI failure",
      "created_at" : "2023-09-27T20:07:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1738006993",
      "id" : 1738006993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585nl-HR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738006993/reactions"
      },
      "updated_at" : "2023-09-27T20:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738006993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-03T10:29:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1744684762",
      "id" : 1744684762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585n_cba",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744684762/reactions"
      },
      "updated_at" : "2023-10-03T10:29:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744684762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased on master again, thanks @willcl-ark for your review. Hoping to get some more feedback from @mzumsande and @naumenkogs to proceed, or abandon",
      "created_at" : "2023-10-16T14:33:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1764615634",
      "id" : 1764615634,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585pLeXS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764615634/reactions"
      },
      "updated_at" : "2023-10-16T14:33:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764615634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-11-07T22:45:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1800318123",
      "id" : 1800318123,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585rTqyr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1800318123/reactions"
      },
      "updated_at" : "2023-11-07T22:45:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1800318123",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@pinheadmz Honestly I still struggle to understand what are the practical scenarios of using this. E.g., what could lead to not being able to evict a connection?",
      "created_at" : "2023-11-08T09:54:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1801467007",
      "id" : 1801467007,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585rYDR_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1801467007/reactions"
      },
      "updated_at" : "2023-11-08T09:54:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1801467007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@naumenkogs If the user has *also* set a low `maxconnections` value then [`SelectNodeToEvict()`](https://github.com/bitcoin/bitcoin/blob/19d1ba1b4141f744cca291ff2d99d0b8ffcf946d/src/node/eviction.cpp#L186-L197) might return null.\r\n\r\nQuick math 4+8+4+8+4 = 28 protected nodes. Plus 8 full outbound and 2 block only = 38. So if a user runs a full node on limited hardware (like my Raspberry Pi at home) and have something like `-maxconnections=30` then even with the existing `whitebind` permissions, their privileged node may fail to connect.\r\n\r\nThat being said, it ALSO means that the solution to https://github.com/bitcoin/bitcoin/issues/8798 may be to just ensure `maxconnections` is set > 40. It's been 7 years since that issue was open and I can check with my own (modern) hardware that 40 connections is sane.",
      "created_at" : "2023-11-08T16:30:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#issuecomment-1802246176",
      "id" : 1802246176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27600",
      "node_id" : "IC_kwDOABII585rbBgg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802246176/reactions"
      },
      "updated_at" : "2023-11-08T16:32:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1802246176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387597063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387597063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c5e7e6563201965e88e07aa8da8f26e17fc1b4db\r\n\r\n\"unprotected\" here is sloppy. I'd just drop the comment.",
      "commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "created_at" : "2023-11-09T07:40:26Z",
      "diff_hunk" : "@@ -175,14 +176,24 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // No inbound or unprotected connections left, return early\n+    if (vEvictionCandidates.empty()) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387597063",
      "id" : 1387597063,
      "line" : 188,
      "node_id" : "PRRC_kwDOABII585StQ0H",
      "original_commit_id" : "c5e7e6563201965e88e07aa8da8f26e17fc1b4db",
      "original_line" : 188,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 22,
      "pull_request_review_id" : 1721882872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387597063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T07:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387597063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387598983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387598983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd suggest expanding this comment to explain what exactly happened.",
      "commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "created_at" : "2023-11-09T07:42:39Z",
      "diff_hunk" : "@@ -204,7 +215,7 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     // or disadvantaged characteristics.\n     ProtectEvictionCandidatesByRatio(vEvictionCandidates);\n \n-    if (vEvictionCandidates.empty()) return std::nullopt;\n+    if (vEvictionCandidates.empty()) return force_evict;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387598983",
      "id" : 1387598983,
      "in_reply_to_id" : 1225492297,
      "line" : 219,
      "node_id" : "PRRC_kwDOABII585StRSH",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 219,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 40,
      "pull_request_review_id" : 1721882872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387598983/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T07:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387598983",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387600158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387600158"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This still remains default, no?",
      "commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "created_at" : "2023-11-09T07:43:41Z",
      "diff_hunk" : "@@ -38,8 +38,10 @@ struct NodeEvictionCandidate {\n  * fixed numbers of desirable peers per various criteria, followed by (mostly)\n  * ratios of desirable or disadvantaged peers. If any eviction candidates\n  * remain, the selection logic chooses a peer to evict.\n+ * @param[in]   force   Attempt to evict a random peer if no candidates\n+ *                      are available. (see CConman::AttemptToEvictConnection())\n  */\n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates);\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force = false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387600158",
      "id" : 1387600158,
      "in_reply_to_id" : 1225502218,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585StRke",
      "original_commit_id" : "fa78fc543cd46ee1c7181ecf6b696c2892b9f8d3",
      "original_line" : 44,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/eviction.h",
      "position" : 8,
      "pull_request_review_id" : 1721882872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387600158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T07:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387600158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387601029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387601029"
         }
      },
      "author_association" : "MEMBER",
      "body" : "c5e7e6563201965e88e07aa8da8f26e17fc1b4db\r\n\r\n\"among inbound no-noban connections\" or something (i hate `no-noban` but not sure what's better)",
      "commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "created_at" : "2023-11-09T07:44:42Z",
      "diff_hunk" : "@@ -38,8 +38,10 @@ struct NodeEvictionCandidate {\n  * fixed numbers of desirable peers per various criteria, followed by (mostly)\n  * ratios of desirable or disadvantaged peers. If any eviction candidates\n  * remain, the selection logic chooses a peer to evict.\n+ * @param[in]   force   Attempt to evict a random peer if no candidates\n+ *                      are available. (see CConman::AttemptToEvictConnection())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387601029",
      "id" : 1387601029,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII585StRyF",
      "original_commit_id" : "c5e7e6563201965e88e07aa8da8f26e17fc1b4db",
      "original_line" : 42,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/eviction.h",
      "position" : 5,
      "pull_request_review_id" : 1721882872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387601029/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T07:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387601029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387608833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387608833"
         }
      },
      "author_association" : "MEMBER",
      "body" : "311902f2cf94ee0e11ed34a1373db42dbc218b20\r\n\r\nNo need to use legacy naming patterns for new variables :)",
      "commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "created_at" : "2023-11-09T07:53:36Z",
      "diff_hunk" : "@@ -1776,8 +1776,9 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n                                             const CAddress& addr_bind,\n                                             const CAddress& addr)\n {\n-    int nInbound = 0;\n-    int nMaxInbound = nMaxConnections - m_max_outbound;\n+    int nInbound{0};\n+    int nForced{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387608833",
      "id" : 1387608833,
      "line" : 1780,
      "node_id" : "PRRC_kwDOABII585StTsB",
      "original_commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "original_line" : 1780,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 7,
      "pull_request_review_id" : 1721882872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387608833/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T07:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387608833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387612308"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387612308"
         }
      },
      "author_association" : "MEMBER",
      "body" : "311902f2cf94ee0e11ed34a1373db42dbc218b20\r\n\r\nshould this be exposed in peer info?",
      "commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "created_at" : "2023-11-09T07:57:11Z",
      "diff_hunk" : "@@ -1865,6 +1877,7 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n                              CNodeOptions{\n                                  .permission_flags = permission_flags,\n                                  .prefer_evict = discouraged,\n+                                 .forced_inbound = forced,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1387612308",
      "id" : 1387612308,
      "line" : 1880,
      "node_id" : "PRRC_kwDOABII585StUiU",
      "original_commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "original_line" : 1880,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 50,
      "pull_request_review_id" : 1721882872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387612308/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T07:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1387612308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388273116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388273116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok",
      "commit_id" : "115b72837790b6434a4ff7d063205052ae19b739",
      "created_at" : "2023-11-09T16:41:51Z",
      "diff_hunk" : "@@ -175,14 +176,24 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     EraseLastKElements(eviction_candidates, ReverseCompareNodeTimeConnected, remaining_to_protect);\n }\n \n-[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates)\n+[[nodiscard]] std::optional<NodeId> SelectNodeToEvict(std::vector<NodeEvictionCandidate>&& vEvictionCandidates, bool force)\n {\n     // Protect connections with certain characteristics\n \n     ProtectNoBanConnections(vEvictionCandidates);\n \n     ProtectOutboundConnections(vEvictionCandidates);\n \n+    // No inbound or unprotected connections left, return early\n+    if (vEvictionCandidates.empty()) return std::nullopt;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388273116",
      "id" : 1388273116,
      "in_reply_to_id" : 1387597063,
      "line" : 187,
      "node_id" : "PRRC_kwDOABII585Sv13c",
      "original_commit_id" : "c5e7e6563201965e88e07aa8da8f26e17fc1b4db",
      "original_line" : 187,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/node/eviction.cpp",
      "position" : 21,
      "pull_request_review_id" : 1723031687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388273116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T16:41:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388273116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388273335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388273335"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done, thanks",
      "commit_id" : "115b72837790b6434a4ff7d063205052ae19b739",
      "created_at" : "2023-11-09T16:42:02Z",
      "diff_hunk" : "@@ -38,8 +38,10 @@ struct NodeEvictionCandidate {\n  * fixed numbers of desirable peers per various criteria, followed by (mostly)\n  * ratios of desirable or disadvantaged peers. If any eviction candidates\n  * remain, the selection logic chooses a peer to evict.\n+ * @param[in]   force   Attempt to evict a random peer if no candidates\n+ *                      are available. (see CConman::AttemptToEvictConnection())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388273335",
      "id" : 1388273335,
      "in_reply_to_id" : 1387601029,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Sv163",
      "original_commit_id" : "c5e7e6563201965e88e07aa8da8f26e17fc1b4db",
      "original_line" : 42,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/eviction.h",
      "position" : null,
      "pull_request_review_id" : 1723032234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388273335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T16:42:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388273335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388274061"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388274061"
         }
      },
      "author_association" : "MEMBER",
      "body" : "hmmm I'm gonna keep it actually because later in this function is a boolean called `forced` so, I think this is legible",
      "commit_id" : "115b72837790b6434a4ff7d063205052ae19b739",
      "created_at" : "2023-11-09T16:42:33Z",
      "diff_hunk" : "@@ -1776,8 +1776,9 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n                                             const CAddress& addr_bind,\n                                             const CAddress& addr)\n {\n-    int nInbound = 0;\n-    int nMaxInbound = nMaxConnections - m_max_outbound;\n+    int nInbound{0};\n+    int nForced{0};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388274061",
      "id" : 1388274061,
      "in_reply_to_id" : 1387608833,
      "line" : 1738,
      "node_id" : "PRRC_kwDOABII585Sv2GN",
      "original_commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "original_line" : 1738,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 32,
      "pull_request_review_id" : 1723033748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388274061/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T16:42:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388274061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388274229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388274229"
         }
      },
      "author_association" : "MEMBER",
      "body" : "good idea, added a new commit for this",
      "commit_id" : "115b72837790b6434a4ff7d063205052ae19b739",
      "created_at" : "2023-11-09T16:42:41Z",
      "diff_hunk" : "@@ -1865,6 +1877,7 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n                              CNodeOptions{\n                                  .permission_flags = permission_flags,\n                                  .prefer_evict = discouraged,\n+                                 .forced_inbound = forced,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1388274229",
      "id" : 1388274229,
      "in_reply_to_id" : 1387612308,
      "line" : 1837,
      "node_id" : "PRRC_kwDOABII585Sv2I1",
      "original_commit_id" : "311902f2cf94ee0e11ed34a1373db42dbc218b20",
      "original_line" : 1837,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 75,
      "pull_request_review_id" : 1723034137,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388274229/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-09T16:42:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1388274229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1389028671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389028671"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8c2026848da910fdebff0a9f73e29f1f6ae81e43\r\n\r\nSo forced actually means two things to you:\r\n1. Before connecting âÂ something that *might* evict another peer\r\n2. After connecting âÂ something that *has* evicted another peer\r\n\r\nI think this is confusing and better to use different words. RPC can expose \"force_evicted\" flag (to cover the latter case and apply to the `Connection`), while \"forceInbound\" can stay in the network/potential-connection context (the former case). ",
      "commit_id" : "8c2026848da910fdebff0a9f73e29f1f6ae81e43",
      "created_at" : "2023-11-10T07:45:33Z",
      "diff_hunk" : "@@ -226,6 +226,8 @@ class CNodeStats\n     TransportProtocolType m_transport_type;\n     /** BIP324 session id string in hex, if any. */\n     std::string m_session_id;\n+    /** whether this peer forced its connection by evicting another */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1389028671",
      "id" : 1389028671,
      "line" : 229,
      "node_id" : "PRRC_kwDOABII585SyuU_",
      "original_commit_id" : "8c2026848da910fdebff0a9f73e29f1f6ae81e43",
      "original_line" : 229,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 1724197196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389028671/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-10T07:50:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389028671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1389032216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389032216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Apparently, in the previous commit 75868022a904c1f77871abf962bf9b88a9c5faf6 you assign `forced = true;` even for non-`forceInbound` peers. \r\n\r\nSo basically if a node had 8 connections which are non-`forceInbound` but still did eviction, a real `forceInbound` connection won't be able to join (see how you count nForced). Is that intended? Seems like a bug to me.",
      "commit_id" : "8c2026848da910fdebff0a9f73e29f1f6ae81e43",
      "created_at" : "2023-11-10T07:49:46Z",
      "diff_hunk" : "@@ -226,6 +226,8 @@ class CNodeStats\n     TransportProtocolType m_transport_type;\n     /** BIP324 session id string in hex, if any. */\n     std::string m_session_id;\n+    /** whether this peer forced its connection by evicting another */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27600#discussion_r1389032216",
      "id" : 1389032216,
      "in_reply_to_id" : 1389028671,
      "line" : 229,
      "node_id" : "PRRC_kwDOABII585SyvMY",
      "original_commit_id" : "8c2026848da910fdebff0a9f73e29f1f6ae81e43",
      "original_line" : 229,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 1724197196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27600",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389032216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-10T07:50:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389032216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   }
]
