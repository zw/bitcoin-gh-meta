[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19998 (rpc: Add `via_tor` to `getpeerinfo` output by hebasto)\n* #19988 (Overhaul transaction request logic by sipa)\n* #19911 (net: guard vRecvGetData with cs_vRecv and orphan_work_set with g_cs_orphans by narula)\n* #19771 (net: Replace enum CConnMan::NumConnections with enum class ConnectionDirection by luke-jr)\n* #19757 (net/net_processing: Convert net std::list buffers to std::forward_list by JeremyRubin)\n* #19509 (Per-Peer Message Logging by troygiorshev)\n* #18985 (bloom: use Span instead of std::vector for `insert` and `contains` [ZAP3] by jb55)\n* #17167 (Allow whitelisting outgoing connections by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "created_at" : "2020-05-29T16:29:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636066164",
      "id" : 636066164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjA2NjE2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T09:51:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636066164",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432638537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432638537"
         }
      },
      "author_association" : "MEMBER",
      "body" : "use `nullopt`?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-05-29T17:39:09Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){\n+        Reset();\n+        return boost::none;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432638537",
      "id" : 432638537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYzODUzNw==",
      "original_commit_id" : "d5db6ad764a87eb59ee513857058fabba99d106c",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421157205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432638537",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "node_id" : "MDQ6VXNlcjE3ODQ2NA==",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432667393"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432667393"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, fixed",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-05-29T18:37:10Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){\n+        Reset();\n+        return boost::none;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r432667393",
      "id" : 432667393,
      "in_reply_to_id" : 432638537,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2NzM5Mw==",
      "original_commit_id" : "d5db6ad764a87eb59ee513857058fabba99d106c",
      "original_line" : 723,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421196259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432667393",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-05-29T22:56:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636227452",
      "id" : 636227452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjIyNzQ1Mg==",
      "updated_at" : "2020-05-29T22:56:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636227452",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK. Thanks for adding doxy comment on `ReceiveMsgBytes`. That clarified few doubts for me. Verified unit tests and functional tests passing. \r\nFollowing are few nonblocking comments mostly for my understanding. ",
      "created_at" : "2020-06-01T09:15:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636725289",
      "id" : 636725289,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjcyNTI4OQ==",
      "updated_at" : "2020-06-01T09:15:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636725289",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433130593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433130593"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It seems `ReceiveMsgBytes` returns two `bool`, (the function return and `bool& complete`), and both of them will have the same value at any execution (if I am not reading wrong). Is there any specific reason to make a function return the same boolean value twice?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T09:23:38Z",
      "diff_hunk" : "@@ -572,6 +572,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer\n+ * @param[in]   nBytes      Size of the socket buffer\n+ * @param[out]  complete    Set True if a message has been deserialized and is\n+ *                          ready to be processed\n+ * @return  True if the peer should stay connected,\n+ *          False if the peer should be disconnected from.\n+ */\n bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete)\n {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433130593",
      "id" : 433130593,
      "line" : 597,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEzMDU5Mw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 597,
      "original_position" : 15,
      "original_start_line" : 582,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : 593,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433130593",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433139799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433139799"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As it is a network magic error, the error code can be a little verbose for better understanding, something like this? Especially the command and size seems redundant.\r\n```suggestion\r\n        LogPrint(BCLog::NET, \"HEADER ERROR - NETMAGIC : (%s, %u bytes), expected %s got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE chain_params.MessageStart(), hdr.GetMessageStart());\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T09:45:39Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433139799",
      "id" : 433139799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEzOTc5OQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 687,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433139799",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433142401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433142401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should it be called `HEADER ERROR` given the error is due to the bigger message size? I think the error code can also be improved a little here specifying the message size is bigger the max permissible size. \r\nSomething like \r\n```suggestion\r\n        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESIZE (%s, %u bytes), size %u bigger than max message size\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.nMessageSize);\r\n```\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T09:51:52Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433142401",
      "id" : 433142401,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0MjQwMQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433142401",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433145200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433145200"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A comment here specifying `GetMessage` can fail due to invalid header might help here. ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T09:58:13Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433145200",
      "id" : 433145200,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0NTIwMA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 727,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433145200",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433146912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433146912"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems like an error message here might be appropriate similar to the checksum check? ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T10:02:32Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433146912",
      "id" : 433146912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0NjkxMg==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 721,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433146912",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433147490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433147490"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why remove this comment block? ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T10:03:56Z",
      "diff_hunk" : "@@ -3536,14 +3536,6 @@ bool PeerLogicValidation::CheckIfBanned(CNode* pnode)\n bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& interruptMsgProc)\n {\n     const CChainParams& chainparams = Params();\n-    //\n-    // Message format\n-    //  (4) message start\n-    //  (12) command\n-    //  (4) size\n-    //  (4) checksum\n-    //  (x) data\n-    //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433147490",
      "id" : 433147490,
      "line" : 3834,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0NzQ5MA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 3834,
      "original_position" : 11,
      "original_start_line" : 3539,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : 3827,
      "start_side" : "LEFT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433147490",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433148918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433148918"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A little more info in error message might help? ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T10:07:20Z",
      "diff_hunk" : "@@ -109,31 +109,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433148918",
      "id" : 433148918,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0ODkxOA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 131,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433148918",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433149066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433149066"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same comment for a little more info in the error message.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T10:07:41Z",
      "diff_hunk" : "@@ -109,31 +109,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);\n                     return false;\n+                }\n         }\n-        else if (*p1 < ' ' || *p1 > 0x7E)\n+        else if (*p1 < ' ' || *p1 > 0x7E){\n+            LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433149066",
      "id" : 433149066,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE0OTA2Ng==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 136,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433149066",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\nRun p2p_transport_deserializer with args ['/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer', '-runs=1', '/home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/p2p_transport_deserializer']INFO: Seed: 2855084377\r\n\r\nINFO: Loaded 1 modules   (412040 inline 8-bit counters): 412040 [0x560bb09480d8, 0x560bb09aca60), \r\n\r\nINFO: Loaded 1 PC tables (412040 PCs): 412040 [0x560bb09aca60,0x560bb0ff62e0), \r\n\r\nINFO:      128 files found in /home/travis/build/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_seed_corpus/p2p_transport_deserializer\r\n\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 1048576 bytes\r\n\r\nINFO: seed corpus: files: 128 min: 1b max: 1048576b total: 8594313b rss: 88Mb\r\n\r\np2p_transport_deserializer: test/fuzz/p2p_transport_deserializer.cpp:35: void test_one_input(const std::vector<uint8_t> &): Assertion `result' failed.\r\n\r\n==31678== ERROR: libFuzzer: deadly signal\r\n\r\n    #0 0x560bae1f1881 in __sanitizer_print_stack_trace (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x198a881)\r\n\r\n    #1 0x560bae13c9d8 in fuzzer::PrintStackTrace() (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18d59d8)\r\n\r\n    #2 0x560bae121b23 in fuzzer::Fuzzer::CrashCallback() (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18bab23)\r\n\r\n    #3 0x7f38b4a473bf  (/lib/x86_64-linux-gnu/libpthread.so.0+0x153bf)\r\n\r\n    #4 0x7f38b46ae18a in raise (/lib/x86_64-linux-gnu/libc.so.6+0x4618a)\r\n\r\n    #5 0x7f38b468d858 in abort (/lib/x86_64-linux-gnu/libc.so.6+0x25858)\r\n\r\n    #6 0x7f38b468d728  (/lib/x86_64-linux-gnu/libc.so.6+0x25728)\r\n\r\n    #7 0x7f38b469ef35 in __assert_fail (/lib/x86_64-linux-gnu/libc.so.6+0x36f35)\r\n\r\n    #8 0x560bae21b71f in test_one_input(std::vector<unsigned char, std::allocator<unsigned char> > const&) /home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer.cpp:35:13\r\n\r\n    #9 0x560baf33d9e1 in LLVMFuzzerTestOneInput /home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/fuzz.cpp:36:5\r\n\r\n    #10 0x560bae1231e1 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18bc1e1)\r\n\r\n    #11 0x560bae122925 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18bb925)\r\n\r\n    #12 0x560bae125247 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::__Fuzzer::vector<fuzzer::SizedFile, fuzzer::fuzzer_allocator<fuzzer::SizedFile> >&) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18be247)\r\n\r\n    #13 0x560bae1255a9 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector<fuzzer::SizedFile, fuzzer::fuzzer_allocator<fuzzer::SizedFile> >&) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18be5a9)\r\n\r\n    #14 0x560bae11427e in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18ad27e)\r\n\r\n    #15 0x560bae13d0c2 in main (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x18d60c2)\r\n\r\n    #16 0x7f38b468f0b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)\r\n\r\n    #17 0x560bae0e901d in _start (/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/fuzz/p2p_transport_deserializer+0x188201d)\r\n\r\nNOTE: libFuzzer has rudimentary signal handlers.\r\n\r\n      Combine libFuzzer with AddressSanitizer or similar for better crash reports.\r\n\r\nSUMMARY: libFuzzer: deadly signal\r\n\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n\r\n0xfa,0xbf,0xb5,0xda,0x40,0x6e,0x6e,0x6e,0x6e,0x7f,0x6f,0x3,0x34,0x64,0x6e,0x0,0x0,0x0,0x0,0x0,0x28,0xf6,0x6e,0x6e,\r\n\r\n\\xfa\\xbf\\xb5\\xda@nnnn\\x7fo\\x034dn\\x00\\x00\\x00\\x00\\x00(\\xf6nn\r\n\r\nartifact_prefix='./'; Test unit written to ./crash-fc30b01e02b9667a2f09968f8a88c869ab056464\r\n\r\nBase64: +r+12kBubm5uf28DNGRuAAAAAAAo9m5u",
      "created_at" : "2020-06-01T10:28:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-636769885",
      "id" : 636769885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzNjc2OTg4NQ==",
      "updated_at" : "2020-06-01T10:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636769885",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433158495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433158495"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems like a very interesting observation, especially for new reviewers. Is it possible to combine the explanation with the question below and elucidate it more clearly? It took me some time to figure out what these statements were referring to.  ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T10:30:48Z",
      "diff_hunk" : "@@ -134,11 +135,21 @@ def run_test(self):\n             # Unmodified message should submit okay.\n             node.p2p.send_and_ping(msg)\n \n+            # ==elucidate the confusion below==\n+            #print(len(node.p2p.build_message(msg))) # 125\n+            # => Payload size = 125 - 24 = 101\n+            # If we take 77 bytes, then there are 101 - 77 = 24 left\n+            # That's exactly the size of a header\n+            # So, bitcoind deserializes the header and rejects it for some other reason\n+            # But, if we take 78 bytes, then there are 101 - 78 = 23 left\n+            # That's not enough to fill a header, so, what happens?\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433158495",
      "id" : 433158495,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE1ODQ5NQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 146,
      "original_position" : 22,
      "original_start_line" : 138,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 421706926,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433158495",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433268161"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433268161"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There are a few cases where ReceiveMsgBytes will return true and complete will stay false.  The most common is when Read finishes reading all of the bytes out of the buffer (so nBytes == 0), but we haven't reached the end of a single message.  (Remember the socket buffer is max 64KiB but a bitcoin message can be up to 4MB).  In that case complete will still be false, but the method will return true, as we should stay connected to the peer to keep receiving the rest of the message.  Another case, added by this PR, is when a message is found to be invalid when deserialized (and when there isn't the end of a valid message in the buffer).  Again complete will stay false, but the method will return true.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:29:41Z",
      "diff_hunk" : "@@ -572,6 +572,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer\n+ * @param[in]   nBytes      Size of the socket buffer\n+ * @param[out]  complete    Set True if a message has been deserialized and is\n+ *                          ready to be processed\n+ * @return  True if the peer should stay connected,\n+ *          False if the peer should be disconnected from.\n+ */\n bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete)\n {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433268161",
      "id" : 433268161,
      "in_reply_to_id" : 433130593,
      "line" : 597,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI2ODE2MQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 597,
      "original_position" : 15,
      "original_start_line" : 582,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 421891025,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : 593,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433268161",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433272598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433272598"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The command and size outputs are being kept to stay consistent with other error messages.  Both the codebase and documentation aren't consistent between the terms \"Message Start String\" and \"Network Magic\", I'm preferring \"Message Start String\" here as I think it's the older one, and neither are sufficiently descriptive out of context anyways.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:37:01Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433272598",
      "id" : 433272598,
      "in_reply_to_id" : 433139799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3MjU5OA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 687,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421896891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433272598",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433274677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433274677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it's necessary to print out the expected MessageStart in the debug message.  The MessageStart is set when bitcoind starts up and doesn't change after that.  No one should be confused as to what the expected value is.  Additionally I don't print out the message's MessageStart here, because I can't find a situation where it would be relevant.  I'm open to changing my stance on that if someone can propose when that would be useful.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:40:25Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433274677",
      "id" : 433274677,
      "in_reply_to_id" : 433139799,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3NDY3Nw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 687,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421899671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433274677",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433276511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433276511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The error is that the header is stating the message is larger than the maximum size.  That's orthogonal to whether the message is actually larger than the maximum size.  (a priori we have no way of determining that).  The error is in the construction of the header, and the error is brought up when checking the header.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:43:36Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433276511",
      "id" : 433276511,
      "in_reply_to_id" : 433142401,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3NjUxMQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421902242,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433276511",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433277795"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433277795"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it's necessary to print out the current size, as it's already being done in the brackets.  (That said, the error logs I've found aren't consistent between printing the \"message size\" and the \"raw message size\" (including the header).  I've chosen the conservative approach and not changed that, though in this case I think you're right, it really _should_ be the \"message\" or \"payload\" size.)",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:45:49Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433277795",
      "id" : 433277795,
      "in_reply_to_id" : 433142401,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3Nzc5NQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421903948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433277795",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433281963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433281963"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The logging is done in IsValid and in ReadHeader.  I agree, I'd love to have it in GetMessage instead, just like the checksum check, but that would require IsValid to pass the information about why it failed up to GetMessage.  Ideally all of the logging would be in ReceiveMsgBytes (and indeed I had a version of this PR where that was the case) but seeing the complexity that added to Read, ReadHeader, IsValid, and GetHeader I didn't think it was worth it.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:52:35Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433281963",
      "id" : 433281963,
      "in_reply_to_id" : 433146912,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4MTk2Mw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 721,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 421909681,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433281963",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433282795"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433282795"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Net Processing is no longer aware of the format of the header.  That's all dealt with in net, so that net processing can just process the payload.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:53:57Z",
      "diff_hunk" : "@@ -3536,14 +3536,6 @@ bool PeerLogicValidation::CheckIfBanned(CNode* pnode)\n bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& interruptMsgProc)\n {\n     const CChainParams& chainparams = Params();\n-    //\n-    // Message format\n-    //  (4) message start\n-    //  (12) command\n-    //  (4) size\n-    //  (4) checksum\n-    //  (x) data\n-    //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433282795",
      "id" : 433282795,
      "in_reply_to_id" : 433147490,
      "line" : 3834,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4Mjc5NQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 3834,
      "original_position" : 11,
      "original_start_line" : 3539,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 421910852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : 3827,
      "start_side" : "LEFT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433282795",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433283280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433283280"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't see any more that we could add here.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:54:47Z",
      "diff_hunk" : "@@ -109,31 +109,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433283280",
      "id" : 433283280,
      "in_reply_to_id" : 433148918,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4MzI4MA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 131,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 421911506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433283280",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433283381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433283381"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same as above",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T14:54:56Z",
      "diff_hunk" : "@@ -109,31 +109,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);\n                     return false;\n+                }\n         }\n-        else if (*p1 < ' ' || *p1 > 0x7E)\n+        else if (*p1 < ' ' || *p1 > 0x7E){\n+            LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433283381",
      "id" : 433283381,
      "in_reply_to_id" : 433149066,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4MzM4MQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 136,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 421911647,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433283381",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433368764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433368764"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This change to the `CMessageHeader` ctor should be pulled out into its own commit, with the commit message explaining why it's ok to initialize a `CMessageHeader` without the start bytes.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:07:37Z",
      "diff_hunk" : "@@ -36,15 +36,16 @@ class CMessageHeader\n     static constexpr size_t HEADER_SIZE = MESSAGE_START_SIZE + COMMAND_SIZE + MESSAGE_SIZE_SIZE + CHECKSUM_SIZE;\n     typedef unsigned char MessageStartChars[MESSAGE_START_SIZE];\n \n-    explicit CMessageHeader(const MessageStartChars& pchMessageStartIn);\n+    explicit CMessageHeader();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433368764",
      "id" : 433368764,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2ODc2NA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 40,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 5,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433368764",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433378139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433378139"
         }
      },
      "author_association" : "MEMBER",
      "body" : "These new logs don't include the peer id, which makes them a lot less useful than the existing logs. Are you able to pass the failure reason up to `CNode::ReceiveMsgBytes()` so the peer id can be logged?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:25:22Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433378139",
      "id" : 433378139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3ODEzOQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433378139",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433381287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433381287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need for `hdr()` in the initializer list. It'll use the default construction anyway if you leave it out.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:31:15Z",
      "diff_hunk" : "@@ -675,7 +675,7 @@ class V1TransportDeserializer final : public TransportDeserializer\n \n public:\n \n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\n+    V1TransportDeserializer(const CChainParams& chain_params_in, int nTypeIn, int nVersionIn) : chain_params(chain_params_in), hdrbuf(nTypeIn, nVersionIn), hdr(), vRecv(nTypeIn, nVersionIn) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433381287",
      "id" : 433381287,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MTI4Nw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 678,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433381287",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433382373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433382373"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit _Give V1TransportDeserializer a ref to CChainParams member, and use it in GetMessage_, you should switch out the calls to the global `Params` for the local `chain_params`",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:33:10Z",
      "diff_hunk" : "@@ -705,20 +705,21 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-Optional<CNetMessage> V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n     // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    msg.m_valid_header = hdr.IsValid(Params().MessageStart());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433382373",
      "id" : 433382373,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjM3Mw==",
      "original_commit_id" : "156fc71215b04dfb48f8cb5b7e7911df245032bd",
      "original_line" : 713,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433382373",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433383226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433383226"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Member variables in new code should be named `m_name`. See https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c for our style guide.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:34:49Z",
      "diff_hunk" : "@@ -642,13 +641,14 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(int64_t time) = 0;\n     virtual ~TransportDeserializer() {}\n };\n \n class V1TransportDeserializer final : public TransportDeserializer\n {\n private:\n+    const CChainParams& chain_params;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433383226",
      "id" : 433383226,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MzIyNg==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 651,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433383226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433384203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433384203"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What's the reason for storing a reference to the chain params, rather than the message start bytes themselves, which is all we actually need?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:36:40Z",
      "diff_hunk" : "@@ -642,13 +641,14 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(int64_t time) = 0;\n     virtual ~TransportDeserializer() {}\n };\n \n class V1TransportDeserializer final : public TransportDeserializer\n {\n private:\n+    const CChainParams& chain_params;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433384203",
      "id" : 433384203,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NDIwMw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 651,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433384203",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433386910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433386910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't think commit _Create getter CMessageHeader::GetMessageStart_ will build. You're changing the `IsValid()` signature in this commit, but don't change the callers until a later commit.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:41:45Z",
      "diff_hunk" : "@@ -44,7 +44,8 @@ class CMessageHeader\n     CMessageHeader(const MessageStartChars& pchMessageStartIn, const char* pszCommand, unsigned int nMessageSizeIn);\n \n     std::string GetCommand() const;\n-    bool IsValid(const MessageStartChars& messageStart) const;\n+    std::string GetMessageStart() const;\n+    bool IsValid() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433386910",
      "id" : 433386910,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NjkxMA==",
      "original_commit_id" : "0ad9dabdc7a78814c7e1f227beb08a2f467deb7f",
      "original_line" : 48,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433386910",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433393364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433393364"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since the only check in `IsValid()` is that the command name in the header is a valid ascii string, and the only place it's called is from here, perhaps that function should be moved to net.cpp and its name updated to `IsCommandNameValid()` or similar.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T17:53:37Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433393364",
      "id" : 433393364,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM5MzM2NA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 721,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433393364",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433401068"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433401068"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did you mean to commit all of this? It seems unfinished.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T18:08:05Z",
      "diff_hunk" : "@@ -124,7 +124,8 @@ def run_test(self):\n         #\n         # Send messages with an incorrect data size in the header.\n         #\n-        actual_size = 100\n+        # These all fail with a checksum error!  That's not what this test is supposed to test.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433401068",
      "id" : 433401068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQwMTA2OA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 127,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433401068",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433402173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433402173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This commit should be squashed with the code changes.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-01T18:10:16Z",
      "diff_hunk" : "@@ -189,10 +189,9 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         DeserializeFromFuzzingInput(buffer, s);\n         AssertEqualAfterSerializeDeserialize(s);\n #elif MESSAGEHEADER_DESERIALIZE\n-        const CMessageHeader::MessageStartChars pchMessageStart = {0x00, 0x00, 0x00, 0x00};\n-        CMessageHeader mh(pchMessageStart);\n+        CMessageHeader mh;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433402173",
      "id" : 433402173,
      "line" : 192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQwMjE3Mw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 192,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/fuzz/deserialize.cpp",
      "position" : 6,
      "pull_request_review_id" : 422023941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433402173",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433729072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433729072"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ya that makes sense. Thanks for clarifying. ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-02T09:04:50Z",
      "diff_hunk" : "@@ -572,6 +572,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer\n+ * @param[in]   nBytes      Size of the socket buffer\n+ * @param[out]  complete    Set True if a message has been deserialized and is\n+ *                          ready to be processed\n+ * @return  True if the peer should stay connected,\n+ *          False if the peer should be disconnected from.\n+ */\n bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete)\n {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r433729072",
      "id" : 433729072,
      "in_reply_to_id" : 433130593,
      "line" : 597,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcyOTA3Mg==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 597,
      "original_position" : 15,
      "original_start_line" : 582,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 422483058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : 593,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433729072",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r435345077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435345077"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point.  This PR is getting a little crowded, I'm going to move the test changes to a new one and I'll clear things up there.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-04T15:24:56Z",
      "diff_hunk" : "@@ -134,11 +135,21 @@ def run_test(self):\n             # Unmodified message should submit okay.\n             node.p2p.send_and_ping(msg)\n \n+            # ==elucidate the confusion below==\n+            #print(len(node.p2p.build_message(msg))) # 125\n+            # => Payload size = 125 - 24 = 101\n+            # If we take 77 bytes, then there are 101 - 77 = 24 left\n+            # That's exactly the size of a header\n+            # So, bitcoind deserializes the header and rejects it for some other reason\n+            # But, if we take 78 bytes, then there are 101 - 78 = 23 left\n+            # That's not enough to fill a header, so, what happens?\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r435345077",
      "id" : 435345077,
      "in_reply_to_id" : 433158495,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0NTA3Nw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 146,
      "original_position" : 22,
      "original_start_line" : 138,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 424564936,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435345077",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-04T20:35:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-639102115",
      "id" : 639102115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTEwMjExNQ==",
      "updated_at" : "2020-06-04T20:35:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639102115",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r435925244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435925244"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Test changes moved to a separate PR",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-05T13:36:08Z",
      "diff_hunk" : "@@ -124,7 +124,8 @@ def run_test(self):\n         #\n         # Send messages with an incorrect data size in the header.\n         #\n-        actual_size = 100\n+        # These all fail with a checksum error!  That's not what this test is supposed to test.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r435925244",
      "id" : 435925244,
      "in_reply_to_id" : 433401068,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkyNTI0NA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 127,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 425304370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435925244",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437020284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437020284"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't have a great justification for this.  The chain_params is a singleton object and it somehow *feels* better to have a reference to a singleton object than a reference to a member of it.  Maybe one day V1TransportDeserializer will need another parameter, if even only for a test.  If anyone can propose even a weak reason why this is a bad idea than I'm happy to change it.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-08T21:47:59Z",
      "diff_hunk" : "@@ -642,13 +641,14 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(int64_t time) = 0;\n     virtual ~TransportDeserializer() {}\n };\n \n class V1TransportDeserializer final : public TransportDeserializer\n {\n private:\n+    const CChainParams& chain_params;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437020284",
      "id" : 437020284,
      "in_reply_to_id" : 433384203,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAyMDI4NA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 651,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 426645683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437020284",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:54:42Z",
      "diff_hunk" : "@@ -36,15 +36,16 @@ class CMessageHeader\n     static constexpr size_t HEADER_SIZE = MESSAGE_START_SIZE + COMMAND_SIZE + MESSAGE_SIZE_SIZE + CHECKSUM_SIZE;\n     typedef unsigned char MessageStartChars[MESSAGE_START_SIZE];\n \n-    explicit CMessageHeader(const MessageStartChars& pchMessageStartIn);\n+    explicit CMessageHeader();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440270",
      "id" : 437440270,
      "in_reply_to_id" : 433368764,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MDI3MA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 40,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : 5,
      "pull_request_review_id" : 427175039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440270",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440470"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:54:52Z",
      "diff_hunk" : "@@ -675,7 +675,7 @@ class V1TransportDeserializer final : public TransportDeserializer\n \n public:\n \n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\n+    V1TransportDeserializer(const CChainParams& chain_params_in, int nTypeIn, int nVersionIn) : chain_params(chain_params_in), hdrbuf(nTypeIn, nVersionIn), hdr(), vRecv(nTypeIn, nVersionIn) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440470",
      "id" : 437440470,
      "in_reply_to_id" : 433381287,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MDQ3MA==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 678,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 427175229,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440470",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440737"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Missed this one, good eye.  Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:55:11Z",
      "diff_hunk" : "@@ -705,20 +705,21 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-Optional<CNetMessage> V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n     // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    msg.m_valid_header = hdr.IsValid(Params().MessageStart());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440737",
      "id" : 437440737,
      "in_reply_to_id" : 433382373,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MDczNw==",
      "original_commit_id" : "156fc71215b04dfb48f8cb5b7e7911df245032bd",
      "original_line" : 713,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 427175521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440737",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440902"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440902"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:55:23Z",
      "diff_hunk" : "@@ -642,13 +641,14 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(int64_t time) = 0;\n     virtual ~TransportDeserializer() {}\n };\n \n class V1TransportDeserializer final : public TransportDeserializer\n {\n private:\n+    const CChainParams& chain_params;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437440902",
      "id" : 437440902,
      "in_reply_to_id" : 433383226,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MDkwMg==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 651,
      "original_position" : 37,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 427175703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437440902",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437441175"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437441175"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:55:44Z",
      "diff_hunk" : "@@ -44,7 +44,8 @@ class CMessageHeader\n     CMessageHeader(const MessageStartChars& pchMessageStartIn, const char* pszCommand, unsigned int nMessageSizeIn);\n \n     std::string GetCommand() const;\n-    bool IsValid(const MessageStartChars& messageStart) const;\n+    std::string GetMessageStart() const;\n+    bool IsValid() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437441175",
      "id" : 437441175,
      "in_reply_to_id" : 433386910,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MTE3NQ==",
      "original_commit_id" : "0ad9dabdc7a78814c7e1f227beb08a2f467deb7f",
      "original_line" : 48,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 427176062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437441175",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437442639"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437442639"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Chose `IsCommandValid()` as not to confuse the reader with the command name check done in ReceiveMsgBytes",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:57:12Z",
      "diff_hunk" : "@@ -692,29 +713,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsValid()){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437442639",
      "id" : 437442639,
      "in_reply_to_id" : 433393364,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MjYzOQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 721,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 427177643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437442639",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437442755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437442755"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T13:57:20Z",
      "diff_hunk" : "@@ -189,10 +189,9 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         DeserializeFromFuzzingInput(buffer, s);\n         AssertEqualAfterSerializeDeserialize(s);\n #elif MESSAGEHEADER_DESERIALIZE\n-        const CMessageHeader::MessageStartChars pchMessageStart = {0x00, 0x00, 0x00, 0x00};\n-        CMessageHeader mh(pchMessageStart);\n+        CMessageHeader mh;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437442755",
      "id" : 437442755,
      "in_reply_to_id" : 433402173,
      "line" : 192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0Mjc1NQ==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 192,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/test/fuzz/deserialize.cpp",
      "position" : 6,
      "pull_request_review_id" : 427177776,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437442755",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437445346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437445346"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've added a second LogPrint to ReceiveMsgBytes that will always print after an initial error.  I think this is a better solution than having Read and Getmessage pass out a string.  If we really want them on the same line, I could remove the trailing newline from the initial errors.  (But that feels fragile)",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-09T14:00:13Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r437445346",
      "id" : 437445346,
      "in_reply_to_id" : 433378139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0NTM0Ng==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 427180861,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/437445346",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Rebased, fixed failing fuzz tests.  Removed some of the unneeded test changes, they're now in #19177. Overall the commits are cleaned up.  They are all atomic now, with full commit messages.  I've also implemented many of the suggestions, thanks again to everyone for the review so far!",
      "created_at" : "2020-06-09T15:45:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-641390889",
      "id" : 641390889,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MTM5MDg4OQ==",
      "updated_at" : "2020-06-09T15:45:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/641390889",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438856814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438856814"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I understand you are trying to repeat the errors here after the initial error from the actual function call, but can this make the errors clumsy? Especially when errors will occur from multiple peers simultaneously. It's expected that an entire error will be in a single line for any context, instead here the error with peer id is printing on a new line. ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-11T15:09:03Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438856814",
      "id" : 438856814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1NjgxNA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 603,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 429007159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438856814",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438862855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438862855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Indication of checksum check already happening inside `GetMessage()` in this comment might be helpful?  ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-11T15:17:43Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438862855",
      "id" : 438862855,
      "line" : 615,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg2Mjg1NQ==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 615,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 429007159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438862855",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438884028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438884028"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Mentioning it \"optionally\" decomposes the message might make the comment complete. Feel free to ignore.  ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-11T15:42:18Z",
      "diff_hunk" : "@@ -642,13 +641,14 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438884028",
      "id" : 438884028,
      "line" : 729,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4NDAyOA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 729,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 33,
      "pull_request_review_id" : 429007159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438884028",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438897822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438897822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Referring back to the review club discussion. Previously we were dropping connections here because of any header error. Going by the logic of not dropping the connection due to wrong checksum (naughty firewall) cant those same things happen in other parts of the header too?\r\nOrthogonal to this PR, but curious about the rationale here.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-11T15:58:45Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438897822",
      "id" : 438897822,
      "line" : 608,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg5NzgyMg==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 608,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 32,
      "pull_request_review_id" : 429007159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438897822",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438936859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438936859"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Keeping in the spirit of the original comment here, maybe add a comment saying returning staring string?   ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-11T17:03:17Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r438936859",
      "id" : 438936859,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkzNjg1OQ==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 118,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 429007159,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438936859",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439486796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439486796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "no need for this use-once local variable. Combine the lines:\r\n\r\n```suggestion\r\n    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\r\n        // Invalid checksum. Log and exit\r\n        ...\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:25:16Z",
      "diff_hunk" : "@@ -699,29 +725,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsCommandValid()){\n+        Reset();\n+        return nullopt;\n+    }\n \n     // store command string, payload size\n     msg.m_command = hdr.GetCommand();\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n+    // Check checksum\n+    bool valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n+    if (!valid_checksum) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439486796",
      "id" : 439486796,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4Njc5Ng==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 750,
      "original_position" : 95,
      "original_start_line" : 749,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439486796",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439489550"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439489550"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's a slight smell that you're calling `Reset()` for both exit branches here. I think this would be safer if this branch just set `msg` to be a nullopt and an else branch set it to be the `Optional<CNetMessage>`.\r\n\r\nI'd also prefer to avoid the implicit conversion from `CNetMessage` to `Optional<CNetMessage>` in the `return` statement below.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:30:10Z",
      "diff_hunk" : "@@ -699,29 +725,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsCommandValid()){\n+        Reset();\n+        return nullopt;\n+    }\n \n     // store command string, payload size\n     msg.m_command = hdr.GetCommand();\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n+    // Check checksum\n+    bool valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n+    if (!valid_checksum) {\n         LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n                  SanitizeString(msg.m_command), msg.m_message_size,\n                  HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n                  HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439489550",
      "id" : 439489550,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ4OTU1MA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 758,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439489550",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439491172"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439491172"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This seems good enough. I think ideally Read and Getmessages would pass out an enum indicating deserialization failure reason, and ReceiveMsgBytes would know how to log based on the enum.\r\n\r\nDefinitely don't remove the newline from the initial errors! bitcoind is multithreaded, so another thread could log between the two messages.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:33:15Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439491172",
      "id" : 439491172,
      "in_reply_to_id" : 433378139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ5MTE3Mg==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439491172",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439491742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439491742"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think a comment here to say \"Message deserialization failed. Drop the message and log the failure, but don't disconnect the peer\" would be useful",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:34:24Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(nTimeMicros);\n+            if(!result){\n+                LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439491742",
      "id" : 439491742,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ5MTc0Mg==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 614,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439491742",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439497173"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439497173"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You can remove this include from net.cpp now that it's included in the header file.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:44:16Z",
      "diff_hunk" : "@@ -10,12 +10,14 @@\n #include <addrman.h>\n #include <amount.h>\n #include <bloom.h>\n+#include <chainparams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439497173",
      "id" : 439497173,
      "line" : 13,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ5NzE3Mw==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 13,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439497173",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439500348"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439500348"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: space between `)` and `{` please.\r\n\r\nSince you're touching this line, can you also give the surrounding for loop braces to comply with current code style guide?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:50:08Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439500348",
      "id" : 439500348,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUwMDM0OA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 130,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439500348",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439500590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439500590"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: space between `)` and `{` please.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:50:35Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);\n                     return false;\n+                }\n         }\n-        else if (*p1 < ' ' || *p1 > 0x7E)\n+        else if (*p1 < ' ' || *p1 > 0x7E){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439500590",
      "id" : 439500590,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUwMDU5MA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 135,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439500590",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439502372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439502372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it possible to move this logging up into `V1TransportDeserializer::GetMessage()` so you don't need to duplicate it?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-12T15:53:54Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439502372",
      "id" : 439502372,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUwMjM3Mg==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 131,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 429833311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439502372",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-12T21:03:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-643482306",
      "id" : 643482306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0MzQ4MjMwNg==",
      "updated_at" : "2020-06-12T21:03:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643482306",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440521258"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440521258"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The diff algorithm is confused, there wasn't ever a comment here.  This check is now in ReadHeader, where I've preserved the comment.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T00:38:18Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440521258",
      "id" : 440521258,
      "in_reply_to_id" : 438936859,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyMTI1OA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 118,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 431082576,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440521258",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440553543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440553543"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've found a way to consolidate these logs",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:41:26Z",
      "diff_hunk" : "@@ -653,11 +666,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE\\n\");\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE, hdr.GetMessageStart());\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes)\\n\", hdr.GetCommand(), hdr.nMessageSize + CMessageHeader::HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440553543",
      "id" : 440553543,
      "in_reply_to_id" : 433378139,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1MzU0Mw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 693,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431120916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440553543",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440553766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440553766"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree.  I've found a way to consolidate these logs, let me know what you think",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:42:16Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440553766",
      "id" : 440553766,
      "in_reply_to_id" : 438856814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1Mzc2Ng==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 603,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431121184,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440553766",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440553898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440553898"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:42:47Z",
      "diff_hunk" : "@@ -699,29 +725,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsCommandValid()){\n+        Reset();\n+        return nullopt;\n+    }\n \n     // store command string, payload size\n     msg.m_command = hdr.GetCommand();\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n+    // Check checksum\n+    bool valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n+    if (!valid_checksum) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440553898",
      "id" : 440553898,
      "in_reply_to_id" : 439486796,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1Mzg5OA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 750,
      "original_position" : 95,
      "original_start_line" : 749,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431121320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440553898",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Consolidated all of the checks to the bottom",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:43:55Z",
      "diff_hunk" : "@@ -699,29 +725,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsCommandValid()){\n+        Reset();\n+        return nullopt;\n+    }\n \n     // store command string, payload size\n     msg.m_command = hdr.GetCommand();\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n+    // Check checksum\n+    bool valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n+    if (!valid_checksum) {\n         LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n                  SanitizeString(msg.m_command), msg.m_message_size,\n                  HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n                  HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554184",
      "id" : 440554184,
      "in_reply_to_id" : 439489550,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDE4NA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 758,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431121656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554184",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554223"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:44:04Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(nTimeMicros);\n+            if(!result){\n+                LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554223",
      "id" : 440554223,
      "in_reply_to_id" : 439491742,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDIyMw==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 614,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431121713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554223",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554259"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:44:14Z",
      "diff_hunk" : "@@ -10,12 +10,14 @@\n #include <addrman.h>\n #include <amount.h>\n #include <bloom.h>\n+#include <chainparams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554259",
      "id" : 440554259,
      "in_reply_to_id" : 439497173,
      "line" : 13,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDI1OQ==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 13,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 4,
      "pull_request_review_id" : 431121771,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554259",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554314"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Gladly!  done",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:44:26Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554314",
      "id" : 440554314,
      "in_reply_to_id" : 439500348,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDMxNA==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 130,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 431121847,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554314",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554509"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree, done.  Logging is now exclusively in GetMessage and ReadHeader",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T02:45:09Z",
      "diff_hunk" : "@@ -113,31 +113,29 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n     for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n     {\n         if (*p1 == 0)\n         {\n             // Must be all zeros after the first zero\n             for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+                if (*p1 != 0){\n+                    LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes)\\n\", GetCommand(), nMessageSize + HEADER_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440554509",
      "id" : 440554509,
      "in_reply_to_id" : 439502372,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDUwOQ==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 131,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 431122078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440554509",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and made suggested changes.  When making the new log messages, I picked the \"wrong\" message size.  I chose the size including the header whereas I should have chosen the payload size to stay consistent with other logging.  That's now fixed.  (Search for `(%s, %u bytes)`)\r\n\r\nAdditionally I've found a solution to the logging issue.  Given that V1TransportDeserializer is always a member of a peer, I've given it a new node_id member.  Now all of the logging is done in methods of V1TransportDeserializer.  This should minimize future maintenance (other solutions would have had logging split through multiple methods), and puts the logging on one line.\r\n",
      "created_at" : "2020-06-16T02:47:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-644498437",
      "id" : 644498437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDQ5ODQzNw==",
      "updated_at" : "2020-06-16T02:48:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644498437",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440675944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440675944"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            if (result) {\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T08:27:17Z",
      "diff_hunk" : "@@ -31,16 +32,13 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         n_bytes -= handled;\n         if (deserializer.Complete()) {\n             const int64_t m_time = std::numeric_limits<int64_t>::max();\n-            const CNetMessage msg = deserializer.GetMessage(Params().MessageStart(), m_time);\n-            assert(msg.m_command.size() <= CMessageHeader::COMMAND_SIZE);\n-            assert(msg.m_raw_message_size <= buffer.size());\n-            assert(msg.m_raw_message_size == CMessageHeader::HEADER_SIZE + msg.m_message_size);\n-            assert(msg.m_time == m_time);\n-            if (msg.m_valid_header) {\n-                assert(msg.m_valid_netmagic);\n-            }\n-            if (!msg.m_valid_netmagic) {\n-                assert(!msg.m_valid_header);\n+            auto result = deserializer.GetMessage(m_time);\n+            if (result){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440675944",
      "id" : 440675944,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY3NTk0NA==",
      "original_commit_id" : "f070a97fe5abc40f93f98e241dd81c5bb43f7de5",
      "original_line" : 36,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/fuzz/p2p_transport_deserializer.cpp",
      "position" : null,
      "pull_request_review_id" : 431274533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440675944",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440676804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440676804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n            if (!result) {\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T08:28:39Z",
      "diff_hunk" : "@@ -589,14 +598,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(nTimeMicros);\n+            if(!result){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440676804",
      "id" : 440676804,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY3NjgwNA==",
      "original_commit_id" : "f070a97fe5abc40f93f98e241dd81c5bb43f7de5",
      "original_line" : 612,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431274533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440676804",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440677187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440677187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        if (handled < 0) {\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T08:29:12Z",
      "diff_hunk" : "@@ -589,14 +598,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440677187",
      "id" : 440677187,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY3NzE4Nw==",
      "original_commit_id" : "f070a97fe5abc40f93f98e241dd81c5bb43f7de5",
      "original_line" : 601,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 431274533,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440677187",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Ran through clang-format",
      "created_at" : "2020-06-16T13:15:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-644756699",
      "id" : 644756699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDc1NjY5OQ==",
      "updated_at" : "2020-06-16T13:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644756699",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440840706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440840706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think something has gone wrong here",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T13:16:43Z",
      "diff_hunk" : "@@ -674,8 +675,16 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n+<<<<<<< HEAD\n+    V1TransportDeserializer(const CChainParams& chain_params_in, int nTypeIn, int nVersionIn) : m_chain_params(chain_params_in), hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)\n+    {\n+||||||| parent of f070a97fe5... Remove header checks out of net_processing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440840706",
      "id" : 440840706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg0MDcwNg==",
      "original_commit_id" : "ab5fa4fe9253f88dbe2389e911906ea098f11c67",
      "original_line" : 681,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 431490571,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440840706",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@troygiorshev reviewing, will have a few more suggestions if you want to wait before retouching. Also, avoid rebasing to master if you don't need to.",
      "created_at" : "2020-06-16T13:21:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-644760725",
      "id" : 644760725,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NDc2MDcyNQ==",
      "updated_at" : "2020-06-16T13:21:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/644760725",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440850363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440850363"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oof, thanks",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T13:30:14Z",
      "diff_hunk" : "@@ -674,8 +675,16 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n+<<<<<<< HEAD\n+    V1TransportDeserializer(const CChainParams& chain_params_in, int nTypeIn, int nVersionIn) : m_chain_params(chain_params_in), hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)\n+    {\n+||||||| parent of f070a97fe5... Remove header checks out of net_processing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440850363",
      "id" : 440850363,
      "in_reply_to_id" : 440840706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1MDM2Mw==",
      "original_commit_id" : "ab5fa4fe9253f88dbe2389e911906ea098f11c67",
      "original_line" : 681,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 431503203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440850363",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440855270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440855270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@jonatack the correct fix here is below but I'll hold off on touching anything until you're ready.\r\n\r\n```suggestion\r\n    V1TransportDeserializer(const CChainParams& chain_params_in, const NodeId node_id_in, int nTypeIn, int nVersionIn) : m_chain_params(chain_params_in), node_id(node_id_in), hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)\r\n    {\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T13:36:52Z",
      "diff_hunk" : "@@ -674,8 +675,16 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n+<<<<<<< HEAD\n+    V1TransportDeserializer(const CChainParams& chain_params_in, int nTypeIn, int nVersionIn) : m_chain_params(chain_params_in), hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)\n+    {\n+||||||| parent of f070a97fe5... Remove header checks out of net_processing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r440855270",
      "id" : 440855270,
      "in_reply_to_id" : 440840706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1NTI3MA==",
      "original_commit_id" : "ab5fa4fe9253f88dbe2389e911906ea098f11c67",
      "original_line" : 681,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 431509597,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/440855270",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r441035615"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441035615"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks @troygiorshev",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-16T17:52:39Z",
      "diff_hunk" : "@@ -674,8 +675,16 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n+<<<<<<< HEAD\n+    V1TransportDeserializer(const CChainParams& chain_params_in, int nTypeIn, int nVersionIn) : m_chain_params(chain_params_in), hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)\n+    {\n+||||||| parent of f070a97fe5... Remove header checks out of net_processing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r441035615",
      "id" : 441035615,
      "in_reply_to_id" : 440840706,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNTYxNQ==",
      "original_commit_id" : "ab5fa4fe9253f88dbe2389e911906ea098f11c67",
      "original_line" : 681,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 431752760,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441035615",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I realized I had left this in a terribly broken state.  Fixed now, just with clang-format (done correctly this time).  Compare between f070a97fe5abc40f93f98e241dd81c5bb43f7de5 and 3a9d277fc0cb9247ec14350d43ecc9f7825aadd2.\r\n\r\n@jonatack I think you were reviewing on f070a97fe5abc40f93f98e241dd81c5bb43f7de5, feel free to continue there and I'll integrate your suggestions.",
      "created_at" : "2020-06-17T17:12:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-645504819",
      "id" : 645504819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTUwNDgxOQ==",
      "updated_at" : "2020-06-17T17:12:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645504819",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r441713142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441713142"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This PR doesn't change behaviour at all, so I think questions about whether or not to drop connections for different errors is off-topic and should be saved for PRs that change behaviour!",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-17T17:33:54Z",
      "diff_hunk" : "@@ -589,14 +599,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0){\n+            LogPrint(BCLog::NET, \"HEADER ERROR peer=%d\\n\", id);\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r441713142",
      "id" : 441713142,
      "in_reply_to_id" : 438897822,
      "line" : 608,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxMzE0Mg==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 608,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 32,
      "pull_request_review_id" : 432624325,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441713142",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@troygiorshev this PR has been rebased on master once again, which renders git diff f070a97 3a9d277 useless (and git range-diff 35ed88f f070a97 3a9d277 isn't much better). If you're not required to rebase on master, it would save time for re-reviewers to just force-push without rebasing on master. Otherwise, we essentially have to begin reviewing again from zero.",
      "created_at" : "2020-06-18T06:54:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-645818326",
      "id" : 645818326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTgxODMyNg==",
      "updated_at" : "2020-06-18T06:54:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645818326",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe I'm missing another good way to see the diff, but ISTM what you want is for reviewers to be able to see the changes easily like https://github.com/bitcoin/bitcoin/pull/19237#issuecomment-645396990 without restarting from scratch.",
      "created_at" : "2020-06-18T07:06:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-645824006",
      "id" : 645824006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NTgyNDAwNg==",
      "updated_at" : "2020-06-18T07:06:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/645824006",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442024516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442024516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "e0d316d nit: s/Set True/True|Set to true/\r\n\r\nCould squash this commit into one of the others.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T07:32:13Z",
      "diff_hunk" : "@@ -579,6 +578,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer\n+ * @param[in]   nBytes      Size of the socket buffer\n+ * @param[out]  complete    Set True if a message has been deserialized and is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442024516",
      "id" : 442024516,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyNDUxNg==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 586,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442024516",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442057387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442057387"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1596652 style nit, feel free to ignore\r\n```suggestion\r\n            Optional<CNetMessage> result{m_deserializer->GetMessage(nTimeMicros)};\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T08:29:14Z",
      "diff_hunk" : "@@ -589,14 +598,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(nTimeMicros);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442057387",
      "id" : 442057387,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA1NzM4Nw==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 611,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442057387",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442071499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442071499"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3a9d277f All this reformatting of the section seems ok but I'm not sure if it's a good idea to change the formatting of critical code that's not being directly changed.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T08:51:45Z",
      "diff_hunk" : "@@ -113,31 +113,25 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n-    for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n-    {\n-        if (*p1 == 0)\n-        {\n+    for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; ++p1) {\n+        if (*p1 == 0) {\n             // Must be all zeros after the first zero\n-            for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+            for (; p1 < pchCommand + COMMAND_SIZE; ++p1) {\n+                if (*p1 != 0) {\n                     return false;\n-        }\n-        else if (*p1 < ' ' || *p1 > 0x7E)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442071499",
      "id" : 442071499,
      "line" : 130,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA3MTQ5OQ==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 130,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : 37,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442071499",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442086586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442086586"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3a9d277\r\n```suggestion\r\n        with self.nodes[0].assert_debug_log(['HEADER ERROR - SIZE (badmsg, 4000001 bytes)']):\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T09:15:46Z",
      "diff_hunk" : "@@ -73,7 +73,7 @@ def test_checksum(self):\n \n     def test_size(self):\n         conn = self.nodes[0].add_p2p_connection(P2PDataStore())\n-        with self.nodes[0].assert_debug_log(['']):\n+        with self.nodes[0].assert_debug_log(['HEADER ERROR - SIZE']):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442086586",
      "id" : 442086586,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4NjU4Ng==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 76,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442086586",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442088523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442088523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3a9d277 Is there somewhere suitable this documentation can be moved to rather than be tossed out?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T09:19:06Z",
      "diff_hunk" : "@@ -3536,14 +3536,6 @@ bool PeerLogicValidation::CheckIfBanned(CNode* pnode)\n bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& interruptMsgProc)\n {\n     const CChainParams& chainparams = Params();\n-    //\n-    // Message format\n-    //  (4) message start\n-    //  (12) command\n-    //  (4) size\n-    //  (4) checksum\n-    //  (x) data\n-    //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442088523",
      "id" : 442088523,
      "in_reply_to_id" : 433147490,
      "line" : 3834,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4ODUyMw==",
      "original_commit_id" : "598e6d3f2c945d6ff00fbc39390ddf3c4b42493d",
      "original_line" : 3834,
      "original_position" : 11,
      "original_start_line" : 3539,
      "path" : "src/net_processing.cpp",
      "position" : 11,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : 3827,
      "start_side" : "LEFT",
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442088523",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442104342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442104342"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3a9d277\r\n```suggestion\r\n        with self.nodes[0].assert_debug_log(['HEADER ERROR - MESSAGESTART (badmsg, 2 bytes), got ffffffff']):\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T09:46:19Z",
      "diff_hunk" : "@@ -51,7 +51,7 @@ def run_test(self):\n \n     def test_magic_bytes(self):\n         conn = self.nodes[0].add_p2p_connection(P2PDataStore())\n-        with self.nodes[0].assert_debug_log(['PROCESSMESSAGE: INVALID MESSAGESTART badmsg']):\n+        with self.nodes[0].assert_debug_log(['HEADER ERROR - MESSAGESTART']):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442104342",
      "id" : 442104342,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEwNDM0Mg==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 54,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : null,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442104342",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442106004"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442106004"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3a9d277\r\n```suggestion\r\n        with self.nodes[0].assert_debug_log(['HEADER ERROR - COMMAND (bad, 2 bytes)']):\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T09:49:16Z",
      "diff_hunk" : "@@ -83,9 +83,8 @@ def test_size(self):\n \n     def test_msgtype(self):\n         conn = self.nodes[0].add_p2p_connection(P2PDataStore())\n-        with self.nodes[0].assert_debug_log(['PROCESSMESSAGE: ERRORS IN HEADER']):\n+        with self.nodes[0].assert_debug_log(['HEADER ERROR - COMMAND']):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442106004",
      "id" : 442106004,
      "line" : 118,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEwNjAwNA==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 118,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : 23,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442106004",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442109185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442109185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style nit, feel free to ignore\r\n```suggestion\r\n            CNetMessage msg{*result};\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T09:54:46Z",
      "diff_hunk" : "@@ -589,14 +598,22 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(nTimeMicros);\n+            if (!result) {\n+                // Message deserialization failed.  Drop the message but don't disconnect the peer.\n+                continue;\n+            }\n+            CNetMessage msg = *result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442109185",
      "id" : 442109185,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEwOTE4NQ==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 616,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433012545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442109185",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442113739"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442113739"
         }
      },
      "author_association" : "MEMBER",
      "body" : "5ad7ce1 and 3a9d277 I agree with @jnewbery here about the multiple Resets. Maybe something like this would be cleaner (tested example):\r\n```diff\r\n-    // Check checksum\r\n-    // Always reset the network deserializer (prepare for the next message)\r\n+    Optional<CNetMessage> result{};\r\n     if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\r\n         LogPrint(BCLog::NET, \"CHECKSUM ERROR ... ;\r\n-        Reset();\r\n-        return nullopt;\r\n-    }\r\n-    // Check header command string\r\n-    if (!hdr.IsCommandValid()) {\r\n+    } else if (!hdr.IsCommandValid()) {\r\n         LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND ... ;\r\n-        Reset();\r\n-        return nullopt;\r\n+    } else {\r\n+        result = msg;\r\n     }\r\n-\r\n+    // Reset the network deserializer (prepare for the next message).\r\n     Reset();\r\n-    return msg;\r\n+    return result;\r\n``` ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T10:02:44Z",
      "diff_hunk" : "@@ -699,35 +724,41 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum\n+    // Always reset the network deserializer (prepare for the next message)\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442113739",
      "id" : 442113739,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjExMzczOQ==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 751,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433131131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442113739",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442124225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442124225"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), received %s, peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, HexStr(hdr.GetMessageStart()), node_id);\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T10:21:30Z",
      "diff_hunk" : "@@ -660,11 +677,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE, peer=%d\\n\", node_id);\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, m_chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), got %s, peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, HexStr(hdr.GetMessageStart()), node_id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442124225",
      "id" : 442124225,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEyNDIyNQ==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 686,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433144919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442124225",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442402026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442402026"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is done in response to https://github.com/bitcoin/bitcoin/pull/19107#discussion_r439500348",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T17:52:26Z",
      "diff_hunk" : "@@ -113,31 +113,25 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n-bool CMessageHeader::IsValid(const MessageStartChars& pchMessageStartIn) const\n+std::string CMessageHeader::GetMessageStart() const\n {\n-    // Check start string\n-    if (memcmp(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE) != 0)\n-        return false;\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));\n+}\n \n+bool CMessageHeader::IsCommandValid() const\n+{\n     // Check the command string for errors\n-    for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; p1++)\n-    {\n-        if (*p1 == 0)\n-        {\n+    for (const char* p1 = pchCommand; p1 < pchCommand + COMMAND_SIZE; ++p1) {\n+        if (*p1 == 0) {\n             // Must be all zeros after the first zero\n-            for (; p1 < pchCommand + COMMAND_SIZE; p1++)\n-                if (*p1 != 0)\n+            for (; p1 < pchCommand + COMMAND_SIZE; ++p1) {\n+                if (*p1 != 0) {\n                     return false;\n-        }\n-        else if (*p1 < ' ' || *p1 > 0x7E)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442402026",
      "id" : 442402026,
      "in_reply_to_id" : 442071499,
      "line" : 130,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwMjAyNg==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 130,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : 37,
      "pull_request_review_id" : 433516639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442402026",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442422435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442422435"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the tested example!  I'm looking deeper into how Optional is implemented.  It looks like we don't have move semantics until before Boost 1.56.0.  I'm worried about the performance hit if we're copying a CNetMessage every time.\r\n\r\nIf I don't find anything important there, then I'll use this suggestion for sure.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T18:29:52Z",
      "diff_hunk" : "@@ -699,35 +724,41 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum\n+    // Always reset the network deserializer (prepare for the next message)\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442422435",
      "id" : 442422435,
      "in_reply_to_id" : 442113739,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQyMjQzNQ==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 751,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433543211,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442422435",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442433717"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442433717"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIRC `return result;` should always move if it is possible. All recent OS as well as the binaries on the website come with a version of boost greater than 1.56. I think we don't care about reduced performance when someone compiles on a historic OS.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T18:51:05Z",
      "diff_hunk" : "@@ -699,35 +724,41 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum\n+    // Always reset the network deserializer (prepare for the next message)\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442433717",
      "id" : 442433717,
      "in_reply_to_id" : 442113739,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzMzcxNw==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 751,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433557970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442433717",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442434314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442434314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "See also commit ff9c671b11d40e5d0623eff3dd12e48cbaafb34e",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T18:52:15Z",
      "diff_hunk" : "@@ -699,35 +724,41 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum\n+    // Always reset the network deserializer (prepare for the next message)\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442434314",
      "id" : 442434314,
      "in_reply_to_id" : 442113739,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNDMxNA==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 751,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433558772,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442434314",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442488620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442488620"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sounds good to me!",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-18T20:37:42Z",
      "diff_hunk" : "@@ -699,35 +724,41 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum\n+    // Always reset the network deserializer (prepare for the next message)\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442488620",
      "id" : 442488620,
      "in_reply_to_id" : 442113739,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4ODYyMA==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 751,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 433629010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442488620",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442589490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442589490"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm going to leave this one.  The reason the command is wrong is not because it's an unrecognized command, it's because it isn't validly constructed.  It ends up being `bad\\x00sg\\x00\\x00\\x00\\x00\\x00\\x00` which doesn't pass the \"once you have a `\\x00` all remaining chars must be `\\x00`\" test.  One day it might be nice to change all of these tests so that they send recognized commands, and then check for that separately.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-19T01:52:16Z",
      "diff_hunk" : "@@ -83,9 +83,8 @@ def test_size(self):\n \n     def test_msgtype(self):\n         conn = self.nodes[0].add_p2p_connection(P2PDataStore())\n-        with self.nodes[0].assert_debug_log(['PROCESSMESSAGE: ERRORS IN HEADER']):\n+        with self.nodes[0].assert_debug_log(['HEADER ERROR - COMMAND']):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442589490",
      "id" : 442589490,
      "in_reply_to_id" : 442106004,
      "line" : 118,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4OTQ5MA==",
      "original_commit_id" : "3a9d277fc0cb9247ec14350d43ecc9f7825aadd2",
      "original_line" : 118,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/p2p_invalid_messages.py",
      "position" : 23,
      "pull_request_review_id" : 433753310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442589490",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-06-19T10:24:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-646560431",
      "id" : 646560431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjU2MDQzMQ==",
      "updated_at" : "2020-06-19T10:24:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646560431",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442851451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442851451"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 5ad7ce11027536fb6e48098db9659744514a7fc2:\r\n\r\nWhy is this copy and alias of the message needed?\r\n\r\n* `msg.` occurs only twice, so I think simply replacing `msg.` with `msg->` should be preferable to copying the whole message (or even adding a convenience alias (reference) to it).",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-19T13:48:59Z",
      "diff_hunk" : "@@ -589,14 +589,20 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            if (!result) {\n+                continue;\n+            }\n+            CNetMessage msg = *result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442851451",
      "id" : 442851451,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MTQ1MQ==",
      "original_commit_id" : "5ad7ce11027536fb6e48098db9659744514a7fc2",
      "original_line" : 605,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 434091920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442851451",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442852609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442852609"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 5ad7ce1:\r\n\r\nI still see `Reset` in both exit branches. Has this been addressed?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-19T13:51:05Z",
      "diff_hunk" : "@@ -699,29 +725,35 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time) {\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // Check the header\n+    if (!hdr.IsCommandValid()){\n+        Reset();\n+        return nullopt;\n+    }\n \n     // store command string, payload size\n     msg.m_command = hdr.GetCommand();\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n+    // Check checksum\n+    bool valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n+    if (!valid_checksum) {\n         LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n                  SanitizeString(msg.m_command), msg.m_message_size,\n                  HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n                  HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+        Reset();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442852609",
      "id" : 442852609,
      "in_reply_to_id" : 439489550,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MjYwOQ==",
      "original_commit_id" : "d8cbdc4adfc67ac7b12f0cc27d3e42722cac6994",
      "original_line" : 758,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 434091920,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442852609",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased.  Changes coming soon.",
      "created_at" : "2020-06-19T14:59:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-646683964",
      "id" : 646683964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NjY4Mzk2NA==",
      "updated_at" : "2020-06-19T14:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/646683964",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443545943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443545943"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In my mind this was the safe way to use an optional (immediately check the optional and resolve it to a real object).  In this case though I've checked and what you've suggested both works and looks clear, so I'll go with it.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T13:10:04Z",
      "diff_hunk" : "@@ -589,14 +589,20 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            Optional<CNetMessage> result = m_deserializer->GetMessage(Params().MessageStart(), nTimeMicros);\n+            if (!result) {\n+                continue;\n+            }\n+            CNetMessage msg = *result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443545943",
      "id" : 443545943,
      "in_reply_to_id" : 442851451,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NTk0Mw==",
      "original_commit_id" : "5ad7ce11027536fb6e48098db9659744514a7fc2",
      "original_line" : 605,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 434906126,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443545943",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Made suggested changes.  (Note Optional justification [here](https://github.com/bitcoin/bitcoin/pull/19107#discussion_r442433717)).  Sorry for the mess with the rebasing.  Everything is nice and ready for review",
      "created_at" : "2020-06-22T13:27:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-647518988",
      "id" : 647518988,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzUxODk4OA==",
      "updated_at" : "2020-06-24T15:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647518988",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443620026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443620026"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since `msg` is not an rvalue, I think this will always do a copy assignment. Have you tried:\r\n\r\n`result = std::move(msg)`\r\n\r\n?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T14:54:55Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum and header command string\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+    } else if (!hdr.IsCommandValid()) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes), peer=%d\\n\",\n+            hdr.GetCommand(), msg.m_message_size, node_id);\n+    } else {\n+        result = msg;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443620026",
      "id" : 443620026,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYyMDAyNg==",
      "original_commit_id" : "e62961887aa636d1277d71f11fc6c64431f1fc52",
      "original_line" : 754,
      "original_position" : 128,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 435005118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443620026",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443691442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443691442"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Tested and I can confirm that you're right on both accounts.  Additionally, since `std::is_move_constructible<CNetMessage>::value == true` we can be reasonably sure that the Optional is being move constructed (from [this boost doc](https://www.boost.org/doc/libs/1_65_1/libs/optional/doc/html/boost_optional/tutorial/type_requirements.html))",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T16:42:29Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum and header command string\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+    } else if (!hdr.IsCommandValid()) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes), peer=%d\\n\",\n+            hdr.GetCommand(), msg.m_message_size, node_id);\n+    } else {\n+        result = msg;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443691442",
      "id" : 443691442,
      "in_reply_to_id" : 443620026,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY5MTQ0Mg==",
      "original_commit_id" : "e62961887aa636d1277d71f11fc6c64431f1fc52",
      "original_line" : 754,
      "original_position" : 128,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 435099734,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443691442",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "GetMessage now move constructs the optional.\r\n\r\nI've also finally figured out why I keep inadvertently rebasing.  Sorry everyone, wont happen again ",
      "created_at" : "2020-06-22T16:46:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-647640816",
      "id" : 647640816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0NzY0MDgxNg==",
      "updated_at" : "2020-06-22T19:29:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/647640816",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443768676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443768676"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: name `m_node_id` to comply with [style guidelines](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#coding-style-c)",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T19:08:47Z",
      "diff_hunk" : "@@ -642,13 +641,15 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(int64_t time) = 0;\n     virtual ~TransportDeserializer() {}\n };\n \n class V1TransportDeserializer final : public TransportDeserializer\n {\n private:\n+    const CChainParams& m_chain_params;\n+    const NodeId node_id; // Only for logging",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443768676",
      "id" : 443768676,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2ODY3Ng==",
      "original_commit_id" : "ca824dd3d89255bf1d81c8cc22d83fdb02cc935d",
      "original_line" : 652,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 435199857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443768676",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443777031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443777031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Alternatively, rather than having both a `CNetMessage` and `Optional<CNetMessage>`:\r\n\r\n```diff\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex c23cf54c75..7cc5068a75 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -726,14 +726,13 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\r\n Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\r\n {\r\n     // decompose a single CNetMessage from the TransportDeserializer\r\n-    CNetMessage msg(std::move(vRecv));\r\n-    Optional<CNetMessage> result{};\r\n+    Optional<CNetMessage> msg(std::move(vRecv));\r\n \r\n     // store command string, time, and sizes\r\n-    msg.m_command = hdr.GetCommand();\r\n-    msg.m_time = time;\r\n-    msg.m_message_size = hdr.nMessageSize;\r\n-    msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\r\n+    msg->m_command = hdr.GetCommand();\r\n+    msg->m_time = time;\r\n+    msg->m_message_size = hdr.nMessageSize;\r\n+    msg->m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\r\n \r\n     uint256 hash = GetMessageHash();\r\n \r\n@@ -743,20 +742,20 @@ Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\r\n     // Check checksum and header command string\r\n     if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\r\n         LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\r\n-            SanitizeString(msg.m_command), msg.m_message_size,\r\n+            SanitizeString(msg->m_command), msg->m_message_size,\r\n             HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\r\n             HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\r\n             node_id);\r\n+        msg = nullopt;\r\n     } else if (!hdr.IsCommandValid()) {\r\n         LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes), peer=%d\\n\",\r\n-            hdr.GetCommand(), msg.m_message_size, node_id);\r\n-    } else {\r\n-        result = std::move(msg);\r\n+            hdr.GetCommand(), msg->m_message_size, node_id);\r\n+        msg = nullopt;\r\n     }\r\n \r\n     // Always reset the network deserializer (prepare for the next message)\r\n     Reset();\r\n-    return result;\r\n+    return msg;\r\n }\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T19:26:11Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443777031",
      "id" : 443777031,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzAzMQ==",
      "original_commit_id" : "ca824dd3d89255bf1d81c8cc22d83fdb02cc935d",
      "original_line" : 730,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 435199857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443777031",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443781545"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443781545"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Furthermore, by checking msg.m_recv.data() and result->m_recv.data() before the assignment, after the assignment, and after the method return, we can be absolutely sure that it's move constructing.\r\n\r\n(and indeed I have, and indeed it is!)",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T19:35:42Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n-\n-    // store command string, payload size\n+    // store command string, time, and sizes\n     msg.m_command = hdr.GetCommand();\n+    msg.m_time = time;\n     msg.m_message_size = hdr.nMessageSize;\n     msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n+    uint256 hash = GetMessageHash();\n+\n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n-                 HexStr(hash.begin(), hash.begin()+CMessageHeader::CHECKSUM_SIZE),\n-                 HexStr(hdr.pchChecksum, hdr.pchChecksum+CMessageHeader::CHECKSUM_SIZE));\n+    // Check checksum and header command string\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+            SanitizeString(msg.m_command), msg.m_message_size,\n+            HexStr(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE),\n+            HexStr(hdr.pchChecksum, hdr.pchChecksum + CMessageHeader::CHECKSUM_SIZE),\n+            node_id);\n+    } else if (!hdr.IsCommandValid()) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes), peer=%d\\n\",\n+            hdr.GetCommand(), msg.m_message_size, node_id);\n+    } else {\n+        result = msg;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443781545",
      "id" : 443781545,
      "in_reply_to_id" : 443620026,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4MTU0NQ==",
      "original_commit_id" : "e62961887aa636d1277d71f11fc6c64431f1fc52",
      "original_line" : 754,
      "original_position" : 128,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 435216327,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443781545",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443787288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443787288"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm happy with this pattern if everyone else is (@jonatack).  It's the \"reverse\" of before.  Now we're assuming success and have to set failure.  I think this is clearer.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-22T19:48:06Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r443787288",
      "id" : 443787288,
      "in_reply_to_id" : 443777031,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4NzI4OA==",
      "original_commit_id" : "ca824dd3d89255bf1d81c8cc22d83fdb02cc935d",
      "original_line" : 730,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 435223907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443787288",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r444636252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444636252"
         }
      },
      "author_association" : "MEMBER",
      "body" : "LGTM",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-24T04:22:07Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r444636252",
      "id" : 444636252,
      "in_reply_to_id" : 443777031,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYzNjI1Mg==",
      "original_commit_id" : "ca824dd3d89255bf1d81c8cc22d83fdb02cc935d",
      "original_line" : 730,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 436313991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444636252",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r444812167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444812167"
         }
      },
      "author_association" : "MEMBER",
      "body" : "LGTM",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-24T10:57:13Z",
      "diff_hunk" : "@@ -699,37 +723,40 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) {\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(int64_t time)\n+{\n     // decompose a single CNetMessage from the TransportDeserializer\n     CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> result{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r444812167",
      "id" : 444812167,
      "in_reply_to_id" : 443777031,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxMjE2Nw==",
      "original_commit_id" : "ca824dd3d89255bf1d81c8cc22d83fdb02cc935d",
      "original_line" : 730,
      "original_position" : 92,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 436538713,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444812167",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r444921525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444921525"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "One day I'll remember, thanks!",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-24T14:09:30Z",
      "diff_hunk" : "@@ -642,13 +641,15 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, int64_t time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(int64_t time) = 0;\n     virtual ~TransportDeserializer() {}\n };\n \n class V1TransportDeserializer final : public TransportDeserializer\n {\n private:\n+    const CChainParams& m_chain_params;\n+    const NodeId node_id; // Only for logging",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r444921525",
      "id" : 444921525,
      "in_reply_to_id" : 443768676,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkyMTUyNQ==",
      "original_commit_id" : "ca824dd3d89255bf1d81c8cc22d83fdb02cc935d",
      "original_line" : 652,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 436683826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444921525",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Made suggested changes and two renames.  Should be easy to to re-review with `git range-diff master ca824dd 20f4da6`",
      "created_at" : "2020-06-24T14:36:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-648860671",
      "id" : 648860671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODg2MDY3MQ==",
      "updated_at" : "2020-06-29T20:35:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648860671",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Trivial rebase `git range-diff master 20f4da6 2ac16b1`",
      "created_at" : "2020-06-24T21:30:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-649083403",
      "id" : 649083403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTA4MzQwMw==",
      "updated_at" : "2020-06-24T21:30:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/649083403",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 2ac16b110b",
      "created_at" : "2020-06-25T19:07:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-649764112",
      "id" : 649764112,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTc2NDExMg==",
      "updated_at" : "2020-06-25T19:07:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/649764112",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446202431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446202431"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit  cecb5e329a26455f44dde39a4ffac82c4869ce2a\r\n\r\nIt appears that the peer id is no longer logged for invalid checksums. Doesn't this make it harder to debug checksum issues because it is now impossible to determine the peer id?\r\n\r\nPrevious log:\r\n\r\n```\r\n[net] CHECKSUM ERROR (msg_type, baz bytes), expected foo was bar\r\n[msghand] ProcessMessages(msg_type, baz bytes): CHECKSUM ERROR peer=id\r\n```\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:00:27Z",
      "diff_hunk" : "@@ -3660,17 +3660,8 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     // Message size\n     unsigned int nMessageSize = msg.m_message_size;\n \n-    // Checksum\n-    CDataStream& vRecv = msg.m_recv;\n-    if (!msg.m_valid_checksum)\n-    {\n-        LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR peer=%d\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446202431",
      "id" : 446202431,
      "line" : 3897,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMjQzMQ==",
      "original_commit_id" : "cecb5e329a26455f44dde39a4ffac82c4869ce2a",
      "original_line" : 3897,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 41,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446202431",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446209407"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446209407"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in commit cecb5e329a26455f44dde39a4ffac82c4869ce2a\r\n\r\n```suggestion\r\n                const CNetMessage& msg = *result;\r\n```\r\n\r\ncan be a reference to a avoid the copy",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:12:38Z",
      "diff_hunk" : "@@ -31,16 +31,19 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         n_bytes -= handled;\n         if (deserializer.Complete()) {\n             const int64_t m_time = std::numeric_limits<int64_t>::max();\n-            const CNetMessage msg = deserializer.GetMessage(Params().MessageStart(), m_time);\n-            assert(msg.m_command.size() <= CMessageHeader::COMMAND_SIZE);\n-            assert(msg.m_raw_message_size <= buffer.size());\n-            assert(msg.m_raw_message_size == CMessageHeader::HEADER_SIZE + msg.m_message_size);\n-            assert(msg.m_time == m_time);\n-            if (msg.m_valid_header) {\n-                assert(msg.m_valid_netmagic);\n-            }\n-            if (!msg.m_valid_netmagic) {\n-                assert(!msg.m_valid_header);\n+            auto result = deserializer.GetMessage(Params().MessageStart(), m_time);\n+            if (result) {\n+                const CNetMessage msg = *result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446209407",
      "id" : 446209407,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwOTQwNw==",
      "original_commit_id" : "cecb5e329a26455f44dde39a4ffac82c4869ce2a",
      "original_line" : 36,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/fuzz/p2p_transport_deserializer.cpp",
      "position" : null,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446209407",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446215071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446215071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 9d5ba871fcba17038236a660e231022d11b769bc:\r\n\r\nI don't think this method cares where the data is from. It can be any pointer that points to initialized data.\r\n\r\n```suggestion\r\n * @param[in]   pch         A pointer to the raw data\r\n```\r\n\r\nSide note: (in the future) this could probably be changed to a Span, so that the pointer and size are passed in the same argument for clarity",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:22:45Z",
      "diff_hunk" : "@@ -579,6 +579,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446215071",
      "id" : 446215071,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIxNTA3MQ==",
      "original_commit_id" : "9d5ba871fcba17038236a660e231022d11b769bc",
      "original_line" : 585,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446215071",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446217169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446217169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 9d5ba87:\r\n\r\n```suggestion\r\n * @param[out]  complete    Set True if at least one message has been deserialized and is\r\n```\r\n\r\nCould make this a bit more verbose for clarity?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:26:14Z",
      "diff_hunk" : "@@ -579,6 +579,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer\n+ * @param[in]   nBytes      Size of the socket buffer\n+ * @param[out]  complete    Set True if a message has been deserialized and is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446217169",
      "id" : 446217169,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIxNzE2OQ==",
      "original_commit_id" : "9d5ba871fcba17038236a660e231022d11b769bc",
      "original_line" : 587,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446217169",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446220814"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446220814"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 8a492c8aef\r\n\r\nThis is unused, no?\r\n\r\n```suggestion\r\n    V1TransportDeserializer(int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:32:07Z",
      "diff_hunk" : "@@ -674,8 +674,8 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n-\n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\n+    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446220814",
      "id" : 446220814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMDgxNA==",
      "original_commit_id" : "8a492c8aef43e4ddc90332a231f4cb9403a1710e",
      "original_line" : 677,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446220814",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446224020"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446224020"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit In commit ef99b3bfbca87ef727c34f9ffedf50139a223086\r\n\r\nWhy is this removed? I think every file needs to include everything it uses. Otherwise, removing it from the header file might break compilation in the cpp file.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:37:40Z",
      "diff_hunk" : "@@ -10,7 +10,6 @@\n #include <net.h>\n \n #include <banman.h>\n-#include <chainparams.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446224020",
      "id" : 446224020,
      "line" : 13,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyNDAyMA==",
      "original_commit_id" : "ef99b3bfbca87ef727c34f9ffedf50139a223086",
      "original_line" : 13,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446224020",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446234628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446234628"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 3f5a7306e941bd9bcd50afeb0e0a9fce46f22fd1\r\n\r\nIt seems confusing to make the magic bytes variable length. Unlike the message type they are not padded with zeros. See also https://btcinformation.org/en/developer-reference#message-headers\r\n\r\nWhat do you think about returning a span (or a raw byte vector if there are concerns about life-time)?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T14:55:17Z",
      "diff_hunk" : "@@ -113,6 +113,11 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n+std::string CMessageHeader::GetMessageStart() const\n+{\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446234628",
      "id" : 446234628,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzNDYyOA==",
      "original_commit_id" : "3f5a7306e941bd9bcd50afeb0e0a9fce46f22fd1",
      "original_line" : 118,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446234628",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446242955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446242955"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in commit 2ac16b110b\r\n\r\nAdding logging is great, but I don't think this counts as a refactor. Also, the tests seem to require some changes, so maybe change the \"without changing behavior\" to something like \"add logging\" in the pull request title?",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T15:09:40Z",
      "diff_hunk" : "@@ -674,11 +676,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE, peer=%d\\n\", m_node_id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446242955",
      "id" : 446242955,
      "line" : 687,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0Mjk1NQ==",
      "original_commit_id" : "2ac16b110bd64e655fed0048e22bf5b926de20e7",
      "original_line" : 687,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 70,
      "pull_request_review_id" : 438320333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446242955",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446245457"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446245457"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see in the last commit you add `+    const NodeId m_node_id; // Only for logging`\r\n\r\nMaybe this addition could be moved to the first commit? It will be slightly painful due to the conflicts that will need to be solved, but I think it will be worth it",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T15:13:52Z",
      "diff_hunk" : "@@ -3660,17 +3660,8 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     // Message size\n     unsigned int nMessageSize = msg.m_message_size;\n \n-    // Checksum\n-    CDataStream& vRecv = msg.m_recv;\n-    if (!msg.m_valid_checksum)\n-    {\n-        LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR peer=%d\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446245457",
      "id" : 446245457,
      "in_reply_to_id" : 446202431,
      "line" : 3897,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0NTQ1Nw==",
      "original_commit_id" : "cecb5e329a26455f44dde39a4ffac82c4869ce2a",
      "original_line" : 3897,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 41,
      "pull_request_review_id" : 438379092,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446245457",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446252776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446252776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, if you decide to change this, maybe this very long line could be split up into two (or more) lines:\r\n\r\nE.g.\r\n\r\n```diff\r\ndiff --git a/src/net.h b/src/net.h\r\nindex b461470f1f..ba2d2fad27 100644\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -674,8 +674,11 @@ private:\r\n     }\r\n \r\n public:\r\n-\r\n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\r\n+    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn)\r\n+        : hdrbuf(nTypeIn, nVersionIn),\r\n+          hdr(pchMessageStartIn),\r\n+          vRecv(nTypeIn, nVersionIn)\r\n+    {\r\n         Reset();\r\n     }\r\n \r\n```\r\n\r\nor \r\n\r\n```diff\r\ndiff --git a/src/net.h b/src/net.h\r\nindex b461470f1f..1d99f2608b 100644\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -674,8 +674,9 @@ private:\r\n     }\r\n \r\n public:\r\n-\r\n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\r\n+    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn)\r\n+        : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn)\r\n+    {\r\n         Reset();\r\n     }\r\n \r\n\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-26T15:26:52Z",
      "diff_hunk" : "@@ -674,8 +674,8 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n-\n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\n+    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446252776",
      "id" : 446252776,
      "in_reply_to_id" : 446220814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1Mjc3Ng==",
      "original_commit_id" : "8a492c8aef43e4ddc90332a231f4cb9403a1710e",
      "original_line" : 677,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 438389058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/446252776",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As always, feel free to ignore the part of my feedback that is of stylistic nature only",
      "created_at" : "2020-06-26T15:27:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-650241142",
      "id" : 650241142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MDI0MTE0Mg==",
      "updated_at" : "2020-06-26T15:27:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/650241142",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "6b33f25ff9 is a new commit, then the rest should be ok to re-review with `git range-diff master 2ac16b1 da5bb91`\r\n\r\n[This](https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446220814) (remove unneeded parameter to V1TransportDeserializer constructor in one commit) is dealt with, and the line cleaned up.\r\n\r\n> I see in the last commit you add `const NodeId m_node_id; // Only for logging`\r\n> Maybe this addition could be moved to the first commit? It will be slightly painful due to the conflicts that will need to be solved, but I think it will be worth it\r\n\r\nDone, in its own new commit right at the beginning.  This cleans things up nicely.\r\n\r\n> nit in commit cecb5e3 \r\n> - const CNetMessage msg = *result;\r\n> + const CNetMessage& msg = *result;\r\n> To avoid the copy\r\n\r\nI've changed this so that it uses list initialization instead and then reaches inside the optional.  Now it's consistent with the \"real\" code in net.cpp.\r\n",
      "created_at" : "2020-06-29T19:27:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-651313486",
      "id" : 651313486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTMxMzQ4Ng==",
      "updated_at" : "2020-06-29T19:27:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651313486",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447201761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447201761"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Moving it to the beginning was well worth it.  The peer id is now present in all of this logging (and everything is just a little cleaner).",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-29T19:27:32Z",
      "diff_hunk" : "@@ -3660,17 +3660,8 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     // Message size\n     unsigned int nMessageSize = msg.m_message_size;\n \n-    // Checksum\n-    CDataStream& vRecv = msg.m_recv;\n-    if (!msg.m_valid_checksum)\n-    {\n-        LogPrint(BCLog::NET, \"%s(%s, %u bytes): CHECKSUM ERROR peer=%d\\n\", __func__,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447201761",
      "id" : 447201761,
      "in_reply_to_id" : 446202431,
      "line" : 3897,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIwMTc2MQ==",
      "original_commit_id" : "cecb5e329a26455f44dde39a4ffac82c4869ce2a",
      "original_line" : 3897,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 41,
      "pull_request_review_id" : 439436537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447201761",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447202126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447202126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "+1 to one day making this a span",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-29T19:28:17Z",
      "diff_hunk" : "@@ -579,6 +579,16 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n }\n #undef X\n \n+/**\n+ * Receive bytes from the buffer and deserialize them into messages.\n+ *\n+ * @param[in]   pch         Socket buffer",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447202126",
      "id" : 447202126,
      "in_reply_to_id" : 446215071,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIwMjEyNg==",
      "original_commit_id" : "9d5ba871fcba17038236a660e231022d11b769bc",
      "original_line" : 585,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 439436984,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447202126",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447202293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447202293"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've changed this so that it uses list initialization instead and then reaches inside the optional.  Now it's consistent with the \"real\" code in net.cpp.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-29T19:28:34Z",
      "diff_hunk" : "@@ -31,16 +31,19 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n         n_bytes -= handled;\n         if (deserializer.Complete()) {\n             const int64_t m_time = std::numeric_limits<int64_t>::max();\n-            const CNetMessage msg = deserializer.GetMessage(Params().MessageStart(), m_time);\n-            assert(msg.m_command.size() <= CMessageHeader::COMMAND_SIZE);\n-            assert(msg.m_raw_message_size <= buffer.size());\n-            assert(msg.m_raw_message_size == CMessageHeader::HEADER_SIZE + msg.m_message_size);\n-            assert(msg.m_time == m_time);\n-            if (msg.m_valid_header) {\n-                assert(msg.m_valid_netmagic);\n-            }\n-            if (!msg.m_valid_netmagic) {\n-                assert(!msg.m_valid_header);\n+            auto result = deserializer.GetMessage(Params().MessageStart(), m_time);\n+            if (result) {\n+                const CNetMessage msg = *result;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447202293",
      "id" : 447202293,
      "in_reply_to_id" : 446209407,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIwMjI5Mw==",
      "original_commit_id" : "cecb5e329a26455f44dde39a4ffac82c4869ce2a",
      "original_line" : 36,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/fuzz/p2p_transport_deserializer.cpp",
      "position" : null,
      "pull_request_review_id" : 439437185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447202293",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447202463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447202463"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good eye.  Fixed and cleaned.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-29T19:28:51Z",
      "diff_hunk" : "@@ -674,8 +674,8 @@ class V1TransportDeserializer final : public TransportDeserializer\n     }\n \n public:\n-\n-    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), hdr(pchMessageStartIn), vRecv(nTypeIn, nVersionIn) {\n+    V1TransportDeserializer(const CMessageHeader::MessageStartChars& pchMessageStartIn, int nTypeIn, int nVersionIn) : hdrbuf(nTypeIn, nVersionIn), vRecv(nTypeIn, nVersionIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447202463",
      "id" : 447202463,
      "in_reply_to_id" : 446220814,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIwMjQ2Mw==",
      "original_commit_id" : "8a492c8aef43e4ddc90332a231f4cb9403a1710e",
      "original_line" : 677,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 439437370,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447202463",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "6b33f25ff9 is a new commit, then the rest should be ok to re-review with `git range-diff master 2ac16b1 da5bb91`\r\n\r\n[This](https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446220814) (remove unneeded parameter to V1TransportDeserializer constructor in one commit) is dealt with, and the line cleaned up.\r\n\r\n> I see in the last commit you add `const NodeId m_node_id; // Only for logging`\r\n> Maybe this addition could be moved to the first commit? It will be slightly painful due to the conflicts that will need to be solved, but I think it will be worth it\r\n\r\nDone, in its own new commit right at the beginning.  This cleans things up nicely.\r\n\r\n> nit in commit cecb5e3 \r\n> - const CNetMessage msg = *result;\r\n> + const CNetMessage& msg = *result;\r\n> To avoid the copy\r\n\r\nI've changed this so that it uses list initialization instead and then reaches inside the optional.  Now it's consistent with the \"real\" code in net.cpp.\r\n\r\nAlso, clarified the new doxygen comment.",
      "created_at" : "2020-06-29T19:56:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-651326775",
      "id" : 651326775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTMyNjc3NQ==",
      "updated_at" : "2020-06-29T21:20:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651326775",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master b77c159 bc89f1f` ran clang-format only.",
      "created_at" : "2020-06-29T20:11:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-651333986",
      "id" : 651333986,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MTMzMzk4Ng==",
      "updated_at" : "2020-06-29T20:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/651333986",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447324770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447324770"
         }
      },
      "author_association" : "MEMBER",
      "body" : "test-nit in commit 2616399cca2e9c1a4c03605241c7964d53b360bf\r\n\r\nCould extend the test?\r\n\r\n```diff\r\ndiff --git a/test/functional/p2p_invalid_messages.py b/test/functional/p2p_invalid_messages.py\r\nindex d9a9ae5188..04d86d3bc5 100755\r\n--- a/test/functional/p2p_invalid_messages.py\r\n+++ b/test/functional/p2p_invalid_messages.py\r\n@@ -93,7 +93,9 @@ class InvalidMessagesTest(BitcoinTestFramework):\r\n     def test_checksum(self):\r\n         self.log.info(\"Test message with invalid checksum logs an error\")\r\n         conn = self.nodes[0].add_p2p_connection(P2PDataStore())\r\n-        with self.nodes[0].assert_debug_log(['CHECKSUM ERROR (badmsg, 2 bytes), expected 78df0a04 was ffffffff']):\r\n+        log_msg = 'CHECKSUM ERROR (badmsg, 2 bytes), expected 78df0a04 was ffffffff, peer={}'.format(\r\n+            self.nodes[0].getpeerinfo()[0]['id'])\r\n+        with self.nodes[0].assert_debug_log([log_msg]):\r\n             msg = conn.build_message(msg_unrecognized(str_data=\"d\"))\r\n             # Checksum is after start bytes (4B), message type (12B), len (4B)\r\n             cut_len = 4 + 12 + 4\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-06-29T23:55:09Z",
      "diff_hunk" : "@@ -718,10 +718,11 @@ CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageSta\n \n     msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n     if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r447324770",
      "id" : 447324770,
      "line" : 752,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMyNDc3MA==",
      "original_commit_id" : "2616399cca2e9c1a4c03605241c7964d53b360bf",
      "original_line" : 752,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 122,
      "pull_request_review_id" : 439578057,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/447324770",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK bc89f1f40c465aff82db5a8c6f0753a21222968d",
      "created_at" : "2020-06-30T20:43:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-652032662",
      "id" : 652032662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjAzMjY2Mg==",
      "updated_at" : "2020-06-30T20:43:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652032662",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448371000"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448371000"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for bringing this up, I agree.  I've removed this commit and changed the logging to use `HexStr(hdr.pchMessageStart, hdr.pchMessageStart + CMessageHeader::MESSAGE_START_SIZE)`, like how the checksum is logged later in the file.\r\n\r\nI think a span would be a great idea, and a future PR should continue the work that #19373 started.  (Maybe once someone converts HexStr to use span, as suggested there)",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-01T13:40:59Z",
      "diff_hunk" : "@@ -113,6 +113,11 @@ std::string CMessageHeader::GetCommand() const\n     return std::string(pchCommand, pchCommand + strnlen(pchCommand, COMMAND_SIZE));\n }\n \n+std::string CMessageHeader::GetMessageStart() const\n+{\n+    return std::string(pchMessageStart, pchMessageStart + strnlen(pchMessageStart, MESSAGE_START_SIZE));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448371000",
      "id" : 448371000,
      "in_reply_to_id" : 446234628,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MTAwMA==",
      "original_commit_id" : "3f5a7306e941bd9bcd50afeb0e0a9fce46f22fd1",
      "original_line" : 118,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : null,
      "pull_request_review_id" : 440879428,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448371000",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master bc89f1f 1e5a43d` removed the commit that added a pchMessageStart getter, as per this [comment](https://github.com/bitcoin/bitcoin/pull/19107#discussion_r446234628).",
      "created_at" : "2020-07-01T13:42:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-652426015",
      "id" : 652426015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjQyNjAxNQ==",
      "updated_at" : "2020-07-01T13:42:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652426015",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448372950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448372950"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree, this has grown and there is enough context in the PR description.  Changed.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-01T13:44:06Z",
      "diff_hunk" : "@@ -674,11 +676,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE, peer=%d\\n\", m_node_id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448372950",
      "id" : 448372950,
      "in_reply_to_id" : 446242955,
      "line" : 687,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3Mjk1MA==",
      "original_commit_id" : "2ac16b110bd64e655fed0048e22bf5b926de20e7",
      "original_line" : 687,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 70,
      "pull_request_review_id" : 440882162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448372950",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448378720"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448378720"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This could be done for all of the tests, and can mostly be done separate from the changes in this PR.  I'll do this in another PR.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-01T13:52:57Z",
      "diff_hunk" : "@@ -718,10 +718,11 @@ CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageSta\n \n     msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n     if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448378720",
      "id" : 448378720,
      "in_reply_to_id" : 447324770,
      "line" : 752,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3ODcyMA==",
      "original_commit_id" : "2616399cca2e9c1a4c03605241c7964d53b360bf",
      "original_line" : 752,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 122,
      "pull_request_review_id" : 440889995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448378720",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448447344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448447344"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Additionally I'm not sure that we have consensus that `assert_debug_log` is really a good thing.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-01T15:33:50Z",
      "diff_hunk" : "@@ -718,10 +718,11 @@ CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageSta\n \n     msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n     if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r448447344",
      "id" : 448447344,
      "in_reply_to_id" : 447324770,
      "line" : 752,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0NzM0NA==",
      "original_commit_id" : "2616399cca2e9c1a4c03605241c7964d53b360bf",
      "original_line" : 752,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 122,
      "pull_request_review_id" : 440981617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/448447344",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 1e5a43d371981f0d5ece98cfba0ecab32c795a4e. Only change is removing the unnecessary `CMessageHeader::GetMessageStart()` function.",
      "created_at" : "2020-07-01T19:02:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-652593637",
      "id" : 652593637,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjU5MzYzNw==",
      "updated_at" : "2020-07-01T19:02:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652593637",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 1e5a43d371 \r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nACK 1e5a43d371 \r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYEACgkQzit1aX5p\r\npUiKXAwAwBlQRnJH+82cTJNWxA553dzV7MBYXID/rH6dSlPsC0MM517e90mdcmxa\r\nNS5rGqn5GWHPsYtACTouR0b/1lqKEQayH1pNbMmSRmVx4nh3p754H0B8z7IjuyTK\r\n/WVZSWKu1Esao8+Aohi77LpRaJFAjr7a3YRswbNWwrlVEUZadcwwdkSFYAtiFns6\r\nGqrQta2eNUwvCfrn9pCRdsfBiir82FflOzDZhpIU0FMNVqiutlCXA02/+iGxxVdk\r\nBTrA8v+8JoxqQJzCySbQuzlSDUijmWz3CyRpLBt6ZHBGVOekhuzvMZuCrN8wSjtM\r\n/0RwyeYyyDAJLSdK22omTXR0zE2rP4e9pAvoHp9kr9tm2cwuu2QHbdsRmOPUQjRX\r\nR/jCELQUuMxkuZ6ycUrd+ik+Du/4XCkqd9tUT+9kn+odZW33eyDU2Fg+HbdnkIkP\r\ntlFIOH1vIgb86uA2dLUzS3yPw90IHFWLvUV73PUBppV0ySWSDBkw35GO1yruT+CA\r\nlRjilH53\r\n=BsOR\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `4088ef0369eec339a13f0de7d14c8dde10e627b06c1833e8fd5f67b6757af295  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e8929401084088ef0369eec339a13f0de7d14c8dde10e627b06c1833e8fd5f67b6757af295f01010648c7532704f15b16ddf31dfd2804508fff0105f08331eae8b0e42fcd611305b09c32b08f1045efd18d9f00825957c059f57159c0083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff0108b19df1dfc99ff42c4d7734b32b4b0a208f1045efd18d9f00830d5ef67b451fe6f0083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff010e560537d46b7a74c699444710f77822a08f1045efd18d9f008bad0fe54031863f20083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6df010e66dc8b61c2447627b71293bf580ae8508f1207f814b2de79731aa7405ae006e01f5383c6644ab9ddbc7920f3d1a498d27dd4808f1045efd18d9f008af82d62a954815df0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6d)\r\n\r\n</details>\r\n",
      "created_at" : "2020-07-01T23:14:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-652690361",
      "id" : 652690361,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjY5MDM2MQ==",
      "updated_at" : "2020-07-01T23:14:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652690361",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @dongcarl You might be interested in this",
      "created_at" : "2020-07-01T23:15:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-652690486",
      "id" : 652690486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1MjY5MDQ4Ng==",
      "updated_at" : "2020-07-01T23:15:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652690486",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@troygiorshev please feel free to correct me if I misunderstand anything. :relaxed: \r\n\r\n-----\r\n\r\nThis PR moves 4 separate header verification pieces into the `net` layer, the verifications are namely:\r\n\r\n1. Header checksum (`m_valid_checksum`) -> Message ignored\r\n2. Header command (`m_valid_header`-ish) -> Message ignored\r\n3. Header network magic (`m_valid_netmagic`) -> Disconnect from originating peer\r\n\r\nPreviously, these checks **_were_** performed in `net`, but any failure was effectively ignored (modulo some logging), and the message allowed to propagate as normal until the message is inspected in `ProcessMessages`.\r\n\r\nNow, these checks are performed _**and**_ acted upon in `net`. With:\r\n\r\n- Checks (1) + (2) causing a `nullopt` to be returned from `GetMessage` (resulting in the same \"message ignored\" behaviour), and\r\n- Check (3) causing `ReceiveMsgBytes` to return `false` (resulting in the same \"peer disconnect behaviour in `SocketHandler`)\r\n\r\n-----\r\n\r\nHowever, in acting on these validity failures early for checks (1) + (2), we seem to short-circuit some code which previously would have executed, namely:\r\n\r\n1. [HUNK](https://github.com/bitcoin/bitcoin/pull/19107/commits/225b287c2884d6794ea9f090cac80f1df304589e#diff-9a82240fe7dfe86564178691cc57f2f1R606-R612): We skip the `mapRecvBytesPerMsgCmd` accounting logic for failing messages where previously we would have counted them\r\n2. [HUNK](https://github.com/bitcoin/bitcoin/pull/19107/commits/225b287c2884d6794ea9f090cac80f1df304589e#diff-9a82240fe7dfe86564178691cc57f2f1R614-R615): We skip adding the invalid message to the `vRecvMsg` process queue, which would previously count it against our `nReceiveFloodSize`: https://github.com/bitcoin/bitcoin/blob/9f4c0a9694d399388d0514c13feae7d2303fac3d/src/net.cpp#L1399-L1417\r\n\r\nI think this is probably an accuracy improvement for (1), as the only place I see `mapRecvBytesPerMsgCmd` accounting logic being used is in the `getpeerinfo` RPC. However, **I'm not sure that (2) is intended or desirable**, but I'm most likely missing something.",
      "created_at" : "2020-07-08T21:30:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-655768389",
      "id" : 655768389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NTc2ODM4OQ==",
      "updated_at" : "2020-07-08T23:37:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655768389",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-07-10T15:35:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-656739208",
      "id" : 656739208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1NjczOTIwOA==",
      "updated_at" : "2020-07-10T15:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/656739208",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@dongcarl Thank you for the review!\r\n\r\n> (First Part)\r\n\r\nYup you've got it, here it is more verbosely:\r\n\r\n### Disconnect/Ignore Behaviour, in order of when acted upon\r\n\r\n#### Before\r\n\r\n```\r\nUnable to Deserialize Header....................-> Disconnect from originating peer\r\nPayload Declared > MAX_SIZE.....................-> Disconnect from originating peer\r\nPayload Declared > MAX_PROTOCOL_MESSAGE_LENGTH..-> Disconnect from originating peer\r\n----- ^ SocketHandler | MessageHandler \\/\r\nBad MessageStart/NetMagic.......................-> Disconnect from originating peer\r\nBad MessageStart/NetMagic.......................-> Ignore Message\r\nInvalid Type/command............................-> Ignore Message\r\nPayload Declared > MAX_SIZE.....................-> Ignore Message\r\nChecksum Error..................................-> Ignore Message\r\n```\r\n\r\nYes there is repetition, that's how the code is/was.\r\n\r\n#### After (All in SocketHandler)\r\n\r\n```\r\nUnable to Deserialize Header....................-> Disconnect from originating peer\r\nBad MessageStart/NetMagic.......................-> Disconnect from originating peer\r\nPayload Declared > MAX_SIZE.....................-> Disconnect from originating peer\r\nPayload Declared > MAX_PROTOCOL_MESSAGE_LENGTH..-> Disconnect from originating peer\r\nChecksum Error..................................-> Ignore Message\r\nInvalid Type/Command............................-> Ignore Message\r\n```\r\n\r\n> (Second Part)\r\n\r\n1. You're right that this a change.  However, I disagree that it's an improvement.  Before these changes, for a working node the sum of the values for all of the message types in `mapRecvBytesPerMsgCmd` (aka `bytesrecv_per_msg` in `getpeerinfo`) was equal to the value of `nRecvBytes` (aka `bytesrecv` in `getpeerinfo`).  (I've checked this for one peer on a running node).  Thinking for a little bit, I don't see a way that these could have previously fell out of sync while a node stayed connected.  This is a nice invariant to keep.  With this PR, if a peer sends some invalid messages that are ignored, they do fall out of sync.  IMO this is sufficient reason to give `GetMessage` an out parameter explaining the reason for failure.  (I dream that one day we'll have a `Result<T,E>` type...)  With that it will be easy to include the command and raw_message_size.\r\n2. Thank you for catching this, indeed it wasn't something I had considered.  Looking at it closely though, I don't think this is a problem.  `nReceiveFloodSize` and `nProcessQueueSize` work together to prevent MessageHandler from being flooded with messages.  This still works the same in this PR, we just avoid putting the message in the `vRecvMsg` buffer in the first place.  The MessageHandler thread is still protected by `fPauseRecv`.  SocketHandler doesn't have any buffers that could be filled, so we don't have to worry about possibly revealing a bug where `fPauseRecv` was unintentionally saving SocketHandler from something.",
      "created_at" : "2020-07-14T16:27:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-658280010",
      "id" : 658280010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY1ODI4MDAxMA==",
      "updated_at" : "2020-07-14T16:27:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658280010",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 1e5a43d 13ef377`\r\n\r\nFixed `mapRecvBytesPerMsgCmd` problem as discussed above.  This was done by giving GetMessage an out parameter, set when message deserialization fails.  ",
      "created_at" : "2020-07-17T13:27:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-660107045",
      "id" : 660107045,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MDEwNzA0NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-17T13:27:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/660107045",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 13ef377 6a0f059` rebase",
      "created_at" : "2020-07-17T13:57:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-660121614",
      "id" : 660121614,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MDEyMTYxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-17T13:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/660121614",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "close-open to restart travis",
      "created_at" : "2020-07-21T13:43:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-661869776",
      "id" : 661869776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2MTg2OTc3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-21T13:43:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/661869776",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458217690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458217690"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No need to use the public getter `GetId()` since this is a member function of `CNode`. You can just use `id` directly.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-21T16:10:07Z",
      "diff_hunk" : "@@ -2778,7 +2808,7 @@ CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, int nMyStartingHeightIn\n         LogPrint(BCLog::NET, \"Added connection peer=%d\\n\", id);\n     }\n \n-    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params().MessageStart(), SER_NETWORK, INIT_PROTO_VERSION));\n+    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params(), GetId(), SER_NETWORK, INIT_PROTO_VERSION));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458217690",
      "id" : 458217690,
      "line" : 2854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxNzY5MA==",
      "original_commit_id" : "6a0f059f254449a854ee12058a10b5d0fbfa6ae4",
      "original_line" : 2854,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 152,
      "pull_request_review_id" : 452614388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458217690",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458219755"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458219755"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suggest you use a new category NET_MESSAGE_COMMAND_CORRUPT here rather than overloading _OTHER.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-21T16:13:05Z",
      "diff_hunk" : "@@ -590,25 +599,35 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), time);\n+            uint32_t out_err{0};\n+            Optional<CNetMessage> result{m_deserializer->GetMessage(time, out_err)};\n+            if (!result) {\n+                // Message deserialization failed.  Drop the message but don't disconnect the peer.\n+                // store the size of the corrupt message\n+                mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER)->second += out_err;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458219755",
      "id" : 458219755,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTc1NQ==",
      "original_commit_id" : "6a0f059f254449a854ee12058a10b5d0fbfa6ae4",
      "original_line" : 621,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 452614388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458219755",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458465252"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458465252"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree this is better, but I'll leave it for now.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-22T00:32:02Z",
      "diff_hunk" : "@@ -2778,7 +2808,7 @@ CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, int nMyStartingHeightIn\n         LogPrint(BCLog::NET, \"Added connection peer=%d\\n\", id);\n     }\n \n-    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params().MessageStart(), SER_NETWORK, INIT_PROTO_VERSION));\n+    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params(), GetId(), SER_NETWORK, INIT_PROTO_VERSION));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458465252",
      "id" : 458465252,
      "in_reply_to_id" : 458217690,
      "line" : 2854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NTI1Mg==",
      "original_commit_id" : "6a0f059f254449a854ee12058a10b5d0fbfa6ae4",
      "original_line" : 2854,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 152,
      "pull_request_review_id" : 452917831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458465252",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458465966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458465966"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm worried about how adding a new category will affect people who have scripts that parse `getpeerinfo`.  They will either:\r\n\r\n1. Crash (bad)\r\n2. Ignore it (also bad, loses the \"sum of messages in bytesrecv_per_msg\" == \"bytesrecv\" invariant)\r\n3. Treat it like \"_OTHER\" (same as what we have here)\r\n\r\nAs it is right now in the PR, the bytes received for corrupt messages have been moved from their respective command to _OTHER.  This is definitely an accuracy improvement.  I'm not sure that adding a new category is worth the scope creep.\r\n\r\nI've implemented your suggested change [at this branch](https://github.com/troygiorshev/bitcoin/tree/2020-07-p2p-corrupt).\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-22T00:34:50Z",
      "diff_hunk" : "@@ -590,25 +599,35 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), time);\n+            uint32_t out_err{0};\n+            Optional<CNetMessage> result{m_deserializer->GetMessage(time, out_err)};\n+            if (!result) {\n+                // Message deserialization failed.  Drop the message but don't disconnect the peer.\n+                // store the size of the corrupt message\n+                mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER)->second += out_err;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458465966",
      "id" : 458465966,
      "in_reply_to_id" : 458219755,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NTk2Ng==",
      "original_commit_id" : "6a0f059f254449a854ee12058a10b5d0fbfa6ae4",
      "original_line" : 621,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 452918641,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458465966",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458597788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458597788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We _do_ occasionally add new message types (most recently in #18876), so a client should tolerate unrecognized message types (crashing/requiring a software update for the client every time we introduce a new message type would be bad).\r\n\r\nI agree that this isn't a critical issue and could be changed in a follow-up if necessary. For now, _OTHER seems fine.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-07-22T07:42:52Z",
      "diff_hunk" : "@@ -590,25 +599,35 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), time);\n+            uint32_t out_err{0};\n+            Optional<CNetMessage> result{m_deserializer->GetMessage(time, out_err)};\n+            if (!result) {\n+                // Message deserialization failed.  Drop the message but don't disconnect the peer.\n+                // store the size of the corrupt message\n+                mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER)->second += out_err;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r458597788",
      "id" : 458597788,
      "in_reply_to_id" : 458219755,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5Nzc4OA==",
      "original_commit_id" : "6a0f059f254449a854ee12058a10b5d0fbfa6ae4",
      "original_line" : 621,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 453070451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/458597788",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@jonatack @dongcarl @MarcoFalke you've all been interested in this in the past.  I gave this another look over and I think it's ready for review.",
      "created_at" : "2020-08-07T13:08:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-670507430",
      "id" : 670507430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MDUwNzQzMA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-07T13:08:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/670507430",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-08-09T14:16:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-671057274",
      "id" : 671057274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MTA1NzI3NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-09T14:16:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/671057274",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 6a0f059 9377c0c`\r\n\r\n* Rebased, including new span-taking `HexStr`",
      "created_at" : "2020-08-10T13:34:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-671357151",
      "id" : 671357151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MTM1NzE1MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-10T13:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/671357151",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK 9377c0c4586a7ea70f6174626f463902e92ed76a\r\n\r\n@jonatack @dongcarl @MarcoFalke this looks ready to me. Do you mind rereviewing?",
      "created_at" : "2020-08-13T13:07:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-673467712",
      "id" : 673467712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzQ2NzcxMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T13:07:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673467712",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Looking at this again, w/re the 2nd item I mentioned last time:\r\n\r\nIt seems like `nReceiveFloodSize` is configured by the `-maxreceivebuffer`, which has the description of:\r\n> Maximum per-connection receive buffer, <n>*1000 bytes (default: 5000)\r\n\r\nThe way that I would interpret this description as a user is that this places a limit on how many bytes we receive from a peer with zero consideration for _any_ validity checks.\r\n\r\nI admit that any interpretation of this description will be very subjective, and I may very well be in the minority here. And I would love to hear from others if this is the case.\r\n\r\nMy version of the interpretation was true prior to this PR as far as I cal tell: _all_ of the bytes received from the socket, regardless of `net`-validity, would _all_ be interpreted as `CNetMessage`s, pushed onto `vRecvMsg`, and _all_ spliced into `vProcessMsg`, counting against `nReceiveFloodSize`. In effect, `vRecvMsg` was the same as `vProcessMsg`, and they were both the \"receive buffer\" and the \"process buffer\".\r\n\r\n> _Note_: The _only_ exception here would be for messages larger than `MAX_SIZE`/`MAX_PROTOCOL_MESSAGE_LENGTH`, but in that case there would be an immediate disconnect in `SocketHandler`.\r\n\r\nHowever, after this PR, bytes we receive from the socket which result in `net`-invalid messages will not be placed in `vRecvMsg`, meaning that they won't be added to `vProcessMsg` and not be restricted by `-maxreceivebuffer`/`nReceiveFloodSize`. In effect, `RecvMsg` is _still_ the same as `vProcessMsg`, however, they are now both more accurately the \"process buffer\" and not the \"receive buffer\".\r\n\r\nIn my mind, this effectively changes the meaning of `-maxreceivebuffer` from \"Maximum per-connection receive buffer\" to \"Maximum per-connection process buffer\".\r\n\r\n-----\r\n\r\nGiven the complexity of our `net` code, I'm most likely missing something. However, if what I'm saying rings true, then I believe the resolution depends on wether we think users care more about controlling the \"Maximum per-connection receive buffer\" or the \"Maximum per-connection process buffer\". In the latter case, we can simply rename the flag and its description and call it a day. In the former case, it might be a little more complicated.",
      "created_at" : "2020-08-13T17:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-673616514",
      "id" : 673616514,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3MzYxNjUxNA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-13T18:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/673616514",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> whether we think users care more about controlling the \"Maximum per-connection receive buffer\" or the \"Maximum per-connection process buffer\". \r\n\r\nThe `nReceiveFloodSize` limit is a memory exhaustion protection. I expect that [almost] no-one is setting it manually, except perhaps those with very low memory hardware. In all cases, it's better to shed invalid messages as early as possible and as low in the stack as possible, rather than wasting memory by storing them in a buffer.\r\n\r\n> In the latter case, we can simply rename the flag and its description\r\n\r\nI'm definitely a NACK on renaming the flag (since if anyone _is_ using the flag, then that would break their config silently). I also don't think changing the description is worth it. I expect anyone using this flag is dialing the value down from the default because they care about memory exhaustion. Whether the buffer is a 'receive buffer' or 'process buffer' is really more of an implementation detail.",
      "created_at" : "2020-08-14T11:13:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-674024128",
      "id" : 674024128,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDAyNDEyOA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T11:13:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674024128",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> ... places a limit on how many bytes we receive from a peer with zero consideration for any validity checks.\r\n\r\nHow many bytes we receive *before what occurs*?  Before we process them, or something else?\r\n\r\nDid some archaeology on `nReceiveFloodSize`.  It was added in 2011 in #369 as `ReceiveBufferSize()`, brought to its current usage in #973 and, from what I found, I have to disagree with you here:\r\n\r\n> In my mind, this effectively changes the meaning of `-maxreceivebuffer` from \"Maximum per-connection receive buffer\" to \"Maximum per-connection process buffer\".\r\n\r\n`nReceiveFloodSize`/`ReceiveBufferSize`, configured by `maxreceivebuffer`, is and has always been a limit on the per-connection **process** buffer.  This was true in 2011, was true before this PR, and it still true now.  It has always protected the size of the data structure that sends messages from SocketHandler to MessageHandler (was called `vRecv`, now called `vProcessMsg`, I'll use `vProcessMsg` unambiguously).  In fact, back then we didn't even have a data structure analogous to `vRecvMsg`.\r\n\r\nAll of the following are still true:\r\n* When is the \"protected size\" added to?  Before we put a message onto `vProcessMsg`.\r\n* When is the \"protected size\" subtracted from?  After we've taken the message off of `vProcessMsg`.\r\n* If this limit is surpassed, what is prevented?  It prevents us from receiving data from the peer.\r\n\r\nThe fact that we are now dealing with some messages before they're placed onto `vProcessMsg` is fundamental to this PR.  We could, if we wanted to, add to the \"protected size\" the moment we receive the data from the peer and then, in the case that a check fails in `net`, subtract from the \"protected size\" there.  But, as those are both happening one after another in the same thread, it's just redundant.\r\n\r\nIt's unfortunate `-maxreceivebuffer` is named what it is.  In its context, \"receive\" has always meant \"process\".",
      "created_at" : "2020-08-14T19:43:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-674243013",
      "id" : 674243013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3NDI0MzAxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-14T19:43:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/674243013",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 9377c0c e72c5b2`\r\n\r\nRebased",
      "created_at" : "2020-08-24T15:50:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-679209971",
      "id" : 679209971,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY3OTIwOTk3MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-24T15:51:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/679209971",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "ACK e72c5b2\r\n\r\n-----\r\n\r\nAfter reading @jnewbery and @troygiorshev's responses and thinking a bit more, I think I see how it is most likely safe to not count `net`-invalid messages against `nReceiveFloodSize`. Perhaps in the future some naming can be tidied up so that the intention is clearer, but that should in no way stop this PR from getting merged.",
      "created_at" : "2020-08-25T18:18:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-680191615",
      "id" : 680191615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4MDE5MTYxNQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-08-25T18:18:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/680191615",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3445290?v=4",
         "events_url" : "https://api.github.com/users/dongcarl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dongcarl/followers",
         "following_url" : "https://api.github.com/users/dongcarl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dongcarl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dongcarl",
         "id" : 3445290,
         "login" : "dongcarl",
         "node_id" : "MDQ6VXNlcjM0NDUyOTA=",
         "organizations_url" : "https://api.github.com/users/dongcarl/orgs",
         "received_events_url" : "https://api.github.com/users/dongcarl/received_events",
         "repos_url" : "https://api.github.com/users/dongcarl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dongcarl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dongcarl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r478714497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478714497"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Move checksum check from net_processing to net\" (5cecad30d9ce37ba500eb1e06743d213bb911379)\r\n\r\nMinor:\r\n\r\n```c++\r\nmapRecvBytesPerMsgCmd.at(NET_MESSAGE_COMMAND_OTHER) += out_err;\r\n```\r\n\r\nWould be shorter and avoid undefined behavior if there's no COMMAND_OTHER entry.\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-27T21:47:53Z",
      "diff_hunk" : "@@ -594,25 +594,33 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), time);\n+            uint32_t out_err{0};\n+            Optional<CNetMessage> result{m_deserializer->GetMessage(Params().MessageStart(), time, out_err)};\n+            if (!result) {\n+                // store the size of the corrupt message\n+                mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER)->second += out_err;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r478714497",
      "id" : 478714497,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxNDQ5Nw==",
      "original_commit_id" : "5cecad30d9ce37ba500eb1e06743d213bb911379",
      "original_line" : 621,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 477107590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478714497",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r478718436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478718436"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Move checksum check from net_processing to net\" (5cecad30d9ce37ba500eb1e06743d213bb911379)\r\n\r\njonatack commented on the `out_err` name and I agree it's not descriptive, and I think additionally it's awkward that caller can't just refer to one variable for the raw message size, but has use look at different variables (`out_err` or `result->m_raw_message_size`) depending on whether the checksum fails. I think a better API for the function would be:\r\n\r\n```diff\r\n-Optional<CNetMessage> V1TransportDeserializer::GetMessage(const std::chrono::microseconds time, uint32_t& out_err)\r\n+CNetMessage V1TransportDeserializer::GetMessage(const std::chrono::microseconds time, bool& reject_message)\r\n```\r\n\r\nSwitching to this would also make the commit much smaller because `msg.` could stay `msg.` everywhere and not have to change to `msg->` and `result->`.\r\n\r\n\r\n\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-27T21:56:55Z",
      "diff_hunk" : "@@ -704,37 +712,36 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, const std::chrono::microseconds time)\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, const std::chrono::microseconds time, uint32_t& out_err)\n {\n     // decompose a single CNetMessage from the TransportDeserializer\n-    CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> msg(std::move(vRecv));\n \n     // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n+    msg->m_valid_header = hdr.IsValid(message_start);\n+    msg->m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n     uint256 hash = GetMessageHash();\n \n-    // store command string, payload size\n-    msg.m_command = hdr.GetCommand();\n-    msg.m_message_size = hdr.nMessageSize;\n-    msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n+    // store command string, time, and sizes\n+    msg->m_command = hdr.GetCommand();\n+    msg->m_time = time;\n+    msg->m_message_size = hdr.nMessageSize;\n+    msg->m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n         LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n+                 SanitizeString(msg->m_command), msg->m_message_size,\n                  HexStr(Span<uint8_t>(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE)),\n                  HexStr(hdr.pchChecksum),\n                  m_node_id);\n+        out_err = msg->m_raw_message_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r478718436",
      "id" : 478718436,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxODQzNg==",
      "original_commit_id" : "5cecad30d9ce37ba500eb1e06743d213bb911379",
      "original_line" : 757,
      "original_position" : 79,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 477107590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478718436",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r478719971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478719971"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Give V1TransportDeserializer an m_node_id member\" (90fc3ffa82e398a6c95dbaf5374b6a478f17ae88)\r\n\r\nIt would be helpful for this commit message to say \"This commit doesn't change behavior except for logging\". It's harder to know if commit is doing the right thing if commit message doesn't say what intended behavior change is.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-27T22:00:41Z",
      "diff_hunk" : "@@ -724,10 +724,11 @@ CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageSta\n \n     msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n     if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r478719971",
      "id" : 478719971,
      "line" : 752,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxOTk3MQ==",
      "original_commit_id" : "90fc3ffa82e398a6c95dbaf5374b6a478f17ae88",
      "original_line" : 752,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 122,
      "pull_request_review_id" : 477107590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/478719971",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479182604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479182604"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Move checksum check from net_processing to net\" (5cecad30d9ce37ba500eb1e06743d213bb911379)\r\n\r\nI think commit message here should say to what extent new behavior is equivalent to old behavior, because just looking at the current message, it's not clear what behavior changes are intended, and how `fPauseRecv` and  `mapRecvBytesPerMsgCmd` and `nReceiveFloodSize` are involved. This information is hidden away in review discussion:\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/19107#issuecomment-655768389\r\nhttps://github.com/bitcoin/bitcoin/pull/19107#issuecomment-658280010\r\nhttps://github.com/bitcoin/bitcoin/pull/19107#issuecomment-673616514\r\nhttps://github.com/bitcoin/bitcoin/pull/19107#issuecomment-674024128\r\nhttps://github.com/bitcoin/bitcoin/pull/19107#issuecomment-674243013\r\n\r\nAfter reading the discussion, it's still not clear to me why this change doesn't make it easier for a peer to flood the connection with bad checksum messages that cause log spam but are otherwise ignored. Is the takeaway that this change makes it slightly easier to flood but not significantly easier? Or that there's some other flood protection? Or that the new and old behavior are equivalent some other way? This is the type of information that would be good to have in the commit message.\r\n",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-28T11:45:45Z",
      "diff_hunk" : "@@ -3867,17 +3867,8 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     // Message size\n     unsigned int nMessageSize = msg.m_message_size;\n \n-    // Checksum\n-    CDataStream& vRecv = msg.m_recv;\n-    if (!msg.m_valid_checksum)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479182604",
      "id" : 479182604,
      "line" : 3895,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE4MjYwNA==",
      "original_commit_id" : "5cecad30d9ce37ba500eb1e06743d213bb911379",
      "original_line" : 3895,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 39,
      "pull_request_review_id" : 477107590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479182604",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479771749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479771749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params(), id, SER_NETWORK, INIT_PROTO_VERSION));\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-30T13:43:56Z",
      "diff_hunk" : "@@ -2797,7 +2827,7 @@ CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, int nMyStartingHeightIn\n         LogPrint(BCLog::NET, \"Added connection peer=%d\\n\", id);\n     }\n \n-    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params().MessageStart(), SER_NETWORK, INIT_PROTO_VERSION));\n+    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params(), GetId(), SER_NETWORK, INIT_PROTO_VERSION));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479771749",
      "id" : 479771749,
      "line" : 2854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc3MTc0OQ==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 2854,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 152,
      "pull_request_review_id" : 478204560,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479771749",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479780787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479780787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC, `out_err` isn't an error number like its name suggests, but rather the size in bytes of the message. Perhaps its naming could be clearer. ",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-30T15:04:30Z",
      "diff_hunk" : "@@ -686,13 +685,15 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, std::chrono::microseconds time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(std::chrono::microseconds time, uint32_t& out_err) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479780787",
      "id" : 479780787,
      "line" : 730,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MDc4Nw==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 730,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 35,
      "pull_request_review_id" : 478210872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479780787",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479781183"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479781183"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is one of several places where the `out_err` naming seems odd to me; `out_err` suggests an error number more than the message size in bytes.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-30T15:07:44Z",
      "diff_hunk" : "@@ -594,25 +603,35 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), time);\n+            uint32_t out_err{0};\n+            Optional<CNetMessage> result{m_deserializer->GetMessage(time, out_err)};\n+            if (!result) {\n+                // Message deserialization failed.  Drop the message but don't disconnect the peer.\n+                // store the size of the corrupt message\n+                mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER)->second += out_err;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479781183",
      "id" : 479781183,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MTE4Mw==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 621,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 478211127,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479781183",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479783031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479783031"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Rather than just \"size\", the logged error message could state that the message is too large and state what is expected, like for the checksum error logging \r\n```diff\r\n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\r\n-    if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\r\n-        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes), peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, m_node_id);\r\n+    unsigned int max_size{std::max(MAX_SIZE, MAX_PROTOCOL_MESSAGE_LENGTH)};\r\n+    if (hdr.nMessageSize > max_size) {\r\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes, %u expected), peer=%d\\n\",\r\n+                 hdr.GetCommand(), hdr.nMessageSize, max_size, m_node_id);\r\n         return -1;\r\n     }\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-30T15:26:13Z",
      "diff_hunk" : "@@ -665,11 +684,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE, peer=%d\\n\", m_node_id);\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, m_chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), received %s, peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, HexStr(hdr.pchMessageStart), m_node_id);\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes), peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, m_node_id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479783031",
      "id" : 479783031,
      "line" : 699,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MzAzMQ==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 699,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 82,
      "pull_request_review_id" : 478212432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479783031",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479783412"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479783412"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        LogPrint(BCLog::NET, \"HEADER ERROR - INVALID COMMAND (%s, %u bytes), peer=%d\\n\",\r\n```",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-08-30T15:30:18Z",
      "diff_hunk" : "@@ -704,36 +731,39 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, const std::chrono::microseconds time)\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(const std::chrono::microseconds time, uint32_t& out_err)\n {\n     // decompose a single CNetMessage from the TransportDeserializer\n-    CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // store command string, time, and sizes\n+    msg->m_command = hdr.GetCommand();\n+    msg->m_time = time;\n+    msg->m_message_size = hdr.nMessageSize;\n+    msg->m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n-    // store command string, payload size\n-    msg.m_command = hdr.GetCommand();\n-    msg.m_message_size = hdr.nMessageSize;\n-    msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n+    uint256 hash = GetMessageHash();\n \n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n+    // Check checksum and header command string\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+                 SanitizeString(msg->m_command), msg->m_message_size,\n                  HexStr(Span<uint8_t>(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE)),\n-                 HexStr(hdr.pchChecksum));\n-    }\n-\n-    // store receive time\n-    msg.m_time = time;\n-\n-    // reset the network deserializer (prepare for the next message)\n+                 HexStr(hdr.pchChecksum),\n+                 m_node_id);\n+        out_err = msg->m_raw_message_size;\n+        msg = nullopt;\n+    } else if (!hdr.IsCommandValid()) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes), peer=%d\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r479783412",
      "id" : 479783412,
      "line" : 760,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MzQxMg==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 760,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 137,
      "pull_request_review_id" : 478212703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479783412",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r481064111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481064111"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Change CMessageHeader Constructor\" (878d829b5bff9db5140c9547400ec024a08c0105)\r\n\r\nI guess this is the change explained by \"This messagestart should always be replaced when deserializing an actual message header so that we can run checks on it.\" in the commit message. \r\n\r\nWould suggest making that a little more explicit like \"This messagestart is overwritten by data from incoming messages during deserialization, so there is no change in behavior when processing messages.\"",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-01T11:21:32Z",
      "diff_hunk" : "@@ -88,9 +88,9 @@ const static std::string allNetMessageTypes[] = {\n };\n const static std::vector<std::string> allNetMessageTypesVec(allNetMessageTypes, allNetMessageTypes+ARRAYLEN(allNetMessageTypes));\n \n-CMessageHeader::CMessageHeader(const MessageStartChars& pchMessageStartIn)\n+CMessageHeader::CMessageHeader()\n {\n-    memcpy(pchMessageStart, pchMessageStartIn, MESSAGE_START_SIZE);\n+    memset(pchMessageStart, 0, MESSAGE_START_SIZE);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r481064111",
      "id" : 481064111,
      "line" : 89,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA2NDExMQ==",
      "original_commit_id" : "878d829b5bff9db5140c9547400ec024a08c0105",
      "original_line" : 89,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/protocol.cpp",
      "position" : 8,
      "pull_request_review_id" : 477107590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481064111",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r481076370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481076370"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Remove header checks out of net_processing\" (e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d)\r\n\r\nAgain commit message should say what intended behavior change is because it's hard to verify this is doing the right thing without know what it's supposed to do. It seems like dropping `fDisconnect = true` would no longer cause disconnects but I see from https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-655768389 that there will still be disconnects because `ReceiveMsgBytes` will disconnect after `readHeader` now returns `-1`.\r\n\r\nWould suggest commit message saying explicitly there is no change in behavior except for logging, that invalid magic bytes cause disconnects earlier in `ReceiveMsgBytes`, and that invalid header messages are ignored earlier but don't make flooding easier for whatever reason they don't make flooding easier",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-01T11:45:47Z",
      "diff_hunk" : "@@ -3849,19 +3841,6 @@ bool PeerLogicValidation::ProcessMessages(CNode* pfrom, std::atomic<bool>& inter\n     CNetMessage& msg(msgs.front());\n \n     msg.SetVersion(pfrom->GetRecvVersion());\n-    // Check network magic\n-    if (!msg.m_valid_netmagic) {\n-        LogPrint(BCLog::NET, \"PROCESSMESSAGE: INVALID MESSAGESTART %s peer=%d\\n\", SanitizeString(msg.m_command), pfrom->GetId());\n-        pfrom->fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r481076370",
      "id" : 481076370,
      "line" : 3878,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA3NjM3MA==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 3878,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 22,
      "pull_request_review_id" : 477107590,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/481076370",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T17:40:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-688452063",
      "id" : 688452063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODQ1MjA2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T17:40:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688452063",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master e72c5b2 367bb95`\r\n\r\nRebased",
      "created_at" : "2020-09-16T13:19:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-693399853",
      "id" : 693399853,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MzM5OTg1Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-16T13:19:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693399853",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489433608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489433608"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I named it this way because TransportDeserializer is such a general interface.  It's possible that some other implementation of it will use `out_err` as some sort of magic number.\r\n\r\nRight now it is only set when the method fails.  If we're going to go down the route of renaming this to something like `msg_size`, then I would prefer to always set it.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-16T13:24:12Z",
      "diff_hunk" : "@@ -686,13 +685,15 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, std::chrono::microseconds time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(std::chrono::microseconds time, uint32_t& out_err) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489433608",
      "id" : 489433608,
      "in_reply_to_id" : 479780787,
      "line" : 730,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzMzYwOA==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 730,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 35,
      "pull_request_review_id" : 489620369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:49:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489433608",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master 367bb95 ead6393`\r\n\r\n* s/out_err/out_err_raw_size/ in all spots except for the single prototype in TransportDeserializer",
      "created_at" : "2020-09-16T16:50:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-693531233",
      "id" : 693531233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MzUzMTIzMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-16T16:51:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693531233",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489582680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489582680"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-16T16:51:45Z",
      "diff_hunk" : "@@ -686,13 +685,15 @@ class TransportDeserializer {\n     // read and deserialize data\n     virtual int Read(const char *data, unsigned int bytes) = 0;\n     // decomposes a message from the context\n-    virtual CNetMessage GetMessage(const CMessageHeader::MessageStartChars& message_start, std::chrono::microseconds time) = 0;\n+    virtual Optional<CNetMessage> GetMessage(std::chrono::microseconds time, uint32_t& out_err) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489582680",
      "id" : 489582680,
      "in_reply_to_id" : 479780787,
      "line" : 730,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4MjY4MA==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 730,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 35,
      "pull_request_review_id" : 489816995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489582680",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489582753"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489582753"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-16T16:51:51Z",
      "diff_hunk" : "@@ -594,25 +603,35 @@ bool CNode::ReceiveMsgBytes(const char *pch, unsigned int nBytes, bool& complete\n     while (nBytes > 0) {\n         // absorb network data\n         int handled = m_deserializer->Read(pch, nBytes);\n-        if (handled < 0) return false;\n+        if (handled < 0) {\n+            // Serious header problem, disconnect from the peer.\n+            return false;\n+        }\n \n         pch += handled;\n         nBytes -= handled;\n \n         if (m_deserializer->Complete()) {\n             // decompose a transport agnostic CNetMessage from the deserializer\n-            CNetMessage msg = m_deserializer->GetMessage(Params().MessageStart(), time);\n+            uint32_t out_err{0};\n+            Optional<CNetMessage> result{m_deserializer->GetMessage(time, out_err)};\n+            if (!result) {\n+                // Message deserialization failed.  Drop the message but don't disconnect the peer.\n+                // store the size of the corrupt message\n+                mapRecvBytesPerMsgCmd.find(NET_MESSAGE_COMMAND_OTHER)->second += out_err;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489582753",
      "id" : 489582753,
      "in_reply_to_id" : 479781183,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4Mjc1Mw==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 621,
      "original_position" : 46,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 489817090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:51:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489582753",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489586764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489586764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like this, I'll leave it for a follow-up PR.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-16T16:58:40Z",
      "diff_hunk" : "@@ -665,11 +684,19 @@ int V1TransportDeserializer::readHeader(const char *pch, unsigned int nBytes)\n         hdrbuf >> hdr;\n     }\n     catch (const std::exception&) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - UNABLE TO DESERIALIZE, peer=%d\\n\", m_node_id);\n+        return -1;\n+    }\n+\n+    // Check start string, network magic\n+    if (memcmp(hdr.pchMessageStart, m_chain_params.MessageStart(), CMessageHeader::MESSAGE_START_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - MESSAGESTART (%s, %u bytes), received %s, peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, HexStr(hdr.pchMessageStart), m_node_id);\n         return -1;\n     }\n \n     // reject messages larger than MAX_SIZE or MAX_PROTOCOL_MESSAGE_LENGTH\n     if (hdr.nMessageSize > MAX_SIZE || hdr.nMessageSize > MAX_PROTOCOL_MESSAGE_LENGTH) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - SIZE (%s, %u bytes), peer=%d\\n\", hdr.GetCommand(), hdr.nMessageSize, m_node_id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489586764",
      "id" : 489586764,
      "in_reply_to_id" : 479783031,
      "line" : 699,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4Njc2NA==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 699,
      "original_position" : 82,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 82,
      "pull_request_review_id" : 489822274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:58:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489586764",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489587122"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489587122"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'll do a run through and decide between \"ERROR - X\" and \"ERROR - INVALID X\" (and make consistent) in a follow-up PR",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-16T16:59:13Z",
      "diff_hunk" : "@@ -704,36 +731,39 @@ const uint256& V1TransportDeserializer::GetMessageHash() const\n     return data_hash;\n }\n \n-CNetMessage V1TransportDeserializer::GetMessage(const CMessageHeader::MessageStartChars& message_start, const std::chrono::microseconds time)\n+Optional<CNetMessage> V1TransportDeserializer::GetMessage(const std::chrono::microseconds time, uint32_t& out_err)\n {\n     // decompose a single CNetMessage from the TransportDeserializer\n-    CNetMessage msg(std::move(vRecv));\n+    Optional<CNetMessage> msg(std::move(vRecv));\n \n-    // store state about valid header, netmagic and checksum\n-    msg.m_valid_header = hdr.IsValid(message_start);\n-    msg.m_valid_netmagic = (memcmp(hdr.pchMessageStart, message_start, CMessageHeader::MESSAGE_START_SIZE) == 0);\n-    uint256 hash = GetMessageHash();\n+    // store command string, time, and sizes\n+    msg->m_command = hdr.GetCommand();\n+    msg->m_time = time;\n+    msg->m_message_size = hdr.nMessageSize;\n+    msg->m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n \n-    // store command string, payload size\n-    msg.m_command = hdr.GetCommand();\n-    msg.m_message_size = hdr.nMessageSize;\n-    msg.m_raw_message_size = hdr.nMessageSize + CMessageHeader::HEADER_SIZE;\n+    uint256 hash = GetMessageHash();\n \n     // We just received a message off the wire, harvest entropy from the time (and the message checksum)\n     RandAddEvent(ReadLE32(hash.begin()));\n \n-    msg.m_valid_checksum = (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) == 0);\n-    if (!msg.m_valid_checksum) {\n-        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s\\n\",\n-                 SanitizeString(msg.m_command), msg.m_message_size,\n+    // Check checksum and header command string\n+    if (memcmp(hash.begin(), hdr.pchChecksum, CMessageHeader::CHECKSUM_SIZE) != 0) {\n+        LogPrint(BCLog::NET, \"CHECKSUM ERROR (%s, %u bytes), expected %s was %s, peer=%d\\n\",\n+                 SanitizeString(msg->m_command), msg->m_message_size,\n                  HexStr(Span<uint8_t>(hash.begin(), hash.begin() + CMessageHeader::CHECKSUM_SIZE)),\n-                 HexStr(hdr.pchChecksum));\n-    }\n-\n-    // store receive time\n-    msg.m_time = time;\n-\n-    // reset the network deserializer (prepare for the next message)\n+                 HexStr(hdr.pchChecksum),\n+                 m_node_id);\n+        out_err = msg->m_raw_message_size;\n+        msg = nullopt;\n+    } else if (!hdr.IsCommandValid()) {\n+        LogPrint(BCLog::NET, \"HEADER ERROR - COMMAND (%s, %u bytes), peer=%d\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489587122",
      "id" : 489587122,
      "in_reply_to_id" : 479783412,
      "line" : 760,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4NzEyMg==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 760,
      "original_position" : 137,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 137,
      "pull_request_review_id" : 489822714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T16:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489587122",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489590684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489590684"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yup, I prefer this too.  I don't think it's unclear enough to merit review effort changing it now though, I'll incorporate it into a follow-up.",
      "commit_id" : "ead639364bd93ece1273de7180a10a669690dbc6",
      "created_at" : "2020-09-16T17:05:16Z",
      "diff_hunk" : "@@ -2797,7 +2827,7 @@ CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, int nMyStartingHeightIn\n         LogPrint(BCLog::NET, \"Added connection peer=%d\\n\", id);\n     }\n \n-    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params().MessageStart(), SER_NETWORK, INIT_PROTO_VERSION));\n+    m_deserializer = MakeUnique<V1TransportDeserializer>(V1TransportDeserializer(Params(), GetId(), SER_NETWORK, INIT_PROTO_VERSION));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#discussion_r489590684",
      "id" : 489590684,
      "in_reply_to_id" : 479771749,
      "line" : 2854,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU5MDY4NA==",
      "original_commit_id" : "e72c5b2e27b6ac3a1303b133f551bf2afcff1c0d",
      "original_line" : 2854,
      "original_position" : 152,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 152,
      "pull_request_review_id" : 489827232,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/19107",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-09-16T17:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/489590684",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review @jonatack and @ryanofsky!\r\n\r\nI'm going to leave the suggestions for a follow-up PR.  As it stands, this PR has three ACKs from people experienced in this part of the codebase.  I'd like to reduce the diff that they have to go through.\r\n\r\n* @jnewbery on 9377c0c.  The following range-diffs may be useful\r\n\t* Rebase: `git range-diff master 9377c0c e72c5b2`\r\n\t* Rebase: `git range-diff master e72c5b2 367bb95`\r\n\t* Rename: `git range-diff master 367bb95 ead6393`\r\n* @dongcarl on e72c5b2\r\n\t* The rebase and rename immediately above this comment\r\n* @ryanofsky on e72c5b2\r\n\t* The rebase and rename immediately above this comment",
      "created_at" : "2020-09-16T17:05:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-693538902",
      "id" : 693538902,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5MzUzODkwMg==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-16T17:05:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693538902",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-21T22:20:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-696409480",
      "id" : 696409480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NjQwOTQ4MA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-21T22:20:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/696409480",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "`git range-diff master ead6393 deb5271`\r\n\r\nTrivial rebase",
      "created_at" : "2020-09-23T02:06:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-697078263",
      "id" : 697078263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NzA3ODI2Mw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T02:06:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697078263",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5553787?v=4",
         "events_url" : "https://api.github.com/users/troygiorshev/events{/privacy}",
         "followers_url" : "https://api.github.com/users/troygiorshev/followers",
         "following_url" : "https://api.github.com/users/troygiorshev/following{/other_user}",
         "gists_url" : "https://api.github.com/users/troygiorshev/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/troygiorshev",
         "id" : 5553787,
         "login" : "troygiorshev",
         "node_id" : "MDQ6VXNlcjU1NTM3ODc=",
         "organizations_url" : "https://api.github.com/users/troygiorshev/orgs",
         "received_events_url" : "https://api.github.com/users/troygiorshev/received_events",
         "repos_url" : "https://api.github.com/users/troygiorshev/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/troygiorshev/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/troygiorshev/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/troygiorshev"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK deb52711a17236d0fca302701b5af585341ab42a.\r\n\r\nShould be ready for merge with a reACK from @dongcarl and @ryanofsky ",
      "created_at" : "2020-09-23T09:49:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/19107#issuecomment-697257964",
      "id" : 697257964,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/19107",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY5NzI1Nzk2NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-23T09:49:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/697257964",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
