[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "created_at" : "2020-03-30T02:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-605752932",
      "id" : 605752932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNTc1MjkzMg==",
      "updated_at" : "2020-06-10T21:53:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605752932",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Here is one caveat that may not be obvious: whenever you have some iterator/pointer/object that stores objects of type `B` (which supertype `A`), it should *not* be possible to construct a `Span<A>` for it, despite `B*` being implicitly convertible to `A*`. The reason is that `A` and `B` may have different sizes, so pointer arithmetic in one may not correspond to the right operations in the other.\r\n\r\nThis is implemented - here and in the C++20 `std::span` - by checking that *arrays of* `B` can be converted to *arrays of* `A`.",
      "created_at" : "2020-03-30T04:48:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-605780145",
      "id" : 605780145,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNTc4MDE0NQ==",
      "updated_at" : "2020-03-30T21:28:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605780145",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-04-02T21:33:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-608101932",
      "id" : 608101932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwODEwMTkzMg==",
      "updated_at" : "2020-04-02T21:33:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/608101932",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r402990362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402990362"
         }
      },
      "author_association" : "NONE",
      "body" : "This will cover the generic copy constructor as well, because `Span<O>` has both `.data()` & `.size()` methods.\r\n```c++\r\n    template <typename O, typename std::enable_if<std::is_convertible<O (*)[], C (*)[]>::value, int>::type = 0>\r\n    constexpr Span(const Span<O>& other) noexcept : m_data(other.m_data), m_size(other.m_size) {}\r\n```",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-04-03T13:05:19Z",
      "diff_hunk" : "@@ -18,34 +18,85 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}\n+\n+    /** Construct a span from a begin and end pointer.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, T* end) noexcept : m_data(begin), m_size(end - begin) {}\n+\n+    /** Implicit conversion of spans between compatible types.\n+     *\n+     *  Specifically, if a pointer to an array of type O can be implicitly converted to a pointer to an array of type\n+     *  C, then permit implicit conversion of Span<O> to Span<C>. This matches the behavior of the corresponding\n+     *  C++20 std::span constructor.\n+     *\n+     *  For example this means that a Span<T> can be converted into a Span<const T>.\n+     */\n+    template <typename O, typename std::enable_if<std::is_convertible<O (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(const Span<O>& other) noexcept : m_data(other.m_data), m_size(other.m_size) {}\n+\n+    /** Default copy constructor. */\n+    constexpr Span(const Span&) noexcept = default;\n+\n+    /** Default assignment operator. */\n+    Span& operator=(const Span& other) noexcept = default;\n+\n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}\n+\n+    /** Construct a Span for objects with .data() and .size() (std::string, std::array, std::vector, ...).\n+     *\n+     * This implements a subset of the functionality provided by the C++20 std::span range-based constructor.\n+     *\n+     * To prevent surprises, this constructor is restricted to const containers. Use MakeSpan to construct\n+     * a span for mutable ones.\n+     */\n+    template <typename V, typename std::enable_if<std::is_convertible<typename std::remove_pointer<decltype(std::declval<const V&>().data())>::type (*)[], C (*)[]>::value && std::is_convertible<decltype(std::declval<const V&>().size()), std::size_t>::value, int>::type = 0>\n+    constexpr Span(const V& v) noexcept : m_data(v.data()), m_size(v.size()) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r402990362",
      "id" : 402990362,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5MDM2Mg==",
      "original_commit_id" : "6bc07845c57765940bd2af242166e154c939738b",
      "original_line" : 71,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 387236075,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402990362",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/2920178?v=4",
         "events_url" : "https://api.github.com/users/aminroosta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aminroosta/followers",
         "following_url" : "https://api.github.com/users/aminroosta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aminroosta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aminroosta",
         "id" : 2920178,
         "login" : "aminroosta",
         "node_id" : "MDQ6VXNlcjI5MjAxNzg=",
         "organizations_url" : "https://api.github.com/users/aminroosta/orgs",
         "received_events_url" : "https://api.github.com/users/aminroosta/received_events",
         "repos_url" : "https://api.github.com/users/aminroosta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aminroosta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aminroosta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aminroosta"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r403428718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403428718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's true, though the specification and common other span implementations still have a default copy constructor too - I don't know why.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-04-04T05:34:08Z",
      "diff_hunk" : "@@ -18,34 +18,85 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}\n+\n+    /** Construct a span from a begin and end pointer.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, T* end) noexcept : m_data(begin), m_size(end - begin) {}\n+\n+    /** Implicit conversion of spans between compatible types.\n+     *\n+     *  Specifically, if a pointer to an array of type O can be implicitly converted to a pointer to an array of type\n+     *  C, then permit implicit conversion of Span<O> to Span<C>. This matches the behavior of the corresponding\n+     *  C++20 std::span constructor.\n+     *\n+     *  For example this means that a Span<T> can be converted into a Span<const T>.\n+     */\n+    template <typename O, typename std::enable_if<std::is_convertible<O (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(const Span<O>& other) noexcept : m_data(other.m_data), m_size(other.m_size) {}\n+\n+    /** Default copy constructor. */\n+    constexpr Span(const Span&) noexcept = default;\n+\n+    /** Default assignment operator. */\n+    Span& operator=(const Span& other) noexcept = default;\n+\n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}\n+\n+    /** Construct a Span for objects with .data() and .size() (std::string, std::array, std::vector, ...).\n+     *\n+     * This implements a subset of the functionality provided by the C++20 std::span range-based constructor.\n+     *\n+     * To prevent surprises, this constructor is restricted to const containers. Use MakeSpan to construct\n+     * a span for mutable ones.\n+     */\n+    template <typename V, typename std::enable_if<std::is_convertible<typename std::remove_pointer<decltype(std::declval<const V&>().data())>::type (*)[], C (*)[]>::value && std::is_convertible<decltype(std::declval<const V&>().size()), std::size_t>::value, int>::type = 0>\n+    constexpr Span(const V& v) noexcept : m_data(v.data()), m_size(v.size()) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r403428718",
      "id" : 403428718,
      "in_reply_to_id" : 402990362,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQyODcxOA==",
      "original_commit_id" : "6bc07845c57765940bd2af242166e154c939738b",
      "original_line" : 71,
      "original_position" : 57,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 387670264,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403428718",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #18591 (which included a commit from this PR).",
      "created_at" : "2020-05-01T18:28:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-622505998",
      "id" : 622505998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjUwNTk5OA==",
      "updated_at" : "2020-05-01T18:28:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622505998",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I was trying to MakeSpan on a prevector today and I realized I needed this PR. Concept ACK. will test and ACK soon.",
      "created_at" : "2020-05-02T01:36:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-622650104",
      "id" : 622650104,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjY1MDEwNA==",
      "updated_at" : "2020-05-02T01:36:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622650104",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r418929147"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418929147"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "copy paste typo? shouldn't this be:\r\n```suggestion\r\n    const Span<const char> another_span{another_str};\r\n```",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-02T08:10:32Z",
      "diff_hunk" : "@@ -32,7 +32,7 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n     }\n \n     std::string another_str = fuzzed_data_provider.ConsumeBytesAsString(32);\n-    const Span<const char> another_span = MakeSpan(another_str);\n+    const Span<const char> another_span{str};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r418929147",
      "id" : 418929147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyOTE0Nw==",
      "original_commit_id" : "bc32062d4081eb6f9d2d198861bc255e3cd33d38",
      "original_line" : 35,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/span.cpp",
      "position" : null,
      "pull_request_review_id" : 404509767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418929147",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems to be working well on a branch I'm testing. one spooky thing I ran into was:\r\n\r\n```c++\r\nstatic std::vector<unsigned char> RandomData()\r\n{\r\n    uint256 r = InsecureRand256();\r\n    return std::vector<unsigned char>(r.begin(), r.end());\r\n}\r\n\r\nauto d = MakeSpan(RandomData());\r\nrb1.insert(d)\r\nBOOST_CHECK(rb1.contains(d));\r\n```\r\n\r\n```\r\nRunning 12 test cases...\r\ntest/bloom_tests.cpp(519): error: in \"bloom_tests/rolling_bloom\": check nHits == 6 has failed [3 != 6]\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n[201] jb55@monad> ./src/test/test_bitcoin -t bloom_tests                                                                                                                                                     ~/dev/github/bitcoin/bitcoin\r\nRunning 12 test cases...\r\ntest/bloom_tests.cpp(519): error: in \"bloom_tests/rolling_bloom\": check nHits == 6 has failed [3 != 6]\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n[201] jb55@monad> ./src/test/test_bitcoin -t bloom_tests                                                                                                                                                     ~/dev/github/bitcoin/bitcoin\r\nRunning 12 test cases...\r\ntest/bloom_tests.cpp(519): error: in \"bloom_tests/rolling_bloom\": check nHits == 6 has failed [2 != 6]\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n[201] jb55@monad> ./src/test/test_bitcoin -t bloom_tests                                                                                                                                                     ~/dev/github/bitcoin/bitcoin\r\nRunning 12 test cases...\r\ntest/bloom_tests.cpp(519): error: in \"bloom_tests/rolling_bloom\": check nHits == 6 has failed [7 != 6]\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n[201] jb55@monad>                                                                                                                                                                                            ~/dev/github/bitcoin/bitcoin\r\n[201] jb55@monad> ./src/test/test_bitcoin -t bloom_tests                                                                                                                                                     ~/dev/github/bitcoin/bitcoin\r\nRunning 12 test cases...\r\ntest/bloom_tests.cpp(519): error: in \"bloom_tests/rolling_bloom\": check nHits == 6 has failed [4 != 6]\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n```\r\n\r\nbut this works fine:\r\n\r\n```c++\r\nstd::vector<unsigned char> d = RandomData();\r\nrb1.insert(MakeSpan(d));\r\nBOOST_CHECK(rb1.contains(MakeSpan(d)));\r\n```\r\n\r\nsome weird rvalue voodoo going on?",
      "created_at" : "2020-05-02T08:12:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-622846597",
      "id" : 622846597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjg0NjU5Nw==",
      "updated_at" : "2020-05-02T08:12:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622846597",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "NONE",
      "body" : " I may be wrong, but i think in your first example, the return value of `RandomData()` is destructed immediately.\r\n\r\n```c++\r\nauto d = MakeSpan(RandomData());\r\n// d contains dangling pointers by this line.\r\nrb1.insert(d)\r\nBOOST_CHECK(rb1.contains(d));\r\n```\r\n\r\nMakeSpan takes a [universal reference](https://channel9.msdn.com/Shows/Going+Deep/Cpp-and-Beyond-2012-Scott-Meyers-Universal-References-in-Cpp11) (`V&&`) in this PR.\r\n\r\nbecause the return value of RandomData() is an Rvalue, it goes out of scope on the first line and therefore is destructed immediately.",
      "created_at" : "2020-05-02T08:53:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-622899783",
      "id" : 622899783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjg5OTc4Mw==",
      "updated_at" : "2020-05-02T08:53:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622899783",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/2920178?v=4",
         "events_url" : "https://api.github.com/users/aminroosta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aminroosta/followers",
         "following_url" : "https://api.github.com/users/aminroosta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aminroosta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aminroosta",
         "id" : 2920178,
         "login" : "aminroosta",
         "node_id" : "MDQ6VXNlcjI5MjAxNzg=",
         "organizations_url" : "https://api.github.com/users/aminroosta/orgs",
         "received_events_url" : "https://api.github.com/users/aminroosta/received_events",
         "repos_url" : "https://api.github.com/users/aminroosta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aminroosta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aminroosta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aminroosta"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@aminroosta I understand some of those words. thanks!",
      "created_at" : "2020-05-02T09:04:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-622914063",
      "id" : 622914063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjkxNDA2Mw==",
      "updated_at" : "2020-05-02T09:04:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622914063",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r418946459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418946459"
         }
      },
      "author_association" : "NONE",
      "body" : "@sipa @jb55 I think passing any rvalue/temporary here will result in dangling pointers.\r\n\r\nI did check the docs and the [c++ 20 span](https://en.cppreference.com/w/cpp/container/span/span) has a ctor that takes `R&&` ...\r\n\r\n```c++\r\ntemplate <class R>\r\nconstexpr span(R&& r);\r\n```\r\nhowever It says R must model [borrowed_range](https://en.cppreference.com/w/cpp/ranges/borrowed_range). \r\nIn other words R must be a non owning view (like basic_string_view, span, ref_view ...).\r\n```\r\nThe behavior is undefined if R does not actually model contiguous_range and\r\nsized_range or if R does not model borrowed_range while element_type is non-const.\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n```suggestion\r\nconstexpr auto MakeSpan(V& v) -> Span<typename std::remove_pointer<decltype(v.data())>::type> { return Span<typename std::remove_pointer<decltype(v.data())>::type>(v.data(), v.size()); }\r\n```",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-02T11:23:27Z",
      "diff_hunk" : "@@ -73,11 +105,8 @@ class Span\n  *\n  * std::span will have a constructor that implements this functionality directly.\n  */\n-template<typename A, int N>\n-constexpr Span<A> MakeSpan(A (&a)[N]) { return Span<A>(a, N); }\n-\n template<typename V>\n-constexpr Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type> MakeSpan(V& v) { return Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type>(v.data(), v.size()); }\n+constexpr auto MakeSpan(V&& v) -> Span<typename std::remove_pointer<decltype(v.data())>::type> { return Span<typename std::remove_pointer<decltype(v.data())>::type>(v.data(), v.size()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r418946459",
      "id" : 418946459,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk0NjQ1OQ==",
      "original_commit_id" : "bc32062d4081eb6f9d2d198861bc255e3cd33d38",
      "original_line" : 109,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 404520352,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/418946459",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/2920178?v=4",
         "events_url" : "https://api.github.com/users/aminroosta/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aminroosta/followers",
         "following_url" : "https://api.github.com/users/aminroosta/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aminroosta/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aminroosta",
         "id" : 2920178,
         "login" : "aminroosta",
         "node_id" : "MDQ6VXNlcjI5MjAxNzg=",
         "organizations_url" : "https://api.github.com/users/aminroosta/orgs",
         "received_events_url" : "https://api.github.com/users/aminroosta/received_events",
         "repos_url" : "https://api.github.com/users/aminroosta/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aminroosta/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aminroosta/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aminroosta"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yes, exactly what @aminroosta said.",
      "created_at" : "2020-05-02T17:20:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-622986496",
      "id" : 622986496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMjk4NjQ5Ng==",
      "updated_at" : "2020-05-02T17:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622986496",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r419022378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419022378"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, fixed!",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-02T23:44:29Z",
      "diff_hunk" : "@@ -32,7 +32,7 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n     }\n \n     std::string another_str = fuzzed_data_provider.ConsumeBytesAsString(32);\n-    const Span<const char> another_span = MakeSpan(another_str);\n+    const Span<const char> another_span{str};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r419022378",
      "id" : 419022378,
      "in_reply_to_id" : 418929147,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAyMjM3OA==",
      "original_commit_id" : "bc32062d4081eb6f9d2d198861bc255e3cd33d38",
      "original_line" : 35,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/span.cpp",
      "position" : null,
      "pull_request_review_id" : 404568814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419022378",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jb55 @aminroosta Ok, interesting. I guess the reasoning is that an `std::span` should really be thought of a a \"reference + size\" thing. You can't pass a temporary to a function that takes a non-const lvalue reference (because it would be surprising to make modifications to an input that's going to be discarded) - similarly you shouldn't be able to pass a temporary to a function that takes a mutable `std::span`.\r\n\r\nI've made changes to this PR to implement the same behaviour - both in the constructor and in `MakeSpan`. You can construct mutable `Span`s from lvalue references, but if you pass in a temporary you can only create immutable Spans.\r\n\r\nNone of this really addresses the lifetime issue that @jb55 encountered. If you construct a Span from a temporary, you better make sure the Span doesn't outlive the object pointed to. This is similar to the follow code, which compiles fine, but is UB:\r\n\r\n```c++\r\nconst char& chr = std::string(\"blup\")[0];\r\nputchar(chr);\r\n```\r\n\r\nA string is constructed in the first line, and destroyed when the statement ends. This means `chr` is now a reference to a non-existing object.\r\n\r\nThe same thing is possible with `Span` (and with C++20 `std::span`, I just checked):\r\n\r\n```c++\r\nstd::span<const char> sp{std::string(\"blup\")};\r\nputchar(sp[0]);\r\n```\r\n",
      "created_at" : "2020-05-02T23:51:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-623030711",
      "id" : 623030711,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzAzMDcxMQ==",
      "updated_at" : "2020-05-02T23:54:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623030711",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r419023328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419023328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've made some changes, and commented below.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-02T23:55:42Z",
      "diff_hunk" : "@@ -73,11 +105,8 @@ class Span\n  *\n  * std::span will have a constructor that implements this functionality directly.\n  */\n-template<typename A, int N>\n-constexpr Span<A> MakeSpan(A (&a)[N]) { return Span<A>(a, N); }\n-\n template<typename V>\n-constexpr Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type> MakeSpan(V& v) { return Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type>(v.data(), v.size()); }\n+constexpr auto MakeSpan(V&& v) -> Span<typename std::remove_pointer<decltype(v.data())>::type> { return Span<typename std::remove_pointer<decltype(v.data())>::type>(v.data(), v.size()); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r419023328",
      "id" : 419023328,
      "in_reply_to_id" : 418946459,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAyMzMyOA==",
      "original_commit_id" : "bc32062d4081eb6f9d2d198861bc255e3cd33d38",
      "original_line" : 109,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 404569327,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419023328",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r419132291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419132291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    const Span<const char> another_span{another_str};\r\n```\r\n:sweat_smile: ",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-03T17:13:21Z",
      "diff_hunk" : "@@ -32,7 +32,7 @@ void test_one_input(const std::vector<uint8_t>& buffer)\n     }\n \n     std::string another_str = fuzzed_data_provider.ConsumeBytesAsString(32);\n-    const Span<const char> another_span = MakeSpan(another_str);\n+    const Span<const char> another_span{another_ptr};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r419132291",
      "id" : 419132291,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEzMjI5MQ==",
      "original_commit_id" : "88817d05a73f7b5cd5d7b07d628c88294edc9c5f",
      "original_line" : 35,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/fuzz/span.cpp",
      "position" : null,
      "pull_request_review_id" : 404638949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/419132291",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. I'm curious why span constructors aren't declared `explicit` - I'm aware `std::span` doesn't have them - since this is the project implementation and \"should\" follow #11112.",
      "created_at" : "2020-05-03T22:20:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-623191588",
      "id" : 623191588,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzE5MTU4OA==",
      "updated_at" : "2020-05-03T22:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623191588",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag That would partially defeat the purpose, in my view. With std::span/Span, the point is that you can write a single function that accepts a span as input, and it will automatically work with whatever continuous container you pass it. This is safe as spans are restricted in features to be a strict subset of those containers.",
      "created_at" : "2020-05-03T22:39:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-623194442",
      "id" : 623194442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzE5NDQ0Mg==",
      "updated_at" : "2020-05-03T22:44:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623194442",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@sipa right, I see you have edited your comment. Don't get me wrong, I like/prefer this way.",
      "created_at" : "2020-05-03T22:46:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-623195515",
      "id" : 623195515,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyMzE5NTUxNQ==",
      "updated_at" : "2020-05-03T22:46:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/623195515",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I added a workaround that seems necessary on CentOS 7 (GCC 4.8.5). It seems that when both a function `template<typename T> F(T&)` and `template<typename T> F(T&&)` are present, passing an lvalue rerence is treated as ambiguous there (other compilers correctly prefer the explicitly lvalue reference first version over the universal reference in the second).",
      "created_at" : "2020-05-05T18:42:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-624235722",
      "id" : 624235722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNDIzNTcyMg==",
      "updated_at" : "2020-05-05T18:42:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624235722",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-11T06:11:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-626492147",
      "id" : 626492147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyNjQ5MjE0Nw==",
      "updated_at" : "2020-05-11T06:11:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/626492147",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n-----BEGIN OPENTIMESTAMPS MESSAGE-----\r\n\r\n- -----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA256\r\n\r\nTested ACK 1f790a1147ad9a5fe06987d84b6cd71f91cbec4b \r\n- -----BEGIN PGP SIGNATURE-----\r\n\r\niHUEARYIAB0WIQTgLT/U60WFpjUxwdDhv8uQof96HAUCXr8/HwAKCRDhv8uQof96\r\nHHdWAP4oLAWAFyl89rmXCkOLhabnQH0eA1WuQLms9sGQ/0ZuIAEA95NqgBdDXeNy\r\nLNZONShuQyUhND7sV3DFtdnwlMdwRAM=\r\n=eezA\r\n- -----END PGP SIGNATURE-----\r\n\r\n-----BEGIN OPENTIMESTAMPS PROOF-----\r\n\r\nAE9wZW5UaW1lc3RhbXBzAABQcm9vZgC/ieLohOiSlAEI0+kRFDp/91K3axlWimkSIh1Ka2PWppGJ\r\nYtXOXy0HOKPwEIew6IYLhpu8/iYXzfmu8MQI//AQCDnqvzdSHC6NHfUc3YlXSAjxBF6/PznwCGCt\r\nodmwhfKvAIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxlbmRhci5jYXRhbGxheHkuY29t//AQJIfp\r\nXbaf4HUvxkjGLaBeyQjxIK2eTRPWo7iFMz9KJAhAEQj++q+aDKHrMrU2g1OTU56WCPEEXr8/OPAI\r\n3EyoLhEfdiQAg9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1w\r\ncy5vcmfwEPLW6m0gMqdiEIgYvoB9QnYI8CA+Yd5Y9xkgXBCvNi5d4UBONxjC+nGVWiUTf+sCVk4O\r\nmAjxBF6/PznwCCCCbb6MkeJlAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5ldGVy\r\nbml0eXdhbGwuY29t\r\n-----END OPENTIMESTAMPS PROOF-----\r\n```\r\n[otsclear](https://git.sr.ht/~jb55/ots-tools/tree/master/otsclear) `xclip -o | otsclear -v | gpg --verify`",
      "created_at" : "2020-05-16T01:29:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-629568997",
      "id" : 629568997,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTU2ODk5Nw==",
      "updated_at" : "2020-05-16T01:29:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629568997",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jb55 Which key did you use to sign this? I'm seeing `E02D3FD4EB4585A63531C1D0E1BFCB90A1FF7A1C` which doesn't seem to match the one I have for you `1514A56A573AADFCA0EBFF908FB01059E7960F33` (from your website).\r\n",
      "created_at" : "2020-05-16T01:44:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-629570690",
      "id" : 629570690,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTU3MDY5MA==",
      "updated_at" : "2020-05-16T01:44:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629570690",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for verifying :) @fanquake https://jb55.com/s/8f099795a120ae13.txt ",
      "created_at" : "2020-05-16T01:51:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-629571454",
      "id" : 629571454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYyOTU3MTQ1NA==",
      "updated_at" : "2020-05-16T01:53:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629571454",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/45598?v=4",
         "events_url" : "https://api.github.com/users/jb55/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jb55/followers",
         "following_url" : "https://api.github.com/users/jb55/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jb55/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jb55",
         "id" : 45598,
         "login" : "jb55",
         "node_id" : "MDQ6VXNlcjQ1NTk4",
         "organizations_url" : "https://api.github.com/users/jb55/orgs",
         "received_events_url" : "https://api.github.com/users/jb55/received_events",
         "repos_url" : "https://api.github.com/users/jb55/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jb55/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jb55/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jb55"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r426119379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426119379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: could pass `descriptor` directly to `CheckChecksum`",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-16T05:07:15Z",
      "diff_hunk" : "@@ -1098,7 +1098,7 @@ std::string GetDescriptorChecksum(const std::string& descriptor)\n {\n     std::string ret;\n     std::string error;\n-    Span<const char> sp(descriptor.data(), descriptor.size());\n+    Span<const char> sp{descriptor};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r426119379",
      "id" : 426119379,
      "line" : 1101,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExOTM3OQ==",
      "original_commit_id" : "2676aeadfa0e43dcaaccc4720623cdfe0beed528",
      "original_line" : 1101,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 23,
      "pull_request_review_id" : 413048410,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426119379",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r426119873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426119873"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: should we assert or otherwise check against end < data here?",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-16T05:15:30Z",
      "diff_hunk" : "@@ -18,12 +18,26 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}\n+\n+    /** Construct a span from a begin and end pointer.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, T* end) noexcept : m_data(begin), m_size(end - begin) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r426119873",
      "id" : 426119873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExOTg3Mw==",
      "original_commit_id" : "2676aeadfa0e43dcaaccc4720623cdfe0beed528",
      "original_line" : 40,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 413048814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/426119873",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r431422379"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431422379"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd rather not. This is an extremely lightweight object, so adding any kind of runtime checking may have significant performance impact.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-27T20:28:36Z",
      "diff_hunk" : "@@ -18,12 +18,26 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}\n+\n+    /** Construct a span from a begin and end pointer.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, T* end) noexcept : m_data(begin), m_size(end - begin) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r431422379",
      "id" : 431422379,
      "in_reply_to_id" : 426119873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyMjM3OQ==",
      "original_commit_id" : "2676aeadfa0e43dcaaccc4720623cdfe0beed528",
      "original_line" : 40,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 419583093,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431422379",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r431432959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431432959"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That doesn't work; `CheckChecksum` needs a reference to a mutable `Span<const char>` (it's an input/output argument). You can't bind a temporary to that.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-05-27T20:48:54Z",
      "diff_hunk" : "@@ -1098,7 +1098,7 @@ std::string GetDescriptorChecksum(const std::string& descriptor)\n {\n     std::string ret;\n     std::string error;\n-    Span<const char> sp(descriptor.data(), descriptor.size());\n+    Span<const char> sp{descriptor};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r431432959",
      "id" : 431432959,
      "in_reply_to_id" : 426119379,
      "line" : 1101,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzMjk1OQ==",
      "original_commit_id" : "2676aeadfa0e43dcaaccc4720623cdfe0beed528",
      "original_line" : 1101,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 23,
      "pull_request_review_id" : 419596627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/431432959",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r435402480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435402480"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You could add the check only if `#ifdef DEBUG`. Then at least these kind of out of bounds issues will be flagged in debug builds. No strong opinion though.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-04T16:47:48Z",
      "diff_hunk" : "@@ -18,12 +18,26 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}\n+\n+    /** Construct a span from a begin and end pointer.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, T* end) noexcept : m_data(begin), m_size(end - begin) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r435402480",
      "id" : 435402480,
      "in_reply_to_id" : 426119873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMjQ4MA==",
      "original_commit_id" : "2676aeadfa0e43dcaaccc4720623cdfe0beed528",
      "original_line" : 40,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 424640989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435402480",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "~~Code review ACK 2676aeadfa0e43dcaaccc4720623cdfe0beed528~~\r\nCode review ACK 26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-04T16:48:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-638976042",
      "id" : 638976042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzODk3NjA0Mg==",
      "updated_at" : "2020-06-18T11:44:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638976042",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a commit that adds a bunch of asserts that are enabled on `-DDEBUG`.",
      "created_at" : "2020-06-04T18:06:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-639016510",
      "id" : 639016510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTAxNjUxMA==",
      "updated_at" : "2020-06-04T18:06:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639016510",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r435476137"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435476137"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, done.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-04T18:44:56Z",
      "diff_hunk" : "@@ -18,12 +18,26 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}\n+\n+    /** Construct a span from a begin and end pointer.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, T* end) noexcept : m_data(begin), m_size(end - begin) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r435476137",
      "id" : 435476137,
      "in_reply_to_id" : 426119873,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ3NjEzNw==",
      "original_commit_id" : "2676aeadfa0e43dcaaccc4720623cdfe0beed528",
      "original_line" : 40,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : null,
      "pull_request_review_id" : 424733434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435476137",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK https://github.com/bitcoin/bitcoin/pull/18468/commits/3d9ef83776f831a1f077674c16807391ec5f5d57",
      "created_at" : "2020-06-05T00:22:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-639187198",
      "id" : 639187198,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTE4NzE5OA==",
      "updated_at" : "2020-06-05T00:22:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639187198",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2020-06-05T07:33:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-639310657",
      "id" : 639310657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzOTMxMDY1Nw==",
      "updated_at" : "2020-06-05T07:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639310657",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r439076706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439076706"
         }
      },
      "author_association" : "MEMBER",
      "body" : "3d9ef83776f831a1f077674c16807391ec5f5d57\r\n\r\n#define ASSERT_IF_DEBUG ?",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-11T21:20:24Z",
      "diff_hunk" : "@@ -10,6 +10,12 @@\n #include <algorithm>\n #include <assert.h>\n \n+#ifdef DEBUG\n+#define CONSTEXPR_IF_NOT_DEBUG\n+#else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r439076706",
      "id" : 439076706,
      "line" : 16,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3NjcwNg==",
      "original_commit_id" : "3d9ef83776f831a1f077674c16807391ec5f5d57",
      "original_line" : 16,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 7,
      "pull_request_review_id" : 429296749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:12:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439076706",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "node_id" : "MDQ6VXNlcjM1MzQ1MjQ=",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r441862983"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441862983"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good idea, done!",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-17T22:13:01Z",
      "diff_hunk" : "@@ -10,6 +10,12 @@\n #include <algorithm>\n #include <assert.h>\n \n+#ifdef DEBUG\n+#define CONSTEXPR_IF_NOT_DEBUG\n+#else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r441862983",
      "id" : 441862983,
      "in_reply_to_id" : 439076706,
      "line" : 16,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg2Mjk4Mw==",
      "original_commit_id" : "3d9ef83776f831a1f077674c16807391ec5f5d57",
      "original_line" : 16,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 7,
      "pull_request_review_id" : 432813658,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-17T22:13:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441862983",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r442998211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442998211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could you help me understand the lifetime of a temporary here? It seems like you'd want this to be lvalue only.\r\nFor example, this works and passes undefined/memory sanitizer checks, but I don't understand why:\r\n```c++\r\nSpan<const char> foo(\"bar\");\r\nprintf(\"foo: %s\\n\", foo.data());\r\n```\r\nI would have expected the lifetime of the literal to end after the constructor, but the memory appears to remain valid afterwards.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-19T18:54:58Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;\n \n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r442998211",
      "id" : 442998211,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk5ODIxMQ==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 72,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 54,
      "pull_request_review_id" : 434283400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T18:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/442998211",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443000807"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443000807"
         }
      },
      "author_association" : "MEMBER",
      "body" : "That's a good question, but not the right example. String literals have static lifetime in C++, so in this specific case there is no problem.\r\n\r\nHowever, there are pitfalls around constructing a Span from a temporary, see https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-623030711 for more discussion. It's an inherent problem with objects that store references unfortunately, and present in `std::span` as well.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-19T19:01:29Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;\n \n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443000807",
      "id" : 443000807,
      "in_reply_to_id" : 442998211,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzAwMDgwNw==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 72,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 54,
      "pull_request_review_id" : 434286580,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-19T19:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443000807",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443616796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443616796"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Which modification in `span.h` exactly is allowing us to use list initialization? \r\n",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-22T14:50:36Z",
      "diff_hunk" : "@@ -1522,7 +1522,7 @@ static bool ExecuteWitnessScript(const Span<const valtype>& stack_span, const CS\n static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const std::vector<unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n {\n     CScript scriptPubKey;\n-    Span<const valtype> stack = MakeSpan(witness.stack);\n+    Span<const valtype> stack{witness.stack};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443616796",
      "id" : 443616796,
      "line" : 1525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYxNjc5Ng==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 1525,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 5,
      "pull_request_review_id" : 435000821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T06:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443616796",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443616961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443616961"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seemed fairly new to me. Here's what I understood so far. Depending upon the context (weather DEBUG or not) we want to evaluate some of the methods differently. In non-debug mode we want them to be `constexpr` whereas in debug mode we want them to evaluate at run time. Thus we are defining some debug specific declaration here.\r\nIs that correct understanding, and can you add if there's something more to it? ",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-22T14:50:48Z",
      "diff_hunk" : "@@ -10,6 +10,14 @@\n #include <algorithm>\n #include <assert.h>\n \n+#ifdef DEBUG\n+#define CONSTEXPR_IF_NOT_DEBUG\n+#define ASSERT_IF_DEBUG(x) assert((x))\n+#else\n+#define CONSTEXPR_IF_NOT_DEBUG constexpr\n+#define ASSERT_IF_DEBUG(x)\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443616961",
      "id" : 443616961,
      "line" : 19,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYxNjk2MQ==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 19,
      "original_position" : 10,
      "original_start_line" : 13,
      "path" : "src/span.h",
      "position" : 10,
      "pull_request_review_id" : 435000821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : 13,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-23T06:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443616961",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443618892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443618892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you elaborate a little more on this specific restriction? I read your comment on [#18648(comment)](https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-623030711) but was wondering what if we want to cast a span from an rvalue reference then modify its values for whatever reason? Is it something not possible or an inherently stupid thing to do?  ",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-22T14:53:25Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;\n \n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}\n+\n+    /** Construct a Span for objects with .data() and .size() (std::string, std::array, std::vector, ...).\n+     *\n+     * This implements a subset of the functionality provided by the C++20 std::span range-based constructor.\n+     *\n+     * To prevent surprises, only Spans for constant value types are supported when passing in temporaries.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443618892",
      "id" : 443618892,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYxODg5Mg==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 78,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 60,
      "pull_request_review_id" : 435000821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T06:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443618892",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443624418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443624418"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can you explain why we are not returning `Span<V>(v.data(), v.size())` or something like that here? More precisely, I am confused about how `V v` value is being automatically cast into a span?",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-22T15:00:49Z",
      "diff_hunk" : "@@ -65,26 +131,20 @@ class Span\n     template <typename O> friend class Span;\n };\n \n-/** Create a span to a container exposing data() and size().\n- *\n- * This correctly deals with constness: the returned Span's element type will be\n- * whatever data() returns a pointer to. If either the passed container is const,\n- * or its element type is const, the resulting span will have a const element type.\n- *\n- * std::span will have a constructor that implements this functionality directly.\n- */\n-template<typename A, int N>\n-constexpr Span<A> MakeSpan(A (&a)[N]) { return Span<A>(a, N); }\n-\n-template<typename V>\n-constexpr Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type> MakeSpan(V& v) { return Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type>(v.data(), v.size()); }\n+// MakeSpan helps constructing a Span of the right type automatically.\n+/** MakeSpan for arrays: */\n+template <typename A, int N> Span<A> constexpr MakeSpan(A (&a)[N]) { return Span<A>(a, N); }\n+/** MakeSpan for temporaries / rvalue references, only supporting const output. */\n+template <typename V> constexpr auto MakeSpan(V&& v) -> typename std::enable_if<!std::is_lvalue_reference<V>::value, Span<const typename std::remove_pointer<decltype(v.data())>::type>>::type { return std::forward<V>(v); }\n+/** MakeSpan for (lvalue) references, supporting mutable output. */\n+template <typename V> constexpr auto MakeSpan(V& v) -> Span<typename std::remove_pointer<decltype(v.data())>::type> { return v; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443624418",
      "id" : 443624418,
      "line" : 140,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYyNDQxOA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 140,
      "original_position" : 140,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 140,
      "pull_request_review_id" : 435000821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T06:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443624418",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443631402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443631402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why don't we want assertions to happen in non-debug mode?",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-22T15:10:43Z",
      "diff_hunk" : "@@ -10,6 +10,14 @@\n #include <algorithm>\n #include <assert.h>\n \n+#ifdef DEBUG\n+#define CONSTEXPR_IF_NOT_DEBUG\n+#define ASSERT_IF_DEBUG(x) assert((x))\n+#else\n+#define CONSTEXPR_IF_NOT_DEBUG constexpr\n+#define ASSERT_IF_DEBUG(x)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443631402",
      "id" : 443631402,
      "line" : 18,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYzMTQwMg==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 18,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 9,
      "pull_request_review_id" : 435000821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-23T06:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443631402",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443636758"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443636758"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This was wild learning curve. If I try to translate this in English it sounds like:\r\nIf a `T` type pointer array is convertible into a `C` type pointer array, then only use this constructor.\r\nDoes that sound correct? \r\nThen my question is if I pass in the `T` at the time of construction, how does the compiler know about the `C` in order to evaluate the above statement?     ",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-22T15:18:35Z",
      "diff_hunk" : "@@ -18,12 +26,29 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r443636758",
      "id" : 443636758,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYzNjc1OA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 40,
      "original_position" : 33,
      "original_start_line" : 39,
      "path" : "src/span.h",
      "position" : 33,
      "pull_request_review_id" : 435000821,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : 39,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-23T06:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/443636758",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/36541669?v=4",
         "events_url" : "https://api.github.com/users/rajarshimaitra/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rajarshimaitra/followers",
         "following_url" : "https://api.github.com/users/rajarshimaitra/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rajarshimaitra/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rajarshimaitra",
         "id" : 36541669,
         "login" : "rajarshimaitra",
         "node_id" : "MDQ6VXNlcjM2NTQxNjY5",
         "organizations_url" : "https://api.github.com/users/rajarshimaitra/orgs",
         "received_events_url" : "https://api.github.com/users/rajarshimaitra/received_events",
         "repos_url" : "https://api.github.com/users/rajarshimaitra/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rajarshimaitra/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rajarshimaitra/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rajarshimaitra"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444604838"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444604838"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Follow-up: https://github.com/bitcoin/bitcoin/pull/19367",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:10:52Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;\n \n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444604838",
      "id" : 444604838,
      "in_reply_to_id" : 442998211,
      "line" : 72,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNDgzOA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 72,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 54,
      "pull_request_review_id" : 436276860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T02:10:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444604838",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jb55 @theuni I've opened https://github.com/bitcoin/bitcoin/pull/19367 to document some of the pitfalls you mentioned in comments above.",
      "created_at" : "2020-06-24T02:11:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-648539738",
      "id" : 648539738,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODUzOTczOA==",
      "updated_at" : "2020-06-24T02:11:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648539738",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444606254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444606254"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is not list initialization, but value initialization (see https://en.cppreference.com/w/cpp/language/value_initialization). In short, `Type{arg1, arg2}` is the preferred way in >=C++11 to invoke a type's constructor.\r\n\r\nIn this case, it's effectively calling `Span<const valtype>(witness.stack)`.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:16:06Z",
      "diff_hunk" : "@@ -1522,7 +1522,7 @@ static bool ExecuteWitnessScript(const Span<const valtype>& stack_span, const CS\n static bool VerifyWitnessProgram(const CScriptWitness& witness, int witversion, const std::vector<unsigned char>& program, unsigned int flags, const BaseSignatureChecker& checker, ScriptError* serror)\n {\n     CScript scriptPubKey;\n-    Span<const valtype> stack = MakeSpan(witness.stack);\n+    Span<const valtype> stack{witness.stack};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444606254",
      "id" : 444606254,
      "in_reply_to_id" : 443616796,
      "line" : 1525,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNjI1NA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 1525,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/interpreter.cpp",
      "position" : 5,
      "pull_request_review_id" : 436278495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T02:38:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444606254",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444607841"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444607841"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that `constexpr` for a function does not mean that the function will necessarily always be (entirely) evaluated at compile time; only that at least for some inputs, parts of the function can be evaluated at compile time (C++20 adds a `consteval` keyword for things that are guaranteed to be evaluated at compile time).\r\n\r\nThe problem is that (in C++11) we can't mark functions `constexpr` if they contain an `assert()`, as such functions are restricted to consisting of a single return statement. So we're forced to make the `constexpr` keyword condition on not being in DEBUG mode.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:21:52Z",
      "diff_hunk" : "@@ -10,6 +10,14 @@\n #include <algorithm>\n #include <assert.h>\n \n+#ifdef DEBUG\n+#define CONSTEXPR_IF_NOT_DEBUG\n+#define ASSERT_IF_DEBUG(x) assert((x))\n+#else\n+#define CONSTEXPR_IF_NOT_DEBUG constexpr\n+#define ASSERT_IF_DEBUG(x)\n+#endif",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444607841",
      "id" : 444607841,
      "in_reply_to_id" : 443616961,
      "line" : 19,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNzg0MQ==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 19,
      "original_position" : 10,
      "original_start_line" : 13,
      "path" : "src/span.h",
      "position" : 10,
      "pull_request_review_id" : 436280339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : 13,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-24T02:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444607841",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444608256"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444608256"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've documented this here: https://github.com/bitcoin/bitcoin/pull/19367/files#diff-9f772f6f8808fe74c65228b3a74a07c2R62-R79\r\n\r\nDoes that explain?",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:23:10Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;\n \n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}\n+\n+    /** Construct a Span for objects with .data() and .size() (std::string, std::array, std::vector, ...).\n+     *\n+     * This implements a subset of the functionality provided by the C++20 std::span range-based constructor.\n+     *\n+     * To prevent surprises, only Spans for constant value types are supported when passing in temporaries.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444608256",
      "id" : 444608256,
      "in_reply_to_id" : 443618892,
      "line" : 78,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwODI1Ng==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 78,
      "original_position" : 60,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 60,
      "pull_request_review_id" : 436280747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T02:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444608256",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444610007"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444610007"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It's converting the argument to the return type, so this is effectively evaluating `Span<typename std::remove_pointer<decltype(v.data())>::type>(v)`. As `Span` has a constructor for converting from any data type that exposes a proper `size()` and `data()` member function (the range-like object constructor), so that's what is invoked here.\r\n\r\nThe reason for not calling the pointer/size constructor instead (which could have been written as `return {v.data(), v.size()};` btw), is that this would potentially bypass the protections that are already implemented for the range-like object constructor.\r\n\r\n`MakeSpan`'s only purpose is automatic inference of a Span's type to construct, this way of implementing things guarantees it is not doing anything more than that (it doesn't change what can be constructed; it only lets you write `MakeSpan(...)` instead of `Span<...>(...)`).",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:29:55Z",
      "diff_hunk" : "@@ -65,26 +131,20 @@ class Span\n     template <typename O> friend class Span;\n };\n \n-/** Create a span to a container exposing data() and size().\n- *\n- * This correctly deals with constness: the returned Span's element type will be\n- * whatever data() returns a pointer to. If either the passed container is const,\n- * or its element type is const, the resulting span will have a const element type.\n- *\n- * std::span will have a constructor that implements this functionality directly.\n- */\n-template<typename A, int N>\n-constexpr Span<A> MakeSpan(A (&a)[N]) { return Span<A>(a, N); }\n-\n-template<typename V>\n-constexpr Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type> MakeSpan(V& v) { return Span<typename std::remove_pointer<decltype(std::declval<V>().data())>::type>(v.data(), v.size()); }\n+// MakeSpan helps constructing a Span of the right type automatically.\n+/** MakeSpan for arrays: */\n+template <typename A, int N> Span<A> constexpr MakeSpan(A (&a)[N]) { return Span<A>(a, N); }\n+/** MakeSpan for temporaries / rvalue references, only supporting const output. */\n+template <typename V> constexpr auto MakeSpan(V&& v) -> typename std::enable_if<!std::is_lvalue_reference<V>::value, Span<const typename std::remove_pointer<decltype(v.data())>::type>>::type { return std::forward<V>(v); }\n+/** MakeSpan for (lvalue) references, supporting mutable output. */\n+template <typename V> constexpr auto MakeSpan(V& v) -> Span<typename std::remove_pointer<decltype(v.data())>::type> { return v; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444610007",
      "id" : 444610007,
      "in_reply_to_id" : 443624418,
      "line" : 140,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxMDAwNw==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 140,
      "original_position" : 140,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 140,
      "pull_request_review_id" : 436282778,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T02:29:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444610007",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444610618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444610618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Performance.\r\n\r\n`Span` is an extreme lightweight object, which I imagine we'll use in very tight loops or other performance critical situations. In normal production code these asserts would be an unreasonable burden. But at the same time, it's nice to be able to verify in tests that these properties hold, so they're enabled in DEBUG mode.\r\n\r\n",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:32:16Z",
      "diff_hunk" : "@@ -10,6 +10,14 @@\n #include <algorithm>\n #include <assert.h>\n \n+#ifdef DEBUG\n+#define CONSTEXPR_IF_NOT_DEBUG\n+#define ASSERT_IF_DEBUG(x) assert((x))\n+#else\n+#define CONSTEXPR_IF_NOT_DEBUG constexpr\n+#define ASSERT_IF_DEBUG(x)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444610618",
      "id" : 444610618,
      "in_reply_to_id" : 443631402,
      "line" : 18,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxMDYxOA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 18,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 9,
      "pull_request_review_id" : 436283490,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T02:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444610618",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444611936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444611936"
         }
      },
      "author_association" : "MEMBER",
      "body" : "At least in C++11, because you're telling it what `C` is, perhaps without knowing it.\r\n\r\nYou could invoke this constructor like this:\r\n\r\n```c++\r\nint arr[5] = {1, 2, 3, 4, 5};\r\nSpan<const int> sp{&arr[1], 3};\r\n```\r\n\r\nWhich is actually a conversion, as `&arr[1]` has type `T`=`int`, but `C`=`const int`.\r\n\r\nIn other contexts, `C` may be set implicitly. For example:\r\n\r\n```c++\r\nvoid Foo(Span<const int> arg);\r\n...\r\nint arr[5] = {1, 2, 3, 4, 5};\r\nFoo({&arr[1], 3});\r\n```\r\n\r\nwhere `C` is again `const int`, but it's implied by the argument type of the called function.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T02:37:42Z",
      "diff_hunk" : "@@ -18,12 +26,29 @@ template<typename C>\n class Span\n {\n     C* m_data;\n-    std::ptrdiff_t m_size;\n+    std::size_t m_size;\n \n public:\n     constexpr Span() noexcept : m_data(nullptr), m_size(0) {}\n-    constexpr Span(C* data, std::ptrdiff_t size) noexcept : m_data(data), m_size(size) {}\n-    constexpr Span(C* data, C* end) noexcept : m_data(data), m_size(end - data) {}\n+\n+    /** Construct a span from a begin pointer and a size.\n+     *\n+     * This implements a subset of the iterator-based std::span constructor in C++20,\n+     * which is hard to implement without std::address_of.\n+     */\n+    template <typename T, typename std::enable_if<std::is_convertible<T (*)[], C (*)[]>::value, int>::type = 0>\n+    constexpr Span(T* begin, std::size_t size) noexcept : m_data(begin), m_size(size) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444611936",
      "id" : 444611936,
      "in_reply_to_id" : 443636758,
      "line" : 40,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxMTkzNg==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 40,
      "original_position" : 33,
      "original_start_line" : 39,
      "path" : "src/span.h",
      "position" : 33,
      "pull_request_review_id" : 436285014,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : 39,
      "start_side" : "RIGHT",
      "updated_at" : "2020-06-24T06:31:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444611936",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "post-merge code review ACK",
      "created_at" : "2020-06-24T11:11:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-648756399",
      "id" : 648756399,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODc1NjM5OQ==",
      "updated_at" : "2020-06-24T11:11:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648756399",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444943525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444943525"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The casts in spanparsing.cpp can now be removed:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/util/spanparsing.cpp#L16\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/util/spanparsing.cpp#L25",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T14:38:38Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;\n \n+    /** Construct a Span from an array. This matches the corresponding C++20 std::span constructor. */\n+    template <int N>\n+    constexpr Span(C (&a)[N]) noexcept : m_data(a), m_size(N) {}\n+\n+    /** Construct a Span for objects with .data() and .size() (std::string, std::array, std::vector, ...).\n+     *\n+     * This implements a subset of the functionality provided by the C++20 std::span range-based constructor.\n+     *\n+     * To prevent surprises, only Spans for constant value types are supported when passing in temporaries.\n+     * Note that this restriction does not exist when converting arrays or other Spans (see above).\n+     */\n+    template <typename V, typename std::enable_if<(std::is_const<C>::value || std::is_lvalue_reference<V>::value) && std::is_convertible<typename std::remove_pointer<decltype(std::declval<V&>().data())>::type (*)[], C (*)[]>::value && std::is_convertible<decltype(std::declval<V&>().size()), std::size_t>::value, int>::type = 0>\n+    constexpr Span(V&& v) noexcept : m_data(v.data()), m_size(v.size()) {}\n+\n     constexpr C* data() const noexcept { return m_data; }\n     constexpr C* begin() const noexcept { return m_data; }\n     constexpr C* end() const noexcept { return m_data + m_size; }\n-    constexpr C& front() const noexcept { return m_data[0]; }\n-    constexpr C& back() const noexcept { return m_data[m_size - 1]; }\n-    constexpr std::ptrdiff_t size() const noexcept { return m_size; }\n-    constexpr C& operator[](std::ptrdiff_t pos) const noexcept { return m_data[pos]; }\n-\n-    constexpr Span<C> subspan(std::ptrdiff_t offset) const noexcept { return Span<C>(m_data + offset, m_size - offset); }\n-    constexpr Span<C> subspan(std::ptrdiff_t offset, std::ptrdiff_t count) const noexcept { return Span<C>(m_data + offset, count); }\n-    constexpr Span<C> first(std::ptrdiff_t count) const noexcept { return Span<C>(m_data, count); }\n-    constexpr Span<C> last(std::ptrdiff_t count) const noexcept { return Span<C>(m_data + m_size - count, count); }\n+    CONSTEXPR_IF_NOT_DEBUG C& front() const noexcept\n+    {\n+        ASSERT_IF_DEBUG(size() > 0);\n+        return m_data[0];\n+    }\n+    CONSTEXPR_IF_NOT_DEBUG C& back() const noexcept\n+    {\n+        ASSERT_IF_DEBUG(size() > 0);\n+        return m_data[m_size - 1];\n+    }\n+    constexpr std::size_t size() const noexcept { return m_size; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r444943525",
      "id" : 444943525,
      "line" : 97,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk0MzUyNQ==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 97,
      "original_position" : 88,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 88,
      "pull_request_review_id" : 436712850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T15:51:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/444943525",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445008787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445008787"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm pretty sure that these default declarations are unnecessary, since they'll be generated by default anyway.\r\n\r\nThe only place I'm aware of needing to declare default ctors/assignment operators is when you're using a unique_ptr for an incomplete type, and you need to declare them in the header file and define them (as default) in the implementation file (eg when using a unique_ptr for a pimpl).\r\n\r\nThey may be other situations where declaring default ctors/assiment operators is necessary, but I don't think this is one of them.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-24T16:09:32Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445008787",
      "id" : 445008787,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAwODc4Nw==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 68,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 50,
      "pull_request_review_id" : 436797786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-24T16:09:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445008787",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Continuing the discussion from here: https://github.com/bitcoin/bitcoin/pull/19367/files#r445025361 because I don't know where else to stick it.\r\n\r\nI believe that adding clang's lifetimebound attribute points out a valid issue here:\r\n```\r\nutil/spanparsing.cpp:46:28: warning: temporary whose address is used as value of local variable 'ret' will be destroyed at the end of the full-expression [-Wdangling]\r\n    Span<const char> ret = sp.first(it - sp.begin());\r\n```\r\n\r\nExpr's return value depends on the span that was passed in (sp), which may have been a temporary. In that case, I believe the span that's returned is now referencing invalid memory.\r\n\r\nEdit: On second thought, I suppose that's somewhat obvious behavior here and not really a bug. It would be really easy to miss in review, though :(\r\n\r\nEdit2: It does point out a dangerous pattern, though: I think any function which returns a span as a result of modifying a different input span is potentially susceptible to this issue?",
      "created_at" : "2020-06-24T17:05:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-648946546",
      "id" : 648946546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODk0NjU0Ng==",
      "updated_at" : "2020-06-24T17:23:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648946546",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Should any function that returns a subspan of the passed-in span be declared with non-const argument? Would that prevent temporaries from being passed in? Or is there a better way to do that?",
      "created_at" : "2020-06-24T18:21:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-648987266",
      "id" : 648987266,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0ODk4NzI2Ng==",
      "updated_at" : "2020-06-24T18:21:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/648987266",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theuni \r\n\r\n> It would be really easy to miss in review, though :(\r\n\r\nAgreed! It is very easy to get things wrong when reasoning about lifetime issues. This is really subtle topic filled with gotchas.\r\n\r\nThe introduction of `std::span` and `std::string_view` will bring a new golden age of use-after-frees/returns to C++ :)\r\n\r\nPersonally I'm not convinced that it is a good idea to use `std::span` or `std::string_view` as anything other than parameter types in the general case (there are exceptions obviously, but the security/stability vs performance trade-off should be considered in such cases).\r\n\r\nAs a rule of thumb: if the median reviewer has to think more than five seconds to answer \"no\" to the question \"might there be a life-time issue hiding in this use of `std::{span,string_view}`?\" then it is likely not a good idea to use them :)\r\n\r\nSomewhat related: [\"std::string_view encourages use-after-free; the Core Guidelines Checker doesn't complain\"](https://github.com/isocpp/CppCoreGuidelines/issues/1038)",
      "created_at" : "2020-06-24T21:57:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-649094742",
      "id" : 649094742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTA5NDc0Mg==",
      "updated_at" : "2020-06-24T22:25:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/649094742",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445655300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445655300"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I'm pretty sure that these default declarations are unnecessary, since they'll be generated by default anyway.\r\n\r\nBuilt, tested, and fuzzed this PR and #19326 with the default copy constructor and assignment operator in `span.h` both removed and yes, AFAICT it seems fine.\r\n",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-25T15:42:59Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445655300",
      "id" : 445655300,
      "in_reply_to_id" : 445008787,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY1NTMwMA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 68,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 50,
      "pull_request_review_id" : 437623055,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-25T15:42:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445655300",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445667901"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445667901"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I believe the default declarations aren't actually a no-op here and may be considered harmful as default move ctor/assignment is disabled when a copy/assignment oper are provided.\r\n\r\nSee [here under  Implicitly-declared move constructor for reference](https://en.cppreference.com/w/cpp/language/move_constructor). From a quick local test, it seems that even declaring a ```= default``` constructor/assignment operator is enough to disable the implicit moves. Please correct me if I'm wrong on that, though!\r\n\r\nSo as a side-effect, removing these (thus implicitly creating the move ctor) is enough to eliminate the ```lifetimebound``` false-positives reported [here](https://github.com/bitcoin/bitcoin/pull/19367#discussion_r445025361).\r\n\r\n+1 for removing them unless there was a reason for disabling those moves.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-25T16:01:34Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445667901",
      "id" : 445667901,
      "in_reply_to_id" : 445008787,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY2NzkwMQ==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 68,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 50,
      "pull_request_review_id" : 437639671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-25T16:01:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445667901",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445676920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445676920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> it seems that even declaring a = default constructor/assignment operator is enough to disable the implicit moves.\r\n\r\nFascinating! I didn't know that.\r\n\r\n> +1 for removing them unless there was a reason for disabling those moves.\r\n\r\nIf this is the case, presumably it'd be better to explicitly delete those move ctor/assigments than rely on this behavior.\r\n",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-25T16:15:00Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445676920",
      "id" : 445676920,
      "in_reply_to_id" : 445008787,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3NjkyMA==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 68,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 50,
      "pull_request_review_id" : 437651131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-25T16:15:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445676920",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "node_id" : "MDQ6VXNlcjEwNjM2NTY=",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445682882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445682882"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> > it seems that even declaring a = default constructor/assignment operator is enough to disable the implicit moves.\r\n> \r\n> Fascinating! I didn't know that.\r\n\r\nPlease double-check me on this! I'm assuming that based on my testing with lifetimebound, but I haven't managed to track down a definitive answer.",
      "commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "created_at" : "2020-06-25T16:24:01Z",
      "diff_hunk" : "@@ -42,18 +67,59 @@ class Span\n     /** Default assignment operator. */\n     Span& operator=(const Span& other) noexcept = default;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#discussion_r445682882",
      "id" : 445682882,
      "in_reply_to_id" : 445008787,
      "line" : 68,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4Mjg4Mg==",
      "original_commit_id" : "26acc8dd9b512f220c1facdba2c5de7976d3c258",
      "original_line" : 68,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/span.h",
      "position" : 50,
      "pull_request_review_id" : 437658680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/18468",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-06-25T16:24:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/445682882",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> MakeSpan takes a [universal reference](https://channel9.msdn.com/Shows/Going+Deep/Cpp-and-Beyond-2012-Scott-Meyers-Universal-References-in-Cpp11) (`V&&`) in this PR.\r\n\r\n@aminroosta Thank you -- I found your link (and the [downloadable presentation slides](https://onedrive.live.com/redir?resid=F1B8FF18A2AEC5C5!1062&page=Download)) really informative.",
      "created_at" : "2020-06-25T16:37:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/18468#issuecomment-649679286",
      "id" : 649679286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/18468",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY0OTY3OTI4Ng==",
      "updated_at" : "2020-06-25T16:37:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/649679286",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
